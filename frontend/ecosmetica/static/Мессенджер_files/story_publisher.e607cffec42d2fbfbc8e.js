!function(e){function t(t){for(var n,i,s=t[0],c=t[1],u=t[2],p=0,d=[];p<s.length;p++)i=s[p],Object.prototype.hasOwnProperty.call(o,i)&&o[i]&&d.push(o[i][0]),o[i]=0;for(n in c)Object.prototype.hasOwnProperty.call(c,n)&&(e[n]=c[n]);for(l&&l(t);d.length;)d.shift()();return a.push.apply(a,u||[]),r()}function r(){for(var e,t=0;t<a.length;t++){for(var r=a[t],n=!0,s=1;s<r.length;s++){var c=r[s];0!==o[c]&&(n=!1)}n&&(a.splice(t--,1),e=i(i.s=r[0]))}return e}var n={},o={"web/story_publisher":0},a=[];function i(t){if(n[t])return n[t].exports;var r=n[t]={i:t,l:!1,exports:{}};return e[t].call(r.exports,r,r.exports,i),r.l=!0,r.exports}i.m=e,i.c=n,i.d=function(e,t,r){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(i.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)i.d(r,n,function(t){return e[t]}.bind(null,n));return r},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="/js/cmodules/";var s=window.webpackJsonp=window.webpackJsonp||[],c=s.push.bind(s);s.push=t,s=s.slice();for(var u=0;u<s.length;u++)t(s[u]);var l=c;a.push([282,"vendors","common","145f605746e8e55e54cfd5bb0b7dca57","15942e60c2552d8c9c8d9c9d8dcedf2e"]),r()}({"/MKj":function(e,t,r){"use strict";r.r(t),r.d(t,"Provider",(function(){return m})),r.d(t,"connectAdvanced",(function(){return P})),r.d(t,"ReactReduxContext",(function(){return u})),r.d(t,"connect",(function(){return ne})),r.d(t,"batch",(function(){return pe.unstable_batchedUpdates})),r.d(t,"useDispatch",(function(){return ie})),r.d(t,"useSelector",(function(){return ue})),r.d(t,"useStore",(function(){return ae})),r.d(t,"shallowEqual",(function(){return N}));var n=r("JX7q"),o=r("dI71"),a=r("q1tI"),i=r.n(a),s=r("17x9"),c=r.n(s),u=i.a.createContext(null);var l=function(e){e()},p={notify:function(){}};function d(){var e=l,t=[],r=[];return{clear:function(){r=null,t=null},notify:function(){var n=t=r;e((function(){for(var e=0;e<n.length;e++)n[e]()}))},get:function(){return r},subscribe:function(e){var n=!0;return r===t&&(r=t.slice()),r.push(e),function(){n&&null!==t&&(n=!1,r===t&&(r=t.slice()),r.splice(r.indexOf(e),1))}}}}var f=function(){function e(e,t){this.store=e,this.parentSub=t,this.unsubscribe=null,this.listeners=p,this.handleChangeWrapper=this.handleChangeWrapper.bind(this)}var t=e.prototype;return t.addNestedSub=function(e){return this.trySubscribe(),this.listeners.subscribe(e)},t.notifyNestedSubs=function(){this.listeners.notify()},t.handleChangeWrapper=function(){this.onStateChange&&this.onStateChange()},t.isSubscribed=function(){return Boolean(this.unsubscribe)},t.trySubscribe=function(){this.unsubscribe||(this.unsubscribe=this.parentSub?this.parentSub.addNestedSub(this.handleChangeWrapper):this.store.subscribe(this.handleChangeWrapper),this.listeners=d())},t.tryUnsubscribe=function(){this.unsubscribe&&(this.unsubscribe(),this.unsubscribe=null,this.listeners.clear(),this.listeners=p)},e}(),h=function(e){function t(t){var r;r=e.call(this,t)||this;var o=t.store;r.notifySubscribers=r.notifySubscribers.bind(Object(n.default)(r));var a=new f(o);return a.onStateChange=r.notifySubscribers,r.state={store:o,subscription:a},r.previousState=o.getState(),r}Object(o.default)(t,e);var r=t.prototype;return r.componentDidMount=function(){this._isMounted=!0,this.state.subscription.trySubscribe(),this.previousState!==this.props.store.getState()&&this.state.subscription.notifyNestedSubs()},r.componentWillUnmount=function(){this.unsubscribe&&this.unsubscribe(),this.state.subscription.tryUnsubscribe(),this._isMounted=!1},r.componentDidUpdate=function(e){if(this.props.store!==e.store){this.state.subscription.tryUnsubscribe();var t=new f(this.props.store);t.onStateChange=this.notifySubscribers,this.setState({store:this.props.store,subscription:t})}},r.notifySubscribers=function(){this.state.subscription.notifyNestedSubs()},r.render=function(){var e=this.props.context||u;return i.a.createElement(e.Provider,{value:this.state},this.props.children)},t}(a.Component);h.propTypes={store:c.a.shape({subscribe:c.a.func.isRequired,dispatch:c.a.func.isRequired,getState:c.a.func.isRequired}),context:c.a.object,children:c.a.any};var m=h,_=r("wx14"),v=r("zLVn"),g=r("2mql"),y=r.n(g),E=r("QLaP"),b=r.n(E),S=r("TOwV"),T=[],w=[null,null];function O(e,t){var r=e[1];return[t.payload,r+1]}var C=function(){return[null,0]},x="undefined"!=typeof window&&void 0!==window.document&&void 0!==window.document.createElement?a.useLayoutEffect:a.useEffect;function P(e,t){void 0===t&&(t={});var r=t,n=r.getDisplayName,o=void 0===n?function(e){return"ConnectAdvanced("+e+")"}:n,s=r.methodName,c=void 0===s?"connectAdvanced":s,l=r.renderCountProp,p=void 0===l?void 0:l,d=r.shouldHandleStateChanges,h=void 0===d||d,m=r.storeKey,g=void 0===m?"store":m,E=r.withRef,P=void 0!==E&&E,R=r.forwardRef,A=void 0!==R&&R,N=r.context,L=void 0===N?u:N,I=Object(v.default)(r,["getDisplayName","methodName","renderCountProp","shouldHandleStateChanges","storeKey","withRef","forwardRef","context"]);b()(void 0===p,"renderCountProp is removed. render counting is built into the latest React Dev Tools profiling extension"),b()(!P,"withRef is removed. To access the wrapped instance, use a ref on the connected component");b()("store"===g,"storeKey has been removed and does not do anything. To use a custom Redux store for specific components, create a custom React context with React.createContext(), and pass the context object to React Redux's Provider and specific components like: <Provider context={MyContext}><ConnectedComponent context={MyContext} /></Provider>. You may also pass a {context : MyContext} option to connect");var D=L;return function(t){var r=t.displayName||t.name||"Component",n=o(r),s=Object(_.default)({},I,{getDisplayName:o,methodName:c,renderCountProp:p,shouldHandleStateChanges:h,storeKey:g,displayName:n,wrappedComponentName:r,WrappedComponent:t}),u=I.pure;var l=u?a.useMemo:function(e){return e()};function d(r){var o=Object(a.useMemo)((function(){var e=r.forwardedRef,t=Object(v.default)(r,["forwardedRef"]);return[r.context,e,t]}),[r]),c=o[0],u=o[1],p=o[2],d=Object(a.useMemo)((function(){return c&&c.Consumer&&Object(S.isContextConsumer)(i.a.createElement(c.Consumer,null))?c:D}),[c,D]),m=Object(a.useContext)(d),g=Boolean(r.store),y=Boolean(m)&&Boolean(m.store);b()(g||y,'Could not find "store" in the context of "'+n+'". Either wrap the root component in a <Provider>, or pass a custom React context provider to <Provider> and the corresponding React context consumer to '+n+" in connect options.");var E=r.store||m.store,P=Object(a.useMemo)((function(){return function(t){return e(t.dispatch,s)}(E)}),[E]),R=Object(a.useMemo)((function(){if(!h)return w;var e=new f(E,g?null:m.subscription),t=e.notifyNestedSubs.bind(e);return[e,t]}),[E,g,m]),A=R[0],N=R[1],L=Object(a.useMemo)((function(){return g?m:Object(_.default)({},m,{subscription:A})}),[g,m,A]),I=Object(a.useReducer)(O,T,C),k=I[0][0],M=I[1];if(k&&k.error)throw k.error;var j=Object(a.useRef)(),B=Object(a.useRef)(p),F=Object(a.useRef)(),U=Object(a.useRef)(!1),H=l((function(){return F.current&&p===B.current?F.current:P(E.getState(),p)}),[E,k,p]);x((function(){B.current=p,j.current=H,U.current=!1,F.current&&(F.current=null,N())})),x((function(){if(h){var e=!1,t=null,r=function(){if(!e){var r,n,o=E.getState();try{r=P(o,B.current)}catch(e){n=e,t=e}n||(t=null),r===j.current?U.current||N():(j.current=r,F.current=r,U.current=!0,M({type:"STORE_UPDATED",payload:{latestStoreState:o,error:n}}))}};A.onStateChange=r,A.trySubscribe(),r();return function(){if(e=!0,A.tryUnsubscribe(),t)throw t}}}),[E,A,P]);var W=Object(a.useMemo)((function(){return i.a.createElement(t,Object(_.default)({},H,{ref:u}))}),[u,t,H]);return Object(a.useMemo)((function(){return h?i.a.createElement(d.Provider,{value:L},W):W}),[d,W,L])}var m=u?i.a.memo(d):d;if(m.WrappedComponent=t,m.displayName=n,A){var E=i.a.forwardRef((function(e,t){return i.a.createElement(m,Object(_.default)({},e,{forwardedRef:t}))}));return E.displayName=n,E.WrappedComponent=t,y()(E,t)}return y()(m,t)}}var R=Object.prototype.hasOwnProperty;function A(e,t){return e===t?0!==e||0!==t||1/e==1/t:e!=e&&t!=t}function N(e,t){if(A(e,t))return!0;if("object"!=typeof e||null===e||"object"!=typeof t||null===t)return!1;var r=Object.keys(e),n=Object.keys(t);if(r.length!==n.length)return!1;for(var o=0;o<r.length;o++)if(!R.call(t,r[o])||!A(e[r[o]],t[r[o]]))return!1;return!0}var L=r("ANjH");function I(e){return function(t,r){var n=e(t,r);function o(){return n}return o.dependsOnOwnProps=!1,o}}function D(e){return null!==e.dependsOnOwnProps&&void 0!==e.dependsOnOwnProps?Boolean(e.dependsOnOwnProps):1!==e.length}function k(e,t){return function(t,r){r.displayName;var n=function(e,t){return n.dependsOnOwnProps?n.mapToProps(e,t):n.mapToProps(e)};return n.dependsOnOwnProps=!0,n.mapToProps=function(t,r){n.mapToProps=e,n.dependsOnOwnProps=D(e);var o=n(t,r);return"function"==typeof o&&(n.mapToProps=o,n.dependsOnOwnProps=D(o),o=n(t,r)),o},n}}var M=[function(e){return"function"==typeof e?k(e):void 0},function(e){return e?void 0:I((function(e){return{dispatch:e}}))},function(e){return e&&"object"==typeof e?I((function(t){return Object(L.bindActionCreators)(e,t)})):void 0}];var j=[function(e){return"function"==typeof e?k(e):void 0},function(e){return e?void 0:I((function(){return{}}))}];function B(e,t,r){return Object(_.default)({},r,e,t)}var F=[function(e){return"function"==typeof e?function(e){return function(t,r){r.displayName;var n,o=r.pure,a=r.areMergedPropsEqual,i=!1;return function(t,r,s){var c=e(t,r,s);return i?o&&a(c,n)||(n=c):(i=!0,n=c),n}}}(e):void 0},function(e){return e?void 0:function(){return B}}];function U(e,t,r,n){return function(o,a){return r(e(o,a),t(n,a),a)}}function H(e,t,r,n,o){var a,i,s,c,u,l=o.areStatesEqual,p=o.areOwnPropsEqual,d=o.areStatePropsEqual,f=!1;function h(o,f){var h,m,_=!p(f,i),v=!l(o,a);return a=o,i=f,_&&v?(s=e(a,i),t.dependsOnOwnProps&&(c=t(n,i)),u=r(s,c,i)):_?(e.dependsOnOwnProps&&(s=e(a,i)),t.dependsOnOwnProps&&(c=t(n,i)),u=r(s,c,i)):v?(h=e(a,i),m=!d(h,s),s=h,m&&(u=r(s,c,i)),u):u}return function(o,l){return f?h(o,l):(s=e(a=o,i=l),c=t(n,i),u=r(s,c,i),f=!0,u)}}function W(e,t){var r=t.initMapStateToProps,n=t.initMapDispatchToProps,o=t.initMergeProps,a=Object(v.default)(t,["initMapStateToProps","initMapDispatchToProps","initMergeProps"]),i=r(e,a),s=n(e,a),c=o(e,a);return(a.pure?H:U)(i,s,c,e,a)}function Y(e,t,r){for(var n=t.length-1;n>=0;n--){var o=t[n](e);if(o)return o}return function(t,n){throw new Error("Invalid value of type "+typeof e+" for "+r+" argument when connecting component "+n.wrappedComponentName+".")}}function G(e,t){return e===t}var z,V,X,K,q,Z,$,J,Q,ee,te,re,ne=(X=(V=void 0===z?{}:z).connectHOC,K=void 0===X?P:X,q=V.mapStateToPropsFactories,Z=void 0===q?j:q,$=V.mapDispatchToPropsFactories,J=void 0===$?M:$,Q=V.mergePropsFactories,ee=void 0===Q?F:Q,te=V.selectorFactory,re=void 0===te?W:te,function(e,t,r,n){void 0===n&&(n={});var o=n,a=o.pure,i=void 0===a||a,s=o.areStatesEqual,c=void 0===s?G:s,u=o.areOwnPropsEqual,l=void 0===u?N:u,p=o.areStatePropsEqual,d=void 0===p?N:p,f=o.areMergedPropsEqual,h=void 0===f?N:f,m=Object(v.default)(o,["pure","areStatesEqual","areOwnPropsEqual","areStatePropsEqual","areMergedPropsEqual"]),g=Y(e,Z,"mapStateToProps"),y=Y(t,J,"mapDispatchToProps"),E=Y(r,ee,"mergeProps");return K(re,Object(_.default)({methodName:"connect",getDisplayName:function(e){return"Connect("+e+")"},shouldHandleStateChanges:Boolean(e),initMapStateToProps:g,initMapDispatchToProps:y,initMergeProps:E,pure:i,areStatesEqual:c,areOwnPropsEqual:l,areStatePropsEqual:d,areMergedPropsEqual:h},m))});function oe(){var e=Object(a.useContext)(u);return b()(e,"could not find react-redux context value; please ensure the component is wrapped in a <Provider>"),e}function ae(){return oe().store}function ie(){return ae().dispatch}var se="undefined"!=typeof window?a.useLayoutEffect:a.useEffect,ce=function(e,t){return e===t};function ue(e,t){void 0===t&&(t=ce),b()(e,"You must pass a selector to useSelectors");var r,n=oe(),o=n.store,i=n.subscription,s=Object(a.useReducer)((function(e){return e+1}),0)[1],c=Object(a.useMemo)((function(){return new f(o,i)}),[o,i]),u=Object(a.useRef)(),l=Object(a.useRef)(),p=Object(a.useRef)();try{r=e!==l.current||u.current?e(o.getState()):p.current}catch(e){var d="An error occured while selecting the store state: "+e.message+".";throw u.current&&(d+="\nThe error may be correlated with this previous error:\n"+u.current.stack+"\n\nOriginal stack trace:"),new Error(d)}return se((function(){l.current=e,p.current=r,u.current=void 0})),se((function(){function e(){try{var e=l.current(o.getState());if(t(e,p.current))return;p.current=e}catch(e){u.current=e}s({})}return c.onStateChange=e,c.trySubscribe(),e(),function(){return c.tryUnsubscribe()}}),[o,c]),r}var le,pe=r("i8i4");le=pe.unstable_batchedUpdates,l=le},"/TnQ":function(e,t,r){"use strict";var n=r("ANjH").compose;t.__esModule=!0,t.composeWithDevTools=function(){if(0!==arguments.length)return"object"==typeof arguments[0]?n:n.apply(null,arguments)},t.devToolsEnhancer=function(){return function(e){return e}}},"0fW4":function(e,t,r){"use strict";r.r(t);var n=r("q1tI"),o=r.n(n),a=r("/MKj"),i=r("ANjH"),s=r("dImZ"),c=r.n(s),u=r("/TnQ"),l=r("sINF"),p=r("xYVc"),d=function(){for(var e=0,t=0,r=arguments.length;t<r;t++)e+=arguments[t].length;var n=Array(e),o=0;for(t=0;t<r;t++)for(var a=arguments[t],i=0,s=a.length;i<s;i++,o++)n[o]=a[i];return n};function f(e){var t=e.present.background,r=t.currentBackgroundType,n=t.currentPhotoUrl,o=t.currentBackgroundId,a="";if(r===p.default.BACKGROUND_MODES.PHOTO)a=n||"";else{var i=e.present.data.backgrounds,s=i.gradients,c=i.emojies;a=d(s,c).filter((function(e){return e.id===o}))[0].url}return a}function h(e){var t=e.present.data,r=t.addons,n=t.artboardHeight,o=n;return r&&r.photoHeight&&(o=r.photoHeight),n/2-o/2}var m,_="SET_SETTING_COLOR_CORRECTION",v="SET_SETTING_FILTER_AMOUNT",g="SET_SETTING_BLUR_SIZE",y="SET_SETTING_BLUR_POSITION",E="SET_LAYER_FONT_SIZE",b=function(){return(b=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var o in t=arguments[r])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)},S={isDataLoaded:!1,isShowDropBox:!1,isSaveLoading:!1,currentMode:p.default.TABS.STICKERS,currentStickerPackIndex:0,stickerHeaderScrollPosition:0},T=function(e,t){switch(void 0===e&&(e=S),t.type){case"SET_DATA_LOADED":return b(b({},e),{isDataLoaded:!0});case"SET_SHOW_DROP_BOX":return b(b({},e),{isShowDropBox:t.value});case"SET_SAVE_LOADING":return b(b({},e),{isSaveLoading:t.value});case"SET_CURRENT_TAB":return b(b({},e),{currentMode:t.value});case"SET_CURRENT_STICKER_PACK_INDEX":return b(b({},e),{currentStickerPackIndex:t.value});case"SET_HEADER_SCROLL_POSITION":return b(b({},e),{stickerHeaderScrollPosition:t.value});default:return e}},w=function(){return(w=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var o in t=arguments[r])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)},O={color:p.default.COLORS[0],brushWidth:.5,brushOpacity:1,fontSize:.5,fontStyle:p.default.FONTS[0],filter:{name:p.default.PHOTO_FILTERS[0],value:.5},colorCorrection:{exposure:0,contrast:0,saturation:0,warmth:0,vignette:0,sharpness:0,grain:0},blur:{isEnabled:!1,form:p.default.BLUR_TYPES.ROUND,size:50,position:[.5,.5]},isAutoCorrection:!1,cropAspect:p.default.CROP_ASPECT_FREE,isCropped:!1,flipX:!1,flipY:!1,rotation:0},C=function(e,t){var r;switch(void 0===e&&(e=O),t.type){case"SET_SETTING_COLOR":return w(w({},e),{color:t.color});case"SET_SETTING_BRUSH_WIDTH":return w(w({},e),{brushWidth:t.brushWidth});case"SET_SETTING_BRUSH_OPACITY":return w(w({},e),{brushOpacity:t.brushOpacity});case"SET_SETTING_FONT_SIZE":return w(w({},e),{fontSize:t.fontSize});case"SET_SETTING_FONT_FAMILY":return w(w({},e),{fontStyle:t.fontStyle});case _:return w(w({},e),{colorCorrection:w(w({},e.colorCorrection),(r={},r[t.filter]=t.value,r))});case"SET_SETTING_FILTER":return w(w({},e),{filter:w(w({},e.filter),{name:t.name})});case v:return w(w({},e),{filter:w(w({},e.filter),{value:t.value})});case"SET_SETTING_BLUR_ENABLE":return w(w({},e),{blur:w(w({},e.blur),{isEnabled:t.isEnabled})});case"SET_SETTING_BLUR_FORM":return w(w({},e),{blur:w(w({},e.blur),{form:t.form})});case g:return w(w({},e),{blur:w(w({},e.blur),{size:t.size})});case y:return w(w({},e),{blur:w(w({},e.blur),{position:t.position})});case"SET_SETTING_AUTO_CORRECTION":return w(w({},e),{isAutoCorrection:t.isAutoCorrection});case"SET_SETTING_CROP_ASPECT":return w(w({},e),{cropAspect:t.aspect});case"SET_SETTING_CROPPED":return w(w({},e),{isCropped:t.isCropped});case"SET_SETTING_FLIP_X":return w(w({},e),{flipX:t.value});case"SET_SETTING_FLIP_Y":return w(w({},e),{flipY:t.value});case"SET_SETTING_ROTATE":return w(w({},e),{rotation:t.value});default:return e}},x=function(){return(x=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var o in t=arguments[r])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)},P=function(){for(var e=0,t=0,r=arguments.length;t<r;t++)e+=arguments[t].length;var n=Array(e),o=0;for(t=0;t<r;t++)for(var a=arguments[t],i=0,s=a.length;i<s;i++,o++)n[o]=a[i];return n},R={currentIndex:null,items:[{canvas:document.createElement("canvas"),type:p.default.LAYER_TYPES.BACKGROUND,width:1,height:1,isBackground:!0,locked:!0,x:0,y:0,rotate:0,canDelete:!1,scale:1,avgColor:{r:128,g:128,b:128}}]},A=function(e,t){switch(void 0===e&&(e=R),t.type){case"SET_CURRENT_LAYER":return x(x({},e),{currentIndex:t.index});case"ADD_LAYER_STICKER":case"ADD_LAYER_TEXT":case"ADD_LAYER_IMAGE":return x(x({},e),{items:P(e.items,[t.payload])});case"SET_LAYER_POSITION":case"SET_LAYER_SCALE":case"SET_LAYER_COLOR":case E:case"SET_LAYER_FONT_STYLE":case"SET_LAYER_TEXT":case"TOGGLE_TEXT_EDITOR":return x(x({},e),{items:e.items.map((function(r,n){return e.currentIndex===n?x(x({},r),t.payload):r}))});case"START_LAYER_SCALE":return x({},e);case"UPDATE_BACKGROUND_LAYER":return x(x({},e),{items:e.items.map((function(e,r){return 0===r?x(x({},e),t.payload):e}))});case"DELETE_LAYER":return x(x({},e),{currentIndex:null,items:e.items.filter((function(e,r){return r!==t.index}))});case"UPDATE_LAYERS_AFTER_CROP":return x(x({},e),{items:t.items});default:return e}},N=function(){for(var e=0,t=0,r=arguments.length;t<r;t++)e+=arguments[t].length;var n=Array(e),o=0;for(t=0;t<r;t++)for(var a=arguments[t],i=0,s=a.length;i<s;i++,o++)n[o]=a[i];return n},L=function(e,t){switch(void 0===e&&(e=[]),t.type){case"ADD_VECTOR":return N(e,[t.payload]);case"UPDATE_DRAWING":return t.payload;default:return e}},I=function(){return(I=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var o in t=arguments[r])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)},D={currentBackgroundType:p.default.BACKGROUND_MODES.BACKGROUND,currentPhotoUrl:null,currentBackgroundId:1},k=function(e,t){switch(void 0===e&&(e=D),t.type){case"SET_CURRENT_BACKGROUND_TYPE":return I(I({},e),{currentBackgroundType:t.value});case"SET_CURRENT_PHOTO_URL":return I(I({},e),{currentPhotoUrl:t.value});case"SET_CURRENT_BACKGROUND_ID":return I(I({},e),{currentBackgroundId:t.value});default:return e}},M=function(){return(M=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var o in t=arguments[r])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)},j=function(e,t){switch(void 0===e&&(e={}),t.type){case"SET_DATA":return M(M({},e),t.payload);default:return e}},B=!1;var F=c()(Object(i.combineReducers)({ui:T,settings:C,layers:A,drawings:L,background:k,data:j}),{limit:100,syncFilter:!0,filter:Object(s.combineFilters)(Object(s.includeAction)([_,g,y,"SET_SETTING_BLUR_ENABLE","SET_SETTING_BLUR_FORM","SET_SETTING_AUTO_CORRECTION","SET_SETTING_FILTER",v,"ADD_LAYER_STICKER","ADD_LAYER_TEXT","DELETE_LAYER","ADD_VECTOR","SET_CURRENT_BACKGROUND_TYPE","SET_CURRENT_PHOTO_URL","SET_CURRENT_BACKGROUND_ID","SET_LAYER_COLOR",E,"SET_LAYER_FONT_STYLE","TOGGLE_TEXT_EDITOR","SET_SHOW_DROP_BOX","START_LAYER_SCALE"]),(function(e){return"TOGGLE_TEXT_EDITOR"===e.type?e.payload.isEdit:"SET_SHOW_DROP_BOX"===e.type?e.value:![_,v,g,y,E].includes(e.type)||(e.type!==m?(B=!1,m=e.type,!0):!B&&(B=!0,setTimeout((function(){B=!1}),500),!0))}))}),U=r("ufMw"),H=r("nAFc"),W=r("jE6c"),Y=function(e){return{type:"SET_CURRENT_LAYER",index:e}},G=function(e,t,r){return void 0===r&&(r=!0),function(n,o){var a=o().present.layers.items;n({type:e,payload:t}),r&&n(Y(a.length))}},z=function(e,t){return function(r,n){var o,a=n().present,i=a.data,s=a.settings,c=h(n()),u=i.artboardWidth/2,l=i.artboardHeight/2-c,d=Object(H.decodeHTMLEntities)(i.placeholders[Object(W.irand)(0,i.placeholders.length-1)]),f=0,m=!1,_=s.fontStyle,v=s.color,g=s.fontSize,y=1;t&&(u=void 0!==t.x?t.x:u,l=void 0!==t.y?t.y:l,d=void 0!==t.text?t.text:d,f=void 0!==t.rotate?t.rotate:f,m=void 0!==t.isEdit?t.isEdit:m,_=void 0!==t.style?t.style:_,v=void 0!==t.color?t.color:v,g=void 0!==t.fontSize?t.fontSize:g,o=t.initialFontSize,y=void 0!==t.scale?t.scale:y),Object(U.sendStat)(U.EVENTS.ADD_TEXT),e&&r($(p.default.TABS.TEXT)),r(G("ADD_LAYER_TEXT",{type:p.default.LAYER_TYPES.TEXT,text:d,x:u,y:l,rotate:f,isEdit:m,fontSize:g,initialFontSize:o,fontStyle:_,color:v,scale:y,canDelete:!0},e))}},V=function(e){return function(t,r){var n=r().present.layers,o=n.currentIndex,a=n.items;null!==o&&a[o]&&t({type:"TOGGLE_TEXT_EDITOR",payload:{isEdit:e}})}},X=function(e){return{type:"UPDATE_BACKGROUND_LAYER",payload:e}},K=function(){return function(e,t){var r=t().present.layers,n=r.currentIndex,o=r.items;if(null!==n){var a=o[n];a&&(a.type===p.default.LAYER_TYPES.STICKER?Object(U.sendStat)(U.EVENTS.DELETE_STICKER):a.type===p.default.LAYER_TYPES.TEXT&&Object(U.sendStat)(U.EVENTS.DELETE_TEXT),e(Z(!1)),e({type:"DELETE_LAYER",index:n}))}}},q=function(){return function(e,t){var r=t().present.layers,n=r.currentIndex,o=r.items;if(null!==n){var a=o[n];a&&a.type===p.default.LAYER_TYPES.TEXT&&(o[n].text.trim()?e(V(!1)):e(K()))}}},Z=function(e){return{type:"SET_SHOW_DROP_BOX",value:e}},$=function(e){return function(t,r){var n=r().present.layers,o=n.items,a=n.currentIndex;null!==a&&(o[a].type===p.default.LAYER_TYPES.TEXT&&t(q()),[p.default.TABS.PAINT,p.default.TABS.FILTERS,p.default.TABS.COLOR,p.default.TABS.CROP].includes(e)&&t(Y(null))),t({type:"SET_CURRENT_TAB",value:e})}},J=function(e){return function(t,r){var n=r().present.layers,o=n.currentIndex,a=n.items;o&&!a[o]||t(function(e){return function(t,r){var n=r().present.layers,o=n.currentIndex,a=n.items;null!==o&&a[o]&&t({type:"SET_LAYER_COLOR",payload:{color:e}})}}(e)),t({type:"SET_SETTING_COLOR",color:e})}},Q=function(e){return{type:"SET_SETTING_CROP_ASPECT",aspect:e}},ee=function(e){return{type:"SET_CURRENT_BACKGROUND_TYPE",value:e}},te=function(e){return{type:"SET_CURRENT_PHOTO_URL",value:e}},re=function(e){return{type:"SET_DATA",payload:e}},ne=function(e){return function(t){Object(a.batch)((function(){var r;e.hasOwnProperty("url")&&t(te(e.url)),e.hasOwnProperty("data")&&t(re(e.data)),e.hasOwnProperty("isCropped")&&t({type:"SET_SETTING_CROPPED",isCropped:e.isCropped}),e.hasOwnProperty("flipX")&&t((r=e.flipX,Object(U.sendStat)(U.EVENTS.FLIP_X),{type:"SET_SETTING_FLIP_X",value:r})),e.hasOwnProperty("flipY")&&t(function(e){return Object(U.sendStat)(U.EVENTS.FLIP_Y),{type:"SET_SETTING_FLIP_Y",value:e}}(e.flipY)),e.hasOwnProperty("rotate")&&t(function(e){return{type:"SET_SETTING_ROTATE",value:e}}(e.rotate)),e.hasOwnProperty("layers")&&t({type:"UPDATE_LAYERS_AFTER_CROP",items:e.layers}),e.hasOwnProperty("drawings")&&t(function(e){return{type:"UPDATE_DRAWING",payload:e}}(e.drawings))}))}},oe=r("i8i4");function ae(e){return new Promise((function(t,r){var n=new Image;n.crossOrigin="Anonymous",n.onerror=function(){r(new Error("Failed to load image's URL: "+e))},n.onload=function(){t(n)},n.src=e}))}function ie(e,t){if(!t)return{x:0,y:0,xOrigin:0,yOrigin:0,width:0,height:0};var r=t.getBoundingClientRect(),n=r.left,o=r.top,a=r.width,i=r.height;return{x:e.clientX-n,y:e.clientY-o,xOrigin:n,yOrigin:o,width:a,height:i}}function se(e,t){var r=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return r?"rgba("+parseInt(r[1],16)+", "+parseInt(r[2],16)+", "+parseInt(r[3],16)+", "+t+")":"rgba(0, 0, 0, 1)"}function ce(){return new Promise((function(e,t){var r=document.createElement("input");r.setAttribute("style","width: 0; height: 0; position: absolute; top: -1000px; left: -1000px; visibility: hidden"),r.value="",r.type="file",r.accept="image/*",r.onchange=function(r){var n=r.target;if(!n)return t();if(!n.files)return t();var o=n.files[0],a=URL.createObjectURL(o);ae(a).then((function(){(function(e){return new Promise((function(t){var r=new FileReader;r.onload=function(e){if(e.target){var r=e.target,n=new DataView(r.result);if(65496!=n.getUint16(0,!1))return t(-2);for(var o=n.byteLength,a=2;a<o;){if(n.getUint16(a+2,!1)<=8)return t(-1);var i=n.getUint16(a,!1);if(a+=2,65505==i){if(1165519206!=n.getUint32(a+=2,!1))return t(-1);var s=18761==n.getUint16(a+=6,!1);a+=n.getUint32(a+4,s);var c=n.getUint16(a,s);a+=2;for(var u=0;u<c;u++)if(274==n.getUint16(a+12*u,s))return t(n.getUint16(a+12*u+8,s))}else{if(65280!=(65280&i))break;a+=n.getUint16(a,!1)}}return t(-1)}},r.readAsArrayBuffer(e)}))})(o).then((function(r){-1===r||-2===r||1===r?e(a):function(e,t){return new Promise((function(r,n){var o=new Image;o.onload=function(){var e=o.width,a=o.height,i=document.createElement("canvas"),s=i.getContext("2d");if(!s)return n();switch(4<t&&t<9?(i.width=a,i.height=e):(i.width=e,i.height=a),t){case 2:s.transform(-1,0,0,1,e,0);break;case 3:s.transform(-1,0,0,-1,e,a);break;case 4:s.transform(1,0,0,-1,0,a);break;case 5:s.transform(0,1,1,0,0,0);break;case 6:s.transform(0,1,-1,0,a,0);break;case 7:s.transform(0,-1,-1,0,a,e);break;case 8:s.transform(0,-1,1,0,0,e)}s.drawImage(o,0,0),r(i.toDataURL())},o.src=e}))}(a,r).then((function(t){e(t)})).catch((function(){t()}))})).catch((function(){t()}))})).catch((function(){t()}))},r.onclick=function(){document.body.onfocus=function(){r.remove()}},document.body.appendChild(r),r.click()}))}function ue(e,t,r,n,o,a,i){var s=0,c=0;switch(e){case"left_top":s=n+a,c=o+i;break;case"left_center":s=n+a,c=r/2+i;break;case"left_bottom":s=n+a,c=r-o+i;break;case"center_top":s=t/2+a,c=o+i;break;case"center":s=t/2+a,c=r/2+i;break;case"center_bottom":s=t/2+a,c=r-o+i;break;case"right_top":s=t-n+a,c=o+i;break;case"right_center":s=t-n+a,c=r/2+i;break;case"right_bottom":s=t-n+a,c=r-o+i}return{x:s,y:c}}function le(e,t,r){var n=e.getContext("2d");n&&(n.clearRect(0,0,e.width,e.height),n.fillStyle="rgb(30, 30, 30)",n.fillRect(0,0,e.width,e.height),n.save(),n.filter="blur(135px)",n.drawImage(t,0,0,e.width,e.height),n.restore(),"none"!==n.filter&&(n.fillStyle="rgb("+r.r+", "+r.g+", "+r.b+")",n.fillRect(0,0,e.width,e.height)))}var pe,de=r("ZxpX"),fe=(pe=function(e,t){return(pe=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}pe(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),he=function(e){function t(t){var r=e.call(this,t)||this;return r.renderDrawings=function(){var e=r.props.drawings,t=r.canvas.current;if(t){var n=t.getContext("2d");if(n){var o=r.props.data.originalHeight/r.props.height;n.clearRect(0,0,t.width,t.height),n.lineCap="round",n.lineJoin="round",e.forEach((function(e){n.lineWidth=e.width*p.default.BRUSH_WIDTH_COEFFICIENT*o,n.strokeStyle=se(e.color,e.opacity),n.beginPath(),n.moveTo(e.path[0][0]*o,e.path[0][1]*o),e.path.forEach((function(e){n.lineTo(e[0]*o,e[1]*o)})),n.stroke()}))}}},r.drawStart=function(e){if(r.props.ui.currentMode===p.default.TABS.PAINT){window.addEventListener("mousemove",r.drawProcess),window.addEventListener("mouseup",r.drawFinish);var t=ie(e.nativeEvent,r.canvas.current),n=t.x,o=t.y;r.currentDrawing=[[n,o]];var a=r.props.settings;r.props.addDrawing({color:a.color,width:a.brushWidth,opacity:a.brushOpacity,path:r.currentDrawing}),r.renderDrawings()}},r.drawProcess=function(e){var t=ie(e,r.canvas.current),n=t.x,o=t.y;r.currentDrawing.push([n,o]),r.renderDrawings()},r.drawFinish=function(){window.removeEventListener("mousemove",r.drawProcess),window.removeEventListener("mouseup",r.drawFinish),r.currentDrawing=[]},r.canvas=n.createRef(),r.currentDrawing=[],r}return fe(t,e),t.prototype.render=function(){var e=this.props,t=e.data,r=e.width,o=e.height,a=e.ui,i=Object(de.classNames)("EditorCanvas__canvas","EditorCanvas__canvas--draw",{"EditorCanvas__canvas--disabled":a.currentMode!==p.default.TABS.PAINT});return n.createElement("canvas",{ref:this.canvas,className:i,onMouseDown:this.drawStart,width:t.originalWidth,height:t.originalHeight,style:{width:r,height:o}})},t.prototype.componentDidMount=function(){this.renderDrawings()},t.prototype.componentDidUpdate=function(){this.renderDrawings()},t}(n.PureComponent),me={addDrawing:function(e){return Object(U.sendStat)(U.EVENTS.ADD_GRAFFITI),{type:"ADD_VECTOR",payload:e}},addLayerText:z},_e=Object(a.connect)((function(e){return{ui:e.present.ui,settings:e.present.settings,drawings:e.present.drawings,data:e.present.data}}),me)(he),ve=new(function(){function e(){this.images={}}return e.prototype.get=function(e){var t=this;return new Promise((function(r,n){var o=t.images[e];o?r(o):ae(e).then((function(n){t.setImage(e,n),r(n)})).catch(n)}))},e.prototype.setImage=function(e,t){this.images[e]=t},e}()),ge="WebGL context not found",ye="Create texture failed",Ee="Shader compile failed",be="Create program failed",Se="Incomplete framebuffer",Te="Filter not found",we=function(e,t,r){var n=e.createShader(r);if(!n)throw new Error(Ee);if(e.shaderSource(n,t),e.compileShader(n),!e.getShaderParameter(n,e.COMPILE_STATUS))throw new Error(""+e.getShaderInfoLog(n));this.shader=n},Oe=function(){function e(e,t,r){if(!e)throw new Error(ge);var n=e.createTexture();if(!n)throw new Error(ye);this.texture=n,e.bindTexture(e.TEXTURE_2D,n),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),t&&r&&this.updateSize(e,t,r),e.bindTexture(e.TEXTURE_2D,null)}return e.prototype.attachImage=function(e,t){e.bindTexture(e.TEXTURE_2D,this.texture),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,t),e.bindTexture(e.TEXTURE_2D,null)},e.prototype.updateSize=function(e,t,r){e.bindTexture(e.TEXTURE_2D,this.texture),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,t,r,0,e.RGBA,e.UNSIGNED_BYTE,null),e.bindTexture(e.TEXTURE_2D,null)},e.prototype.use=function(e,t){e.activeTexture(e.TEXTURE0+t),e.bindTexture(e.TEXTURE_2D,this.texture)},e.unuse=function(e,t){e.activeTexture(e.TEXTURE0+t),e.bindTexture(e.TEXTURE_2D,null)},e.prototype.destroy=function(e){e.deleteTexture(this.texture)},e}(),Ce=r("t7n3"),xe=function(){function e(e,t,r){if(!e)throw new Error(ge);var n=new we(e,t,e.VERTEX_SHADER).shader,o=new we(e,r,e.FRAGMENT_SHADER).shader;this.gl=e,this.program=this.createProgram(n,o),this.framebuffer=e.createFramebuffer()}return e.prototype.createProgram=function(e,t){var r=this.gl.createProgram();if(!r)throw new Error(be);if(this.gl.attachShader(r,e),this.gl.attachShader(r,t),this.gl.linkProgram(r),!this.gl.getProgramParameter(r,this.gl.LINK_STATUS))throw new Error(""+this.gl.getProgramInfoLog(r));return r},e.prototype.destroy=function(){this.gl.deleteProgram(this.program)},e.prototype.attribute=function(e,t){var r=this.gl.getAttribLocation(this.program,e),n=this.gl.createBuffer();this.gl.bindBuffer(this.gl.ARRAY_BUFFER,n),this.gl.bufferData(this.gl.ARRAY_BUFFER,new Float32Array(t),this.gl.STATIC_DRAW),this.gl.enableVertexAttribArray(r),this.gl.vertexAttribPointer(r,2,this.gl.FLOAT,!1,0,0)},e.prototype.uniforms=function(e){for(var t in this.gl.useProgram(this.program),e)if(e.hasOwnProperty(t)){var r=this.gl.getUniformLocation(this.program,t),n=e[t];if(Array.isArray(n))switch(n.length){case 1:this.gl.uniform1fv(r,new Float32Array(n));break;case 2:this.gl.uniform2fv(r,new Float32Array(n));break;case 3:this.gl.uniform3fv(r,new Float32Array(n));break;case 4:this.gl.uniform4fv(r,new Float32Array(n))}else Object(Ce.isNumber)(n)&&this.gl.uniform1f(r,n)}},e.prototype.textures=function(e,t){var r=this;this.gl.useProgram(this.program),e.forEach((function(e,n){t?(e.use(r.gl,n),r.gl.uniform1i(r.gl.getUniformLocation(r.program,"u_image"+n),n)):Oe.unuse(r.gl,n)}))},e.prototype.draw=function(e,t){this.gl.useProgram(this.program),t&&(t.updateSize(this.gl,e.width,e.height),this.bindTexture(t.texture)),this.gl.canvas.width=e.width,this.gl.canvas.height=e.height,this.gl.viewport(0,0,this.gl.drawingBufferWidth,this.gl.drawingBufferHeight);var r=e.width,n=e.height;this.attribute("a_position",[0,0,r,0,0,n,0,n,r,0,r,n]),this.attribute("a_texCoord",[0,0,1,0,0,1,0,1,1,0,1,1]),this.uniforms(Object.assign(e.uniforms,{u_resolution:[e.width,e.height]})),e.textures&&this.textures(e.textures,!0),this.gl.clearColor(0,0,0,0),this.gl.clear(this.gl.COLOR_BUFFER_BIT),this.gl.drawArrays(this.gl.TRIANGLE_STRIP,0,6),e.textures&&this.textures(e.textures,!1),t&&this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,null)},e.prototype.bindTexture=function(e,t){if(this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,this.framebuffer),this.gl.framebufferTexture2D(this.gl.FRAMEBUFFER,this.gl.COLOR_ATTACHMENT0,this.gl.TEXTURE_2D,e,0),t){var r=this.gl.checkFramebufferStatus(this.gl.FRAMEBUFFER);if(r!==this.gl.FRAMEBUFFER_COMPLETE){var n="";switch(r){case this.gl.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:n="The attachment types are mismatched or not all framebuffer attachment points are framebuffer attachment complete.";break;case this.gl.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:n="There is no attachment.";break;case this.gl.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:n="Height and width of the attachment are not the same.";break;case this.gl.FRAMEBUFFER_UNSUPPORTED:n="The format of the attachment is not supported or if depth and stencil attachments are not the same renderbuffer."}throw new Error(Se+". "+n)}}},e}(),Pe="attribute vec2 a_position;\nattribute vec2 a_texCoord;\n\nuniform vec2 u_resolution;\n\nvarying vec2 v_texCoord;\n\nvoid main() {\n\t// convert the rectangle from pixels to 0.0 to 1.0\n\tvec2 zeroToOne = a_position / u_resolution;\n\n\t// convert from 0->1 to 0->2\n\tvec2 zeroToTwo = zeroToOne * 2.0;\n\n\t// convert from 0->2 to -1->+1 (clipspace)\n\tvec2 clipSpace = zeroToTwo - 1.0;\n\n\tgl_Position = vec4(clipSpace * vec2(1, -1), 0, 1);\n\n\t// pass the texCoord to the fragment shader\n\t// The GPU will interpolate this value between points.\n\tv_texCoord = a_texCoord;\n}\n",Re=function(){for(var e=0,t=0,r=arguments.length;t<r;t++)e+=arguments[t].length;var n=Array(e),o=0;for(t=0;t<r;t++)for(var a=arguments[t],i=0,s=a.length;i<s;i++,o++)n[o]=a[i];return n},Ae={regular:"/images/filters/maps/regular.png",nox:"/images/filters/maps/nox.png",vesper:"/images/filters/maps/vesper.png",latona:"/images/filters/maps/latona.png",liber:"/images/filters/maps/liber.png",luna:"/images/filters/maps/luna.png",minerva:"/images/filters/maps/minerva.png",mitra:"/images/filters/maps/mitra.png",pro:"/images/filters/maps/pro.png",terra:"/images/filters/maps/terra.png",veles:"/images/filters/maps/veles.png",vesta:"/images/filters/maps/vesta.png",zaria:"/images/filters/maps/zaria.png",sepia:"/images/filters/maps/sepia.png",genius:"/images/filters/maps/genius.png",horus:"/images/filters/maps/horus.png",fortuna:"/images/filters/maps/fortuna.png"},Ne=["/images/filters/maps/contrast_negative.png","/images/filters/maps/contrast_positive.png","/images/filters/maps/exposure_negative.png","/images/filters/maps/exposure_positive.png","/images/filters/maps/warm_negative_lut.png","/images/filters/maps/warm_positive_lut.png"];var Le=function(){for(var e=0,t=0,r=arguments.length;t<r;t++)e+=arguments[t].length;var n=Array(e),o=0;for(t=0;t<r;t++)for(var a=arguments[t],i=0,s=a.length;i<s;i++,o++)n[o]=a[i];return n},Ie={preserveDrawingBuffer:!0,premultipliedAlpha:!1},De=document.createElement("canvas"),ke=De.getContext("webgl",Ie)||De.getContext("experimental-webgl",Ie),Me={},je=function(){function e(){this.baseColorCorrectionProgram=new xe(ke,Pe,"precision mediump float;\n\nvarying vec2 v_texCoord;\n\nuniform sampler2D u_image0; // image\nuniform sampler2D u_image1; // contrast_negative.png\nuniform sampler2D u_image2; // contrast_positive.png\nuniform sampler2D u_image3; // exposure_negative.png\nuniform sampler2D u_image4; // exposure_positive.png\nuniform sampler2D u_image5; // warm_negative_lut.png\nuniform sampler2D u_image6; // warm_positive_lit.png\nuniform sampler2D u_image7; // color table\n\nuniform float u_exposure;\nuniform float u_contrast;\nuniform float u_saturation;\nuniform float u_warmth;\nuniform float u_amount;\n\nvec3 ContrastSaturationBrightness(vec3 color, float brt, float sat, float con) {\n\tconst float AvgLumR = 0.5;\n\tconst float AvgLumG = 0.5;\n\tconst float AvgLumB = 0.5;\n\n\tconst vec3 LumCoeff = vec3(0.2125, 0.7154, 0.0721);\n\n\tvec3 AvgLumin = vec3(AvgLumR, AvgLumG, AvgLumB);\n\tvec3 brtColor = color * brt;\n\tvec3 intensity = vec3(dot(brtColor, LumCoeff));\n\tvec3 satColor = mix(intensity, brtColor, sat);\n\tvec3 conColor = mix(AvgLumin, satColor, con);\n\n\treturn conColor;\n}\n\nfloat BF_SoftLight(float base, float blend) {\n\treturn 2.0 * base * blend + base * base * (1.0 - 2.0 * blend);\n}\n\nvec3 BF_SoftLight(vec3 base, vec3 blend) {\n\treturn vec3(BF_SoftLight(base.r, blend.r), BF_SoftLight(base.g, blend.g), BF_SoftLight(base.b, blend.b));\n}\n\nvec3 Exposure(vec3 view, float intensity) {\n\tvec3 exposure1;\n\texposure1.r = texture2D(u_image3, vec2(view.r, 0.5)).r;\n\texposure1.g = texture2D(u_image3, vec2(view.g, 0.5)).g;\n\texposure1.b = texture2D(u_image3, vec2(view.b, 0.5)).b;\n\n\tvec3 exposure2;\n\texposure2.r = texture2D(u_image4, vec2(view.r, 0.5)).r;\n\texposure2.g = texture2D(u_image4, vec2(view.g, 0.5)).g;\n\texposure2.b = texture2D(u_image4, vec2(view.b, 0.5)).b;\n\n\tvec3 result;\n\tif (intensity >= 0.0) {\n\t\tresult = mix(view, exposure2, intensity);\n\t} else {\n\t\tresult = mix(view, exposure1, -intensity);\n\t}\n\n\treturn result;\n}\n\nvec3 Contrast(vec3 view, float intensity) {\n\tvec3 contrast1;\n\tcontrast1.r = texture2D(u_image1, vec2(view.r, 0.5)).r;\n\tcontrast1.g = texture2D(u_image1, vec2(view.g, 0.5)).g;\n\tcontrast1.b = texture2D(u_image1, vec2(view.b, 0.5)).b;\n\n\tvec3 contrast2;\n\tcontrast2.r = texture2D(u_image2, vec2(view.r, 0.5)).r;\n\tcontrast2.g = texture2D(u_image2, vec2(view.g, 0.5)).g;\n\tcontrast2.b = texture2D(u_image2, vec2(view.b, 0.5)).b;\n\n\tvec3 result;\n\tif (intensity >= 0.0) {\n\t\tresult = mix(view, contrast2, intensity);\n\t} else {\n\t\tresult = mix(view, contrast1, -intensity);\n\t}\n\n\treturn result;\n}\n\nvec3 ColorTemp(vec3 view, float intensity) {\n\tfloat blueColor = view.b * 63.0;\n\n\tvec2 quad1;\n\tquad1.y = floor(floor(blueColor) / 8.0);\n\tquad1.x = floor(blueColor) - (quad1.y * 8.0);\n\n\tvec2 quad2;\n\tquad2.y = floor(ceil(blueColor) / 8.0);\n\tquad2.x = ceil(blueColor) - (quad2.y * 8.0);\n\n\tvec2 texPos1;\n\ttexPos1.x = (quad1.x * 0.125) + 0.5 / 960.0 + ((0.125 - 1.0 / 960.0) * view.r);\n\ttexPos1.y = (quad1.y * 0.125) + 0.5 / 960.0 + ((0.125 - 1.0 / 960.0) * view.g);\n\n\tvec2 texPos2;\n\ttexPos2.x = (quad2.x * 0.125) + 0.5 / 960.0 + ((0.125 - 1.0 / 960.0) * view.r);\n\ttexPos2.y = (quad2.y * 0.125) + 0.5 / 960.0 + ((0.125 - 1.0 / 960.0) * view.g);\n\n\tvec3 coldColor1 = texture2D(u_image5, texPos1).rgb;\n\tvec3 coldColor2 = texture2D(u_image5, texPos2).rgb;\n\tvec3 coldColor = mix(coldColor1, coldColor2, fract(blueColor));\n\n\tvec3 warmColor1 = texture2D(u_image6, texPos1).rgb;\n\tvec3 warmColor2 = texture2D(u_image6, texPos2).rgb;\n\tvec3 warmColor = mix(warmColor1, warmColor2, fract(blueColor));\n\n\tvec3 result;\n\n\tif (intensity >= 0.0) {\n\t\tresult = mix(view, warmColor, intensity);\n\t} else {\n\t\tresult = mix(view, coldColor, -intensity);\n\t}\n\n\treturn result;\n}\n\nvec3 Saturation(vec3 view, float intensity) {\n\treturn ContrastSaturationBrightness(view, 1.0, intensity, 1.0);\n}\n\nvec3 Lut(vec3 view, sampler2D tex, float intensity) {\n\tfloat blueColor = view.b * 63.0;\n\n\tvec2 quad1;\n\tquad1.y = floor(floor(blueColor) / 8.0);\n\tquad1.x = floor(blueColor) - (quad1.y * 8.0);\n\n\tvec2 quad2;\n\tquad2.y = floor(ceil(blueColor) / 8.0);\n\tquad2.x = ceil(blueColor) - (quad2.y * 8.0);\n\n\tvec2 texPos1;\n\ttexPos1.x = (quad1.x * 0.125) + 0.5 / 512.0 + ((0.125 - 1.0 / 512.0) * view.r);\n\ttexPos1.y = (quad1.y * 0.125) + 0.5 / 512.0 + ((0.125 - 1.0 / 512.0) * view.g);\n\n\tvec2 texPos2;\n\ttexPos2.x = (quad2.x * 0.125) + 0.5 / 512.0 + ((0.125 - 1.0 / 512.0) * view.r);\n\ttexPos2.y = (quad2.y * 0.125) + 0.5 / 512.0 + ((0.125 - 1.0 / 512.0) * view.g);\n\n\tvec3 newColor1 = texture2D(tex, texPos1).rgb;\n\tvec3 newColor2 = texture2D(tex, texPos2).rgb;\n\n\tvec3 newColor = mix(newColor1, newColor2, fract(blueColor));\n\tvec3 color = mix(view, newColor, intensity);\n\n\treturn color;\n}\n\n// [-1.0; 1.0]\nvec3 pExposure(vec3 view, float intensity) {\n\tintensity = clamp(intensity, -1.0, 1.0);\n\treturn Exposure(view, intensity);\n}\n\n// [-1.0; 1.0]\nvec3 pContrast(vec3 view, float intensity) {\n\tintensity = clamp(intensity, -1.0, 1.0);\n\treturn Contrast(view, intensity);\n}\n\n// [-1.0; 1.0]\nvec3 pColorTemp(vec3 view, float intensity) {\n\tintensity = clamp(intensity, -1.0, 1.0);\n\treturn ColorTemp(view, intensity);\n}\n\n// [-1.0; 1.0]\nvec3 pSaturation(vec3 view, float intensity) {\n\tvec2 range = vec2(0.0, 1.6);\n\tintensity = clamp(intensity, -1.0, 1.0);\n\tintensity = (intensity >= 0.0) ? 1.0 + (range.y - 1.0) * intensity : range.x + (1.0 - range.x) * (intensity + 1.0);\n\treturn Saturation(view, intensity);\n}\n\n// [0.0; 1.0]\nvec3 pLut(vec3 view,sampler2D tex, float intensity) {\n\tvec2 range = vec2(0.0, 1.0);\n\tintensity = clamp(intensity, 0.0, 1.0);\n\treturn Lut(view, tex, intensity);\n}\n\nvoid main() {\n\t// Хак для того, чтобы перевернуть текстуру\n\tvec2 texelCoord = v_texCoord;\n\ttexelCoord.y = 1. - texelCoord.y;\n\n\tvec4 texture = texture2D(u_image0, texelCoord);\n\n\ttexture.rgb = pColorTemp(texture.rgb, u_warmth);\n\ttexture.rgb = pLut(texture.rgb, u_image7, u_amount);\n\ttexture.rgb = pExposure(texture.rgb, u_exposure);\n\ttexture.rgb = pContrast(texture.rgb, u_contrast);\n\ttexture.rgb = pSaturation(texture.rgb, u_saturation);\n\n\tgl_FragColor = texture;\n}\n"),this.postProcessProgram=new xe(ke,Pe,"precision mediump float;\n\nvarying vec2 v_texCoord;\n\nuniform sampler2D u_image0;\n\nuniform float u_vignette;\nuniform float u_sharpness;\nuniform float u_grain;\n\nuniform vec2 u_sourceSize;\n\nvec4 rnm(in vec2 tc) {\n\tfloat timer = 0.4;\n\tfloat noise = sin(dot(tc + vec2(timer, timer), vec2(12.9898, 78.233))) * 43758.5453;\n\n\tfloat noiseR = fract(noise) * 2.0 - 1.0;\n\tfloat noiseG = fract(noise * 1.2154) * 2.0 - 1.0;\n\tfloat noiseB = fract(noise * 1.3453) * 2.0 - 1.0;\n\tfloat noiseA = fract(noise * 1.3647) * 2.0 - 1.0;\n\n\treturn vec4(noiseR,noiseG,noiseB,noiseA);\n}\n\nfloat fade(in float t) {\n\treturn t * t * t * (t * (t * 6.0 - 15.0) + 10.0);\n}\n\nfloat pnoise3D(in vec3 p) {\n\tvec3 pi = 0.00195313 * floor(p) + 0.00195313;\n\tvec3 pf = fract(p); // Fractional part for interpolation\n\n\t// Noise contributions from (x=0, y=0), z=0 and z=1\n\tfloat perm00 = rnm(pi.xy).a ;\n\tvec3  grad000 = rnm(vec2(perm00, pi.z)).rgb * 4.0 - 1.0;\n\tfloat n000 = dot(grad000, pf);\n\tvec3  grad001 = rnm(vec2(perm00, pi.z + 0.00195313)).rgb * 4.0 - 1.0;\n\tfloat n001 = dot(grad001, pf - vec3(0.0, 0.0, 1.0));\n\n\t// Noise contributions from (x=0, y=1), z=0 and z=1\n\tfloat perm01 = rnm(pi.xy + vec2(0.0, 0.00195313)).a ;\n\tvec3  grad010 = rnm(vec2(perm01, pi.z)).rgb * 4.0 - 1.0;\n\tfloat n010 = dot(grad010, pf - vec3(0.0, 1.0, 0.0));\n\tvec3  grad011 = rnm(vec2(perm01, pi.z + 0.00195313)).rgb * 4.0 - 1.0;\n\tfloat n011 = dot(grad011, pf - vec3(0.0, 1.0, 1.0));\n\n\t// Noise contributions from (x=1, y=0), z=0 and z=1\n\tfloat perm10 = rnm(pi.xy + vec2(0.00195313, 0.0)).a ;\n\tvec3  grad100 = rnm(vec2(perm10, pi.z)).rgb * 4.0 - 1.0;\n\tfloat n100 = dot(grad100, pf - vec3(1.0, 0.0, 0.0));\n\tvec3  grad101 = rnm(vec2(perm10, pi.z + 0.00195313)).rgb * 4.0 - 1.0;\n\tfloat n101 = dot(grad101, pf - vec3(1.0, 0.0, 1.0));\n\n\t// Noise contributions from (x=1, y=1), z=0 and z=1\n\tfloat perm11 = rnm(pi.xy + vec2(0.00195313, 0.00195313)).a ;\n\tvec3  grad110 = rnm(vec2(perm11, pi.z)).rgb * 4.0 - 1.0;\n\tfloat n110 = dot(grad110, pf - vec3(1.0, 1.0, 0.0));\n\tvec3  grad111 = rnm(vec2(perm11, pi.z + 0.00195313)).rgb * 4.0 - 1.0;\n\tfloat n111 = dot(grad111, pf - vec3(1.0, 1.0, 1.0));\n\n\t// Blend contributions along x\n\tvec4 n_x = mix(vec4(n000, n001, n010, n011), vec4(n100, n101, n110, n111), fade(pf.x));\n\n\t// Blend contributions along y\n\tvec2 n_xy = mix(n_x.xy, n_x.zw, fade(pf.y));\n\n\t// Blend contributions along z\n\tfloat n_xyz = mix(n_xy.x, n_xy.y, fade(pf.z));\n\n\t// We're done, return the final noise value.\n\treturn n_xyz;\n}\n\n//2d coordinate orientation thing\nvec2 coordRot(in vec2 tc, in float angle) {\n\tfloat aspect = u_sourceSize.x / u_sourceSize.y;\n\tvec2 uv = (tc * 2.0) - 1.0;\n\tfloat rotX = (uv.x * aspect * cos(angle)) - (uv.y * sin(angle));\n\tfloat rotY = (uv.y * cos(angle)) + (uv.x * aspect * sin(angle));\n\trotX = ((rotX / aspect) * 0.5 + 0.5);\n\trotY = rotY * 0.5 + 0.5;\n\treturn vec2(rotX, rotY);\n}\n\nvec3 BF_Multiply(vec3 base, vec3 blend) {\n\treturn base * blend;\n}\n\nfloat BF_Screen(float base, float blend) {\n\treturn 1.0 - ((1.0 - base) * (1.0 - blend));\n}\n\nvec3 BF_Screen(vec3 base, vec3 blend) {\n\treturn 1.0 - ((1.0 - base) * (1.0 - blend));\n}\n\nvec3 Sharpness(vec3 view, float intensity) {\n\tvec2 uv = v_texCoord;\n\tvec2 step = 1.0 / u_sourceSize;\n\n\tvec3 texA = texture2D(u_image0, uv + vec2(-step.x, -step.y) * 1.0).rgb;\n\tvec3 texB = texture2D(u_image0, uv + vec2( step.x, -step.y) * 1.0).rgb;\n\tvec3 texC = texture2D(u_image0, uv + vec2(-step.x,  step.y) * 1.0).rgb;\n\tvec3 texD = texture2D(u_image0, uv + vec2( step.x,  step.y) * 1.0).rgb;\n\n\tvec3 around = 0.25 * (texA + texB + texC + texD);\n\tvec3 center  = texture2D(u_image0, uv ).rgb;\n\tvec3 col = center + (center - around) * intensity;\n\n\treturn col;\n}\n\nvec3 Grain(vec3 view, float intensity) {\n\tvec2 texCoord = v_texCoord;\n\n\tfloat timer = 0.4;\n\tfloat coloramount = 0.4;\n\tfloat grainsize = 2.0;\n\tfloat lumamount = 0.3;\n\n\tbool colored = true;\n\n\tvec3 rotOffset = vec3(1.425, 3.892, 5.835); // rotation offset values\n\tvec2 rotCoordsR = coordRot(texCoord, timer + rotOffset.x);\n\tvec3 noise = vec3(pnoise3D(vec3(rotCoordsR * vec2(u_sourceSize.x / grainsize, u_sourceSize.y / grainsize), 0.0)));\n\n\tif (colored) {\n\t\tvec2 rotCoordsG = coordRot(texCoord, timer + rotOffset.y);\n\t\tvec2 rotCoordsB = coordRot(texCoord, timer + rotOffset.z);\n\t\tnoise.g = mix(noise.r, pnoise3D(vec3(rotCoordsG * vec2(u_sourceSize.x / grainsize, u_sourceSize.y / grainsize), 1.0)), coloramount);\n\t\tnoise.b = mix(noise.r, pnoise3D(vec3(rotCoordsB * vec2(u_sourceSize.x / grainsize, u_sourceSize.y / grainsize), 2.0)), coloramount);\n\t}\n\n\tvec3 col = view.rgb;\n\tvec3 lumcoeff = vec3(0.299, 0.587, 0.114);\n\tfloat luminance = lumamount * dot(col, lumcoeff);\n\tfloat lum = smoothstep(0.2, 0.0, luminance);\n\n\tlum += luminance;\n\tnoise = mix(noise, vec3(0.0), pow(lum, 4.0));\n\tcol = col + noise * intensity;\n\n\treturn col;\n}\n\nvec3 Vignette(vec3 view, float intensity) {\n\tfloat inten = abs(intensity);\n\tfloat dist = distance(v_texCoord, vec2(0.5, 0.5));\n\tfloat size = 0.5 - inten * 0.4;\n\tfloat amount = inten * inten * 0.1 + 0.5 * inten;\n\tfloat vignette = smoothstep(0.8, size * 0.799, dist * (amount + size));\n\treturn (intensity >= 0.0) ? view * vignette : BF_Screen(view,vec3(1.0-vignette));\n}\n\n// [-1; 1]\nvec3 pSharpness(vec3 view, float intensity) {\n\tvec2 range = vec2(0.0, 1.5);\n\tintensity = clamp(intensity, 0.0, 1.0);\n\tintensity = (intensity >= 0.0) ? range.y * intensity : -range.x * (intensity+1.0) + range.x;\n\treturn Sharpness(view, intensity);\n}\n\n// [0; 1]\nvec3 pGrain(vec3 view, float intensity) {\n\tvec2 range = vec2(0.0, 0.2);\n\n\tintensity = clamp(intensity, 0.0, 1.0);\n\tintensity = (intensity >= 0.0) ? range.y * intensity : -range.x * (intensity + 1.0) + range.x;\n\treturn Grain(view, intensity);\n}\n\n// [-1; 1]\nvec3 pVignette(vec3 view, float intensity) {\n\tvec2 range = vec2(-1.0, 1.0);\n\tintensity = clamp(intensity, -1.0, 1.0);\n\tintensity = (intensity >= 0.0) ? range.y * intensity : -range.x * (intensity + 1.0) + range.x;\n\treturn Vignette(view, intensity);\n}\n\nvoid main() {\n\tvec4 texture = texture2D(u_image0, v_texCoord);\n\n\ttexture.rgb = pSharpness(texture.rgb, u_sharpness);\n\ttexture.rgb = pVignette(texture.rgb, u_vignette);\n\ttexture.rgb = pGrain(texture.rgb, u_grain);\n\n\tgl_FragColor = texture;\n}\n"),this.flippedProgram=new xe(ke,Pe,"precision mediump float;\n\nuniform sampler2D u_texture;\nvarying vec2 v_texCoord;\n\nvoid main() {\n\tvec4 color = texture2D(u_texture, vec2(v_texCoord.x, 1.0 - v_texCoord.y));\n\tgl_FragColor = color;\n}\n"),this.triangleBlurProgram=new xe(ke,Pe,"precision mediump float;\n\nuniform sampler2D u_image0; // original image\nuniform vec2 u_delta;\n\nvarying vec2 v_texCoord;\n\nvoid main() {\n\tvec4 color = vec4(0.0);\n\tfloat total = 0.0;\n\tfloat offset = fract(sin(dot(gl_FragCoord.xyz, vec3(12.9898, 78.233, 151.7182))) * 43758.5453);\n\n\tfor (float t = -30.0; t <= 30.0; t++) {\n\t\tfloat percent = (t + offset - 0.5) / 30.0;\n\t\tfloat weight = 1.0 - abs(percent);\n\t\tvec4 sampleColor = texture2D(u_image0, v_texCoord + u_delta * percent);\n\t\tsampleColor.rgb *= sampleColor.a;\n\n\t\tcolor += sampleColor * weight;\n\t\ttotal += weight;\n\t}\n\n\tcolor = color / total;\n\tcolor.rgb /= color.a + 0.00001;\n\tgl_FragColor = color;\n}\n"),this.roundBlurProgram=new xe(ke,Pe,"precision mediump float;\n\nuniform sampler2D u_image0; // blurred image\nuniform sampler2D u_image1; // original image\nuniform vec2 u_position;\n\nvarying vec2 v_texCoord;\n\nvoid main() {\n\t// Хак для того, чтобы перевернуть текстуру\n\tvec2 texelCoord = v_texCoord;\n\ttexelCoord.y = 1. - texelCoord.y;\n\n\tvec4 color = texture2D(u_image0, texelCoord);\n\tfloat distanceFromCenter = distance(u_position, texelCoord);\n\n\tcolor = mix(texture2D(u_image1, texelCoord), color, clamp(smoothstep(0.3 - 0.2, 0.3, distanceFromCenter), 0.0, 1.0));\n\tgl_FragColor = color;\n}\n"),this.squareBlurProgram=new xe(ke,Pe,"precision mediump float;\n\nuniform sampler2D u_image0; // blurred image\nuniform sampler2D u_image1; // original image\nuniform vec2 u_position;\n\nvarying vec2 v_texCoord;\n\nvoid main() {\n\t// Хак для того, чтобы перевернуть текстуру\n\tvec2 texelCoord = v_texCoord;\n\ttexelCoord.y = 1. - texelCoord.y;\n\n\tvec4 color = texture2D(u_image0, texelCoord);\n\tvec2 realPosition = u_position;\n\trealPosition.x = texelCoord.x;\n\n\tfloat distanceFromCenter = distance(realPosition, texelCoord);\n\tcolor = mix(texture2D(u_image1, texelCoord), color, clamp(smoothstep(0.2 - 0.1, 0.2, distanceFromCenter), 0.0, 1.0));\n\n\tgl_FragColor = color;\n}\n"),this.colorCorrectionTexture=new Oe(ke),this.postProcessTexture=new Oe(ke),this.blurTexture1=new Oe(ke),this.blurTexture2=new Oe(ke),this.resultBlurTexture=new Oe(ke)}return e.getOrCreateTexture=function(t,r,n){var o=n?r.src+"_auto":r.src;if(!Me[o]){var a=void 0;a=n?e.getAuto(r):r;var i=new Oe(t);i.attachImage(t,a),Me[o]=i}return Me[o]},e.loadTextures=function(t,r){return new Promise((function(n){var o=[],a=r.map((function(e){return ve.get(e)}));Promise.all(a).then((function(r){r.forEach((function(r){var n=e.getOrCreateTexture(t,r);o.push(n)})),n(o)})).catch((function(){}))}))},e.getAuto=function(e){var t=document.createElement("canvas"),r=t.getContext("2d");if(!r)return t;t.width=e.width,t.height=e.height,r.drawImage(e,0,0,e.width,e.height);var n=e.width*e.height,o=r.getImageData(0,0,e.width,e.height),a=o.data;function i(e,t,r,n){t+r>=e&&(t=(e-1)/2,r=(e-1)/2);var o=function(e,t,r,n){for(var o,i=[],s=0;s<256;s++)i.push(0);for(o=0;o<e;o++)i[a[4*o+n]]+=1;for(o=1;o<256;o++)i[o]+=i[o-1];var c={};for(o=0;o<256&&i[o]<=t;)o++;for(c.min=o,o=255;o<256&&i[o]>e-r;)o--;return o<255&&o++,c.max=o,c}(e,t,r,n);!function(e,t,r,n){var o,i;if(r<=t)for(o=0;o<e;o++)a[(i=4*o)+n]=127.5;else{var s=new Array(256);for(o=0;o<t;o++)s[o]=0;for(o=t;o<r;o++)s[o]=255*(o-t)/(r-t)+.5;for(o=r;o<256;o++)s[o]=255;for(o=0;o<e;o++)a[(i=4*o)+n]=s[a[i+n]]}}(e,o.min,o.max,n)}!function(e,t,r){i(e,t,r,0),i(e,t,r,1),i(e,t,r,2)}(n,.01*n,.01*n),r.putImageData(o,0,0);var s=document.createElement("canvas");return s.width=e.width,s.height=e.height,null==(r=s.getContext("2d"))||r.drawImage(t,0,0,t.width,t.height),t},e.prototype.render=function(t,r,n,o,a,i,s){var c=this;return void 0===a&&(a={}),new Promise((function(u){requestAnimationFrame((function(){if(!ke)throw new Error(ge);var l=function(e){var t=Ae[e];if(t)return Re(Ne,[t])}(o);if(!l)throw new Error(Te);var d=e.getOrCreateTexture(ke,n,s);e.loadTextures(ke,l).then((function(e){var n=c.postProcessTexture;if(c.baseColorCorrectionProgram.draw({width:t,height:r,uniforms:{u_exposure:a.exposure,u_contrast:a.contrast,u_warmth:a.warmth,u_saturation:a.saturation,u_amount:a.amount},textures:Le([d],e)},c.colorCorrectionTexture),c.postProcessProgram.draw({width:t,height:r,uniforms:{u_vignette:a.vignette,u_sharpness:a.sharpness,u_sourceSize:a.sourceSize,u_grain:a.grain},textures:[c.colorCorrectionTexture]},c.postProcessTexture),i&&i.isEnabled){var o=i.form===p.default.BLUR_TYPES.ROUND?c.roundBlurProgram:c.squareBlurProgram;c.triangleBlurProgram.draw({width:t,height:r,uniforms:{u_delta:[i.size/t,0]},textures:[c.postProcessTexture]},c.blurTexture1),c.triangleBlurProgram.draw({width:t,height:r,uniforms:{u_delta:[0,i.size/r]},textures:[c.blurTexture1]},c.blurTexture2),o.draw({width:t,height:r,uniforms:{u_position:i.position},textures:[c.blurTexture2,c.postProcessTexture]},c.resultBlurTexture),n=c.resultBlurTexture}return c.flippedProgram.draw({width:t,height:r,uniforms:{},textures:[n]}),u(De)})).catch((function(e){console.error(new Error(e))}))}))}))},e}(),Be=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),Fe={},Ue=function(e){function t(t){var r=e.call(this,t)||this;return r.canvas=n.createRef(),r.renderer=new je,r.needUpdateSize=!0,r}return Be(t,e),t.prototype.componentDidMount=function(){this.update()},t.prototype.componentDidUpdate=function(e){var t=this.props,r=t.originalWidth,n=t.originalHeight,o=t.background,a=r!==e.originalWidth||n!==e.originalHeight;this.needUpdateSize=a||JSON.stringify(o)!==JSON.stringify(e.background),this.update()},t.prototype.render=function(){var e=this.props,t=e.originalWidth,r=e.originalHeight;return n.createElement("canvas",{ref:this.canvas,className:"EditorCanvas__canvas EditorCanvas__canvas--bg",width:t,height:r,style:{width:this.props.width,height:this.props.height}})},t.prototype.update=function(){var e=this,t=this.props.currentBackgroundUrl;t&&ve.get(t).then((function(t){e.renderImage(t)})).catch((function(e){console.error(e)}))},t.prototype.renderImage=function(e){var t=this,r=this.canvas.current;if(r&&r.getContext("2d")){var n=this.props.background,o=this.props,a=o.colorCorrection,i=o.filter,s=o.blur,c=o.isAutoCorrection;n.currentBackgroundType===p.default.BACKGROUND_MODES.BACKGROUND&&(i={name:p.default.PHOTO_FILTERS[0],value:0},a={exposure:0,contrast:0,saturation:0,warmth:0,vignette:0,sharpness:0,grain:0},s={isEnabled:!1,form:s.form,size:s.size,position:s.position},c=!1);var u={exposure:a.exposure,contrast:a.contrast,saturation:a.saturation,warmth:a.warmth,amount:i.value,vignette:a.vignette,sharpness:a.sharpness,grain:a.grain,sourceSize:[e.width,e.height]};this.renderer.render(e.width,e.height,e,i.name,u,s,c).then((function(n){if(n){var o,a,i=e.height/e.width;i>1.77?(o=t.props.height/i,a=t.props.height):(o=t.props.width,a=t.props.width*i);var s=Math.floor(t.props.width/2),c=Math.floor(t.props.height/2),u=function(e){var t=document.createElement("canvas"),r=t.getContext("2d");return t.width=e.width,t.height=e.height,null==r||r.drawImage(e,0,0,e.width,e.height),t}(n),l=Fe[e.src];l||(Fe[e.src]=function(e){var t,r=e.getContext("2d"),n={r:0,g:0,b:0};if(!r)return n;try{t=r.getImageData(0,0,r.canvas.width,r.canvas.height)}catch(e){return n}for(var o=-4,a=0;(o+=20)<t.data.length;)++a,n.r+=t.data[o],n.g+=t.data[o+1],n.b+=t.data[o+2];return n.r=~~(n.r/a),n.g=~~(n.g/a),n.b=~~(n.b/a),n}(u),l=Fe[e.src]),le(r,u,l);var p={canvas:u,width:o,height:a,avgColor:l};t.needUpdateSize&&Object.assign(p,{x:s,y:c,locked:!0,rotate:0,scale:1}),t.props.updateBackgroundLayer(p)}})).catch((function(e){console.error(new Error(e))}))}},t}(n.PureComponent),He={updateBackgroundLayer:X},We=Object(a.connect)((function(e){return{currentBackgroundUrl:f(e),originalWidth:e.present.data.originalWidth,originalHeight:e.present.data.originalHeight,background:e.present.background,isAutoCorrection:e.present.settings.isAutoCorrection,colorCorrection:e.present.settings.colorCorrection,filter:e.present.settings.filter,blur:e.present.settings.blur}}),He)(Ue),Ye=r("4+be"),Ge=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),ze=function(){for(var e=0,t=0,r=arguments.length;t<r;t++)e+=arguments[t].length;var n=Array(e),o=0;for(t=0;t<r;t++)for(var a=arguments[t],i=0,s=a.length;i<s;i++,o++)n[o]=a[i];return n},Ve=function(e){function t(t){var r=e.call(this,t)||this;return r.componentDidUpdate=function(){r.scrollWithAnimation=!1},r.render=function(){var e,t=r.props.layers,o=t.currentIndex,a=t.items,i=null!==o&&a[o],s=i&&i.type===p.default.LAYER_TYPES.TEXT&&i.isEdit,c="";return i&&(i.type===p.default.LAYER_TYPES.STICKER?c=Object(Ye.getLang)("photos_pe_delete_sticker"):i.type===p.default.LAYER_TYPES.TEXT&&(c=Object(Ye.getLang)("photos_pe_delete_text"))),r.props.currentBackgroundType!==p.default.BACKGROUND_MODES.BACKGROUND||i||(e=!0),n.createElement("div",{className:"StatusPanel"},e?r.renderBackgrounds():n.createElement("div",{className:"StatusPanel__inner"},r.renderLeftBlock(),n.createElement("div",null,i&&!s&&n.createElement("a",{className:"StatusPanel__link",onClick:r.props.deleteLayer},c),i&&s&&n.createElement("a",{className:"StatusPanel__link",onClick:r.props.closeTextEditor},Object(Ye.getLang)("photos_pe_save_text")))))},r.renderLeftBlock=function(){var e=r.props.addons;return"photo"===r.props.context?n.createElement("div",null,e&&e.edited&&e.canEdit&&n.createElement("a",{className:"StatusPanel__link",onClick:e.restore},Object(Ye.getLang)("photos_filtered_restore")),e&&!e.canEdit&&n.createElement("span",{className:"StatusPanel__info"},Object(Ye.getLang)("photos_will_be_saved_to_pe_album"))):n.createElement("div",null,r.props.currentBackgroundType===p.default.BACKGROUND_MODES.PHOTO&&n.createElement("a",{className:"StatusPanel__link",onClick:function(){return r.props.uploadPhoto()}},Object(Ye.getLang)("photos_pe_change_photo")))},r.renderBackgrounds=function(){var e=r.state.scrollBlockPosition,t=r.props.backgrounds,o=t.gradients,a=t.emojies,i=r.scrollElement.current,s=i?e+i.offsetWidth:0,c=!!e,u=!i||!!(i.scrollWidth-s);return n.createElement("div",{className:"StatusPanel__backgrounds",onWheel:r.panelMouseWheel},n.createElement("div",{className:"StatusPanel__scroll",style:{transform:"translateX(-"+e+"px)",transition:r.scrollWithAnimation?"transform .3s ease-out":""},ref:r.scrollElement},ze(o,a).map((function(e){var t=e.id,o=e.preview;return n.createElement("a",{className:Object(de.classNames)("StatusPanel__background",{"StatusPanel__background--active":t===r.props.currentBackgroundId}),key:t,style:{backgroundImage:"url("+o+")"},onClick:function(){return r.props.setCurrentBackgroundId(t)}})}))),c&&n.createElement("div",{className:"StatusPanel__arrow StatusPanel__arrow--left",onClick:function(){return r.handleArrowClick(!0)}},n.createElement("span",{className:"StatusPanel__arrowIcon"})),u&&n.createElement("div",{className:"StatusPanel__arrow StatusPanel__arrow--right",onClick:function(){return r.handleArrowClick(!1)}},n.createElement("span",{className:"StatusPanel__arrowIcon"})))},r.panelMouseWheel=function(e){r.setPosition(Math.abs(e.deltaY)>Math.abs(e.deltaX)?e.deltaY:e.deltaX)},r.setPosition=function(e,t){var n=r.scrollElement.current;if(n){var o=r.state.scrollBlockPosition,a=n.offsetWidth,i=Math.max(0,Math.min(o+e,n.scrollWidth-a));t&&(r.scrollWithAnimation=!0),r.setState({scrollBlockPosition:i})}},r.handleArrowClick=function(e){var t=r.scrollElement.current;if(t){var n=t.offsetWidth/2;e&&(n=-n),r.setPosition(n,!0)}},r.state={scrollBlockPosition:0},r.scrollElement=n.createRef(),r.scrollWithAnimation=!1,r}return Ge(t,e),t}(n.Component),Xe={deleteLayer:K,closeTextEditor:q},Ke=Object(a.connect)((function(e){return{context:e.present.data.context,layers:e.present.layers,addons:e.present.data.addons}}),Xe)(Ve),qe=r("Ht+d"),Ze=r("6krn"),$e=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),Je=function(){return(Je=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var o in t=arguments[r])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)},Qe=function(e,t,r){[p.default.CROP_ASPECT_ORIGINAL,p.default.CROP_ASPECT_FREE].includes(e)&&(e=t/r);var n=t,o=n/e;return o>r&&(n=(o=r)*e),{x:t/2-n/2,y:r/2-o/2,width:n,height:o}},et=function(e){function t(t){var r=e.call(this,t)||this;r.controlMouseDown=function(e,t){e.stopPropagation();var n=r.areaEl.current;if(n){window.addEventListener("mousemove",r.controlMouseMove),window.addEventListener("mouseup",r.controlMouseUp);var o=ie(e.nativeEvent,n),a=o.x,i=o.y;r.shiftX=a,r.shiftY=i,r.initCrop=r.state,r.side=t}},r.controlMouseMove=function(e){var t=r.containerEl.current;if(t){var n=r.state,o=r.props,a=o.artboardWidth,i=o.artboardHeight,s=o.cropAspect,c=s===p.default.CROP_ASPECT_ORIGINAL?a/i:s,u=ie(e,t),l=u.x,d=u.y,f=u.width,h=u.height,m=n.x,_=n.y,v=n.width,g=n.height,y=p.default.CROP_MIN_SIZE,E=p.default.CROP_MIN_SIZE;if(c&&(c>1?y=p.default.CROP_MIN_SIZE*c:c<1&&(E=p.default.CROP_MIN_SIZE/c)),r.side===p.default.CROP_SIDES.CENTER)m=Math.min(Math.max(0,l-r.shiftX),f-v),_=Math.min(Math.max(0,d-r.shiftY),h-g);else{var b=Math.max(0,l-r.shiftX),S=Math.max(0,d-r.shiftY);switch(r.side){case p.default.CROP_SIDES.S:g=d-_-(r.shiftY-r.initCrop.height);break;case p.default.CROP_SIDES.N:g-=(_=S)-n.y;break;case p.default.CROP_SIDES.W:v-=(m=b)-n.x;break;case p.default.CROP_SIDES.E:v=l-m-(r.shiftX-r.initCrop.width);break;case p.default.CROP_SIDES.NW:_=S,v-=(m=b)-n.x,g-=_-n.y;break;case p.default.CROP_SIDES.NE:_=S,v=l-m-(r.shiftX-r.initCrop.width),g-=_-n.y;break;case p.default.CROP_SIDES.SW:v-=(m=b)-n.x,g=d-_-(r.shiftY-r.initCrop.height);break;case p.default.CROP_SIDES.SE:v=l-m-(r.shiftX-r.initCrop.width),g=d-_-(r.shiftY-r.initCrop.height)}if(c){var T=Math.min(v,f-m)/c;if([p.default.CROP_SIDES.NW,p.default.CROP_SIDES.NE].includes(r.side)&&(_=Math.max(0,_+g-T)),h-(_+T)<0)return;g=T}v=Math.min(Math.max(y,v),f-m),g=Math.min(Math.max(E,g),h-_),v-y<=0&&(m=n.x,v=n.width),g-E<=0&&(_=n.y,g=n.height)}r.setState({x:m,y:_,width:v,height:g})}},r.controlMouseUp=function(){window.removeEventListener("mousemove",r.controlMouseMove),window.removeEventListener("mouseup",r.controlMouseUp),delete r.shiftX,delete r.shiftY,delete r.initCrop,delete r.side},r.cropImage=function(){var e=r.state,t=e.width,n=e.height,o=e.x,a=e.y,i=r.props,s=i.currentBackgroundUrl,c=i.artboardWidth,u=i.artboardHeight;r.setState({isButtonDisable:!0});var l=document.createElement("canvas"),p=l.getContext("2d");p&&ve.get(s).then((function(e){var i=e.width/c,s=e.height/u;l.width=t*i,l.height=n*s,p.drawImage(e,o*i,a*s,t*i,n*s,0,0,l.width,l.height),l.toBlob((function(e){r.props.setCrop({url:URL.createObjectURL(e),isCropped:!0,data:{artboardWidth:t,originalWidth:l.width,originalHeight:l.height,addons:Je(Je({},r.props.addons),{photoHeight:n})},layers:r.props.layers.items.map((function(e){return Je(Je({},e),{x:e.x-o,y:e.y-a})})),drawings:r.props.drawings.map((function(e){return Je(Je({},e),{path:e.path.map((function(e){return[e[0]-o,e[1]-a]}))})}))}),r.reset(t,n)}),"image/jpeg",1)})).catch((function(e){console.error(e)}))},r.reset=function(e,t){r.props.setAspect(p.default.CROP_ASPECT_FREE),r.setState({x:0,y:0,width:e,height:t,isButtonDisable:!1})},r.containerEl=n.createRef(),r.areaEl=n.createRef();var o=t.cropAspect,a=t.artboardWidth,i=t.artboardHeight;return r.state=Je({isButtonDisable:!1},Qe(o,a,i)),r}return $e(t,e),t.prototype.shouldComponentUpdate=function(e){return e.cropAspect===this.props.cropAspect&&e.artboardWidth===this.props.artboardWidth&&e.artboardHeight===this.props.artboardHeight||this.setState(Qe(e.cropAspect,e.artboardWidth,e.artboardHeight)),!0},t.prototype.render=function(){var e=this,t=p.default.CROP_SIDES,r=this.props,o=r.artboardWidth,a=r.artboardHeight,i=this.state,s=i.x,c=i.y,u=i.width,l=i.height,d=i.isButtonDisable,f=u<210,h=f?100:60,m=Object(de.classNames)("CropControls__buttons",{"CropControls__buttons--top":c+l+h>=a,"CropControls__buttons--small":f}),_=0!==s||0!==c||u!==o||l!==a;return n.createElement("div",{className:"CropControls",ref:this.containerEl},n.createElement("div",{className:"CropControls__inner",ref:this.areaEl,style:{top:c,left:s,width:u,height:l}},_&&n.createElement("div",{className:m},n.createElement(qe.default,{size:"s",className:"CropControls__button CropControls__button--cancel",onClick:function(){return e.reset(e.props.artboardWidth,e.props.artboardHeight)}},Object(Ze.getLang)("photos_pe_crop_cancel")),n.createElement(qe.default,{size:"s",className:"CropControls__button",onClick:this.cropImage,disabled:d},Object(Ze.getLang)("photos_pe_crop_apply"))),n.createElement("div",{className:"CropControls__grid",onMouseDown:function(r){return e.controlMouseDown(r,t.CENTER)}},n.createElement("div",{className:"CropControls__line CropControls__line--v",style:{left:"33.3333%"}}),n.createElement("div",{className:"CropControls__line CropControls__line--v",style:{left:"66.6666%"}}),n.createElement("div",{className:"CropControls__line CropControls__line--h",style:{top:"33.3333%"}}),n.createElement("div",{className:"CropControls__line CropControls__line--h",style:{top:"66.6666%"}}),n.createElement("div",{className:"CropControls__handleCorner CropControls__handleCorner--nw",onMouseDown:function(r){return e.controlMouseDown(r,t.NW)}}),n.createElement("div",{className:"CropControls__handleCorner CropControls__handleCorner--ne",onMouseDown:function(r){return e.controlMouseDown(r,t.NE)}}),n.createElement("div",{className:"CropControls__handleCorner CropControls__handleCorner--sw",onMouseDown:function(r){return e.controlMouseDown(r,t.SW)}}),n.createElement("div",{className:"CropControls__handleCorner CropControls__handleCorner--se",onMouseDown:function(r){return e.controlMouseDown(r,t.SE)}}),this.props.cropAspect===p.default.CROP_ASPECT_FREE&&n.createElement(n.Fragment,null,n.createElement("div",{className:"CropControls__handle CropControls__handle--n",onMouseDown:function(r){return e.controlMouseDown(r,t.N)}}),n.createElement("div",{className:"CropControls__handle CropControls__handle--s",onMouseDown:function(r){return e.controlMouseDown(r,t.S)}}),n.createElement("div",{className:"CropControls__handle CropControls__handle--w",onMouseDown:function(r){return e.controlMouseDown(r,t.W)}}),n.createElement("div",{className:"CropControls__handle CropControls__handle--e",onMouseDown:function(r){return e.controlMouseDown(r,t.E)}})))))},t}(n.Component),tt={setAspect:Q,setCrop:ne},rt=Object(a.connect)((function(e){return{currentBackgroundUrl:f(e),cropAspect:e.present.settings.cropAspect,addons:e.present.data.addons,layers:e.present.layers,drawings:e.present.drawings}}),tt)(et),nt=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),ot=function(e){function t(t){var r=e.call(this,t)||this;return r.canvasBg=n.createRef(),r}return nt(t,e),t.prototype.componentDidUpdate=function(){this.drawImage()},t.prototype.render=function(){var e=this.props.layer,t=e.width*e.scale,r=e.height*e.scale;return n.createElement("canvas",{ref:this.canvasBg,width:t*p.default.CANVAS_SCALE,height:r*p.default.CANVAS_SCALE,style:{width:t,height:r}})},t.prototype.drawImage=function(){var e=this.props.layer,t=this.canvasBg.current,r=null==t?void 0:t.getContext("2d");if(r){var n=e.width*e.scale,o=e.height*e.scale;r.drawImage(e.canvas,0,0,n*p.default.CANVAS_SCALE,o*p.default.CANVAS_SCALE)}},t}(n.PureComponent),at=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),it=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.controlMouseDown=function(e,r){if(e.preventDefault(),e.stopPropagation(),t.props.startLayerScale(),t.layer=t.props.layer,t.layer.type===p.default.LAYER_TYPES.TEXT){var n=e.target.closest(".EditorLayer__inner");if(!n)return;t.width=n.offsetWidth/t.layer.scale,t.height=n.offsetHeight/t.layer.scale}else t.width=t.layer.width,t.height=t.layer.height;if(void 0!==t.width&&void 0!==t.height){switch(window.addEventListener("mousemove",t.controlMouseMove),window.addEventListener("mouseup",t.controlMouseUp),r){case"se":t.offsetFromCenter={x:t.width/2,y:t.height/2};break;case"sw":t.offsetFromCenter={x:-t.width/2,y:t.height/2};break;case"ne":t.offsetFromCenter={x:t.width/2,y:-t.height/2};break;case"nw":t.offsetFromCenter={x:-t.width/2,y:-t.height/2}}void 0!==t.offsetFromCenter&&(t.distanceToZero=Math.sqrt(t.offsetFromCenter.x*t.offsetFromCenter.x+t.offsetFromCenter.y*t.offsetFromCenter.y))}},t.controlMouseMove=function(e){var r=ie(e,document.querySelector(".EditorCanvas__canvas--draw")),n=r.x,o=r.y;if(void 0!==t.offsetFromCenter&&void 0!==t.distanceToZero&&void 0!==t.width&&void 0!==t.height){var a={x:n-t.layer.x,y:o-t.layer.y},i=180*(Math.atan2(a.y,a.x)-Math.atan2(t.offsetFromCenter.y,t.offsetFromCenter.x))/Math.PI,s=Math.max(p.default.LAYER_MIN_SIZE,Math.sqrt(a.x*a.x+a.y*a.y))/t.distanceToZero;t.props.setLayerScale(s,i)}},t.controlMouseUp=function(){window.removeEventListener("mousemove",t.controlMouseMove),window.removeEventListener("mouseup",t.controlMouseUp),delete t.width,delete t.height,delete t.centerCoordinates,delete t.offsetFromCenter,delete t.distanceToZero},t}return at(t,e),t.prototype.render=function(){var e=this;return n.createElement("div",{className:"EditorLayerSelection"},n.createElement("div",{className:"EditorLayerSelection__handler EditorLayerSelection__handler--nw",onMouseDown:function(t){return e.controlMouseDown(t,"nw")}}),n.createElement("div",{className:"EditorLayerSelection__handler EditorLayerSelection__handler--ne",onMouseDown:function(t){return e.controlMouseDown(t,"ne")}}),n.createElement("div",{className:"EditorLayerSelection__handler EditorLayerSelection__handler--sw",onMouseDown:function(t){return e.controlMouseDown(t,"sw")}}),n.createElement("div",{className:"EditorLayerSelection__handler EditorLayerSelection__handler--se",onMouseDown:function(t){return e.controlMouseDown(t,"se")}}))},t}(n.Component),st=r("Xrg9"),ct=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),ut=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return ct(t,e),t.prototype.render=function(){return st.default.get("story_show_clickable_zones")?this.props.clickableZones.map((function(e,t){var r=e.clickable_area,o=100*Math.abs(r[1].x-r[0].x),a=100*Math.abs(r[2].y-r[1].y);return n.createElement("div",{key:t,className:"EditorClickableZone",style:{top:100*r[0].y+"%",left:100*r[0].x+"%",width:o+"%",height:a+"%"}})})):null},t}(n.Component),lt=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),pt=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.handleDoubleClick=function(){t.props.toggleTextEditor(!0)},t}return lt(t,e),t.prototype.render=function(){var e=this.props,t=e.layer,r=e.currentIndex,n=e.index,o=null,a=Object(de.classNames)("EditorLayer","EditorLayer--"+t.type,{"EditorLayer--active":r===n,"EditorLayer--locked":t.locked});switch(t.type){case p.default.LAYER_TYPES.STICKER:o=this.renderLayerSticker(t,n,a);break;case p.default.LAYER_TYPES.TEXT:o=this.renderLayerText(t,n,a);break;case p.default.LAYER_TYPES.IMAGE:o=this.renderLayerImage(t,n,a);break;case p.default.LAYER_TYPES.BACKGROUND:o=this.renderLayerBackground(t,n,a)}if(t.isBackground){var i=document.querySelector(".EditorCanvas__layers--bg");return i?oe.createPortal(o,i):null}return o},t.prototype.renderLayerBackground=function(e,t,r){return n.createElement("div",{key:t,className:r,"data-index":t,style:{width:1,height:1,transform:"translate("+e.x+"px, "+e.y+"px) rotateZ("+e.rotate+"deg)"}},n.createElement("div",{className:"EditorLayer__inner"},n.createElement(ot,{layer:e}),this.props.currentIndex===t&&n.createElement(it,{layer:e,setLayerScale:this.props.setLayerScale,startLayerScale:this.props.startLayerScale})))},t.prototype.renderLayerSticker=function(e,t,r){var o=this.props.getStickerUrlById(e.id,p.default.STICKER_LARGE);return n.createElement("div",{key:t,className:r,"data-index":t,style:{width:1,height:1,transform:"translate("+e.x+"px, "+e.y+"px) rotateZ("+e.rotate+"deg)"}},n.createElement("div",{className:"EditorLayer__inner",style:{width:e.width*e.scale,height:e.height*e.scale,backgroundImage:"url('"+o+"')"}},this.props.currentIndex===t&&n.createElement(it,{layer:e,setLayerScale:this.props.setLayerScale,startLayerScale:this.props.startLayerScale})))},t.prototype.renderLayerImage=function(e,t,r){return n.createElement("div",{key:t,className:r,"data-index":t,style:{width:1,height:1,transform:"translate("+e.x+"px, "+e.y+"px) rotateZ("+e.rotate+"deg)"}},n.createElement("div",{className:"EditorLayer__inner",style:{width:e.width*e.scale,height:e.height*e.scale,backgroundImage:"url('"+e.url+"')"}},this.props.currentIndex===t&&n.createElement(it,{layer:e,setLayerScale:this.props.setLayerScale,startLayerScale:this.props.startLayerScale}),e.clickableZones&&n.createElement(ut,{clickableZones:e.clickableZones})))},t.prototype.renderLayerText=function(e,t,r){var o=Math.max(10,e.fontSize*p.default.FONT_SIZE_COEFFICIENT);r+=" PhotoEditorFontStyle--"+e.fontStyle;var a={fontSize:o*e.scale,color:e.color};return this.props.currentIndex===t&&e.isEdit?null:n.createElement("div",{key:t,className:r,"data-index":t,style:{width:1,height:1,transform:"translate("+e.x+"px, "+e.y+"px) rotateZ("+e.rotate+"deg)"}},n.createElement("div",{className:"EditorLayer__inner",style:a,onDoubleClick:this.handleDoubleClick},n.createElement("div",null,Object(H.decodeHTMLEntities)(e.text.replace(/(\v)/gm,"\n"))),this.props.currentIndex===t&&n.createElement(it,{layer:e,setLayerScale:this.props.setLayerScale,startLayerScale:this.props.startLayerScale})))},t}(n.Component),dt=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),ft=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return dt(t,e),t.prototype.render=function(){var e=this,t=this.props.layers,r=t.items,o=t.currentIndex,a=Object(de.classNames)("EditorCanvas__layers",{"EditorCanvas__layers--disabled":[p.default.TABS.PAINT,p.default.TABS.FILTERS,p.default.TABS.COLOR,p.default.TABS.CROP].includes(this.props.currentMode)});return n.createElement(n.Fragment,null,n.createElement("div",{className:a+" EditorCanvas__layers--items"},r.map((function(t,r){return n.createElement(pt,{key:r,index:r,currentIndex:o,layer:t,setLayerScale:e.props.setLayerScale,startLayerScale:e.props.startLayerScale,toggleTextEditor:e.props.toggleTextEditor,getStickerUrlById:e.props.getStickerUrlById})}))),n.createElement("div",{className:a+" EditorCanvas__layers--bg"}))},t}(n.Component),ht=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),mt=function(e){function t(t){var r=e.call(this,t)||this;return r.componentDidMount=function(){var e=r.textareaEl.current;e&&(r.onChange(),e.select())},r.render=function(){var e=r.props.layer,t=Math.max(10,e.fontSize*p.default.FONT_SIZE_COEFFICIENT);return e.initialFontSize&&(t=e.initialFontSize*p.default.FONT_SIZE_COEFFICIENT),n.createElement("div",{className:"EditorText"},n.createElement("div",{className:"EditorText__inner"},n.createElement("textarea",{ref:r.textareaEl,className:"EditorText__textarea PhotoEditorFontStyle--"+e.fontStyle,defaultValue:Object(H.decodeHTMLEntities)(e.text).replace(/(\v)/gm,""),autoFocus:!0,onKeyDown:r.onKeyDown,onChange:r.onChange,onInput:r.onChange,onPaste:r.onChange,style:{color:e.color,fontSize:t,height:r.state.height}})))},r.onKeyDown=function(e){if("Enter"===e.key)if(e.preventDefault(),e.stopPropagation(),e.ctrlKey||e.metaKey||e.shiftKey){var t=r.textareaEl.current;if(t){var n=e.target.selectionStart,o=e.target.selectionEnd;t.value=t.value.substring(0,n)+"\n"+t.value.substring(o),t.selectionStart=t.selectionEnd=n+1,r.onChange()}}else r.props.closeTextEditor()},r.onChange=function(){var e=r.textareaEl.current;e&&(r.setState({height:0},(function(){r.setState({height:e.scrollHeight})})),r.props.onChange(r.applyLineBreaks(e)))},r.applyLineBreaks=function(e){var t=e.value,r=e.cloneNode(!0);document.querySelector(".EditorText__inner").appendChild(r),r.setAttribute("wrap","off"),r.value="";for(var n=r.scrollWidth,o=0,a=-1;o<t.length;o++){var i=t.charAt(o);if(" "!=i&&"-"!=i&&"+"!=i||(a=o),r.value+=i,r.scrollWidth>n){var s="";if(a>=0){for(var c=a+1;c<o;c++)s+=t.charAt(c);a=-1}s+=i,r.value=r.value.substr(0,r.value.length-s.length),r.value+="\n\v"+s}}return r.remove(),r.value.replace(/(\n\v)/gm,"\v")},r.state={height:0},r.textareaEl=n.createRef(),Object(U.sendStat)(U.EVENTS.EDIT_TEXT),r}return ht(t,e),t.prototype.componentDidUpdate=function(e){e.layer.fontSize===this.props.layer.fontSize&&e.layer.fontStyle===this.props.layer.fontStyle||this.onChange()},t}(n.Component),_t=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),vt=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.setMode=function(e){e===p.default.BACKGROUND_MODES.PHOTO?Object(U.sendStat)(U.EVENTS.CLICK_TO_CAMERA_ICON):e===p.default.BACKGROUND_MODES.BACKGROUND&&Object(U.sendStat)(U.EVENTS.CLICK_TO_GRADIENT_ICON),t.props.setMode(e)},t}return _t(t,e),t.prototype.render=function(){var e=this;return n.createElement("div",{className:"SwitchMode"},Object.values(p.default.BACKGROUND_MODES).map((function(t){var r=Object(de.classNames)("SwitchMode__mode","SwitchMode__mode--"+t,{"SwitchMode__mode--active":t===e.props.current});return n.createElement("span",{key:t,className:r,onClick:function(){return e.setMode(t)}})})))},t}(n.PureComponent),gt=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),yt=function(e){function t(t){var r=e.call(this,t)||this;return r.state={onHover:!1},r}return gt(t,e),t.prototype.render=function(){var e=this,r=Object(de.classNames)("DropBox",{"DropBox--hover":this.state.onHover});return n.createElement("div",{className:r,onMouseOver:function(){return e.setState({onHover:!0})},onMouseOut:function(){return e.setState({onHover:!1})},onMouseUp:this.props.onDelete},t.renderIcon())},t.renderIcon=function(){return n.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:"50",height:"50",fill:"none"},n.createElement("path",{fill:"#fff",d:"M17.5 18.38a1 1 0 00-2 .24l1.8 15.23a3 3 0 002.98 2.65h9.44a3 3 0 002.98-2.65l1.8-15.23a1 1 0 10-2-.24l-1.78 15.24a1 1 0 01-1 .88h-9.44a1 1 0 01-1-.88L17.5 18.38z"}),n.createElement("path",{fill:"#fff",d:"M22 21.45a1 1 0 00-2 .1l.5 10a1 1 0 102-.1l-.5-10zm8 .1a1 1 0 00-2-.1l-.5 10a1 1 0 102 .1l.5-10zm-4-.05a1 1 0 10-2 0v10a1 1 0 002 0v-10z"}),n.createElement("path",{fill:"#fff",fillRule:"evenodd",d:"M20.62 16.5c.08-.35.2-.77.42-1.2.32-.64.8-1.19 1.38-1.59A4.55 4.55 0 0125 13c1.05 0 1.9.27 2.58.71.59.4 1.06.95 1.38 1.6.21.42.34.84.42 1.19H36a1 1 0 010 2H14a1 1 0 010-2h6.63zm6.68 0a2.9 2.9 0 00-.13-.3c-.16-.33-.4-.61-.7-.82-.31-.2-.77-.38-1.47-.38s-1.16.17-1.47.38c-.32.2-.54.5-.7.82-.05.1-.1.2-.13.3h4.6z",className:"DropBox__cap",clipRule:"evenodd"}))},t}(n.PureComponent),Et=r("dt/K"),bt=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),St=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.render=function(){var e=t.props.data.artboardContainer;return e?oe.createPortal(t.renderCanvas(),e):t.renderCanvas()},t.renderCanvas=function(){var e=t.props,r=e.layers,o=e.background,a=e.data,i=e.ui,s=e.settings,c=a.addons,u=a.artboardWidth,l=a.artboardHeight,d=a.attachment,f=t.props.layers,h=f.currentIndex,m=f.items,_=null!==h&&m[h],v=_&&_.type===p.default.LAYER_TYPES.TEXT&&_.isEdit,g=t.props.ui.isDataLoaded&&t.props.data.context===p.default.CONTEXT_TYPES.STORY,y=t.props.marginTop,E=l;c&&c.photoHeight&&(E=c.photoHeight);var b=Object(de.classNames)("EditorCanvas",{"EditorCanvas--blurCursor":p.default.TABS.COLOR===i.currentMode&&s.blur.isEnabled}),S=Object(de.classNames)("EditorCanvas__scaleButton",{"EditorCanvas__scaleButton--enabled":!r.items[0].locked});return n.createElement(n.Fragment,null,n.createElement("div",{style:{width:u,height:E,marginTop:y},className:b},t.props.ui.isDataLoaded&&i.currentMode===p.default.TABS.CROP&&n.createElement(rt,{artboardWidth:u,artboardHeight:E}),n.createElement(ft,{setLayerScale:t.props.setLayerScale,startLayerScale:t.props.startLayerScale,toggleTextEditor:t.props.toggleTextEditor,currentMode:t.props.ui.currentMode,getStickerUrlById:t.props.getStickerUrlById,layers:r}),v&&_?n.createElement(mt,{layer:_,onChange:t.onChangeText,closeTextEditor:t.props.closeTextEditor}):g&&n.createElement(n.Fragment,null,!!d&&!i.isShowDropBox&&n.createElement(Et.default,{text:Object(Ze.getLang)("photos_pe_attached_post"),position:"b",marginTop:5,align:"left"},n.createElement("span",{className:"EditorCanvas__postIcon"})),!i.isShowDropBox&&t.props.background.currentBackgroundType===p.default.BACKGROUND_MODES.PHOTO&&[p.default.TABS.STICKERS,p.default.TABS.TEXT].includes(t.props.ui.currentMode)&&n.createElement("button",{className:S,onClick:t.onClickScaleButton}),!i.isShowDropBox&&n.createElement(vt,{current:o.currentBackgroundType,setMode:t.props.setMode})),i.isShowDropBox&&_&&_.canDelete&&n.createElement(yt,{onDelete:t.props.deleteLayer}),t.props.ui.isDataLoaded&&n.createElement(_e,{width:u,height:E}),t.props.ui.isDataLoaded&&n.createElement(We,{width:u,height:E})),t.props.ui.isDataLoaded&&n.createElement(Ke,{currentBackgroundId:o.currentBackgroundId,setCurrentBackgroundId:t.props.setCurrentBackgroundId,currentBackgroundType:o.currentBackgroundType,uploadPhoto:t.props.uploadPhoto,backgrounds:t.props.data.backgrounds}))},t.onClickScaleButton=function(){var e,r,n=t.props.layers.items[0],o={},a=t.props.data,i=a.artboardWidth,s=a.artboardHeight,c=n.height/n.width;c>1.77?e=(r=s)/c:(e=i,r=i*c);var u=i/2,l=s/2;n.locked?(Object(U.sendStat)(U.EVENTS.ZOOM),Object.assign(o,{locked:!1,scale:.7})):(Object(U.sendStat)(U.EVENTS.UNZOOM),Object.assign(o,{locked:!0,rotate:0,x:u,y:l,width:e,height:r,scale:1})),t.props.updateBackgroundLayer(o),t.props.setCurrentLayer(n.locked?0:null)},t.onChangeText=function(e){t.props.setLayerText(e)},t}return bt(t,e),t}(n.Component),Tt={setCurrentBackgroundId:function(e){return Object(U.sendStat)(U.EVENTS.SELECT_BACKGROUND),{type:"SET_CURRENT_BACKGROUND_ID",value:e}},setLayerScale:function(e,t){return function(r,n){var o=n().present.layers,a=o.currentIndex,i=o.items;null!==a&&i[a]&&r({type:"SET_LAYER_SCALE",payload:{scale:e,rotate:t}})}},startLayerScale:function(){return{type:"START_LAYER_SCALE"}},setLayerText:function(e){return function(t,r){var n=r().present.layers,o=n.currentIndex,a=n.items;null!==o&&a[o]&&t({type:"SET_LAYER_TEXT",payload:{text:e}})}},toggleTextEditor:V,deleteLayer:K,updateBackgroundLayer:X,setCurrentLayer:Y,setBackgroundType:ee,closeTextEditor:q},wt=Object(a.connect)((function(e){return{ui:e.present.ui,settings:e.present.settings,layers:e.present.layers,drawings:e.present.drawings,background:e.present.background,data:e.present.data,marginTop:h(e)}}),Tt)(St),Ot=r("TfWv"),Ct=r("754W"),xt=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),Pt=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.onTabClick=function(e,r){r||t.props.change(e)},t}return xt(t,e),t.prototype.render=function(){var e=this,t=this.props.current;return n.createElement("div",{className:"EditorTabs"},n.createElement("div",{className:"EditorTabs__header"},n.Children.map(this.props.children,(function(r){if(r){var o=r.props["data-disabled"],a=Object(de.classNames)("EditorTabs__item","EditorTabs__item--"+r.props["data-mode"],{"EditorTabs__item--current":t===r.props["data-mode"],"EditorTabs__item--disabled":o}),i=n.createElement("div",{className:a,key:r.props["data-mode"],onClick:function(){return e.onTabClick(r.props["data-mode"],o)}});if(o){var s=n.createElement("div",{className:"EditorTabsTooltip"},n.createElement("span",{className:"EditorTabsTooltip__text"},Object(Ze.getLang)("photos_pe_filters_disabled_text")),n.createElement(Ct.default,{onClick:function(){return e.props.setMode(p.default.BACKGROUND_MODES.PHOTO)},className:"EditorTabsTooltip__link"},Object(Ze.getLang)("photos_pe_filters_disabled_button")));return n.createElement(Ot.default,{className:"EditorTabs__tooltip",text:s,appearance:"light",position:"b",maxWidth:203},i)}return i}}))),n.createElement("div",{className:"EditorTabs__content"},n.Children.map(this.props.children,(function(e){if(e){var r={className:Object(de.classNames)(e.props.className,"EditorTabs__tab",{"EditorTabs__tab--current":t===e.props["data-mode"]})};return n.cloneElement(e,r)}}))))},t}(n.Component),Rt=r("vRp6"),At=r("EasH"),Nt=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),Lt=function(e){function t(t){var r=e.call(this,t)||this;return r.componentDidMount=function(){r.fetchStickers()},r.componentDidUpdate=function(){r.scrollWithAnimation=!1},r.render=function(){var e=r.props,t=e.stickers,o=e.stickerMouseDown,a=r.props.ui,i=a.stickerHeaderScrollPosition,s=a.currentStickerPackIndex,c=r.scrollElement.current,u=!!i,l=!1,d=0;c&&(d=i+c.offsetWidth,l=!!(c.scrollWidth-d));var f=t[s]?t[s].items:[];r.needReset&&(r.needReset=!1,f=[],r.setState({}));for(var h=[],m=0,_=f.length;m<_;m+=3)h.push(f.slice(m,m+3));return n.createElement("div",{className:"StickersPanel"},n.createElement("div",{className:"StickersPanel__header"},n.createElement("div",{className:"StickersPanel__scroll",style:{transform:"translateX(-"+i+"px)",transition:r.scrollWithAnimation?"transform .3s ease-out":""},ref:r.scrollElement,onWheel:r.tabsMouseWheel},n.createElement("div",{className:"StickersPanel__tab StickersPanel__tab--store",onClick:function(){return r.showStickerShop()}}),t.map((function(e,t){var o=e.id,a=r.getTabPreviewUrl(t);if(!a)return null;var i=!Object(Ce.inArray)(o,["recent","editor"]),c=Object(de.classNames)("StickersPanel__tab",{"StickersPanel__tab--selected":t===s,"StickersPanel__tab--recent":"recent"===o,"StickersPanel__tab--editor":"editor"===o});return n.createElement("div",{key:o,className:c,style:i?{backgroundImage:"url('"+a+"')"}:void 0,onClick:function(){return r.selectStickerPack(t)}})}))),u&&n.createElement("div",{className:"StickersPanel__arrow StickersPanel__arrow--left",onClick:function(){return r.handleTabArrowClick(!0)}},n.createElement("span",{className:"StickersPanel__arrowIcon"})),l&&n.createElement("div",{className:"StickersPanel__arrow StickersPanel__arrow--right",onClick:function(){return r.handleTabArrowClick(!1)}},n.createElement("span",{className:"StickersPanel__arrowIcon"}))),n.createElement(Rt.default,{virtualized:!0,loadMore:function(){},hasMore:!1,className:"StickersPanel__content",itemHeight:98},h.map((function(e,t){return n.createElement("div",{key:t,className:"StickersPanel__row"},e.map((function(e){var t=e.id,r=e.sizes;return n.createElement("div",{key:t,className:"StickersPanel__preview",onMouseDown:function(e){return o(e,t)}},n.createElement("img",{src:r[p.default.STICKER_MEDIUM],className:"StickersPanel__previewImage"}))})))}))))},r.getTabPreviewUrl=function(e){var t=r.props.stickers[e].items,n=(t||[])[0],o=void 0===n?null:n;return!(!t||!o)&&o.sizes[p.default.STICKER_THUMB]},r.selectStickerPack=function(e){r.needReset=!0,r.props.setCurrentStickerPackIndex(e)},r.tabsMouseWheel=function(e){r.setPosition(Math.abs(e.deltaY)>Math.abs(e.deltaX)?e.deltaY:e.deltaX)},r.handleTabArrowClick=function(e){var t=r.scrollElement.current;if(t){var n=t.offsetWidth;e&&(n=-n),r.setPosition(n,!0)}},r.setPosition=function(e,t){var n=r.scrollElement.current,o=r.props.ui.stickerHeaderScrollPosition;if(n){var a=n.offsetWidth,i=Math.max(0,Math.min(o+e,n.scrollWidth-a));t&&(r.scrollWithAnimation=!0),r.props.setHeaderScrollPosition(i)}},r.loadingLimit=25,r.scrollElement=n.createRef(),r.scrollWithAnimation=!1,r.needReset=!1,r}return Nt(t,e),t.prototype.fetchStickers=function(){var e=this;window.ajax.post("al_photos.php",{act:"get_editor_data"},{onDone:function(t){var r={};t.stickers.forEach((function(e){e.items.forEach((function(e){r[e.id]=e}))})),e.props.setData({stickers:t.stickers,stickersMap:r})},onFail:function(e){return console.error(e),!0}})},t.prototype.showStickerShop=function(){var e=this;Object(At.showBox)("al_im.php",{act:"stickers_store",box:1},{dark:1,stat:["im.css","imn.js","page_help.css",window.jsc("web/sorter.js")],params:{onDestroy:function(){e.fetchStickers()}}})},t}(n.Component),It={setCurrentStickerPackIndex:function(e){return{type:"SET_CURRENT_STICKER_PACK_INDEX",value:e}},setHeaderScrollPosition:function(e){return{type:"SET_HEADER_SCROLL_POSITION",value:e}},setData:re},Dt=Object(a.connect)((function(e){return{ui:e.present.ui,stickers:e.present.data.stickers}}),It)(Lt),kt=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),Mt=function(){for(var e=0,t=0,r=arguments.length;t<r;t++)e+=arguments[t].length;var n=Array(e),o=0;for(t=0;t<r;t++)for(var a=arguments[t],i=0,s=a.length;i<s;i++,o++)n[o]=a[i];return n},jt=function(e){function t(t){var r=e.call(this,t)||this;return r.colors=r.getColors(t.avgColor),r}return kt(t,e),t.prototype.shouldComponentUpdate=function(e){return JSON.stringify(e.avgColor)!==JSON.stringify(this.props.avgColor)&&(this.colors=this.getColors(e.avgColor)),!0},t.prototype.render=function(){var e=this;return n.createElement("div",{className:"ColorPicker"},this.colors.map((function(t,r){var o=Object(de.classNames)("ColorPicker__color",{"ColorPicker__color--white":"#FFFFFF"===t,"ColorPicker__color--selected":t===e.props.color});return n.createElement("div",{key:r,className:o,style:{backgroundColor:t},onClick:function(){return e.props.setColor(t)}})})))},t.prototype.getColors=function(e){var t,r=function(e,t,r){var n=0,o=0,a=e/255,i=t/255,s=r/255,c=Math.max(a,i,s),u=c-Math.min(a,i,s),l=function(e){return(c-e)/6/u+.5},p=function(e){return Math.round(100*e)/100};if(0!==u){o=u/c;var d=l(a),f=l(i),h=l(s);a===c?n=h-f:i===c?n=1/3+d-h:s===c&&(n=2/3+f-d),n<0?n+=1:n>1&&(n-=1)}return{h:Math.round(360*n),s:p(100*o),v:p(100*c)}}(e.r,e.g,e.b),n=[];return p.default.AVERAGE_COLORS_MAP.forEach((function(e){var t=Math.round(Math.min(Math.max(r.s+e.s,0),100)),o=Math.round(Math.min(Math.max(r.v+e.v,0),100));n.push(function(e,t,r){t/=100,r/=100;var n=(1-Math.abs(2*r-1))*t,o=n*(1-Math.abs(e/60%2-1)),a=r-n/2,i=0,s=0,c=0;return 0<=e&&e<60?(i=n,s=o,c=0):60<=e&&e<120?(i=o,s=n,c=0):120<=e&&e<180?(i=0,s=n,c=o):180<=e&&e<240?(i=0,s=o,c=n):240<=e&&e<300?(i=o,s=0,c=n):300<=e&&e<360&&(i=n,s=0,c=o),i=Math.round(255*(i+a)).toString(16),s=Math.round(255*(s+a)).toString(16),c=Math.round(255*(c+a)).toString(16),1==i.length&&(i="0"+i),1==s.length&&(s="0"+s),1==c.length&&(c="0"+c),"#"+i+s+c}(r.h,t,o).toUpperCase())})),(t=Mt(p.default.COLORS,n),t.filter((function(e,t,r){return r.indexOf(e)==t}))).slice(0,30)},t}(n.Component),Bt=r("clTp"),Ft=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),Ut=function(e){function t(r){var o,a=e.call(this,r)||this;return a.onMouseDown=function(e){0===e.button&&(a.update(e),a.setState({isActive:!0}),window.addEventListener("mouseup",a.onMouseUp),window.addEventListener("mousemove",a.onMouseMove))},a.onMouseMove=function(e){requestAnimationFrame((function(){return a.update(e)}))},a.onMouseUp=function(){a.setState({isActive:!1}),window.removeEventListener("mousemove",a.onMouseMove),window.removeEventListener("mouseup",a.onMouseUp)},a.onMouseEnter=function(){window.addEventListener("mousemove",a.updateHint)},a.onMouseLeave=function(){window.removeEventListener("mousemove",a.updateHint)},a.update=function(e){var r=a.props,n=r.min,o=r.max,i=r.gravity,s=a.getOffset(e),c=s.offset,u=s.width,l=a.getZeroPosition(),p=t.valueToPercent(c,0,u);i&&i>0&&p>=l-i&&p<=l+i&&(p=l),a.state.percentValue!==p&&(a.setState({hintPosition:p}),a.props.onChange(t.percentToValue(p,n,o)),a.isControlledOutside||a.setState({percentValue:p}))},a.updateHint=function(e){var r=a.getOffset(e),n=r.offset,o=r.width;a.setState({hintPosition:t.valueToPercent(n,0,o)})},o=r.value?t.valueToPercent(r.value,r.min,r.max):r.defaultValue?t.valueToPercent(r.defaultValue,r.min,r.max):a.getZeroPosition(),a.state={percentValue:o,hintPosition:0,isActive:!1},a.isControlledOutside=a.props.hasOwnProperty("value"),a.slider=n.createRef(),a}return Ft(t,e),t.prototype.componentDidMount=function(){this.slider.current&&this.slider.current.addEventListener("mousedown",this.onMouseDown),this.slider.current&&this.slider.current.addEventListener("mouseenter",this.onMouseEnter),this.slider.current&&this.slider.current.addEventListener("mouseleave",this.onMouseLeave)},t.prototype.componentWillUnmount=function(){this.slider.current&&this.slider.current.removeEventListener("mousedown",this.onMouseDown),this.slider.current&&this.slider.current.removeEventListener("mouseenter",this.onMouseEnter),this.slider.current&&this.slider.current.removeEventListener("mouseleave",this.onMouseLeave)},t.prototype.componentDidUpdate=function(e){var r=this.props.value;if(this.isControlledOutside&&void 0!==r&&r!==e.value){var n=this.props,o=n.min,a=n.max;this.setState({percentValue:t.valueToPercent(r,o,a)})}},t.valueToPercent=function(e,t,r){return e<t&&(e=t),e>r&&(e=r),100*(e-t)/(r-t)},t.percentToValue=function(e,t,r){return Math.round(100*(e*(r-t)/100+t))/100},t.getFillPosition=function(e,t){var r,n;return e<t?(r=e,n=t-e):(r=t,n=e-t),{left:r,width:n}},t.prototype.getZeroPosition=function(){var e=this.props,r=e.min,n=e.max;return t.valueToPercent(0,r,n)},t.prototype.getOffset=function(e){var t=this.props,r=t.min,n=t.max,o=t.step,a=Object(Bt.default)(this.slider.current),i=a.left,s=a.width,c=e.clientX-i;if(o>0){var u=s/((n-r)/o);c=Math.round(c/u)*u}return{offset:c,left:i,width:s}},t.prototype.render=function(){var e=this.props,r=e.min,o=e.max,a=e.isShowZero,i=e.isShowHandle,s=e.appearance,c=this.state,u=c.percentValue,l=c.hintPosition,p=c.isActive,d=this.getZeroPosition(),f=t.getFillPosition(u,d),h=f.left,m=f.width,_=u!==d,v=this.props.formatHint(t.percentToValue(l,r,o)),g=Object(de.classNames)("Slider","Slider--"+s,{Slider__active:p}),y=Object(de.classNames)("Slider__handle",{"Slider__handle--active":_,"Slider__handle--show":i});return n.createElement("div",{className:g,ref:this.slider},n.createElement("input",{type:"hidden",name,value:u}),a&&_&&n.createElement("div",{className:"Slider__middletick",style:{left:d+"%"}}),n.createElement("span",{className:"Slider__hint",style:{left:l+"%"}},v),n.createElement("div",{className:"Slider__fill",style:{left:h+"%",width:m+"%"}}),n.createElement("div",{className:y,style:{left:u+"%"}}))},t.defaultProps={min:0,max:100,step:0,gravity:0,isShowZero:!1,isShowHandle:!1,defaultValue:0,appearance:"blue",name:"value",onChange:function(){},formatHint:function(e){return e}},t}(n.Component),Ht=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),Wt=function(e){function t(t){var r=e.call(this,t)||this;return r.componentDidMount=function(){r.updateDrawingPreview()},r.render=function(){var e=r.props,t=e.settings,o=e.setColor,a=e.setBrushWidth,i=e.setBrushOpacity,s=e.avgColor;return r.updateDrawingPreview(),n.createElement("div",{className:"DrawPanel"},n.createElement("canvas",{ref:r.previewCanvas,className:"DrawPanel__preview",width:p.default.DRAWING_PREVIEW_WIDTH*p.default.CANVAS_SCALE,height:p.default.DRAWING_PREVIEW_HEIGHT*p.default.CANVAS_SCALE,style:{width:p.default.DRAWING_PREVIEW_WIDTH,height:p.default.DRAWING_PREVIEW_HEIGHT}}),n.createElement("div",{className:"DrawPanel__sliders"},n.createElement("div",{className:"DrawPanel__slider"},n.createElement("div",{className:"DrawPanel__title"},Object(Ze.getLang)("photos_pe_intensity")),n.createElement(Ut,{min:0,max:1,isShowHandle:!0,defaultValue:t.brushOpacity,formatHint:function(e){return Math.round(100*e)+"%"},onChange:function(e){return i(e)}})),n.createElement("div",{className:"DrawPanel__slider"},n.createElement("div",{className:"DrawPanel__title"},Object(Ze.getLang)("photos_pe_line_width")),n.createElement(Ut,{min:0,max:1,isShowHandle:!0,defaultValue:t.brushWidth,formatHint:function(e){return Math.round(100*e)+"%"},onChange:function(e){return a(e)}}))),n.createElement("div",{className:"DrawPanel__colors"},n.createElement("div",{className:"DrawPanel__title DrawPanel__title--largeOffset"},Object(Ze.getLang)("photos_pe_color")),n.createElement(jt,{color:t.color,avgColor:s,setColor:o})))},r.updateDrawingPreview=function(){var e=r.previewCanvas.current,t=r.props.settings;if(e){var n=e.getContext("2d");if(n){var o=n.canvas,a=o.width,i=o.height;n.clearRect(0,0,a,i);var s=p.default.CANVAS_SCALE,c=new Path2D("M"+69*s+" "+65*s+"L"+93*s+" "+41*s+"L"+121*s+" "+69*s+"L"+149*s+" "+41*s+"L"+177*s+" "+69*s+"L"+201*s+" "+45*s),u="#FFFFFF"===t.color?"#F1F1F1":t.color;n.lineWidth=t.brushWidth*p.default.BRUSH_WIDTH_COEFFICIENT*s,n.strokeStyle=se(u,t.brushOpacity),n.lineJoin=n.lineCap="round",n.stroke(c)}}},r.previewCanvas=n.createRef(),r}return Ht(t,e),t}(n.Component),Yt={setColor:J,setBrushWidth:function(e){return{type:"SET_SETTING_BRUSH_WIDTH",brushWidth:Math.max(.1,e)}},setBrushOpacity:function(e){return{type:"SET_SETTING_BRUSH_OPACITY",brushOpacity:e}}},Gt=Object(a.connect)((function(e){return{settings:e.present.settings,drawings:e.present.drawings,avgColor:e.present.layers.items[0].avgColor}}),Yt)(Wt),zt=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),Vt=function(){return(Vt=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var o in t=arguments[r])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)},Xt=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.flip=function(e,r){var n=document.createElement("canvas"),o=null==n?void 0:n.getContext("2d"),a=t.props.currentBackgroundUrl;o&&ve.get(a).then((function(a){n.width=a.width,n.height=a.height,e?(o.translate(n.width,0),o.scale(-1,1)):r&&(o.translate(0,n.height),o.scale(1,-1)),o.drawImage(a,0,0),n.toBlob((function(n){var o={url:URL.createObjectURL(n)};e&&(o.flipX=!t.props.flipX),r&&(o.flipY=!t.props.flipY),t.props.setCrop(o)}),"image/jpeg",1)})).catch((function(e){console.error(e)}))},t.rotate=function(e){var r=document.createElement("canvas"),n=null==r?void 0:r.getContext("2d"),o=t.props,a=o.currentBackgroundUrl,i=o.originalWidth,s=o.originalHeight;n&&ve.get(a).then((function(o){r.width=o.height,r.height=o.width;var a=e?-90:90;n.translate(r.width/2,r.height/2),n.rotate(a*Math.PI/180),n.drawImage(o,-o.width/2,-o.height/2),r.toBlob((function(e){var n=r.height/r.width,o=t.props.rotate+a;t.props.rotate>o?Object(U.sendStat)(U.EVENTS.TURN_LEFT):Object(U.sendStat)(U.EVENTS.TURN_RIGHT);var c,u,l=document.getElementById("pv_photo").getBoundingClientRect(),d=l.width,f=l.height;f-=p.default.BOTTOM_PANEL_HEIGHT,n>=.67?(c=f/n,u=f):(c=d,u=d*n),t.props.setCrop({url:URL.createObjectURL(e),data:{artboardWidth:c,originalWidth:s,originalHeight:i,addons:Vt(Vt({},t.props.addons),{photoHeight:u})},rotate:o>270?0:o})}),"image/jpeg",1)})).catch((function(e){console.error(e)}))},t}return zt(t,e),t.prototype.render=function(){var e=this;return n.createElement("div",{className:"CropPanel"},n.createElement("span",{className:"CropPanel__title"},Object(Ze.getLang)("photos_pe_crop_aspect_title")),n.createElement("ul",{className:"CropPanelRatioTabs"},p.default.CROP_ASPECTS.map((function(t){var r=Object(de.classNames)("CropPanelRatioTabs__button",{"CropPanelRatioTabs__button--active":e.props.cropAspect===t.value});return n.createElement("li",{className:"CropPanelRatioTabs__item",key:t.title},n.createElement("button",{className:r,onClick:function(){return e.props.setAspect(t.value)}},Object(Ze.getLang)(t.title)))}))),n.createElement("ul",{className:"CropPanelSettings"},n.createElement("li",{className:"CropPanelSettings__item"},n.createElement(Ct.default,{className:"CropPanelSettings__link CropPanelSettings__link--rotateRight",onClick:function(){return e.rotate(!1)}},Object(Ze.getLang)("photos_pe_rotate_right"))),n.createElement("li",{className:"CropPanelSettings__item"},n.createElement(Ct.default,{className:"CropPanelSettings__link CropPanelSettings__link--rotateLeft",onClick:function(){return e.rotate(!0)}},Object(Ze.getLang)("photos_pe_rotate_left"))),n.createElement("li",{className:"CropPanelSettings__item"},n.createElement(Ct.default,{className:"CropPanelSettings__link CropPanelSettings__link--flipHorizontal",onClick:function(){return e.flip(!0,!1)}},Object(Ze.getLang)("photos_pe_flip_horizontal"))),n.createElement("li",{className:"CropPanelSettings__item"},n.createElement(Ct.default,{className:"CropPanelSettings__link CropPanelSettings__link--flipVertical",onClick:function(){return e.flip(!1,!0)}},Object(Ze.getLang)("photos_pe_flip_vertical")))))},t}(n.Component),Kt={setCrop:ne,setAspect:Q},qt=Object(a.connect)((function(e){return{flipX:e.present.settings.flipX,flipY:e.present.settings.flipY,rotate:e.present.settings.rotation,cropAspect:e.present.settings.cropAspect,currentBackgroundUrl:f(e),addons:e.present.data.addons,artboardWidth:e.present.data.artboardWidth,artboardHeight:e.present.data.artboardHeight,originalWidth:e.present.data.originalWidth,originalHeight:e.present.data.originalHeight}}),Kt)(Xt),Zt=r("TBLV"),$t=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),Jt=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.render=function(){var e=t.props,r=e.settings,o=e.setColor,a=e.setFontSize,i=e.layer,s=e.fontsPlaceholders,c=e.avgColor,u=i&&i.isEdit,l=i&&i.fontStyle,d=i&&i.fontSize,f=i&&i.color;return n.createElement("div",{className:"TextPanel"},u?n.createElement(qe.default,{className:"TextPanelButton",onClick:t.props.closeTextEditor},Object(Ye.getLang)("photos_pe_save_text")):n.createElement(qe.default,{className:"TextPanelButton",onClick:function(){return t.props.addLayerText(!0,{isEdit:!0})}},n.createElement("div",{className:"TextPanelButton__icon"}),Object(Ye.getLang)("photos_pe_add_text")),n.createElement("div",{className:"TextPanelButton__fonts"},n.createElement("div",{className:"TextPanelButton__title"},Object(Ye.getLang)("photos_pe_font")),p.default.FONTS.map((function(e,o){return n.createElement(Zt.default,{key:e,value:e,name:"photo_editor_fonts",className:"TextPanelButton__radio",onChange:function(){return t.props.setFontStyle(e)},checked:l?l===e:r.fontStyle===e},n.createElement("span",{className:"TextPanelButton__font TextPanelButton__font--"+e+" PhotoEditorFontStyle--"+e},s[o]))}))),n.createElement("div",{className:"TextPanelButton__fontSize"},n.createElement("div",{className:"TextPanelButton__title"},Object(Ye.getLang)("photos_pe_font_size")),n.createElement(Ut,{min:0,max:1,isShowHandle:!0,value:d||r.fontSize,formatHint:function(e){return""+Math.round(100*e)},onChange:function(e){return a(e)}})),n.createElement("div",{className:"TextPanelButton__colors"},n.createElement("div",{className:"TextPanelButton__title"},Object(Ye.getLang)("photos_pe_color")),n.createElement(jt,{color:f||r.color,avgColor:c,setColor:o})))},t}return $t(t,e),t}(n.Component),Qt={addLayerText:z,setColor:J,setFontSize:function(e){return function(t,r){var n=r().present.layers,o=n.currentIndex,a=n.items;o&&!a[o]||t(function(e){return function(t,r){var n=r().present.layers,o=n.currentIndex,a=n.items;null!==o&&a[o]&&t({type:E,payload:{fontSize:e}})}}(e)),t({type:"SET_SETTING_FONT_SIZE",fontSize:e})}},setFontStyle:function(e){return function(t,r){var n=r().present.layers,o=n.currentIndex,a=n.items;o&&!a[o]||t(function(e){return function(t,r){var n=r().present.layers,o=n.currentIndex,a=n.items;null!==o&&a[o]&&t({type:"SET_LAYER_FONT_STYLE",payload:{fontStyle:e}})}}(e)),t({type:"SET_SETTING_FONT_FAMILY",fontStyle:e})}},closeTextEditor:q},er=Object(a.connect)((function(e){var t=e.present.layers,r=t.items,n=t.currentIndex,o=null;return null!==n&&(o=r[n]),{settings:e.present.settings,layer:o,fontsPlaceholders:e.present.data.fontsPlaceholders,avgColor:e.present.layers.items[0].avgColor}}),Qt)(Jt),tr=r("aFGQ"),rr=r("2zsc"),nr=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),or=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return nr(t,e),t.prototype.render=function(){var e=this.props,t=e.settings,r=e.setColorCorrection;return n.createElement("div",{className:"ColorPanel"},n.createElement("div",{className:"ColorPanel__items"},n.createElement("div",{className:"ColorPanel__item"},n.createElement("span",{className:"ColorPanel__name"},Object(Ze.getLang)("photos_pe_correction_exposure")),n.createElement(Ut,{min:-1,max:1,gravity:2,isShowHandle:!0,isShowZero:!0,value:t.colorCorrection.exposure,onChange:function(e){return r("exposure",e)},formatHint:function(e){return Math.round(100*e)}})),n.createElement("div",{className:"ColorPanel__item"},n.createElement("span",{className:"ColorPanel__name"},Object(Ze.getLang)("photos_pe_correction_contrast")),n.createElement(Ut,{min:-1,max:1,gravity:2,isShowHandle:!0,isShowZero:!0,value:t.colorCorrection.contrast,onChange:function(e){return r("contrast",e)},formatHint:function(e){return Math.round(100*e)}})),n.createElement("div",{className:"ColorPanel__item"},n.createElement("span",{className:"ColorPanel__name"},Object(Ze.getLang)("photos_pe_correction_saturation")),n.createElement(Ut,{min:-1,max:1,gravity:2,isShowHandle:!0,isShowZero:!0,value:t.colorCorrection.saturation,onChange:function(e){return r("saturation",e)},formatHint:function(e){return Math.round(100*e)}})),n.createElement("div",{className:"ColorPanel__item"},n.createElement("span",{className:"ColorPanel__name"},Object(Ze.getLang)("photos_pe_correction_warmth")),n.createElement(Ut,{min:-1,max:1,gravity:2,isShowHandle:!0,isShowZero:!0,value:t.colorCorrection.warmth,onChange:function(e){return r("warmth",e)},formatHint:function(e){return Math.round(100*e)}})),n.createElement("div",{className:"ColorPanel__item"},n.createElement("span",{className:"ColorPanel__name"},Object(Ze.getLang)("photos_pe_correction_vignette")),n.createElement(Ut,{min:-1,max:1,gravity:2,isShowHandle:!0,isShowZero:!0,value:t.colorCorrection.vignette,onChange:function(e){return r("vignette",e)},formatHint:function(e){return Math.round(100*e)}})),n.createElement("div",{className:"ColorPanel__item"},n.createElement("span",{className:"ColorPanel__name"},Object(Ze.getLang)("photos_pe_correction_sharpness")),n.createElement(Ut,{min:0,max:1,gravity:2,isShowHandle:!0,isShowZero:!0,value:t.colorCorrection.sharpness,onChange:function(e){return r("sharpness",e)},formatHint:function(e){return Math.round(100*e)}})),n.createElement("div",{className:"ColorPanel__item"},n.createElement("span",{className:"ColorPanel__name"},Object(Ze.getLang)("photos_pe_correction_grain")),n.createElement(Ut,{min:0,max:1,gravity:2,isShowHandle:!0,isShowZero:!0,value:t.colorCorrection.grain,onChange:function(e){return r("grain",e)},formatHint:function(e){return Math.round(100*e)}}))),n.createElement("div",{className:"ColorPanel__linkBox"},this.renderAutoCorrectionPanel()),n.createElement("div",{className:"ColorPanel__linkBox"},this.renderBlurPanel()))},t.prototype.renderAutoCorrectionPanel=function(){var e=this.props,t=e.settings,r=e.setAutoCorrection;return t.isAutoCorrection?n.createElement("div",{className:"ColorPanelEnabledBox"},n.createElement("div",{className:"ColorPanelEnabledBox__header"},n.createElement(rr.default,{className:""},Object(Ze.getLang)("photos_pe_correction_auto_enabled")),n.createElement("span",{className:"dvd"}),n.createElement(Ct.default,{className:"ColorPanelEnabledBox__link",onClick:function(){return r(!1)}},Object(Ze.getLang)("photos_pe_cancel")))):n.createElement(Ct.default,{className:"ColorPanel__link ColorPanel__link--auto",onClick:function(){return r(!0)}},Object(Ze.getLang)("photos_pe_correction_auto"))},t.prototype.renderBlurPanel=function(){var e=this.props,t=e.settings,r=e.setBlurEnable,o=e.setBlurForm,a=e.setBlurSize,i=t.blur,s=[{label:Object(Ze.getLang)("photos_pe_correction_blur_type_round"),value:p.default.BLUR_TYPES.ROUND},{label:Object(Ze.getLang)("photos_pe_correction_blur_type_rec"),value:p.default.BLUR_TYPES.RECTANGULAR}];return i.isEnabled?n.createElement("div",{className:"ColorPanelEnabledBox"},n.createElement("div",{className:"ColorPanelEnabledBox__header"},n.createElement(rr.default,{className:""},Object(Ze.getLang)("photos_pe_correction_blur_enabled")),n.createElement("span",{className:"dvd"}),n.createElement(Ct.default,{className:"ColorPanelEnabledBox__link",onClick:function(){return r(!1)}},Object(Ze.getLang)("photos_pe_cancel"))),n.createElement("div",{className:"ColorPanelEnabledBox__select"},n.createElement("span",{className:"ColorPanelEnabledBox__type"},Object(Ze.getLang)("photos_pe_correction_blur_type")),n.createElement(tr.default,{appearance:"fancy",value:i.form,options:s,onChange:function(e){return o(String(e.selected.value))}})),n.createElement(Ut,{min:0,max:100,gravity:2,isShowHandle:!0,isShowZero:!0,value:t.blur.size,onChange:function(e){return a(e)},formatHint:function(e){return Math.round(e)}})):n.createElement(Ct.default,{className:"ColorPanel__link ColorPanel__link--blur",onClick:function(){return r(!0)}},Object(Ze.getLang)("photos_pe_correction_blur"))},t}(n.Component),ar={setColorCorrection:function(e,t){return{type:_,filter:e,value:t}},setBlurEnable:function(e){return e?Object(U.sendStat)(U.EVENTS.ENABLE_BLUR):Object(U.sendStat)(U.EVENTS.DISABLE_BLUR),{type:"SET_SETTING_BLUR_ENABLE",isEnabled:e}},setBlurForm:function(e){return{type:"SET_SETTING_BLUR_FORM",form:e}},setBlurSize:function(e){return{type:g,size:e}},setAutoCorrection:function(e){return e?Object(U.sendStat)(U.EVENTS.ENABLE_AUTOCORRECTION):Object(U.sendStat)(U.EVENTS.DISABLE_AUTOCORRECTION),{type:"SET_SETTING_AUTO_CORRECTION",isAutoCorrection:e}}},ir=Object(a.connect)((function(e){return{settings:e.present.settings}}),ar)(or),sr=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),cr=function(e){function t(t){var r=e.call(this,t)||this;return r.shouldComponentUpdate=function(e){var t=r.props,n=t.currentBackgroundUrl,o=t.currentFilterName,a=n!==e.currentBackgroundUrl;return o!==e.currentFilterName||(a&&r.update(e.currentBackgroundUrl),!1)},r.handleClick=function(){r.props.setFilter(r.props.filter)},r.canvas=n.createRef(),r.renderer=new je,r}return sr(t,e),t.prototype.componentDidMount=function(){this.update(this.props.currentBackgroundUrl)},t.prototype.render=function(){var e=Object(de.classNames)("FiltersItem",{"FiltersItem--active":this.props.currentFilterName===this.props.filter});return n.createElement("div",{className:e,onClick:this.handleClick},n.createElement("div",{className:"FiltersItem__inner",style:{width:p.default.FILTER_PREVIEW_WIDTH}},n.createElement("canvas",{className:"FiltersItem__image",ref:this.canvas,width:p.default.FILTER_PREVIEW_WIDTH*p.default.CANVAS_SCALE,height:p.default.FILTER_PREVIEW_HEIGHT*p.default.CANVAS_SCALE,style:{width:p.default.FILTER_PREVIEW_WIDTH,height:p.default.FILTER_PREVIEW_HEIGHT}}),n.createElement("span",{className:"FiltersItem__name"},Object(Ze.getLang)("photos_pe_filter_"+this.props.filter))))},t.prototype.update=function(e){var t=this;e&&ve.get(e).then((function(e){t.renderImage(e)})).catch((function(e){console.error(e)}))},t.prototype.renderImage=function(e){var t=this;this.renderer.render(p.default.FILTER_PREVIEW_WIDTH*p.default.CANVAS_SCALE,p.default.FILTER_PREVIEW_HEIGHT*p.default.CANVAS_SCALE,e,this.props.filter,{amount:.75,sourceSize:[e.width,e.height]}).then((function(r){if(r){var n=t.canvas.current;if(n){var o=n.getContext("2d");if(o){var a,i,s=+(e.height/e.width).toFixed(2);s>1.77?(a=n.height/s,i=n.height):(a=n.width,i=n.width*s);var c=n.width/2-a/2,u=n.height/2-i/2;le(n,r,t.props.avgColor),o.drawImage(r,c,u,a,i)}}}})).catch((function(e){console.error(new Error(e))}))},t}(n.Component),ur={setFilter:function(e){return"regular"===e?Object(U.sendStat)(U.EVENTS.REMOVE_FILTER):Object(U.sendStat)(U.EVENTS.ADD_FILTER),{type:"SET_SETTING_FILTER",name:e}}},lr=Object(a.connect)((function(e){return{currentFilterName:e.present.settings.filter.name,currentBackgroundUrl:f(e)}}),ur)(cr),pr=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),dr=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return pr(t,e),t.prototype.render=function(){var e=this;return n.createElement("div",{className:"FiltersPanel"},n.createElement("div",{className:"FiltersPanel__header"},this.renderHeader()),n.createElement("div",{className:"FiltersPanel__inner"},p.default.PHOTO_FILTERS.map((function(t){return n.createElement(lr,{key:t,avgColor:e.props.avgColor,filter:t})}))))},t.prototype.renderHeader=function(){var e=this.props.settings;return"regular"===e.filter.name?n.createElement("span",null,Object(Ze.getLang)("photos_pe_filter_disabled")):n.createElement("div",{className:"FiltersPanel__slider"},n.createElement("span",{className:"FiltersPanel__title"},Object(Ze.getLang)("photos_pe_filter_enabled")),n.createElement(Ut,{min:0,max:1,value:e.filter.value,isShowHandle:!0,onChange:this.props.setFilterAmount,formatHint:function(e){return Math.round(100*e)+"%"}}))},t}(n.Component),fr={setFilterAmount:function(e){return{type:v,value:e}}},hr=Object(a.connect)((function(e){return{settings:e.present.settings,avgColor:e.present.layers.items[0].avgColor}}),fr)(dr),mr=s.ActionCreators,_r=Object(a.connect)((function(e){return{canUndo:e.past.length>0,canRedo:e.future.length>0}}),mr)((function(e){var t=e.canUndo,r=e.canRedo,n=e.undo,a=e.redo;return o.a.createElement("div",{className:"UndoRedo"},o.a.createElement("button",{className:"UndoRedo__button UndoRedo__button--undo",onClick:function(){Object(U.sendStat)(U.EVENTS.UNDO),n()},disabled:!t}),o.a.createElement("button",{className:"UndoRedo__button UndoRedo__button--redo",onClick:function(){Object(U.sendStat)(U.EVENTS.REDO),a()},disabled:!r}))})),vr=new(function(){function e(){this.canvas=document.createElement("canvas"),this.context=this.canvas.getContext("2d")}return e.prototype.draw=function(e,t,r,n,o,a){var i=this;return new Promise((function(s,c){var u=r[0];i.canvas.width=e,i.canvas.height=t,le(i.canvas,u.canvas,u.avgColor);var l=u.width*u.scale,p=u.height*u.scale,d=u.x-l/2,f=u.y-p/2;i.drawImage(u.canvas,l*o,p*o,d*o,f*o,u.rotate),i.drawBrush(n,o),i.drawLayers(r,o,e,t,a).then((function(){i.canvas.toBlob((function(e){s({blob:e,width:i.canvas.width,height:i.canvas.height})}),"image/jpeg",1)})).catch((function(e){c(e)}))}))},e.prototype.drawImage=function(e,t,r,n,o,a){this.context&&(this.context.save(),this.context.translate(n,o),this.context.translate(t/2,r/2),this.context.rotate(a*Math.PI/180),this.context.translate(-t/2,-r/2),this.context.drawImage(e,0,0,t,r),this.context.restore())},e.prototype.drawBrush=function(e,t){var r=this.context;r&&(r.save(),r.lineCap="round",r.lineJoin="round",e.forEach((function(e){r.lineWidth=e.width*p.default.BRUSH_WIDTH_COEFFICIENT*t,r.strokeStyle=se(e.color,e.opacity),r.beginPath(),r.moveTo(e.path[0][0]*t,e.path[0][1]*t),e.path.forEach((function(e){r.lineTo(e[0]*t,e[1]*t)})),r.stroke()})),r.restore())},e.prototype.drawLayers=function(e,t,r,n,o){var a=this;return new Promise((function(r,n){var i=[];e.forEach((function(e,t){var r=null;if(e.type!==p.default.LAYER_TYPES.BACKGROUND){if(e.type===p.default.LAYER_TYPES.STICKER){var n=o((e=e).id,p.default.STICKER_LARGE);r=a.fetchImage(n,e.width*e.scale,e.height*e.scale,e.x,e.y,e.rotate)}else if(e.type===p.default.LAYER_TYPES.IMAGE)e=e,r=a.fetchImage(e.url,e.width*e.scale,e.height*e.scale,e.x,e.y,e.rotate);else if(e.type===p.default.LAYER_TYPES.TEXT){var s=document.querySelector('[data-index="'+t+'"] .EditorLayer__inner');s&&(r=a.drawTextLayer(e,s))}r&&i.push(r)}})),Promise.all(i).then((function(e){e.forEach((function(e){var r=e.width,n=e.height,o=e.x-r/2,i=e.y-n/2;a.drawImage(e.image,r*t,n*t,o*t,i*t,e.rotate)})),r()})).catch((function(e){n(e)}))}))},e.prototype.drawTextLayer=function(e,t){return new Promise((function(r,n){var o=document.createElement("canvas"),a=o.getContext("2d");if(!a)return n();o.width=t.offsetWidth*p.default.CANVAS_SCALE+100,o.height=t.offsetHeight*p.default.CANVAS_SCALE+100;var i="";switch(e.fontStyle){case"classic":i="RobotoPE";break;case"cursive":i="PacificoPE";break;case"marker":i="AmaticPE";break;case"italics":i="TTCommonsPE";break;case"typewriter":i="GoraPE";break;case"poster":i="DinPE";break;case"retro":i="Rodchenko";break;case"impact":i="Impact";break;case"lobster":i="Lobster"}var s=e.fontSize*e.scale*p.default.FONT_SIZE_COEFFICIENT*p.default.CANVAS_SCALE;a.font=s+"px "+i+", serif",a.fillStyle=e.color,a.textAlign="center",a.textBaseline="top",function(e,t,r,n,o,a){if((a=a||0)<=0)e.fillText(t,r,n);else{for(var i=t.replace(/(\v)/gm,"\n").split("\n"),s=0,c=1;i.length>0&&c<=i.length;){var u=i.slice(0,c).join(" ");e.measureText(u).width>a?(1===c&&(c=2),e.fillText(i.slice(0,c-1).join(" "),r,n+o*s),s++,i=i.splice(c-1),c=1):c++}c>0&&e.fillText(i.join(" "),r,n+o*s)}}(a,e.text,o.width/2,50,s,o.width-100),r({image:o,width:o.width/p.default.CANVAS_SCALE,height:o.height/p.default.CANVAS_SCALE,x:e.x,y:e.y,rotate:e.rotate})}))},e.prototype.fetchImage=function(e,t,r,n,o,a){return new Promise((function(i){ae(e).then((function(e){i({image:e,width:t,height:r,x:n,y:o,rotate:a})})).catch((function(e){console.error(e)}))}))},e}()),gr=r("3oLO"),yr=r("W9Tc"),Er=r("zxIV"),br=r("6raB"),Sr=r("PjZB"),Tr=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),wr=function(){return(wr=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var o in t=arguments[r])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)},Or=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.componentDidMount=function(){window.addEventListener("keydown",t.handleKeyDown,{capture:!0}),window.addEventListener("mousedown",t.canvasMouseDown),t.getEditorData().then((function(e){var r=e.stickers,n=e.backgrounds,o=e.storyUploadUrlHash,a=e.storySaveHash,i={};r.forEach((function(e){e.items.forEach((function(e){i[e.id]=e}))})),t.props.setData({stickers:r,stickersMap:i,backgrounds:n,placeholders:Object(Ze.getLang)("photos_pe_texts_placeholders").split("<br>"),fontsPlaceholders:Object(Ze.getLang)("photos_pe_fonts").split("<br>"),storyUploadUrlHash:o,storySaveHash:a}),t.props.setDataLoaded(),t.props.background.currentBackgroundType===p.default.BACKGROUND_MODES.BACKGROUND&&(t.props.addLayerText(!0,{isEdit:!0}),t.props.closeTextEditor(),t.props.setCurrentLayer(null)),t.props.stickers&&t.prepareStickers(t.props.stickers)})).catch((function(){window.showFastBox({title:Object(Ze.getLang)("global_error")},Object(Ze.getLang)("global_error"),Object(Ze.getLang)("global_close"),(function(){window.curBox().hide(),t.props.data.close(!1,!0)}))}))},t.componentWillUnmount=function(){window.removeEventListener("keydown",t.handleKeyDown,{capture:!0}),window.removeEventListener("mousedown",t.canvasMouseDown),delete window.cur.storyPublishContext},t.getEditorData=function(){return new Promise((function(e,t){gr.ajax.post("al_photos.php",{act:"get_editor_data"},{onDone:function(t){e(t)},onFail:function(){return t(),!0}})}))},t.render=function(){var e,r=t.props,o=r.ui,a=r.data,i=r.drawings,s=r.layers,c=r.settings;if(a.artboardContainer||(e={width:a.artboardWidth,height:parseInt(a.artboardHeight)+p.default.BOTTOM_PANEL_HEIGHT}),t.isSaveDisabled=!0,a.context===p.default.CONTEXT_TYPES.STORY)t.isSaveDisabled=!1;else{var u=c.colorCorrection,l=c.filter,d=c.blur,f=c.isAutoCorrection,h=c.isCropped,m=c.flipX,_=c.flipY,v=c.rotation;t.isSaveDisabled=!(!(s.items.length<=1)||i.length||u.exposure||u.contrast||u.saturation||u.warmth||u.vignette||u.sharpness||u.grain||"regular"!==l.name||d.isEnabled||f||h||m||_||v)}return n.createElement("div",{className:"PhotoEditor",style:{height:parseInt(a.artboardHeight)+p.default.BOTTOM_PANEL_HEIGHT}},n.createElement("div",{className:"PhotoEditor__canvas",style:e},n.createElement(wt,{getStickerUrlById:t.getStickerUrlById,uploadPhoto:t.uploadPhoto,setMode:t.setMode})),n.createElement("div",{className:"PhotoEditor__tabs"},o.isDataLoaded?t.renderTabs():n.createElement(Sr.default,null)),!o.isDataLoaded&&t.renderFontsPreloading())},t.renderTabs=function(){var e,r=t.props,o=r.data,a=r.background,i=o.context===p.default.CONTEXT_TYPES.STORY&&a.currentBackgroundType===p.default.BACKGROUND_MODES.BACKGROUND,s=Object(yr.partConfigEnabled)("web_new_photo_editor"),c=Object(yr.partConfigEnabled)("web_new_photo_editor_crop"),u=Object(Ze.getLang)("photos_pe_save_action");return t.props.data.context===p.default.CONTEXT_TYPES.STORY&&(u=Object(Ze.getLang)("photos_pe_publish_action")),n.createElement("div",{className:"PhotoEditor__inner"},n.createElement(Pt,{current:t.props.ui.currentMode,change:t.props.setMode,setMode:t.setMode},n.createElement("div",{"data-mode":p.default.TABS.STICKERS},n.createElement(Dt,{stickerMouseDown:t.addSticker})),n.createElement("div",{"data-mode":p.default.TABS.TEXT},n.createElement(er,null)),n.createElement("div",{"data-mode":p.default.TABS.PAINT},n.createElement(Gt,null)),c&&!(null===(e=o.addons)||void 0===e?void 0:e.disableCrop)&&o.context===p.default.CONTEXT_TYPES.PHOTO&&n.createElement("div",{"data-mode":p.default.TABS.CROP},n.createElement(qt,null)),s&&n.createElement("div",{"data-mode":p.default.TABS.FILTERS,"data-disabled":i},n.createElement(hr,null)),s&&n.createElement("div",{"data-mode":p.default.TABS.COLOR,"data-disabled":i},n.createElement(ir,null))),n.createElement("div",{className:"PhotoEditor__actions"},n.createElement(_r,null),n.createElement("div",null,n.createElement(qe.default,{appearance:"secondary",onClick:t.props.data.close},Object(Ze.getLang)("photos_pe_cancel_action")),n.createElement(br.default,{appearance:"primary",loading:t.props.ui.isSaveLoading,disabled:t.isSaveDisabled,onClick:t.save},u))))},t.renderFontsPreloading=function(){return n.createElement("div",{className:"PhotoEditor__fontPreload"},p.default.FONTS.map((function(e){return n.createElement("span",{key:e,className:"PhotoEditorFontStyle--"+e})})))},t.save=function(){var e=t.props.data,r=e.artboardWidth,n=e.originalWidth,o=e.originalHeight,a=n/r;t.props.closeTextEditor(),t.props.setCurrentLayer(null),t.props.setSaveLoading(!0),setTimeout((function(){vr.draw(n,o,t.props.layers.items,t.props.drawings,a,t.getStickerUrlById).then((function(e){var r=e.blob,n=e.width,o=e.height,a=t.props,i=a.layers,s=a.drawings,c=a.background,u=a.settings,l=Object(U.prepareStat)(i.items,s,c.currentBackgroundType,c.currentBackgroundId),p=Object(U.prepareMediaEditorStat)(i.items,u),d=[];t.props.layers.items.forEach((function(e){e.clickableZones&&e.clickableZones.forEach((function(r){d.push(t.getPreparedClickableZone(e,r))}))}));var f={original_width:n,original_height:o,clickable_stickers:d};t.props.data.save(r,(function(){t.props.setSaveLoading(!1)}),{attachment:t.props.data.attachment,storyUploadUrlHash:t.props.data.storyUploadUrlHash,storySaveHash:t.props.data.storySaveHash,analytics:JSON.stringify(l),mediaEditorAnalytics:JSON.stringify(p),clickableStickers:JSON.stringify(f)})})).catch((function(e){t.props.setSaveLoading(!1),console.error(e)}))}),0)},t.getPreparedClickableZone=function(e,r){var n,o=t.props.data.originalWidth/t.props.data.artboardWidth,a=e.rotate*(Math.PI/180),i=e.x-e.width/2,s=e.y-e.height/2,c=parseFloat(e.x)+(i-e.x)*Math.cos(a)-(s-e.y)*Math.sin(a),u=parseFloat(e.y)+(s-e.y)*Math.cos(a)+(i-e.x)*Math.sin(a),l=null===(n=r.clickable_area)||void 0===n?void 0:n.map((function(t){var r=t.x*e.width,n=t.y*e.height,i=r*Math.cos(a)-n*Math.sin(a),s=r*Math.sin(a)+n*Math.cos(a);return{x:(c+i)*o,y:(u+s)*o}})),p={type:r.action_type,clickable_area:l};return"link"===r.action_type?(p.link=r.action.link,r.action.tooltip_text_key&&(p.tooltip_text_key=r.action.tooltip_text_key)):"app"===r.action_type&&(p.app_id=r.action.app_id,r.action.app_context&&(p.app_id=r.action.app_id)),p},t.handleKeyDown=function(e){if("Escape"==e.key&&t.props.layers.currentIndex&&t.props.layers.items[t.props.layers.currentIndex].isEdit&&(e.preventDefault(),e.stopPropagation(),t.props.closeTextEditor()),(e.ctrlKey||e.metaKey)&&"z"===e.key&&(e.shiftKey?t.props.redo():t.props.undo()),null!==t.props.layers.currentIndex&&"TEXTAREA"!==e.target.nodeName)if(["Backspace","Delete"].includes(e.key))e.preventDefault(),t.props.layers.items[t.props.layers.currentIndex].canDelete&&t.props.deleteLayer();else if(["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"].includes(e.key)){var r=t.getCurrentLayer();if(!r)return;var n={x:r.x,y:r.y},o=e.shiftKey?10:1;switch(e.key){case"ArrowUp":n.y-=o;break;case"ArrowDown":n.y+=o;break;case"ArrowLeft":n.x-=o;break;case"ArrowRight":n.x+=o}t.props.setLayerPosition(n.x,n.y)}},t.canvasMouseDown=function(e){var r=t.getCurrentLayer(),n=e.target;if("TEXTAREA"!==n.tagName)return!!n.closest(".EditorCanvas")&&(!n.closest(".SwitchMode")&&void([p.default.TABS.PAINT,p.default.TABS.FILTERS].includes(t.props.ui.currentMode)||(r&&r.type===p.default.LAYER_TYPES.TEXT&&r.isEdit?t.props.closeTextEditor():(t.props.ui.currentMode===p.default.TABS.COLOR&&t.props.settings.blur.isEnabled&&t.moveBlurStart(e),n.closest(".EditorLayer")?t.layerDragStart(e):r&&t.props.setCurrentLayer(null)))))},t.moveBlurStart=function(e){window.addEventListener("mousemove",t.moveBlurProcess),window.addEventListener("mouseup",t.moveBlurFinish),t.moveBlurProcess(e)},t.moveBlurProcess=function(e){var r=ie(e,document.querySelector(".EditorCanvas__canvas--bg")),n=r.x,o=r.y,a=r.width,i=r.height,s=[Math.max(0,Math.min(n/a,1)),1-Math.max(0,Math.min(o/i,1))];t.props.setBlurPosition(s)},t.moveBlurFinish=function(){window.removeEventListener("mousemove",t.moveBlurProcess),window.removeEventListener("mouseup",t.moveBlurFinish)},t.getCurrentLayer=function(){var e=t.props.layers,r=e.items,n=e.currentIndex;return null===n?n:r[n]},t.layerDragStart=function(e){window.addEventListener("mousemove",t.layerDragProcess),window.addEventListener("mouseup",t.layerDragFinish);var r,n=e.target.closest("[data-index]");r=n?+Object(Er.domData)(n,"index"):t.props.layers.currentIndex,t.props.layers.currentIndex!==r&&t.props.setCurrentLayer(r);var o=ie(e,document.querySelector(".EditorCanvas__canvas--draw")),a=o.x,i=o.y;if(t.currentLayer=t.getCurrentLayer(),t.currentLayer){var s=t.currentLayer;s.isBackground&&s.locked?t.props.setCurrentLayer(null):(t.clientX=e.clientX,t.clientY=e.clientY,t.shiftX=a-t.currentLayer.x,t.shiftY=i-t.currentLayer.y)}},t.layerDragProcess=function(e){if(t.currentLayer){var r=document.querySelector(".EditorCanvas__canvas--draw");if(r){var n=ie(e,r),o=n.x,a=n.y;if(void 0!==t.shiftX&&void 0!==t.shiftY){var i=o-t.shiftX,s=a-t.shiftY;t.props.setLayerPosition(i,s),t.props.ui.isShowDropBox||t.props.setShowDropBox(!0)}}}},t.layerDragFinish=function(e){if(window.removeEventListener("mousemove",t.layerDragProcess),window.removeEventListener("mouseup",t.layerDragFinish),t.getCurrentLayer()&&t.currentLayer&&void 0!==t.shiftX&&void 0!==t.shiftY){var r=document.querySelector(".EditorCanvas__canvas--draw");if(r){var n=ie(e,r),o=n.x,a=n.y,i=o-t.shiftX,s=a-t.shiftY;t.props.setLayerPosition(Math.round(i),Math.round(s)),t.props.setShowDropBox(!1),delete t.currentLayer,delete t.shiftX,delete t.shiftY,delete t.clientX,delete t.clientY}}},t.getStickerUrlById=function(e,r){var n=t.props.data.stickersMap[e];return n?n.sizes[r]:""},t.addSticker=function(e,r){e.persist();var n=document.querySelector(".EditorCanvas__canvas--draw");if(n){var o=ie(e.nativeEvent,n),a=o.width,i=o.height;t.props.addLayerSticker({id:r,x:a/2,y:i/2,width:p.default.LAYER_DEFAULT_SIZE,height:p.default.LAYER_DEFAULT_SIZE,rotate:0,canDelete:!0,scale:1})}},t.prepareStickers=function(e){var r=t.props.data,n=r.artboardWidth,o=r.artboardHeight;e.forEach((function(e){var r=e.sticker.transform||{},a=r.gravity,i=void 0===a?"center":a,s=r.rotation,c=void 0===s?0:s,u=r.translation_x,l=void 0===u?0:u,d=r.translation_y,f=void 0===d?0:d,h=r.relation_width;if(l=Math.min(Math.max(l,-1),1),f=Math.min(Math.max(f,-1),1),h&&(h=Math.min(Math.max(h,.1),1)),"renderable"===e.sticker_type)t.prepareRenderableSticker(e.sticker,i,l,f,h).then((function(e){var r=e.url,n=e.x,o=e.y,a=e.stickerWidth,i=e.stickerHeight,s=e.clickableZones;t.props.addLayerImage({url:r,x:n,y:o,width:Math.round(a),height:Math.round(i),rotate:-c,clickableZones:s,canDelete:!0,scale:1})})).catch((function(e){console.error(e)}));else if("native"===e.sticker_type)switch(e.sticker.action_type){case"sticker":var m=h?n*h:p.default.LAYER_DEFAULT_SIZE,_=h?n*h:p.default.LAYER_DEFAULT_SIZE,v=e.sticker.action.pack_id+"_"+e.sticker.action.sticker_id;if(t.props.data.stickersMap[v]){var g=ue(i,n,o,m/2,_/2,l*n,f*o),y=g.x,E=g.y;t.props.addLayerSticker({id:v,x:y,y:E,width:m,height:_,rotate:-c,canDelete:!0,scale:1})}break;case"text":var b=.5;h&&(b=t.getFontSize(e.sticker.action.text,n*h,e.sticker.action.style));var S=t.getTextRect(e.sticker.action.text,b*p.default.FONT_SIZE_COEFFICIENT,e.sticker.action.style),T=(m=S.width,_=S.height,ue(i,n,o,m/2,_/2,l*n,f*o));y=T.x,E=T.y;t.props.addLayerText(!1,{text:e.sticker.action.text,style:e.sticker.action.style,color:e.sticker.action.selection_color,fontSize:b,initialFontSize:b,rotate:-c,scale:1,x:y,y:E})}}))},t.prepareRenderableSticker=function(e,r,n,o,a){var i=t.props.data,s=i.artboardWidth,c=i.artboardHeight,u=i.originalWidth/s;return new Promise((function(t,i){"string"!=typeof e.url&&"string"!=typeof e.blob&&i();var l=e.url||e.blob||"";ae(l).then((function(i){var p=i.height/i.width,d=0,f=0;a?f=(d=s*a)*p:(d=i.width/u,f=i.height/u,d>s&&(f=(d=s)*p));var h,m=ue(r,s,c,d/2,f/2,n*s,o*c),_=m.x,v=m.y;e.clickable_zones&&(h=e.clickable_zones.map((function(e){var t;return t=e.clickable_area?e.clickable_area.map((function(e){return{x:e.x/i.width,y:e.y/i.height}})):[{x:0,y:0},{x:1,y:0},{x:1,y:1},{x:0,y:1}],wr(wr({},e),{clickable_area:t})}))),t({url:l,x:_,y:v,stickerWidth:d,stickerHeight:f,clickableZones:h})})).catch((function(){i()}))}))},t.getTextRect=function(e,t,r){var n=document.createElement("span");n.innerHTML=e,n.style.display="inline-block",n.style.fontSize=t+"px",n.style.lineHeight="1em",n.style.whiteSpace="pre",r&&n.classList.add("PhotoEditorFontStyle--"+r),document.body.append(n);var o=n.getBoundingClientRect();return n.remove(),o},t.getFontSize=function(e,t,r){var n=2*t,o=document.createElement("span");for(o.innerHTML=e,o.style.display="inline-block",o.style.width=t+"px",o.style.fontSize=n+"px",o.style.lineHeight="1em",o.style.whiteSpace="pre",r&&o.classList.add("PhotoEditorFontStyle--"+r),document.body.append(o);n&&o.scrollWidth>Math.round(t);)n--,o.style.fontSize=n+"px";return o.remove(),n/100},t.uploadPhoto=function(e){ce().then((function(r){e&&e(),t.props.setCurrentPhotoUrl(r)})).catch((function(){window.showFastBox({title:Object(Ze.getLang)("global_error")},Object(Ze.getLang)("stories_create_image_incorrect"))}))},t.setMode=function(e){var r=t.props.ui,n=t.props.background,o=n.currentBackgroundType,a=n.currentPhotoUrl;t.props.setCurrentLayer(null),e===p.default.BACKGROUND_MODES.PHOTO&&!a||o===p.default.BACKGROUND_MODES.PHOTO&&o===e?t.uploadPhoto((function(){t.props.setBackgroundType(e)})):(t.props.setBackgroundType(e),e===p.default.BACKGROUND_MODES.BACKGROUND&&[p.default.TABS.COLOR,p.default.TABS.FILTERS].includes(r.currentMode)&&t.props.setMode(p.default.TABS.STICKERS))},t}return Tr(t,e),t}(n.Component),Cr=Object.assign(s.ActionCreators,{setMode:$,addLayerSticker:function(e){return Object(U.sendStat)(U.EVENTS.ADD_STICKER),G("ADD_LAYER_STICKER",{type:p.default.LAYER_TYPES.STICKER,id:e.id,x:e.x,y:e.y,width:e.width,height:e.height,rotate:e.rotate,canDelete:e.canDelete,scale:e.scale})},addLayerText:z,addLayerImage:function(e){return G("ADD_LAYER_IMAGE",{type:p.default.LAYER_TYPES.IMAGE,url:e.url,x:e.x,y:e.y,width:e.width,height:e.height,rotate:e.rotate,clickableZones:e.clickableZones,canDelete:e.canDelete,scale:e.scale})},setLayerPosition:function(e,t){return function(r,n){var o=n().present.layers,a=o.currentIndex,i=o.items;null!==a&&i[a]&&r({type:"SET_LAYER_POSITION",payload:{x:e,y:t}})}},deleteLayer:K,setCurrentLayer:Y,setDataLoaded:function(){return{type:"SET_DATA_LOADED"}},setShowDropBox:Z,setSaveLoading:function(e){return{type:"SET_SAVE_LOADING",value:e}},closeTextEditor:q,setData:re,setBlurPosition:function(e){return{type:y,position:e}},setCurrentPhotoUrl:te,setBackgroundType:ee}),xr=Object(a.connect)((function(e){return{ui:e.present.ui,settings:e.present.settings,layers:e.present.layers,drawings:e.present.drawings,background:e.present.background,data:e.present.data}}),Cr)(Or),Pr=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),Rr=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.getBackgroundType=function(){var e=p.default.CONTEXT_TYPES,r=p.default.BACKGROUND_MODES;return t.props.context===e.STORY?t.props.photoUrl?r.PHOTO:r.BACKGROUND:r.PHOTO},t}return Pr(t,e),t.prototype.render=function(){var e,t,r;return window.cur.photoEditorStore=(e={data:this.props,background:{currentBackgroundType:this.getBackgroundType(),currentPhotoUrl:this.props.photoUrl,currentBackgroundId:1}},t=Object(s.newHistory)([],e,[]),r=u.composeWithDevTools(Object(i.applyMiddleware)(l.default)),Object(i.createStore)(F,t,r)),n.createElement(a.Provider,{store:window.cur.photoEditorStore},n.createElement(xr,{stickers:this.props.stickers}))},t.defaultProps={originalWidth:p.default.STORY_BASE_WIDTH,originalHeight:p.default.STORY_BASE_HEIGHT},t}(n.Component);t.default=Rr},"1VNw":function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ActionCreators=t.ActionTypes=void 0;var n={UNDO:"@@redux-undo/UNDO",REDO:"@@redux-undo/REDO",JUMP_TO_FUTURE:"@@redux-undo/JUMP_TO_FUTURE",JUMP_TO_PAST:"@@redux-undo/JUMP_TO_PAST",JUMP:"@@redux-undo/JUMP",CLEAR_HISTORY:"@@redux-undo/CLEAR_HISTORY"};t.ActionTypes=n;var o={undo:function(){return{type:n.UNDO}},redo:function(){return{type:n.REDO}},jumpToFuture:function(e){return{type:n.JUMP_TO_FUTURE,index:e}},jumpToPast:function(e){return{type:n.JUMP_TO_PAST,index:e}},jump:function(e){return{type:n.JUMP,index:e}},clearHistory:function(){return{type:n.CLEAR_HISTORY}}};t.ActionCreators=o},"1y80":function(e,t,r){"use strict";function n(e,t,r,n,o){return window.statlogsValueEvent(e,t,r,n,o)}function o(e){return Math.random()<e}function a(e,t,r,a,i,s){o(e)&&n(t,r,a,i,s)}r.r(t),r.d(t,"statlogsValueEvent",(function(){return n})),r.d(t,"randEnabled",(function(){return o})),r.d(t,"statlogsProbValueEvent",(function(){return a}))},282:function(e,t,r){e.exports=r("8o6h")},"2mql":function(e,t,r){"use strict";var n=r("TOwV"),o={childContextTypes:!0,contextType:!0,contextTypes:!0,defaultProps:!0,displayName:!0,getDefaultProps:!0,getDerivedStateFromError:!0,getDerivedStateFromProps:!0,mixins:!0,propTypes:!0,type:!0},a={name:!0,length:!0,prototype:!0,caller:!0,callee:!0,arguments:!0,arity:!0},i={$$typeof:!0,compare:!0,defaultProps:!0,displayName:!0,propTypes:!0,type:!0},s={};function c(e){return n.isMemo(e)?i:s[e.$$typeof]||o}s[n.ForwardRef]={$$typeof:!0,render:!0,defaultProps:!0,displayName:!0,propTypes:!0},s[n.Memo]=i;var u=Object.defineProperty,l=Object.getOwnPropertyNames,p=Object.getOwnPropertySymbols,d=Object.getOwnPropertyDescriptor,f=Object.getPrototypeOf,h=Object.prototype;e.exports=function e(t,r,n){if("string"!=typeof r){if(h){var o=f(r);o&&o!==h&&e(t,o,n)}var i=l(r);p&&(i=i.concat(p(r)));for(var s=c(t),m=c(r),_=0;_<i.length;++_){var v=i[_];if(!(a[v]||n&&n[v]||m&&m[v]||s&&s[v])){var g=d(r,v);try{u(t,v,g)}catch(e){}}}}return t}},"2zsc":function(e,t,r){"use strict";r.r(t);var n=r("q1tI"),o=r.n(n),a=function(){return(a=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var o in t=arguments[r])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)},i=function(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(n=Object.getOwnPropertySymbols(e);o<n.length;o++)t.indexOf(n[o])<0&&Object.prototype.propertyIsEnumerable.call(e,n[o])&&(r[n[o]]=e[n[o]])}return r};t.default=function(e){var t=e.children,r=e.className,n=i(e,["children","className"]),s=t?String(t):"";return o.a.createElement("span",a({},n,{dangerouslySetInnerHTML:{__html:s},className:r||""}))}},"3UD+":function(e,t){e.exports=function(e){if(!e.webpackPolyfill){var t=Object.create(e);t.children||(t.children=[]),Object.defineProperty(t,"loaded",{enumerable:!0,get:function(){return t.l}}),Object.defineProperty(t,"id",{enumerable:!0,get:function(){return t.i}}),Object.defineProperty(t,"exports",{enumerable:!0}),t.webpackPolyfill=1}return t}},"6krn":function(e,t,r){"use strict";r.r(t),r.d(t,"getLang",(function(){return i}));var n=r("nAFc"),o=r("4+be"),a={};function i(e,t,r){void 0===t&&(t=!1);var i="number"==typeof t,s=t||i,c=e+(s?".raw":"");if(void 0===a[c]){var u=s?Object(o.getLang)(e,"raw"):Object(o.getLang)(e);"string"==typeof u?a[c]=Object(n.decodeHTMLEntities)(u):Array.isArray(u)&&(a[c]=u.map(n.decodeHTMLEntities))}if(i){var l=t;return Object(o.langNumeric)(l,a[c],r)}return a[c]||""}t.default={getLang:i}},"754W":function(e,t,r){"use strict";r.r(t);r("91GP"),r("ioFf"),r("rGqo"),r("Btvt");var n=r("q1tI"),o=(r("17x9"),r("ZxpX"));function a(){return(a=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e}).apply(this,arguments)}function i(e,t){if(null==e)return{};var r,n,o=function(e,t){if(null==e)return{};var r,n,o={},a=Object.keys(e);for(n=0;n<a.length;n++)r=a[n],t.indexOf(r)>=0||(o[r]=e[r]);return o}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(n=0;n<a.length;n++)r=a[n],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(o[r]=e[r])}return o}t.default=e=>{var t=e.children,r=e.className,s=i(e,["children","className"]),c=Object(o.classNames)("LinkButton",r),u=a({},s,{onMouseDown:e=>{e.preventDefault(),s.onMouseDown&&s.onMouseDown(e)}});return n.createElement("button",a({},u,{className:c}),t)}},"8o6h":function(e,t,r){"use strict";r.r(t);var n=r("qJhe");window.StoryPublisher=n.StoryPublisher;try{window.stManager.done(window.jsc("web/story_publisher.js"))}catch(e){}},"9O7i":function(e,t,r){"use strict";function n(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return Array.isArray(e)?e:"string"==typeof e?[e]:t}Object.defineProperty(t,"__esModule",{value:!0}),t.parseActions=n,t.isHistory=function(e){return void 0!==e.present&&void 0!==e.future&&void 0!==e.past&&Array.isArray(e.future)&&Array.isArray(e.past)},t.includeAction=function(e){var t=n(e);return function(e){return t.indexOf(e.type)>=0}},t.excludeAction=function(e){var t=n(e);return function(e){return t.indexOf(e.type)<0}},t.combineFilters=function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return t.reduce((function(e,t){return function(r,n,o){return e(r,n,o)&&t(r,n,o)}}),(function(){return!0}))},t.groupByActionTypes=function(e){var t=n(e);return function(e){return t.indexOf(e.type)>=0?e.type:null}},t.newHistory=function(e,t,r){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;return{past:e,present:t,future:r,group:n,_latestUnfiltered:t,index:e.length,limit:e.length+r.length+1}}},ANjH:function(e,t,r){"use strict";r.r(t),r.d(t,"createStore",(function(){return s})),r.d(t,"combineReducers",(function(){return u})),r.d(t,"bindActionCreators",(function(){return p})),r.d(t,"applyMiddleware",(function(){return m})),r.d(t,"compose",(function(){return h})),r.d(t,"__DO_NOT_USE__ActionTypes",(function(){return a}));var n=r("bCCX"),o=function(){return Math.random().toString(36).substring(7).split("").join(".")},a={INIT:"@@redux/INIT"+o(),REPLACE:"@@redux/REPLACE"+o(),PROBE_UNKNOWN_ACTION:function(){return"@@redux/PROBE_UNKNOWN_ACTION"+o()}};function i(e){if("object"!=typeof e||null===e)return!1;for(var t=e;null!==Object.getPrototypeOf(t);)t=Object.getPrototypeOf(t);return Object.getPrototypeOf(e)===t}function s(e,t,r){var o;if("function"==typeof t&&"function"==typeof r||"function"==typeof r&&"function"==typeof arguments[3])throw new Error("It looks like you are passing several store enhancers to createStore(). This is not supported. Instead, compose them together to a single function");if("function"==typeof t&&void 0===r&&(r=t,t=void 0),void 0!==r){if("function"!=typeof r)throw new Error("Expected the enhancer to be a function.");return r(s)(e,t)}if("function"!=typeof e)throw new Error("Expected the reducer to be a function.");var c=e,u=t,l=[],p=l,d=!1;function f(){p===l&&(p=l.slice())}function h(){if(d)throw new Error("You may not call store.getState() while the reducer is executing. The reducer has already received the state as an argument. Pass it down from the top reducer instead of reading it from the store.");return u}function m(e){if("function"!=typeof e)throw new Error("Expected the listener to be a function.");if(d)throw new Error("You may not call store.subscribe() while the reducer is executing. If you would like to be notified after the store has been updated, subscribe from a component and invoke store.getState() in the callback to access the latest state. See https://redux.js.org/api-reference/store#subscribe(listener) for more details.");var t=!0;return f(),p.push(e),function(){if(t){if(d)throw new Error("You may not unsubscribe from a store listener while the reducer is executing. See https://redux.js.org/api-reference/store#subscribe(listener) for more details.");t=!1,f();var r=p.indexOf(e);p.splice(r,1)}}}function _(e){if(!i(e))throw new Error("Actions must be plain objects. Use custom middleware for async actions.");if(void 0===e.type)throw new Error('Actions may not have an undefined "type" property. Have you misspelled a constant?');if(d)throw new Error("Reducers may not dispatch actions.");try{d=!0,u=c(u,e)}finally{d=!1}for(var t=l=p,r=0;r<t.length;r++){(0,t[r])()}return e}function v(e){if("function"!=typeof e)throw new Error("Expected the nextReducer to be a function.");c=e,_({type:a.REPLACE})}function g(){var e,t=m;return(e={subscribe:function(e){if("object"!=typeof e||null===e)throw new TypeError("Expected the observer to be an object.");function r(){e.next&&e.next(h())}return r(),{unsubscribe:t(r)}}})[n.default]=function(){return this},e}return _({type:a.INIT}),(o={dispatch:_,subscribe:m,getState:h,replaceReducer:v})[n.default]=g,o}function c(e,t){var r=t&&t.type;return"Given "+(r&&'action "'+String(r)+'"'||"an action")+', reducer "'+e+'" returned undefined. To ignore an action, you must explicitly return the previous state. If you want this reducer to hold no value, you can return null instead of undefined.'}function u(e){for(var t=Object.keys(e),r={},n=0;n<t.length;n++){var o=t[n];0,"function"==typeof e[o]&&(r[o]=e[o])}var i,s=Object.keys(r);try{!function(e){Object.keys(e).forEach((function(t){var r=e[t];if(void 0===r(void 0,{type:a.INIT}))throw new Error('Reducer "'+t+"\" returned undefined during initialization. If the state passed to the reducer is undefined, you must explicitly return the initial state. The initial state may not be undefined. If you don't want to set a value for this reducer, you can use null instead of undefined.");if(void 0===r(void 0,{type:a.PROBE_UNKNOWN_ACTION()}))throw new Error('Reducer "'+t+"\" returned undefined when probed with a random type. Don't try to handle "+a.INIT+' or other actions in "redux/*" namespace. They are considered private. Instead, you must return the current state for any unknown actions, unless it is undefined, in which case you must return the initial state, regardless of the action type. The initial state may not be undefined, but can be null.')}))}(r)}catch(e){i=e}return function(e,t){if(void 0===e&&(e={}),i)throw i;for(var n=!1,o={},a=0;a<s.length;a++){var u=s[a],l=r[u],p=e[u],d=l(p,t);if(void 0===d){var f=c(u,t);throw new Error(f)}o[u]=d,n=n||d!==p}return n?o:e}}function l(e,t){return function(){return t(e.apply(this,arguments))}}function p(e,t){if("function"==typeof e)return l(e,t);if("object"!=typeof e||null===e)throw new Error("bindActionCreators expected an object or a function, instead received "+(null===e?"null":typeof e)+'. Did you write "import ActionCreators from" instead of "import * as ActionCreators from"?');for(var r=Object.keys(e),n={},o=0;o<r.length;o++){var a=r[o],i=e[a];"function"==typeof i&&(n[a]=l(i,t))}return n}function d(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function f(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),n.forEach((function(t){d(e,t,r[t])}))}return e}function h(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return 0===t.length?function(e){return e}:1===t.length?t[0]:t.reduce((function(e,t){return function(){return e(t.apply(void 0,arguments))}}))}function m(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return function(e){return function(){var r=e.apply(void 0,arguments),n=function(){throw new Error("Dispatching while constructing your middleware is not allowed. Other middleware would not be applied to this dispatch.")},o={getState:r.getState,dispatch:function(){return n.apply(void 0,arguments)}},a=t.map((function(e){return e(o)}));return f({},r,{dispatch:n=h.apply(void 0,a)(r.dispatch)})}}}},FEd1:function(e,t,r){"use strict";function n(e){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};o.set(t.debug);var r,n=u({limit:void 0,filter:function(){return!0},groupBy:function(){return null},undoType:a.ActionTypes.UNDO,redoType:a.ActionTypes.REDO,jumpToPastType:a.ActionTypes.JUMP_TO_PAST,jumpToFutureType:a.ActionTypes.JUMP_TO_FUTURE,jumpType:a.ActionTypes.JUMP,neverSkipReducer:!1,ignoreInitialState:!1,syncFilter:!1},t,{initTypes:(0,i.parseActions)(t.initTypes,["@@redux-undo/INIT"]),clearHistoryType:(0,i.parseActions)(t.clearHistoryType,[a.ActionTypes.CLEAR_HISTORY])}),s=n.neverSkipReducer?function(t,r){for(var n=arguments.length,o=new Array(n>2?n-2:0),a=2;a<n;a++)o[a-2]=arguments[a];return u({},t,{present:e.apply(void 0,[t.present,r].concat(o))})}:function(e){return e};return function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:r,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};o.start(a,t);for(var c,u=t,l=arguments.length,p=new Array(l>2?l-2:0),g=2;g<l;g++)p[g-2]=arguments[g];if(!r){if(o.log("history is uninitialized"),void 0===t){var y={type:"@@redux-undo/CREATE_HISTORY"},E=e.apply(void 0,[t,y].concat(p));return u=d(E,n.ignoreInitialState),o.log("do not set initialState on probe actions"),o.end(u),u}(0,i.isHistory)(t)?(u=r=n.ignoreInitialState?t:(0,i.newHistory)(t.past,t.present,t.future),o.log("initialHistory initialized: initialState is a history",r)):(u=r=d(t,n.ignoreInitialState),o.log("initialHistory initialized: initialState is not a history",r))}switch(a.type){case void 0:return u;case n.undoType:return c=_(u,-1),o.log("perform undo"),o.end(c),s.apply(void 0,[c,a].concat(p));case n.redoType:return c=_(u,1),o.log("perform redo"),o.end(c),s.apply(void 0,[c,a].concat(p));case n.jumpToPastType:return c=m(u,a.index),o.log("perform jumpToPast to ".concat(a.index)),o.end(c),s.apply(void 0,[c,a].concat(p));case n.jumpToFutureType:return c=h(u,a.index),o.log("perform jumpToFuture to ".concat(a.index)),o.end(c),s.apply(void 0,[c,a].concat(p));case n.jumpType:return c=_(u,a.index),o.log("perform jump to ".concat(a.index)),o.end(c),s.apply(void 0,[c,a].concat(p));case v(a.type,n.clearHistoryType):return c=d(u.present,n.ignoreInitialState),o.log("perform clearHistory"),o.end(c),s.apply(void 0,[c,a].concat(p));default:if(c=e.apply(void 0,[u.present,a].concat(p)),n.initTypes.some((function(e){return e===a.type})))return o.log("reset history due to init action"),o.end(r),r;if(u._latestUnfiltered===c)return u;var b="function"==typeof n.filter&&!n.filter(a,c,u);if(b){var S=(0,i.newHistory)(u.past,c,u.future,u.group);return n.syncFilter||(S._latestUnfiltered=u._latestUnfiltered),o.log("filter ignored action, not storing it in past"),o.end(S),S}var T=n.groupBy(a,c,u);if(null!=T&&T===u.group){var w=(0,i.newHistory)(u.past,c,u.future,u.group);return o.log("groupBy grouped the action with the previous action"),o.end(w),w}return u=f(u,c,n.limit,T),o.log("inserted new state into history"),o.end(u),u}}};var o=function(e){if(e&&e.__esModule)return e;if(null===e||"object"!==n(e)&&"function"!=typeof e)return{default:e};var t=s();if(t&&t.has(e))return t.get(e);var r={},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if(Object.prototype.hasOwnProperty.call(e,a)){var i=o?Object.getOwnPropertyDescriptor(e,a):null;i&&(i.get||i.set)?Object.defineProperty(r,a,i):r[a]=e[a]}r.default=e,t&&t.set(e,r);return r}(r("Hh3O")),a=r("1VNw"),i=r("9O7i");function s(){if("function"!=typeof WeakMap)return null;var e=new WeakMap;return s=function(){return e},e}function c(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function u(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?c(Object(r),!0).forEach((function(t){l(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):c(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function l(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function p(e){return function(e){if(Array.isArray(e)){for(var t=0,r=new Array(e.length);t<e.length;t++)r[t]=e[t];return r}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function d(e,t){var r=(0,i.newHistory)([],e,[]);return t&&(r._latestUnfiltered=null),r}function f(e,t,r,n){var a=e.past.length+1;o.log("inserting",t),o.log("new free: ",r-a);var s=e.past,c=e._latestUnfiltered,u=r&&r<=a,l=s.slice(u?1:0),d=null!=c?[].concat(p(l),[c]):l;return(0,i.newHistory)(d,t,[],n)}function h(e,t){if(t<0||t>=e.future.length)return e;var r=e.past,n=e.future,o=e._latestUnfiltered,a=[].concat(p(r),[o],p(n.slice(0,t))),s=n[t],c=n.slice(t+1);return(0,i.newHistory)(a,s,c)}function m(e,t){if(t<0||t>=e.past.length)return e;var r=e.past,n=e.future,o=e._latestUnfiltered,a=r.slice(0,t),s=[].concat(p(r.slice(t+1)),[o],p(n)),c=r[t];return(0,i.newHistory)(a,c,s)}function _(e,t){return t>0?h(e,t-1):t<0?m(e,e.past.length+t):e}function v(e,t){return t.indexOf(e)>-1?e:!e}},Hh3O:function(e,t,r){"use strict";function n(e){return function(e){if(Array.isArray(e)){for(var t=0,r=new Array(e.length);t<e.length;t++)r[t]=e[t];return r}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}var o,a;Object.defineProperty(t,"__esModule",{value:!0}),t.set=function(e){o=e},t.start=function(e,t){void(a={header:[],prev:[],action:[],next:[],msgs:[]}),o&&(console.group?(a.header=["%credux-undo","font-style: italic","action",e.type],a.action=u("action",s,e),a.prev=u("prev history",i,t)):(a.header=["redux-undo action",e.type],a.action=["action",e],a.prev=["prev history",t]))},t.end=function(e){o&&(console.group?a.next=u("next history",c,e):a.next=["next history",e],function(){var e=a,t=e.header,r=e.prev,o=e.next,i=e.action,s=e.msgs;if(console.group){var c,u,l,p,d;(c=console).groupCollapsed.apply(c,n(t)),(u=console).log.apply(u,n(r)),(l=console).log.apply(l,n(i)),(p=console).log.apply(p,n(o)),(d=console).log.apply(d,n(s)),console.groupEnd()}else{var f,h,m,_,v;(f=console).log.apply(f,n(t)),(h=console).log.apply(h,n(r)),(m=console).log.apply(m,n(i)),(_=console).log.apply(_,n(o)),(v=console).log.apply(v,n(s))}}())},t.log=function(){if(o){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];a.msgs=a.msgs.concat([].concat(t,["\n"]))}};var i="#9E9E9E",s="#03A9F4",c="#4CAF50";function u(e,t,r){return["%c".concat(e),"color: ".concat(t,"; font-weight: bold"),r]}},JX7q:function(e,t,r){"use strict";function n(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}r.r(t),r.d(t,"default",(function(){return n}))},PU8N:function(e,t,r){"use strict";r.r(t),r.d(t,"isMvk",(function(){return o})),r.d(t,"getVideoDuration",(function(){return a})),r.d(t,"getMediaBlob",(function(){return i})),r.d(t,"getBlobType",(function(){return s})),r.d(t,"noop",(function(){return c})),r.d(t,"getAverageRGB",(function(){return u})),r.d(t,"loadImage",(function(){return l})),r.d(t,"loadImages",(function(){return p})),r.d(t,"loadFontFace",(function(){return d})),r.d(t,"loadFontFacePromise",(function(){return f})),r.d(t,"getCroppedImage",(function(){return h}));var n=function(){return(n=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var o in t=arguments[r])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)};function o(){return!!window.isMVK}function a(e){return void 0===e&&(e=""),new Promise((function(t,r){var n=document.createElement("video");n.addEventListener("loadedmetadata",(function(){return t(n.duration)}),{once:!0}),n.addEventListener("error",r,{once:!0}),n.crossOrigin="anonymous",n.preload="metadata",n.src=e}))}function i(e){return new Promise((function(t,r){var n=new XMLHttpRequest;n.open("GET",e,!0),n.responseType="blob",n.onload=function(){if(404===n.response.status)return r();t(n.response)},n.onerror=r,n.send()}))}function s(e){try{return e.type.split("/").splice(-1)[0]}catch(e){return null}}var c=function(){};function u(e){var t,r={r:0,g:0,b:0};try{t=e.getImageData(0,0,e.canvas.width,e.canvas.height)}catch(e){return r}for(var n=-4,o=0;(n+=20)<t.data.length;)++o,r.r+=t.data[n],r.g+=t.data[n+1],r.b+=t.data[n+2];return r.r=~~(r.r/o),r.g=~~(r.g/o),r.b=~~(r.b/o),r}function l(e){return new Promise((function(t,r){var n=new Image;n.crossOrigin=e.startsWith("data:")?null:"Anonymous",n.onerror=function(){return r(new Error("Failed to load image's URL: "+e))},n.onload=function(){return t(n)},n.src=e}))}var p=function(e){return new Promise((function(t){var r=e.map((function(e){return l(e)}));Promise.all(r).then((function(e){return t(e)})).catch((function(){}))}))};function d(e,t){var r,n,o,a,i,s,c,u,l={normal:"400",500:"500",600:"600",bold:"700"},p={tolerance:2,delay:100,glyphs:"",success:function(){},error:function(){},timeout:5e3,weight:"400",style:"normal"},d={display:"block","font-size":"48px","line-height":"normal","font-variant":"normal","white-space":"nowrap",position:"absolute",visibility:"hidden",top:"-9999px",left:"-9999px",width:"auto",height:"auto",margin:"0",padding:"0"};function f(e){var t=[];return each(e,(function(e,r){t.push(e+":"+r)})),t.join(";")}function h(e,t,r){return Math.abs(e.width-t.offsetWidth)>r||Math.abs(e.height-t.offsetHeight)>r}function m(){a||(utilsNode.appendChild(i),a=!0,o={sansSerif:{width:c.offsetWidth,height:c.offsetHeight},serif:{width:s.offsetWidth,height:s.offsetHeight}},browser.opera&&!browser.chrome?(c.style.fontFamily='"'+e+'", sans-serif',s.style.fontFamily='"'+e+'", serif'):(setStyle(c,"font-family",'"'+e+'", sans-serif'),setStyle(s,"font-family",'"'+e+'", serif'))),a&&o&&(h(o.sansSerif,c,t.tolerance)||h(o.serif,s,t.tolerance))?(re(i),t.success()):(new Date).getTime()-n.getTime()>t.timeout?(re(i),t.error()):!a&&"requestAnimationFrame"in window?window.requestAnimationFrame(m):window.setTimeout(m,t.delay)}for(var _ in p)t.hasOwnProperty(_)||(t[_]=p[_]);d["font-weight"]=t.weight,d["font-style"]=t.style,!t.glyphs&&"fonts"in document?(t.timeout&&(r=setTimeout((function(){t.error()}),t.timeout)),function(r){each(null===document||void 0===document?void 0:document.fonts,(function(n){n.family.toLowerCase()===e.toLowerCase()&&(l[n.weight]||n.weight)===""+t.weight&&n.style===t.style&&n.load().then((function(){t.success(),clearTimeout(r)}))}))}(r)):(u="AxmTYklsjo190QW"+t.glyphs,n=new Date,i=ce("div"),c=ce("div",{innerHTML:u}),s=ce("div",{innerHTML:u}),c.setAttribute("style",f(extend({"font-family":"sans-serif"},d))),s.setAttribute("style",f(extend({"font-family":"serif"},d))),i.appendChild(c),i.appendChild(s),m())}function f(e,t){return new Promise((function(r,o){d(e,n(n({},t),{glyphs:"",success:function(){var e=function(){r(),(null==t?void 0:t.success)&&t.success()};browser.safari?setTimeout(e,150):e()},error:function(){o(),(null==t?void 0:t.error)&&t.error()}}))}))}function h(e,t,r,n,o){return new Promise((function(a,i){("string"==typeof e?l(e):Promise.resolve(e)).then((function(e){var s=document.createElement("canvas");s.width=e.width,s.height=e.height;var c=s.getContext("2d");if(c){c.drawImage(e,0,0);var u=c.getImageData(t,r,n,o),p=document.createElement("canvas");p.width=n,p.height=o;var d=p.getContext("2d");if(d)return d.putImageData(u,0,0),l(p.toDataURL("image/jpeg",1)).then(a).catch(i);a(e)}else a(e)})).catch(i)}))}},PjZB:function(e,t,r){"use strict";r.r(t),r.d(t,"default",(function(){return a}));r("rGqo"),r("a1Th"),r("Btvt");var n=r("q1tI"),o=(r("17x9"),r("ZxpX"));class a extends n.Component{constructor(e){super(e),this.id=Math.round(1e6*Math.random()).toString(16),this.setSpinnerParams(e)}componentWillReceiveProps(e){this.setSpinnerParams(e)}setSpinnerParams(e){this.offset=Math.round(Math.PI*e.size),this.c=.5*e.size,this.animation=function(e,t){if(!e||!t)return"";var r=Object.keys(t).map(e=>e+" {"+Object.keys(t[e]).map(r=>r+":"+t[e][r]).join(";")+"}").join("");return`@-webkit-keyframes ${e} {${r}} @keyframes ${e} {${r}}`}("dash"+this.id,{"0%":{"stroke-dashoffset":this.offset},"50%":{"stroke-dashoffset":Math.round(.25*this.offset),transform:"rotate(135deg)"},"100%":{"stroke-dashoffset":this.offset,transform:"rotate(360deg)"}})}render(){var e=this.props,t=e.style,r=e.color,a=e.size,i=e.duration,s=e.strokeWidth,c=e.className,u=this.id,l=this.offset,p=this.animation,d=Object(o.classNames)("Spinner",c);return n.createElement("div",{className:d,style:t},n.createElement("svg",{className:"Spinner__svg",width:a,height:a,viewBox:`0 0 ${a} ${a}`,xmlns:"http://www.w3.org/2000/svg"},n.createElement("g",{style:{width:a,height:a,transformOrigin:.5*a+"px "+.5*a+"px"}},n.createElement("style",{dangerouslySetInnerHTML:{__html:p}}),n.createElement("circle",{className:"Spinner__path",fill:"none",stroke:r,strokeDasharray:l,strokeDashoffset:l,strokeWidth:s,style:{animationName:"dash"+u,animationTimingFunction:"ease-in-out",animationDuration:i+"s",animationIterationCount:"infinite"},cx:.5*a,cy:.5*a,r:.5*a-.5*s}))))}}a.defaultProps={color:"#5181b8",size:19,strokeWidth:2,duration:1.4,className:""}},QLaP:function(e,t,r){"use strict";e.exports=function(e,t,r,n,o,a,i,s){if(!e){var c;if(void 0===t)c=new Error("Minified exception occurred; use the non-minified dev environment for the full error message and additional helpful warnings.");else{var u=[r,n,o,a,i,s],l=0;(c=new Error(t.replace(/%s/g,(function(){return u[l++]})))).name="Invariant Violation"}throw c.framesToPop=1,c}}},SLVX:function(e,t,r){"use strict";function n(e){var t,r=e.Symbol;return"function"==typeof r?r.observable?t=r.observable:(t=r("observable"),r.observable=t):t="@@observable",t}r.r(t),r.d(t,"default",(function(){return n}))},TBLV:function(e,t,r){"use strict";r.r(t);r("91GP"),r("ioFf"),r("rGqo"),r("Btvt");var n=r("q1tI"),o=(r("17x9"),r("ZxpX"));function a(){return(a=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e}).apply(this,arguments)}function i(e,t){if(null==e)return{};var r,n,o=function(e,t){if(null==e)return{};var r,n,o={},a=Object.keys(e);for(n=0;n<a.length;n++)r=a[n],t.indexOf(r)>=0||(o[r]=e[r]);return o}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(n=0;n<a.length;n++)r=a[n],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(o[r]=e[r])}return o}var s=e=>{var t=e.className,r=e.children,s=i(e,["className","children"]),c=Object(o.classNames)("Radio",t,{"Radio--disabled":e.disabled});return n.createElement("label",{className:c},n.createElement("input",a({className:"Radio__input Radio__visuallyHidden",type:"radio"},s)),n.createElement("span",{className:"Radio__control"}),Boolean(r)&&n.createElement("span",{className:"Radio__text"},r))};s.defaultProps={className:"",name:void 0,onChange:void 0,checked:void 0,defaultChecked:void 0,autoFocus:!1,disabled:!1,children:null},t.default=s},TOwV:function(e,t,r){"use strict";e.exports=r("qT12")},TfWv:function(e,t,r){"use strict";r.r(t);var n,o=r("q1tI"),a=r("i8i4"),i=r("clTp"),s=r("qihR"),c=(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),u=function(){return(u=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var o in t=arguments[r])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)},l=function(e){var t=e.position,r=e.align,n=e.text,o=e.rect,a=e.marginTop,i=e.marginLeft,s=e.maxWidth,c=e.appearance,u=e.className,l=o.left,p=o.top;switch(t){case"t":l+=.5*o.width;break;case"r":l+=o.width,p+=.5*o.height;break;case"b":l+=.5*o.width,p+=o.height;break;case"l":p+=.5*o.height}return{tooltip:{position:t,align:r,text:n,x:l=Math.round(l+(i||0)),y:p=Math.round(p+(a||0)),maxWidth:s,appearance:c,className:u}}},p=function(e){function t(t){var r=e.call(this,t)||this;return r.tooltipRef=o.createRef(),r.onMouseEnter=function(){if(r.state.el){var e=r.props,t=e.text,n=e.position,o=e.align,a=e.marginTop,s=e.marginLeft,c=e.maxWidth,u=e.appearance,l=e.className,p=Object(i.default)(r.state.el);r.update({text:t,position:n,align:o,rect:p,marginTop:a,marginLeft:s,maxWidth:c,appearance:u,className:l})}},r.onMouseLeave=function(e){var t=e.relatedTarget,n=r.tooltipRef.current;!(Boolean(t)&&Boolean(n)&&(n===t||(null==n?void 0:n.contains(t))))&&r.update()},r.onTransitionEnd=function(e){"visibility"===e.propertyName&&r.state.tooltip&&r.setState({tooltip:void 0})},r.onTooltipMouseEnter=function(){return r.onMouseEnter()},r.onTooltipMouseLeave=function(){return r.update()},r.state={el:null},r}return c(t,e),t.prototype.componentDidMount=function(){var e=a.findDOMNode(this);this.setState({el:e}),null==e||e.addEventListener("mouseenter",this.onMouseEnter),null==e||e.addEventListener("mouseleave",this.onMouseLeave)},t.prototype.componentWillUnmount=function(){var e,t;null===(e=this.state.el)||void 0===e||e.removeEventListener("mouseenter",this.onMouseEnter),null===(t=this.state.el)||void 0===t||t.removeEventListener("mouseleave",this.onMouseLeave)},t.getDerivedStateFromProps=function(e,t){return t.tooltip&&(e.text!==t.tooltip.text||e.position!==t.tooltip.position||e.align!==t.tooltip.align||e.maxWidth!==t.tooltip.maxWidth||e.appearance!==t.tooltip.appearance)?l(u(u({},e),{rect:Object(i.default)(t.el)})):null},t.prototype.update=function(e){if(!e)return this.setState({tooltip:Object.assign({},this.state.tooltip,{removed:!0})});this.setState(l(e))},t.prototype.render=function(){var e=this.state.tooltip;return e&&"undefined"!=typeof window?o.createElement(o.Fragment,null,this.props.children,o.createElement(s.default,u({},e,{tooltipRef:this.tooltipRef,onMouseEnter:this.onTooltipMouseEnter,onMouseLeave:this.onTooltipMouseLeave,onTransitionEnd:this.onTransitionEnd}))):this.props.children},t.defaultProps={position:"b",align:"center",marginTop:0,marginLeft:0,appearance:"dark"},t}(o.Component);t.default=p},UlUB:function(e,t,r){"use strict";function n(e,t){var r,n,o=!1;return function a(){if(o)return r=arguments,void(n=this);e.apply(this,arguments),o=!0,setTimeout((function(){o=!1,r&&(a.apply(n,r),r=n=null)}),t)}}r.r(t),r.d(t,"throttle",(function(){return n}))},bCCX:function(e,t,r){"use strict";r.r(t),function(e,n){var o,a=r("SLVX");o="undefined"!=typeof self?self:"undefined"!=typeof window?window:void 0!==e?e:n;var i=Object(a.default)(o);t.default=i}.call(this,r("yLpj"),r("3UD+")(e))},bKAG:function(e,t,r){"use strict";r.r(t),r.d(t,"MAX_STORY_VIDEO_DURATION",(function(){return u})),r.d(t,"StoryType",(function(){return n})),r.d(t,"StoryEntryPoint",(function(){return o})),r.d(t,"StorySource",(function(){return a})),r.d(t,"getStoryUploadUrl",(function(){return l})),r.d(t,"uploadStoryBlobToServer",(function(){return p})),r.d(t,"saveStoryOnServer",(function(){return d}));var n,o,a,i=r("jE6c"),s=r("PU8N"),c=function(){return(c=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var o in t=arguments[r])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)},u=16;function l(e){return new Promise((function(t,r){window.ajax.post(Object(s.isMvk)()?"stories.php":"al_stories.php",c({act:"get_upload_url"},e),{onDone:t,onError:r,onFail:r})}))}function p(e,t){var r=new FormData,n=encodeURIComponent("edited_"+Object(i.irand)(0,99999)+".jpg");return r.append("file0",e,n),fetch(t,{method:"POST",body:r}).then((function(e){return e.json()}))}function d(e,t){return new Promise((function(r,n){window.ajax.post(Object(s.isMvk)()?"stories.php":"al_stories.php",{act:"save",upload_result:e,hash:t},{onDone:r,onError:n,onFail:n})}))}!function(e){e.PHOTO="photo",e.VIDEO="video"}(n||(n={})),function(e){e.SWIPE="swipe",e.NAVIGATION_BUTTON="navigation_button",e.SIT_POSTING="sit_posting",e.LINK="link",e.STORY_REPLY="story_reply",e.STORY_REPOST="story_repost",e.CATALOG_ADD="catalog_add",e.DIALOG="dialog",e.STORY_LIVE_FINISHED="story_live_finished",e.DIALOG_VKME="dialog_vkme",e.STORY_VIEWER_FINISHED="story_viewer_finished",e.PUSH_TRY_MASK="push_try_mask",e.STORY_VIEWER_TRY_MASK="story_viewer_try_mask",e.LINK_MASK="link_mask",e.POSTING="posting",e.NEW_STORY_AVATAR="new_story_avatar",e.STORY_REPLIES_LIST="story_replies_list",e.STORIES_FEED="stories_feed",e.STORIES_SEARCH_NEWS="stories_search_news",e.QUESTION_STICKER="question_sticker",e.LIST_MIDDLE="list_middle",e.ARCHIVE_EMPTY_BUTTON="archive_empty_button",e.ARCHIVE_MENU_BUTTON="archive_menu_button",e.IM="im",e.PROFILE_BUTTON="profile_button",e.SHARE="share",e.MINI_APP="mini_app",e.SYSTEM_SHARING="system_sharing",e.SHORTCUT="shortcut",e.ARCHIVE_SHARING="archive_sharing",e.STORY_VIEWER_CAMERA_BUTTON="story_viewer_camera_button",e.STORY_VIEWER_MUSIC="story_viewer_music",e.STORY_VIEWER_MUSIC_SHEET="story_viewer_music_sheet",e.REPOST_TO_STORY_ACTIVITY="repost_to_story_activity",e.CHANGE_AVATAR="change_avatar"}(o||(o={})),function(e){e.FEED="feed",e.FEED_MIDDLE="feed_middle",e.LINK="link",e.PROFILE="profile",e.IM_DIALOGS="im_dialogs",e.IM_DIALOG_HEADER="im_dialog_header",e.SNIPPET="snippet",e.REPLY="reply",e.REPLIES_LIST="replies_list",e.REPLY_STORY="reply_story",e.DISCOVER="discover",e.STORIES_MANAGE="stories_manage",e.USER_PERSONAL_CARD="user_personal_card",e.GROUP_PERSONAL_CARD="group_personal_card",e.NARRATIVE_SNIPPET="narrative_snippet",e.NARRATIVE_STORY="narrative_story",e.NARRATIVE_LINK="narrative_link",e.NARRATIVE_RECOMMENDATIONS="narrative_recommendations",e.NARRATIVE_SECTION="narrative_section",e.FAVE="fave",e.SPAMFEED="sf",e.ADS_PREVIEW="ads_preview",e.LIST_MIDDLE="list_middle",e.PLACE_STORY_LIST="place_story_list",e.SEARCH_STORY_LIST="search_story_list",e.STORY_ARCHIVE="story_archive",e.IM_MSG_LIST="im_msg_list",e.NOSPAM="nospam",e.PROFILE_SNACKBAR="profile_snackbar"}(a||(a={}))},clTp:function(e,t,r){"use strict";function n(e){var t=e.getBoundingClientRect(),r=document.body,n=document.documentElement,o=window.pageYOffset||n.scrollTop||r.scrollTop,a=window.pageXOffset||n.scrollLeft||r.scrollLeft,i=n.clientTop||r.clientTop||0,s=n.clientLeft||r.clientLeft||0;return{top:Math.round(t.top+o-i),left:Math.round(t.left+a-s),width:e.offsetWidth,height:e.offsetHeight}}r.r(t),r.d(t,"default",(function(){return n}))},dI71:function(e,t,r){"use strict";function n(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e.__proto__=t}r.r(t),r.d(t,"default",(function(){return n}))},dImZ:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"ActionTypes",{enumerable:!0,get:function(){return o.ActionTypes}}),Object.defineProperty(t,"ActionCreators",{enumerable:!0,get:function(){return o.ActionCreators}}),Object.defineProperty(t,"parseActions",{enumerable:!0,get:function(){return a.parseActions}}),Object.defineProperty(t,"isHistory",{enumerable:!0,get:function(){return a.isHistory}}),Object.defineProperty(t,"includeAction",{enumerable:!0,get:function(){return a.includeAction}}),Object.defineProperty(t,"excludeAction",{enumerable:!0,get:function(){return a.excludeAction}}),Object.defineProperty(t,"combineFilters",{enumerable:!0,get:function(){return a.combineFilters}}),Object.defineProperty(t,"groupByActionTypes",{enumerable:!0,get:function(){return a.groupByActionTypes}}),Object.defineProperty(t,"newHistory",{enumerable:!0,get:function(){return a.newHistory}}),Object.defineProperty(t,"default",{enumerable:!0,get:function(){return i.default}});var n,o=r("1VNw"),a=r("9O7i"),i=(n=r("FEd1"))&&n.__esModule?n:{default:n}},"dt/K":function(e,t,r){"use strict";r.r(t);var n,o=r("q1tI"),a=r("i8i4"),i=r("ZxpX"),s=r("clTp"),c=r("qihR"),u=(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),l=function(){return(l=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var o in t=arguments[r])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)},p=function(e){var t=e.position,r=e.align,n=e.text,o=e.rect,a=e.marginTop,i=e.marginLeft,s=e.maxWidth,c=e.appearance,u=e.className,l=o.left,p=o.top;switch(t){case"t":l+=.5*o.width;break;case"r":l+=o.width,p+=.5*o.height;break;case"b":l+=.5*o.width,p+=o.height;break;case"l":p+=.5*o.height}return{tooltip:{position:t,align:r,text:n,x:l=Math.round(l+(i||0)),y:p=Math.round(p+(a||0)),maxWidth:s,appearance:c,className:u}}},d=function(e){function t(t){var r=e.call(this,t)||this;return r.onMouseEnter=function(){if(r.state.el){var e=r.props,t=e.text,n=e.position,o=e.align,a=e.marginTop,i=e.marginLeft,c=e.maxWidth,u=e.appearance,l=e.className,p=Object(s.default)(r.state.el);r.update({text:t,position:n,align:o,rect:p,marginTop:a,marginLeft:i,maxWidth:c,appearance:u,className:l})}},r.onMouseLeave=function(){return r.update()},r.onTransitionEnd=function(e){"visibility"===e.propertyName&&r.state.tooltip&&r.setState({tooltip:void 0})},r.state={el:null},r}return u(t,e),t.prototype.componentDidMount=function(){var e=a.findDOMNode(this);this.setState({el:e}),null==e||e.addEventListener("mouseenter",this.onMouseEnter),null==e||e.addEventListener("mouseleave",this.onMouseLeave)},t.prototype.componentWillUnmount=function(){var e,t;null===(e=this.state.el)||void 0===e||e.removeEventListener("mouseenter",this.onMouseEnter),null===(t=this.state.el)||void 0===t||t.removeEventListener("mouseleave",this.onMouseLeave)},t.getDerivedStateFromProps=function(e,t){return t.tooltip&&(e.text!==t.tooltip.text||e.position!==t.tooltip.position||e.align!==t.tooltip.align||e.maxWidth!==t.tooltip.maxWidth||e.appearance!==t.tooltip.appearance)?p(l(l({},e),{rect:Object(s.default)(t.el)})):null},t.prototype.update=function(e){if(!e)return this.setState({tooltip:Object.assign({},this.state.tooltip,{removed:!0})});this.setState(p(e))},t.prototype.render=function(){var e=this.state.tooltip?Object(i.classNames)(this.state.tooltip.className,"Tooltip--noPointerEvents"):"",t=this.state.tooltip?l(l({},this.state.tooltip),{className:e}):null;return t&&"undefined"!=typeof window?o.createElement(o.Fragment,null,this.props.children,o.createElement(c.default,l({},t,{onTransitionEnd:this.onTransitionEnd}))):this.props.children},t.defaultProps={position:"b",align:"center",marginTop:0,marginLeft:0,appearance:"dark"},t}(o.Component);t.default=d},qJhe:function(e,t,r){"use strict";r.r(t),r.d(t,"StoryPublisher",(function(){return _}));var n,o=r("q1tI"),a=r("i8i4"),i=r("0fW4"),s=r("EasH"),c=r("6krn"),u=(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),l=r("r7nW").default,p=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.errorHandler=function(e,t){var r=e||Object(c.getLang)("global_error");window.showFastBox({title:Object(c.getLang)("global_error")},r,Object(c.getLang)("global_close"),(function(){t(),window.curBox().hide()}))},t.save=function(e,r,n){void 0===n&&(n={}),t.props.onClickSave(),window.StoryPublisher.saveStory(e,{attachment:JSON.stringify(t.props.attachment),clickable_stickers:n.clickableStickers,mini_app_id:t.props.miniAppId,analytics:n.analytics,mediaEditorAnalytics:n.mediaEditorAnalytics,hash:n.storyUploadUrlHash,entry_point:t.props.entrypoint,ref:window.cur.module},n.storySaveHash).then((function(e){t.onClose(!0,!1,e),r()})).catch((function(e){return t.errorHandler(e,r),!0}))},t.onClose=function(e,r,n){var o,a;if(r)t.props.onClose(!1);else if(e)window.Stories&&window.Stories.updateFeedStories&&window.Stories.updateFeedStories(),t.props.onClose(!0,n);else{(null===(a=null===(o=window.cur.photoEditorStore)||void 0===o?void 0:o.getState())||void 0===a?void 0:a.past.length)>1?Object(s.showFastBox)({title:Object(c.getLang)("photos_pe_story_editor_close_title"),bodyStyle:"padding: 20px; line-height: 160%;",dark:1,forceNoBtn:1,onShow:function(){window.cur._noEscHide=!0},onClean:function(){window.cur._noEscHide=!1}},Object(c.getLang)("photos_pe_story_editor_close_text"),Object(c.getLang)("box_yes"),(function(){t.props.onClose(!1),window.curBox().hide()}),Object(c.getLang)("box_no"),(function(){window.curBox().hide()})):t.props.onClose(!1)}},t}return u(t,e),t.prototype.render=function(){var e=this,t=window.innerHeight-100,r=t/1.78;return o.createElement(l,{disableBodyScroll:!0,onClose:function(){return e.onClose()}},o.createElement(i.default,{context:"story",photoUrl:this.props.photoUrl,artboardWidth:r,artboardHeight:t,save:this.save,close:function(){return e.onClose()},attachment:this.props.attachment,stickers:this.props.stickers}))},t}(o.Component),d=r("ufMw"),f=r("kcIO"),h=r("4+be"),m=r("bKAG"),_={init:function(e,t,r){var n=this;this.onClickSave=t||function(){},this.cb=r,this.loadStatic().then((function(){n.render(e)})).catch((function(e){console.error(e)}))},loadStatic:function(){return window.stManager.add([window.jsc("web/story_publisher.js"),"photo_editor.css"])},render:function(e){var t=(null==e?void 0:e.entrypoint)||"",r=(null==e?void 0:e.miniAppId)||0;window.cur.storyPublishContext=!0,"story_repost"===t?Object(d.sendStat)(d.EVENTS.ADD_STORY_FROM_SHARING):Object(d.sendStat)(d.EVENTS.ADD_STORY);var n=document.querySelector(".StoryPublisher");n||((n=document.createElement("div")).classList.add("StoryPublisher"),document.body.append(n)),a.render(o.createElement(p,{entrypoint:t,miniAppId:r,onClose:this.destroy.bind(this),onClickSave:this.onClickSave.bind(this),photoUrl:null==e?void 0:e.photoUrl,attachment:null==e?void 0:e.attachment,stickers:null==e?void 0:e.stickers}),n)},destroy:function(e,t){var r=document.querySelector(".StoryPublisher");r&&a.unmountComponentAtNode(r),this.cb&&this.cb(e,t),delete window.cur.photoEditorStore,e&&Object(f.showDoneBox)(Object(h.getLang)("photos_pe_story_published"))},saveStory:function(e,t,r){return Object(m.getStoryUploadUrl)(t).then((function(t){return Object(m.uploadStoryBlobToServer)(e,t)})).then((function(e){var t=e.response;return Object(m.saveStoryOnServer)(t&&t.upload_result,r)}))}}},qT12:function(e,t,r){"use strict";var n="function"==typeof Symbol&&Symbol.for,o=n?Symbol.for("react.element"):60103,a=n?Symbol.for("react.portal"):60106,i=n?Symbol.for("react.fragment"):60107,s=n?Symbol.for("react.strict_mode"):60108,c=n?Symbol.for("react.profiler"):60114,u=n?Symbol.for("react.provider"):60109,l=n?Symbol.for("react.context"):60110,p=n?Symbol.for("react.async_mode"):60111,d=n?Symbol.for("react.concurrent_mode"):60111,f=n?Symbol.for("react.forward_ref"):60112,h=n?Symbol.for("react.suspense"):60113,m=n?Symbol.for("react.suspense_list"):60120,_=n?Symbol.for("react.memo"):60115,v=n?Symbol.for("react.lazy"):60116,g=n?Symbol.for("react.block"):60121,y=n?Symbol.for("react.fundamental"):60117,E=n?Symbol.for("react.responder"):60118,b=n?Symbol.for("react.scope"):60119;function S(e){if("object"==typeof e&&null!==e){var t=e.$$typeof;switch(t){case o:switch(e=e.type){case p:case d:case i:case c:case s:case h:return e;default:switch(e=e&&e.$$typeof){case l:case f:case v:case _:case u:return e;default:return t}}case a:return t}}}function T(e){return S(e)===d}t.AsyncMode=p,t.ConcurrentMode=d,t.ContextConsumer=l,t.ContextProvider=u,t.Element=o,t.ForwardRef=f,t.Fragment=i,t.Lazy=v,t.Memo=_,t.Portal=a,t.Profiler=c,t.StrictMode=s,t.Suspense=h,t.isAsyncMode=function(e){return T(e)||S(e)===p},t.isConcurrentMode=T,t.isContextConsumer=function(e){return S(e)===l},t.isContextProvider=function(e){return S(e)===u},t.isElement=function(e){return"object"==typeof e&&null!==e&&e.$$typeof===o},t.isForwardRef=function(e){return S(e)===f},t.isFragment=function(e){return S(e)===i},t.isLazy=function(e){return S(e)===v},t.isMemo=function(e){return S(e)===_},t.isPortal=function(e){return S(e)===a},t.isProfiler=function(e){return S(e)===c},t.isStrictMode=function(e){return S(e)===s},t.isSuspense=function(e){return S(e)===h},t.isValidElementType=function(e){return"string"==typeof e||"function"==typeof e||e===i||e===d||e===c||e===s||e===h||e===m||"object"==typeof e&&null!==e&&(e.$$typeof===v||e.$$typeof===_||e.$$typeof===u||e.$$typeof===l||e.$$typeof===f||e.$$typeof===y||e.$$typeof===E||e.$$typeof===b||e.$$typeof===g)},t.typeOf=S},qihR:function(e,t,r){"use strict";r.r(t);var n=r("q1tI"),o=r.n(n),a=r("i8i4"),i=r("ZxpX"),s=function(){return(s=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var o in t=arguments[r])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)},c=function(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(n=Object.getOwnPropertySymbols(e);o<n.length;o++)t.indexOf(n[o])<0&&Object.prototype.propertyIsEnumerable.call(e,n[o])&&(r[n[o]]=e[n[o]])}return r};t.default=function(e){var t,r=e.x,u=e.y,l=e.text,p=e.position,d=void 0===p?"b":p,f=e.align,h=void 0===f?"center":f,m=e.removed,_=e.maxWidth,v=e.appearance,g=void 0===v?"dark":v,y=e.className,E=e.tooltipRef,b=c(e,["x","y","text","position","align","removed","maxWidth","appearance","className","tooltipRef"]),S=Object(n.useRef)(null);S.current||(S.current=document.createElement("div"),document.body.appendChild(S.current));var T=Object(i.classNames)("Tooltip","Tooltip--"+d,"Tooltip--"+g,((t={"Tooltip--removed":!!m})["Tooltip--align-"+h]="t"===d||"b"===d,t),y);return Object(a.createPortal)(o.a.createElement("div",s({},b,{className:T,ref:E,style:{top:u,left:r}}),"string"==typeof l&&o.a.createElement("div",{className:"Tooltip__in",style:{maxWidth:_},dangerouslySetInnerHTML:{__html:l}}),"string"!=typeof l&&o.a.createElement("div",{className:"Tooltip__in",style:{maxWidth:_}},l)),S.current)}},r7nW:function(e,t,r){"use strict";r.r(t);var n=r("q1tI"),o=r("i8i4"),a=(r("17x9"),r("ZxpX"));class i extends n.Component{constructor(){super(...arguments),this.getScrollbarWidth=()=>{var e=document.createElement("div");e.classList.add("BaseModal__scrollbarMeasure"),document.body.appendChild(e);var t=e.getBoundingClientRect().width-e.clientWidth;return document.body.removeChild(e),t},this.hideScrollBar=()=>{var e=document.body.getBoundingClientRect(),t=e.left+e.right<window.innerWidth,r=this.getScrollbarWidth();this.calculatedPadding=window.getComputedStyle(document.body)["padding-right"],t&&(document.body.style.paddingRight=parseFloat(this.calculatedPadding)+r+"px"),document.body.classList.add("BaseModal__bodyHiddenOverflow")},this.showScrollBar=()=>{document.body.style.paddingRight=this.calculatedPadding,document.body.classList.remove("BaseModal__bodyHiddenOverflow")},this.onDocumentKeyDown=e=>{var t=this.props.onClose;"Escape"===e.key&&t()},this.onBackdropClick=()=>{var e=this.props,t=e.onClose,r=e.onBackdropClick;e.disableBackdropClick||(r?r():t())}}componentDidMount(){var e=this.props,t=e.disableEscapeClose,r=e.disableBodyScroll;t||document.body.addEventListener("keydown",this.onDocumentKeyDown),r&&this.hideScrollBar()}componentWillUnmount(){var e=this.props,t=e.disableEscapeClose,r=e.disableBodyScroll;t||document.body.removeEventListener("keydown",this.onDocumentKeyDown),r&&this.showScrollBar()}renderModal(){var e=this.props.className,t=Object(a.classNames)("BaseModal",e);return n.createElement("div",{className:t,"aria-modal":"true"},n.createElement("div",{className:"BaseModal__backdrop",onClick:this.onBackdropClick}),n.createElement("div",{className:"BaseModal__content"},this.props.children))}render(){return o.createPortal(this.renderModal(),document.body)}}i.defaultProps={className:"",children:null,disableBackdropClick:!1,disableEscapeClose:!1,disableBodyScroll:!1},t.default=i},sINF:function(e,t,r){"use strict";function n(e){return function(t){var r=t.dispatch,n=t.getState;return function(t){return function(o){return"function"==typeof o?o(r,n,e):t(o)}}}}r.r(t);var o=n();o.withExtraArgument=n,t.default=o},ufMw:function(e,t,r){"use strict";r.r(t),r.d(t,"EVENTS",(function(){return s})),r.d(t,"sendStat",(function(){return u})),r.d(t,"prepareStat",(function(){return l})),r.d(t,"prepareMediaEditorStat",(function(){return p}));var n=r("1y80"),o=r("98sY"),a=r("xYVc"),i=r("W9Tc"),s={FLIP_X:"flipX",FLIP_Y:"flipY",ADD_FILTER:"add_filter",REMOVE_FILTER:"remove_filter",UNDO:"undo",REDO:"redo",ENABLE_AUTOCORRECTION:"enable_autocorrection",DISABLE_AUTOCORRECTION:"disable_autocorrection",ENABLE_BLUR:"enable_blur",DISABLE_BLUR:"disable_blur",ZOOM:"zoom",UNZOOM:"unzoom",TURN_LEFT:"turn_left",TURN_RIGHT:"turn_right",ADD_STORY:"add_story",ADD_STORY_FROM_SHARING:"add_story_from_sharing",CLICK_TO_CAMERA_ICON:"click_to_camera_icon",CLICK_TO_GRADIENT_ICON:"click_to_gradient_icon",ADD_TEXT:"add_text",EDIT_TEXT:"edit_text",DELETE_TEXT:"delete_text",ADD_STICKER:"add_sticker",DELETE_STICKER:"delete_sticker",ADD_GRAFFITI:"add_graffiti",SELECT_BACKGROUND:"select_background"},c=[s.ADD_STORY,s.ADD_STORY_FROM_SHARING,s.CLICK_TO_CAMERA_ICON,s.CLICK_TO_GRADIENT_ICON,s.ADD_TEXT,s.EDIT_TEXT,s.DELETE_TEXT,s.ADD_STICKER,s.DELETE_STICKER,s.ADD_GRAFFITI,s.SELECT_BACKGROUND];function u(e){var t=0,r=0;if(window.cur.pvCurPhoto){var a=window.cur.pvCurPhoto.id.split("_"),s=a[0],u=a[1];t=parseInt(s),r=parseInt(u)}var l={event_type:e,media_type:window.cur.storyPublishContext?"story":"photo",media_owner_id:t,media_id:r};Object(i.partConfigEnabled)("story_publish_analytics_log")&&Object(o.debugLog)(l),Object(n.statlogsValueEvent)("media_editor_product_analytics",l),c.includes(e)&&Object(n.statlogsValueEvent)("story_create_product_analytics",{event_type:e,story_type:"photo"})}function l(e,t,r,n){var o=0,i="photo";r===a.default.BACKGROUND_MODES.BACKGROUND&&(i=(o=n)>100?"emojies":"gradients");var s={has_text:0,has_sticker:0,has_graffiti:0,background_type:i,background_id:o},c=[],u=[],l=[];return e.forEach((function(e){if(e.type===a.default.LAYER_TYPES.STICKER){var t=(i=e).id.split("_"),r=t[0],n=t[1],o=parseInt(r);c.push({id:parseInt(n),pack_id:o||0,type:o?"from_pack":"individual"})}else if(e.type===a.default.LAYER_TYPES.TEXT){var i=e;u.push({text:i.text,font:i.fontStyle,size:Math.round(i.fontSize*a.default.FONT_SIZE_COEFFICIENT),color:i.color.slice(1),background:"none",align:"center"})}})),u.length&&(s.has_text=1,s.texts=u),c.length&&(s.has_sticker=1,s.stickers=c),t.forEach((function(e){l.push({brush:e.opacity,size:e.width,color:e.color.slice(1)})})),l.length&&(s.has_graffiti=1,s.graffities=l),s}function p(e,t){var r=0,n=0;if(window.cur.pvCurPhoto){var o=window.cur.pvCurPhoto.id.split("_"),i=o[0],s=o[1];r=parseInt(i),n=parseInt(s)}var c={media_type:window.cur.storyPublishContext?"story":"photo",media_owner_id:r,media_id:n,is_cropped:t.isCropped,is_autocorrected:t.isAutoCorrection,rotation:t.rotation,filter:t.filter.name,filter_value:100*t.filter.value,ratio:t.cropAspect,photo_correction:[{type:"exposure",value:100*t.colorCorrection.exposure},{type:"contrast",value:100*t.colorCorrection.contrast},{type:"saturation",value:100*t.colorCorrection.saturation},{type:"warmth",value:100*t.colorCorrection.warmth},{type:"vignette",value:100*t.colorCorrection.vignette},{type:"sharpness",value:100*t.colorCorrection.sharpness},{type:"grain",value:100*t.colorCorrection.grain}]};t.blur.isEnabled&&(c.blur_type=t.blur.form,c.blur_value=t.blur.size);var u=[];return e.forEach((function(e){if(e.type===a.default.LAYER_TYPES.TEXT){var t=e;u.push({text:t.text,font:t.fontStyle,size:Math.round(t.fontSize*a.default.FONT_SIZE_COEFFICIENT),color:t.color.slice(1),background:"none",align:"center"})}})),u.length&&(c.has_text=1,c.texts=u),c}},vRp6:function(e,t,r){"use strict";r.r(t),r.d(t,"default",(function(){return u}));r("HEwt"),r("a1Th"),r("Btvt"),r("rGqo"),r("rE2o"),r("ioFf");var n=r("q1tI"),o=(r("17x9"),r("UlUB")),a=r("PjZB"),i=r("ZxpX");function s(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var r=[],n=!0,o=!1,a=void 0;try{for(var i,s=e[Symbol.iterator]();!(n=(i=s.next()).done)&&(r.push(i.value),!t||r.length!==t);n=!0);}catch(e){o=!0,a=e}finally{try{n||null==s.return||s.return()}finally{if(o)throw a}}return r}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return c(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(r);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return c(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function c(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}class u extends n.Component{constructor(e){super(e),this.checkLoad=Object(o.throttle)(e=>{var t=s(e,3),r=t[0],n=t[1],o=t[2];if(!this.loading)return this.props.virtualized||this.props.hasMore?void(n-r-o<=this.props.threshold&&(this.loading=!0,this.props.loadMore().then(()=>{this.loading=!1}))):this.detachListeners()},34),this.onScroll=e=>{var t=this.getScrollData();this.props.virtualized&&this.processChildren(this.props.children,t),this.props.hasMore&&this.checkLoad(t)},this.getRef=e=>{this.container=e,this.props.virtualized&&this.setState(this.getChildrenData(this.props.children,this.getScrollData()))},this.useWindowScroll=e.useWindowScroll,e.virtualized&&(this.state={before:0,after:e.children.length,start:0,end:0})}getScrollData(){var e=this.useWindowScroll?document.documentElement:this.container;return[this.getScrollTop(),e?e.scrollHeight:0,e?e.clientHeight:0]}getScrollTop(){var e=document.documentElement||document.body.parentNode||document.body;return this.useWindowScroll?void 0!==window.pageYOffset?window.pageYOffset:e.scrollTop:this.container?this.container.scrollTop:0}attachListeners(){var e=this.useWindowScroll?window:this.container;this.container&&(e.addEventListener("scroll",this.onScroll,this.props.useCapture),e.addEventListener("resize",this.onScroll,this.props.useCapture))}detachListeners(){var e=this.useWindowScroll?window:this.container;this.container&&(e.removeEventListener("scroll",this.onScroll,this.props.useCapture),e.removeEventListener("resize",this.onScroll,this.props.useCapture))}processChildren(e,t){var r=this.state,n=this.getChildrenData(e,t||this.getScrollData()),o=n.start,a=n.end,i=n.before,s=n.after;o===r.start&&a===r.end&&i===r.before&&s===r.after||this.setState(n)}getChildrenData(e,t){var r=s(t,3),n=r[0],o=r[1],a=r[2],i=this.useWindowScroll?window:this.container,c=i&&i.offsetHeight;if(!i||0===o||0===a)return{start:0,end:0,before:0,after:e.length};a=Math.max(a,c);var u=e.length,l=Math.max(Math.floor(n/this.props.itemHeight)-1,0),p=Math.min(Math.floor((n+2*a)/this.props.itemHeight+1),u);return{start:l,end:p,before:l,after:u-p}}componentWillReceiveProps(e){this.props.virtualized&&this.processChildren(e.children)}componentDidMount(){this.attachListeners()}componentWillUnmount(){this.detachListeners()}render(){return n.createElement("div",{className:Object(i.classNames)("InfiniteScroll",this.props.className),ref:this.getRef,style:this.props.style},this.props.virtualized&&this.state.before>0&&n.createElement("div",{style:{height:this.state.before*this.props.itemHeight},key:"before"}),this.props.virtualized?[].concat(this.props.children).slice(this.state.start,this.state.end):this.props.children,this.props.virtualized&&this.state.after>0&&n.createElement("div",{style:{height:this.state.after*this.props.itemHeight},key:"after"}),this.props.hasMore&&(this.props.loader||n.createElement("div",{className:"InfiniteScroll__loader",key:"loader"},n.createElement(a.default,null))))}}u.defaultProps={useWindowScroll:!1,virtualized:!1,hasMore:!0,useCapture:!1,threshold:100,itemHeight:55}},wx14:function(e,t,r){"use strict";function n(){return(n=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e}).apply(this,arguments)}r.r(t),r.d(t,"default",(function(){return n}))},xYVc:function(e,t,r){"use strict";r.r(t);var n=r("t7n3"),o=[{title:"photos_pe_crop_aspect_free",value:0},{title:"photos_pe_crop_aspect_original",value:-1},{title:"photos_pe_crop_aspect_16_9",value:16/9},{title:"photos_pe_crop_aspect_4_3",value:4/3},{title:"photos_pe_crop_aspect_1_1",value:1},{title:"photos_pe_crop_aspect_3_4",value:3/4},{title:"photos_pe_crop_aspect_9_16",value:9/16}];t.default={TABS:{STICKERS:"stickers",TEXT:"text",PAINT:"paint",CROP:"crop",FILTERS:"filters",COLOR:"color"},BACKGROUND_MODES:{PHOTO:"photo",BACKGROUND:"background"},STORY_BASE_WIDTH:1080,STORY_BASE_HEIGHT:1920,BOTTOM_PANEL_HEIGHT:50,CANVAS_SCALE:Object(n.isRetina)()?2:1,STICKER_THUMB:"thumb",STICKER_SMALL:64,STICKER_MEDIUM:Object(n.isRetina)()?256:128,STICKER_LARGE:512,COLORS:["#FFFFFF","#000000","#FF3301","#FF8C49","#F9D827","#2EBA48","#4189E8","#9F4BED","#69E4B3","#FF84A0","#F7A978","#F8786C","#8B3232","#93B658","#556E35","#5B4490","#1B1B1B","#333333","#4D4D4D","#666666","#808080","#999999","#B3B3B3","#CCCCCC"],FONTS:["classic","cursive","marker","italics","typewriter","poster","retro","impact","lobster"],BRUSH_WIDTH_COEFFICIENT:40,FONT_SIZE_COEFFICIENT:100,PHOTO_FILTERS:["regular","nox","vesper","latona","liber","luna","minerva","mitra","pro","terra","veles","vesta","zaria","sepia","genius","horus","fortuna"],COLOR_CORRECTION:["exposure","contrast","saturation","warmth","vignette","sharpness","grain"],BLUR_TYPES:{ROUND:"round",RECTANGULAR:"rectangular"},AVERAGE_COLORS_MAP:[{s:12,v:-40},{s:9,v:-30},{s:6,v:-20},{s:3,v:-10},{s:0,v:0},{s:-3,v:10},{s:-6,v:20},{s:-9,v:30},{s:-12,v:40}],LAYER_TYPES:{STICKER:"sticker",TEXT:"text",IMAGE:"image",BACKGROUND:"background"},LAYER_MIN_SIZE:30,LAYER_DEFAULT_SIZE:128,CONTEXT_TYPES:{PHOTO:"photo",STORY:"story"},FILTER_PREVIEW_WIDTH:127,FILTER_PREVIEW_HEIGHT:95,DRAWING_PREVIEW_WIDTH:270,DRAWING_PREVIEW_HEIGHT:110,CROP_MIN_SIZE:100,CROP_SIDES:{CENTER:"center",NW:"nw",NE:"ne",SW:"sw",SE:"se",N:"n",S:"s",W:"w",E:"e"},CROP_ASPECTS:o,CROP_ASPECT_FREE:0,CROP_ASPECT_ORIGINAL:-1}},zLVn:function(e,t,r){"use strict";function n(e,t){if(null==e)return{};var r,n,o={},a=Object.keys(e);for(n=0;n<a.length;n++)r=a[n],t.indexOf(r)>=0||(o[r]=e[r]);return o}r.r(t),r.d(t,"default",(function(){return n}))}});