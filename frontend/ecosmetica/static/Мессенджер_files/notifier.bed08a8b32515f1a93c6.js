!function(e){function t(t){for(var r,o,s=t[0],c=t[1],u=t[2],d=0,_=[];d<s.length;d++)o=s[d],Object.prototype.hasOwnProperty.call(a,o)&&a[o]&&_.push(a[o][0]),a[o]=0;for(r in c)Object.prototype.hasOwnProperty.call(c,r)&&(e[r]=c[r]);for(l&&l(t);_.length;)_.shift()();return i.push.apply(i,u||[]),n()}function n(){for(var e,t=0;t<i.length;t++){for(var n=i[t],r=!0,s=1;s<n.length;s++){var c=n[s];0!==a[c]&&(r=!1)}r&&(i.splice(t--,1),e=o(o.s=n[0]))}return e}var r={},a={"web/notifier":0},i=[];function o(t){if(r[t])return r[t].exports;var n=r[t]={i:t,l:!1,exports:{}};return e[t].call(n.exports,n,n.exports,o),n.l=!0,n.exports}o.m=e,o.c=r,o.d=function(e,t,n){o.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},o.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.t=function(e,t){if(1&t&&(e=o(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(o.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)o.d(n,r,function(t){return e[t]}.bind(null,r));return n},o.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return o.d(t,"a",t),t},o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},o.p="/js/cmodules/";var s=window.webpackJsonp=window.webpackJsonp||[],c=s.push.bind(s);s.push=t,s=s.slice();for(var u=0;u<s.length;u++)t(s[u]);var l=c;i.push([224,"vendors","common","145f605746e8e55e54cfd5bb0b7dca57","90e4107c91b3e7820e0825f9b2a618b5"]),n()}({"/eGY":function(e,t,n){"use strict";n.r(t),n.d(t,"VKPAY_APP_ID",(function(){return l})),n.d(t,"BUTTON_TYPE_TEXT",(function(){return d})),n.d(t,"BUTTON_TYPE_VKPAY",(function(){return _})),n.d(t,"BUTTON_TYPE_LOCATION",(function(){return f})),n.d(t,"BUTTON_TYPE_OPEN_APP",(function(){return h})),n.d(t,"BUTTON_TYPE_OPEN_LINK",(function(){return p})),n.d(t,"BUTTON_COLOR_DEFAULT",(function(){return g})),n.d(t,"BUTTON_COLOR_SECONDARY",(function(){return m})),n.d(t,"BUTTON_COLOR_PRIMARY",(function(){return b})),n.d(t,"BUTTON_COLOR_NEGATIVE",(function(){return v})),n.d(t,"BUTTON_COLOR_POSITIVE",(function(){return C})),n.d(t,"handleButtonClick",(function(){return y})),n.d(t,"getButtonAppearance",(function(){return O})),n.d(t,"getButtonLabel",(function(){return T})),n.d(t,"getActionObjectFromElement",(function(){return N})),n.d(t,"getAttributesFromActionObject",(function(){return I}));n("HEwt"),n("a1Th"),n("rE2o"),n("ioFf"),n("rGqo"),n("Btvt"),n("/8Fb"),n("pIFo");var r=n("t7n3"),a=n("nAFc"),i=n("/PiP"),o=n("EasH"),s=n("N4ZS");function c(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var n=[],r=!0,a=!1,i=void 0;try{for(var o,s=e[Symbol.iterator]();!(r=(o=s.next()).done)&&(n.push(o.value),!t||n.length!==t);r=!0);}catch(e){a=!0,i=e}finally{try{r||null==s.return||s.return()}finally{if(a)throw i}}return n}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return u(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return u(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function u(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var l=6217559,d="text",_="vkpay",f="location",h="open_app",p="open_link",g="default",m="secondary",b="primary",v="negative",C="positive",E=["app-id","owner-id","type","payload","hash","label"];function y(e,t,n,r){var a=e.app_id,s=e.owner_id,c=e.type,u=e.payload,g=e.hash,m=void 0===g?"":g;switch(c){case p:break;case _:case h:var b="app"+(c===_?l:a)+(s?"_"+s:"");Object(i.showWiki)({w:b+encodeURIComponent("#"+m),from_keyboard:1,app_hash:n});break;case f:cur.sendLocation=function(e,n){n(),t({keyboardAuthorId:r,action:{label:"",attaches:[e],payload:u}})},Object(o.showBox)("al_places.php",{act:"a_choose_place_box",from_keyboard:1},{stat:["places.css","map.css","maps.js","ui_controls.css","ui_controls.js","boxes.css"],width:640,bodyStyle:"padding: 0px;",dark:1});break;case d:t({action:e,appHash:n,keyboardAuthorId:r});break;default:e.payload=JSON.stringify({command:"not_supported_button",button_type:c,payload:e.payload}),t({action:e,appHash:n,keyboardAuthorId:r})}}function O(e){return w(e)?b:e.color.toLowerCase().replace(g,m)}function T(e){var t=e.action,n=t.label;return t.type===f?getLang("mail_keyboard_label_location"):w(e)?getLang("mail_keyboard_label_vkpay").replace(/ VK Pay$/,""):function(e){var t=e;return t=Object(a.decodeHTMLEntities)(t||""),t=Object(r.clean)(t).replace(/\n(\r)?/gi," "),t=Emoji.emojiToHTML(t,!0)}(n)}function w(e){var t=e.action,n=t.app_id,r=t.type;return r===_||r===h&&n===l}function N(e){return E.reduce((t,n)=>(t[n.replace("-","_")]=e.getAttribute("data-"+n)||void 0,t),{})}function I(e){var t=Object.entries(e).reduce((e,t)=>{var n=c(t,2),a=n[0],i=n[1];return e+` data-${a.replace("_","-")}="${Object(r.clean)(""+i)}"`},"");e.type===p&&(t+=` href="${Object(s.wrapAwayIfExternal)(encodeURI(e.link),!0)}" target="_blank" rel="nofollow noopener"`);return t}},"0Rlc":function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return s}));n("91GP"),n("ioFf"),n("rGqo"),n("Btvt");var r=n("q1tI"),a=(n("17x9"),n("ZxpX"));function i(){return(i=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}function o(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},i=Object.keys(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}class s extends r.Component{constructor(){super(...arguments),this.onChange=e=>{this.props.onChange&&this.props.onChange(this.props.name,e.target.checked,e)}}render(){var e=this.props,t=e.children,n=e.checked,s=e.disabled,c=e.indeterminate,u=e.name,l=e.id,d=o(e,["children","checked","disabled","indeterminate","name","id"]),_=Object(a.classNames)("CheckBox",d.className,{"CheckBox--disabled":s,"CheckBox--indeterminate":c});return r.createElement("label",{className:_},r.createElement("input",i({},d,{className:"CheckBox__input",id:l,type:"checkbox",checked:n,name:u,disabled:s,onChange:this.onChange})),r.createElement("span",{className:"CheckBox__indicator","aria-hidden":!0}),t)}}},"0toi":function(e,t,n){"use strict";n.r(t);n("91GP");var r=n("q1tI"),a=n.n(r),i=(n("17x9"),n("r7nW")),o=n("Xq7/"),s=n("6aSF"),c=function(e){var t=e.children,n=e.hasScroll;return void 0===n||n?a.a.createElement(s.default,{className:"ModalBody"},t):a.a.createElement("div",{className:"ModalBody"},t)},u=n("7ZXl"),l=n("ZxpX");function d(){return(d=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}var _=e=>{var t=e.className,n=e.appearance,a=void 0===n?"white":n,s=e.title,_=e.actionButtons,f=e.onClose,h=e.children,p=e.footerHint,g=e.hasScroll,m=Object(l.classNames)("Modal","Modal--"+a,t);return r.createElement(i.default,d({},e,{className:m}),r.createElement(o.ModalHeader,{title:s,onClose:f,appearance:a}),Boolean(h)&&r.createElement(c,{hasScroll:g},h),r.createElement(u.ModalFooter,{actionButtons:_,hint:p}))};_.Header=o.ModalHeader,_.Body=c,_.Footer=u.ModalFooter;t.default=_},"1y80":function(e,t,n){"use strict";function r(e,t,n,r,a){return window.statlogsValueEvent(e,t,n,r,a)}function a(e){return Math.random()<e}function i(e,t,n,i,o,s){a(e)&&r(t,n,i,o,s)}n.r(t),n.d(t,"statlogsValueEvent",(function(){return r})),n.d(t,"randEnabled",(function(){return a})),n.d(t,"statlogsProbValueEvent",(function(){return i}))},224:function(e,t,n){e.exports=n("8S/u")},"4KwC":function(e,t,n){"use strict";n.r(t),n.d(t,"lpSingletonGetInstance",(function(){return m})),n.d(t,"lpSingletonOnTabInitialLoaded",(function(){return b})),n.d(t,"lpSingletonSyncWithNotifier",(function(){return v})),n.d(t,"lpSingletonOnNotifierRecv",(function(){return C}));var r=n("nJdr"),a=n("V1Nw"),i=n("bP5l"),o=n("ERyv"),s=n("gdug"),c=n("t7n3"),u=n("4O8T"),l=n.n(u),d=window.lpConnect,_=window.lpInstance;function f(){return window.vk.id>0}function h(){return window.curNotifier&&window.curNotifier.lp_connected}function p(){return window.curNotifier&&window.curNotifier.is_server||s.browser.safari}function g(e,t,n){_.onLp(e,t,n),h()&&p()&&(e!=t||n.length)&&function(e,t,n){window.Notifier.lcSend("lp_data",{tsOld:e,tsNow:t,evs:n}),Object(i.lpLogFc)("silver","broadcast to others",e,t,n)}(e,t,n)}function m(){return f()?(_||(window.vk.lpConfig.id=window.vk.id,window.lpConnect=d=Object(r.createLongpoll)(window.vk.lpConfig,g),e=new l.a,t=Object(a.createLongpollEventsQueue)(window.vk.lpConfig.ts,(function(t){Object(i.longpollTestingOnFcEvents)(t),e.trigger("data",t)}),E),window.lpInstance=_={onData:function(t){e.on("data",t)},offData:function(t){e.off("data",t)},pause:function(){t.pause()},resume:function(){t.resume()},push:function(t){e.trigger("data",t)},abortWaiting:function(){d.abortWaiting()},onLp:function(e,n,r){t.onLp(e,n,r)},isEnabled:function(){return d&&!d.isStopped()}}),_):null;var e,t}function b(){f()&&(Object(i.lpLogFc)("orange","init longpoll connection on load"),m(),window.curNotifier.idle_manager.on("unidle",(function(){d.abortWaiting()})),v())}function v(){f()&&(h()?d.isStopped()&&p()?(Object(i.lpLogFc)("orange","now master, init connection"),Object(o.imWeirdLog)("fc_longpoll_master",{},!1),d.reinitConnection()):d.isStopped()||p()||(Object(i.lpLogFc)("orange","now slave, stop connection"),Object(o.imWeirdLog)("fc_longpoll_slave",{},!1),d.stopConnection()):setTimeout(v,500))}function C(e){h()&&!p()&&f()&&(Object(i.lpLogFc)("silver","recv from master",e.tsOld,e.tsNow,e.evs),d.onLp(e.tsOld,e.tsNow,e.evs))}function E(e){var t=Object(c.extend)({},window.lpConnect.options,{ts:e});return Object(i.lpLogFc)("orange","createLongpoll to load from",e),new Promise((function(e){var n=Object(r.createLongpoll)(t,(function(t,r,a){Object(i.lpLogFc)("orange","Loaded ["+t+","+r+")"),n.stopConnection(),e([t,r,a])}))}))}},"6krn":function(e,t,n){"use strict";n.r(t),n.d(t,"getLang",(function(){return o}));var r=n("nAFc"),a=n("4+be"),i={};function o(e,t,n){void 0===t&&(t=!1);var o="number"==typeof t,s=t||o,c=e+(s?".raw":"");if(void 0===i[c]){var u=s?Object(a.getLang)(e,"raw"):Object(a.getLang)(e);"string"==typeof u?i[c]=Object(r.decodeHTMLEntities)(u):Array.isArray(u)&&(i[c]=u.map(r.decodeHTMLEntities))}if(o){var l=t;return Object(a.langNumeric)(l,i[c],n)}return i[c]||""}t.default={getLang:o}},"754W":function(e,t,n){"use strict";n.r(t);n("91GP"),n("ioFf"),n("rGqo"),n("Btvt");var r=n("q1tI"),a=(n("17x9"),n("ZxpX"));function i(){return(i=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}function o(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},i=Object.keys(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}t.default=e=>{var t=e.children,n=e.className,s=o(e,["children","className"]),c=Object(a.classNames)("LinkButton",n),u=i({},s,{onMouseDown:e=>{e.preventDefault(),s.onMouseDown&&s.onMouseDown(e)}});return r.createElement("button",i({},u,{className:c}),t)}},"7ZXl":function(e,t,n){"use strict";n.r(t),n.d(t,"ModalFooter",(function(){return i}));var r=n("q1tI"),a=n.n(r),i=function(e){var t=e.actionButtons,n=e.hint;return a.a.createElement("div",{className:"ModalFooter"},a.a.createElement("div",{className:"ModalFooter__inner"},n&&a.a.createElement("div",{className:"ModalFooter__hint"},n),t))}},"83Q7":function(e,t,n){"use strict";var r,a,i;n.r(t),n.d(t,"SearchResultType",(function(){return a})),n.d(t,"Mode",(function(){return i})),n.d(t,"LOAD_PEERS",(function(){return d})),n.d(t,"CHANGE_MODE",(function(){return _})),n.d(t,"CALL_STATE",(function(){return f})),n.d(t,"REMOVE_USER",(function(){return h})),n.d(t,"TIME_START",(function(){return p})),n.d(t,"HANGUP",(function(){return g})),n.d(t,"SET_CHAT_INFO",(function(){return m})),n.d(t,"GROUP_CALL_SETUP",(function(){return b})),n.d(t,"TOGGLE_POPUP",(function(){return v})),n.d(t,"UPDATE_HASH",(function(){return C})),n.d(t,"CHANGE_UI_MODE",(function(){return E})),n.d(t,"SET_ORATOR",(function(){return y})),n.d(t,"TOGGLE_ORATOR_MODE",(function(){return O})),n.d(t,"TOGGLE_PARTICIPANTS_ASIDE",(function(){return T})),n.d(t,"SET_PINNED_PARTICIPANT",(function(){return w})),n.d(t,"MANAGEMENT",(function(){return N})),n.d(t,"CALL_NOTIFICATION",(function(){return I})),n.d(t,"JOIN",(function(){return k})),n.d(t,"ERROR",(function(){return A})),n.d(t,"CHANGE_PARTICIPANT_STATE",(function(){return S})),n.d(t,"SET_SCREEN_SHARER",(function(){return j})),n.d(t,"SET_FRIENDS",(function(){return L})),n.d(t,"SET_SPEAKERS",(function(){return M})),n.d(t,"UPDATE_PARTICIPANTS_BATCH",(function(){return P})),n.d(t,"SET_UNREAD_COUNT",(function(){return F})),n.d(t,"CallType",(function(){return o})),n.d(t,"UIMode",(function(){return s})),n.d(t,"CallStatus",(function(){return c})),n.d(t,"NotificationType",(function(){return u})),n.d(t,"SdkHandType",(function(){return l})),n.d(t,"defaultNotificationLifeSpan",(function(){return U})),n.d(t,"VOLUME_LEVEL_DETECTION",(function(){return G})),n.d(t,"BAD_CONNECTION_DISABLED_CAMERA_LEVEL",(function(){return q})),n.d(t,"HANGUP_DELAY",(function(){return W})),n.d(t,"CLIENT_ERROR_NOT_AUTHORIZED",(function(){return K})),n.d(t,"CLIENT_ERROR_NO_PERMISSIONS",(function(){return z})),n.d(t,"SERVER_ERROR_UNKNOWN",(function(){return V})),n.d(t,"SERVER_ERROR_INVALID_REQUEST",(function(){return Y})),n.d(t,"SERVER_ERROR_FLOOD_CONTROL",(function(){return $})),n.d(t,"SERVER_ERROR_INTERNAL",(function(){return Q})),n.d(t,"SERVER_ERROR_OLD_RECEIVER_APP",(function(){return X})),n.d(t,"SERVER_ERROR_PRIVACY",(function(){return J})),n.d(t,"SERVER_ERROR_BUSY",(function(){return Z})),n.d(t,"POPUP_SETTINGS",(function(){return ee})),n.d(t,"POPUP_EXIT",(function(){return te})),n.d(t,"CallStatReachedType",(function(){return R})),n.d(t,"CallStatResult",(function(){return x})),n.d(t,"CallStatFailReason",(function(){return D})),n.d(t,"CallStatSource",(function(){return B})),n.d(t,"CallActionEventType",(function(){return H})),n.d(t,"HANGUP_TYPE_BUSY",(function(){return ne})),n.d(t,"HANGUP_TYPE_CALLEE_IS_OFFLINE",(function(){return re})),n.d(t,"HANGUP_TYPE_CALLER_IS_BLOCKED",(function(){return ae})),n.d(t,"HANGUP_TYPE_CANCELED",(function(){return ie})),n.d(t,"HANGUP_TYPE_EXTERNAL_API_ERROR",(function(){return oe})),n.d(t,"HANGUP_TYPE_FAILED",(function(){return se})),n.d(t,"HANGUP_TYPE_HUNGUP",(function(){return ce})),n.d(t,"HANGUP_TYPE_MISSED",(function(){return ue})),n.d(t,"HANGUP_TYPE_NOT_FRIENDS",(function(){return le})),n.d(t,"HANGUP_TYPE_OLD_VERSION",(function(){return de})),n.d(t,"HANGUP_TYPE_REJECTED",(function(){return _e})),n.d(t,"HANGUP_TYPE_REMOVED",(function(){return fe})),n.d(t,"HANGUP_TYPE_SERVICE_DISABLED",(function(){return he})),n.d(t,"HANGUP_TYPE_UNKNOWN_ERROR",(function(){return pe})),n.d(t,"HANGUP_TYPE_UNSUPPORTED",(function(){return ge})),function(e){e.BUSY="BUSY",e.CALLEE_IS_OFFLINE="CALLEE_IS_OFFLINE",e.CALLER_IS_BLOCKED="CALLER_IS_BLOCKED",e.CANCELED="CANCELED",e.EXTERNAL_API_ERROR="EXTERNAL_API_ERROR",e.FAILED="FAILED",e.HUNGUP="HUNGUP",e.MISSED="MISSED",e.NOT_FRIENDS="NOT_FRIENDS",e.OLD_VERSION="OLD_VERSION",e.REJECTED="REJECTED",e.REMOVED="REMOVED",e.SERVICE_DISABLED="SERVICE_DISABLED",e.UNKNOWN_ERROR="UNKNOWN_ERROR",e.UNSUPPORTED="UNSUPPORTED"}(r||(r={})),function(e){e[e.HEADER=0]="HEADER",e[e.CALL_ALL_IN_CHAT=1]="CALL_ALL_IN_CHAT",e[e.MEMBERS_MORE=2]="MEMBERS_MORE",e[e.FRIENDS_MORE=3]="FRIENDS_MORE"}(a||(a={})),function(e){e[e.READY=0]="READY",e[e.CALL=1]="CALL",e[e.INCOMING=2]="INCOMING",e[e.JOIN=3]="JOIN",e[e.ERROR=4]="ERROR"}(i||(i={}));var o,s,c,u,l,d="load_peer",_="change_mode",f="call_state",h="remove_user",p="time_start",g="hangup",m="set_chat_info",b="group_call_setup",v="toggle_popup",C="update_hash",E="change_ui_mode",y="set_orator",O="toggle_orator_mode",T="toggle_participants_aside",w="set_pinned_participant",N="management",I="call_notification",k="join",A="error",S="change_participant_state",j="set_screen_sharer",L="set_friends",M="set_speakers",P="update_participants_batch",F="set_unread_count";!function(e){e.AUDIO="audio",e.VIDEO="video"}(o||(o={})),function(e){e.DEFAULT="default",e.COLLAPSED="collapsed",e.FULLSCREEN="fullscreen"}(s||(s={})),function(e){e.WAITING="WAITING",e.CONNECTING="CONNECTING",e.CONNECTED="CONNECTED",e.RECONNECT="RECONNECT",e.ERROR="ERROR",e.HANGUP="HANGUP",e.PERMISSIONS="PERMISSIONS"}(c||(c={})),function(e){e.SPEAKING_ON_MUTE="SPEAKING_ON_MUTE",e.RAISED_HAND="RAISED_HAND",e.SCREEN_SHARING_STARTED="SCREEN_SHARING_STARTED",e.BAD_NETWORK_CONNECTION="BAD_NETWORK_CONNECTION",e.BAD_NETWORK_CONNECTION_DISABLE_CAMERA="BAD_NETWORK_CONNECTION_DISABLE_CAMERA"}(u||(u={})),function(e){e.LOWERED="0",e.RAISED="1"}(l||(l={}));var R,x,D,B,H,U=5e3,G=.25,q=3,W=2,K=-1,z=-2,V=1,Y=8,$=9,Q=10,X=923,J=928,Z=948,ee="settings",te="exit";!function(e){e.AUDIO="ok_audio",e.AUDIO_TO_VIDEO="ok_video",e.VIDEO="ok_started_as_video",e.GROUP_AUDIO="group_audio",e.GROUP_AUDIO_TO_VIDEO="group_video",e.GROUP_VIDEO="group_started_as_video"}(R||(R={})),function(e){e.SUCCESS="success",e.FAIL="fail"}(x||(x={})),function(e){e.REMOTE_NO_CONNECT="push_not_delivered",e.REMOTE_FAILED_ACCEPT="сant_connect",e.REMOTE_DECLINE="declined_remote",e.LOCAL_DECLINE="declined_local",e.REMOTE_TIMEOUT="declined_timeout",e.REMOTE_BUSY="busy",e.CONNECTION_LOST="lost_connection"}(D||(D={})),function(e){e.CONVO_HEADER="im_header",e.CONVO_SNIPPET="im_message",e.CONVO_LIST="im_create",e.CONVO_JOIN_SNIPPET="im_join_message",e.CONVO_JOIN_HEADER="im_join_header",e.CONVO_JOIN_BANNER="im_join_header",e.LINK_JOIN_SNIPPET="join_deeplink",e.LINK_JOIN_PAGE="join_deeplink"}(B||(B={})),function(e){e.OUTGOING_CALL_STARTED_VIDEO="OutgoingCallStartedVideo",e.OUTGOING_CALL_STARTED_AUDIO="OutgoingCallStartedAudio",e.OUTGOING_CALL_ADD_PARTICIPANTS_SENT="OutgoingCallAddParticipantsSent",e.OUTGOING_CALL_REMOTE_RINGING="OutgoingCallRemoteRinging",e.OUTGOING_CALL_ACCEPTED_REMOTELY="OutgoingCallAcceptedRemotely",e.OUTGOING_CALL_FAILED="OutgoingCallFailed",e.OUTGOING_CALL_COMPLETED="OutgoingCallCompleted",e.INCOMING_CALL_RECEIVED="IncomingCallReceived",e.INCOMING_CALL_ACCEPTED="IncomingCallAccepted",e.CALL_DECLINED_OR_HANGED_LOCALLY="CallDeclinedOrHangedLocally",e.CALL_DECLINED_OR_HANGED_REMOTELY="CallDeclinedOrHangedRemotely",e.CALL_CONNECTED="CallConnected",e.CALL_DISCONNECTED="CallDisconnected",e.VIDEO_ENABLED="VideoEnabled",e.VIDEO_DISABLED="VideoDisabled",e.RELAY_CONNECTION_ESTABLISHED="RelayConnectionEstablished",e.USER_FEEDBACK_RECEIVED="UserFeedbackReceived",e.SYSTEM_STAT="SystemStat",e.GROUP_CALL_JOINED="GroupCallJoined",e.HAND_RAISED="HandRaised",e.HAND_LOWERED="HandLowered",e.SCREEN_SHARING_STARTED="ScreenSharingStarted",e.SCREEN_SHARING_STOPPED="ScreenSharingStopped",e.ALL_MICS_DISABLED="AllMicsDisabled",e.MIC_OFF_WHILE_TALKING_ALERT="MicOffWhileTalkingAlert",e.MIC_OFF_WHILE_TALKING_ENABLE_CLICK="MicOffWhileTalkingEnableClick",e.VIDEO_DISABLED_DUE_TO_BAD_CONNECTION_ALERT="VideoDisabledDueToBadConnectionAlert"}(H||(H={}));var ne=r.BUSY,re=r.CALLEE_IS_OFFLINE,ae=r.CALLER_IS_BLOCKED,ie=r.CANCELED,oe=r.EXTERNAL_API_ERROR,se=r.FAILED,ce=r.HUNGUP,ue=r.MISSED,le=r.NOT_FRIENDS,de=r.OLD_VERSION,_e=r.REJECTED,fe=r.REMOVED,he=r.SERVICE_DISABLED,pe=r.UNKNOWN_ERROR,ge=r.UNSUPPORTED},"86+7":function(e,t,n){"use strict";n.r(t),n.d(t,"oCacheExists",(function(){return a})),n.d(t,"oCacheGet",(function(){return i})),n.d(t,"oCacheAdd",(function(){return o}));n("KKXr");var r=n("aong");function a(e,t){return t in Object(r.unpackStore)(e).oCache}function i(e,t){var n=Object(r.unpackStore)(e).oCache[t];return n&&!n._n&&(!function(e){if(!e.first_name){var t=e.name.split(" ",2);e.first_name=t[0],e.short_name=t[1]?t[0]+" "+t[1].substr(0,1)+".":t[0]}e.inv_name||(e.inv_name=e.name),e.kick_name||(e.kick_name=e.inv_name)}(n),n._n=1),n}function o(e,t){var n=Object(r.unpackStore)(e);n.oCache||(n.oCache={}),t.id&&(n.oCache[t.id]=t)}},"8S/u":function(e,t,n){"use strict";n.r(t);var r=n("v+DW"),a=n("gF8j");function i(e,t){var n,r,a=!1;if(!e)throw new Error("Undefined filename");t=t||{};try{a=!!(r=ce("audio")).canPlayType,"no"!=r.canPlayType("audio/mpeg")&&""!=r.canPlayType("audio/mpeg")?n=".mp3?1":"no"==r.canPlayType('audio/ogg; codecs="vorbis"')||""==r.canPlayType('audio/ogg; codecs="vorbis"')||t.forceMp3?a=!1:n=".ogg?1"}catch(e){}var i=t.forcePath||"/"+e+n;if(a){r.src=i;var o=!1;r.addEventListener("ended",(function(){o=!0}),!0),r.load(),this.playSound=function(){o&&r.load();try{var e=r.play();e&&e.catch(e=>{debugLog(e)})}catch(e){}o=!1},this.pauseSound=function(){var e=r.pause();e&&e.catch(e=>{debugLog(e)})}}else{cur.__sound_guid=cur.__sound_guid||0;var s=ge("flash_sounds_wrap")||utilsNode.appendChild(ce("span",{id:"flash_sounds_wrap"})),c="flash_sound_"+cur.__sound_guid++;if(renderFlash(s,{url:"/swf/audio_lite.swf?4",id:c},{swliveconnect:"true",allowscriptaccess:"always",wmode:"opaque"},{})){var u=browser.msie?window[c]:document[c],l=!1,d=setInterval((function(){if(u&&u.paused)try{u.setVolume(1),u.loadAudio(i),u.pauseAudio()}catch(e){debugLog(e)}l=!0,clearInterval(d)}),300);this.playSound=function(){l&&u.playAudio(0)},this.pauseSound=function(){l&&u.pauseAudio()}}}}i.prototype={play:function(){try{this.playSound()}catch(e){}},pause:function(){try{this.pauseSound()}catch(e){}}},window.Sound=i;n("a1Th"),n("Btvt");var o=n("jE6c");window.curRBox||(window.curRBox={guid:0,active:!1,focused:[],tabs:{}});function s(e,t){var n=this;n.options=t=extend({minH:50,minW:50},t),n.content=e;var a=n.id="rb_box_"+(t.id||curRBox.guid++);n.wrap=ce("div",{id:a,className:"rb_box_wrap fixed"+(t.fixed?" fc_fixed":"")}),n.wrap.innerHTML+='<div class="tt-fastchat-wrap"></div>';var i={};n.toBottom=n.toRight=!1,t.fixed?(i.bottom=0,i.right=72):(void 0!==t.startTop?i.top=t.startTop:void 0!==t.startBottom&&(i.bottom=t.startBottom),void 0!==t.startLeft?i.left=t.startLeft:void 0!==t.startRight&&(i.right=t.startRight)),setStyle(n.wrap,i),t.movable&&addEvent(t.movable,"mousedown",n._head_mdown.bind(n)),n.resizeableH=t.resizeableH||e,t.startHeight&&setStyle(n.resizeableH,"height",t.startHeight),n.resizeableW=t.resizeableW||e,t.startWidth&&setStyle(n.resizeableW,"width",t.startWidth),addEvent(e,"mousedown",n._cont_mdown.bind(n)),t.closer&&(addEvent(t.closer,"mousedown",n._close_mdown.bind(n)),addEvent(t.closer,"click",n._close_click.bind(n))),t.hider&&(addEvent(t.hider,"mousedown",n._close_mdown.bind(n)),addEvent(t.hider,"click",n._hide_click.bind(n))),t.minimizer&&!0!==t.minimizer&&(addEvent(t.minimizer,"mousedown",n._close_mdown.bind(n)),addEvent(t.minimizer,"click",n._min_toggle.bind(n))),n.wrap.appendChild(e),!1!==t.resize&&(n.resizeWrap=ce("div",{className:"rb_resize_wrap",innerHTML:'<div class="chats_sp rb_resize"></div>'}),n.wrap.appendChild(n.resizeWrap),addEvent(n.resizeWrap,"mousedown",n._resize_mdown.bind(n))),t.minimized&&(addClass(n.wrap,"rb_minimized"),n.minimized=!0),bodyNode.insertBefore(n.wrap,ge("page_wrap"));var o=getStyle(n.wrap,"top"),s=getStyle(n.wrap,"bottom"),c=getStyle(n.wrap,"left"),u=getStyle(n.wrap,"right");this.toBottom=("auto"===o||""===o||browser.msie&&0===o)&&"auto"!=s&&""!==s&&!(browser.msie&&0===s),this.toRight=("auto"===c||""===c||browser.msie&&0===c)&&"auto"!=u&&""!==u&&!(browser.msie&&0===u),this.toRight&&setStyle(n.wrap,{marginRight:lastWndScroll[0]?Object(r.sbWidth)():0}),(t.nofocus||t.noshow)&&addClass(n.wrap,"rb_inactive"),this.toBottom&&(setStyle(n.wrap,{marginRight:lastWndScroll[0]?Object(r.sbWidth)():0}),addClass(n.wrap,"fc_tobottom")),this.options.marginFixedToLayer&&setStyle(n.wrap,{marginRight:hasClass(document.body,"layers_shown")?Object(r.sbWidth)():0}),curRBox.tabs[a]=n,n.pos=!1,t.noshow?(setStyle(n.wrap,{visibility:"hidden",display:"block"}),n._update_pos(),setStyle(n.wrap,{visibility:"",display:""})):n.show(!1,t.nofocus)}extend(s.prototype,{show:function(e){function t(t,n){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}((function(e,t){var n=this;void 0===e&&(e=0),e?(setStyle(n.wrap,{opacity:0,display:"block"}),n.visible=!0,!t&&n.focus(),animate(n.wrap,{opacity:1},e,(function(){setStyle(n.wrap,browser.msie?{filter:"none"}:{opacity:""}),n._update_pos()}))):(show(n.wrap),n.visible=!0,!t&&n.focus(),n._update_pos()),n.options.onShow&&n.options.onShow()})),hide:function(e){function t(t,n,r){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}((function(e,t,n){var r=this;if(!t&&r.options.onBeforeHide&&r.options.onBeforeHide())return!0;void 0===e&&(e=0),e?(setStyle(r.wrap,{opacity:1,display:"block"}),animate(r.wrap,{opacity:0},e,(function(){hide(r.wrap),setStyle(r.wrap,browser.msie?{filter:"none"}:{opacity:""})}))):hide(r.wrap),r.visible=!1,!t&&r.options.onHide&&r.options.onHide(n||{})})),_head_mdown:function(e){if(!checkEvent(e)){(e.originalEvent||e).cancelBubble=!0;var t,n,a=this,i=e.target,o=getWndInner(),s=curRBox.active==a.id,c=e.pageY,u=e.pageX,l=a.wrap.offsetHeight,d=a.wrap.offsetWidth,_=0,f=0,h=o[0]-l,p=o[1]-d,g=browser.msie?"selectstart":"mousedown";a.options.fixed&&FastChat.pinTab(a.options.peer||-1,e,!0),s||a.focus(e),a.toBottom?(a.toBottom=!1,t=o[0]-intval(getStyle(a.wrap,"bottom"))-l,setStyle(a.wrap,{top:t,bottom:"auto"}),removeClass(a.wrap,"fc_tobottom")):t=intval(getStyle(a.wrap,"top")),a.toRight?(a.toRight=!1,n=o[1]-intval(getStyle(a.wrap,"right"))-d,setStyle(a.wrap,{left:n,right:"auto"})):n=intval(getStyle(a.wrap,"left")),_=t,f=n,cur._fcdrag=1;var m=function(e){return _=Math.max(0,Math.min(h,t+e.pageY-c)),h-_<10?_=h:_<10&&(_=0),a.wrap.style.top=_+"px",f=Math.max(0,Math.min(p,n+e.pageX-u)),p-f<10?f=p:f<10&&(f=0),a.wrap.style.left=f+"px",cancelEvent(e)};return addEvent(document,"mousemove",m),addEvent(document,"mouseup",(function e(t){cur._fcdrag=0,removeEvent(document,"mousemove",m),removeEvent(document,"mouseup",e),removeEvent(document,g,cancelEvent),setStyle(bodyNode,"cursor",""),setStyle(i,"cursor",""),(a.toBottom=_>=h-5)&&(setStyle(a.wrap,{top:"auto",bottom:0}),addClass(a.wrap,"fc_tobottom")),(a.toRight=f>=p-5)&&setStyle(a.wrap,{left:"auto",right:0,marginRight:lastWndScroll[0]?Object(r.sbWidth)():0}),a._update_pos();var n=Math.abs(t.pageY-c)<3&&Math.abs(t.pageX-u)<3;cur._fcpromo>0?cur._fcpromo=n?0:-1:a.options.minimizer&&n?!a.minimized&&s?a.minimize(!0):a.minimized&&a.unminimize(!0):a.options.onDragEnd&&a.options.onDragEnd(a.toBottom?-1:_/o[0],a.toRight?-1:f/o[1])})),addEvent(document,g,cancelEvent),setStyle(bodyNode,"cursor","move"),setStyle(i,"cursor","move"),!1}},_resize_mdown:function(e){if(!checkEvent(e)){this.focus(e);var t,n,a=this,i=e.target,o=getWndInner(),s=e.pageY,c=e.pageX,u=a.wrap.offsetHeight,l=a.wrap.offsetWidth,d=0,_=0,f=a.resizeableH.clientHeight-intval(getStyle(a.resizeableH,"paddingBottom"))-intval(getStyle(a.resizeableH,"paddingTop")),h=a.resizeableW.clientWidth-intval(getStyle(a.resizeableW,"paddingRight"))-intval(getStyle(a.resizeableW,"paddingLeft")),p=browser.msie?"selectstart":"mousedown",g=!browser.msie&&a.options.onResize||!1;a.toBottom?(a.toBottom=!1,t=o[0]-intval(getStyle(a.wrap,"bottom"))-u,setStyle(a.wrap,{top:t,bottom:"auto"}),removeClass(a.wrap,"fc_tobottom")):t=intval(getStyle(a.wrap,"top")),a.toRight?(a.toRight=!1,n=o[1]-intval(getStyle(a.wrap,"right"))-l,setStyle(a.wrap,{left:n,right:"auto"})):n=intval(getStyle(a.wrap,"left")),a.options.onResizeStart&&a.options.onResizeStart(f,h);var m=f+o[0]-t-u,b=h+o[1]-n-l,v=function(e){return d=Math.max(a.options.minH,Math.min(m,f+e.pageY-s)),m-d<10&&(d=m),a.resizeableH.style.height=d+"px",_=Math.max(a.options.minW,Math.min(b,h+e.pageX-c)),b-_<10&&(_=b),a.resizeableW.style.width=_+"px",g&&g(d,_),cancelEvent(e)};return addEvent(document,"mousemove",v),addEvent(document,"mouseup",(function e(t){removeEvent(document,"mousemove",v),removeEvent(document,"mouseup",e),removeEvent(document,p,cancelEvent),setStyle(bodyNode,"cursor",""),setStyle(i,"cursor",""),(a.toBottom=d==m)&&(setStyle(a.wrap,{top:"auto",bottom:0}),addClass(a.wrap,"fc_tobottom")),(a.toRight=_==b)&&setStyle(a.wrap,{left:"auto",right:0,marginRight:lastWndScroll[0]?Object(r.sbWidth)():0}),a._update_pos(),a.options.onResizeEnd&&a.options.onResizeEnd(d,_,o[0],o[1],a.toBottom,a.toRight)})),addEvent(document,p,cancelEvent),setStyle(bodyNode,"cursor","move"),setStyle(i,"cursor","move"),!1}},_update_pos:function(){var e=this;e.pos=[e.wrap.offsetTop,e.wrap.offsetLeft,e.wrap.offsetHeight,e.wrap.offsetWidth]},_wnd_resize:function(e,t,n){var r=this;r.toBottom&&(r.pos[0]=r.wrap.offsetTop),r.toRight&&(r.pos[1]=r.wrap.offsetLeft);var a={},i=!1,o=!1,s=r.pos[0]+r.pos[2]-e,c=r.pos[0],u=r.resizeableH.clientHeight-r.options.minH,l=r.pos[1]+r.pos[3]-t,d=r.pos[1],_=!1!==r.options.resize?r.resizeableW.clientWidth-r.options.minW:0;n&&(_<0&&setStyle(r.resizeableW,r.options.minW),u<0&&setStyle(r.resizeableH,r.options.minH)),(s<=0||c<=0&&u<=0)&&(l<=0||d<=0&&_<=0)||(s>0&&c>0&&(s-=c=Math.min(s,c),a.top=r.pos[0]-c,a.bottom=""),s>0&&u>0&&(u=Math.min(s,u),i=r.resizeableH.clientHeight-u),l>0&&d>0&&(l-=d=Math.min(l,d),a.left=r.pos[1]-d,a.right=""),l>0&&_>0&&(_=Math.min(l,_),o=r.resizeableW.clientWidth-_),!1!==o&&setStyle(r.resizeableW,"width",o),!1!==i&&setStyle(r.resizeableH,"height",i),setStyle(r.wrap,a),r._update_pos(),r.options.onResize&&r.options.onResize(r.resizeableH.clientHeight,r.resizeableW.clientWidth))},_cont_mdown:function(e){if(curRBox.active!=this.id&&(this.focus(e),!hasClass(e.target,"fc_editable")))return cancelEvent(e)},_focus:function(){var e=this,t=indexOf(curRBox.focused,e.id),n=curRBox.active,r=n&&curRBox.tabs[n];if(n!=e.id){r&&Object(o.isFunction)(r.options.onBlur)&&r.options.onBlur(),-1!=t&&curRBox.focused.splice(t,1),curRBox.focused.unshift(e.id);var a=1e4+curRBox.focused.length,i=!0;each(curRBox.focused,(function(e,t){var n=curRBox.tabs[t].wrap;i?(addClass(n,"rb_active"),removeClass(n,"rb_inactive"),curRBox.active=t,i=!1):(removeClass(n,"rb_active"),addClass(n,"rb_inactive")),setStyle(n,"zIndex",a),a--}))}},_hide_click:function(){this.hide()},minimize:function(e){var t=this,n=t.wrap;if(t.options.fixed)return!1;addClass(n,"rb_minimized"),t.minimized=!0,t._update_pos(),e&&t.options.onMinimize&&t.options.onMinimize(0)},unminimize:function(e){var t=this,n=t.wrap,r=getWndInner();removeClass(n,"rb_minimized"),t.minimized=!1,t._update_pos(),t._wnd_resize(r[0],r[1],!0),curRBox.active=!1,t.focus(),e&&t.options.onMinimize&&t.options.onMinimize(1)},_min_toggle:function(e){var t=this;setTimeout((function(){t.minimized?t.unminimize(!0):t.minimize(!0)}),50)},destroy:function(){var e=this,t=indexOf(curRBox.focused,e.id);-1!=t&&curRBox.focused.splice(t,1),cleanElems(e.wrap,e.resizeWrap,e.content,e.options.movable,e.options.closer,e.options.hider),re(e.wrap),delete curRBox.tabs[e.id]},_close_mdown:function(e){(e.originalEvent||e).cancelBubble=!0},_close_click:function(e){this.close()},_close:function(e){this.destroy(),curRBox.focused[0]&&!0!==e&&curRBox.tabs[curRBox.focused[0]].focus()},focus:function(e){var t=this,n=curRBox.active!=t.id||!0;return t._focus(),n&&Object(o.isFunction)(t.options.onFocus)&&t.options.onFocus(e),n},close:function(){var e=this,t=e.pos;e._close(),Object(o.isFunction)(e.options.onClose)&&e.options.onClose(t)}}),window.RBox=s;n("zNZe"),n("HEwt"),n("rE2o"),n("ioFf"),n("Vd3H"),n("SRfc"),n("Oyvg"),n("KKXr"),n("pIFo"),n("91GP"),n("rGqo"),n("OEbY"),n("VRzm");var c=n("FWc3"),u=n("4+be"),l=n("uytb"),d=n("rjmT"),_=n("S2bU"),f=n("f01n"),h=n("hOuX"),p=n("BxOC"),g=n("DM26"),m=n("XzvV"),b=n("MhhX"),v=n("P13b"),C=n("vT4u");function E(){return(E=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}function y(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var n=[],r=!0,a=!1,i=void 0;try{for(var o,s=e[Symbol.iterator]();!(r=(o=s.next()).done)&&(n.push(o.value),!t||n.length!==t);r=!0);}catch(e){a=!0,i=e}finally{try{r||null==s.return||s.return()}finally{if(a)throw i}}return n}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return O(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return O(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function O(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function T(){return!curFastChat.version||!curFastChat.tabs}function w(e,t){var n=y(e,6);return{name:n[0],photo:n[1],fname:n[2],hash:n[3],sex:n[4],link:n[5],online:curFastChat.onlines[t]}}window.curFastChat||(window.curFastChat={}),window.FastChat={init:function(e){var t=this;0!==vk.id&&(extend(curFastChat,{tabs:{},needPeers:{},gotPeers:{},needMedia:{},gotMedia:{},ldb:Object(l.mount)(vk.id),myTypingEvents:{},typingEvents:{},inited:!0,options:e,posSeq:0,error_timeout:1,lpInstance:Notifier.getLpInstance()}),delete curFastChat.standby,delete curFastChat.standbyTO,curFastChat.lpInstance.onData((function(){for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];var a=t.getResourcesThatShouldBeLoaded(n),i=a.shouldLoad?t.loadResources(a):Promise.resolve();i.then(()=>{n.forEach(e=>{switch(e.type){case f.TYPING:var n=t.getTab(e.peerId);t.setTyping(e),n&&(t.updateTypings(),t.waitTyping(e).then(t.updateTypings)),t.blinkTyping(e.peerId);break;case f.ADD_MESSAGE:var r=t.getTab(e.peerId);t.setTyping(e),r&&(t.addMessage(t.prepareMessageData(e)),t.scroll(e.peerId),t.blinkTab(e.peerId),t.updateTypings(),t.waitTyping(e).then(t.updateTypings)),t.updateTabUnreadCounter(r,e);break;case f.EDIT_MESSAGE:case f.REPLACE_MESSAGE:var a=e.peerId,i=e.messageId,o=t.getTab(a);o&&o.msgs[i]&&(delete curFastChat.gotMedia[i],t.editMessage(t.prepareMessageData(e)));break;case f.REPLACE_FLAGS:case f.SET_FLAGS:case f.RESET_FLAGS:e.flags&f.FLAG_DELETED&&t.deleteMessage(t.prepareMessageData(e));break;case f.READ_INBOUND:case f.READ_OUTBOUND:t.markMessagesAsRead(e);break;case f.CHAT_CHANGED:case f.CONVERSATION_UPDATED:var s=t.getTab(e.peerId);t.handleEventChatUpdated(s,e);break;case f.VIDEO_CALL:case f.UNREAD_COUNT:case f.NOTIFY_SETTINGS_CHANGED:case f.EMPTY:case f.RESYNC:case f.REFRESH_LP_KEY:case f.TRANSITION:case f.RESET_PEER:case f.MUTEX:case f.CHANGE_PEER:case f.CHANGE_TAB:case f.FAILED_MESSAGE:case f.RESEND:case f.DELETE_DIALOG:}})})})),Notifier.addRecvClbk("fastchat",0,FastChat.lcRecv,!0),Notifier.addRecvClbk("logged_off",0,FastChat.standby,!0),FastChat.lcSend("needSettings",{version:e.version,lang_id:langConfig.id}),clearTimeout(curFastChat.getSettingsTO),curFastChat.getSettingsTO=setTimeout(FastChat.getSettings,300))},getSettings:function(){var e=ls.get("fcFriends"+vk.id);ajax.post("al_im.php",{act:"a_get_fast_chat",friends:e&&e.version,cache_time:FastChat.cachedStickersKeywordsTime()},{onDone:function(t){-1==t.friends?(t.friends_version=e.version,t.friends=e.list):ls.set("fcFriends"+vk.id,{version:t.friends_version,list:t.friends}),FastChat.gotSettings(t),FastChat.sendSettings()},onFail:function(){return!0}})},cachedStickersKeywordsTime:function(){var e=ls.get("stickers_keywords");return e&&e.time?Math.floor(e.time/1e3):0},gotSettings:function(e){e.emoji_stickers&&(window.emojiStickers=e.emoji_stickers),window.Emoji&&Emoji.updateTabs(),e.autoplay_animations&&window.StickersSettings.setAutoplay(e.autoplay_animations),clearTimeout(curFastChat.getSettingsTO),window.lang=extend(window.lang||{},e.lang),extend(curFastChat,e,{lang_id:langConfig.id}),curFastChat.friendsCnt=Object.keys(curFastChat.friends),setTimeout(FastChat.clistCache.pbind(!1),10),FastChat.initUI()},sendSettings:function(){clearTimeout(curFastChat.sendSettingsTO);var e=["friends","friends_version","onlines","tpl","lang","me","version"].reduce((e,t)=>(e[t]=curFastChat[t],e),{});curFastChat.sendSettingsTO=setTimeout((function(){FastChat.lcSend("settings",{settings:e})}),curNotifier.is_server?0:irand(50,100))},destroy:function(){return!!curFastChat.inited&&(curFastChat.ldb.unmount(),each(curFastChat.tabs||{},(function(e,t){t.box.destroy()})),curFastChat.clistBox&&curFastChat.clistBox.destroy(),each(curFastChat.el||{},(function(){cleanElems(this)})),clearInterval(curFastChat.updateFriendsInt),clearTimeout(curFastChat.correspondentsTO),clearTimeout(curFastChat.lp_error_to),curFastChat={inited:!1},!0)},isChatOpen:function(e){if(window.curFastChat&&curFastChat.inited&&e){var t=curFastChat.tabs,n=curFastChat.clistBox;if(t&&t[e]&&t[e].box.visible||n&&n.visible)return!0}return!1},standby:function(e){FastChat.destroy(),curFastChat.standby=!0;var t=1;!function n(){if(!curNotifier.is_server)return clearTimeout(curFastChat.standbyTO),void(curFastChat.standbyTO=setTimeout(n,1e3*t));ajax.post("notifier.php?act=a_get_reload",{version:e},{onDone:function(e,t){FastChat.lcSend("gotConfig",{navVersion:e,config:t}),FastChat.gotConfig(e,t)},onFail:function(){return t*=2,clearTimeout(curFastChat.standbyTO),curFastChat.standbyTO=setTimeout(n,1e3*t),!0}})}()},gotConfig:function(e,t){clearTimeout(curFastChat.standbyTO),curFastChat.standby&&setTimeout((function(){if(e>stVersions.nav){debugLog("appending al loader");var n=vk.navPostfix||"";headNode.appendChild(ce("script",{type:"text/javascript",src:`/js/loader_nav${n}${e}_${vk.lang}.js`}))}setTimeout((function(){e<=stVersions.nav?stManager.add(["notifier.js","notifier.css",jsc("web/emoji.js")],(function(){FastChat.init(t)})):setTimeout(arguments.callee,100)}),0)}),curNotifier.is_server?0:irand(1e3,2e3))},updateVersion:function(e){FastChat.lcSend("standby",{version:e}),FastChat.standby(e)},lcSend:function(e,t){Notifier.lcSend("fastchat",extend({act:e,__id:curFastChat.me&&curFastChat.me.id||vk.id},t))},lcRecv:function(e){if(!isEmpty(e)){var t=e.act;e.__id===(curFastChat.me&&curFastChat.me.id||vk.id)&&(delete e.act,delete e.__id,FastChat.lcFeed(t,e))}},lcFeed:function(e,t){switch(e){case"needSettings":curFastChat.version<t.version||t.lang_id==curFastChat.lang_id&&FastChat.sendSettings();break;case"settings":!curFastChat.version&&curFastChat.options&&t.settings.version==curFastChat.options.version&&FastChat.gotSettings(t.settings),clearTimeout(curFastChat.sendSettingsTO);break;case"standby":T()||FastChat.standby(t.version);break;case"gotConfig":FastChat.gotConfig(t.navVersion,t.config);break;case"clistOnlines":T()||FastChat.clistGotOnlines(t);break;case"needPeer":if(T())break;var n=t.id,r=curFastChat.tabs[n],a=curFastChat.friends[n+"_"],i=!1;if(void 0!==r?(i={name:r.name,photo:r.photo,fname:r.fname,hash:r.hash,sex:r.sex,data:r.data,online:r.online},Object.keys(r.msgs).length>0&&(i.history=[r.log.innerHTML,r.msgs])):a&&(i=w(a,n)),!1===i)break;curFastChat.gotPeers[n]=setTimeout((function(){var e={};e[n]=i,FastChat.lcSend("gotPeers",e)}),curNotifier.is_server?0:irand(50,100));break;case"fetchingPeers":if(T())break;each(t,(function(e,t){var n=curFastChat.needPeers[e];n&&(t&n[0])==n[0]&&clearTimeout(n[2])}));break;case"gotPeers":T()||FastChat.gotPeers(t);break;case"stateChange":T()||FastChat.onStateChanged(t);break;case"needMedia":var o=t.msgId,s=curFastChat.gotMedia[o];if(void 0===s||0===s)break;curFastChat.gotMedia[o][3]=setTimeout((function(){FastChat.lcSend("gotMedia",{msgId:o,peer:s[0],text:s[1],msgOpts:s[2]})}),curNotifier.is_server?0:irand(50,100));break;case"fetchingMedia":var c=t.msgId,u=curFastChat.needMedia[c];if(void 0===u||0===curFastChat.gotMedia[c])break;clearTimeout(u[1]),u[1]=setTimeout(FastChat.loadMsgMedia.pbind(u[0],c),1e3);break;case"gotMedia":var l=t.msgId,d=curFastChat.gotMedia[l];isArray(d)&&clearTimeout(d[3]),FastChat.gotMsgMedia(t.peer,l,t.text,t.msgOpts)}},getResourcesThatShouldBeLoaded(e){var t={},n=e.filter(e=>e.type===f.ADD_MESSAGE),r=e.filter(b.isServiceMsg),a=n.filter(e=>!this.isTabLoaded(e.peerId)).map(e=>e.peerId);function i(e,n){var r=FastChat.getTab(e);Object(v.isChatPeer)(e)&&n&&r&&!r.data.members[n]&&(t[e]?-1===t[e].indexOf(n)&&t[e].push(n):t[e]=[n])}return n.forEach(e=>{this.isTabLoaded(e.peerId)&&i(e.peerId,e.userId)}),r.forEach(e=>{i(e.peerId,+e.kludges.source_mid)}),{shouldLoad:Object.keys(t).length>0||a.length>0,needPeers:a,needMembers:t}},loadResources(e){var t=e.needMembers,n=curFastChat.lpInstance;return n.pause(),this.loadMembers(t).then(()=>n.resume())},loadMembers(e){if(0===Object.keys(e).length)return Promise.resolve();var t=Object.keys(e).map(t=>`${t}:${e[t].join(",")}`).join(";");return Object(p.post)(C.CONTROLLER,{act:"a_load_member",need:t}).then(t=>{var n=y(t,1)[0];Object.keys(e).forEach(t=>{var r=this.getTab(t);r&&r.data&&r.data.members&&(r.data.members=e[t].reduce((e,t)=>{var r=n.find(e=>e.id===t);return e[t]=Object.assign({name_inv_case:r.inv_name,name_kick_case:r.kick_name},r),e},r.data.members))})})},handleEventChatUpdated(e,t){switch(t.updateType){case f.MAIL_CHAT_UPDATE_TYPE_TITLE_CHANGED:case f.MAIL_CHAT_UPDATE_TYPE_AVATAR_CHANGED:var n=[t.peerId,0].join(",");this.loadPeers(n,e=>{this.updateChatInfo(t.peerId,e)});break;case f.MAIL_CHAT_UPDATE_TYPE_ADMIN_GRANTED:case f.MAIL_CHAT_UPDATE_TYPE_FLAGS_CHANGED:case f.MAIL_CHAT_UPDATE_TYPE_PINNED:case f.MAIL_CHAT_UPDATE_TYPE_USER_JOINED:case f.MAIL_CHAT_UPDATE_TYPE_USER_LEFT:case f.MAIL_CHAT_UPDATE_TYPE_USER_KICKED:case f.MAIL_CHAT_UPDATE_TYPE_ADMIN_KICKED:case f.MAIL_CHAT_UPDATE_TYPE_BANNER_CHANGED:case f.MAIL_CHAT_UPDATE_TYPE_KEYBOARD_CHANGED:}},updateChatInfo(e,t){var n=this.getTab(e),r=t[e],a=r.photo,i=r.grid,o=r.name,s=document.querySelector(`#chat_tab_icon_${e} .chat_tab_img`),c=document.createElement(a?"img":"div"),u=n&&n.unread?" ("+n.unread+")":"";n&&n.title&&(n.name=o,n.title.innerHTML=o+u),c.classList.add("chat_tab_img"),i?c.innerHTML=`<div class="chat_tab_grid">${i}</div>`:a&&(c.id="im_dialog_ph"+(e-2e9),c.src=a),s&&s.parentNode.replaceChild(c,s)},blinkEl:function(e,t,n){if(t>10)return n(),!1;t%2==0?animate(e,{opacity:0},400,(function(){FastChat.blinkEl(e,t+1,n)})):animate(e,{opacity:1},400,(function(){setTimeout((function(){FastChat.blinkEl(e,t+1,n)}),400)}))},blinkTyping:function(e){var t=ge("chat_tab_icon_"+e);if(t){var n=geByClass1("chat_tab_typing_wrap",t);fadeIn(n,150,(function(){FastChat.blinkEl(n.firstChild,0,(function(){fadeOut(n,150)}))}))}},imFeed:function(e,t){var n=this.getTab(e);if(!n)return!1;n.auto&&!n.unread&&(n.box._close(!0),delete curFastChat.tabs[e])},tabNotify:function(e,t,n){var r,a=curFastChat.tabs[e];if(e>0&&e<2e9&&Object(o.isFunction)(cur.onPeerStatusChanged)&&cur.onPeerStatusChanged(e,t,n),!(e<=0)&&a&&a.box&&!a.box.minimized){switch(clearTimeout(a.hideNotifyTO),t){case"online":r=Object(u.getLang)("mail_im_user_became_online",3-a.sex),FastChat.blinkTab(e);break;case"offline":r=Object(u.getLang)("mail_im_user_became_offline",3-a.sex),FastChat.blinkTab(e);break;case"unavail":r=Object(u.getLang)("mail_im_not_online",3-a.sex).replace(/\.$/,"")}r=r.replace("{user}",a.fname),val(a.notify,'<div class="fc_tab_notify fc_tab_notify_'+t+'">'+r+"</div>");var i=a.notify.firstChild;clearTimeout(a.hideNotifyTO),a.hideNotifyTO=setTimeout((function(){fadeOut(i,200,(function(){val(a.notify,"")}))}),5e3)}},hideChatCtrl:function(){removeClass(Chat.wrap,"chat_active"),removeEvent(document,"mousedown",FastChat.onDocClick)},showChatCtrl:function(){addClass(Chat.wrap,"chat_active"),setTimeout((function(){addEvent(document,"mousedown",FastChat.onDocClick)}),0)},hideUI:function(){addClass(bodyNode,"chat_onl_hidden")},showUI:function(){removeClass(bodyNode,"chat_onl_hidden")},initUI:function(){if(curFastChat.options){var e=curFastChat.el={},t=getWndInner();re("rb_box_fc_clist"),e.clistWrap=se(curFastChat.tpl.clist),e.clist=geByClass1("fc_contacts",e.clistWrap,"div"),e.clistTitle=geByClass1("fc_tab_title",e.clistWrap,"div"),e.clistOnline=geByClass1("fc_clist_online",e.clistWrap,"div");var n=curFastChat.options.state||!1,r=!curFastChat.friendsCnt||(n&&void 0!==n.clist.min?n.clist.min:t[1]<1200||curFastChat.friendsCnt<5);curFastChat.clistW=270,curFastChat.clistH=299;var a={id:"fc_clist",movable:geByClass1("fc_tab_head",e.clistWrap),hider:geByClass1("fc_tab_close_wrap",e.clistWrap,"a"),startHeight:curFastChat.clistH,startWidth:curFastChat.clistW,resizeableH:e.clist,resize:!1,minH:150,fixed:r,onHide:function(){val("fc_clist_filter",curFastChat.q=""),addClass(curFastChat.clistBox.wrap,"fc_fixed"),curFastChat.clistBox.fixed=!0,FastChat.stateChange({op:"clist_toggled",val:0}),setStyle(curFastChat.clistBox.wrap,{top:"auto",bottom:0,right:72,left:"auto"}),show(e.topLink),FastChat.hideChatCtrl()},onShow:function(){FastChat.showChatCtrl()},onDragEnd:function(e,t){FastChat.stateChange({op:"clist_moved",y:e,x:t})},onResize:function(){curFastChat.clistBoxScroll&&curFastChat.clistBoxScroll.update(!1,!0)}};n&&!r&&(!1!==n.clist.x&&(-1==n.clist.x?a.startRight=0:a.startLeft=t[1]*n.clist.x),!1!==n.clist.y&&(-1==n.clist.y?a.startBottom=0:a.startTop=t[0]*n.clist.y)),r&&(a.noshow=!0),void 0===a.startTop&&void 0===a.startBottom&&(a.startTop=t[0]<800?0:.1*t[0]),void 0===a.startLeft&&void 0===a.startRight&&(a.startRight=0),curFastChat.clistBox=new RBox(e.clistWrap,a),a.noshow||void 0===a.startLeft&&void 0===a.startTop||curFastChat.clistBox._wnd_resize(t[0],t[1],!0),curFastChat.clistBoxScroll=new Scrollbar(e.clist,{prefix:"fc_",scrollChange:FastChat.clistShowMore,nomargin:!0,global:!0,nokeys:!0,right:vk.rtl?"auto":1,left:vk.rtl?1:"auto"}),curFastChat.updateFriendsInt=setInterval(FastChat.clistUpdate,18e4);var i,o=ge("fc_clist_filter");if(placeholderInit(o,{global:!0}),curFastChat.q="",addEvent(o,"keyup "+(browser.opera?"keypress":"keydown"),(function(e){if(e.keyCode===KEY.ESC)return FastChat.clistHide(),cancelEvent(e);var t=FastChat.clistFilterKey(e);if(void 0!==t)return t;curFastChat.q=trim(val(this)),FastChat.clistRender()})),e.clistOnline)bodyNode.appendChild(i=ce("nobr",{className:"fl_l",innerHTML:Object(u.getLang)("mail_im_clist_onlines")},{visibility:"hidden",position:"absolute"})),re(i),addEvent(e.clistOnline,"mouseover",(function(t){Object(c.showTooltip)(this,{text:Object(u.getLang)("mail_im_clist_onlines"),forcetoup:1,shift:[12,4,3],className:"tt_fc_onlines",init:function(){browser.msie&&(e.clistOnline.tt.isFixed=!1)},black:1})})),addEvent(e.clistOnline,"click",(function(e){(e.originalEvent||e).cancelBubble=!0,FastChat.clistToggleOnlines(),FastChat.clistRender()})),n&&n.clist&&n.clist.onlines&&FastChat.clistToggleOnlines(!0);r?FastChat.clistUpdateTitle():FastChat.clistRender(),curFastChat.ready=!0,n&&n.tabs&&each(n.tabs,(function(e,n){e=intval(e);var r={nofocus:1};this.min&&(r.minimized=!0),this.h&&(r.startHeight=this.h*t[0]),this.w&&(r.startWidth=this.w*t[1]),void 0!==this.x&&this.x<=1&&(this.x<0?r.startRight=0:r.startLeft=t[1]*this.x),void 0!==this.y&&this.y<=1&&(this.y<0?r.startBottom=0:r.startTop=t[0]*this.y),n.fx?(r.fixedLoad=!0,FastChat.prepareTabIcon(e,r,!0)):(r.noAnim=!0,FastChat.addPeer(e,!1,!1,r))})),addEvent(Chat.itemsCont,"mouseover",FastChat.itemsTT),addEvent(Chat.itemsCont,"mouseout",FastChat.itemsOut)}},itemsOffset:12,itemsTT:function(e){for(var t=e.target,n=!1;t&&t!=Chat.itemsCont;){if(hasClass(t,"chat_tab_wrap")){n=t;break}t=t.parentNode}if(!n)return clearTimeout(Chat.ttOutTimeout),Chat.ttOutTimeout=!1,!1;var r=n.id.split("_")[3],a=Chat.tabs[r];return!!a&&(curFastChat.activeBox&&curFastChat.activeBox.visible&&curFastChat.activeBox.options.peer==r?(FastChat.itemsOut(),!1):(clearTimeout(Chat.ttOutTimeout),Chat.ttOutTimeout=!1,Object(c.showTooltip)(n,{text:a.name,slideX:15,black:1,asrtl:1,appendEl:Chat.ttNode,className:"tt_black_side",shift:[-58,-37,0],zIndex:10201}),void(Chat.ttPeer=n)))},itemsOut:function(){if(Chat.ttOutTimeout)return!1;Chat.ttOutTimeout=setTimeout((function(){if(Chat.ttOutTimeout=!1,!Chat.ttPeer)return!1;triggerEvent(Chat.ttPeer,"mouseout"),Chat.ttPeer=!1}),0)},stateChange:function(e){ajax.post("al_im.php",extend({act:"a_state_fc",hash:curFastChat.options.state_hash||""},e),{onFail:function(){return!0}}),FastChat.lcSend("stateChange",e)},onStateChanged:function(e){var t=!!e.peer&&curFastChat.tabs[e.peer],n=e.peer?t&&t.box:curFastChat.clistBox,r=getWndInner();switch(e.op){case"added":if(t){delete t.auto;break}e.fixed?FastChat.prepareTabIcon(e.peer,{fixedLoad:!0}):FastChat.addPeer(e.peer);break;case"unfixed":var a={startHeight:intval(r[0]*e.h),startWidth:intval(r[1]*e.w)};-1==e.y?a.startBottom=0:a.startTop=intval(r[0]*e.y),-1==e.x?a.startRight=0:a.startLeft=intval(r[1]*e.x),FastChat.addPeer(e.peer,!1,!1,a);break;case"closed":if(Chat.tabs[e.peer]&&FastChat.closeTabIcon(e.peer),!t||!n)break;n.close();break;case"hidden":if(!t||!n)break;n.close();break;case"minimized":if(!t||!n)break;e.val?n.unminimize():n.minimize();break;case"moved":setStyle(n.wrap,{bottom:-1==e.y?0:"auto",top:-1!=e.y?intval(r[0]*e.y):"auto",right:-1==e.x?0:"auto",left:-1!=e.x?intval(r[1]*e.x):"auto"}),n.toBottom=-1==e.y,n.toRight=-1==e.x;break;case"resized":setStyle(n.wrap,{bottom:-1==e.y?0:"auto",top:-1!=e.y?intval(r[0]*e.y):"auto",right:-1==e.x?0:"auto",left:-1!=e.x?intval(r[1]*e.x):"auto"}),n.toBottom=-1==e.y,n.toRight=-1==e.x;var i=intval(r[1]*e.w);setStyle(n.resizeableH,"height",intval(r[0]*e.h)),setStyle(n.resizeableW,"width",i),FastChat.fixResized(t,i);break;case"clist_toggled":e.val?n.show(0,!0):n.hide(0,!0),toggle(curFastChat.el.topLink,!e.val);break;case"clist_moved":setStyle(n.wrap,{bottom:-1==e.y?0:"auto",top:-1!=e.y?intval(r[0]*e.y):"auto",right:-1==e.x?0:"auto",left:-1!=e.x?intval(r[1]*e.x):"auto"}),n.toBottom=-1==e.y,n.toRight=-1==e.x;break;case"onlines_toggled":FastChat.clistToggleOnlines(e.val),FastChat.clistRender()}},onUnidle:function(){curNotifier.version&&curFastChat.clistBox&&(curFastChat.clistBox.visible&&(curFastChat.el.clist.scrollTop<100||curRBox.active!=curFastChat.clistBox.id)?FastChat.clistRender():FastChat.clistUpdateTitle(),each(curFastChat.tabs,(function(e){FastChat.restoreDraft(e)})))},clistUpdate:function(){var e=vkNow();if(curNotifier.is_server&&!(curFastChat.clistUpdatedTs&&e-curFastChat.clistUpdatedTs<6e4)){curFastChat.clistUpdatedTs=e;var t=Object.keys(curFastChat.tabs).concat(Object.keys(Chat.tabs)).join();ajax.post("al_im.php",{act:"a_onlines",peer:t},{onDone:function(e){FastChat.clistGotOnlines(e),FastChat.lcSend("clistOnlines",e)},onFail:()=>!0})}},clistGotOnlines:function(e){var t=curFastChat.onlines,n=[];curFastChat.onlines=e,curNotifier.idle_manager&&curNotifier.idle_manager.is_idle||!curFastChat.tabs&&Chat.tabs||(each(curFastChat.tabs,(function(r){curFastChat.onlines[r]!=t[r]&&(FastChat.tabNotify(r,e[r]?"online":"offline",e[r]),e[r]||(n[r]=1))})),each(Chat.tabs,(function(n){if(curFastChat.onlines[n]!=t[n]){var r=geByClass1("_chat_tab_image",ge("chat_tab_icon_"+n));toggleClass(r,"online",e[n]),toggleClass(r,"mobile",e[n]&&mobPlatforms[e[n]])}})),n=arrayKeyDiff(t,e,n),each(n,(function(e){FastChat.tabNotify(e,"offline")})),FastChat.clistRender())},clistShow:function(){var e=hasClass(Chat.wrap,"chat_active");FastChat.clistRender(),curFastChat.clistBox.visible?curFastChat.clistBox.focus():(curFastChat.activeBox&&curFastChat.activeBox!=curFastChat.clistBox&&curFastChat.activeBox.hide(),curFastChat.clistBox.show(),FastChat.setActive(curFastChat.clistBox),curFastChat.clistBoxScroll&&curFastChat.clistBoxScroll.update(!1,!0),curFastChat.el.topLink&&hide(curFastChat.el.topLink)),elfocus("fc_clist_filter"),FastChat.movePointer(!1,e)},clistHide:function(){curFastChat.clistBox.hide(),curFastChat.activeBox==curFastChat.clistBox&&FastChat.setActive(!1)},clistRender:function(e){var t=[],n=!e,r=1+(e?40:20),a=!1,i=!1,o=!1,s=curFastChat.q;if(s?(o=[],each(FastChat.clistCache(s),(function(){o.push(escapeRE(this))})),o=new RegExp("([ -]|^|s|&nbsp;|\b)("+o.join("|")+")","gi"),a=curFastChat.clistCache[s]||{}):curFastChat.clOnlines&&(a=curFastChat.onlines),curFastChat.clHasMore=!1,each(curFastChat.friends,(function(e){var s=intval(e),c=!a||a[s];if(n){if(c){if(!--r)return curFastChat.clHasMore=!0,!1;t.push(FastChat.clistWrapPeer(s,this,o)),i=s}}else s==curFastChat.clOffset&&(n=!0)})),!1!==i||e||s?s&&!curFastChat.clHasMore&&t.push(FastChat.getCorrespondents(s,o,!1===i)):t.push('<div class="fc_clist_empty">'+Object(u.getLang)(s?"mail_im_clist_notfound":"mail_im_clist_empty")+"</div>"),curFastChat.clOffset=i,e){for(var c=ce("div",{innerHTML:t.join("")}),l=document.createDocumentFragment();c.firstChild;)l.appendChild(c.firstChild);curFastChat.el.clist.appendChild(l),curFastChat.clHasMore||FastChat.clistUpdateTitle(!0)}else val(curFastChat.el.clist,t.join("")),FastChat.clistUpdateTitle(!0),(browser.chrome||browser.safari)&&setTimeout((function(){setStyle(curFastChat.el.clist.firstChild,{width:curFastChat.el.clist.firstChild.clientWidth}),setTimeout((function(){setStyle(curFastChat.el.clist.firstChild,{width:""})}),0)}),0);if(curFastChat.clSel){var d=ge("fc_contact"+curFastChat.clSel);d?FastChat.clistPeerOver(d,1):curFastChat.clSel=!1}else{var _=geByClass1("fc_contact",curFastChat.el.clist);FastChat.clistPeerOver(_,1)}curFastChat.clistBoxScroll&&curFastChat.clistBoxScroll.update()},clistWrapPeer:function(e,t,n){var r,a,i=curFastChat.tabs[e]?curFastChat.tabs[e].unread:0,o=curFastChat.onlines[e],s=onlinePlatformClass(o),c=(t[0]||"").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;");return n&&(c=c.replace(n,'$1<em class="fc_clist_hl">$2</em>')),e>0&&e<2e9?(r="/id"+e,a='onmousemove="FastChat.clistPeerOver(this.parentNode, 2);"  onmouseout="FastChat.clistPeerOver(this.parentNode, 1);"'):(r="/im?sel="+e,a=""),'<a href="'+r+'" class="fc_contact clear_fix" id="fc_contact'+e+'" onclick="return FastChat.selectPeer('+e+', event, { entrypoint: \'fastchat_search\' });" onmousedown="event.cancelBubble = true;" onmouseover="FastChat.clistPeerOver(this, 1, event);"  onmouseout="FastChat.clistPeerOver(this, 0, event);"><span class="fc_contact_photo'+s+'" '+a+">"+(e>2e9&&t[3]?t[3]:'<img src="'+Notifier.fixPhoto(t[1])+'" class="fc_contact_photo"/>')+'</span><span class="fc_contact_status"></span><span class="fc_contact_name">'+c+'<span id="fc_contact_unread'+e+'" class="fc_contact_unread">'+(i?" <b>+"+i+"</b>":"")+"</span></span></a>"},clistPeerOver:function(e,t,n){if(e&&checkOver(n,e)){var r=e.id.substr(10);curFastChat.clSel&&t&&curFastChat.clSel!=r&&FastChat.clistPeerOver(ge("fc_contact"+curFastChat.clSel),0),toggleClass(e,"fc_contact_over",t),t?curFastChat.clSel=r:curFastChat.clSel==r&&(curFastChat.clSel=!1)}},authorOver:function(e){var t=gpeByClass("fc_tab_log",e),n=e.getBoundingClientRect().top,r=t.getBoundingClientRect().top,a=e.getAttribute("data-title"),i=!1;if(n-r<10&&(i=!0),a){var o=e.getAttribute("data-date");o&&(a+="<br>"+o);var s=gpeByClass("rb_box_wrap",e).querySelector(".tt-fastchat-wrap");Object(c.showTooltip)(e,{text:'<div class="fc_author_tt">'+a+"</div>",black:1,center:1,forcetodown:i,appendEl:s,shift:[1,8,0]})}},getCorrespondents:function(e,t,n){return clearTimeout(curFastChat.correspondentsTO),curFastChat.correspondents&&void 0!==curFastChat.correspondents[e]?FastChat.wrapCorrespondents(curFastChat.correspondents[e])||n&&'<div class="fc_clist_empty">'+Object(u.getLang)("mail_im_clist_notfound")+"</div>"||"":(curFastChat.correspondentsTO=setTimeout(FastChat.loadCorrespondents.pbind(e,t),100),'<div id="fc_correspondents"></div>')},loadCorrespondents:function(e,t){e==curFastChat.q&&ajax.post("hints.php",{act:"a_json_friends",str:e,from:"fc",allow_multi:1},{onDone:function(n){curFastChat.correspondents||(curFastChat.correspondents={});var r,a={};if(each(n,(function(){r=this[3]+"_",curFastChat.friends[r]||(a[r]=[this[1],this[2],this[3],this[4]||""])})),curFastChat.correspondents[e]=a,e==curFastChat.q){var i=ge("fc_correspondents");if(i){var o=i.parentNode,s=ce("div",{innerHTML:FastChat.wrapCorrespondents(a,t)}),c=document.createDocumentFragment();if(s.firstChild)for(;s.firstChild;)c.appendChild(s.firstChild);else o.firstChild==i&&c.appendChild(ce("div",{className:"fc_clist_empty",innerHTML:Object(u.getLang)("mail_im_clist_notfound")}));o.replaceChild(c,i),FastChat.clistUpdateTitle(!0),curFastChat.clistBoxScroll&&curFastChat.clistBoxScroll.update()}}}})},wrapCorrespondents:function(e,t){var n=[];return each(e,(function(e){n.push(FastChat.clistWrapPeer(intval(e),this,t))})),n.join("")},updateFriends:function(e){if(window.Chat&&Chat.inited){var t=Chat.onl;t&&(e>0?(val(t,e),show(Chat.wrap)):hide(Chat.wrap))}},onDocClick:function(e){if(curFastChat.activeBox){var t=e.target;if(curBox())return!0;for(;t;){if("fc_tab_wrap"==t.className||-1!==["chat_onl_wrap","custom_menu_cont","layer_wrap","box_layer_wrap","wk_layer_wrap"].indexOf(t.id))return!0;t=t.parentNode}var n=curFastChat.tabs[curFastChat.activeBox.options.peer];if(n&&(trim(Emoji.editableVal(n.txt))||n.imMedia&&n.imMedia.getMedias().length))return!0;curFastChat.activeBox.hide()}},clistCache:function(e){if(e){var t,n,r,a,i,o,s=[e];if((n=Object(u.parseLatin)(e))&&s.push(n),(n=Object(u.parseLatKeys)(e))&&s.push(n),(n=Object(u.parseCyr)(e))&&s.push(n),void 0!==curFastChat.clistCache[e])return s;for(var c in o=curFastChat.clistCache[e]={},s)if(s.hasOwnProperty(c)&&(t=s[c],r=curFastChat.clistCache[" "+t.charAt(0).toLowerCase()]))for(var l in a=new RegExp("(^|\\s|\\()"+escapeRE(t),"gi"),r)if(r.hasOwnProperty(l)){if(i=curFastChat.friends[l+"_"],!isArray(i))continue;null!==i[0].match(a)&&(o[l]=1)}return o._num=Object.keys(o).length,s}var d,_,f;for(var h in curFastChat.clistCache={},curFastChat.friends)if(curFastChat.friends.hasOwnProperty(h))for(d=curFastChat.friends[h][0],h=intval(h),_=0;f=" "+d.charAt(_).toLowerCase(),curFastChat.clistCache[f]||(curFastChat.clistCache[f]={}),curFastChat.clistCache[f][h]=1,-1!==(_=d.indexOf(" ",_+1));)++_},clistShowMore:function(){if(curFastChat.clHasMore){var e=curFastChat.el.clist;e.scrollTop+3*e.clientHeight>e.scrollHeight&&FastChat.clistRender(!0)}},clistUpdateTitle:function(e){var t=0,n=0;for(var r in curFastChat.friends)curFastChat.onlines[intval(r)]?(n++,t++):curFastChat.clOnlines||t++;var a=window.newVal=(n?Object(u.getLang)("mail_im_X_onlines_title",n):Object(u.getLang)("mail_im_onlines_title")).toString();FastChat.updateFriends(n),val(curFastChat.el.clistTitle,a),val(curFastChat.el.topLink,a.toLowerCase()),curFastChat.clistBoxScroll&&(!curFastChat.clHasMore&&e?t=curFastChat.el.clist.childNodes.length:curFastChat.q&&(t=intval((curFastChat.clistCache[curFastChat.q]||{})._num)),curFastChat.clistBoxScroll.options.contHeight=50*t)},clistToggleOnlines:function(e){void 0===e&&(e=!curFastChat.clOnlines,FastChat.stateChange({op:"onlines_toggled",val:e?1:0})),toggleClass(curFastChat.el.clistOnline,"fc_clist_online_active",e),curFastChat.clOnlines=e},clistFilterKey:function(e){var t;switch(e.keyCode){case KEY.DOWN:case KEY.UP:if("keyup"!==e.type){var n;if(t=curFastChat.clSel&&ge("fc_contact"+curFastChat.clSel)){var r=e.keyCode===KEY.DOWN?"nextSibling":"previousSibling";n=t;do{n=n[r]}while(n&&(1!==n.nodeType||!hasClass(n,"fc_contact")))}else curFastChat.clSel||e.keyCode!==KEY.DOWN||(n=geByClass1("fc_contact",curFastChat.el.clist,"a"));if(n&&n!==t){FastChat.clistPeerOver(n,1);var a=curFastChat.el.clist;n.offsetTop+16>a.clientHeight+a.scrollTop?(a.scrollTop=n.offsetTop+16-a.clientHeight,curFastChat.clistBoxScroll.update()):n.offsetTop-36<a.scrollTop&&(a.scrollTop=n.offsetTop-36,curFastChat.clistBoxScroll.update())}}break;case KEY.LEFT:case KEY.RIGHT:return!0;case KEY.ENTER:if("keyup"==e.type||!(t=curFastChat.clSel&&ge("fc_contact"+curFastChat.clSel)))break;e.ctrlKey||e.metaKey&&browser.mac?nav.go(t.href.match(/\b(vkontakte\.ru|vk\.com)(\/[^\/]+?)$/)[2]):FastChat.selectPeer(curFastChat.clSel);case KEY.ESC:if("keyup"!=e.type){var i=ge("fc_clist_filter"),o=val(i)||curFastChat.clSel;i.blur(),val(i,curFastChat.q=""),curFastChat.clSel=!1,o&&FastChat.clistRender()}break;default:return}return cancelEvent(e)},prepareTabIcon:function(e,t,n){var r=curFastChat.friends&&curFastChat.friends[e+"_"];if(r){var a=w(r,e);FastChat.addTabIcon(e,a,n)}else{curFastChat.needPeers[e]=[3,!1,setTimeout(FastChat.getPeers,irand(150,200)),t]}},addTabIcon:function(e,t,n){if(Chat.itemsCont&&!Chat.tabs[e]){var r=e>2e9,a=r?t.data.members_grid_fc||"":`<img class="chat_tab_img" src="${t.photo}"/>`,i=r?"im?sel=c"+(e-2e9):t.alink||"/id"+e,o=onlinePlatformClass(t.online),s=se('<a class="chat_tab_wrap'+(n?"":" chat_tab_beforeanim")+'" id="chat_tab_icon_'+e+'" href="'+i+'" onclick="FastChat.itemsOut();return FastChat.togglePeer('+e+', event);"><div class="chat_tab_imgcont _chat_tab_image'+o+'"><div class="chat_tab_close" onclick="return FastChat.closeTabIcon('+e+', event)"></div>'+a+'</div><div class="chat_tab_typing_wrap"><div class="chats_sp chat_tab_typing_icon"></div></div><div class="chat_tab_counter"></div></a>');Chat.itemsCont.insertBefore(s,Chat.itemsCont.firstChild),Chat.tabs[e]={el:s,name:t.name},addClass(Chat.wrap,"chat_expand"),n||removeClass(s,"chat_tab_beforeanim"),FastChat.checkChatHeight(),Chat.scrollNode.scrollTop=0}},checkChatHeight:function(){var e=getSize(Chat.itemsCont)[1];function t(){addEvent(Chat.scrollNode,browserFeatures.wheelEvent,FastChat.scrollWrap)}function n(){removeEvent(Chat.scrollNode,browserFeatures.wheelEvent,FastChat.scrollWrap)}Chat.lastHeight=e,e>Chat.maxHeight?(Chat.fixH||(Chat.fixH=!0,addClass(Chat.scrollNode,"chat_fix_height"),setStyle(Chat.scrollNode,{height:Chat.maxHeight}),addEvent(Chat.scrollNode,"mouseenter",t),addEvent(Chat.scrollNode,"mouseleave",n),FastChat.checkShadow()),Chat.scrollNode.scrollTop=e-Chat.maxHeight):Chat.fixH&&(Chat.fixH=!1,removeClass(Chat.scrollNode,"chat_fix_height"),setStyle(Chat.scrollNode,{height:"auto"}),removeEvent(Chat.scrollNode,browserFeatures.wheelEvent,FastChat.scrollWrap),removeEvent(Chat.scrollNode,"mouseenter",t),removeEvent(Chat.scrollNode,"mouseleave",n),FastChat.checkShadow())},checkShadow:function(){var e=intval(Chat.scrollNode.scrollTop);e&&Chat.fixH?Chat.shadowTop||(addClass(Chat.wrap,"chat_scroll_top"),fadeIn(geByClass1("chat_cont_sh_top",Chat.wrap),200),Chat.shadowTop=!0):Chat.shadowTop&&(fadeOut(geByClass1("chat_cont_sh_top",Chat.wrap),200),Chat.shadowTop=!1),Chat.lastHeight-e>Chat.maxHeight&&Chat.fixH?Chat.shadowBottom||(fadeIn(geByClass1("chat_cont_sh_bottom",Chat.wrap),200),Chat.shadowBottom=!0):Chat.shadowBottom&&(fadeOut(geByClass1("chat_cont_sh_bottom",Chat.wrap),200),Chat.shadowBottom=!1)},scrollWrap:function(e){e||(e=window.event);var t=0;return e.wheelDeltaY||e.wheelDelta?t=(e.wheelDeltaY||e.wheelDelta)/2:e.detail&&(t=10*-e.detail),Chat.scrollNode.scrollTop-=t,curFastChat.activeBox==curFastChat.clistBox?(curFastChat.pointerMargin=0,FastChat.setPointer(!1,curFastChat.pointerMargin,curFastChat.prevPointer)):(curFastChat.pointerMargin=-Chat.scrollNode.scrollTop,FastChat.setPointer(!0,curFastChat.pointerMargin,curFastChat.prevPointer)),FastChat.checkShadow(),setStyle(Chat.ttNode,{top:-Chat.scrollNode.scrollTop}),cancelEvent(e)},togglePeer:function(e,t){return curFastChat.activeBox&&curFastChat.activeBox.options.peer==e?(curFastChat.activeBox.hide(),FastChat.setActive(!1),!1):FastChat.selectPeer(e,t,{entrypoint:"fastchat_icon"})},selectPeer:function(e,t,n){if(checkEvent(t))return!0;var r=hasClass(Chat.wrap,"chat_active");if(curFastChat.tabs&&curFastChat.tabs[e]){var a=curFastChat.tabs[e].box;a.minimized&&a.unminimize(!0),FastChat.activateTab(e),FastChat.movePointer(e,r)}else n||(n={}),n.fixed=!0,n.onPeerAdded=function(){FastChat.movePointer(e,r)},n.onHistoryLoaded=FastChat.readLastMessages.pbind(e),FastChat.addPeer(e,!1,!0,n);return curFastChat.tabs[e]&&curFastChat.tabs[e].iman&&(curFastChat.tabs[e].entrypoint=n&&n.entrypoint,curFastChat.tabs[e].iman.unidle()),FastChat.trackActivity("open"),!1},closeTabIcon:function(e,t,n){curFastChat.activeBox&&curFastChat.activeBox.options.peer==e&&!n&&(curFastChat.activeBox.hide(),FastChat.setActive(!1));var r=ge("chat_tab_icon_"+e);addClass(r,"chat_tab_hiding"),delete Chat.tabs[e],curFastChat.tabs[e]&&curFastChat.tabs[e].box.options.fixed&&(curFastChat.tabs[e].iman.stop(),delete curFastChat.tabs[e]);return animate(r,{height:0,opacity:0},{duration:100,onComplete:function(){re(r),r&&(r=!1,curFastChat.activeBox&&FastChat.movePointer(curFastChat.activeBox.options.peer,!0));var e=Chat.scrollNode.scrollTop;FastChat.checkChatHeight(),Chat.scrollNode.scrollTop=e}}),n||FastChat.stateChange({op:"closed",peer:e}),Object.keys(Chat.tabs).length||removeClass(Chat.wrap,"chat_expand"),FastChat.itemsOut(),cancelEvent(t)},getPointerShift:function(e,t,n){var r=n-t,a=Chat.maxHeight+32;return e&&r<62?r-62:e&&r>a?r-a:0},setPointer:function(e,t,n){if(!curFastChat.activeBox)return!1;var r=FastChat.getPointerShift(e,t,n),a=geByClass1("fc_tab_pointer",curFastChat.activeBox.wrap);return setStyle(a,{marginTop:t+r}),r},movePointer:function(e,t){if(!curFastChat.activeBox)return!1;var n,r,a=geByClass1("fc_pointer_offset",curFastChat.activeBox.wrap);if(e){var i,o=ge("chat_tab_icon_"+e);if(!o)return!1;i=!Chat.fixH&&o.nextSibling?getXY(o.nextSibling)[1]-50:o.nextSibling||Chat.fixH?getXY(o)[1]+Chat.scrollNode.scrollTop:getXY(ge("chat_tab_wrap"))[1]-50,n=23+getXY(Chat.cont)[1]-i,r=-Chat.scrollNode.scrollTop}else n=28,r=0;var s=FastChat.setPointer(e,r,n);if(t){if(curFastChat.prevPointer){var c=FastChat.getPointerShift(!0,r+s,curFastChat.prevPointer);setStyle(a,{bottom:curFastChat.prevPointer-c+s})}animate(a,{bottom:n},{duration:100})}else setStyle(a,{bottom:n});curFastChat.prevPointer=n},setActive:function(e){curFastChat.activeBox=e,e&&FastChat.moveBoxesLeft(e.pos[1])},moveBoxesLeft:function(e,t){e-=8;var n=!1,r=0;for(var a in curFastChat.tabs)if(curFastChat.tabs.hasOwnProperty(a)){var i=curFastChat.tabs[a];if(t||(i.box.movedLeft=!1),!i||i.box.options.fixed||!i.box.toBottom||i.box.movedLeft||i.box.noMove)continue;var o=i.box.pos;o[1]+o[3]>=e&&o[1]>r&&(n=i,r=o[1])}if(n){var s=e-n.box.pos[3],c=n.box.pos[0];s<0&&(s=0),n.box.movedLeft=!0,animate(n.box.wrap,{left:s},200),n.box.pos=[c,s,n.box.pos[2],n.box.pos[3]];var u=getWndInner();FastChat.stateChange({op:"moved",peer:n.box.options.peer,y:c/u[0],x:s/u[1]}),s&&FastChat.moveBoxesLeft(s,!0)}else FastChat.moveLeftY=0},moveBoxAway:function(e,t){for(var n=e.pos[3],r=t-e.pos[3]-20,a=e.pos[0],i=!1;r>0&&!i;)for(var o in i=!0,curFastChat.tabs)if(curFastChat.tabs.hasOwnProperty(o)){var s=curFastChat.tabs[o].box.pos;s[0]+s[2]/2>a&&s[1]+s[3]>r&&s[1]<r+n&&(r-=s[3],i=!1)}r<0&&(r=positive(Math.random()*t)),animate(e.wrap,{left:r},300);var c=getWndInner();FastChat.stateChange({op:"moved",peer:e.options.peer,y:a/c[0],x:r/c[1]})},pinTab:function(e,t,n){var r=-1==e?curFastChat.clistBox:curFastChat.tabs[e].box;r.options.fixed=!1,removeClass(r.wrap,"fc_fixed"),FastChat.hideChatCtrl(),FastChat.setActive(!1);var a=r.wrap.offsetTop,i=r.wrap.offsetLeft-10;setStyle(r.wrap,{left:r.wrap.offsetLeft,top:r.wrap.offsetTop,right:"auto",bottom:"auto"}),n||animate(r.wrap,{left:i,top:a},300),r.pos=[a,i,r.pos[2],r.pos[3]],r.toRight=!1,r.toBottom=!0,addClass(r.wrap,"fc_tobottom");var o=r.resizeableW.clientWidth-intval(getStyle(r.resizeableW,"paddingRight"))-intval(getStyle(r.resizeableW,"paddingLeft")),s=r.resizeableH.clientHeight-intval(getStyle(r.resizeableH,"paddingBottom"))-intval(getStyle(r.resizeableH,"paddingTop")),c=getWndInner();-1==e?FastChat.stateChange({op:"clist_toggled",val:1,y:r.toBottom?-1:r.pos[0]/c[0],x:r.toRight?-1:r.pos[1]/c[1]}):FastChat.stateChange({op:"unfixed",peer:e,y:r.toBottom?-1:r.pos[0]/c[0],x:r.toRight?-1:r.pos[1]/c[1],h:s/c[0],w:o/c[1]}),r.noMove=!0,FastChat.moveBoxesLeft(i),r.noMove=!1},addPeer:function(e,t,n,r){r||(r={});var a=curFastChat.friends&&curFastChat.friends[e+"_"],i=0;if(n?FastChat.stateChange({op:"added",peer:e,fixed:r.fixed}):curNotifier.idle_manager&&!curNotifier.idle_manager.is_idle&&t&&(n=!0),a){var o=w(a,e);FastChat.addTabIcon(e,o,r.noAnim),FastChat.addBox(e,o,r),t?(curFastChat.tabs[e].auto=1,FastChat.imFeed(e,t)):(r&&r.nofocus||FastChat.activateTab(e),curFastChat.onlines[e]||FastChat.tabNotify(e,"unavail"),i|=2)}else i=3;i&&(n?(curFastChat.needPeers[e]=[i,t,!1,r],FastChat.getPeers()):(curFastChat.needPeers[e]=[i,t,setTimeout(FastChat.getPeers,irand(150,200)),r],FastChat.lcSend("needPeer",{id:e,mask:i})))},getPeers(){var e=[],t={};Object.keys(curFastChat.needPeers||{}).forEach(n=>{var r=y(curFastChat.needPeers[n],3),a=r[0],i=r[2];e.push(n,a),i&&clearTimeout(i),t[n]=a}),e.length&&(FastChat.lcSend("fetchingPeers",t),FastChat.loadPeers(e.join(","),(function(e){FastChat.gotPeers(e),FastChat.lcSend("gotPeers",e)})))},gotPeers:function(e){T()||each(curFastChat.needPeers,(function(t){if(e[t]){e[t]<2e9&&(curFastChat.friends[t+"_"]=[e[t].name,e[t].photo,e[t].fname,e[t].hash,intval(e[t].sex)]);var n=this[1],r=this[3];2&this[0]&&void 0===e[t].history||(clearTimeout(this[2]),delete curFastChat.needPeers[t]),curFastChat.tabs[t]?FastChat.gotHistory(t,e[t].history):r.fixedLoad?FastChat.addTabIcon(t,e[t]):(FastChat.addTabIcon(t,e[t]),FastChat.addBox(t,e[t],r),n?(curFastChat.tabs[t].auto=1,FastChat.imFeed(t,n)):(2&this[0]&&FastChat.gotHistory(t,e[t].history),r&&r.nofocus||FastChat.activateTab(t))),r.onHistoryLoaded&&r.onHistoryLoaded()}}))},gotHistory:function(e,t){if(isArray(t)&&t.length&&t[0]){var n=curFastChat.tabs[e],r=t[0],a=t[1];n.offset=t[2],extend(n.msgs,a),each(a,(function(e,t){!t[0]&&t[1]&&n.unread++})),val(n.log,r),n.logWrap.scrollTop=n.logWrap.scrollHeight,setTimeout((function(){n.logWrap.scrollTop=n.logWrap.scrollHeight,n.scroll&&n.scroll.update(!1,!0)}),10)}},decHashCb:function(e){var t;t=e,curFastChat.decodedHashes[t]=function(e){for(var t=ge?"":"___",n=0;n<e.length;++n)t+=e.charAt(e.length-n-1);return geByClass?t:"___"}(t.substr(t.length-5)+t.substr(4,t.length-12))},decodehash:function(e){return curFastChat.decodedHashes||(curFastChat.decodedHashes={}),curFastChat.decodedHashes[e]||FastChat.decHashCb(e),curFastChat.decodedHashes[e]},loadPeers(e,t){ajax.post("al_im.php",{act:"a_get_fc_peers",peers:e},{onDone:t})},sendTyping:function(e){var t=intval(e),n=this.getTab(t),r=Date.now();t<=-2e9||!n||curFastChat.myTypingEvents[t]&&r-curFastChat.myTypingEvents[t]<5e3||(curFastChat.myTypingEvents[t]=r,ajax.post("al_im.php",{act:"a_activity",type:"typing",peer:t,hash:n.sendhash,from:"fc"}))},setTyping(e){var t=this.getTab(e.peerId),n=e.type===f.ADD_MESSAGE;if(t&&t.typing&&n){var r=t.typing.userIds.filter((t,n)=>t!==e.userId);0===r.length?delete t.typing:t.typing=Object.assign(t.typing,{userIds:r})}else t&&!n&&(e.ts=Date.now()/1e3,t.typing=Object.assign(e,{userIds:(e.userIds||[]).filter((e,t)=>e!==vk.id)}))},waitTyping(e){return Object(g.pause)(C.ACTIVITY_PERIOD+2).then(()=>{var t=this.getTab(e.peerId);t&&t.typing&&(Date.now()-1e3*t.typing.ts>=1e3*C.ACTIVITY_PERIOD&&delete t.typing)})},updateTypings(){var e=curFastChat.tabs||{};Object.keys(e).forEach(e=>{FastChat.updateTyping(e)})},updateTyping(e,t){var n=this.getTab(e),r=ge("fc_tab_typing"+e),a=geByClass1("_fc_tab_typing_progress",r),i=geByClass1("_fc_tab_typing_name",r);if(n.typing&&n.typing.userIds.length>0){var o=this.formatTyping(n.typing);val(i,o),show(a)}else val(i,""),hide(a);t?setStyle(r,"opacity",1):fadeTo(r,200,1)},formatTyping(e){var t=e.peerId,n=e.userIds,r=this.getTab(t),a=n[0],i=Object(v.isChatPeer)(t)?r.data.members[a]:r,o=e=>e.fname||e.name||"";if(1===n.length||!Object(v.isChatPeer)(t))return langSex(i.sex,Object(u.getLang)("mail_im_typing")).replace("{user}",o(i));var s=n[n.length-1],c=Object(v.isChatPeer)(t)?r.data.members[s]:r;return Object(u.getLang)("mail_im_multi_typing").replace("{users}",o(i)).replace("{last_user}",o(c))},markMessagesAsRead(e){var t=e.type,n=e.peerId,r=e.upToId,a=e.unread,i=this.getTab(n);i&&(t===f.READ_INBOUND&&(i.inUpTo=r),t===f.READ_OUTBOUND&&(i.outUpTo=r),i.unread=a,this.updateUnreadMessagesInTab(n,r,t===f.READ_OUTBOUND)),this.updateTabUnreadCounterElement(i||{unread:0},n)},updateUnreadMessagesInTab(e,t,n){var r=this.getTab(e),a=n?".fc_msgs_unread.fc_msgs_out":".fc_msgs_unread:not(.fc_msgs_out)";if(r&&r.log){var i=r.log.querySelectorAll(a);Array.prototype.forEach.call(i,e=>{+e.getAttribute("data-message-id")<=t&&e.classList.remove("fc_msgs_unread")})}},readLastMessages(e){var t=FastChat.getTab(e);if(e&&t){if(!t.markingRead&&t.unread){var n=[];for(var r in t.msgs)!t.msgs[r][0]&&t.msgs[r][1]&&n.push(r);n.length>0&&FastChat.markRead(e,n)}t.unread=0,FastChat.updateTabUnreadCounterElement(t,e)}},markRead:function(e,t){var n=this.getTab(e);n.markingRead=!0,ajax.post("al_im.php",{act:"a_mark_read",peer:e,ids:t,hash:n.sendhash,from:"fc"},{onDone:function(r){for(var a in n.markingRead=!1,t){if(t.hasOwnProperty(a))if("continue"===function(){var e=t[a],r=ge("fc_msg"+e),i=r&&r.parentNode;if(!r)return"continue";n.msgs[e]&&n.msgs[e][1]&&(n.msgs[e][1]=0,n.msgs[e][0]||n.unread--),removeClass(r,"fc_msg_unread"),hasClass(i.parentNode,"fc_msgs_unread")&&each(i.childNodes,(function(){if(!hasClass(this,"fc_msg_unread"))return removeClass(i.parentNode,"fc_msgs_unread"),!1}))}())continue}n.unread=0,FastChat.updateTabUnreadCounterElement(n,e)},onFail:function(){n.markingRead=!1}})},getMessageText(e,t){var n=e||"",r=Math.round(1e9*Math.random()).toString(16),a={},i=0;return n=(n=Object(_.replaceHyperLinks)(n,_.linksReplacer.bind(null,!1))).replace(/(<a.+?<\/a>)/gi,e=>{var t=`!link_${i}_${r}!`;return a[t]=e,i++,t}),n=Object(_.replaceMentions)(n),n=Object(_.replaceEmailLinks)(n),n=Object(_.replaceHashtags)(n,e=>`<a href="/im?sel=${t}&st=${encodeURIComponent(e)}">${e}</a>`),Object.keys(a).forEach(e=>{n=n.replace(e,a[e])}),n=Emoji.emojiToHTML(n,1)},getEditCont:function(e){return stManager.add([jsc("web/emoji.js")]),'<div class="emoji_cont _emoji_field_wrap">'+Emoji.tplSmile(Object(u.getLang)("mail_emoji_hint"))+'<div class="fc_editable dark" tabindex="0" contenteditable="true" placeholder="'+Object(u.getLang)("mail_chat_placeholder")+'"></div></div>'},getInputValue:function(e){return Emoji?Emoji.editableVal(e):""},onTxtResize:function(e){var t=curFastChat.tabs[e],n=geByClass1("fc_tab_txt",t.wrap),r=getSize(n)[1];if(r>40){var a=positive(r-40),i=intval(getSize(t.box.resizeableH)[1]);i+t.hDiff-a<40&&(a=i+t.hDiff-40),setStyle(t.box.resizeableH,{height:i+(t.hDiff||0)-a}),t.hDiff=a,FastChat.fixResized(t,t.wrap.clientWidth,!0)}else if(t.hDiff){var o=intval(getSize(t.box.resizeableH)[1]);setStyle(t.box.resizeableH,{height:o+t.hDiff}),t.hDiff=0,FastChat.fixResized(t,t.wrap.clientWidth,!0)}},initTab:function(e,t,n){var r=geByClass1("fc_editable",n),a=curFastChat.tabs[e]={name:t.name,fname:t.fname,photo:t.photo,link:t.alink||"/id"+e,hash:t.hash,sendhash:FastChat.decodehash(t.hash),sex:t.sex||0,data:t.data||{},online:t.online,msgs:{},msgscount:0,unread:0,box:!1,wrap:n,editable:1,txt:r,txtWrap:r.parentNode.parentNode,logWrap:geByClass1("fc_tab_log",n),log:geByClass1("fc_tab_log_msgs",n),notify:geByClass1("fc_tab_notify_wrap",n),title:geByClass1("fc_tab_title",n)},i=30;if(a.addMediaBtn=geByClass1("fc_tab_attach",n),a.editable)cur.t=a,a.emojiId=Emoji.init(a.txt,{controlsCont:geByClass1("fc_tab_txt_wrap",n),ttDiff:-46,ttShift:0,rPointer:!0,global:!0,noRce:!0,peer:e,isChat:!0,noCtrlSend:!0,ref:"fast_chat",onSend:FastChat.send.pbind(e),checkEditable:FastChat.checkEditable,onResize:function(){FastChat.onTxtResize(e)},addMediaBtn:a.addMediaBtn,onShow:function(){cssAnim(a.scroll.scrollbar,{opacity:0},{duration:400})},onHide:function(){cssAnim(a.scroll.scrollbar,{opacity:1},{duration:400})},onEsc:function(e){return a.box.hide(),cancelEvent(e)},onStickerSend:function(t,n){FastChat.send(e,t,n)}});else{autosizeSetup(a.txt,{minHeight:15,maxHeight:42}),a.txt.autosize.options.onResize=function(e){if(!a.box.minimized){var t=42==e?42:15;t!=e&&setStyle(a.txt,"height",t),t!=i&&(setStyle(a.logWrap,"height",a.logWrap.clientHeight-t+i),i=t,a.scroll&&a.scroll.update(!1,!0))}}}return a.imPeerMedias={},a.imSortedMedias={},a.previewEl=geByClass1("fc_tab_preview",n),stManager.add(["page.js","page.css",jsc("web/ui_media_selector.js"),"ui_media_selector.css"],(function(){var t=[["photo",Object(u.getLang)("profile_wall_photo")],["video",Object(u.getLang)("profile_wall_video")],["audio",Object(u.getLang)("profile_wall_audio")],["doc",Object(u.getLang)("profile_wall_doc")],["map",Object(u.getLang)("profile_wall_map")]];a.imMedia=new MediaSelector(a.addMediaBtn,a.previewEl,t,{limit:10,hideAfterCount:0,maxShown:0,mail:1,tooltip:1,topOffset:0,forceUp:1,global:1,toId:vk.id}),a.imMedia.onChange=setTimeout.pbind((function(){if(curFastChat.sendOnUpload)FastChat.send(curFastChat.sendOnUpload),curFastChat.sendOnUpload=void 0;else{var t=Object(d.loadDraftForPeer)(curFastChat.ldb,e);t.removeAllAttaches(),a.imMedia.getMedias().forEach(e=>t.addAttach(e[0],e[1])),t.destroy()}FastChat.onTxtResize(e)}),0)})),a},addBox:function(e,t,n){if(void 0===curFastChat.tabs[e]){var i=FastChat.getEditCont(Emoji.last);n=n||{},curFastChat.tabs[e]={};var o=se(rs(FastChat.tplBox,{id:e,name:t.name,myphoto:Notifier.fixPhoto(curFastChat.me.photo,!0),cont:i}));n.fixed&&curFastChat.activeBox&&curFastChat.activeBox.hide(0,!1,{noState:!0});var s=FastChat.initTab(e,t,o),c=getWndInner(),u={id:"fc_peer"+e,marginFixedToLayer:!0,peer:e,movable:geByClass1("fc_tab_head",o),closer:geByClass1("fc_tab_close_wrap",o,"a"),resizeableH:s.logWrap,startHeight:250,startWidth:270,fixed:n.fixed,minH:150,minW:270,nofocus:!0,onFocus:function(t){s.auto&&(FastChat.stateChange({op:"added",peer:e}),delete s.auto),FastChat.restoreDraft(e),s.editable?Emoji.editableFocus(s.txt,!1,!0):elfocus(s.txt),s.wrap.clientWidth&&setStyle(s.title,{maxWidth:s.wrap.clientWidth-71}),s.editable||setStyle(s.txt.autosize.helper,{width:getStyle(s.txt,"width",!1)}),s.scroll&&s.scroll.update(!1,!0),setTimeout(elfocus.pbind(s.txt),10)},onHide:function(){n.fixed&&FastChat.hideChatCtrl(),curFastChat.activeBox&&e==curFastChat.activeBox.options.peer&&FastChat.setActive(!1)},onClose:function(t){AudioMessagePlayer.loaded&&AudioMessagePlayer.detachPlayer(),this.onHide(),n&&n.beforeClose&&n.beforeClose();var r=curFastChat.tabs,a=r[e].posSeq;if(delete r[e],curNotifier.isIdle||FastChat.stateChange({op:"hidden",peer:e}),a){var i,o,s,c,u,l={},d=[];for(each(r,(function(){this.posSeq>a&&(l[this.posSeq]=this,d.push(this.posSeq))})),d.unshift(a),d.sort(),u=!browser.msie&&d.length<10,i=1;i<d.length;i++)o=d[i],s=l[o].box,c=i>1?l[d[i-1]].box.pos:t,u?animate(s.wrap,{left:c[1]},100,function(e){e._update_pos()}.pbind(s)):setStyle(s.wrap,{left:c[1]});if(!u)for(i=1;i<d.length;i++)(s=l[d[i]].box)._update_pos()}},onMinimize:function(t){FastChat.stateChange({op:"minimized",peer:e,val:t}),FastChat.fixResized(s,s.wrap.clientWidth,!0),t||(s.txt.blur(),FastChat.restoreDraft(e))},onResizeEnd:function(t,n){var r=getWndInner(),a=s.box.pos;s.scroll&&s.scroll.show(),FastChat.fixResized(s,n,!0),FastChat.stateChange({op:"resized",peer:e,h:t/r[0],w:n/r[1],y:s.box.toBottom?-1:a[0]/r[0],x:s.box.toRight?-1:a[1]/r[1]})},onResize:function(e,t){FastChat.fixResized(s,t);var n=geByClass1("fc_tab_title",s.box.content);setStyle(n,{width:t-78})},onResizeStart:function(){delete s.posSeq,s.scroll&&s.scroll.hide(),val(s.notify,""),clearTimeout(s.hideNotifyTO)},onDragEnd:function(t,n){delete s.posSeq,FastChat.stateChange({op:"moved",peer:e,y:t,x:n})}};if(n&&extend(u,n),void 0===u.startLeft&&void 0===u.startRight){var l=[],d=c[0]-350,_=curFastChat.clistBox.pos,f=!1;if(window.Call&&(Call.box||Call.invitation)){var h=Call.calcBoxPos();l.push([h.x,h.x+h.w]),f=!0}_[0]+_[2]>d&&(curFastChat.clistBox.visible||!f)&&l.push([_[1],_[1]+_[3]]),each(curFastChat.tabs,(function(t){(_=this.box&&this.box.pos)&&t!=e&&_[0]+_[2]>d&&l.push([_[1],_[1]+_[3]])}));var p,g,m,b=lastWindowWidth-262-Object(r.sbWidth)(),v=!1,C=!1,E=0>b?1:-1;for(p=b;E*p<0*E;p+=135*E){for(g=0,m=0;m<l.length;m++)p>l[m][0]-260&&p<l[m][1]&&g++,p>l[m][0]-10&&p<l[m][0]+10&&(g+=1.1);(!1===v||g<C)&&(v=p,C=g)}f&&C&&(v=b),extend(u,{startBottom:0,startLeft:v})}var y,O=!0;for(y in n||{})if("nofocus"!=y){O=!1;break}O&&(s.posSeq=++curFastChat.posSeq),u.fixed&&(u.startHeight=curFastChat.clistH,u.startWidth=curFastChat.clistW,u.onShow=FastChat.showChatCtrl),s.box=new RBox(o,u),s.iman=new a.default({id:"tab"+e,element:s.box.content,onUnIdleCb:function(){FastChat.readLastMessages(e)},parentManager:curNotifier.idle_manager,idleTimeout:1e4}),curFastChat.tabs[e].iman.start(),u.fixed&&FastChat.setActive(s.box),s.scroll=new Scrollbar(s.logWrap,{prefix:"fc_",nomargin:!0,nokeys:!0,global:!0,right:vk.rtl?"auto":1,left:vk.rtl?1:"auto",onScroll:FastChat.onScroll.pbind(s)}),u.minimized||!n||void 0===n.startLeft&&void 0===n.startTop&&void 0===n.startWidth&&void 0===n.startHeight||s.box._wnd_resize(c[0],c[1],!0),s.wrap.clientWidth&&setStyle(s.title,{maxWidth:s.wrap.clientWidth-71}),addEvent(s.txt,"keydown",this.onInputKeydown.bind(this,s)),addEvent(s.txt,"keyup",this.onInputKeyUp.bind(this,s,e)),addEvent(s.txt,"focus",this.onInputFocus.bind(this,e)),addEvent(s.log,"click",t=>this.onLogClick(t,+e)),FastChat.restoreDraft(e),u.onPeerAdded&&u.onPeerAdded()}},onInputFocus(e){curFastChat.peer=e},onInputKeydown(e,t){if(t.ctrlKey&&t.keyCode===KEY.RETURN){var n=t.target,r=n.value;if("number"==typeof n.selectionStart&&"number"==typeof n.selectionEnd){var a=n.selectionStart;n.value=r.slice(0,a)+"\n"+r.slice(n.selectionEnd),n.selectionStart=n.selectionEnd=a+1}else if(document.selection&&document.selection.createRange){n.focus(t);var i=document.selection.createRange();i.text="\r\n",i.collapse(!1),browser.opera&&(i.moveEnd("character",0),i.moveStart("character",0)),i.select()}e.editable?this.checkEditable(e.emojiId,e.txt):(e.txt.autosize.update(),setTimeout(()=>e.txt.autosize.update(),0))}},onInputKeyUp(e,t){var n=e.lastValue||"",r=this.getInputValue(e.txt);r.length===n.length&&r===n||(r&&this.sendTyping(t),e.lastValue=r),clearTimeout(e.saveDraftTO),e.saveDraftTO=setTimeout(this.saveDraft.pbind(t),r.length?300:0),this.checkEditable(e.emojiId,e.txt)},onLogClick:function(e,t){if(e.target.classList.contains("_fc_call_link")){var n=this.getTab(t);if(Object(v.isChatPeer)(t)){var r={peerId:t,name:n.name,tab:n.name,photo:n.photo};window.Calls.startGroupCall(t,[r],[],!1,"fast_chat").then(()=>this.closeTab(t))}else{var a={peerId:t,id:t,link:n.link,name:n.name,firstName:n.fname,lastName:n.name.split(" ")[1],sex:n.sex,photo:n.photo},i=E({},a,{canAddMembers:!0});window.Calls.call(t,!1,[i,[a]],"fast_chat").then(()=>this.closeTab(t))}}},onScroll:function(e){var t=e.scroll.obj.scrollTop,n=geByClass1("_fc_msgs_more",e.logWrap);t<200&&isVisible(n)&&n.click()},loadMore:function(e,t){var n=curFastChat.tabs[e],a=n.offset;if(n.moreLoading)return!1;n.moreLoading=!0,ajax.post("al_im.php",{act:"a_history",peer:e,offset:a,from:"fc"},{onDone:function(e){e[3]||hide(t);var r=t.parentNode,a=r.clientHeight;r.insertBefore(cf(e[0]),t.nextSibling);var i=r.clientHeight-a;i&&(n.logWrap.scrollTop+=i),n.scroll.update(),n.offset=e[2],n.moreLoading=!1,FastChat.onScroll(n)},onFail:function(){n.moreLoading=!1},showProgress:r.lockButton.pbind(t),hideProgress:r.unlockButton.pbind(t)})},sendOnResponse:function(e,t,n){if(e.version&&intval(e.version)>curFastChat.version)FastChat.updateVersion(e.version);else{var r=ge("fc_msg"+t),a=e.msg_id,i=indexOf(t,n.newmsgs);if(r){if(e.media){var o={sticker:intval(e.sticker)};FastChat.lcSend("gotMedia",{msgId:t,peer:n.box.options.peer,text:e.media,msgOpts:o}),FastChat.gotMsgMedia(n.box.options.peer,t,e.media,o)}++n.msgscount,-1!=i&&n.newmsgs.splice(i,1),r.id="fc_msg"+a,n.msgs[a]=[1,1]}}},checkEditable:function(e,t){Emoji.checkEditable(e,t,{height:52})},fixResized:function(e,t,n){e&&(e.logWrap.scrollTop=e.logWrap.scrollHeight,t>0&&setStyle(e.title,{maxWidth:t-71}),n&&(e.editable||setStyle(e.txt.autosize.helper,{width:getStyle(e.txt,"width",!1)}),e.scroll&&e.scroll.update(!1,!0)))},activateTab:function(e){var t=curFastChat.tabs[e].box;curFastChat.activeBox&&curFastChat.activeBox!=t&&curFastChat.activeBox.hide(0,!1,{noState:!0}),t.show(),t.options.fixed&&FastChat.setActive(t)},blinkTab:function(e){var t=this.getTab(e);if(!t.blinking&&curFastChat.peer!=e){t.blinking=!0,clearTimeout(t.blinkingTO);var n=t.box.wrap,r=n.className,a=Math.min(1e4,intval(getStyle(n,"zIndex")));setStyle(n,{zIndex:1e4}),removeClass(n,"rb_inactive"),t.blinkingTO=setTimeout((function(){delete t.blinking,delete t.blinkingTO,1e4==getStyle(n,"zIndex")&&(setStyle(n,{zIndex:a}),n.className=r)}),2e3)}},createProgress:function(e,t,n){var r=ce("span",{innerHTML:rs(vk.pr_tpl,{id:"",cls:""}),className:"fc_msg_progress",id:"fc_msg_progress"+t});return e.insertBefore(r,n),r},removeProgress:function(e){re("fc_msg_progress"+e)},send:function(e,t,n){var r=curFastChat.tabs[e],a=trim(r.editable?Emoji.editableVal(r.txt):val(r.txt)),i="";t?(i=[["sticker",t]],a=""):i=r.imMedia?r.imMedia.getMedias():[];var o=ge("fc_tab_typing"+e),s=geByClass1("page_progress_preview",r.wrap);if(s&&s.childNodes.length>0){curFastChat.sendOnUpload=e;var c=geByClass("fc_tab_log",r.wrap)[0];return FastChat.createProgress(c,e,c.lastChild),void(o.style.visibility="hidden")}if(curFastChat.sendOnUpload=!1,FastChat.removeProgress(e),o.style.visibility="visible",a||i.length){var l=Object(h.random)(),d={act:"a_send",to:e,hash:r.sendhash,msg:a,from:"fc",entrypoint:curFastChat.tabs[e].entrypoint,media:[],random_id:l};n&&(d.sticker_referrer=n);for(var _,f=0,p=i.length;f<p;++f)(_=i[f])&&d.media.push(_[0]+":"+_[1]);d.media=d.media.join(","),r.sending=!0,Emoji.ttHide(r.emojiId),curFastChat.tabs[e].entrypoint=!1,ajax.post("al_im.php",d,{onDone:function(t){clearTimeout(r.saveDraftTO),FastChat.saveDraft(e),FastChat.sendOnResponse(t,l,r)},onFail:function(t){FastChat.error(e,t||Object(u.getLang)("global_unknown_error")),elfocus(r.txt),val(r.txt,clean(a)),r.editable?FastChat.checkEditable(r.emojiId,r.txt):r.txt.autosize.update();var n=ge("fc_msg"+l);if(n)return n.appendChild(ce("span",{className:"fc_msg_error",innerHTML:Object(u.getLang)("global_error")})),FastChat.scroll(e),!0},showProgress:function(){r.sending=!0,r.sendProgressTO=setTimeout((function(){var e=ge("fc_msg"+l);e&&FastChat.createProgress(e,l,e.firstChild)}),2e3)},hideProgress:function(){r.sending=!1,clearTimeout(r.sendProgressTO),FastChat.removeProgress(l)}}),re("fc_error"+e),t||(val(r.txt,""),r.imMedia&&r.imMedia.unchooseMedia()),FastChat.addMessage(FastChat.prepareMessageData({messageId:l,text:clean(a).replace(/\n/g,"<br>"),peerId:e,flags:3,randomId:d.random_id,attaches:[]})),delete curFastChat.myTypingEvents[e],r.editable?FastChat.checkEditable(r.emojiId,r.txt):r.txt.autosize.update(!1,!0),elfocus(r.txt),FastChat.scroll(e),FastChat.trackActivity("send")}else r.editable?Emoji.editableFocus(r.txt,!1,!0):elfocus(r.txt)},saveDraft:function(e){var t=curFastChat.tabs[e],n=(t||{}).txt;if(n&&t){var r=Emoji.editableVal(n),a=Object(d.loadDraftForPeer)(curFastChat.ldb,e);a.setText(trim(r)||""),a.destroy()}},restoreDraft:function(e){var t=curFastChat.tabs[e],n=t.txt,r=Object(d.loadDraftForPeer)(curFastChat.ldb,e);return!(!n||!t||val(n).length>r.dData.txt.length&&!r.hasAttaches())&&(t.editable?n.innerHTML=Emoji.emojiToHTML(clean(r.dData.txt),1):val(n,clean(r.dData.txt)),setTimeout(()=>{for(var e=r.dData.attaches,n=0;n<e.length;n++)t.imMedia&&t.imMedia.chooseMedia(e[n].type,e[n].id,e[n].object||{});r.destroy()},40),FastChat.checkEditable(t.emojiId,n),setTimeout((function(){n.scrollTop=n.scrollHeight}),10),!0)},error:function(e,t){e=e||curFastChat.peer;var n=curFastChat.tabs[e];re("fc_error"+e),n.log.appendChild(ce("div",{id:"fc_error"+e,className:"fc_msgs_error",innerHTML:t||Object(u.getLang)("global_error")})),FastChat.scroll(e)},scroll:function(e){e=e||curFastChat.peer;var t=curFastChat.tabs[e];t&&(t.logWrap.scrollTop=t.logWrap.scrollHeight,t.scroll&&t.scroll.update(!1,!0))},mkdate:function(e){var t=new Date(1e3*e),n=new Date,r=function(e){return(e+"").length<2?"0"+e:e};if(t.getDay()==n.getDay())return r(t.getHours())+":"+r(t.getMinutes());var a=r(t.getDate())+"."+r(t.getMonth()+1);return t.getFullYear()!=n.getFullYear()&&(a+="."+(t.getFullYear()+"").substr(2)),a},prepareMessageData(e){var t=e.peerId,n=e.flags,r=e.messageId,a=e.text,i=e.date,o=Object(b.getUserId)(e),s=y(this.getMessageMedia(e),2),c=s[0],l=s[1],d="",_=e.randomId;(Object(b.isServiceMsg)(e)||Object(b.isCallMessage)(e))&&(d=this.renderServiceMessage(e));var f=Object(b.isServiceMsg)(e)||Object(b.isCallMessage)(e)?d:Object(b.isExpiredCasperMessage)(e)?Object(u.getLang)("mail_expired_message"):this.getMessageText(a,t)+c;return-1!==String(r).indexOf("rid")&&(_=Number(r.slice(3))),Object.assign({id:r,peer:t,from_id:o,text:f,out:Object(b.isOut)(e),unread:Boolean(1&n),date:i,date_str:FastChat.mkdate(i),randomId:_,isServiceMessage:Object(b.isServiceMsg)(e)||Object(b.isCallMessage)(e)},this.getMessageAuthor(e),l)},getMessageAuthor(e){var t=e.peerId,n=Object(b.getUserId)(e),r=this.getTab(e.peerId);if(!r||!n)return{};var a=Object(b.isOut)(e)?curFastChat.me:Object(v.isChatPeer)(t)?r.data.members[n]:r,i=a.name,o=a.link,s=a.photo,c=a.fname,u=a.first_name;return{fname:Object(v.isChatPeer)(t)?c||u:"",from_id:n,name:i,link:o,photo:s}},getMessageMedia(e){var t=e.peerId,n=e.messageId;if(Object(b.isServiceMsg)(e)||Object(b.isCallMessage)(e)||!Array.isArray(e.attaches))return["",{}];var r="",a={};return e.attaches.forEach(e=>{switch(e.type){case"sticker":r+=n?this.renderSticker(e.id,e.productId,e.kind,n):this.renderSticker(e.id,e.productId),a.sticker=!0;break;case"mail":var i=e.object?e.object.fwd_count:e.id.split(";").length;r+=rs(curFastChat.tpl.msg_fwd,{msg_id:n,peerId_nice:Object(v.convertPeerToUrl)(t),label:Object(u.getLang)(i>1?"mail_im_fwd_msgs":"mail_im_fwd_msg")});break;default:r+=rs(vk.pr_tpl,{id:"",cls:""}),n>0&&setTimeout(FastChat.needMsgMedia.pbind(t,n),5)}}),r&&(r=`<div class="fc_msg_attachments" id="fc_msg_attachments${n}">${r}</div>`),[r,a]},renderSticker(e,t,n,r){var a,i=window.devicePixelRatio>=2?"256":"128";return"animation"===n?(a=rs(curFastChat.tpl.animatedSticker,{id:e,size:i,productId:t,messageId:r}),Number.isInteger(r)&&this.loadStickersModuleIfNeed().then(()=>{window.StickersSettings.getAutoplay()&&window.StickersAnimation&&window.StickersAnimation.loadAndPlayStickerWithTimer("animatedSticker"+r,10)})):a=rs(curFastChat.tpl.sticker,{id:e,size:i}),a},loadStickersModuleIfNeed:()=>new Promise(e=>{var t=Boolean(window.StickersSettings&&window.StickersAnimation);curFastChat.stickersLoading||t?e():(curFastChat.stickersLoading=!0,stManager.add([jsc("web/stickers.js")],()=>{curFastChat.stickersLoading=!1,e()}))}),renderServiceMessage(e){if(Object(b.isCallMessage)(e))return this.renderCallMessage(e);var t=e.kludges,n=e.peerId,r=t.source_act,a=Number(t.source_mid),i=intval(Object(v.isChatPeer)(e.peerId)?t.from:e.userId),o=this.getMember(n,i),s="",c=i===a;switch(r){case v.CREATE_CHAT_ACTION:s="mail_im_chat_created";break;case v.CHAT_TITLE_ACTION:s=t.source_is_channel?"mail_im_title_updated_channel":"mail_im_title_updated_dot";break;case v.CHAT_INVITE_USER:s=c?"mail_im_returned_to_chat":"mail_im_invited";break;case v.CHAT_KICK_USER:s=c?"mail_im_left":"mail_im_kicked_from_chat";break;case v.CHAT_PHOTO_UPDATE:s="mail_im_photo_set";break;case v.CHAT_PHOTO_REMOVE:s=t.source_is_channel?"mail_im_photo_removed_channel":"mail_im_photo_removed";break;case v.CHAT_PIN_MESSAGE:s=t.source_message?"mail_im_pin_message":"mail_im_pin_message_empty2";break;case v.CHAT_UNPIN_MESSAGE:s=t.source_message?"mail_im_unpin_message":"mail_im_unpin_message_empty2";break;case v.CHAT_INVITE_BY_LINK:s="mail_im_invite_by_link";break;case v.CHAT_SCREENSHOT:s=vk.id===a?"mail_im_chat_own_screenshot":"mail_im_chat_screenshot";break;case v.CHAT_GROUP_CALL_STARTED:s="mail_im_group_call_started";break;default:return"mail_no_support"}if(s=(s=langSex(o.sex,Object(u.getLang)(s,"raw"))).replace("{from}",Object(v.serviceLink)(o.link,o.name,!0)),a&&a!==i){var l=t.source_email;if(l)s=s.replace("{user}",Object(v.serviceLink)("/im?email="+encodeURIComponent(l),"email",!0));else{var d=this.getMember(n,a)||{name_inv_case:"",name_kick_case:"",link:""},_=r===v.CHAT_KICK_USER?d.name_kick_case:d.name_inv_case;s=s.replace("{user}",Object(v.serviceLink)(d.link,_,!0))}}if(t.source_text){var f=t.source_old_text?`«<b class="im_srv_lnk">${t.source_old_text}</b>» &rarr; `:"";s=s.replace("{title}",f+`«<b class="im_srv_lnk">${t.source_text}</b>»`)}if(t.source_act===v.CHAT_PIN_MESSAGE||t.source_act===v.CHAT_UNPIN_MESSAGE)if(t.source_message){var h=Object(v.replaceSpecialSymbols)(Emoji.emojiToHTML(stripHTML(t.source_message.replace(/<br\s?\/?>/gi," ")),!0)),p=Object(v.serviceLink)("",h,!1,"im_srv_mess_link");s=s.replace("{msg}",p)}else s=s.replace(/{link}(.+){\/link}/i,(e,t)=>Object(v.serviceLink)("",t,!1,"im_srv_mess_link"));return s},renderCallMessage(e){var t,n=vk.id,r=e.attaches[0],a=r.initiatorId,i=r.state,o=r.receiverId,s=n===a;switch(i){case"reached":var c=Object(v.secondsToHuman)(r.duration);t=(t=s?Object(u.getLang)("mail_call_outgoing"):Object(u.getLang)("mail_call_incoming")).replace("{duration}",c);break;case"canceled_by_initiator":t=s?Object(u.getLang)("mail_call_canceled"):Object(u.getLang)("mail_call_missed");break;case"canceled_by_receiver":if(s){var l=w(curFastChat.friends[o+"_"],o);t=l?langSex(l.sex,Object(u.getLang)("mail_call_declined_by","raw")).replace("{user_name}",l.name):Object(u.getLang)("mail_call_declined")}else t=Object(u.getLang)("mail_call_canceled");break;default:t=Object(u.getLang)("mail_added_call")}return getTemplate("im_calls_link",{text:t,peerId:e.peerId})},getMember(e,t){var n=this.getTab(e);return Object(v.isChatPeer)(e)&&n?n.data.members[t]:n||null},needMsgMedia:function(e,t){t<=0||(FastChat.lcSend("needMedia",{msgId:t}),curFastChat.needMedia[t]=[e,setTimeout(FastChat.loadMsgMedia.pbind(e,t),curNotifier.is_server?0:irand(150,250))])},loadMsgMedia:function(e,t){t<=0||void 0!==curFastChat.gotMedia[t]&&0!==curFastChat.gotMedia[t]||(FastChat.lcSend("fetchingMedia",{msgId:t}),curFastChat.gotMedia[t]=0,ajax.post("al_im.php",{act:"a_get_media",id:t,from:"fc"},{onDone:function(n){var r=y(n,4),a=(r[0],r[1]),i=(r[2],r[3]);FastChat.lcSend("gotMedia",{msgId:t,peer:e,text:a,msgOpts:i}),FastChat.gotMsgMedia(e,t,a,i)}}))},gotMsgMedia:function(e,t,n,r){if(val("fc_msg_attachments"+t,n),r&&r.sticker){var a=ge("fc_msg"+t),i=a&&a.parentNode;a&&addClass(i.parentNode,"fc_msg_sticker"),window.StickersAnimation&&window.StickersAnimation.checkSettingsAndLoadInWeb(t,!1,!1,!0)}FastChat.scroll(e),curFastChat.gotMedia[t]=[e,n,r],r&&r.stickers&&window.Emoji&&Emoji.updateTabs(r.stickers,r.keywords),void 0!==curFastChat.needMedia[t]&&(clearTimeout(curFastChat.needMedia[t][1]),delete curFastChat.needMedia[t])},replaceSpecialSymbols:function(e){return e.replace(/&lt;&lt;/g,"&laquo;").replace(/&gt;&gt;/g,"&raquo;").replace(/ \-\-/g," &mdash;").replace(/\-\- /g,"&mdash; ").replace(/(^|[\s.,:\'\";>\)\(])(\*|@)([A-Za-z0-9_\.]{2,32})\s*\((.+?)\)/g,"$1$4")},addMessage:function(e){var t,n=e.peer,r=this.getTab(n),a=r.log;if(!r||e.out||!r.box.visible||r.iman.is_idle||curNotifier.idle_manager.is_idle||(e.unread=!1,FastChat.markRead(e.peer,[e.id])),e.randomId&&re(document.querySelector(`[data-random-id="${e.randomId}"]`)),r.msgs[e.id]=[e.out,e.unread],this.isNewStack(e)){re("fc_log_empty"+n);var i=(e.out?"fc_msgs_out ":"")+(e.unread?"fc_msgs_unread":"");e.sticker&&(i+=" fc_msg_sticker");var o=e.isServiceMessage?curFastChat.tpl.msgs_service:e.out?curFastChat.tpl.msgs_out:curFastChat.tpl.msgs;t=se(rs(o,{from_id:e.from_id,link:e.link,photo:Notifier.fixPhoto(e.photo),name:e.from_id==curFastChat.me.id?Object(u.getLang)("mail_im_thats_u"):stripHTML(e.name),classname:i,date:e.date,date_str:e.date_str,msgs:"",randomId:e.randomId||0,messageId:e.id})),a.appendChild(t)}else e.unread||removeClass(t,"fc_msgs_unread");var s=geByClass1("fc_msgs_list",t,"div"),c=geByClass1("fc_msgs_date",s),l=geByClass1("fc_msg_last",s);l&&removeClass(l,"fc_msg_last");var d=FastChat.replaceSpecialSymbols(e.text),_=se(rs(curFastChat.tpl.msg,{msg_id:e.id,classname:(e.unread?"fc_msg_unread":"")+" fc_msg_last",text:e.isServiceMessage?`<div class="fc_srv_msg">${d}</div>`:d}));domFC(s)&&"BR"===domFC(s).tagName&&re(domFC(s)),c?s.insertBefore(_,c):s.appendChild(_),vk.id!=e.from_id&&(delete curFastChat.typingEvents[n],FastChat.updateTyping(n,1)),r.scroll&&r.scroll.update()},getTab:e=>curFastChat.tabs[e],isTabLoaded(e){return Boolean(curFastChat.tabs&&this.getTab(e))},isNewStack(e){var t=this.getTab(e.peer).log.lastChild;return t&&"fc_msgs_error"==t.className&&(t=t.previousSibling),!t||(!hasClass(t,"fc_msgs_wrap")||(!hasClass(t,"fc_msgs_unread")&&!0===e.unread||(t.getAttribute("data-from")!==e.from_id||(e.date-intval(t.getAttribute("data-date"))>=300||!(!e.sticker&&!hasClass(t,"fc_msg_sticker"))))))},editMessage(e){var t=e.id,n=ge("fc_msg"+t);if(n){var r=se(rs(curFastChat.tpl.msg,{msg_id:t,classname:n.getAttribute("class"),text:FastChat.replaceSpecialSymbols(e.text)}));n.parentNode.replaceChild(r,n)}},deleteMessage(e){var t=e.id,n=ge("fc_msg"+t);if(n){var r=!domNS(n)&&!domPS(n),a=domClosest("fc_tab_log_msgs",n);for(re(r?domClosest("fc_msgs_wrap",n):n);hasClass(domLC(a),"fc_msgs_date");)re(domLC(a))}},updateTabUnreadCounter(e,t){if(!e){var n=document.querySelector("#chat_tab_icon_"+t.peerId),r=n&&n.querySelector(".chat_tab_counter");e={unread:r&&Math.max(+r.innerHTML,0)||0}}Object(b.isOut)(t)?e.unread=0:e.unread++,this.updateTabUnreadCounterElement(e,t.peerId)},updateTabUnreadCounterElement(e,t){if(e){var n=document.querySelector("#chat_tab_icon_"+t),r=n&&n.querySelector(".chat_tab_counter");r&&(r.innerHTML=e.unread>0?e.unread:""),e.title&&e.name&&(val(e.title,e.name+(e.unread?' <span class="fc_tab_count">('+e.unread+")</span>":"")),val("fc_contact_unread"+t,e.unread?" <b>+"+e.unread+"</b>":""))}},showMsgFwd:function(e){return!showBox("al_im.php",{act:"a_show_forward_box",id:vk.id+"_"+e,from:"mail"},{stat:["im.css"],dark:1,params:{onHide:function(){AudioMessagePlayer.loaded&&AudioMessagePlayer.detachPlayer(!0)}}})},closeTab:function(e){curFastChat.tabs[e].box.close()},trackActivity(e){Object(m.statlogsValueEvent)("im_fastchat_location",e,window.cur.module)},toggleFastChats(e){var t=!e;toggleClass(ge("chat_onl_wrap"),"fast_chats_toggle_hide",t),toggleClass(ge("rb_box_fc_clist"),"fast_chats_toggle_hide",t),each(geByClass("rb_box_wrap"),()=>toggleClass(this,"fast_chats_toggle_hide",t))},tplBox:'<div class="fc_tab_wrap"><div class="fc_tab_head clear_fix"><a class="fc_tab_close_wrap"><div class="chats_sp fc_tab_close"></div></a><a class="fc_tab_max_wrap" href="/im?sel=%id%" onmousedown="event.cancelBubble = true;" onclick="return nav.go(this, event);"><div class="chats_sp fc_tab_max"></div></a><a class="fc_tab_pin_wrap" onmousedown="event.cancelBubble = true;" onclick="return FastChat.pinTab(%id%, event);"><div class="chats_sp fc_tab_pin"></div></a><div class="fc_tab_title noselect">%name%</div></div><div class="fc_tab"><div class="fc_tab_log_wrap"><div class="fc_tab_notify_wrap"></div><div class="fc_tab_log"><div class="fc_tab_log_msgs"></div><div class="fc_tab_typing" id="fc_tab_typing%id%"><div class="pr fc_tab_typing_icon _fc_tab_typing_progress" id=""><div class="pr_bt"></div><div class="pr_bt"></div><div class="pr_bt"></div></div><div class="fc_tab_typing_name _fc_tab_typing_name"></div></div></div></div><div class="fc_tab_txt_wrap"><a class="fc_tab_attach"></a><div class="fc_tab_txt">%cont%<div class="fc_tab_preview"></div></div></div></div><div class="fc_pointer_offset"><div class="fc_tab_pointer fc_tab_pointer_peer"></div></div></div>',tplTab:'<div class="fc_tab_log_wrap"><div class="fc_tab_notify_wrap"></div><div class="fc_tab_log"><div class="fc_tab_log_msgs"></div><div class="fc_tab_typing" id="fc_tab_typing%id%"><div class="pr fc_tab_typing_icon _fc_tab_typing_progress" id=""><div class="pr_bt"></div><div class="pr_bt"></div><div class="pr_bt"></div></div><div class="fc_tab_typing_name _fc_tab_typing_name"></div></div></div></div><div class="fc_tab_txt_wrap"><div class="fc_tab_txt">%cont%</div></div>'},window.DesktopNotifications={supported:function(){return!(!window.webkitNotifications&&!window.Notification)},checkPermission:function(){return window.webkitNotifications?webkitNotifications.checkPermission():"granted"==Notification.permission?0:1},requestPermission:function(e){(window.webkitNotifications||window.Notification).requestPermission(e)},createNotification:function(e,t,n){var r;return window.webkitNotifications?r=webkitNotifications.createNotification(e,t,n):((r=new Notification(t,{icon:e,body:n})).cancel=function(){this.close()},r.show=function(){}),vk.id%100<10&&statlogsValueEvent("browser_notification",0),r}};n("j0Lq");window.getWndInner=function(){var e=lastWindowWidth,t=lastWindowHeight,n=Object(r.sbWidth)();return(!1!==lastWndScroll[0]?lastWndScroll[0]:htmlNode.scrollHeight>htmlNode.clientHeight)&&(e-=n+(n?1:0)),[t,e]},window.lastWndScroll=[!1,!1],window.updateWndVScroll=function(){var e=window,t=!1;t=e.boxLayerWrap&&isVisible(boxLayerWrap)?boxLayerWrap.scrollHeight>boxLayerWrap.clientHeight?1:0:e.layerWrap&&isVisible(layerWrap)?layerWrap.scrollHeight>layerWrap.clientHeight?1:0:!(!e.mvLayerWrap||!isVisible(mvLayerWrap))&&(mvLayerWrap.scrollHeight>mvLayerWrap.clientHeight?1:0),each(curRBox.tabs,(function(e){this.options.marginFixedToLayer&&setStyle(this.wrap,{marginRight:hasClass(document.body,"layers_shown")?Object(r.sbWidth)():0})})),t!==lastWndScroll[0]&&(lastWndScroll[0]=t,each(curRBox.tabs,(function(e){this.toRight&&!this.options.marginFixedToLayer&&setStyle(this.wrap,{marginRight:t?Object(r.sbWidth)():0})})))},window.defBox=function(e,t){var n,r='<div class="'+(e.subClass||"")+'"><div class="fc_tab_head"><a class="fc_tab_close_wrap fl_r"><div class="chats_sp fc_tab_close"></div></a><div class="fc_tab_title noselect">%title%</div></div><div id="fc_ctabs_cont"><div class="fc_ctab fc_ctab_active">%content%</div></div></div></div>';n=e.content?'<div class="fc_content_wrap"><div class="fc_content">'+e.content+"</div></div>":e.innerHTML;var a=se(rs(r,{title:e.title,content:n}));n=geByClass1("fc_content",a,"div");var i,o={movable:geByClass1("fc_tab_head",a),hider:geByClass1("fc_tab_close_wrap",a,"a"),startLeft:e.x,startTop:e.y,startHeight:e.height,startWidth:e.width,resizeableH:n,resize:!1,minH:e.minH,onBeforeHide:e.onBeforeHide||function(){},onHide:e.onHide||function(){},onDragEnd:function(e,t){},onResize:function(e,t){}},s=new RBox(a,extend(o,e));return e.content&&(i=new Scrollbar(n,{prefix:"fc_",more:debugLog,nomargin:!0,global:!0,nokeys:!0,right:vk.rtl?"auto":0,left:vk.rtl?0:"auto",onHold:e.onHold})),t({id:s.id,cont:n,update:function(){i&&i.update()}}),s};try{stManager.done("notifier.js")}catch(e){}},BxOC:function(e,t,n){"use strict";n.r(t),n.d(t,"post",(function(){return a})),n.d(t,"plainget",(function(){return i})),n.d(t,"plaingetCancelable",(function(){return o}));n("VRzm"),n("Btvt");var r=n("cGUQ");function a(e,t,n){return t&&(t.im_v=3),new Promise((r,a)=>{ajax.post(e,t,{timeout:n,onDone(){r.apply(null,[[...arguments]])},onFail(){return a.apply(null,arguments),!0}})})}function i(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=o(e,t,n),a=r.request;return a}function o(e,t){var n,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};function i(){n.abort()}n=window.XDomainRequest?new XDomainRequest:ajax._getreq();var o=new Promise((i,o)=>{var s,c=Date.now(),u=a.timeout||60,l=Object(r.toQueryString)(t);if(window.XDomainRequest)n.open("get",`${e}?${l}`),n.ontimeout=function(e){o([e,{}])},n.onerror=function(e){o([e,{}])},n.onload=function(){i([n.responseText,{}])},setTimeout((function(){n.send()}),0);else{n.onreadystatechange=function(){4==n.readyState&&(clearInterval(s),n.status>=200&&n.status<300?i([n.responseText,n]):o([n.responseText,n]))};try{n.open("GET",`${e}?${l}`,!0)}catch(e){return o([e,n])}n.send()}s=setInterval((function(){Date.now()-c>1e3*u&&(window.browser.safari&&n.abort(),o(["",{}]),clearInterval(s))}),1e3)});return{request:o,cancel:i}}},ERyv:function(e,t,n){"use strict";n.r(t),n.d(t,"isWeirdLogging",(function(){return u})),n.d(t,"imWeirdLog",(function(){return l})),n.d(t,"imWeirdCatch",(function(){return d})),n.d(t,"startLoggingAllUnhandled",(function(){return _})),n.d(t,"stopLoggingAllUnhandled",(function(){return f}));n("VRzm"),n("Btvt");var r,a=n("BxOC"),i=n("DM26"),o=1;function s(e,t,n,a,i){if("Script error."!==e){var o=i?i.stack||i.message:null;l("unhandled_error",o?{err:e,stack:o}:{err:e})}r&&r.apply(this,arguments)}function c(e){e.preventDefault()}function u(){return!!window.imwl}function l(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];u()&&(n&&window.console&&(console.error(e,t),console.trace&&console.trace()),Object(i.retryFn)(a.post,3,()=>2)("al_im.php",{act:"a_weird_log",kind:e,data:JSON.stringify(extend({errIdx:o++,ua:navigator.userAgent},t))}))}function d(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return l(e,extend({err:t&&t.message||t},n)),Promise.reject(t)}function _(){r=window.onerror,window.onerror=s,window.addEventListener("unhandledrejection",c)}function f(){window.onerror=r,r=void 0,window.removeEventListener("unhandledrejection",c)}},"MV/q":function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return s}));n("91GP"),n("ioFf"),n("rGqo"),n("Btvt");var r=n("q1tI"),a=(n("17x9"),n("ZxpX"));function i(){return(i=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}function o(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},i=Object.keys(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}class s extends r.Component{constructor(e){super(e),this.getRef=e=>{this.element=e},this.resize=()=>{var e=this.element;if(e){var t=e.offsetHeight,n=e.scrollHeight,r=0;n+r<=t&&(r=0),e.value&&this.setState({height:n-r}),this.setState({height:0},()=>{var t=e.scrollHeight-r;this.setState({height:t}),this.props.onResize(e)})}},this.onChange=e=>{this.props.grow&&this.resize(),this.isControlledOutside||this.setState({value:e.target.value}),this.props.onChange&&this.props.onChange(e)},this.state={value:void 0===e.value?e.initialValue||"":void 0},void 0!==e.value&&(this.isControlledOutside=!0)}componentDidMount(){this.props.grow&&this.resize()}render(){var e=this.props,t=e.className,n=(e.initialValue,e.grow,e.style),s=(e.onResize,e.value),c=o(e,["className","initialValue","grow","style","onResize","value"]),u=this.isControlledOutside?s:this.state.value,l=this.state.height||n.height||66;return r.createElement("textarea",i({},c,{value:u,onChange:this.onChange,onInput:this.onChange,onPaste:this.onChange,ref:this.getRef,style:i({},n,{height:l}),className:Object(a.classNames)("Textarea",t)}))}}s.defaultProps={initialValue:"",grow:!0,onResize:()=>{},style:{}}},MhhX:function(e,t,n){"use strict";n.r(t),n.d(t,"isUnread",(function(){return i})),n.d(t,"isServiceMsg",(function(){return o})),n.d(t,"isCallMessage",(function(){return s})),n.d(t,"isActiveGroupCallMessage",(function(){return c})),n.d(t,"isOut",(function(){return u})),n.d(t,"hasReply",(function(){return l})),n.d(t,"isGraffiti",(function(){return _})),n.d(t,"isAudioMsg",(function(){return f})),n.d(t,"isSticker",(function(){return h})),n.d(t,"isGift",(function(){return p})),n.d(t,"isMoney",(function(){return g})),n.d(t,"isMoneyRequest",(function(){return m})),n.d(t,"isVKPay",(function(){return b})),n.d(t,"isImportant",(function(){return v})),n.d(t,"getUserId",(function(){return C})),n.d(t,"getAuthorId",(function(){return E})),n.d(t,"getAdminId",(function(){return y})),n.d(t,"wasEdited",(function(){return O})),n.d(t,"isMessageSelected",(function(){return T})),n.d(t,"isCasperMessage",(function(){return w})),n.d(t,"isMessageToBlockedCommunity",(function(){return N})),n.d(t,"hasPrivateStory",(function(){return I})),n.d(t,"isMessageEmpty",(function(){return k})),n.d(t,"getMessageTTL",(function(){return A})),n.d(t,"isExpiredCasperMessage",(function(){return S})),n.d(t,"MARKED_TYPE_MENTIONS",(function(){return j})),n.d(t,"MARKED_TYPE_CASPER",(function(){return L})),n.d(t,"getFromMessageMarkedDataByType",(function(){return M})),n.d(t,"getMentionsFromMessage",(function(){return P})),n.d(t,"hasUserMentions",(function(){return F}));n("OEbY");var r=n("f01n"),a=n("aong");function i(e,t){return"number"!=typeof t.messageId||(u(t)?t.messageId>e.out_up_to:t.messageId>e.in_up_to)}function o(e){return e.kludges&&void 0!==e.kludges.source_act}function s(e){return!(!e.kludges||"call"!==e.kludges.attach1_type)}function c(e){return e&&e.attaches&&e.attaches[0]&&"group_call_in_progress"===e.attaches[0].type}function u(e){return e.flags&r.FLAG_OUTBOUND}function l(e){var t=e.attaches.filter(e=>"mail"===e.type).length>0;return e.attaches.filter(e=>"reply"===e.type).length>0||e.flags&r.FLAG_HAS_REPLY&&t}function d(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=e.attaches[0];return r&&(r.type===t||r.type===n)}function _(e){return d(e,"doc")&&"graffiti"===e.attaches[0].kind}function f(e){return Boolean(e.attaches.find(e=>"doc"===e.type&&"audiomsg"===e.kind))}function h(e){return Boolean(e.attaches.find(e=>"sticker"===e.type))}function p(e){return d(e,"gift")}function g(e){return d(e,"money_transfer","money_request")}function m(e){return d(e,"money_request")}function b(e){return d(e,"link","vkpay")&&6217559==e.kludges.attach1_app_id}function v(e){return e.flags&r.FLAG_IMPORTANT}function C(e){return u(e)?vk.id:e.userId}function E(e,t){var n=Object(a.unpackStore)(e);return u(t)?n.id:t.userId}function y(e,t){var n=Object(a.unpackStore)(e);return n.gid&&u(t)?+t.kludges.from_admin||-n.gid:0}function O(e){return e.update_time>0}function T(e,t){return(e.get().selectedMessages||[]).indexOf(t)>=0}function w(e){return Boolean(e.kludges.is_expired||e.kludges.expire_ttl||e.kludges.ttl&&e.flags&r.FLAG_DELETE_BY_TTL)}function N(e,t){return!(!e.blocked_community||!u(t))}function I(e){return!(!e||!e.kludges.has_private_story)}function k(e){return e.messageId<=0}function A(e){var t=e.kludges.ttl||e.kludges.expire_ttl;return t?Number(t):void 0}function S(e){return!(!e.kludges||!e.kludges.is_expired)}var j=1,L=2;function M(e,t){var n=e.kludges&&e.kludges.marked_users,r=n&&n.find(e=>e[0]===t);return r?r[1]:void 0}function P(e){if(!e.kludges&&!e.kludges.marked_users)return[];var t=M(e,j);return t?Array.isArray(t)?t:[t]:[]}function F(e,t){if(!e.kludges&&!e.kludges.mentions&&!e.kludges.marked_users)return!1;var n=e.kludges.marked_users?P(e):e.kludges.mentions;return!!n&&n.findIndex(e=>e===t||"all"===e)>-1}},N4ZS:function(e,t,n){"use strict";function r(e){return"https://vk.com/web/away.php?to="+e}function a(e,t){var n=decodeURIComponent(e);return/^\/[^/]/.test(n)||/^(https?:\/\/)?([a-z0-9_\-.]+\.)?vk.com(\/.*)?/.test(n)?e:"/away.php?to="+encodeURIComponent(n)+(t?"&utf=1":"")}n.r(t),n.d(t,"wrapAway",(function(){return r})),n.d(t,"wrapAwayIfExternal",(function(){return a}))},O8ze:function(e,t,n){"use strict";n.r(t),n.d(t,"statlogsForwardEvent",(function(){return f})),n.d(t,"statlogsForwardFromCommunityEvent",(function(){return h})),n.d(t,"statlogsCommunityTemplatesClickEvent",(function(){return p})),n.d(t,"statlogsForwardFromChannel",(function(){return g})),n.d(t,"statlogsSendingTime",(function(){return b})),n.d(t,"statlogsSendingTimeStart",(function(){return v})),n.d(t,"statlogsSendingTimeEnd",(function(){return C})),n.d(t,"statlogsSendingError",(function(){return E})),n.d(t,"statlogsSendingQueueLength",(function(){return T})),n.d(t,"statlogsSendingRetry",(function(){return w})),n.d(t,"statlogsBrowserNotificationsUser",(function(){return N})),n.d(t,"statlogsBrowserNotificationsOn",(function(){return I})),n.d(t,"statlogsBrowserNotificationsOff",(function(){return k}));n("pIFo");var r,a=n("1y80"),i=n("Bj12"),o=n("HLtZ"),s=function(){function e(){}return e.prototype.getCurrentTime=function(e){void 0===e&&(e=!0);var t=Date.now().toString(10);return e?t+"000":t},e.prototype.getIntId=function(){return Math.floor(Math.random()*e.MAX_INT32)},e.prototype.getBaseEvent=function(){return{id:this.getIntId(),timestamp:this.getCurrentTime()}},e.prototype.logEvent=function(e){e.type&&e[e.type]?Object(i.saveCustomStats)(e):Object(o.logError)(new Error("CustomStatCollector: invalid event."))},e.MAX_INT32=2147483647,e}();!function(e){e.TYPE_DEV_NULL_ITEM="type_dev_null_item"}(r||(r={}));var c=function(){return(c=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var a in t=arguments[n])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e}).apply(this,arguments)},u=function(){function e(e){this.customStatCollector=e}return e.prototype.logEvent=function(e){var t,n=c(c({},this.customStatCollector.getBaseEvent()),((t={type:r.TYPE_DEV_NULL_ITEM})[r.TYPE_DEV_NULL_ITEM]=e,t));this.customStatCollector.logEvent(n)},e}(),l=n("aong"),d=new u(new s),_={};function f(e){Object(a.statlogsProbValueEvent)(.1,"im_forward_stat",m(e),!!e.get().gid)}function h(e,t){Object(a.statlogsProbValueEvent)(.1,"im_forward_from_community_stat",m(e),!!e.get().gid,+t)}function p(){Object(a.statlogsProbValueEvent)(1,"im_apply_community_template_stat",1)}function g(){Object(a.statlogsProbValueEvent)(1,"messages_channel_forward_click",1)}function m(e){var t=e.get().pendingForward;return+(t&&t.msgIds&&t.msgIds.length)}function b(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],o=1;if(!Object(a.randEnabled)(o))return()=>{};var s=+new Date,c=y(e),u=O(e)?"sse":"longpoll";return function(){var e=+new Date-s;Object(i.saveStatlogEvents)({name:"messages_send_time_web",value:e,keys:[t,n,c,r,u]}),"opt_to_lp"===n&&d.logEvent({key:"messages_send_time_web",value_str:u,value:e})}}function v(e,t,n,r){if(t.messageId&&-1!==String(t.messageId).indexOf("rid")){var a=[t.messageId.replace("rid",""),n,r].join("_"),i=t.attaches.length>0;_[a]=b(e,n,r,i)}}function C(e,t,n,r){var a=[t.randomId,n,r].join("_"),i=_[a];i&&(i(),delete _[a])}function E(e,t,n,r){var i=y(e),o=""===t?"network":"unknown";Object(a.randEnabled)(1)&&Object(a.statlogsValueEvent)("messages_send_errors_web",o,n,r,i)}function y(e){var t=Object(l.unpackStore)(e);return Boolean(t.longpoll&&t.longpoll.isEnabled&&t.longpoll.isEnabled())}function O(e){var t=Object(l.unpackStore)(e);return Boolean(t.longpoll&&t.longpoll.isSSE)}function T(e){var t=Object(l.unpackStore)(e),n=t.imQueue(t.peer).length;Object(a.randEnabled)(1)&&Object(a.statlogsValueEvent)("messages_send_queue_size",n)}function w(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"unknown",n=1;Object(a.randEnabled)(n)&&Object(a.statlogsValueEvent)("messages_send_retry",1,t,e)}function N(){var e="im_browser_notifications_users";ls.get(e)||ls.get("im_ui_notify_off")||(ls.set(e,1),Object(a.statlogsValueEvent)(e,1))}function I(){Object(a.statlogsProbValueEvent)(1,"im_browser_notifications_on",1)}function k(){Object(a.statlogsProbValueEvent)(1,"im_browser_notifications_off",1)}},P13b:function(e,t,n){"use strict";n.r(t),n.d(t,"getFirstUnread",(function(){return o.getFirstUnread})),n.d(t,"isSearchShown",(function(){return o.isSearchShown})),n.d(t,"getPeer",(function(){return o.getPeer})),n.d(t,"getCurrentKeyboard",(function(){return o.getCurrentKeyboard})),n.d(t,"getKeyboard",(function(){return o.getKeyboard})),n.d(t,"getTab",(function(){return o.getTab})),n.d(t,"getCurrentTab",(function(){return o.getCurrentTab})),n.d(t,"getSelectedMessages",(function(){return o.getSelectedMessages})),n.d(t,"getMessageRangeFromSelection",(function(){return o.getMessageRangeFromSelection})),n.d(t,"countUnread",(function(){return o.countUnread})),n.d(t,"getMessageByRid",(function(){return o.getMessageByRid})),n.d(t,"isRidExist",(function(){return o.isRidExist})),n.d(t,"getLocalId",(function(){return o.getLocalId})),n.d(t,"getLastMessage",(function(){return o.getLastMessage})),n.d(t,"parserMessage",(function(){return o.parserMessage})),n.d(t,"getAuthorFullName",(function(){return o.getAuthorFullName})),n.d(t,"getMessage",(function(){return o.getMessage})),n.d(t,"getPreviousMessage",(function(){return o.getPreviousMessage})),n.d(t,"isClassicInterface",(function(){return o.isClassicInterface})),n.d(t,"isLocksAvailable",(function(){return o.isLocksAvailable})),n.d(t,"isFoldersAvailable",(function(){return o.isFoldersAvailable})),n.d(t,"isCommunityInterface",(function(){return o.isCommunityInterface})),n.d(t,"isChannelPeer",(function(){return o.isChannelPeer})),n.d(t,"getBareTab",(function(){return o.getBareTab})),n.d(t,"isReversedDialogs",(function(){return o.isReversedDialogs})),n.d(t,"isFullyLoadedTab",(function(){return o.isFullyLoadedTab})),n.d(t,"makeTabNotFullyLoaded",(function(){return o.makeTabNotFullyLoaded})),n.d(t,"isGoToEndVisible",(function(){return o.isGoToEndVisible})),n.d(t,"isGoToMentionVisible",(function(){return o.isGoToMentionVisible})),n.d(t,"getUnreadScrollBottom",(function(){return o.getUnreadScrollBottom})),n.d(t,"isSendingAvailable",(function(){return o.isSendingAvailable})),n.d(t,"isCommunityPeer",(function(){return o.isCommunityPeer})),n.d(t,"isCommunityBlocked",(function(){return o.isCommunityBlocked})),n.d(t,"checkVoiceMessageAvailable",(function(){return o.checkVoiceMessageAvailable})),n.d(t,"isSearching",(function(){return o.isSearching})),n.d(t,"getSearchText",(function(){return o.getSearchText})),n.d(t,"isSearchingValue",(function(){return o.isSearchingValue})),n.d(t,"isRecentSearchesActive",(function(){return o.isRecentSearchesActive})),n.d(t,"getPinnedMessage",(function(){return o.getPinnedMessage})),n.d(t,"doPopularSuggExist",(function(){return o.doPopularSuggExist})),n.d(t,"isAnyMessageBeingEdited",(function(){return o.isAnyMessageBeingEdited})),n.d(t,"getGroupId",(function(){return o.getGroupId})),n.d(t,"getTabDraft",(function(){return o.getTabDraft})),n.d(t,"getTemplates",(function(){return o.getTemplates})),n.d(t,"tabIsMessageRequest",(function(){return o.tabIsMessageRequest})),n.d(t,"tabIsRejectedMessageRequest",(function(){return o.tabIsRejectedMessageRequest})),n.d(t,"tabIsMessageRequestToChat",(function(){return o.tabIsMessageRequestToChat})),n.d(t,"removeMessageRequestFolderFlags",(function(){return o.removeMessageRequestFolderFlags})),n.d(t,"isMessageRequestFolder",(function(){return o.isMessageRequestFolder})),n.d(t,"tabIsOutgoingMessageRequest",(function(){return o.tabIsOutgoingMessageRequest})),n.d(t,"existsIncomingMessageRequest",(function(){return o.existsIncomingMessageRequest})),n.d(t,"isMessageRequestChangedEvent",(function(){return o.isMessageRequestChangedEvent})),n.d(t,"isCommunityChat",(function(){return o.isCommunityChat})),n.d(t,"isCommunityChatDeleted",(function(){return o.isCommunityChatDeleted})),n.d(t,"isClosedChat",(function(){return o.isClosedChat})),n.d(t,"isCasperChat",(function(){return o.isCasperChat})),n.d(t,"isServiceChatTab",(function(){return o.isServiceChatTab})),n.d(t,"isCasperChatTab",(function(){return o.isCasperChatTab})),n.d(t,"isChatActive",(function(){return o.isChatActive})),n.d(t,"isTabMarkedUnread",(function(){return o.isTabMarkedUnread})),n.d(t,"SENDING_CLASS",(function(){return B})),n.d(t,"FAILED_CLASS",(function(){return H})),n.d(t,"ORIGINAL_CLASS",(function(){return U})),n.d(t,"RESTORE_CLASS",(function(){return G})),n.d(t,"TYPING_CLASS",(function(){return q})),n.d(t,"MESSAGE_KEYBOARD_BUTTON_CLASS",(function(){return W})),n.d(t,"MESSAGE_STACK_CLASS",(function(){return K})),n.d(t,"MESSAGE_CLASS",(function(){return z})),n.d(t,"CREATE_CHAT_ACTION",(function(){return V})),n.d(t,"CHAT_TITLE_ACTION",(function(){return Y})),n.d(t,"CHAT_INVITE_USER",(function(){return $})),n.d(t,"CHAT_KICK_USER",(function(){return Q})),n.d(t,"CHAT_PHOTO_UPDATE",(function(){return X})),n.d(t,"CHAT_PHOTO_REMOVE",(function(){return J})),n.d(t,"CHAT_PIN_MESSAGE",(function(){return Z})),n.d(t,"CHAT_UNPIN_MESSAGE",(function(){return ee})),n.d(t,"CHAT_INVITE_BY_LINK",(function(){return te})),n.d(t,"CHAT_SCREENSHOT",(function(){return ne})),n.d(t,"CHAT_GROUP_CALL_STARTED",(function(){return ae})),n.d(t,"CHAT_INVITE_TO_CALL",(function(){return ie})),n.d(t,"CHAT_INVITE_BY_CALL_LINK",(function(){return oe})),n.d(t,"ACCEPTED_MESSAGE_REQUEST",(function(){return ce})),n.d(t,"DESELECT_ALL_CLASS",(function(){return ue})),n.d(t,"HIDE_TOP_NOTICE_CLASS",(function(){return le})),n.d(t,"HIDE_ASIDE_NOTICE_CLASS",(function(){return de})),n.d(t,"HIDE_ASIDE_PROMO_BLOCK_CLASS",(function(){return _e})),n.d(t,"INSTALL_VKADMIN_LINK",(function(){return fe})),n.d(t,"CLEAR_RECENT_CLASS",(function(){return he})),n.d(t,"TOGGLE_MR_TAB",(function(){return pe})),n.d(t,"MESSAGE_SEARCH_CLASS",(function(){return ge})),n.d(t,"PINNED_CONTAINER_CLASS",(function(){return me})),n.d(t,"getClassicChatHeight",(function(){return be})),n.d(t,"setClassicChatHeight",(function(){return ve})),n.d(t,"applyInnerHtml",(function(){return Ce})),n.d(t,"compensateHistoryHeightChange",(function(){return Ee})),n.d(t,"renderSticker",(function(){return ye})),n.d(t,"isAlreadyDeleted",(function(){return Oe})),n.d(t,"replaceMessageAttrs",(function(){return Te})),n.d(t,"isVoiceMessageAvailable",(function(){return we})),n.d(t,"getAvailableMicrophones",(function(){return Ne})),n.d(t,"renderAttach",(function(){return Ie})),n.d(t,"dayFromVal",(function(){return ke})),n.d(t,"formatPhoneNumber",(function(){return Ae})),n.d(t,"getUserInitials",(function(){return Se})),n.d(t,"prepareContactName",(function(){return je})),n.d(t,"showInvisibleBar",(function(){return Le})),n.d(t,"updateMessageInCache",(function(){return Me})),n.d(t,"editAndReplaceMessage",(function(){return Pe})),n.d(t,"setCasperMessageExpiringStatusDOM",(function(){return Fe})),n.d(t,"renderMessage",(function(){return Re})),n.d(t,"renderMessageMedia",(function(){return xe})),n.d(t,"ensureDomHasActions",(function(){return De})),n.d(t,"secondsToHuman",(function(){return Be})),n.d(t,"renderCallMessage",(function(){return He})),n.d(t,"renderCallUserList",(function(){return Ue})),n.d(t,"appendToHistory",(function(){return Ge})),n.d(t,"restoreQueue",(function(){return qe})),n.d(t,"markMessagesAsRead",(function(){return We})),n.d(t,"replaceAttaches",(function(){return Ke})),n.d(t,"MSG_NEW",(function(){return ze})),n.d(t,"MSG_DUPLICATE",(function(){return Ve})),n.d(t,"MSG_LOCAL_DUPLICATE",(function(){return Ye})),n.d(t,"getMessageStoreStatus",(function(){return $e})),n.d(t,"isChatPeer",(function(){return l.isChatPeer})),n.d(t,"isUserPeer",(function(){return l.isUserPeer})),n.d(t,"isReservedPeer",(function(){return l.isReservedPeer})),n.d(t,"isContactPeer",(function(){return Xe})),n.d(t,"isEmailPeer",(function(){return Qe})),n.d(t,"isPeerActive",(function(){return Je})),n.d(t,"isFvkcomgroup",(function(){return Ze})),n.d(t,"isTabLoaded",(function(){return et})),n.d(t,"isTabLoadedWithMessage",(function(){return tt})),n.d(t,"parseMessage",(function(){return at})),n.d(t,"convertPeerToUrl",(function(){return it})),n.d(t,"unUrlPeer",(function(){return ot})),n.d(t,"simplifyCounter",(function(){return st})),n.d(t,"chatActions",(function(){return ct})),n.d(t,"renderPhotos",(function(){return dt})),n.d(t,"renderPhotosFromTab",(function(){return _t})),n.d(t,"renderBtnSearchOnlyMessages",(function(){return ft})),n.d(t,"renderMessagesSep",(function(){return ht})),n.d(t,"renderConversationsSep",(function(){return pt})),n.d(t,"renderPopularSuggSep",(function(){return gt})),n.d(t,"renderClearRecent",(function(){return mt})),n.d(t,"renderPopularSuggestions",(function(){return bt})),n.d(t,"setMessageError",(function(){return vt})),n.d(t,"startResendMessage",(function(){return Ct})),n.d(t,"removeMessages",(function(){return Et})),n.d(t,"removeExpiredMessagesStub",(function(){return yt})),n.d(t,"removeStartingFromMessage",(function(){return Tt})),n.d(t,"removeMessagesWithRestore",(function(){return wt})),n.d(t,"restoreMessage",(function(){return Nt})),n.d(t,"formatTyper",(function(){return It})),n.d(t,"loadSummaryActivityType",(function(){return kt})),n.d(t,"renderEmptySearch",(function(){return St})),n.d(t,"serviceLink",(function(){return jt})),n.d(t,"renderServiceMsg",(function(){return Lt})),n.d(t,"addChatPhotoToUpdate",(function(){return Mt})),n.d(t,"replaceSpecialSymbols",(function(){return Pt})),n.d(t,"isSelfMessage",(function(){return Ft})),n.d(t,"showVerifiedTooltip",(function(){return Rt})),n.d(t,"wrapLoading",(function(){return xt})),n.d(t,"tabFromIds",(function(){return Dt})),n.d(t,"checkSelectClick",(function(){return Bt})),n.d(t,"renderGoTo",(function(){return Ht})),n.d(t,"showFlushChat",(function(){return Ut})),n.d(t,"showLeaveDialog",(function(){return Gt})),n.d(t,"showUnpinDialog",(function(){return qt})),n.d(t,"showMsgDeleteDialog",(function(){return Wt})),n.d(t,"cleanHistory",(function(){return Kt})),n.d(t,"inviteUser",(function(){return zt})),n.d(t,"toggleMessageRequestsTab",(function(){return Vt})),n.d(t,"showUnreadOnly",(function(){return Yt})),n.d(t,"changeTab",(function(){return $t})),n.d(t,"isImportant",(function(){return Qt})),n.d(t,"isUnrespond",(function(){return Xt})),n.d(t,"isPeerBlocked",(function(){return Jt})),n.d(t,"isPendingForward",(function(){return Zt})),n.d(t,"isPeerBlockedByMe",(function(){return en})),n.d(t,"blockLatencyCompensation",(function(){return tn})),n.d(t,"showSpamLayer",(function(){return nn})),n.d(t,"getLastSeenTextInHeader",(function(){return rn})),n.d(t,"getLastSeenText",(function(){return an})),n.d(t,"showBlacklistBoxUser",(function(){return sn})),n.d(t,"showBlacklistBox",(function(){return cn})),n.d(t,"getBaseLink",(function(){return un})),n.d(t,"showFavvedBox",(function(){return ln})),n.d(t,"isEditableFocused",(function(){return dn})),n.d(t,"updateStar",(function(){return _n})),n.d(t,"removewNewUnreadBarAndMerge",(function(){return fn})),n.d(t,"isMessagesVisible",(function(){return hn})),n.d(t,"hideTopNotice",(function(){return pn})),n.d(t,"hideAsideNotice",(function(){return gn})),n.d(t,"hideAsidePromoBlock",(function(){return mn})),n.d(t,"installVKAdminApp",(function(){return bn})),n.d(t,"renderShortText",(function(){return Cn})),n.d(t,"attachToText",(function(){return En})),n.d(t,"lockButton",(function(){return yn})),n.d(t,"unlockButton",(function(){return On})),n.d(t,"renderPinnedMessage",(function(){return Tn})),n.d(t,"renderPinnedMedia",(function(){return wn})),n.d(t,"showMessageInfoTooltip",(function(){return Nn})),n.d(t,"showEditTimeTooltip",(function(){return In})),n.d(t,"showCasperExpiringTooltip",(function(){return kn})),n.d(t,"getHistoryTopIndent",(function(){return An})),n.d(t,"getPinnedMessageHeight",(function(){return Sn})),n.d(t,"boxHandleMessagesLabelsTooltips",(function(){return jn})),n.d(t,"showPinnedBox",(function(){return Ln})),n.d(t,"showRepliedBox",(function(){return Mn})),n.d(t,"isUserAliveInChat",(function(){return Pn})),n.d(t,"getAliveMembersCount",(function(){return Fn})),n.d(t,"normalizeTab",(function(){return Rn})),n.d(t,"normalizeTabsGotFromServer",(function(){return xn})),n.d(t,"splitMessageToParts",(function(){return Dn})),n.d(t,"isMessageTooLong",(function(){return Bn})),n.d(t,"showInvitationBox",(function(){return Hn})),n.d(t,"showWaitUntilUploadedBox",(function(){return Gn})),n.d(t,"canMessageBeDeletedForAll",(function(){return qn})),n.d(t,"getTopChatMembers",(function(){return Wn})),n.d(t,"getChatMembersByIds",(function(){return Kn})),n.d(t,"getChatMembers",(function(){return zn})),n.d(t,"formatTimespan",(function(){return Vn})),n.d(t,"focusOnMessage",(function(){return Yn})),n.d(t,"getNowEditingMessage",(function(){return $n})),n.d(t,"checkMessageRequestsTab",(function(){return Qn})),n.d(t,"updateMessageRequestsCounterInDOM",(function(){return Xn})),n.d(t,"hideAllBoxes",(function(){return Jn})),n.d(t,"getMessageRequestDateText",(function(){return Zn})),n.d(t,"canPinMessage",(function(){return er})),n.d(t,"canForwardMessages",(function(){return tr})),n.d(t,"canMarkImportant",(function(){return nr})),n.d(t,"removeExpiredMessageIfNeed",(function(){return rr})),n.d(t,"isPeerCurrentUser",(function(){return ar})),n.d(t,"isGiftOptionAvailableForPeer",(function(){return ir})),n.d(t,"isMoneyOptionAvailableForPeer",(function(){return or})),n.d(t,"replaceExpiredMessageWithPlaceholder",(function(){return sr})),n.d(t,"replaceExpiredRepliedMessageWithPlaceholder",(function(){return dr})),n.d(t,"getChatMemberCount",(function(){return _r})),n.d(t,"CALL_ENTRY_POINT_SNIPPET",(function(){return fr})),n.d(t,"CALL_ENTRY_POINT_HEADER",(function(){return hr})),n.d(t,"CALL_ENTRY_POINT_LIST",(function(){return pr})),n.d(t,"CALL_ENTRY_POINT_JOIN_SNIPPET",(function(){return gr})),n.d(t,"CALL_ENTRY_POINT_JOIN_HEADER",(function(){return mr})),n.d(t,"CALL_ENTRY_POINT_JOIN_BANNER",(function(){return br})),n.d(t,"startCallFromIm",(function(){return vr})),n.d(t,"handleCallLinkClick",(function(){return Cr})),n.d(t,"isCallToPeerAvailable",(function(){return Er})),n.d(t,"joinCallFromIm",(function(){return yr})),n.d(t,"getConvoLocation",(function(){return Or}));n("rE2o"),n("ioFf"),n("HEwt"),n("Vd3H"),n("a1Th"),n("91GP"),n("rGqo"),n("pIFo"),n("SRfc"),n("KKXr"),n("VRzm"),n("Btvt");var r=n("f01n"),a=n("h++7"),i=n("bIHZ"),o=n("rHUl"),s=n("MhhX"),c=n("S2bU"),u=n("jE6c"),l=n("rudk"),d=n("ZxpX"),_=n("yqpO"),f=n("FWc3"),h=n("EasH"),p=n("1BRX"),g=n("v+DW"),m=n("vT4u"),b=n("ofcU");function v(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var n=[],r=!0,a=!1,i=void 0;try{for(var o,s=e[Symbol.iterator]();!(r=(o=s.next()).done)&&(n.push(o.value),!t||n.length!==t);r=!0);}catch(e){a=!0,i=e}finally{try{r||null==s.return||s.return()}finally{if(a)throw i}}return n}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return C(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return C(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function C(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function E(e){return e.parentNode.getAttribute("data-receiver-chat-peer-id")}function y(e,t,n){var a=Object(b.createModule)({handlers:(a,i)=>{i(e,"click","_im_join_chat",e=>function(e,t){var n=domData(t,"chat-id"),a=domData(t,"hash"),i=domData(t,"chat-link");return Object(g.lockButton)(t),Object(m.joinChat)(n,a,i,e.get()).then(n=>{var a=v(n,1)[0];Object(g.unlockButton)(t);var i=e.get();i.longpoll.push([Object(r.changePeer)(a)]),i.onJoinChat&&i.onJoinChat(a)}).catch(e=>{Object(h.showFastBox)(getLang("mail_join_invite_error_title"),e),Object(g.unlockButton)(t)})}(t,e.target)),i(e,"click","_im_accept_mr",e=>function(e,t){var n=E(t);return Object(g.lockButton)(t),e.set(m.acceptMessageRequest.bind(null,n)).then(()=>{Object(g.unlockButton)(t),e.get().longpoll.push([Object(r.changePeer)(n)])}).catch(e=>{Jn(),Object(h.showFastBox)(getLang("mail_join_invite_error_title"),e),Object(g.unlockButton)(t)})}(t,e.target)),i(e,"click","_im_reject_mr",e=>function(e,t,n){var r=E(n);return Object(g.lockButton)(n),e.set(m.rejectMessageRequest.bind(null,r)).then(()=>{t.updateMenu(),t.updateList(),Object(g.unlockButton)(n),Jn()}).catch(e=>{Jn(),Object(h.showFastBox)(getLang("mail_error"),e),Object(g.unlockButton)(n)})}(t,n,e.target))}});return{unmount(){Object(b.destroyModule)(a)}}}var O=n("83Q7"),T=n("aong"),w=n("86+7"),N=n("Wu9C"),I=n("wSs/"),k=n("ERyv"),A=n("lJdi"),S=n("t7n3");var j=n("/eGY"),L=n("ambf"),M=n("Syd7"),P=n("nAFc"),F=n("S6+Z");function R(){return(R=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}function x(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var n=[],r=!0,a=!1,i=void 0;try{for(var o,s=e[Symbol.iterator]();!(r=(o=s.next()).done)&&(n.push(o.value),!t||n.length!==t);r=!0);}catch(e){a=!0,i=e}finally{try{r||null==s.return||s.return()}finally{if(a)throw i}}return n}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return D(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return D(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function D(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var B="_im_mess_sending",H="_im_mess_failed",U="_im_mess_original",G="_im_mess_restore",q="_im_typing",W="_im_mess_btn",K="_im_mess_stack",z="_im_mess",V="chat_create",Y="chat_title_update",$="chat_invite_user",Q="chat_kick_user",X="chat_photo_update",J="chat_photo_remove",Z="chat_pin_message",ee="chat_unpin_message",te="chat_invite_user_by_link",ne="chat_screenshot",ae="chat_group_call_started",ie="chat_invite_user_by_call",oe="chat_invite_user_by_call_join_link",ce="accepted_message_request",ue="_im_deselect_all",le="_im_top_notice_hide",de="_im_aside_notice_hide",_e="_im_aside_promo_block_hide",fe="_im_vkadmin_promo_link",he="_im_clear_recent",pe="_im_toggle_mr_tab",ge="_im_mess_search",me="_im_pinned";function be(){return ls.get("chatPosition")||0}function ve(e){e>=window.clientHeight()-30&&(e=0),ls.set("chatPosition",e)}function Ce(e,t){e&&e.innerHTML!==t&&(e.innerHTML=t)}function Ee(e,t,n,r){var a=t&&!n?1:!t&&n?-1:0;a&&!Object(o.isClassicInterface)(e)&&r().compensateHistoryHeightChange(a)}function ye(e,t,n,r){var a=window.devicePixelRatio>=2?"256":"128",i="animation"===n,o="im_gift";i&&(o+=" sticker_img");var s=`<img height="128" class="${o}" src="${Stickers.getStickerUrl(intval(e),a)}"/>`;if(i){var c="animatedSticker"+r;s=`<div id="${c}" data-loop-count=3 data-animation-path="${"/stickers.php?act=proxy_animation&product_id="+t+"&sticker_id="+e}" onmouseenter="StickersAnimation.loadAndPlaySticker(this);"\n     data-uniq-id="${r}" data-sticker-id="${intval(e)}" class="sticker_animation sticker_animation_128 im_gift">${s}</div>`;var u=!1;browser.msie?(0^r)===r&&(u=!0):u=Number.isInteger(r),u&&window.StickersSettings.getAutoplay()&&window.StickersAnimation&&window.StickersAnimation.loadAndPlayStickerWithTimer(c,10)}return t&&(s=`<a onmouseover="return Emoji.stickerOver(${intval(e)}, this);"\n        onclick="return Emoji.clickSticker(${intval(t)}, this, event);">${s}</a>`),s=`<div class="im_sticker_row">${s}</div>`}function Oe(e,t,n){var r=e.get?e.get():e;if(et(r,t)){var a=r.tabs[t].deleted||[];return inArray(n,a)}return!1}function Te(e,t,n){var r=n.randomId,a=geByClass1("_im_mess_rid"+r,t);return a&&(t=Ge(e,n,t=Ot([a],t),!0,!1)),t}function we(e){var t=Object(o.checkVoiceMessageAvailable)(e);return browser.mobile&&browser.safari?Promise.resolve(!1):void 0!==t?Promise.resolve(t):Ne().then(e=>e.length>0).catch(e=>!1)}function Ne(){return window.AudioContext&&navigator.mediaDevices?navigator.mediaDevices.enumerateDevices().then((function(e){for(var t=[],n=0;n<e.length;n++)"audioinput"==e[n].kind&&t.push(e[n]);return t})):Promise.reject(new Error("NotSupported"))}function Ie(e){return Object(S.getTemplate)("im_preloader",{preloader:rs(vk.pr_tpl,{id:""}),cls:"im-preloader_attach im-preloader_visible im-preloader_"+e})}function ke(e){var t=e.split(".");return(t[0]<10?"0":"")+t[0]+(t[1]<10?"0":"")+t[1]+t[2]}function Ae(e){var t=(""+e).replace(/\D/g,"").match(/^(\d+)(\d{3})(\d{3})(\d{2})(\d{2})$/);return t?`+${t[1]} (${t[2]}) ${t[3]}-${t[4]}-${t[5]}`:""}function Se(e){var t=Object(P.decodeHTMLEntities)(e),n=Object(F.emojiRegex)().exec(t);return n?0===n.index?Object(_.emojiReplace)(n[0]):t[0]:t.split(/\s/).reduce((e,t)=>e+t.slice(0,1),"").slice(0,2)}function je(e){var t=Object(u.replaceEntities)(e);return Object(_.emojiToHTML)(Object(S.clean)(t),!0)}function Le(e){var t=geByClass1("_im_invisible_bar",e);t&&(removeClass(t,"_im_invisible_bar"),removeClass(t,"im-page--history-new-bar_hide"))}function Me(e,t,n){var r=domData(n,"msgid"),a=geByClass1("_im_mess_"+r,t),i=n.cloneNode(!0);return a&&(a.parentNode.replaceChild(i,a),De(t)),t}function Pe(e,t,n){var r=geByClass1("_im_mess_"+t.messageId,n);if(r){var a=se(Re(e,t));r.classList.contains("im-mess_is_editing")&&a.classList.add("im-mess_is_editing"),r.parentNode.replaceChild(a,r),De(n)}return n}function Fe(e,t,n){var r=geByClass1("_im_mess_"+n,e);if(r){var a=r.closest("._im_mess_stack"),i=a&&a.querySelector(".im-mess-stack--bomb");i&&i.classList.add(t?"im-mess-stack--bomb_expiring-soon":"im-mess-stack--bomb_expiring")}return e}function Re(e,t){var n=[],r=Object(s.isUnread)(e.tabs[t.peerId],t),a=Object(s.isCallMessage)(t)||Object(s.isActiveGroupCallMessage)(t),i=Object(o.getPinnedMessage)(e),u=Object(s.hasReply)(t)?Object(S.getTemplate)("im_message_media",{type:"reply",messageId:t.messageId,attaches:Ie("reply"),text:""}):"";a||n.push("_im_mess"),Object(s.isOut)(t)&&r&&!a&&n.push("im-mess_unread _im_mess_unread"),Object(s.isOut)(t)&&!a&&n.push("im-mess_out"),Object(s.wasEdited)(t)&&n.push("im-mess_was_edited"),Object(I.canMessageBeEdited)(e,t)&&n.push("im-mess_editable"),Object(s.isImportant)(t)&&n.push("im-mess_fav"),-1!==(e.selectedMessages||[]).indexOf(t.messageId)&&n.push("im-mess_selected"),i&&i.messageId===t.messageId&&n.push("_im_mess_pinned");var d=Date.now()-1e3*t.date>1e3;t.local&&d&&n.push("im-mess_sending"),t.local&&n.push(""+B),t.local&&Object(s.wasEdited)(t)&&!r&&n.push("im-mess_unread im-mess_nobg"),t.failed&&n.push("im-mess_failed "+H),Object(s.isGift)(t)&&n.push("im-mess_gift"),a&&n.push("_im_mess_callsnippet"),Object(s.isCasperMessage)(t)&&n.push("im-mess_casper");var _=xe(t).concat(function(e){if(e.kludges.keyboard&&e.kludges.keyboard.inline){var t=e.kludges.keyboard.buttons;return[].concat(Object(S.getTemplate)("sImMessageKeyboard",{content:t.map(e=>Object(S.getTemplate)("sImMessageKeyboardRow",{content:e.map(e=>Object(S.getTemplate)("sImMessageKeyboardButton",{label:Object(j.getButtonLabel)(e),appearance:Object(j.getButtonAppearance)(e),type:e.action.type,modifier:e.action.type.replace("_","-"),attributes:Object(j.getAttributesFromActionObject)(e.action),tagName:e.action.type===j.BUTTON_TYPE_OPEN_LINK?"a":"button"})).join("")})).join("")}))}return[]}(t)),f=function(e,t){var n="",r=Object(T.unpackStore)(e).sourceEnabled&&t.kludges&&t.kludges.from_widget&&t.kludges.ref_source;Object(s.wasEdited)(t)&&(n+=Object(S.getTemplate)("sImLblWasEdited",{update_time:t.update_time}));if(Object(o.isCommunityInterface)(e)&&r){var a=t.kludges.ref_source,i={};try{(i=JSON.parse(Object(S.unclean)(a))).link&&i.info&&(i.link=Object(c.replaceHyperLinks)(Object(S.clean)(i.link),c.linksReplacer.bind(null,!1)),i=Object(S.clean)(langStr(getLang("mail_source_info"),"link",i.link,"info",Object(S.clean)(i.info))),n+=Object(S.getTemplate)("sImLblWasSourceInfo",{source:i}))}catch(e){}}return n}(e,t),h=u+at(e,t.text,t.kludges,!1,t.peerId);t.subject&&"..."!==t.subject.trim()&&!Object(l.isChatPeer)(t.peerId)&&(h=Object(S.getTemplate)("im_topic",{topic:t.subject})+h);var p=Object(s.isGift)(t)?`<div class="im-mess--gift-lbl">${h}</div>`:"",g=_.length>0?Object(S.getTemplate)("im_message_media",{type:"media",messageId:t.messageId,attaches:_.join(""),text:p}):"";if(Object(s.isGift)(t)||(g=h+g),Object(s.isCallMessage)(t)){var m=He(t,!1,!0,e);g+=Object(S.getTemplate)("sImCallSnippet",m)}return g+=f,Object(S.getTemplate)("im_msg_row",{msg_id:t.messageId,from_id:t.peerId,aria_hidden:t.local&&!t.failed?"true":"false",ts:t.date,marker_params:t.failed?`aria-label="${getLang("mail_send_message_error")}" role="link"`:"",unread_params:r?`aria-label="${getLang("mail_unread_message")}"`:"",cls:n.join(" ")}).replace("%text%",()=>g)}function xe(e){return e.attaches.reduce((t,n)=>!Object(s.hasReply)(e)||"mail"!==n.type&&"reply"!==n.type?("call"===n.type||("sticker"===n.type?e.messageId?t.push(ye(n.id,n.productId,n.kind,e.messageId)):t.push(ye(n.id,n.productId)):t.push(Ie(n.type))),t):t,[])}function De(e){for(var t=e.querySelectorAll("._im_mess_noa:not(._im_mess_callsnippet):not(._im_mess_srv)"),n=t.length;n--;)hasClass(t[n],"im-mess_fwd")||t[n].insertAdjacentHTML("afterbegin",Object(S.getTemplate)("sImHistoryRowActions")),removeClass(t[n],"_im_mess_noa")}function Be(e){var t=Math.floor(e/3600),n=Math.floor(e/60)-60*t,r=!1,a=!1;return[t,n,e-3600*t-60*n].reduce((e,t)=>{if(0===t&&!a)return a=!0,e;r&&(t=t<10?"0"+t:t);var n=`${e}${""!==e?":":""}${t}`;return r=!0,a=!0,n},"")}function He(e,t,n,r){var a=vk.id,i=e.attaches[0],o=i.initiatorId,s=i.state,c=a===o,u=Boolean(e.kludges.attach1_call_video),l=e.kludges.attach1_call_participants&&JSON.parse(e.kludges.attach1_call_participants)||{},d="group_call"===e.kludges.attach1_kind,_={title:"",description:"",modifier:""},f=u?getLang("mail_call_snippet_outgoing_video"):getLang("mail_call_snippet_outgoing"),h=u?getLang("mail_call_snippet_incoming_video"):getLang("mail_call_snippet_incoming");switch(s){case"reached":var p=t?"":Be(i.duration);_.title=c?f:h,_.description=`${getLang("mail_call_snippet_finished")} · ${p}`;break;case"canceled_by_initiator":_=c?{title:f,description:getLang("mail_call_snippet_canceled")}:{title:h,description:getLang("mail_call_snippet_missed")};break;case"canceled_by_receiver":if(c){if(t)return getLang("mail_call_declined");_={title:f,description:getLang("mail_call_snippet_declined")}}else _={title:h,description:getLang("mail_call_snippet_canceled")};break;default:_.title=getLang("mail_added_call")}d&&(_.title=getLang("mail_call_snippet_group"));var g=Object.keys(l);return _.user_list=Ue(r,g),_.button="",_.classes="im-mess--call-snippet CallSnippet--interactive _im-call-snippet",_.attributes=`data-participants="${g.join(",")}"`,_}function Ue(e,t){if(!t.length)return"";var n=t.slice(0,3).reduce((t,n)=>{var r=Object(w.oCacheGet)(e,n);return r&&(t+=Object(S.getTemplate)("sImCallUser",{url:r.photo,name:r.name})),t},"");return Object(S.getTemplate)("sImCallUsers",{users:n})}function Ge(e,t,n){!(arguments.length>3&&void 0!==arguments[3])||arguments[3];var r=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],a=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],i=Date.now()-1e3*t.date>1e3,c=e.tabs[t.peerId];if(!n||geByClass1("_im_mess",n)||geByClass1("_im_bar_date",n)||(n.innerHTML=""),c.skipped>0)return n;var u=[];t.local||(u=e.imQueue(t.peerId,r)),u.length>0&&Ot(u.map(e=>geByClass1("_im_mess_rid"+e.rid,n),n).filter(e=>e));var d=Re(e,t),_=domLC(n);hasClass(_,"_im_mess_stack")||(_=domClosestSibling(_,"._im_mess_stack",-1));for(var f=Object(o.getLastMessage)(e,t.peerId,t.messageId);t.peerId===e.peer&&f&&!geByClass1("_im_mess_"+f.messageId);)f=Object(o.getLastMessage)(e,t.peerId,f.messageId);var h=geByClass1("_im_unread_bar_row",n),g=f?nt(f.date,e):0,m=Object(l.isChatPeer)(t.peerId)&&Object(o.isCasperChat)(e,t.peerId);if(!f||rt(c,f,t,e,a)){var b="",v=!1;if(h&&Object(s.isOut)(t)&&fn(e,n,t.peerId),1===c.unread&&!Object(s.isOut)(t)&&a&&(b+=Object(S.getTemplate)("im_mess_bar",{}),v=!0,fn(e,n,t.peerId)),!Object(p.isToday)(new Date(g))&&!m){var C=new Date,E=v?"im-page--history-new-bar_hide _im_invisible_bar":"";b+=Object(S.getTemplate)("im_day_bar",{day:getShortDate(t.date,e.timeshift,!0,getLang("months_of","raw"),!0),date:t.date,day_class:C.getDate()+C.getMonth()+C.getFullYear()+" "+E})}if(Object(s.isServiceMsg)(t))b+=Object(S.getTemplate)("im_service_row",{text:Lt(e,t,c),type:"",date:t.date,from_id:"",message_id:t.messageId});else{var y=lr(e,t);b+=Object(S.getTemplate)("im_mess_stack",Object.assign(y,{messages:d}))}Object(T.toArray)(sech(b)).forEach(e=>n&&n.appendChild(e))}else h&&e.peer===t.peerId&&!c.inplaceSearch&&Object(s.isOut)(t)&&fn(e,n,t.peerId),geByClass1("_im_stack_messages",_).appendChild(se(d));return Object(s.isOut)(t)&&!i&&setTimeout(()=>{var e=geByClass1("_im_mess_"+t.messageId,n);hasClass(e,B)&&addClass(e,"im-mess_sending")},500),u=u.filter(e=>e.rid!==t.randomId),De(n),qe(u,e,n)}function qe(e,t,n){var r;return(r="object"==typeof e?e:t.imQueue(e,!1)).length>0&&r.map(e=>(e.mess.failed=!!e.failed,e.mess)).filter(e=>Object(o.getMessage)(t,e.peerId,e.messageId)).forEach(e=>Ge(t,e,n,!1)),n}function We(e,t,n){var r=e.tabs[t];return Object(T.toArray)(geByClass("_im_mess_unread",n)).forEach(e=>{var t,n=intval(domData(e,"msgid"));n>0&&r.out_up_to>=n&&(removeClass(e,"_im_mess_unread"),removeClass(e,"im-mess_unread"),(t=geByClass1("_im_mess_blind_unread_marker",e))&&(t.removeAttribute("aria-label"),t.removeAttribute("role"),t.removeAttribute("tabindex")))}),n}function Ke(e,t,n){var r=t.peerId,a=t.messageId,i=geByClass1("_im_msg_reply"+a,e),o=geByClass1("_im_msg_media"+a,e),s=n.tabs[r].mediacontent[a][0];return i&&(i.innerHTML=s[0]),o&&(o.innerHTML=s[1]),e}var ze=0,Ve=1,Ye=2;function $e(e,t){if(!Object(o.isFullyLoadedTab)(t,e.peerId))return ze;var n=t.tabs[e.peerId];return n.msgs[e.messageId]?Ve:n.msgs["rid"+e.randomId]?Ye:ze}function Qe(e){return e<-2e9}function Xe(e){return e>19e8&&e<2e9}function Je(e,t){return e===t.peer}function Ze(e,t){return Object(A.doesChatTabHaveFlag)(Object(o.getTab)(e,t),1024)}function et(e,t){return!!e.tabs[t]}function tt(e,t){return!!et(e,t)&&null!==e.tabs[t].lastmsg}function nt(e,t){return 1e3*e+1e3*t.timeshift}function rt(e,t,n,r,a){if(Object(s.getUserId)(t)!==Object(s.getUserId)(n))return!0;var i=nt(t.date,r),c=nt(n.date,r);if(!isSameDate(i,c))return!0;if(Object(o.isCommunityInterface)(r)&&intval(t.kludges.from_admin)!==intval(n.kludges.from_admin))return!0;if(n.date-t.date>300)return!0;if(Object(s.isServiceMsg)(t)||Object(s.isServiceMsg)(n))return!0;var u=Object(s.isCasperMessage)(t),l=Object(s.isCasperMessage)(n);if(u!==l)return!0;var d=t.kludges.is_expired,_=n.kludges.is_expired;return!(!u||!l||d===_)||(!(!u||!l||d||_)||!(u&&l&&d&&_)&&(!(!Object(s.isCallMessage)(n)&&!Object(s.isCallMessage)(t))||(!(!Object(s.isActiveGroupCallMessage)(n)&&!Object(s.isActiveGroupCallMessage)(t))||(!(!Object(s.isGift)(t)&&!Object(s.isGift)(n))||(!(!Object(s.isGraffiti)(t)&&!Object(s.isGraffiti)(n))||(!!Object(s.hasReply)(n)||!(Object(s.isUnread)(e,t)===Object(s.isUnread)(e,n)||!a||Object(s.isOut)(n)||Ft(n.peerId,r.gid))))))))}function at(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=arguments.length>4&&void 0!==arguments[4]&&arguments[4],i=Math.round(1e9*Math.random()).toString(16),s={},u=0;return t=(t=Object(c.replaceHyperLinks)(t||"",c.linksReplacer.bind(null,r))).replace(/(<a.+?<\/a>)/gi,e=>{var t=`!link_${u}_${i}!`;return s[t]=e,u++,t}),t=Object(c.replaceMentions)(t),e.isMassMentionsMessageAllowed&&(t=Object(c.replaceMassMentions)(t)),t=Object(c.replaceEmailLinks)(t),t=Object(c.replaceHashtags)(t,t=>{var n=Object(o.getGroupId)(e);return`<a href="/${n?"gim"+n:"im"}?sel=${a||Object(o.getPeer)(e)}&st=${encodeURIComponent(t)}">${t}</a>`}),Object.keys(s).forEach(e=>{t=t.replace(e,()=>s[e])}),n.emoji&&(t=Emoji.emojiToHTML(t,!0)),t}function it(e){return Object(l.isChatPeer)(e)?"c"+(e-2e9):Qe(e)?"e"+Math.abs(e+2e9):Xe(e)?"mr"+(e-19e8):e}function ot(e){switch(e.substr(0,1)){case"e":return-2e9-intval(e.substr(1));case"c":return 2e9+intval(e.substr(1));default:return intval(e)}}function st(e){return e>9999999?Math.floor(e/1e6)+"M":e>9999?Math.floor(e/1e3)+"K":e>0?e.toString():""}function ct(e,t){return{[m.CHAT_ACTION_SEARCH]:{name:getLang("mail_im_peer_search"),icon:"search"},[m.CHAT_ACTION_BLOCK_COMMUNITY]:{icon:"block",name:getLang("mail_block_comm_messages")},[m.CHAT_ACTION_BLOCK_NOTIFY]:{icon:"block",name:getLang("mail_block_notify_messages")},[m.CHAT_ACTION_ALLOW_COMMUNITY]:{icon:"unblock",name:getLang("mail_allow_comm_messages")},[m.CHAT_ACTION_CLEAR]:{name:Qe(e.peer)?getLang("mail_im_delete_email_contact"):getLang("mail_im_delete_all_history"),icon:"clear"},[m.CHAT_ACTION_MUTE]:{name:getLang("mail_im_mute"),icon:"mute"},[m.CHAT_ACTION_UNMUTE]:{name:getLang("mail_im_unmute"),icon:"unmute"},[m.CHAT_ACTION_MEDIA]:{name:Object(o.isCommunityInterface)(e)?getLang("mail_im_show_media_history_group"):getLang("mail_im_show_media_history"),icon:"media"},[m.CHAT_ACTION_BLOCK]:{icon:"block",name:getLang("mail_block_user")},[m.CHAT_ACTION_INVITE]:{icon:"invite",name:getLang("mail_im_create_chat_with")},[m.CHAT_ACTION_LEAVE]:{icon:"leave",name:t?getLang("mail_leave_channel"):getLang("mail_leave_chat")},[m.CHAT_ACTION_RETURN]:{icon:"return",name:t?getLang("mail_return_to_vkcomgroup"):getLang("mail_return_to_chat")},[m.CHAT_ACTION_PIN_HIDE]:{icon:"pin_hide",name:getLang("mail_menu_pin_hide")},[m.CHAT_ACTION_PIN_UNHIDE]:{icon:"pin_unhide",name:getLang("mail_menu_pin_show")},[m.CHAT_ACTION_UNPIN]:{icon:"unpin",name:getLang("mail_menu_unpin")},[m.CHAT_ACTION_SETTINGS]:{icon:"settings",name:t?getLang("mail_vkcomgroup_settings"):getLang("mail_settings")},[m.CHAT_ACTION_CALL_AUDIO]:{icon:"call_audio",name:getLang("mail_im_call_audio")},[m.CHAT_ACTION_CALL_VIDEO]:{icon:"call_video",name:getLang("mail_im_call_video")},[m.CHAT_ACTION_UNREAD]:{icon:"unread",name:getLang("mail_menu_mark_unread")}}}function ut(e,t){var n=`<img src="${e}" alt="" class="dialogs_inline_chatter dialogs_inline_chatter_half"/>`;return t&&(n=Object(S.getTemplate)("im_dialogs_link",{href:t,photo:n})),`<div class="im_grid">\n    <div class="dialogs_inline_chatter dialogs_inline_chatter_half">\n      ${n}\n    </div>\n  </div>`}function lt(e,t){var n=`<img src="${e}" alt="" class="dialogs_inline_chatter"/>`;return t&&(n=Object(S.getTemplate)("im_dialogs_link",{href:t,photo:n})),`<div class="im_grid">\n    <div class="dialogs_inline_chatter">\n      ${n}\n    </div>\n  </div>`}function dt(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];if("string"==typeof e)return`<div class="im_grid"><img src="${e}" alt=""/></div>`;switch(e.length){case 1:return`<div class="im_grid"><img src="${e[0]}" alt=""/></div>`;case 2:return e.map((e,n)=>ut(e,t[n])).join("");case 3:return ut(e[0],t[0])+e.slice(1).map((e,n)=>lt(e,t[n+1])).join("");case 4:return e.map((e,n)=>lt(e,t[n])).join("")}}function _t(e,t,n){if(Xe(t.peerId))return`<div class="nim-peer--contact-avatar nim-peer--contact-avatar_30">${Se(t.tab)}</div>`;if("string"==typeof t.photo&&t.photo)return`<div class="im_grid"><img src="${t.photo}" alt=""></div>`;if(Object(l.isChatPeer)(t.peerId)&&t.membersCount<2)return`<div class="im_grid"><img src="${e.get().default_chat_photo}" alt=""></div>`;if(Array.isArray(t.photo))return dt(t.photo);var r=t.data.active.slice(0,4).map(w.oCacheGet.bind(null,e)).filter(e=>!!e);return dt(r.map(e=>e.photo),n?[]:r.map(e=>e.link))}function ft(e){var t=e.get().gid?getLang("mail_search_only_messages_comm"):getLang("mail_search_only_messages");return`<li class="im-page--mess-search-w">\n    <div class="im-page--mess-search ${ge}">\n      <button type="button" class="im-i--messages-search"></button>${t}\n    </div>\n  </li>`}function ht(){return`<li class="im-search-results-head">${getLang("mail_search_messages")}</li>`}function pt(){return`<li class="im-search-results-head">${getLang("mail_search_conversations_sep")}</li>`}function gt(){return`<li class="im-search-results-head">${getLang("mail_search_dialogs_sep")}</li>`}function mt(){return`<li class="im-search-results-head _im_recent_bar">\n    ${getLang("mail_recent_searches")}\n    <button type="button" class="${he} im-page--clear-recent">${getLang("mail_clear_recent")}</button>\n  </li>`}function bt(e){var t=e.get().popular_sugg,n=Object(o.isClassicInterface)(e)?8:5;return t.length>n&&(t=t.slice(0,n)),'<li class="im-popular clear_fix">'+t.map(t=>{var n=t.peerId,r=Object(w.oCacheGet)(e,n)||t,a=e.get().tabs[n]||t,i=(e.get().mutedPeers||[]).indexOf(n)>=0;return`<div class="${["im-popular--item","fl_l","_im_dialog","_dont_add_recent","_im_sugg_"+n,a.unread>0&&"sugg-is_unread",i&&"sugg-is_muted"].filter(e=>!!e).join(" ")}" data-peer="${n}">\n    <a class="im-popular--avatar-w ${onlinePlatformClass(a.online)}" href="${r.link}"><img class="im-popular--avatar" src="${r.photo}"/></a>\n    <div class="im-popular--name-w"><a class="im-popular--name" href="${r.link}">${r.first_name||r.name}</a></div>\n    <span class="im-popular--unread _sugg_unread_ct">${st(a.unread)}</span>\n</div>`}).join("")+"</li>"}function vt(e,t,n){var r=geByClass1("_im_mess_"+t.messageId,n);if(r){attr(r,"aria-hidden","false"),addClass(r,"im-mess_failed "+H);var a=geByClass1("_im_mess_marker",r);attr(a,"aria-label",getLang("mail_send_message_error")),attr(a,"role","link")}return n}function Ct(e,t,n){var r=geByClass1("_im_mess_"+t,n);if(r){removeClass(r,"im-mess_failed"),attr(r,"aria-hidden","true"),removeClass(r,H);var a=geByClass1("_im_mess_marker",r);attr(a,"aria-label",""),attr(a,"role","")}return n}function Et(e,t){return Ot(e.map(e=>geByClass1("_im_mess_"+e,t)).filter(e=>e),t)}function yt(e,t){var n=t||document,r=[];return e.forEach(e=>{var t=n.querySelector("._im_expired_message_"+e);if(t){var a=+t.dataset.count;if(t.dataset.count=a-1,t.classList.remove("_im_expired_message_"+e),1===a)(!domNS(t)||hasClass(domNS(t),"_im_bar_date"))&&(hasClass(domPS(t),"_im_bar_date")&&re(domPS(t)),hasClass(domPS(t),"_im_unread_bar_row")&&re(domPS(t))),re(t);else r.includes(t)||r.push(t)}}),r.length&&r.forEach(e=>{var t=+e.dataset.count;if(t>0){var n=cr(t),r=se(n);r.classList.add(...e.classList),e.replaceWith(r)}}),t}function Ot(e,t){var n=e.filter(e=>!hasClass(e,"im-mess_srv")).map(e=>e.parentNode);return e.forEach(e=>{hasClass(e,"im-mess_srv")?e.parentNode.parentNode.removeChild(e.parentNode):e.parentNode&&e.parentNode.removeChild(e)}),n.filter(e=>0===domChildren(e).length).map(e=>gpeByClass("_im_mess_stack",e)).forEach(e=>{hasClass(domPS(e),"_im_bar_date")&&re(domPS(e)),hasClass(domPS(e),"_im_unread_bar_row")&&re(domPS(e)),re(e)}),t}function Tt(e){for(var t=e;t;){var n=t;if(null===(t=t.previousElementSibling)){hasClass(n,"mess_srv")&&(t=n.parentNode);var r=gpeByClass("_im_mess_stack",n);r&&(t=r.previousElementSibling,1===domChildren(n.parentNode).length&&r.parentNode.removeChild(r))}hasClass(n,"_im_unread_bar_row")||n.parentNode.removeChild(n)}}function wt(e,t,n,r){return e.map(e=>geByClass1("_im_mess_"+e,r)).filter(e=>e).forEach(e=>{val(e,function(e,t,n){var r=t.innerHTML;return`<div class="im-mess--text">\n    ${getLang("delete"===n?"mail_deleted_stop":"mail_marked_as_spam")} <button type="button" data-peer="${e}" class="${G} im-mess--btn">${getLang("mail_restore")}</button>\n    <div class="${U} im-mess--original">${r}</div>\n  </div>`}(t,e,n)),addClass(e,"im-mess_light")}),r}function Nt(e,t,n){var r=geByClass1("_im_mess_"+e,n);if(r){var a=geByClass1(U,r);val(r,a.innerHTML),removeClass(r,"im-mess_light")}return n}function It(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0,n=arguments.length>2?arguments[2]:void 0,r=arguments.length>3?arguments[3]:void 0,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:2,i=arguments.length>5&&void 0!==arguments[5]&&arguments[5];if(i)return At(e,t,n,r,!0,a);var o=60,s=At(e,t,n,r,!1,a);return s.length>o?At(e,t,n,r,!0,a):s}function kt(e){var t={[m.ACTIVITY_TYPE_TYPING]:1,[m.ACTIVITY_TYPE_RECORDING_AUDIO]:2},n=Object.keys(e).sort((e,n)=>t[n]-t[e]),r={},a=n.reduce((t,n)=>{var a=(e[n]||{}).userIds;return(void 0===a?[]:a).forEach(e=>{r[e]||(r[e]=!0,t[n]=!0)}),t},{}),i=n.filter(e=>!!a[e]);return i.length>1?"":i[0]}function At(e,t,n,r,a,i){var s=function(e,t,n){var r=[],a={};return Object.keys(t).map(n=>{((t[n]||{}).userIds||[]).forEach(t=>{Object(w.oCacheExists)(e,t)?parseInt(t,10)!==e.id&&(a[t]=n):r.push(t)})}),r.length&&Object(m.loadChatMember)({[n]:r},e),Object.keys(a).sort((e,n)=>t[a[e]].ts-t[a[n]].ts)}(r,e,t);if(0===s.length)return"";var c=Object(l.isUserPeer)(t)||Object(o.isCommunityPeer)(t)?"first_name":a?"short_name":"name",u=kt(e),d="";u===m.ACTIVITY_TYPE_RECORDING_AUDIO?d=getLang("mail_recording_audio_several",s.length):u===m.ACTIVITY_TYPE_TYPING&&(d=getLang("mail_typing_several",s.length));var _=s.slice(0,Math.min(s.length-1,i)),f=_.map(e=>Object(w.oCacheGet)(r,e)[c]).join(", ");if(s.length>i+1){var h=function(e){var t={};return Object.keys(e).forEach(n=>{var r=e[n].userIds;(void 0===r?[]:r).forEach(e=>{t[e]=1})}),Object.keys(t).length}(e);f+=" "+getLang("mail_and_peer").replace("{count}",h-i).replace("{typing}",d)}else{if(s.length>1&&(f+=" "+getLang("mail_and_peer_one")),!Object(l.isChatPeer)(t)&&n)f+=" "+d;else f+=` ${Object(w.oCacheGet)(r,s[_.length])[c]} ${d}`}return f.trim()}function St(){return`<div class="im-page--chat-search-empty">\n    ${getLang("mail_im_search_empty")}\n  </div>`}function jt(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";return n?`<a class="im_srv_lnk ${r}" target="_blank" rel="noopener" href="${e}">${t}</a>`:`<span class="${r}">${t}</span>`}function Lt(e,t,n){var r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],a=t.kludges,i=a.source_act,o=intval(a.source_mid),s=intval(Object(l.isChatPeer)(n.peerId)?a.from:t.userId),c=s===o,u=Object(w.oCacheGet)(e,s),d="";switch(i){case V:d="mail_im_chat_created";break;case Y:d=a.source_is_channel?"mail_im_title_updated_channel":"mail_im_title_updated_dot";break;case $:d=c?"mail_im_returned_to_chat":"mail_im_invited";break;case Q:d=c?"mail_im_left":"mail_im_kicked_from_chat";break;case X:d="mail_im_photo_set";break;case J:d=a.source_is_channel?"mail_im_photo_removed_channel":"mail_im_photo_removed";break;case Z:d=a.source_message?"mail_im_pin_message":"mail_im_pin_message_empty2";break;case ee:d=a.source_message?"mail_im_unpin_message":"mail_im_unpin_message_empty2";break;case te:d="mail_im_invite_by_link";break;case ne:d=Object(T.unpackStore)(e).id===o?"mail_im_chat_own_screenshot":"mail_im_chat_screenshot";break;case ae:d="mail_im_start_group_call";break;case ie:d="mail_im_invited_to_call";break;case oe:d="mail_im_invite_by_call_link";break;case ce:d=u.contact_name?"mail_im_accepted_message_request":"mail_im_accepted_message_request_no_name";break;default:return"mail_no_support"}if(d=(d=(d=langSex(u.sex,getLang(d,"raw"))).replace("{from}",jt(u.link,u.name,r))).replace("{contact}",u.contact_name),o&&!c){var _=a.source_email;if(_)d=d.replace("{user}",jt("/im?email="+encodeURIComponent(_),"email",r));else{var f=Object(w.oCacheGet)(e,o),h=i===Q?f.inv_name:f.kick_name;d=d.replace("{user}",jt(f.link,h,r))}}if(a.source_text){var p=a.source_old_text?`«<b class="im_srv_lnk">${a.source_old_text}</b>» &rarr; `:"";d=d.replace("{title}",p+`«<b class="im_srv_lnk">${a.source_text}</b>»`)}if(a.source_act===Z||a.source_act===ee)if(a.source_message){var g=Pt(Emoji.emojiToHTML(stripHTML(a.source_message.replace(/<br\s?\/?>/gi," ")),!0)),m=jt("",g,!1,"im_srv_mess_link");d=d.replace("{msg}",m)}else d=d.replace(/{link}(.+){\/link}/i,(e,t)=>jt("",t,!1,"im_srv_mess_link"));return d}function Mt(e,t,n,r){if(t===X){var a=geByClass1("_im_mess_"+e.messageId,r);if(a){var i=n.tabs[e.peerId];a.parentNode.innerHTML=Object(S.getTemplate)("im_msg_row",{msg_id:e.messageId,from_id:e.peerId,text:Lt(n,e,i)+n.chat_photo_msg,ts:e.date,cls:"im-mess_srv _im_mess_srv"})}}return r}function Pt(e){return e.replace(/&lt;&lt;/g,"&laquo;").replace(/&gt;&gt;/g,"&raquo;").replace(/ \-\-/g," &mdash;").replace(/\-\- /g,"&mdash; ").replace(a.MENTION_RAW,"$1$4")}function Ft(e,t){return!t&&e===vk.id}function Rt(e,t){return Object(f.showTooltip)(e,{url:Object(o.isCommunityPeer)(t)?"al_groups.php":"al_profile.php",params:{act:"verified_tt",mid:t,gid:t},slide:15,ajxdt:200,showdt:200,hidedt:200,dir:"auto",shift:[94,7,7],className:"verified_tt"})}function xt(e){return function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"bottom",r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",a=se(Object(S.getTemplate)("im_preloader",{preloader:rs(vk.pr_tpl,{id:""}),cls:["bottom"===n?"im-preloader_bottom":"im-preloader_top",r].join(" ")})),i=!1;function o(){i=!0,removeClass(a,"im-preloader_visible"),a.parentNode&&a.parentNode.removeChild(a)}setTimeout(()=>{i||("bottom"===n?e.appendChild(a):e.insertBefore(a,domFC(e)),addClass(a,"im-preloader_visible"))},0),t.then(o).catch(e=>{Object(k.imWeirdCatch)("wrapLoading",e),o()})}}function Dt(e,t){return{0:{msgs:e.reduce((e,t)=>(e[t]=[t,r.FLAG_IMPORTANT,0,0,"",{},{},0,0,0],e),{}),hash:t,history:1}}}function Bt(e,t){if(!t&&!e)return!1;var n=e.target||e.srcElement,r=8,a=!1,i=/_im_mess|im_log_act|im_log_ract|_im_log_body|im_log_rspacer|_im_graffiti_w|_wall_post_cont/;do{if(!n||n.onclick||n.onmousedown||"A"==n.tagName||hasClass(n,"_im_no_select")||hasClass(n,"im_msg_media_link")||"IMG"==n.tagName&&!hasClass(n,"_im_graffiti")&&!hasClass(n,"emoji")&&!hasClass(n,"emoji_css")&&!hasClass(n,"im_gift")||"TEXTAREA"==n.tagName||hasClass(n,"play_new")||hasClass(n,"videoplayer")||(a=i.test(n.className)))break}while(r--&&(n=n.parentNode));return!a||!!trim((window.getSelection&&window.getSelection()||document.getSelection&&document.getSelection()||"").toString())}function Ht(e,t){return`<div class="im-mess--text">\n      <span>${getLang("mail_restored")}</span>\n      <a class="_im_go_to" href="/im?sel=${it(e)}&msgid=${t}">${getLang("mail_im_goto_conversation")}</a>\n    </div>`}function Ut(e,t,n){var r=getLang("mail_deleteall1"),a=getLang("mail_sure_to_delete_all"),i=getLang("mail_delete");return Object(l.isChatPeer)(t)&&(Object(A.doesChatTabHaveFlag)(e,1024)?(r=getLang("mail_leave_channel"),a=getLang("mail_unfollow_channel_confirmation"),i=getLang("mail_unfollow_channel")):a=getLang("mail_chat_sure_to_delete_all")),Object(o.isCommunityPeer)(t)&&(a=getLang("mail_group_sure_to_delete_all")),Object(h.showFastBox)(r,a,i,n,getLang("global_cancel"))}function Gt(e,t,n){var r=Object(o.getTab)(e,t),a=Object(l.isChatPeer)(t),i=a&&Object(o.isChannelPeer)(r),s=a&&Object(o.tabIsMessageRequestToChat)(r),c=getLang("mail_deleteall1"),u=getLang("mail_sure_to_delete_all"),d=getLang("mail_delete");if(a){if(!Object(o.isChatActive)(r))return Ut(r,t,n.bind(null,!0));i?(c=getLang("mail_leave_channel"),u=getLang("mail_vkcomgroup_leave_confirm"),d=getLang("mail_leave_channel")):s?(c=getLang("mail_reject_mr_confirmation_title"),u=getLang("mail_reject_mr_confirmation_text"),d=getLang("mail_message_request_reject")):(c=getLang("mail_leave_chat"),u=getLang("mail_chat_leave_confirm"),d=getLang("mail_leave_chat"))}Object(o.isCommunityPeer)(t)&&(u=getLang("mail_group_sure_to_delete_all"));var _=new MessageBox({title:c,width:i?450:500}).content(u).setButtons(d,()=>n(!!isChecked(geByClass1("_check_is_delete"))||!a),getLang("global_cancel")).show();return!a||i||s||_.setControlsText(`<div class="checkbox im-delete-forall-checkbox _check_is_delete" onclick="checkbox(this);" role="checkbox" aria-checked="false">${getLang("mail_deleteall1")}</div>`),_}function qt(e){return Object(h.showFastBox)(getLang("mail_unpin_title"),getLang("mail_unpin_text"),getLang("mail_unpin"),e,getLang("global_cancel"))}function Wt(e,t,n,r){var a=getLang("mail_dialog_msg_delete_N",t),i=Object(h.showFastBox)(getLang("mail_dialog_msg_delete_title"),a,getLang("mail_delete"),()=>r(isChecked(geByClass1("_check_forall"))),getLang("global_cancel")),o="",s=!1;return n&&(o=`<div class="checkbox im-delete-forall-checkbox _check_forall" onclick="checkbox(this);" role="checkbox" aria-checked="false">${getLang("mail_delete_for_all")}</div>`,s=cur.imDb.selectByKey("del_forall_checked")),i.setControlsText(o),s&&checkbox(geByClass1("_check_forall")),i}function Kt(e,t,n,r,a){t.showProgress(),e.set(r.bind(null,a)).then(()=>{t.hideProgress(),t.hide(),n().removePeer(e,a),n().updateDialogFilters(e)})}function zt(e,t,n,r){var a=e.get().tabs[t].memberIds;e.set(r.bind(null,"add_member",a)).then(n().showCreation)}function Vt(e,t,n){var r=e.get();if(r.active_tab===a.FOLDER_ALL&&0===r.dialog_tab_cts.mr)return!1;var i=r.active_tab===a.FOLDER_MESSAGE_REQUEST?a.FOLDER_ALL:a.FOLDER_MESSAGE_REQUEST;return e.set(n.bind(null,i)).then(e=>{t().restoreDialogs(e,!0)})}function Yt(e,t,n){if(e.get().active_tab===a.FOLDER_ALL&&0===e.get().unread_cnt)return!1;var r=e.get().active_tab===a.FOLDER_UNREAD?a.FOLDER_ALL:a.FOLDER_UNREAD;return e.set(n.bind(null,r)).then(e=>{t().restoreDialogs(e,!0)})}function $t(e,t,n,r){if(t.get().active_tab===e)return Promise.resolve(t);var a=Object(o.isReversedDialogs)(t);return t.set(r.bind(null,e)).then(e=>(n().restoreDialogs(e,!0,a!==Object(o.isReversedDialogs)(e)),e))}function Qt(e,t){void 0===t&&(t=e.get().peer);var n=e.get().tabs[t];return a.FOLDER_MASKS[a.FOLDER_IMPORTANT]&n.folders}function Xt(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(void 0===t&&(t=e.get().peer),!Object(o.isFoldersAvailable)(e))return!1;var r=n||e.get().tabs[t];return a.FOLDER_MASKS[a.FOLDER_UNRESPOND]&r.folders}function Jt(e,t){return!1===((t.get().block_states||{})[e]||{}).free}function Zt(e){return null!=e.get().pendingForward}function en(e,t){return(t.get().block_states[e]||{}).who===vk.id}function tn(e,t){var n=e.get().block_states;Object.keys(n).forEach(a=>{n[a].time?!1===n[a].free&&Date.now()-n[a].time>=5e4&&t.push([r.mutexEvent([,1,"gim"+e.get().gid,a,0,""])]):n[a].time=Date.now()})}function nn(e,t,n){var r;return!showTabbedBox("al_im.php",{act:"a_spam",offset:"0",gid:e.get().gid},{onDone:(n,a)=>{a&&(r=t(n,e,a))},params:{width:638,onHide:()=>{AudioMessagePlayer.loaded&&AudioMessagePlayer.detachPlayer(!0),r.unmount()}}},n)}function rn(e,t){return an(e.get(),t,Object(o.getTab)(e,t).last_seen)}function an(e,t,n,r){if(n.platform)return getLang("mail_header_online_status")+(n.mobile?on(t,!1,!1,!0):"");if(!n.can_see){var a=Object(w.oCacheGet)(e,t),i=a||e.tabs[t];return function(e,t){var n;switch(e){case"recently":n=getLang("global_online_was_recently","raw");break;case"last_week":n=getLang("global_online_was_week","raw");break;case"last_month":n=getLang("global_online_this_month","raw");break;case"long_ago":n=getLang("global_online_long_ago","raw");break;default:return""}return langSex(t,n)}(n.status,i.sex)}if(!n.time||Date.now()-1e3*n.time>7776e6)return"";var o=getDateText(n.time,e.timeshift),s=langSex(Object(w.oCacheGet)(e,t).sex,getLang("mail_last_activity_tip","raw")).replace("{user}","").replace("{time}",o);return n.mobile&&(s+=on(t,!1,!1,r)),s}function on(e,t,n,r){var a={mid:e};n||(a.was=1),t?a.forcetoup=!0:a.forcetodown=!0,a=Object.assign(a,r);var i=JSON.stringify(a).slice(1,-1).replace(/"/g,"&quot;");return Object(S.getTemplate)("im_wrap_mobile",{class:"im_status_mob_onl",params:i})}function sn(e,t){var n=t.get().tabs[e];return showBox("al_settings.php",{act:"blacklist_box",q:n.href},{stat:[jsc("web/settings.js"),"settings.css"],dark:1})}function cn(e,t){return showBox("groupsedit.php",{act:"bl_edit",name:"/id"+e,gid:t.get().gid},{stat:["page.css","ui_controls.js","ui_controls.css"],dark:1})}function un(e){return e.get().gid?"/gim"+e.get().gid:"/im"}function ln(e,t,n,r){var a;jn(showTabbedBox("al_im.php",{act:"a_important",offset:"0"},{onDone:(r,i)=>{i&&(a=n(r,e,t,i))},params:{width:638,onHide:()=>{AudioMessagePlayer.loaded&&AudioMessagePlayer.detachPlayer(!0)},onDestroy:()=>{a&&a.unmount()}}},r),e)}function dn(){var e=document.activeElement;return null!==e&&("INPUT"===e.tagName||"TEXTAREA"===e.tagName||e.getAttribute("contenteditable"))}function _n(e,t,n){var r=geByClass1("_im_mess_"+e,n);return r&&toggleClass(r,"im-mess_fav",t),n}function fn(e,t,n){var r=geByClass1("_im_unread_bar_row",t);if(!r)return t;var a=domClosestSibling(r,"._im_mess_stack",-1),i=domClosestSibling(r,"._im_mess_stack"),s=a?geByClass("_im_mess",a).pop():null,c=i?geByClass1("_im_mess",i):null;if(re(r),Le(t),!c||!s)return t;var u=domData(c,"msgid"),l=Object(o.getPreviousMessage)(e,n,u),d=Object(o.getMessage)(e,n,u);if(!l||rt(e.tabs[n],l,d,e))return t;var _=geByClass1("_im_stack_messages",a),f=geByClass1("_im_stack_messages",i).children;return Object(T.toArray)(f).forEach(e=>{re(e),_.appendChild(e)}),re(i),t}function hn(e,t,n){var r=Object(o.getFirstUnread)(e,e.get().peer);if(!r)return[!1,0];var a=geByClass1("_im_mess_"+r,t);if(!a){var i=Object(o.getLastMessage)(e,e.get().peer,r);if(!i)return[!0,0];a=geByClass1("_im_mess_"+i.messageId,t)}var s=hasClass(a,"_im_mess_srv")?a:gpeByClass("_im_mess_stack",a);if(!s)return[!0,0];var c=a?a.offsetTop:0,u=s.offsetTop+c,l=n.contHeight();return u<=n.scrollTop()+n.getScrollHeight()?[!0,0]:[!1,Math.max(0,l-u)]}function pn(e,t,n){cancelEvent(t);var r=gpeByClass("_im_top_notice",n);fadeOut(r,200,re.pbind(r));var a=gpeByClass("_im_page_dialogs",r);a&&hasClass(a,"im-page--dialogs-notice")&&removeClass(a,"im-page--dialogs-notice"),ajax.post("al_im.php",{act:"a_hide_top_notice",type:r.getAttribute("data-type"),hash:r.getAttribute("data-hash")})}function gn(e,t,n){cancelEvent(t);var r=gpeByClass("_im_aside_notice",n);slideUp(r,200,re.pbind(r)),ajax.post("al_im.php",{act:"a_hide_top_notice",type:r.getAttribute("data-type"),hash:r.getAttribute("data-hash")})}function mn(e,t){cancelEvent(e);var n=gpeByClass("_im_aside_promo_block",t);slideUp(n,200,re.pbind(n)),ajax.post("al_im.php",{act:"a_hide_promo_block",type:n.getAttribute("data-type"),hash:n.getAttribute("data-hash")})}function bn(e,t){gpeByClass("_im_aside_promo_block",t).classList.add("--action-called"),ajax.post("al_im.php",{act:"a_vkadmin_app_install",hash:domData(t,"hash"),platform:domData(t,"platform")})}function vn(e){return e.length>1?function(e){return[].concat(e).sort((e,t)=>"mail"!==e.type?"mail"===t.type?-1:1:0)}(e):e}function Cn(e,t,n,r,a){if(n=n.replace(/\<br\s*\/?\>(\n)?/gi," ").replace(/[\n\r]/gi," "),n=Object(c.replaceMentions)(n,(e,t,n,r,a)=>a),r&&(n=Emoji.emojiToHTML(n,!0)),t&&"..."!==t.trim()&&!Object(l.isChatPeer)(e)&&(n=Object(S.getTemplate)("im_topic",{topic:t,cls:"im-topic_dialog"})+n),!n&&a.length>0){var i=vn(a);n=Object(S.getTemplate)("im_dialog_media",{name:En(i[0],i)})}return n}function En(e,t){var n={photo:getLang("mail_added_photos","raw"),video:getLang("mail_added_videos","raw"),audio:getLang("mail_added_audios","raw")};switch(e.type){case"mail":var r=e.object?e.object.fwd_count:e.id.split(";").length;return langNumeric(r,getLang("mail_fwd_msgs","raw"),!0);case"photo":case"video":case"audio":var a=t.filter(t=>t.type===e.type).length;return langNumeric(a,n[e.type],!0);case"audio_playlist":return"audio_album"===e.kind?getLang("mail_added_audio_album"):getLang("mail_added_audio_playlist");case"artist":return getLang("mail_added_artist");case"doc":switch(e.kind){case"graffiti":return getLang("mail_added_graffiti");case"audiomsg":return getLang("mail_added_audiomsg");default:return getLang("mail_added_docs")}case"geo":case"map":return getLang("mail_added_geo");case"wall":return getLang("mail_added_wall");case"wall_reply":return getLang("mail_added_wall_reply");case"gift":return getLang("mail_added_gift");case"link":case"share":return getLang("mail_added_link");case"sticker":return getLang("mail_added_sticker");case"market":return getLang("mail_added_market_item");case"money_transfer":return getLang("mail_added_money_transfer");case"money_request":return getLang("mail_added_money_request");case"story":return getLang("mail_added_story");case"mask":return getLang("mail_added_mask");case"article":return getLang("mail_added_article");case"call":case"group_call_in_progress":return getLang("mail_added_call");case"poll":return getLang("mail_added_poll");case"podcast":return getLang("mail_added_podcast");default:return getLang("mail_added_"+e.type)}return""}function yn(e){addClass(e,"im-send-btn_loading")}function On(e){removeClass(e,"im-send-btn_loading")}function Tn(e){var t=e.get(),n=Object(o.getPinnedMessage)(e);if(!n||!Object(N.isPinnedMessageVisibleInTab)(e,Object(o.getPeer)(e)))return"";var r=Object(w.oCacheGet)(e,n.userId);if(!r)return"";var a=wn(e,n);if(!a)if(!(a=n.text)&&n.attaches.length){var i=vn(n.attaches);a=Object(S.getTemplate)("im_pinned_message_media",{text:En(i[0],i)})}else a=at(e,a,n&&n.kludges||{})||"";return a=a.replace(/<br\s?\/?>/gi," "),Object(S.getTemplate)("im_pinned_message",{date:getSmDate(n.date,t.timeshift),content:a,link:r.link,name:r.name})}function wn(e,t){var n="";if(t&&Object(s.isMoneyRequest)(t)&&void 0!==t.kludges.attach1_tr_amount){var r="%s "+t.kludges.attach1_currency;if("RUB"===t.kludges.attach1_currency&&(r=getLang("mail_money_amount_rub","raw")),t.kludges.attach1_total_amount){var a=langNumeric(t.kludges.attach1_tr_amount/1e3,"%s",!0),i=langNumeric(t.kludges.attach1_total_amount/1e3,r,!0);n=getLang("mail_money_request_collected_amount_from").replace("{amount}",a).replace("{total_amount}",i)}else{var o=langNumeric(t.kludges.attach1_tr_amount/1e3,r,!0);n=getLang("mail_money_request_collected_amount").replace("{amount}",o)}if(intval(t.kludges.attach1_held_amount)){var c=langNumeric(t.kludges.attach1_held_amount/1e3,r,!0);n+=" "+getLang("mail_money_request_held_amount").replace("{amount}",c)}t.text&&(n+='<span class="divider"></span>'+at(e,t.text,t.kludges)),t.kludges.attach1_total_amount&&(n+=Object(S.getTemplate)("im_pinned_message_media_bar",{percent:Math.min(100,Math.floor(t.kludges.attach1_tr_amount/t.kludges.attach1_total_amount*100))}))}return n}function Nn(e,t,n){var r=n.getAttribute("data-info");r&&Object(f.showTooltip)(n,{text:r,className:"_im_history_tooltip",appendParentCls:"_im_mess_stack",black:1,hidedt:1e3,shift:[0,4]})}function In(e,t,n){var r=+n.getAttribute("data-time");r&&Object(f.showTooltip)(n,{text:getLang("mail_message_edited")+" "+getSmDate(r,e.get().timeshift),className:"_im_history_tooltip",appendParentCls:"_im_mess_stack",black:1,shift:[0,4]})}function kn(e,t,n){var r=n.target,a=r.closest("."+K),i=a.querySelector("."+z);if(i){var o,s=Number(i.getAttribute("data-msgid")),c=L.casperMessagesStore.getExpireTime(s),u="_im_bomb_tooltip_"+Math.round(1e4*Math.random()).toString(16);if(window.tooltips){var l=t.querySelectorAll(".im-mess-stack--bomb");Array.from(l).forEach(e=>{e!==r&&tooltips.hide(e,{fasthide:!0})})}var d=An(e);Object(f.showTooltip)(r,{text:h(formatTime(c)),className:"_im_history_tooltip "+u,appendParentCls:K,black:1,shift:[12,4],onShowStart:_,onShowEnd(){o=setTimeout(_,500)},onHide(){clearTimeout(o)},force:!0,toup:r.getBoundingClientRect().top>d+37,hasover:!0}),setTimeout(_,500)}function _(){var e=a.querySelector(`.${u} .tt_text`);e&&(e.innerHTML=h(formatTime(L.casperMessagesStore.getExpireTime(s)))),o=setTimeout(_,500)}function h(e){return`<div class="wrapped">${e}</div>`}}function An(e){var t=Object(o.getPeer)(e),n=Object(o.getTab)(e,t),r=Object(N.isPinnedMessageVisibleInTab)(e,Object(o.getPeer)(e))||n&&n.top_banner,a=Object(M.getPeerProfileHeight)();return 105+(r?Sn(e):0)+a}function Sn(e){var t=Object(o.getPinnedMessage)(e);return t&&Object(s.isMoneyRequest)(t)?62:52}function jn(e,t){e.bodyNode.addEventListener("mouseover",e=>{hasClass(e.target,"_im_edit_time")?In(t,0,e.target):hasClass(e.target,"_im_page_info")&&Nn(0,0,e.target)})}function Ln(e,t,n,r,a){var i,o=e.get();jn(showTabbedBox("al_im.php",{act:"a_get_pinned_message_box",chat:n,gid:e.get().gid,hash:o.tabs[n].hash},{onDone:(n,a)=>{a&&(i=r(n,e,t,a))},params:{width:638,onHide:()=>{AudioMessagePlayer.loaded&&AudioMessagePlayer.detachPlayer(!0)},onDestroy:()=>{i&&i.unmount()}}},a),e)}function Mn(e,t,n){var r=e.get();jn(showTabbedBox("al_im.php",{act:"a_get_replied_message_box",chat:r.peer,msgid:t,gid:r.gid,hash:r.tabs[r.peer].hash},{onDone:(e,t)=>{},params:{width:638,onHide:()=>{AudioMessagePlayer.loaded&&AudioMessagePlayer.detachPlayer(!0)},onDestroy:()=>{}}},n),e)}function Pn(e,t){return!(!Object(l.isChatPeer)(e.peerId)||!e.memberIds)&&e.memberIds.indexOf(t)>=0}function Fn(e){return!Object(l.isChatPeer)(e.peerId)||e.data.kicked?0:e.membersCount}function Rn(e,t){var n=Object(w.oCacheGet)(e,t.peerId),r=Object(o.getTab)(e,t.peerId)||{};return n&&(t.photo=t.photo||n.photo,t.name=t.name||n.name,t.href=t.link||n.link,t.sex=t.sex||n.sex),t.last_touched=r.last_touched||0,t.verified=!!t.verified,t.lastmsg=t.lastmsg||t.lastmsg_meta&&t.lastmsg_meta[0]||!1,t.folders=t.folders||null,t.unread=t.unread||0,t.last_seen=t.last_seen||{platform:0,time:0,mobile:0,can_see:0},t.online=t.last_seen&&t.last_seen.platform||0,t.out_up_to=null!=t.out_up_to?t.out_up_to:t.in_up_to||0,Object(l.isChatPeer)(t.peerId)&&(t.memberIds=t.memberIds||r.memberIds||null),t}function xn(e,t){for(var n in t)t.hasOwnProperty(n)&&Rn(e,t[n])}function Dn(e,t){var n=[],r=t.find(e=>"mail"===e[0]),a=r?r[1].split(";"):[];for(a.length>100&&(r[1]=a.slice(0,100).join(";"));e.length>4096;){var i=e.substr(0,4096).lastIndexOf(" ");-1==i&&(i=4096),n.push({msgText:trim(e.substr(0,i))}),e=trim(e.substr(i))}for(e.length&&n.push({msgText:e,attaches:t}),n.length||n.push({attaches:t}),a=a.slice(100);a.length;a=a.slice(100))n.push({attaches:[["mail",a.slice(0,100).join(";")]]});return n}function Bn(e){return e.length>4096}function Hn(e,t,n){var r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,i=Object.assign(Un(t,r),{act:"a_chat_preview"}),o=!1;showBox("al_im.php",i,{stat:["boxes.css"],params:{dark:1,hideButtons:!0,onHide(){e.set(n),o&&o.unmount()}},onFail:e=>(setTimeout(()=>Object(h.showFastBox)(getLang("global_error"),e),0),!0),onDone(t){o=y(t.bodyNode,e,a)}},{})}function Un(e,t){return t?{chat_id:e.invite_chat_id,hash:e.invite_hash,link:e.invite_link}:e}function Gn(){Object(h.showFastBox)(getLang("global_error"),getLang("mail_message_wait_until_uploaded"))}function qn(e,t){var n=Object(o.getTab)(e,t.peerId)||{},r=e.get(),a=Object(l.isChatPeer)(t.peerId)&&Object(A.isUserAdminInChat)(n,r.id),i=Object(l.isChatPeer)(t.peerId)&&Object(A.isUserAdminInChat)(n,t.userId);if(!t)return!1;if(!Object(s.isOut)(t)&&(!a||i))return!1;if(333==t.peerId)return!1;if(Date.now()/1e3-t.date>86400)return!1;if(Oe(e,t.peerId,t.messageId))return!1;if(Object(l.isChatPeer)(t.peerId)){if(!Object(o.isChatActive)(n))return!1}else if(n.block_error>0)return!1;return!0}function Wn(e,t){var n=Object(o.getTab)(e,t),r=-1!==n.memberIds.indexOf(n.ownerId),a=r?[n.ownerId]:[];return(a=a.concat(n.memberIds.filter(t=>t!==n.ownerId&&Object(w.oCacheExists)(e,t)).slice(0,r?4:5))).map(t=>Object(w.oCacheGet)(e,t))}function Kn(e,t){return t.map(t=>Object(w.oCacheGet)(e,t))}function zn(e,t){return Object(o.getTab)(e,t).memberIds.reduce((t,n)=>{var r=Object(w.oCacheGet)(e,n);return t[r.id]=r,t},{})}function Vn(e,t){if("number"!=typeof e||0===e)return"";var n,r=[[31536e3,t?getLang("global_years_accusative","raw"):getLang("global_age_years","raw")],[2592e3,t?getLang("global_months_accusative","raw"):getLang("global_age_months","raw")],[604800,t?getLang("global_weeks_accusative","raw"):getLang("global_age_weeks","raw")],[86400,t?getLang("global_days_accusative","raw"):getLang("global_age_days","raw")],[3600,t?getLang("global_hours_accusative","raw"):getLang("global_hours","raw")],[60,t?getLang("global_minutes_accusative","raw"):getLang("global_minutes","raw")],[1,t?getLang("global_seconds_accusative","raw"):getLang("global_age_seconds","raw")]],a=e,i=[];if(r.forEach(e=>{var t=x(e,2),n=t[0],r=t[1],o=Math.floor(a/n);a%=n,o>=1&&i.push(langNumeric(o,r))}),1===(n=i.length))return i.pop();var o=i.slice(0,n-1).join(", "),s=i.pop();return getLang("global_and").replace(/{before}/gi,o).replace(/{after}/gi,s)}function Yn(e,t,n,a){a&&!Oe(e,n,a)&&(Object(o.getMessage)(e,n,a)?(e.setState({msgid:a}),Object(i.updateLocation)({msgid:a}),t()):e.get().longpoll.push([r.changePeer(n,a)]))}function $n(e){var t=geByClass1("im-mess_is_editing");if(!t)return null;var n=e.get().tabs[e.get().peer],r=Object(o.parserMessage)(n.msgs[domData(t,"msgid")]);return r&&r.peerId==e.get().peer?r:null}function Qn(e,t){if(Object(o.isClassicInterface)(e)){var n=document.getElementById("ui_rmenu_mr");n&&(Object(o.existsIncomingMessageRequest)(e)?n.classList.remove("unshown"):n.classList.add("unshown"))}else t(e)}function Xn(e){var t=Object(T.unpackStore)(e),n=Number(t.dialog_tab_cts[a.FOLDER_MESSAGE_REQUEST]),r=n>0?n:"",i=document.querySelector('._im_right_menu_counter[data-tab="mr"]');i&&(i.innerHTML=r)}function Jn(){for(var e=curBox();e;)e.hide(),e=curBox()}function Zn(e,t){return getLang("mail_invitation_sended_ago").replace("{when}",getDateText(e,t))}function er(e,t){var n=Object(o.getPeer)(e),r=Object(o.getMessage)(e,n,t);return Object(A.canPinOrUnpin)(e,n)&&!Object(s.hasPrivateStory)(r)&&!Object(s.isCasperMessage)(r)}function tr(e,t){var n=Object(o.getPeer)(e);return!t.find(t=>{var r=Object(o.getMessage)(e,n,t);return Object(s.hasPrivateStory)(r)||Object(s.isCasperMessage)(r)})}function nr(e,t){var n=Object(o.getPeer)(e);return!t.find(t=>{var r=Object(o.getMessage)(e,n,t);return Object(s.isCasperMessage)(r)})}function rr(e,t){var n=L.casperMessagesStore.isProcessed(e.messageId),r=L.casperMessagesStore.has(e.messageId),a=L.casperMessagesStore.getExpireTime(e.messageId)>L.MAX_DEVIATION;(!r&&!n||r&&a)&&t(e),r&&a&&L.casperMessagesStore.remove(e.messageId)}function ar(e){return e===vk.id}function ir(e,t){return Object(l.isUserPeer)(t)&&!ar(t)&&!Object(o.isCommunityInterface)(e)&&!Xe(t)}function or(e,t){var n=e.get(),r=Object(o.isCommunityInterface)(e);return Object(l.isUserPeer)(t)&&!ar(t)&&!r&&!inArray(t,n.moneyTransferExcept)&&!Xe(t)||Object(o.isCommunityPeer)(t)&&n.moneyTransferCommAvail&&Object(o.getCurrentTab)(e).moneyTransferAvail&&!r||r&&n.moneyRequestAvail&&!Object(l.isChatPeer)(t)||Object(l.isChatPeer)(t)&&Object(o.getCurrentTab)(e).moneyRequestAvail&&!Object(o.isCasperChat)(e,t)}function sr(e,t,n){var r=geByClass1("_im_mess_"+n.messageId,t),a=r&&r.closest("._im_mess_stack");if(!r||!a)return t;var i,o,s,c=Array.from(a.querySelectorAll("._im_mess")),u=x((o=(i=a).previousElementSibling,s=i.nextElementSibling,[o&&1===o.nodeType?o:null,s&&1===s.nodeType?s:null]),2),l=u[0],d=u[1],_=l&&l.classList.contains("im-expired-message"),f=d&&d.classList.contains("im-expired-message"),h=_&&0===c.findIndex(e=>+e.getAttribute("data-msgid")===n.messageId),p=f&&c.findIndex(e=>+e.getAttribute("data-msgid")===n.messageId)===c.length-1,g=cr((h?+l.getAttribute("data-count"):0)+(p?+d.getAttribute("data-count"):0)+1,"_im_expired_message_"+n.messageId),m=se(g);if(h&&(m.classList.add(...l.classList),l.remove()),p&&(m.classList.add(...d.classList),d.remove()),1===c.length)a.replaceWith(m);else{var b=x(c.reduce((e,t)=>{var r=+t.getAttribute("data-msgid");return r<n.messageId&&e[0].push(t),r>n.messageId&&e[1].push(t),e},[[],[]]),2),v=b[0],C=b[1];a.replaceWith(se(ur(e,v))||"",m,se(ur(e,C))||"")}return t}function cr(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return Object(S.getTemplate)("sImExpiredMessagePlaceholder",{text:langNumeric(e,getLang("mail_messages_expired","raw")).replace("{count}",e),count:e,id_classes:Object(d.classNames)(t)})}function ur(e,t){if(0===t.length)return"";var n=+t[0].getAttribute("data-peer"),r=+t[0].getAttribute("data-msgid"),a=Object(o.getMessage)(e,n,r);return Object(S.getTemplate)("im_mess_stack",Object.assign(lr(e,a),{messages:t.reduce((e,t)=>e+t.outerHTML,"")}))}function lr(e,t){var n=Object(T.unpackStore)(e),r=t.peerId,a=t.messageId,i=Object(o.getTab)(e,r),c=Object(s.getUserId)(t),u=Object(s.getAdminId)(e,t),_=Object(w.oCacheGet)(n,u?-n.gid:c)||i,f=Object(l.isChatPeer)(r)?_.name:_.first_name,h=_.link||i.href,p=Object(l.isChatPeer)(r)&&_.image_status?_.image_status:"",g=Object(S.getTemplate)("im_mess_stack_name",{name:f+p,link:h,class:Object(s.isMoney)(t)?" im-mess-stack--lnk-money-transfer":""});if(Object(s.isGift)(t)&&(g+=Object(S.getTemplate)("sImGiftLabel",{content:langSex(_.sex||0,getLang("mail_gift_message_sent","raw"))})),Object(s.isMoney)(t)){var m=Object(s.isMoneyRequest)(t)?getLang("mail_money_request_message_sent","raw"):getLang("mail_money_tranfer_message_sent","raw");g+=Object(S.getTemplate)("sImMoneyTransferLabel",{content:langSex(_.sex||0,m)})}var b=function(e,t){var n=Object(T.unpackStore)(e),r=t.peerId,a=t.messageId,i=Object(l.isChatPeer)(r)&&Object(o.isCasperChat)(n,r),c=Object(s.getAdminId)(e,t),u=Object(o.isCommunityInterface)(e)?"/gim"+n.gid:"/im",_=i?"":Object(S.getTemplate)("im_stack_date",{date:(f=t.date,h=n.timeshift,langDate(1e3*f,"{hour}:{minute} {am_pm}",1e3*h,[],!0)),link:`${u}?sel=${r}&msgid=${a}`});var f,h;if(c&&n.admins[c]){var p=n.admins[c],g=c===vk.id?getLang("mail_by_you"):p[0];_+=" "+Object(S.getTemplate)("im_admin_link",{name:g,href:p[1]})}return _+function(e,t){if(!Object(s.isCasperMessage)(t))return"";var n=x(L.casperMessagesStore.getTimings(t.messageId),3),r=n[0],a=n[1],i=n[2],c=Math.max(r+a-i,0);return Object(S.getTemplate)("sImBomb",{classnames:Object(d.classNames)({"im-mess-stack--bomb_hidden":Object(o.isCasperChat)(e,t.peerId),"im-mess-stack--bomb_expiring":c<=L.EXPIRING_TIME,"im-mess-stack--bomb_expiring-soon":c<=L.EXPIRING_SOON_TIME})})}(n,t)}(e,t);return{photo:_.photo,href:h,cls:"",date_attr:"",link:`/im?sel=${r}&msgid=${a}`,name:stripHTML(g),stack_name:g,peerId:c,messageMeta:b,admin:u}}function dr(e,t){var n=`._im_replied_message[data-msgid="${t.messageId}"] .im-replied--text`;Array.from(e.querySelectorAll(n)).forEach(e=>{e.innerHTML=Object(S.getTemplate)("im_dialog_media",{name:getLang("mail_expired_message")})})}function _r(e){return Object(l.isChatPeer)(e.peerId)&&e.membersCount?langNumeric(e.membersCount,getLang("mail_im_n_chat_members","raw")):""}var fr=O.CallStatSource.CONVO_SNIPPET,hr=O.CallStatSource.CONVO_HEADER,pr=O.CallStatSource.CONVO_LIST,gr=O.CallStatSource.CONVO_JOIN_SNIPPET,mr=O.CallStatSource.CONVO_JOIN_HEADER,br=O.CallStatSource.CONVO_JOIN_BANNER;function vr(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=arguments.length>3?arguments[3]:void 0,a=arguments.length>4?arguments[4]:void 0;if(window.Calls&&window.Calls.call){if(!t)return void window.Calls.startCall(n,a);var i=Object(l.isChatPeer)(t);if(i){var s=Object(o.getTab)(e,t),c=R({},s,{canAddMembers:Object(A.canInviteUser)(e,t,void 0)});window.Calls.startGroupCall(t,[c],r,n,a)}else{var u=Object(w.oCacheGet)(e,t),d=R({},u,{canAddMembers:!0});window.Calls.call(t,n,[d,[u]],a)}}}function Cr(e){var t=decodeURIComponent(e.target.getAttribute("href")).match(/^\/away\.php\?to=(.+)&(.+)?$/),n=t&&t[1];if(n&&window.Calls&&window.Calls.showJoinPopup)return cancelEvent(e),window.Calls.showJoinPopup(n,O.CallStatSource.LINK_JOIN_SNIPPET)}function Er(e,t){var n=Object(o.getTab)(e,t);return!Object(o.isCommunityInterface)(e)&&!!n.can_start_call}function yr(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=arguments.length>4?arguments[4]:void 0;if(window.Calls&&window.Calls.call){var i=Object(o.getTab)(e,t);if(!Object(o.isChatActive)(i))return;window.Calls.joinCallByLink(t,n,[i],r,a)}}function Or(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0,n=t?"&msgid="+t:"";return`/im?sel=${it(e)}${n}`}},PU8N:function(e,t,n){"use strict";n.r(t),n.d(t,"isMvk",(function(){return a})),n.d(t,"getVideoDuration",(function(){return i})),n.d(t,"getMediaBlob",(function(){return o})),n.d(t,"getBlobType",(function(){return s})),n.d(t,"noop",(function(){return c})),n.d(t,"getAverageRGB",(function(){return u})),n.d(t,"loadImage",(function(){return l})),n.d(t,"loadImages",(function(){return d})),n.d(t,"loadFontFace",(function(){return _})),n.d(t,"loadFontFacePromise",(function(){return f})),n.d(t,"getCroppedImage",(function(){return h}));var r=function(){return(r=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var a in t=arguments[n])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e}).apply(this,arguments)};function a(){return!!window.isMVK}function i(e){return void 0===e&&(e=""),new Promise((function(t,n){var r=document.createElement("video");r.addEventListener("loadedmetadata",(function(){return t(r.duration)}),{once:!0}),r.addEventListener("error",n,{once:!0}),r.crossOrigin="anonymous",r.preload="metadata",r.src=e}))}function o(e){return new Promise((function(t,n){var r=new XMLHttpRequest;r.open("GET",e,!0),r.responseType="blob",r.onload=function(){if(404===r.response.status)return n();t(r.response)},r.onerror=n,r.send()}))}function s(e){try{return e.type.split("/").splice(-1)[0]}catch(e){return null}}var c=function(){};function u(e){var t,n={r:0,g:0,b:0};try{t=e.getImageData(0,0,e.canvas.width,e.canvas.height)}catch(e){return n}for(var r=-4,a=0;(r+=20)<t.data.length;)++a,n.r+=t.data[r],n.g+=t.data[r+1],n.b+=t.data[r+2];return n.r=~~(n.r/a),n.g=~~(n.g/a),n.b=~~(n.b/a),n}function l(e){return new Promise((function(t,n){var r=new Image;r.crossOrigin=e.startsWith("data:")?null:"Anonymous",r.onerror=function(){return n(new Error("Failed to load image's URL: "+e))},r.onload=function(){return t(r)},r.src=e}))}var d=function(e){return new Promise((function(t){var n=e.map((function(e){return l(e)}));Promise.all(n).then((function(e){return t(e)})).catch((function(){}))}))};function _(e,t){var n,r,a,i,o,s,c,u,l={normal:"400",500:"500",600:"600",bold:"700"},d={tolerance:2,delay:100,glyphs:"",success:function(){},error:function(){},timeout:5e3,weight:"400",style:"normal"},_={display:"block","font-size":"48px","line-height":"normal","font-variant":"normal","white-space":"nowrap",position:"absolute",visibility:"hidden",top:"-9999px",left:"-9999px",width:"auto",height:"auto",margin:"0",padding:"0"};function f(e){var t=[];return each(e,(function(e,n){t.push(e+":"+n)})),t.join(";")}function h(e,t,n){return Math.abs(e.width-t.offsetWidth)>n||Math.abs(e.height-t.offsetHeight)>n}function p(){i||(utilsNode.appendChild(o),i=!0,a={sansSerif:{width:c.offsetWidth,height:c.offsetHeight},serif:{width:s.offsetWidth,height:s.offsetHeight}},browser.opera&&!browser.chrome?(c.style.fontFamily='"'+e+'", sans-serif',s.style.fontFamily='"'+e+'", serif'):(setStyle(c,"font-family",'"'+e+'", sans-serif'),setStyle(s,"font-family",'"'+e+'", serif'))),i&&a&&(h(a.sansSerif,c,t.tolerance)||h(a.serif,s,t.tolerance))?(re(o),t.success()):(new Date).getTime()-r.getTime()>t.timeout?(re(o),t.error()):!i&&"requestAnimationFrame"in window?window.requestAnimationFrame(p):window.setTimeout(p,t.delay)}for(var g in d)t.hasOwnProperty(g)||(t[g]=d[g]);_["font-weight"]=t.weight,_["font-style"]=t.style,!t.glyphs&&"fonts"in document?(t.timeout&&(n=setTimeout((function(){t.error()}),t.timeout)),function(n){each(null===document||void 0===document?void 0:document.fonts,(function(r){r.family.toLowerCase()===e.toLowerCase()&&(l[r.weight]||r.weight)===""+t.weight&&r.style===t.style&&r.load().then((function(){t.success(),clearTimeout(n)}))}))}(n)):(u="AxmTYklsjo190QW"+t.glyphs,r=new Date,o=ce("div"),c=ce("div",{innerHTML:u}),s=ce("div",{innerHTML:u}),c.setAttribute("style",f(extend({"font-family":"sans-serif"},_))),s.setAttribute("style",f(extend({"font-family":"serif"},_))),o.appendChild(c),o.appendChild(s),p())}function f(e,t){return new Promise((function(n,a){_(e,r(r({},t),{glyphs:"",success:function(){var e=function(){n(),(null==t?void 0:t.success)&&t.success()};browser.safari?setTimeout(e,150):e()},error:function(){a(),(null==t?void 0:t.error)&&t.error()}}))}))}function h(e,t,n,r,a){return new Promise((function(i,o){("string"==typeof e?l(e):Promise.resolve(e)).then((function(e){var s=document.createElement("canvas");s.width=e.width,s.height=e.height;var c=s.getContext("2d");if(c){c.drawImage(e,0,0);var u=c.getImageData(t,n,r,a),d=document.createElement("canvas");d.width=r,d.height=a;var _=d.getContext("2d");if(_)return _.putImageData(u,0,0),l(d.toDataURL("image/jpeg",1)).then(i).catch(o);i(e)}else i(e)})).catch(o)}))}},"Rfi/":function(e,t,n){"use strict";n.r(t);var r=n("cGUQ"),a=function(){for(var e=0,t=0,n=arguments.length;t<n;t++)e+=arguments[t].length;var r=Array(e),a=0;for(t=0;t<n;t++)for(var i=arguments[t],o=0,s=i.length;o<s;o++,a++)r[a]=i[o];return r};function i(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];var r=function(e){return e<10?"0"+e.toString():e.toString()},i=new Date,o=i.getHours()+":"+r(i.getMinutes())+":"+r(i.getSeconds()),s="background: "+e+"; color: white";window.sseDebug&&console.log.apply(console,a(["%c"+o+" SSE:",s],t))}var o=function(){return(o=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var a in t=arguments[n])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e}).apply(this,arguments)},s=function(e,t){var n=this,a=t.starterConfig,s=t.refreshedConfig;this.listeners=[],this.reconnect=function(e,t){if(void 0===e&&(e=2e3),void 0===t&&(t=!1),i("none","new connection requested"),0!==n.listeners.length){t||n.simulate([-4]);var a=Object(r.toQueryString)({key:n.config.key,ts:n.config.ts,uid:n.config.userId,version:11,mode:202});n.connectionLimiter.scheduleReconnect(n.config.url+"?"+a,{onOpen:function(){i("green","connection opened"),e=2e3,t||n.simulate([-5])},onClose:function(){i("red","connection closed, reconnect in",e),n.simulate([-3,e/1e3]);var t=c(e);n.reconnect(t)},onMessage:function(t){n.safariHackLastEventDatetime=Date.now();var r=JSON.parse(t.data);if(i("none","message received",r),void 0!==r.failed)switch(n.connectionLimiter.disconnect(),r.failed){case 1:n.simulate([-1]),n.config.ts=r.ts,n.reconnect();break;case 2:case 3:i("none","requesting new config"),n.refreshedConfig().then((function(e){i("none","new config received",e),n.config=o(o({},e),{url:n.config.url}),n.simulate([-1]),n.reconnect()})).catch((function(t){i("red","error on updating key",t);var r=c(e);n.reconnect(r)}));break;case 4:throw new Error("Unknown longpoll version");default:throw new Error("Unknown longpoll error")}else{n.config.ts=r.ts;for(var a=0,s=n.listeners;a<s.length;a++)(0,s[a])(r.updates)}}},e)}else i("none","no listeners, aborting reconnect")},this.skipWaiting=function(){if(i("none","skip waiting"),e=navigator.userAgent,!/chrome/i.test(e)&&/webkit|safari|khtml/i.test(e)&&n.safariHackLastEventDatetime&&Date.now()-n.safariHackLastEventDatetime>3e4)return i("red","safari weird connection hack"),void n.reconnect(1);var e;n.connectionLimiter.skipWaiting()},this.subscribe=function(e){return i("none","new client subscribed"),n.listeners.push(e),1===n.listeners.length&&n.reconnect(2e3,!0),function(){if(i("none","client unsubscribed"),n.listeners.includes(e))return n.listeners=n.listeners.filter((function(t){return e!==t})),0===n.listeners.length?(n.connectionLimiter.disconnect(),void(n.safariHackIntervalId&&(clearInterval(n.safariHackIntervalId),n.safariHackIntervalId=void 0))):void 0}},this.simulate=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];i("none","simulating events",e);for(var r=0,a=n.listeners;r<a.length;r++){var o=a[r];o(e)}},this.isConnected=function(){return n.connectionLimiter.isConnected()},this.config=a(),this.refreshedConfig=s,this.connectionLimiter=e};function c(e){return Math.min(2*e,6e4)}var u=function(){var e=this;this.scheduleReconnect=function(t,n,r){var a=n.onOpen,o=n.onMessage,s=n.onClose;void 0===r&&(r=0),i("none","scheduling reconnection in",r),e.disconnect();var c=function(){i("green","creating new EventSource");var n=new EventSource(t);n.onopen=a,n.onmessage=o,n.onerror=function(){switch(i("red","EventSource error, readyState",n.readyState),n.readyState){case EventSource.CONNECTING:case EventSource.OPEN:break;case EventSource.CLOSED:s()}},e.source=n},u=window.setTimeout((function(){e.scheduled=void 0,c()}),r);e.scheduled={timeoutId:u,reconnect:c}},this.skipWaiting=function(){if(e.scheduled){var t=e.scheduled,n=t.timeoutId,r=t.reconnect;e.scheduled=void 0,clearTimeout(n),r()}},this.disconnect=function(){i("red","disconnecting EventSource"),e.scheduled&&(clearTimeout(e.scheduled.timeoutId),e.scheduled=void 0),e.source&&e.source.close()},this.isConnected=function(){return!!e.source&&e.source.readyState===EventSource.OPEN}},l=n("f01n"),d=n("BxOC"),_=function(e,t,n,r){var a=this;this.buffer=[],this.paused=0,this.subscriptions=[],this.onData=function(e){a.subscriptions.push(e),a.unsubscribe||(a.unsubscribe=a.source.subscribe((function(e){var t,n=e.map(l.constructEvent);a.isPaused()?(t=a.buffer).push.apply(t,n):a.push(n)})))},this.offData=function(e){a.subscriptions=a.subscriptions.filter((function(t){return t!==e})),0===a.subscriptions.length&&a.unsubscribe&&(a.unsubscribe(),a.unsubscribe=void 0)},this.push=function(e){a.subscriptions.forEach((function(t){return t.apply(void 0,e)}))},this.isPaused=function(){return a.paused>0},this.pause=function(){a.paused++},this.resume=function(){if(0!==a.paused&&(a.paused--,0!==a.buffer.length)){var e=a.buffer;a.buffer=[];for(var t=0,n=a.subscriptions;t<n.length;t++)n[t].apply(void 0,e)}},this.abortWaiting=function(){a.source.skipWaiting()},this.isEnabled=function(){return a.source.isConnected()},this.isSSE=!0,this.source=new s(new u,{starterConfig:function(){return{key:e,ts:t,url:n,userId:r}},refreshedConfig:function(){return function(e){return Object(d.post)("al_im.php",{act:"a_get_key",uid:e,gid:Math.max(-e,0)},1e3)}(r).then((function(e){return{key:e[0],url:e[1]+"/"+e[2],ts:e[3],userId:r}}))}})};t.default=_},S2bU:function(e,t,n){"use strict";n.r(t),n.d(t,"replaceHyperLinks",(function(){return o})),n.d(t,"replaceEmailLinks",(function(){return s})),n.d(t,"replaceMentions",(function(){return c})),n.d(t,"replaceMassMentions",(function(){return u})),n.d(t,"replaceHashtags",(function(){return _})),n.d(t,"linksReplacer",(function(){return f}));var r,a=n("h++7"),i=n("t7n3");function o(e,t){for(var n,r=0,i=e;null!==(n=a.MESSAGE_REGEXP.exec(e));){var o=(n=l(n))[0].length,s=n.index+o,c=e[n.index-1],u=e[s-1],_=void 0!==c&&/([\w\$А-Яа-яёЁєЄҐґЇїІіЈј\—\-\_@;.])/i.test(c),f=void 0!==u&&/([:;$])/i.test(u);if(!_&&!f){var h=d(n),p=h.domain.toLowerCase();if(p.length<=a.MAX_DOMAIN_LENGTH&&a.TOP_DOMAINS.includes(p)){var g=t(h);i=i.slice(0,n.index+r)+g+i.slice(s+r),r+=g.length-o}}}return i}function s(e,t){return e.replace(a.EMAIL,t||function(e){return'<a href="mailto:'+e+'">'+e+"</a>"})}function c(e,t){return e.replace(a.MENTION,t||function(e,t,n,r,a){return'<a href="/'+(t+n)+'" class="mem_link" mention="'+Object(i.clean)(r||"")+'" mention_id="'+Object(i.clean)(t+n)+'" onclick="return mentionClick(this, event)" onmouseover="mentionOver(this)">'+a+"</a>"})}function u(e,t){return e.replace(a.RE_MASSMENTION,(function(e){return t?t(e,"","",e,e):'<span class="mem_pseudolink" data-mention="'+e.slice(1).toLowerCase()+'">'+e+"</span>"}))}function l(e){if(!e[0]||!e[6])return e;var t=e[0].length-1,n=e[6].length-1;return"."===e[0][t]&&"."===e[6][n]&&(e[0]=e[0].slice(0,t),e[6]=e[6].slice(0,n)),e}function d(e){return{full:e[0],protocol:e[1]||"http://",url:e[2],domain:e[4],query:e[6]||""}}function _(e,t){return e.replace((r||(r=new RegExp(a.RE_HASHTAG_EXTRACTION_PATTERN,"ig")),r),(function(e,n,r,a,i){return(n||"")+t(r+(i||""))}))}function f(e,t){var n=t.url,r=t.full,o=t.protocol,s=t.query;try{r=decodeURIComponent(r)}catch(e){}if(r.length>55&&(r=r.substr(0,53)+".."),r=Object(i.clean)(r).replace(/&amp;/g,"&"),!e&&n.match(a.OUR_DOMAINS)){var c=n=Object(i.replaceEntities)(n).replace(a.ENTITIES,encodeURIComponent),u=n.indexOf("#/"),l="";u>=0?c=n.substr(u+1):(u=n.indexOf("#!"))>=0&&(c="/"+n.substr(u+2).replace(/^\//,""));var d=c.match(a.VK_DOMAIN);return d&&d[1].length<32&&(l=' mention_id="'+d[1]+'" onclick="return mentionClick(this, event)" onmouseover="mentionOver(this)"'),'<a href="'+function(e){return e.replace(/"/g,"&quot;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}(o+n+s)+'" target="_blank" rel="noopener"'+l+">"+r+"</a>"}var _=Object(i.replaceEntities)(n+s).toString();return'<a href="'+("away.php?utf=1&to="+encodeURIComponent(o+_))+'" target="_blank" rel="noopener" onclick="'+("return goAway('"+Object(i.clean)((o+n+s).replace(/'/g,"\\'"))+"', {}, event);")+'">'+r+"</a>"}},Syd7:function(e,t,n){"use strict";n.r(t),n.d(t,"getPeerProfileHeight",(function(){return Q})),n.d(t,"mount",(function(){return J}));var r=n("q1tI"),a=n("i8i4"),i=n("rHUl"),o=n("P13b"),s=(n("91GP"),n("17x9"),n("ZxpX")),c=n("ErRf"),u=n("nAFc"),l=n("ERyv"),d=n("4+be"),_=n("6krn"),f=n("754W"),h=n("6aSF"),p=n("dt/K"),g=n("vT4u"),m=n("EasH"),b=_.default.getLang;class v extends r.Component{constructor(){super(...arguments),this.onAdTagAlertClick=()=>{Object(m.showFastBox)(b("mail_ad_tag_no_access_box_title"),b("mail_ad_tag_no_access_box_text"))}}render(){var e=this.props.data;if(e.adId){var t=`ads?act=office&union_id=${e.adId}&utm_medium=community_messages_ad_tag&utm_source=dialog`,n="";n=e.isEasyPromotedMarket?b("mail_ad_tag_easy_promoted_market"):e.hasAdAccess?`${b("mail_ad_tag_text_prefix")} ${e.adId}`:b("mail_ad_tag_no_access_text");var a=r.createElement("span",{className:"PeerProfileTagsListItem__adTagText"},n);return r.createElement("div",{className:"PeerProfileTagsListItem PeerProfileTagsListItem--adTag"},e.hasAdAccess&&r.createElement("a",{className:"PeerProfileTagsListItem__adTagLink",href:t,target:"_blank"},a),!e.hasAdAccess&&r.createElement("button",{className:"PeerProfileTagsListItem__adTagAlert",onClick:this.onAdTagAlertClick},a))}return r.createElement("div",{className:"PeerProfileTagsListItem",style:{backgroundColor:e.color}},r.createElement("span",null,Object(u.decodeHTMLEntities)(e.name)))}}var C=v,E=_.default.getLang;class y extends r.Component{constructor(e){super(e),this.onExtraClick=()=>{this.setState({isTagsCollapsed:!1})},this.state={isTagsCollapsed:!0}}render(){var e=this.props,t=e.peerTags,n=e.tags,a=e.isPeerProfileCollapsed,i=e.adId,o=e.hasAdAccess,s=e.isEasyPromotedMarket,c=e.toggleProfile,u=n.filter(e=>t.includes(e.id));i&&u.unshift({adId:i,hasAdAccess:o,isEasyPromotedMarket:s});var l=0;a&&this.state.isTagsCollapsed&&u.length>5&&(l=u.splice(5).length);return u=u.map((e,t)=>r.createElement(C,{key:t,data:e})),r.createElement("div",{className:"PeerProfileTagsList"},u.length>0&&u,l>0&&r.createElement("div",{className:"PeerProfileTagsListItem PeerProfileTagsListItem--extra",onClick:this.onExtraClick},"+ "+E("mail_im_peer_profile_extra_tags",l)),!u.length&&r.createElement("div",{className:"PeerProfileTagsListItem--empty"},E("mail_im_peer_profile_tags_empty")," ",r.createElement("span",{className:"PeerProfileTagsList__linkDivider"},"·")," ",r.createElement(f.default,{className:"PeerProfileTagsList__toggleProfileLink",onClick:c},E(a?"mail_im_peer_profile_toggle_tags_on":"mail_im_peer_profile_toggle_tags_off"))))}}var O=y,T=n("0Rlc");var w=function(e){var t=e.data,n=e.onCheckboxChange;return r.createElement("div",{className:"PeerProfileTagsGridItem",onClick:e=>{e&&e.preventDefault(),n(t.id,!t.isChecked)}},r.createElement(T.default,{className:"PeerProfileTagsGridItem__checkbox",checked:t.isChecked,onChange:(e,r)=>n(t.id,r)},r.createElement("span",{className:"PeerProfileTagsGridItem__color",style:{backgroundColor:t.color}}),r.createElement("span",{className:"PeerProfileTagsGridItem__name",title:t.name},Object(u.decodeHTMLEntities)(t.name))))};class N extends r.Component{constructor(){super(...arguments),this.onCheckboxChange=(e,t)=>{this.props.onPeerTagsChange(e,t)}}render(){var e=this.props.tags;return r.createElement("div",{className:"PeerProfileTagsGrid"},e.map((e,t)=>r.createElement(w,{key:t,data:e,onCheckboxChange:this.onCheckboxChange})))}}var I=N,k=n("r7nW"),A=n("Ht+d"),S=n("6raB"),j=n("0toi"),L=_.default.getLang;class M extends r.Component{constructor(e){super(e),this.onKeyDown=e=>"Enter"!==e.key||(e.preventDefault(),!1),this.inputRef=r.createRef()}componentDidMount(){this.props.data.id||this.inputRef.current.focus()}render(){var e=this.props,t=e.index,n=e.data,a=e.onNameChange,i=e.onRemove;return r.createElement("div",{className:"PeerProfileTagsModalField"},r.createElement("input",{type:"hidden",value:n.id?n.id:""}),r.createElement("input",{type:"text",className:"PeerProfileTagsModalField__input",value:Object(u.decodeHTMLEntities)(n.name),ref:this.inputRef,onChange:e=>a(e,t),onKeyDown:this.onKeyDown,maxLength:20,placeholder:L("mail_im_peer_profile_manage_tags_placeholder")}),r.createElement("span",{className:"PeerProfileTagsModalField__color",style:{backgroundColor:n.color}}),r.createElement(p.default,{position:"t",text:L("mail_im_peer_profile_manage_tags_remove")},r.createElement("span",{className:"PeerProfileTagsModalField__remove",onClick:()=>i(t)})))}}var P=M;function F(){return(F=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}var R=_.default.getLang,x=["#4bb34b","#5c9ce6","#e64646","#792ec0","#63b9ba","#ffa000","#ffc107","#76787a","#9e8d6b","#45678f","#539b9c","#454647","#7a6c4f","#6bc76b","#5181b8","#ff5c5c","#a162de","#7ececf","#aaaeb3","#bbaa84"],D=x[0];class B extends r.Component{constructor(e){var t;super(e),t=this,this.generateEmptyTag=()=>({name:"",color:this.state&&this.state.tags.length?this.getAvailableColor():D,state:"new"}),this.getAvailableColor=()=>{var e=[...this.state.tags].reduce((e,t)=>("deleted"!==t.state&&(e[t.color]=!0),e),{});return x.find(t=>!e[t])},this.onAddLinkClick=e=>{e&&e.preventDefault(),this.state.tags.filter(e=>"deleted"!==e.state).length>=20||this.setState(e=>({tags:[...e.tags,this.generateEmptyTag()]}),()=>{this.inputsRef.current.scrollIntoView({block:"end"})})},this.onNameChange=(e,t)=>{var n=e.target.value;this.setState({tags:this.state.tags.map((e,r)=>r===t?F({},e,{name:n,state:e.state||"changed"}):e)})},this.onRemove=function(e){var n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=t.state.tags,a=r[e];!n&&a.id&&a.uses>0?t.setState({isConfirmationModalOpen:!0,indexToRemove:e}):t.setState({tags:t.state.tags.filter((t,n)=>n!==e),deletedTags:[...t.state.deletedTags,F({},a,{state:"deleted"})]})},this.onSubmit=e=>{e&&e.preventDefault();var t=[...this.state.tags,...this.state.deletedTags].reduce((e,t)=>(t.name.trim()&&t.state&&e.push({id:t.id,name:t.name,color:t.color,state:t.state}),e),[]);this.setState({isLoading:!0}),this.props.onSave(t)},this.toggleConfirmationModal=(e,t)=>{e&&e.preventDefault(),this.setState({isConfirmationModalOpen:t})},this.state={tags:e.tags.length?e.tags.map(e=>F({},e)):[this.generateEmptyTag()],deletedTags:[],isLoading:!1,isConfirmationModalOpen:!1,indexToRemove:null},this.inputsRef=r.createRef()}render(){var e=this.state,t=e.tags,n=e.isConfirmationModalOpen,a=t[e.indexToRemove],i=Object(s.classNames)("PeerProfileTagsModal",{"PeerProfileTagsModal--hidden":n});return r.createElement(r.Fragment,null,r.createElement(k.default,{onClose:this.props.onClose,className:i,disableBackdropClick:!0,disableEscapeClose:!0},r.createElement("form",{onSubmit:this.onSubmit},r.createElement(j.default.Header,{title:R("mail_im_peer_profile_manage_tags_box_title"),onClose:this.props.onClose,appearance:"blue"}),r.createElement(j.default.Body,null,r.createElement(h.default,{className:"PeerProfileTagsModal__scroll",neverHide:!0},r.createElement("div",{className:"PeerProfileTagsModal__tagsInputs",ref:this.inputsRef},this.state.tags.map((e,t)=>r.createElement(P,{index:t,key:t,data:e,onNameChange:this.onNameChange,onRemove:this.onRemove})),this.state.tags.length<20?r.createElement(f.default,{className:"PeerProfileTagsModal__addLink",onClick:this.onAddLinkClick},R("mail_im_peer_profile_manage_tags_add_link")):""))),r.createElement(j.default.Footer,{actionButtons:[r.createElement(A.default,{key:"cancel",appearance:"tertiary",onClick:this.props.onClose},R("global_cancel")),r.createElement(S.default,{key:"save",onClick:this.onSubmit,loading:this.state.isLoading},R("global_save"))]}))),n&&r.createElement(j.default,{title:R("global_warning"),appearance:"blue",actionButtons:[r.createElement(A.default,{key:"cancel",appearance:"tertiary",onClick:e=>this.toggleConfirmationModal(e,!1)},R("global_cancel")),r.createElement(A.default,{key:"delete",onClick:e=>{this.toggleConfirmationModal(e,!1),this.onRemove(this.state.indexToRemove,!0)}},R("global_delete"))],onClose:e=>this.toggleConfirmationModal(e,!1),className:"PeerProfileConfirmationModal"},Object(d.langStr)(1===a.uses?R("mail_im_peer_profile_tag_delete_confirmation_text_single"):R("mail_im_peer_profile_tag_delete_confirmation_text",a.uses,!0),"tag_name",Object(u.decodeHTMLEntities)(a.name))))}}var H=B,U=n("MV/q"),G=_.default.getLang;class q extends r.Component{constructor(e){var t;super(e),t=this,this.onChange=e=>{var t=e.target.value;this.setState({note:t})},this.onSubmit=function(e){var n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];e&&e.preventDefault();var r=t.state.note&&t.state.note.trim();n||r?(t.setState({isLoading:!0}),t.props.onNoteSave(r)):t.setState({note:""})},this.toggleConfirmationModal=(e,t)=>{e&&e.preventDefault(),this.setState({isConfirmationModalOpen:t})},this.state={note:e.note||"",isLoading:!1,isConfirmationBoxOpen:!1,isConfirmationModalOpen:!1},this.inputRef=r.createRef()}componentDidMount(){this.inputRef.current.element.focus()}render(){var e=Object(s.classNames)("PeerProfileNoteModal",{"PeerProfileNoteModal--hidden":this.state.isConfirmationModalOpen}),t=[...this.props.note?[r.createElement(A.default,{key:"delete",appearance:"link",onClick:e=>this.toggleConfirmationModal(e,!0),className:"PeerProfileNoteModal__deleteButton"},G("mail_im_peer_profile_note_delete_link"))]:[],r.createElement(A.default,{key:"cancel",appearance:"tertiary",onClick:this.props.onClose},G("global_cancel")),r.createElement(S.default,{key:"save",onClick:this.onSubmit,loading:this.state.isLoading},G("global_save"))];return r.createElement(r.Fragment,null,r.createElement(k.default,{onClose:this.props.onClose,className:e,disableBackdropClick:!0,disableEscapeClose:!0},r.createElement("form",{onSubmit:this.onSubmit},r.createElement(j.default.Header,{title:G("mail_im_peer_profile_note_box_title"),onClose:this.props.onClose,appearance:"blue"}),r.createElement(j.default.Body,null,r.createElement(U.default,{className:"PeerProfileNoteModal__input",value:Object(u.decodeHTMLEntities)(this.state.note),placeholder:G("mail_im_peer_profile_note_box_placeholder"),onChange:this.onChange,style:{height:21},maxLength:96,ref:this.inputRef})),r.createElement(j.default.Footer,{actionButtons:t}))),this.state.isConfirmationModalOpen&&r.createElement(j.default,{title:G("global_warning"),appearance:"blue",actionButtons:[r.createElement(A.default,{key:"cancel",appearance:"tertiary",onClick:e=>this.toggleConfirmationModal(e,!1)},G("global_cancel")),r.createElement(A.default,{key:"delete",onClick:e=>{this.toggleConfirmationModal(e,!1),this.setState({note:""},()=>this.onSubmit(null,!0))}},G("global_delete"))],onClose:e=>this.toggleConfirmationModal(e,!1),className:"PeerProfileConfirmationModal"},G("mail_im_peer_profile_note_delete_confirmation_text")))}}var W=q;function K(){return(K=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}var z=_.default.getLang;class V extends r.PureComponent{constructor(e){super(e),this.toggleProfile=()=>{this.setState({isCollapsed:!this.state.isCollapsed})},this.onPeerTagsChange=(e,t)=>{var n=this.props.store,r=n.get().peer;this.setState(n=>({peerTags:t?[].concat(n.peerTags,e):n.peerTags.filter(t=>t!==e)}),()=>{n.set(g.peerProfileToggleTag.bind(null,e,t,t?"bind":"unbind",r,[...this.state.peerTags])).catch(e=>Object(l.imWeirdCatch)("PeerProfile.toggleTag",e))})},this.onSave=e=>{this.setState({tags:e},()=>{this.props.store.set(g.peerProfileManageTags.bind(null,[...this.state.tags])).then(e=>{var t=e.get().peer_profile_tags;this.setState({isCollapsed:0===t.length,tags:t,isTagsModalOpened:!1}),showDoneBox(z("mail_im_peer_profile_manage_tags_success"),{out:1e3})}).catch(e=>Object(l.imWeirdCatch)("PeerProfile.manageTags",e))})},this.onNoteSave=e=>{var t=this.props.store,n=t.get().peer;t.set(g.peerProfileSaveNote.bind(null,n,e)).then(()=>{this.setState({note:e,isNoteModalOpened:!1}),showDoneBox(z(e?"mail_im_peer_profile_save_note_success":"mail_im_peer_profile_delete_note_success"),{out:1e3})}).catch(e=>Object(l.imWeirdCatch)("PeerProfile.saveNote",e))},this.toggleModal=(e,t,n)=>{switch(e&&e.preventDefault(),n){case"tags":this.setState({isTagsModalOpened:t});break;case"note":this.setState({isNoteModalOpened:t})}t&&Object(c.cancelStackPush)("peer_profile_modal",()=>{Object(c.cancelStackFilter)("peer_profile_modal"),this.toggleModal(null,!1,n)})};var t=e.store.get(),n=t.peer,r=Object(i.getTab)(t,n),a=r.peer_profile_info||{};this.state={isCollapsed:!0,tags:t.peer_profile_tags||[],peerTags:r.peer_tags||[],note:a.note,isTagsModalOpened:!1,isNoteModalOpened:!1}}render(){var e=this.props.store.get(),t=Object(i.getTab)(e,e.peer),n=this.state,a=n.isCollapsed,o=n.tags,c=n.peerTags,l=n.note,_=n.isTagsModalOpened,g=n.isNoteModalOpened,m=o.length>0,b=m?o.reduce((e,t)=>(e[t.id]=!0,e),{}):[],v=c.filter(e=>b[e]),C=t.peer_profile_info,E=C&&(C.city||C.age),y=Object(s.classNames)("PeerProfile__wrapper",{"PeerProfile__wrapper--collapsed":a});return r.createElement("div",{className:y},r.createElement(h.default,{className:"PeerProfile__scroll",neverHide:!0},r.createElement("dl",{className:"PeerProfile__container"},r.createElement("dt",{className:"PeerProfile__label"},z("mail_im_peer_profile_tags_label_text")),r.createElement("dd",{className:"PeerProfile__content PeerProfile__tags"},a&&!m&&!t.ad_id&&r.createElement(f.default,{className:"PeerProfile__manageTagsLink",onClick:e=>this.toggleModal(e,!0,"tags")},z("mail_im_peer_profile_manage_tags")),(m||t.ad_id)&&r.createElement(O,{tags:o,peerTags:v,isPeerProfileCollapsed:a,adId:t.ad_id,hasAdAccess:t.has_ad_access,isEasyPromotedMarket:t.is_easy_promoted_market,toggleProfile:this.toggleProfile}),!a&&r.createElement(I,{tags:[...o].map(e=>K({},e,{isChecked:c.includes(e.id)})),onPeerTagsChange:this.onPeerTagsChange}),!a&&r.createElement(f.default,{className:"PeerProfile__manageTagsLink",onClick:e=>this.toggleModal(e,!0,"tags")},z("mail_im_peer_profile_manage_tags")),_&&r.createElement(H,{tags:o,onSave:this.onSave,onClose:e=>this.toggleModal(e,!1,"tags")})),r.createElement("dt",{className:"PeerProfile__label"},z("mail_im_peer_profile_info_label_text")),r.createElement("dd",{className:"PeerProfile__content PeerProfile__info"},E&&r.createElement(r.Fragment,null,C.city&&r.createElement("span",{className:"PeerProfile__infoItem"},Object(u.decodeHTMLEntities)(C.city)),C.age&&r.createElement("span",{className:"PeerProfile__infoItem"},Object(u.decodeHTMLEntities)(C.age)),C.likes_cnt&&r.createElement(p.default,{className:"PeerProfile__infoTooltip",position:"t",text:z("mail_peer_profile_likes_replies_tooltip"),appearance:"light"},r.createElement("span",{className:"PeerProfile__infoItem"},C.likes_cnt&&r.createElement("span",{className:"PeerProfile__infoItem"},Object(u.decodeHTMLEntities)(C.likes_cnt)),C.replies_cnt&&r.createElement("span",{className:"PeerProfile__infoItem"},Object(u.decodeHTMLEntities)(C.replies_cnt))))),!E&&r.createElement("span",null,z("mail_im_peer_profile_info_empty"))),e.is_peer_profile_note_enabled&&r.createElement(r.Fragment,null,r.createElement("dt",{className:"PeerProfile__label"},z("mail_im_peer_profile_note_label_text")),r.createElement("dd",{className:"PeerProfile__content PeerProfile__note"},!l&&r.createElement(f.default,{onClick:e=>this.toggleModal(e,!0,"note")},z("mail_im_peer_profile_note_add_link")),!!l&&r.createElement(r.Fragment,null,r.createElement("span",{className:"PeerProfile__noteText"},Object(u.decodeHTMLEntities)(l)),r.createElement("span",{className:"PeerProfile__noteDivider"}," · "),r.createElement(f.default,{onClick:e=>this.toggleModal(e,!0,"note")},z("mail_im_peer_profile_note_edit_link"))),g&&r.createElement(W,{note:l,onNoteSave:this.onNoteSave,onClose:e=>this.toggleModal(e,!1,"note")}))),r.createElement("dt",{className:"PeerProfile__label"},z("mail_im_peer_profile_join_date_label_text")),r.createElement("dd",{className:"PeerProfile__content"},C&&C.join_date?Object(u.decodeHTMLEntities)(C.join_date):Object(d.langSex)(t.sex,z("mail_im_peer_profile_join_date_empty_text","raw"))))),(m||t.ad_id)&&r.createElement("button",{className:"PeerProfile__toggler",onClick:this.toggleProfile}))}}var Y=V;function $(){return document.querySelector("#PeerProfile")}function Q(){var e=$();return e?e.offsetHeight:0}function X(e,t){if(t){var n=parseInt(getStyle(e,"padding-top"));e.style.paddingTop=n+Q()+"px"}else e.style.removeProperty("padding-top")}function J(e){return{render(t){var n=t.get(),s=$(),c=n.peer,u=Object(i.getTab)(n,c);n.is_peer_profile_enabled&&s&&Object(o.isFullyLoadedTab)(n,c)&&!Object(i.isChannelPeer)(u)&&!Object(i.isCommunityChat)(t,c)&&(s.innerHTML&&a.unmountComponentAtNode(s),a.render(r.createElement(Y,{store:t}),s,()=>{X(e,!0)}))},destroy(){var t=$();t&&(a.unmountComponentAtNode(t),X(e,!1))}}}},V1Nw:function(e,t,n){"use strict";function r(e,t,n){var r=0,a=e,i=[],o=!1;function s(){!i.length||r>0||o||(t(i),i=[])}return{pause:function(){r++},resume:function(){r>0&&(r--,s())},onLp:function(e,t,r){o||(a>=e?(a=t,i.push.apply(i,r),s()):n&&(o=!0,n(a).then((function(e){var t=e[1],n=e[2];a=t,o=!1,i.push.apply(i,n),s()}))))}}}n.r(t),n.d(t,"createLongpollEventsQueue",(function(){return r}))},Wu9C:function(e,t,n){"use strict";n.r(t),n.d(t,"isPinnedMessageVisibleInTab",(function(){return _})),n.d(t,"pinnedMessageHide",(function(){return f})),n.d(t,"pinnedMessageUnHide",(function(){return h})),n.d(t,"pinnedMessageUnpin",(function(){return p})),n.d(t,"mount",(function(){return C}));var r=n("ofcU"),a=n("vT4u"),i=n("P13b");function o(e){return{unmount(){Object(r.destroyModule)(e)}}}function s(e,t,n,a){var s=Object(r.createMutations)(o).bindMutations,c=t=>{n().messageKeyboardButtonClick(t),e.hide()};return s(Object(r.createModule)({handlers:(t,n)=>{n(e.bodyNode,"click",i.MESSAGE_KEYBOARD_BUTTON_CLASS,c)}}))}var c=n("rHUl"),u=n("aong"),l=n("uytb"),d=n("FWc3");function _(e,t){if(Object(u.unpackStore)(e).searchShown)return!1;var n=Object(c.getTab)(e,t),r=n&&Object(c.parserMessage)(n.pinned);return!!r&&n.pinHideId!=r.chat_local_id}function f(e,t,n){var r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],a=Object(c.getTab)(e,t),i=a&&Object(c.parserMessage)(a.pinned);a&&i&&(a.pinHideId=i.chat_local_id,cur.imDb.update(l.PIN_HIDDEN_ID_OP,[a.peerId,a.pinHideId]),m(n,t,e),re(geByClass1("_im_pinned_tt")),r&&window.Notifier&&Notifier.lcSend("pin_hide",{hide:1,peer:t}),statlogsValueEvent("im_pinned_messages","hide"))}function h(e,t,n){var r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],a=Object(c.getTab)(e,t);a&&a.pinHideId&&(delete a.pinHideId,cur.imDb.update(l.PIN_HIDDEN_ID_OP,[a.peerId,void 0]),m(n,t,e),r&&window.Notifier&&Notifier.lcSend("pin_hide",{hide:0,peer:t}),statlogsValueEvent("im_pinned_messages","show"))}function p(e,t,n){var r=m.bind(null,n,t),o=Object(i.showUnpinDialog)(()=>{o.hideProgress(),o.hide(),e.set(a.unpinMessageOptimistic.bind(null,t)).then(r).then(e=>e.set(a.unpinMessage.bind(null,t))).then(r)})}function g(e,t,n){var r=e.get().peer,a=Object(c.parserMessage)(Object(c.getTab)(e,r).pinned);if(n.target.classList.contains("_im_pin_hide"))a&&f(e,r,t);else if("A"!==n.target.tagName){var o=a&&a.messageId;o&&!Object(i.isAlreadyDeleted)(e,r,o)?Object(i.focusOnMessage)(e,t().focusOnMessage,r,o):Object(i.showPinnedBox)(e,t,r,s,n),statlogsValueEvent("im_pinned_messages","open")}}function m(e,t,n){return e().updateChatTopic(t,n),Object(a.setActions)(n.get()),e().updateActions(n),n}function b(e){Object(d.showTooltip)(e.target,{text:getLang("mail_hide_unpin_hover"),black:1,needLeft:1,shift:[8,4],forcetoup:!0,className:"_im_pinned_tt",appendEl:bodyNode})}function v(e){return{unmount(){Object(r.destroyModule)(e)}}}function C(e,t,n){var a=Object(r.createMutations)(v).bindMutations,i=g.bind(null,t,n),o=b.bind(null);return a(Object(r.createModule)({handlers:(t,n)=>{n(e,"click","_im_pinned_message",i),n(e,"mouseover","_im_pin_hide",o)}}))}},"Xq7/":function(e,t,n){"use strict";n.r(t),n.d(t,"ModalHeader",(function(){return o}));var r=n("q1tI"),a=n.n(r),i=n("ZxpX"),o=function(e){var t=e.title,n=e.onClose,r=e.appearance,o=void 0===r?"white":r,s=e.backText,c=e.onBack,u=Object(i.classNames)("ModalHeader","ModalHeader--"+o);return a.a.createElement("div",{className:u},s&&a.a.createElement("button",{className:"ModalHeader__back",onClick:c},s),a.a.createElement("h1",{className:"ModalHeader__title"},t),a.a.createElement("button",{className:"ModalHeader__cross",type:"button",onClick:n},"Закрыть"))}},ambf:function(e,t,n){"use strict";n.r(t),n.d(t,"MAX_DEVIATION",(function(){return o})),n.d(t,"EXPIRING_TIME",(function(){return s})),n.d(t,"EXPIRING_SOON_TIME",(function(){return c})),n.d(t,"EXPIRING",(function(){return u})),n.d(t,"EXPIRING_SOON",(function(){return l})),n.d(t,"EXPIRED",(function(){return d})),n.d(t,"casperMessagesStore",(function(){return g}));n("HEwt"),n("a1Th"),n("Btvt"),n("rGqo"),n("rE2o"),n("ioFf");var r=n("MhhX");function a(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var n=[],r=!0,a=!1,i=void 0;try{for(var o,s=e[Symbol.iterator]();!(r=(o=s.next()).done)&&(n.push(o.value),!t||n.length!==t);r=!0);}catch(e){a=!0,i=e}finally{try{r||null==s.return||s.return()}finally{if(a)throw i}}return n}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return i(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return i(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function i(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var o=2e3,s=6e4,c=1e4,u="expiring",l="expiring_soon",d="expired",_=[],f={},h={},p=0,g={add(e){var t=a(b(e),3),n=t[0],r=t[1],i=t[2],o=Math.max(n+r-s-i,0),_=Math.max(n+r-c-i,0),p=Math.max(n+r-i,0),g=setTimeout(()=>{m({type:u,message:e})},o),v=setTimeout(()=>{m({type:l,message:e})},_),C=setTimeout(()=>{m({type:d,message:e}),h[e.messageId]=!0,delete f[e.messageId]},p);f[e.messageId]={message:e,expiringTime:o,expiredTime:p,timers:[g,v,C]}},remove(e){this.has(e)&&(f[e].timers.forEach(clearTimeout),delete f[e])},setTimeshift(e){p=1e3*(e||0)},getTimings:e=>f[e]?b(f[e].message):[0,0,0],getExpireTime(e){if(!f[e])return 0;var t=a(b(f[e].message),3),n=t[0],r=t[1],i=t[2];return Math.max(Math.floor((n+r-i)/1e3),0)},isProcessed:e=>!!h[e],subscribe(e){_.push(e)},unsubscribe(e){_=_.filter(t=>t!==e)},has:e=>!!f[e],destroy(){f={},_=[],h={}}};function m(e){_.forEach(t=>t(e))}function b(e){return[1e3*e.date+p,1e3*(Object(r.getMessageTTL)(e)||0),Date.now()]}},bIHZ:function(e,t,n){"use strict";n.r(t),n.d(t,"updateLocation",(function(){return a})),n.d(t,"updateLazyLocation",(function(){return i}));var r=n("t7n3");function a(e){var t=Object(r.extend)({},window.nav.objLoc,e);Object.keys(t).filter((function(e){return""===t[e]})).forEach((function(e){delete t[e]}));var n=window.nav.toStr(t);window.nav.setLoc(n)}function i(){var e={};return{scheduleNav:function(t){e=Object(r.extend)(e,t)},commitNav:function(){a(e),e={}},scheduleNavWithTimeOut:function(t,n){void 0===n&&(n=100),e=Object(r.extend)(e,t),setTimeout((function(){a(e),e={}}),n)}}}},bP5l:function(e,t,n){"use strict";n.r(t),n.d(t,"lpLogFc",(function(){return i})),n.d(t,"longpollTestingOnFcEvents",(function(){return _})),n.d(t,"longpollTestingOnImEvents",(function(){return f}));var r=n("ERyv"),a=function(){for(var e=0,t=0,n=arguments.length;t<n;t++)e+=arguments[t].length;var r=Array(e),a=0;for(t=0;t<n;t++)for(var i=arguments[t],o=0,s=i.length;o<s;o++,a++)r[a]=i[o];return r};function i(e,t){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];if(window.vk.lpConfig.debug){var i="background: "+e+"; color: white",o=new Date,s=function(e){return e<10?"0"+e.toString():e.toString()};console.log.apply(console,a(["%c "+o.getHours()+":"+s(o.getMinutes())+":"+s(o.getSeconds())+":"+o.getMilliseconds()+" "+t+" ",i],n))}}function o(){return window.lpBufferFc||(window.lpBufferFc=[]),window.lpBufferFc}function s(){return window.lpBufferIm||(window.lpBufferIm=[]),window.lpBufferIm}function c(e,t){window.lpWeird||(window.lpWeird=[]),window.lpWeird.push({msg:e,ev:t,is_master:window.curNotifier.is_server}),setTimeout(u,1e4)}function u(){window.lpWeird&&window.lpWeird.length&&(Object(r.imWeirdLog)("fc_im_differ",{diff:window.lpWeird},!1),window.lpWeird=[])}function l(){return"im"===window.cur.module&&window.store&&window.store.get().longpoll&&!window.store.get().stopped}function d(){var e;l()&&(s().forEach((function(e){!o().find((function(t){return e.ev===t.ev}))&&e.time<Date.now()-1e3&&!e.warned&&(e.warned=!0,i("red","im not fc",e.ev),Object(r.isWeirdLogging)()&&c("im not fc",e.ev))})),o().forEach((function(e){var t=s().find((function(t){return t.ev===e.ev}));t&&t.warned&&!e.warned&&(e.warned=!0,i("red","now fc like im",e.ev),Object(r.isWeirdLogging)()&&c("now fc like im",e.ev))}))),e=Date.now()-3e4,window.lpBufferFc=o().filter((function(t){return t.time>e})),window.lpBufferIm=s().filter((function(t){return t.time>e}))}function _(e){var t;l()&&((t=o()).push.apply(t,e.map((function(e){return{time:Date.now(),ev:JSON.stringify(e),warned:!1}}))),setTimeout(d,0)),i.apply(void 0,a(["green","fc"],e))}function f(e){var t;l()&&((t=s()).push.apply(t,e.map((function(e){return{time:Date.now(),ev:JSON.stringify(e),warned:!1}}))),setTimeout(d,1100)),i.apply(void 0,a(["blue","im"],e))}window.longpollTestingOnImEvents=f},clTp:function(e,t,n){"use strict";function r(e){var t=e.getBoundingClientRect(),n=document.body,r=document.documentElement,a=window.pageYOffset||r.scrollTop||n.scrollTop,i=window.pageXOffset||r.scrollLeft||n.scrollLeft,o=r.clientTop||n.clientTop||0,s=r.clientLeft||n.clientLeft||0;return{top:Math.round(t.top+a-o),left:Math.round(t.left+i-s),width:e.offsetWidth,height:e.offsetHeight}}n.r(t),n.d(t,"default",(function(){return r}))},"dt/K":function(e,t,n){"use strict";n.r(t);var r,a=n("q1tI"),i=n("i8i4"),o=n("ZxpX"),s=n("clTp"),c=n("qihR"),u=(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),l=function(){return(l=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var a in t=arguments[n])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e}).apply(this,arguments)},d=function(e){var t=e.position,n=e.align,r=e.text,a=e.rect,i=e.marginTop,o=e.marginLeft,s=e.maxWidth,c=e.appearance,u=e.className,l=a.left,d=a.top;switch(t){case"t":l+=.5*a.width;break;case"r":l+=a.width,d+=.5*a.height;break;case"b":l+=.5*a.width,d+=a.height;break;case"l":d+=.5*a.height}return{tooltip:{position:t,align:n,text:r,x:l=Math.round(l+(o||0)),y:d=Math.round(d+(i||0)),maxWidth:s,appearance:c,className:u}}},_=function(e){function t(t){var n=e.call(this,t)||this;return n.onMouseEnter=function(){if(n.state.el){var e=n.props,t=e.text,r=e.position,a=e.align,i=e.marginTop,o=e.marginLeft,c=e.maxWidth,u=e.appearance,l=e.className,d=Object(s.default)(n.state.el);n.update({text:t,position:r,align:a,rect:d,marginTop:i,marginLeft:o,maxWidth:c,appearance:u,className:l})}},n.onMouseLeave=function(){return n.update()},n.onTransitionEnd=function(e){"visibility"===e.propertyName&&n.state.tooltip&&n.setState({tooltip:void 0})},n.state={el:null},n}return u(t,e),t.prototype.componentDidMount=function(){var e=i.findDOMNode(this);this.setState({el:e}),null==e||e.addEventListener("mouseenter",this.onMouseEnter),null==e||e.addEventListener("mouseleave",this.onMouseLeave)},t.prototype.componentWillUnmount=function(){var e,t;null===(e=this.state.el)||void 0===e||e.removeEventListener("mouseenter",this.onMouseEnter),null===(t=this.state.el)||void 0===t||t.removeEventListener("mouseleave",this.onMouseLeave)},t.getDerivedStateFromProps=function(e,t){return t.tooltip&&(e.text!==t.tooltip.text||e.position!==t.tooltip.position||e.align!==t.tooltip.align||e.maxWidth!==t.tooltip.maxWidth||e.appearance!==t.tooltip.appearance)?d(l(l({},e),{rect:Object(s.default)(t.el)})):null},t.prototype.update=function(e){if(!e)return this.setState({tooltip:Object.assign({},this.state.tooltip,{removed:!0})});this.setState(d(e))},t.prototype.render=function(){var e=this.state.tooltip?Object(o.classNames)(this.state.tooltip.className,"Tooltip--noPointerEvents"):"",t=this.state.tooltip?l(l({},this.state.tooltip),{className:e}):null;return t&&"undefined"!=typeof window?a.createElement(a.Fragment,null,this.props.children,a.createElement(c.default,l({},t,{onTransitionEnd:this.onTransitionEnd}))):this.props.children},t.defaultProps={position:"b",align:"center",marginTop:0,marginLeft:0,appearance:"dark"},t}(a.Component);t.default=_},f01n:function(e,t,n){"use strict";n.r(t),n.d(t,"constructEvent",(function(){return o})),n.d(t,"DELETE",(function(){return s})),n.d(t,"SET_FLAGS",(function(){return c})),n.d(t,"REPLACE_FLAGS",(function(){return u})),n.d(t,"RESET_FLAGS",(function(){return l})),n.d(t,"ADD_MESSAGE",(function(){return d})),n.d(t,"READ_INBOUND",(function(){return _})),n.d(t,"READ_OUTBOUND",(function(){return f})),n.d(t,"GOT_ONLINE",(function(){return h})),n.d(t,"GOT_OFFLINE",(function(){return p})),n.d(t,"CHAT_CHANGED",(function(){return g})),n.d(t,"CONVERSATION_UPDATED",(function(){return m})),n.d(t,"TYPING",(function(){return b})),n.d(t,"RECORDING_AUDIO",(function(){return v})),n.d(t,"VIDEO_CALL",(function(){return C})),n.d(t,"UNREAD_COUNT",(function(){return E})),n.d(t,"NOTIFY_SETTINGS_CHANGED",(function(){return y})),n.d(t,"KEYBOARD_CALLBACK_RECEIVED",(function(){return O})),n.d(t,"EMPTY",(function(){return T})),n.d(t,"RESET_DIRECTORIES",(function(){return w})),n.d(t,"REPLACE_DIRECTORIES",(function(){return N})),n.d(t,"SET_DIRECTORIES",(function(){return I})),n.d(t,"RESYNC",(function(){return k})),n.d(t,"REFRESH_LP_KEY",(function(){return A})),n.d(t,"TRANSITION",(function(){return S})),n.d(t,"RESET_PEER",(function(){return j})),n.d(t,"MUTEX",(function(){return L})),n.d(t,"CHANGE_PEER",(function(){return M})),n.d(t,"CHANGE_TAB",(function(){return P})),n.d(t,"FAILED_MESSAGE",(function(){return F})),n.d(t,"RESEND",(function(){return R})),n.d(t,"DELETE_DIALOG",(function(){return x})),n.d(t,"EDIT_MESSAGE",(function(){return D})),n.d(t,"REPLACE_MESSAGE",(function(){return B})),n.d(t,"INVALIDATE_MESSAGE",(function(){return H})),n.d(t,"AUDIO_START",(function(){return U})),n.d(t,"WAITING_FOR_RECONNECT",(function(){return G})),n.d(t,"RECONNECTING",(function(){return q})),n.d(t,"RECONNECTED",(function(){return W})),n.d(t,"INCOMING_CALL",(function(){return K})),n.d(t,"FLAG_UNREAD",(function(){return z})),n.d(t,"FLAG_OUTBOUND",(function(){return V})),n.d(t,"FLAG_IMPORTANT",(function(){return Y})),n.d(t,"FLAG_CHAT",(function(){return $})),n.d(t,"FLAG_FRIENDS",(function(){return Q})),n.d(t,"FLAG_SPAM",(function(){return X})),n.d(t,"FLAG_DELETED",(function(){return J})),n.d(t,"FLAG_MEDIA",(function(){return Z})),n.d(t,"FLAG_STEALTH",(function(){return ee})),n.d(t,"FLAG_HAS_REPLY",(function(){return te})),n.d(t,"FLAG_AUDIO_MESSAGE_LISTENED",(function(){return ne})),n.d(t,"FLAG_DELETE_BY_TTL",(function(){return re})),n.d(t,"FOLDER_IMPORTANT",(function(){return ae})),n.d(t,"FOLDER_UNRESPOND",(function(){return ie})),n.d(t,"FOLDER_HAS_BANNER",(function(){return oe})),n.d(t,"FOLDER_AD_TAG",(function(){return se})),n.d(t,"FOLDER_MARKED_UNREAD",(function(){return ce})),n.d(t,"MAIL_CHAT_UPDATE_TYPE_TITLE_CHANGED",(function(){return ue})),n.d(t,"MAIL_CHAT_UPDATE_TYPE_AVATAR_CHANGED",(function(){return le})),n.d(t,"MAIL_CHAT_UPDATE_TYPE_ADMIN_GRANTED",(function(){return de})),n.d(t,"MAIL_CHAT_UPDATE_TYPE_FLAGS_CHANGED",(function(){return _e})),n.d(t,"MAIL_CHAT_UPDATE_TYPE_PINNED",(function(){return fe})),n.d(t,"MAIL_CHAT_UPDATE_TYPE_USER_JOINED",(function(){return he})),n.d(t,"MAIL_CHAT_UPDATE_TYPE_USER_LEFT",(function(){return pe})),n.d(t,"MAIL_CHAT_UPDATE_TYPE_USER_KICKED",(function(){return ge})),n.d(t,"MAIL_CHAT_UPDATE_TYPE_ADMIN_KICKED",(function(){return me})),n.d(t,"MAIL_CHAT_UPDATE_TYPE_BANNER_CHANGED",(function(){return be})),n.d(t,"MAIL_CHAT_UPDATE_TYPE_KEYBOARD_CHANGED",(function(){return ve})),n.d(t,"MAIL_CHAT_UPDATE_TYPE_MESSAGE_REQUEST_CHANGED",(function(){return Ce})),n.d(t,"MAIL_CHAT_UPDATE_TYPE_CONTACT_CONVERTED",(function(){return Ee})),n.d(t,"MAIL_CHAT_UPDATE_TYPE_BUSINESS_NOTIFY_DATA_CHANGED",(function(){return ye})),n.d(t,"MAIL_CHAT_UPDATE_TYPE_MESSAGE_REQUEST_CANCELED",(function(){return Oe})),n.d(t,"MAIL_CHAT_UPDATE_TYPE_MESSAGE_REQUEST_REJECTED",(function(){return Te})),n.d(t,"MAIL_CHAT_UPDATE_TYPE_MESSAGE_REQUEST_ACCEPTED",(function(){return we})),n.d(t,"MAIL_CHAT_UPDATE_TYPE_CONTACT_JOINED",(function(){return Ne})),n.d(t,"MAIL_CHAT_UPDATE_TYPE_CALL_IN_PROGRESS_CHANGED",(function(){return Ie})),n.d(t,"MESSAGE_REQUEST_STATUS_ACCEPTED",(function(){return ke})),n.d(t,"MESSAGE_REQUEST_STATUS_NEW",(function(){return Ae})),n.d(t,"deleteEvent",(function(){return Se})),n.d(t,"replaceFlagsEvent",(function(){return je})),n.d(t,"setFlagsEvent",(function(){return Le})),n.d(t,"resetFlagsEvent",(function(){return Me})),n.d(t,"addMessageEvent",(function(){return Pe})),n.d(t,"editMessageEvent",(function(){return Fe})),n.d(t,"replaceMessageEvent",(function(){return Re})),n.d(t,"invalidateMessageEvent",(function(){return xe})),n.d(t,"editMessageLocallyEvent",(function(){return De})),n.d(t,"readInboundEvent",(function(){return Be})),n.d(t,"readOutboundEvent",(function(){return He})),n.d(t,"gotOnlineEvent",(function(){return Ue})),n.d(t,"gotOfflineEvent",(function(){return Ge})),n.d(t,"resetDirectoriesEvent",(function(){return qe})),n.d(t,"replaceDirectoriesEvent",(function(){return We})),n.d(t,"setDirectoriesEvent",(function(){return Ke})),n.d(t,"deleteDialogEvent",(function(){return ze})),n.d(t,"chatChangedEvent",(function(){return Ve})),n.d(t,"chatUpdatedEvent",(function(){return Ye})),n.d(t,"typingEvent",(function(){return $e})),n.d(t,"recordingAudioEvent",(function(){return Qe})),n.d(t,"videoCallEvent",(function(){return Xe})),n.d(t,"unreadCountEvent",(function(){return Je})),n.d(t,"notifySettingsChangedEvent",(function(){return Ze})),n.d(t,"incomingCallEvent",(function(){return et})),n.d(t,"refreshMessageEvent",(function(){return tt})),n.d(t,"audioStartEvent",(function(){return nt})),n.d(t,"keyboardCallbackReceivedEvent",(function(){return rt})),n.d(t,"emptyEvent",(function(){return at})),n.d(t,"transitionEvent",(function(){return it})),n.d(t,"resyncEvent",(function(){return ot})),n.d(t,"refreshLpKeyEvent",(function(){return st})),n.d(t,"waitingForReconnectEvent",(function(){return ct})),n.d(t,"reconnectingEvent",(function(){return ut})),n.d(t,"reconnectedEvent",(function(){return lt})),n.d(t,"resetPeer",(function(){return dt})),n.d(t,"changePeer",(function(){return _t})),n.d(t,"changeTab",(function(){return ft})),n.d(t,"failedMessage",(function(){return ht})),n.d(t,"mutexEvent",(function(){return pt})),n.d(t,"resendEvent",(function(){return gt}));n("HEwt"),n("a1Th"),n("Btvt"),n("rGqo"),n("rE2o"),n("ioFf"),n("OEbY");var r=n("rudk");function a(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var n=[],r=!0,a=!1,i=void 0;try{for(var o,s=e[Symbol.iterator]();!(r=(o=s.next()).done)&&(n.push(o.value),!t||n.length!==t);r=!0);}catch(e){a=!0,i=e}finally{try{r||null==s.return||s.return()}finally{if(a)throw i}}return n}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return i(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return i(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function i(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function o(e){switch(e[0]){case 0:return Se(e);case 1:return je(e);case 2:return Le(e);case 3:return Me(e);case 4:return Pe(e);case 5:return Fe(e);case 6:return Be(e);case 7:return He(e);case 8:return Ue(e);case 9:return Ge(e);case 10:return qe(e);case 11:return We(e);case 12:return Ke(e);case 13:return ze(e);case 18:return Re(e);case 19:return xe(e);case 51:return Ve(e);case 52:return Ye(e);case 63:return $e(e);case 64:return Qe(e);case 70:return Xe(e);case 80:return Je(e);case 114:return Ze(e);case 115:return et(e);case 116:return tt(e);case 117:return nt(e);case 119:return rt(e);case-1:return ot();case-2:return st(e);case-3:return ct(e);case-4:return ut();case-5:return lt();default:return at(e)}}var s="event_delete",c="event_set_flags",u="event_replace_flags",l="event_reset_flags",d="event_add_message",_="event_read_inbound",f="event_read_outbound",h="event_got_online",p="event_got_offline",g="event_chat_changed",m="event_chat_updated",b="event_typing",v="event_recoding_audio",C="event_video_call",E="event_unread_count",y="event_notify_settings_changed",O="event_keyboard_callback_received",T="event_empty",w="event_reset_directories",N="event_replace_directories",I="event_set_directories",k="event_resync",A="event_refresh_lp_key",S="transition_event",j="reset_peer",L="mutex",M="change_peer",P="event_change_tab",F="event_failed_message",R="event_resend",x="event_delete_dialog",D="event_edit_message",B="event_replace_message",H="event_invalidate_event",U="event_audio_start",G="event_waiting_for_reconnect",q="event_reconnecting",W="event_reconnected",K="incoming_call",z=1,V=2,Y=8,$=16,Q=32,X=64,J=128,Z=512,ee=65536,te=1<<21,ne=4096,re=1<<22,ae=1,ie=2,oe=8,se=32768,ce=1<<20,ue=1,le=2,de=3,_e=4,fe=5,he=6,pe=7,ge=8,me=9,be=10,ve=11,Ce=12,Ee=13,ye=14,Oe=15,Te=16,we=17,Ne=18,Ie=19,ke=1,Ae=3;function Se(e){var t=a(e,2)[1];return{type:s,localId:t}}function je(e){var t=a(e,4),n=t[1],r=t[2],i=t[3];return{type:u,messageId:n,mask:r,peerId:i}}function Le(e){var t=a(e,4),n=t[1],r=t[2],i=t[3];return{type:c,messageId:n,flags:r,peerId:i}}function Me(e){var t=a(e,4),n=t[1],r=t[2],i=t[3];return{type:l,messageId:n,flags:r,peerId:i}}function Pe(e){var t=a(e,11),n=t[1],i=t[2],o=t[3],s=t[4],c=t[5],u=t[6],l=t[7],_=t[8],f=t[9],h=t[10],p=extend(u,l||void 0);return{type:d,messageId:intval(n),flags:intval(i),peerId:intval(o),date:intval(s),attaches:Object(r.convertKludgesToAttaches)(p,n),subject:u.title||"",text:c,kludges:p,randomId:intval(_),userId:Object(r.isChatPeer)(o)?intval(p.from):intval(o),update_time:h,chat_local_id:f}}function Fe(e){var t=Pe(e);return t.type=D,t}function Re(e){var t=Pe(e);return t.type=B,t}function xe(e){var t=a(e,2)[1];return{type:H,messageId:t}}function De(e){return extend({},e,{type:D})}function Be(e){var t=a(e,4),n=t[1],r=t[2],i=t[3];return{type:_,peerId:n,upToId:r,unread:i}}function He(e){var t=a(e,4),n=t[1],r=t[2],i=t[3];return{type:f,peerId:n,upToId:r,unread:i}}function Ue(e){var t=a(e,4),n=t[1],r=t[2],i=t[3];return{type:h,userId:-n,platform:r,lastSeenTs:i}}function Ge(e){var t=a(e,4),n=t[1],r=t[2],i=t[3];return{type:p,userId:-n,reason:r,lastSeenTs:i}}function qe(e){var t=a(e,4),n=t[1],r=t[2],i=t[3];return{type:w,peerId:n,mask:r,local:void 0!==i&&i}}function We(e){var t=a(e,3),n=t[1],r=t[2];return{type:N,peerId:n,mask:r}}function Ke(e){var t=a(e,4),n=t[1],r=t[2],i=t[3];return{type:I,peerId:n,mask:r,local:void 0!==i&&i}}function ze(e){var t=a(e,3),n=t[1],r=t[2];return{type:x,peerId:n,localId:r}}function Ve(e){var t=a(e,3),n=t[1],r=t[2];return{type:g,chatId:n,self:r}}function Ye(e){var t=a(e,4),n=t[1],r=t[2],i=t[3];return{type:m,peerId:r,updateType:n,updateArg:i}}function $e(e){var t=a(e,5),n=t[1],r=t[2],i=t[3],o=t[4];return{type:b,peerId:n,userIds:r,totalCount:i,ts:o}}function Qe(e){var t=a(e,5),n=t[1],r=t[2],i=t[3],o=t[4];return{type:v,peerId:n,userIds:r,totalCount:i,ts:o}}function Xe(e){var t=a(e,3),n=t[1],r=t[2];return{type:C,userId:n,callId:r}}function Je(e){var t=a(e,4),n=t[1],r=t[2],i=t[3];return{type:E,count:n,countNotMuted:r,showOnlyNotMuted:i}}function Ze(e){var t=a(e,2)[1],n=void 0===t?{}:t;return{type:y,peerId:n.peer_id,sound:n.sound,disabledUntil:n.disabled_until}}function et(e){var t=a(e,2)[1];return{type:K,payload:t}}function tt(e){var t=a(e,2)[1],n=void 0===t?{}:t,r=Pe([!1,n.id,n.flags,n.peer_id,n.date,n.message,extend(n.kludges,{title:n.title||""}),{},n.random_id,n.chat_local_id,n.update_time]);return r.type=D,r}function nt(e){var t=a(e,2)[1],n=void 0===t?{}:t;return{type:U,uuid:n.uuid,deviceName:n.device_name||""}}function rt(e){var t=a(e,2)[1],n=t.event_id,r=t.owner_id,i=t.peer_id,o=t.action;return{type:O,event_id:n,owner_id:r,peer_id:i,action:o}}function at(e){return{type:T,params:e}}function it(e){return{type:S,state:e}}function ot(){return{type:k}}function st(e){var t=a(e,3),n=t[1],r=t[2];return{type:A,key:n,url:r}}function ct(e){var t=a(e,2)[1];return{type:G,timeout:t}}function ut(){return{type:q}}function lt(){return{type:W}}function dt(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return{type:j,cancelSearch:e,removeActivePeer:t}}function _t(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"";return{type:M,peerId:e,msgid:t,forward:n,cancelSearch:r,entryPoint:a}}function ft(e){return{type:P,tab:e}}function ht(e,t,n){return{type:F,message:t,peer:e,error:n}}function pt(e){var t=a(e,6),n=(t[0],t[1]),r=t[2],i=t[3],o=t[4],s=t[5];return{type:L,free:!!intval(n)||intval(o)===vk.id,resource:r,peerId:intval(i),who:intval(o),name:s}}function gt(e,t){return{type:R,message:t,peerId:e}}},gF8j:function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return o})),n.d(t,"getVisibilityState",(function(){return u})),n.d(t,"getVisiblityEvent",(function(){return l}));var r=n("uQjJ"),a=n("PU8N"),i=browser.iphone||browser.ipad||browser.ipod;function o(e){this.started=!1,this.is_idle=!0,this.activeTimeStart=null,this.cbActiveB=this.cbActive.bind(this),this.cbInactiveB=this.cbInactive.bind(this),this.onVisiblityChange=this.onVisiblityChange.bind(this),this.opts=extend({triggerEvents:"mousemove keydown",onIdleCb:function(){},onUnIdleCb:function(){},focusElement:e.element,element:null,idleTimeout:3e4},e)}function s(e,t,n){Object(a.isMvk)()?window.addEvent(e,t,n,{passive:!0}):window.addEvent(e,t,n)}function c(e,t,n){Object(a.isMvk)()?window.removeEvent(e,t,n,{passive:!0}):window.removeEvent(e,t,n)}function u(){return document.visibilityState||document.webkitVisibilityState}function l(){var e="visibilitychange";return document.visibilityState||(document.webkitVisibilityState?e+="webkit":e=""),e}extend(o.prototype,r.default.prototype),extend(o.prototype,{stop:function(){this.started=!1,c(this.opts.element,this.opts.triggerEvents,this.cbActiveB),Object(a.isMvk)()&&this._isTopLevel()&&l()&&c(document,l(),this.onVisiblityChange),Object(a.isMvk)()&&i||(c(this.opts.focusElement,"focus",this.cbActiveB),c(this.opts.focusElement,"blur",this.cbInactiveB)),clearTimeout(this.setIdleTo),clearTimeout(this.checkIdleCbTo),clearTimeout(this.sendCbTO),this.is_idle=!0,this.opts.parentManager&&this.opts.parentManager.off("idle",this.cbInactiveB)},idle:function(e){this.is_idle=!0,e||this.opts.onIdleCb(),this.emit("idle")},unidle:function(e){this.is_idle=!1,e||this.opts.onUnIdleCb(),this.emit("unidle")},start:function(){this.started=!0,!Object(a.isMvk)()&&browser.mobile||(this.is_idle=!this._isFocused(),this.opts.parentManager&&this.opts.parentManager.on("idle",this.cbInactiveB),Object(a.isMvk)()&&this._isTopLevel()&&l()&&s(document,l(),this.onVisiblityChange),Object(a.isMvk)()&&i||(s(this.opts.focusElement,"focus",this.cbActiveB),s(this.opts.focusElement,"blur",this.cbInactiveB)),clearTimeout(this.checkIdleCbTo),this.checkIdleCb(),this.checkIdleCbTo=setTimeout(this.checkIdleCb.bind(this),this.opts.idleTimeout))},checkIdleCb:function(){this.started&&(s(this.opts.element,this.opts.triggerEvents,this.cbActiveB),clearTimeout(this.setIdleTo),this.setIdleTo=setTimeout(this.cbInactiveB,this.opts.idleTimeout))},cbActive:function(){this.started&&(this.activeTimeStart=(new Date).getTime(),clearTimeout(this.setIdleTo),this.is_idle&&(this.is_idle=!1,clearTimeout(this.sendCbTO),this.sendCbTO=setTimeout(function(){this.emit("unidle"),this.opts.onUnIdleCb&&this.opts.onUnIdleCb()}.bind(this),100)),c(this.opts.element,this.opts.triggerEvents,this.cbActiveB),clearTimeout(this.checkIdleCbTo),this.checkIdleCbTo=setTimeout(this.checkIdleCb.bind(this),this.opts.idleTimeout))},cbInactive:function(){this.started&&(this.activeTimeStart=null,this.is_idle||(this.is_idle=!0,clearTimeout(this.sendCbTO),this.sendCbTO=setTimeout(function(){this.emit("idle"),this.opts.onIdleCb&&this.opts.onIdleCb()}.bind(this),100)),clearTimeout(this.checkIdleCbTo),c(this.opts.element,this.opts.triggerEvents,this.cbActiveB),s(this.opts.element,this.opts.triggerEvents,this.cbActiveB),this.checkIdleCbTo=setTimeout(this.checkIdleCb,this.opts.idleTimeout))},getActiveTime(){return!this.is_idle&&this.activeTimeStart?(new Date).getTime()-this.activeTimeStart:0},onVisiblityChange(){"visible"===u()?this.cbActiveB():this.cbInactiveB()},_isTopLevel(){var e=this.opts.focusElement;return e===window||e===document},_isFocused(){var e=this.opts.focusElement;if(this._isTopLevel()){var t=u();return"string"==typeof t&&"visible"===t}return document.activeElement===e}})},"h++7":function(e,t,n){"use strict";n.r(t),n.d(t,"OUR_DOMAINS",(function(){return r})),n.d(t,"ENTITIES",(function(){return a})),n.d(t,"VK_DOMAIN",(function(){return i})),n.d(t,"MENTION",(function(){return o})),n.d(t,"MENTION_RAW",(function(){return s})),n.d(t,"ARROW_UP",(function(){return c})),n.d(t,"ARROW_DOWN",(function(){return u})),n.d(t,"PAGE_UP",(function(){return l})),n.d(t,"PAGE_DOWN",(function(){return d})),n.d(t,"END_KEY",(function(){return _})),n.d(t,"HOME",(function(){return f})),n.d(t,"ENTER",(function(){return h})),n.d(t,"ESC",(function(){return p})),n.d(t,"UNPRINTABLE_KEYS",(function(){return g})),n.d(t,"UP_DOWN_CONTROLS",(function(){return m})),n.d(t,"PRINTABLE",(function(){return b})),n.d(t,"FOLDER_UNREAD",(function(){return v})),n.d(t,"FOLDER_ALL",(function(){return C})),n.d(t,"FOLDER_UNRESPOND",(function(){return E})),n.d(t,"FOLDER_IMPORTANT",(function(){return y})),n.d(t,"FOLDER_MESSAGE_REQUEST",(function(){return O})),n.d(t,"FOLDER_MESSAGE_REQUEST_REJECTED",(function(){return T})),n.d(t,"FOLDER_AD_TAG",(function(){return w})),n.d(t,"FOLDER_MARKED_UNREAD",(function(){return N})),n.d(t,"FOLDERS",(function(){return I})),n.d(t,"FOLDER_MASKS",(function(){return k})),n.d(t,"TOP_DOMAINS",(function(){return A})),n.d(t,"MAX_DOMAIN_LENGTH",(function(){return S})),n.d(t,"EMAIL",(function(){return j})),n.d(t,"MESSAGE_REGEXP",(function(){return L})),n.d(t,"RE_HASHTAG_EXTRACTION_PATTERN",(function(){return P})),n.d(t,"MASS_MENTION_ALIASES",(function(){return F})),n.d(t,"RE_MASSMENTION",(function(){return R})),n.d(t,"LINE_FEED",(function(){return x}));n("Oyvg");var r=/^([a-zA-Z0-9\.\_\-]+\.)?(vkontakte\.ru|vk\.com|vkadre\.ru|vshtate\.ru|userapi\.com|vk\.me)$/,a=/([^a-zA-Z0-9#%;_\-.\/?&=\[\]])/g,i=/^(?:https?:\/\/)?(?:vk\.com|vkontakte\.ru)?\/([a-zA-Z0-9\._]+)\??$/,o=/\[(id|club)(\d+)(?:\:([a-z0-9_\-]+))?\|([^\$]+?)\]/g,s=/(^|[\s.,:\'\";>\)\(])(\*|@)([A-Za-z0-9_\.]{2,32})\s*\((.+?)\)/g,c=38,u=40,l=33,d=34,_=35,f=36,h=13,p=27,g=[c,u,l,d,h,p,_,f],m=[l,d,u,c,f,_],b="printable",v="unread",C="all",E="unrespond",y="important",O="mr",T="mr_rejected",w="ad_tag",N="marked_unread",I=[C,v,E,y,O,w],k={[E]:2,[y]:1,[O]:256,[T]:512,[w]:32768,[N]:1<<20},A=[].concat("aaa,aarp,abarth,abb,abbott,abbvie,abc,able,abogado,abudhabi,ac,academy,accenture,accountant,accountants,aco,active,actor,ad,adac,ads,adult,ae,aeg,aero,aetna,af,afamilycompany,afl,africa,ag,agakhan,agency,ai,aig,aigo,airbus,airforce,airtel,akdn,al,alfaromeo,alibaba,alipay,allfinanz,allstate,ally,alsace,alstom,am,americanexpress,americanfamily,amex,amfam,amica,amsterdam,an,analytics,android,anquan,anz,ao,aol,apartments,app,apple,aq,aquarelle,ar,aramco,archi,army,arpa,art,arte,as,asda,asia,associates,at,athleta,attorney,au,auction,audi,audible,audio,auspost,author,auto,autos,avianca,aw,aws,ax,axa,az,azure,ba,baby,baidu,banamex,bananarepublic,band,bank,bar,barcelona,barclaycard,barclays,barefoot,bargains,baseball,basketball,bauhaus,bayern,bb,bbc,bbt,bbva,bcg,bcn,bd,be,beats,beauty,beer,bentley,berlin,best,bestbuy,bet,bf,bg,bh,bharti,bi,bible,bid,bike,bing,bingo,bio,biz,bj,bl,black,blackfriday,blanco,blockbuster,blog,bloomberg,blue,bm,bms,bmw,bn,bnl,bnpparibas,bo,boats,boehringer,bofa,bom,bond,boo,book,booking,boots,bosch,bostik,boston,bot,boutique,box,bq,br,bradesco,bridgestone,broadway,broker,brother,brussels,bs,bt,budapest,bugatti,build,builders,business,buy,buzz,bv,bw,by,bz,bzh,ca,cab,cafe,cal,call,calvinklein,cam,camera,camp,cancerresearch,canon,capetown,capital,capitalone,car,caravan,cards,care,career,careers,cars,cartier,casa,case,caseih,cash,casino,cat,catering,catholic,cba,cbn,cbre,cbs,cc,cd,ceb,center,ceo,cern,cf,cfa,cfd,cg,ch,chanel,channel,chase,chat,cheap,chintai,chloe,christmas,chrome,chrysler,church,ci,cipriani,circle,cisco,citadel,citi,citic,city,cityeats,ck,cl,claims,cleaning,click,clinic,clinique,clothing,cloud,club,clubmed,cm,cn,co,coach,codes,coffee,college,cologne,com,comcast,commbank,community,company,compare,computer,comsec,condos,construction,consulting,contact,contractors,cooking,cookingchannel,cool,coop,corsica,country,coupon,coupons,courses,cr,credit,creditcard,creditunion,cricket,crown,crs,cruise,cruises,csc,cu,cuisinella,cv,cw,cx,cy,cymru,cyou,cz,dabur,dad,dance,data,date,dating,datsun,day,dclk,dds,de,deal,dealer,deals,degree,delivery,dell,deloitte,delta,democrat,dental,dentist,desi,design,dev,dhl,diamonds,diet,digital,direct,directory,discount,discover,dish,diy,dj,dk,dm,dnp,do,docs,doctor,dodge,dog,doha,domains,dot,download,drive,dtv,dubai,duck,dunlop,duns,dupont,durban,dvag,dvr,dz,earth,eat,ec,eco,edeka,edu,education,ee,eg,eh,email,emerck,energy,engineer,engineering,enterprises,epost,epson,equipment,er,ericsson,erni,es,esq,estate,esurance,et,eu,eurovision,eus,events,everbank,exchange,expert,exposed,express,extraspace,fage,fail,fairwinds,faith,family,fan,fans,farm,farmers,fashion,fast,fedex,feedback,ferrari,ferrero,fi,fiat,fidelity,fido,film,final,finance,financial,fire,firestone,firmdale,fish,fishing,fit,fitness,fj,fk,flickr,flights,flir,florist,flowers,fly,fm,fo,foo,food,foodnetwork,football,ford,forex,forsale,forum,foundation,fox,fr,free,fresenius,frl,frogans,frontdoor,frontier,ftr,fujitsu,fujixerox,fun,fund,furniture,futbol,fyi,ga,gal,gallery,gallo,gallup,game,games,gap,garden,gb,gbiz,gd,gdn,ge,gea,gent,genting,george,gf,gg,ggee,gh,gi,gift,gifts,gives,giving,gl,glade,glass,gle,global,globo,gm,gmail,gmbh,gmo,gmx,gn,godaddy,gold,goldpoint,golf,goo,goodhands,goodyear,goog,google,gop,got,gov,gp,gq,gr,grainger,graphics,gratis,green,gripe,group,gs,gt,gu,guardian,gucci,guge,guide,guitars,guru,gw,gy,hair,hamburg,hangout,haus,hbo,hdfc,hdfcbank,health,healthcare,help,helsinki,here,hermes,hgtv,hiphop,hisamitsu,hitachi,hiv,hk,hkt,hm,hn,hockey,holdings,holiday,homedepot,homegoods,homes,homesense,honda,honeywell,horse,hospital,host,hosting,hot,hoteles,hotmail,house,how,hr,hsbc,ht,htc,hu,hughes,hyatt,hyundai,ibm,icbc,ice,icu,id,ie,ieee,ifm,ikano,il,im,imamat,imdb,immo,immobilien,in,industries,infiniti,info,ing,ink,institute,insurance,insure,int,intel,international,intuit,investments,io,ipiranga,iq,ir,irish,is,iselect,ismaili,ist,istanbul,it,itau,itv,iveco,iwc,jaguar,java,jcb,jcp,je,jeep,jetzt,jewelry,jio,jlc,jll,jm,jmp,jnj,jo,jobs,joburg,jot,joy,jp,jpmorgan,jprs,juegos,juniper,kaufen,kddi,ke,kerryhotels,kerrylogistics,kerryproperties,kfh,kg,kh,ki,kia,kim,kinder,kindle,kitchen,kiwi,km,kn,koeln,komatsu,kosher,kp,kpmg,kpn,kr,krd,kred,kuokgroup,kw,ky,kyoto,kz,la,lacaixa,ladbrokes,lamborghini,lamer,lancaster,lancia,lancome,land,landrover,lanxess,lasalle,lat,latino,latrobe,law,lawyer,lb,lc,lds,lease,leclerc,lefrak,legal,lego,lexus,lgbt,li,liaison,lidl,life,lifeinsurance,lifestyle,lighting,like,lilly,limited,limo,lincoln,linde,link,lipsy,live,living,lixil,lk,loan,loans,local,locker,locus,loft,lol,london,lotte,lotto,love,lpl,lplfinancial,lr,ls,lt,ltd,ltda,lu,lundbeck,lupin,luxe,luxury,lv,ly,ma,macys,madrid,maif,maison,makeup,man,management,mango,market,marketing,markets,marriott,marshalls,maserati,mattel,mba,mc,mcd,mcdonalds,mckinsey,md,me,med,media,meet,melbourne,meme,memorial,men,menu,meo,metlife,mf,mg,mh,miami,microsoft,mil,mini,mint,mit,mitsubishi,mk,ml,mlb,mls,mm,mma,mn,mo,mobi,mobile,mobily,moda,moe,moi,mom,monash,money,monster,montblanc,mopar,mormon,mortgage,moscow,moto,motorcycles,mov,movie,movistar,mp,mq,mr,ms,msd,mt,mtn,mtpc,mtr,mu,museum,mutual,mv,mw,mx,my,mz,na,nab,nadex,nagoya,name,nationwide,natura,navy,nba,nc,ne,nec,net,netbank,netflix,network,neustar,new,newholland,news,next,nextdirect,nexus,nf,nfl,ng,ngo,nhk,ni,nico,nike,nikon,ninja,nissan,nissay,nl,no,nokia,northwesternmutual,norton,now,nowruz,nowtv,np,nr,nra,nrw,ntt,nu,nyc,nz,obi,observer,off,office,okinawa,olayan,olayangroup,oldnavy,ollo,om,omega,one,ong,onl,online,onyourside,ooo,open,oracle,orange,org,organic,orientexpress,origins,osaka,otsuka,ott,ovh,pa,page,pamperedchef,panasonic,panerai,paris,pars,partners,parts,party,passagens,pay,pccw,pe,pet,pf,pfizer,pg,ph,pharmacy,philips,phone,photo,photography,photos,physio,piaget,pics,pictet,pictures,pid,pin,ping,pink,pioneer,pizza,pk,pl,place,play,playstation,plumbing,plus,pm,pn,pnc,pohl,poker,politie,porn,post,pr,pramerica,praxi,press,prime,pro,prod,productions,prof,progressive,promo,properties,property,protection,pru,prudential,ps,pt,pub,pw,pwc,py,qa,qpon,quebec,quest,qvc,racing,radio,raid,re,read,realestate,realtor,realty,recipes,red,redstone,redumbrella,rehab,reise,reisen,reit,reliance,ren,rent,rentals,repair,report,republican,rest,restaurant,review,reviews,rexroth,rich,richardli,ricoh,rightathome,ril,rio,rip,rmit,ro,rocher,rocks,rodeo,rogers,room,rs,rsvp,ru,ruhr,run,rw,rwe,ryukyu,sa,saarland,safe,safety,sakura,sale,salon,samsclub,samsung,sandvik,sandvikcoromant,sanofi,sap,sapo,sarl,sas,save,saxo,sb,sbi,sbs,sc,sca,scb,schaeffler,schmidt,scholarships,school,schule,schwarz,science,scjohnson,scor,scot,sd,se,seat,secure,security,seek,select,sener,services,ses,seven,sew,sex,sexy,sfr,sg,sh,shangrila,sharp,shaw,shell,shia,shiksha,shoes,shop,shopping,shouji,show,showtime,shriram,si,silk,sina,singles,site,sj,sk,ski,skin,sky,skype,sl,sling,sm,smart,smile,sn,sncf,so,soccer,social,softbank,software,sohu,solar,solutions,song,sony,soy,space,spiegel,spot,spreadbetting,sr,srl,srt,ss,st,stada,staples,star,starhub,statebank,statefarm,statoil,stc,stcgroup,stockholm,storage,store,stream,studio,study,style,su,sucks,supplies,supply,support,surf,surgery,suzuki,sv,swatch,swiftcover,swiss,sx,sy,sydney,symantec,systems,sz,tab,taipei,talk,taobao,target,tatamotors,tatar,tattoo,tax,taxi,tc,tci,td,tdk,team,tech,technology,tel,telecity,telefonica,temasek,tennis,teva,tf,tg,th,thd,theater,theatre,tiaa,tickets,tienda,tiffany,tips,tires,tirol,tj,tjmaxx,tjx,tk,tkmaxx,tl,tm,tmall,tn,to,today,tokyo,tools,top,toray,toshiba,total,tours,town,toyota,toys,tp,tr,trade,trading,training,travel,travelchannel,travelers,travelersinsurance,trust,trv,tt,tube,tui,tunes,tushu,tv,tvs,tw,tz,ua,ubank,ubs,uconnect,ug,uk,um,unicom,university,uno,uol,ups,us,uy,uz,va,vacations,vana,vanguard,vc,ve,vegas,ventures,verisign,vermögensberater,vermögensberatung,versicherung,vet,vg,vi,viajes,video,vig,viking,villas,vin,vip,virgin,visa,vision,vista,vistaprint,viva,vivo,vlaanderen,vn,vodka,volkswagen,volvo,vote,voting,voto,voyage,vu,vuelos,wales,walmart,walter,wang,wanggou,warman,watch,watches,weather,weatherchannel,webcam,weber,website,wed,wedding,weibo,weir,wf,whoswho,wien,wiki,williamhill,win,windows,wine,winners,wme,wolterskluwer,woodside,work,works,world,wow,ws,wtc,wtf,xbox,xerox,xfinity,xihuan,xin,xperia,xxx,xyz,yachts,yahoo,yamaxun,yandex,ye,yodobashi,yoga,yokohama,you,youtube,yt,yu,yun,za,zappos,zara,zero,zip,zippo,zm,zone,zuerich,zw".split(","),"бг,бел,дети,ею,католик,ком,мкд,мон,москва,онлайн,орг,рус,рф,сайт,срб,укр".split(","),"qxam,90ae,90ais,d1acj3b,e1a4c,80aqecdr1a,j1aef,d1alf,l1acc,80adxhks,80asehdb,c1avg,p1acf,p1ai,80aswg,90a3ac,j1amh,80ao21a,y9a3aq,9dbq2a,mgbca7dzdo,mgba3a3ejt,mgbayh7gpa,lgbbat1ad8j,mgberp4a5d4ar,mgba7c0bbn0a,mgbc0a9azcg,mgb2ddes,mgbaam7a8h,mgba3a4f16a,mgbbh1a,mgbab2bd,ngbe9e0a,mgbbh1a71e,pgbs0dh,mgbpl2fh,ogbpf8fl,ngbc5azd,mgbtx2b,mgb9awbf,ygbi2ammx,wgbl6a,mgbi4ecexp,fhbei,wgbh1c,mgbx4cd0ab,mgbb9fbpob,4gbrim,mgbt3dhd,mgbai9azgqp6j,mgbgu82a,11b4c3d,c2br7g,h2brj9c,h2breg3eve,h2brj9c8c,i1b6b1a6a2e,54b7fta0cc,45brj9c,45br5cyl,s9brj9c,gecrj9c,3hcrj9c,xkc2dl3a5ee0h,xkc2al3hye2a,clchc0ea0b2g2a9gcd,fpcrj9c3d,2scrj9c,rvc1e0am3e,fzc2c9e2c,42c2d9a,o3cw4h,node,q9jyb4c,gckr3f0f,qcka1pmc,tckwe,cck2b3b,1ck2e1b,bck1b9a5dre4c,eckvdtc9d,rhqv96g,fiq64b,fiqs8s,fiqz9s,fiq228c5hs,vhquv,1qqw23a,vuq861b,nyqy26a,45q11c,55qx5d,55qw42g,kprw13d,kpry57d,czru2d,czrs0t,czr694b,w4rs40l,w4r85el8fhu5dnra,3ds443g,3oq18vl8pn36a,pssy2u,tiq49xqyj,fjq720a,fct429k,estv75g,xhq521b,9krt00a,30rr7y,6qq986b3xl,kput3i,kpu716f,zfr164b,mxtq1m,yfro4i67o,efvy88h,9et52u,rovu88b,nqv7f,b4w605ferd,unup4y,mix891f,mix082f,3pxu8k,pbt977c,6frz82g,nqv7fs00ema,ses554g,hxt814e,5tzm5g,io0a7i,8y0a063a,jlq61u9w7b,flw351e,g2xx48c,gk3at1e,3bst00m,fzys8d69uvgm,kcrx77d1x4a,jvr189m,imr513n,5su34j936bgsg,j6w193g,t60b56a,mk1bu44c,cg4bki,3e0b707e".split(",").map(e=>"xn--"+e)),S=A.reduce((e,t)=>Math.max(e,t.length),0),j=new RegExp("([a-zA-Zа-яА-Я\\-_\\.0-9\\+]+@(((?:[\\w\\$А-Яа-яёЁєЄҐґЇїІіЈј\\—\\-\\_]+\\.){1,5})([A-Za-zа-яА-Я\\-\\d]{2,22})))","ig"),L=new RegExp("(https?:\\/\\/)?(((?:[\\w\\$А-Яа-яёЁєЄҐґЇїІіЈј\\—\\-\\_]+\\.){1,5})([A-Za-zа-яА-Я\\-\\d]{2,22})(?:\\:(\\d{2,5}))?)(([\\/?#])(?:\\&amp;|\\&#\\d{2,6};|,[_%]|!|,*[\\wА-Яа-я\\xa8\\xb8\\xc0-\\xffєЄҐґЇїІіЈј\\—\\-\\_@#%?+\\/\\$.~=;:'ªµºÀ-ÖØ-öø-ˁˆ-ˑˠ-ˤˬˮͰ-ʹͶͷͺ-ͽͿΆΈ-ΊΌΎ-ΡΣ-ϵϷ-ҁҊ-ԯԱ-Ֆՙա-ևא-תװ-ײؠ-يٮٯٱ-ۓەۥۦۮۯۺ-ۼۿܐܒ-ܯݍ-ޥޱߊ-ߪߴߵߺࠀ-ࠕࠚࠤࠨࡀ-ࡘࢠ-ࢴࢶ-ࢽऄ-हऽॐक़-ॡॱ-ঀঅ-ঌএঐও-নপ-রলশ-হঽৎড়ঢ়য়-ৡৰৱਅ-ਊਏਐਓ-ਨਪ-ਰਲਲ਼ਵਸ਼ਸਹਖ਼-ੜਫ਼ੲ-ੴઅ-ઍએ-ઑઓ-નપ-રલળવ-હઽૐૠૡૹଅ-ଌଏଐଓ-ନପ-ରଲଳଵ-ହଽଡ଼ଢ଼ୟ-ୡୱஃஅ-ஊஎ-ஐஒ-கஙசஜஞடணதந-பம-ஹௐఅ-ఌఎ-ఐఒ-నప-హఽౘ-ౚౠౡಀಅ-ಌಎ-ಐಒ-ನಪ-ಳವ-ಹಽೞೠೡೱೲഅ-ഌഎ-ഐഒ-ഺഽൎൔ-ൖൟ-ൡൺ-ൿඅ-ඖක-නඳ-රලව-ෆก-ะาำเ-ๆກຂຄງຈຊຍດ-ທນ-ຟມ-ຣລວສຫອ-ະາຳຽເ-ໄໆໜ-ໟༀཀ-ཇཉ-ཬྈ-ྌက-ဪဿၐ-ၕၚ-ၝၡၥၦၮ-ၰၵ-ႁႎႠ-ჅჇჍა-ჺჼ-ቈቊ-ቍቐ-ቖቘቚ-ቝበ-ኈኊ-ኍነ-ኰኲ-ኵኸ-ኾዀዂ-ዅወ-ዖዘ-ጐጒ-ጕጘ-ፚᎀ-ᎏᎠ-Ᏽᏸ-ᏽᐁ-ᙬᙯ-ᙿᚁ-ᚚᚠ-ᛪᛱ-ᛸᜀ-ᜌᜎ-ᜑᜠ-ᜱᝀ-ᝑᝠ-ᝬᝮ-ᝰក-ឳៗៜᠠ-ᡷᢀ-ᢄᢇ-ᢨᢪᢰ-ᣵᤀ-ᤞᥐ-ᥭᥰ-ᥴᦀ-ᦫᦰ-ᧉᨀ-ᨖᨠ-ᩔᪧᬅ-ᬳᭅ-ᭋᮃ-ᮠᮮᮯᮺ-ᯥᰀ-ᰣᱍ-ᱏᱚ-ᱽᲀ-ᲈᳩ-ᳬᳮ-ᳱᳵᳶᴀ-ᶿḀ-ἕἘ-Ἕἠ-ὅὈ-Ὅὐ-ὗὙὛὝὟ-ώᾀ-ᾴᾶ-ᾼιῂ-ῄῆ-ῌῐ-ΐῖ-Ίῠ-Ῥῲ-ῴῶ-ῼⁱⁿₐ-ₜℂℇℊ-ℓℕℙ-ℝℤΩℨK-ℭℯ-ℹℼ-ℿⅅ-ⅉⅎↃↄⰀ-Ⱞⰰ-ⱞⱠ-ⳤⳫ-ⳮⳲⳳⴀ-ⴥⴧⴭⴰ-ⵧⵯⶀ-ⶖⶠ-ⶦⶨ-ⶮⶰ-ⶶⶸ-ⶾⷀ-ⷆⷈ-ⷎⷐ-ⷖⷘ-ⷞⸯ々〆〱-〵〻〼ぁ-ゖゝ-ゟァ-ヺー-ヿㄅ-ㄭㄱ-ㆎㆠ-ㆺㇰ-ㇿ㐀-䶵一-鿕ꀀ-ꒌꓐ-ꓽꔀ-ꘌꘐ-ꘟꘪꘫꙀ-ꙮꙿ-ꚝꚠ-ꛥꜗ-ꜟꜢ-ꞈꞋ-ꞮꞰ-ꞷꟷ-ꠁꠃ-ꠅꠇ-ꠊꠌ-ꠢꡀ-ꡳꢂ-ꢳꣲ-ꣷꣻꣽꤊ-ꤥꤰ-ꥆꥠ-ꥼꦄ-ꦲꧏꧠ-ꧤꧦ-ꧯꧺ-ꧾꨀ-ꨨꩀ-ꩂꩄ-ꩋꩠ-ꩶꩺꩾ-ꪯꪱꪵꪶꪹ-ꪽꫀꫂꫛ-ꫝꫠ-ꫪꫲ-ꫴꬁ-ꬆꬉ-ꬎꬑ-ꬖꬠ-ꬦꬨ-ꬮꬰ-ꭚꭜ-ꭥꭰ-ꯢ가-힣ힰ-ퟆퟋ-ퟻ豈-舘並-龎ﬀ-ﬆﬓ-ﬗיִײַ-ﬨשׁ-זּטּ-לּמּנּסּףּפּצּ-ﮱﯓ-ﴽﵐ-ﶏﶒ-ﷇﷰ-ﷻﹰ-ﹴﹶ-ﻼＡ-Ｚａ-ｚｦ-ﾾￂ-ￇￊ-ￏￒ-ￗￚ-ￜ　-〿＀-￯*]+|(?:\\(|\\[)[\\w\\$А-Яа-яёЁєЄҐґЇїІіЈј\\d&#%;,]+(?:\\)|\\])){0,200})?","ig"),M="(?:[a-zA-Zа-яА-ЯёіјєїґўЁІЈЄЇҐЎ’_\\d]|(?:&#(?:19[2-9]|(?:[2-9]|1[0-3])[0-9][0-9]);?))",P=`(^|[s.,:'";>)(]?)(${`(#${M}{0,100}(?:[a-zA-Zа-яА-ЯёіјєїґўЁІЈЄЇҐЎ’]|(?:&#(?:19[2-9]|(?:[2-9]|1[0-3])[0-9][0-9]);?))${M}{0,100})`})(@((?:[a-z0-9_]*[a-z0-9])?(?:(?:.[a-z](?:[a-z0-9_]+[a-z0-9])?)*.[a-z][a-z0-9_]{2,40}[a-z0-9])?))?(?=$|[s.,:'"&;?<)(]?)`,F={all:["all","everyone","все"],online:["online","here","здесь","тут"]},R=new RegExp(['(?!,|;|:|\\.|\\s|"|\\(|\\)|\\[|\\]|!|\\?)',"(",[].concat(F.all).concat(F.online).map(e=>`@${e}|\\*${e}`).join("|"),")",'(?=$|,|;|:|\\.(?![a-z0-9_-])|\\s|"|\\(|\\)|\\[|\\]|!|\\?)'].join(""),"gi"),x=10},hOuX:function(e,t,n){"use strict";n.r(t),n.d(t,"MAX_SAFE_INTEGER",(function(){return r})),n.d(t,"MAX_INTERGER",(function(){return a})),n.d(t,"random",(function(){return i}));n("tuSo");var r=9007199254740991,a=2147483647;function i(){try{if(window.crypto){var e=new Int32Array(1);return crypto.getRandomValues(e),Math.abs(e.reduce((e,t)=>e+t))}}catch(e){}return intval(rand(0,a).toFixed(0))}},j0Lq:function(__webpack_module__,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__);var core_js_modules_es6_regexp_match__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("SRfc"),core_js_modules_es6_regexp_replace__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("pIFo"),core_js_modules_es6_regexp_split__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("KKXr"),core_js_modules_es6_regexp_to_string__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("a1Th"),core_js_modules_es6_object_to_string__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("Btvt"),_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("Egk5"),_web_lib_ui__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__("v+DW"),_web_lib_message_box__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__("EasH"),_web_lib_tooltip_utils__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__("FWc3"),_web_lib_debug_tools__WEBPACK_IMPORTED_MODULE_9__=__webpack_require__("98sY"),_shared_user_user_env__WEBPACK_IMPORTED_MODULE_10__=__webpack_require__("W9Tc"),_shared_lib_js_logger__WEBPACK_IMPORTED_MODULE_11__=__webpack_require__("HLtZ"),_web_lib_fx__WEBPACK_IMPORTED_MODULE_12__=__webpack_require__("7jxN"),_shared_lib_web_stats__WEBPACK_IMPORTED_MODULE_13__=__webpack_require__("Bj12");window.TopNotifierCur||(window.TopNotifierCur={link:"top_notify_btn",count:"top_notify_count",_qParams:{section:"notifications",_tb:1,list:""},loaded:!1,loading:!1,from:"",viewsObserver:null,viewedNotifications:[]}),window.TopNotifier={onBellMouseDown:function(e){return!Object(_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_5__.checkKeyboardEvent)(e)&&TopNotifier.show(e)},onBellClick:function(e){return!!checkEvent(e)||!!Object(_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_5__.checkKeyboardEvent)(e)&&TopNotifier.show(e)},onLoad:function onLoad(rows,js,from,header){if(!from||TopNotifierCur.from!==from){void 0!==rows&&"undefined"!==rows||Object(_shared_lib_js_logger__WEBPACK_IMPORTED_MODULE_11__.logError)("TopNotifier load undefinded response",{environment:"top_notify"});var evalExpr=`(function(){${js};})()`;try{eval(evalExpr)}catch(e){Object(_web_lib_debug_tools__WEBPACK_IMPORTED_MODULE_9__.logEvalError)(e,evalExpr)}TopNotifierCur.loaded=!0,val(TopNotifier.getContentNode(),rows),TopNotifier.trackViews(),show(geByClass1("top_notify_show_all")),TopNotifier.refreshHeader(header),TopNotifier.cleanCount(),TopNotifier.refreshCounters(),TopNotifierCur.from=from}},trackViews:function(){var e=ge("top_notify_cont");"IntersectionObserver"in window&&(TopNotifierCur.viewsObserver&&TopNotifierCur.viewsObserver.disconnect(),TopNotifierCur.viewsObserver=new IntersectionObserver((function(e){e.forEach(e=>{var t=e.target.parentNode.dataset.notification_id;e.isIntersecting&&-1===TopNotifierCur.viewedNotifications.indexOf(t)&&(TopNotifierCur.viewedNotifications.push(t),Object(_shared_user_user_env__WEBPACK_IMPORTED_MODULE_10__.partConfigEnabled)("notifications_view_new")?Object(_shared_lib_web_stats__WEBPACK_IMPORTED_MODULE_13__.saveStatlogEvents)({name:"notifications_views",value:t,keys:[]}):statlogsValueEvent("notifications_views",t))})}),{root:e,threshold:.6}),geByClass("feedback_row",e).forEach((function(e){TopNotifierCur.viewsObserver.observe(e)})))},refreshHeader:function(e){var t,n=geByClass1("_notify_unread"),r=e&&!geByClass1("_top_notify_header"),a=n&&n.offsetHeight;if(r?(TopNotifierCur.header=se(e),t=ce("div",{className:"top_notify_header_label"}),TopNotifierCur.header.appendChild(t)):t=geByClass1("top_notify_header_label",TopNotifierCur.header),r){val(t,"");var i="";TopNotifierCur.notify_sources.forEach((function(e){""!==e.list&&e.list===TopNotifierCur._qParams.list&&(i=e.name)})),""===i&&(i=getLang("global_notifications_user"));var o,s=ce("div",{className:"top_notify_header_sup_label"}),c=ce("span",{className:"top_notify_header_label_user",innerHTML:i}),u=ce("span",{className:"top_notify_header_label_groups"}),l=ce("a",{onmouseover:function(e){TopNotifier.getSourcesTip(this,e)},className:"top_notify_header_label_groups_link",innerHTML:getLang("global_notifications_groups")});if(u.appendChild(l),o=ce("span",{className:"top_notify_header_label_groups_counter",innerHTML:""}),s.appendChild(c),cur.user_has_admined_groups>0&&(s.appendChild(u),s.appendChild(o)),t.appendChild(s),a){var d=ce("div",{className:"top_notify_header_sub_label",innerHTML:getLang("global_viewed_notifications")});t.appendChild(d)}}r&&TopNotifierCur.wrapper.insertBefore(TopNotifierCur.header,TopNotifierCur.wrapper.firstChild),TopNotifierCur.header_unread=geByClass1("_notify_header"),TopNotifierCur.header_unread&&(a?(TopNotifierCur.header_unread_hidden&&slideDown(TopNotifierCur.header_unread,100),TopNotifierCur.header_unread_hidden=!1,TopNotifierCur.header_unread_handler||(TopNotifierCur.header_unread_height=TopNotifierCur.header_unread.offsetHeight,TopNotifierCur.header_unread_handler=function(e){if(TopNotifierCur.header_unread){var t=TopNotifierCur.header_unread.offsetTop+TopNotifierCur.header_unread_height<e.data.scrollTop;t!=TopNotifierCur.swaped&&(toggleClass(TopNotifierCur.header,"top_notify_header_swap_labels",t),TopNotifierCur.swaped=t)}},TopNotifierCur.scrollbar.emitter.addListener("update",TopNotifierCur.header_unread_handler))):(TopNotifierCur.header_unread_hidden||slideUp(TopNotifierCur.header_unread,100),TopNotifierCur.header_unread_hidden=!0,TopNotifierCur.header_unread_handler&&(TopNotifierCur.scrollbar.emitter.removeListener("update",TopNotifierCur.header_unread_handler),TopNotifierCur.header_unread_handler=null)))},preload:function(){TopNotifier.shown()||vk.isBanned||TopNotifierCur.loaded||ajax.post("/al_feed.php",extend(clone(TopNotifierCur._qParams),{_preload:1}),{cache:1,onDone:function(e,t,n,r){TopNotifier.shown()&&geByClass1("pr","top_notify_cont")&&(TopNotifier.onLoad(e,t,n,r),TopNotifierCur.loaded=!0)},stat:["feed.css","page.css","post.css"]})},loadMore:function loadMore(){var btn=ge("ui_top_notify_load_more");btn&&!Object(_web_lib_ui__WEBPACK_IMPORTED_MODULE_6__.isButtonLocked)(btn)&&(TopNotifierCur.ajax=ajax.post("/al_feed.php",extend(clone(TopNotifierCur._qParams),{from:TopNotifierCur.from,more:1,need_header:intval(!(geByClass1("_notify_header")||!geByClass1("_notify_sticky")&&!geByClass1("_notify_unread")))}),{onDone:function onDone(rows,js,newFrom){if(TopNotifierCur.scrollbar){var evalExpr=`(function(){${js};})()`;try{eval(evalExpr)}catch(e){Object(_web_lib_debug_tools__WEBPACK_IMPORTED_MODULE_9__.logEvalError)(e,evalExpr)}if(rows){for(var row=null,cont=TopNotifier.getContentNode(),au=cf(rows);row=au.firstChild;)cont.insertBefore(row,btn);TopNotifier.refreshHeader(),TopNotifier.trackViews()}newFrom?TopNotifierCur.from=newFrom:re(btn)}},showProgress:function(){show(btn),Object(_web_lib_ui__WEBPACK_IMPORTED_MODULE_6__.lockButton)(btn)},hideProgress:function(){hide(btn),Object(_web_lib_ui__WEBPACK_IMPORTED_MODULE_6__.unlockButton)(btn)}}))},updateTime:function(e){each(geByClass("rel_date_needs_update",e,"span"),(function(e,t){if(t){var n=intval(t.getAttribute("time")),r=60*((new Date).getTimezoneOffset()+180),a=getDateText(n,r);!0===hasClass(this,"ucfirst")&&(a=a.charAt(0).toUpperCase()+a.slice(1)),t.innerHTML=a}}))},createNewEventsBox:function(e){if(Object(_shared_user_user_env__WEBPACK_IMPORTED_MODULE_10__.partConfigEnabled)("notify_new_events_box")){var t=TopNotifier.getContentNode();if(t){var n=geByClass1("notifications_new_events",t);e>0?(n||((n=document.createElement("div")).className="feed_row _feed_row notifications_new_events",n.onclick=function(e){n.onclick=null,showProgress(n),TopNotifierCur._qParams.list="",TopNotifier.refresh(e,!1)}),n.innerHTML=langStr(getLang("notifications_new_events",e),"count",e),t.insertBefore(n,t.children[0])):n&&!TopNotifierCur.loading&&re(n)}}},show:function(e){if(gpeByClass("top_notify_cont",e.target))return!0;if(!0!==checkEvent(e)&&!vk.isBanned){if(TopNotifier.shown())return gpeByClass("top_notify_wrap",e.target,ge("top_nav"))||TopNotifier.hide(),cancelEvent(e);var t=ge(TopNotifierCur.link),n=ge("top_notify_cont");TopNotifier.updateTime(n),TopNotifierCur.timeUpdateInt=setInterval((function(){TopNotifier.updateTime(n)}),1e4),cur.introNotifyTooltipHide&&(cur.introNotifyTooltipHide(),delete cur.introNotifyTooltipHide),t.tt&&t.tt.hide&&t.tt.hide(),n||(TopNotifierCur.wrapper=ce("div",{innerHTML:'<div id="top_notify_cont" class="top_notify_cont wall_module" ontouchstart="event.cancelBubble = true;" onmousedown="event.cancelBubble = true;"></div><a href="/feed?section=notifications'+(TopNotifierCur._qParams.list?"&list="+TopNotifierCur._qParams.list:"")+'" class="top_notify_show_all" onmousedown="event.cancelBubble = true;" onclick="TopNotifier.hide(); return nav.go(this, event);">'+getLang("global_notify_show_all")+"</a>",id:"top_notify_wrap",className:"scroll_fix_wrap top_notify_wrap"}),t.appendChild(TopNotifierCur.wrapper),n=ge("top_notify_cont"));var r=window.innerHeight||document.documentElement.clientHeight;setStyle(n,{maxHeight:Math.min(Math.max(r-200,300),600)}),addClass(TopNotifierCur.link,"active");var a=uiScroll;return TopNotifierCur.scrollbar&&TopNotifierCur.scrollbar.container.__uiScroll__||(TopNotifierCur.scrollbar=new a(n,{global:!0,stopScrollPropagationAlways:!0,onmore:TopNotifier.loadMore})),TopNotifierCur.loaded?TopNotifier.trackViews():TopNotifier.refresh(),window.pushNotifier&&window.pushNotifier.cleanNotification(),cancelStackPush("top_notifier",TopNotifier.hide.bind(TopNotifier),!0),cancelEvent(e)}},hide:function(){TopNotifier.shown()&&(TopNotifierCur.viewedNotifications=[],removeClass(TopNotifierCur.link,"active"),clearInterval(TopNotifierCur.timeUpdateInt),cancelStackFilter("top_notifier",!0),""!==TopNotifierCur._qParams.list&&(TopNotifierCur._qParams.list="",TopNotifier.invalidate()))},shown:function(){return hasClass(TopNotifierCur.link,"active")},getContentNode:function(){return TopNotifierCur.scrollbar&&TopNotifierCur.scrollbar.content&&TopNotifierCur.scrollbar.container.__uiScroll__?TopNotifierCur.scrollbar.content:ge("top_notify_cont")},showProgress:function(e){function t(){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}((function(){var e=TopNotifier.getContentNode();geByClass1("pr",e)||(val(e,""),showProgress(e))})),hideProgress:function(e){function t(){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}((function(){var e=TopNotifier.getContentNode();val(e,""),hideProgress(e)})),showTooltip:function(e,t){if(!TopNotifier.shown()&&!isVisible("dev_top_nav")){var n=ge(TopNotifierCur.link),r={};if(n){if("shownow"==n.tt&&removeAttr(n,"tt"),e)r.text=function(){return e},t&&(r.onHide=o.pbind(t));else{n.tt&&n.tt.destroy&&n.tt.destroy();var a=ls.get("ntfseen")||{},i=[];each(a,(function(e,t){i.push(e+":"+t)})),r=extend(r,{url:"al_feed.php",params:{act:"a_last_notify",seen:i.join(";")},ajaxdt:2e3,noload:1,onHide:o})}Object(_web_lib_tooltip_utils__WEBPACK_IMPORTED_MODULE_8__.showTooltip)(n,extend(r,{typeClass:"top_notify_tt",dir:"up",width:250,shift:[1,0],nohideover:1,nohide:1,onShowStart:function(e){TopNotifier.shown()&&(e.opts.onHide=!1,e.hide()),addEvent(e.container,"mousedown",(function(e){if(!e||!inArray(e.target.tagName,["A","IMG"]))return TopNotifier.show(e),cancelEvent(e)})),function e(t){setTimeout((function(){window.curNotifier&&curNotifier.idle_manager&&curNotifier.idle_manager.is_idle?e(t):(t&&t.hide(),Notifier.lcSend("hide_notify_tt"))}),6e3)}(e),Notifier.setRecvClbk("hide_notify_tt",e.hide)}}))}}function o(e){if(!e&&cur.topNotifyTTKey&&(e=cur.topNotifyTTKey,delete cur.topNotifyTTKey),e){var t=e.split(":"),n=ls.get("ntfseen")||{};2===t.length&&(n[0]=parseInt((new Date).getTime()/1e3),n[t[0]]=t[1],ls.set("ntfseen",n))}}},invalidate:function(){TopNotifierCur.loaded=!1,TopNotifierCur.from="",ajax.invalidate("/al_feed.php",TopNotifierCur._qParams),TopNotifierCur.ajax&&TopNotifierCur.ajax.abort()},setCount:function(e,t){isString(e)&&(e=trim(e)),parseInt(e)>=100&&(e="+99"),hasClass(TopNotifierCur.link,"has_notify")&&e?Object(_web_lib_fx__WEBPACK_IMPORTED_MODULE_12__.animateCount)(TopNotifierCur.count,e,{str:"auto"}):val(TopNotifierCur.count,e),toggleClass(TopNotifierCur.link,"has_notify",!!e),t||TopNotifier.invalidate()},cleanCount:function(){if(cur.topNotifyHash){var e=cur.groupNotify_readGids||[];cur.groupNotify_readGids=[],TopNotifierCur.notify_sources.forEach((function(t,n){var r=parseInt(t.list.replace("group-",""));t.list!==TopNotifierCur._qParams.list&&-1===e.indexOf(r)||(TopNotifierCur.notify_sources[n].counter=0)})),ajax.post("/al_feed.php",{act:"a_clean_notify",hash:cur.topNotifyHash,list:TopNotifierCur._qParams.list,gn_readGids:e})}},refresh:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];null!==e&&cancelEvent(e),TopNotifier.invalidate(),TopNotifierCur.wrapper&&!TopNotifierCur.loading&&(TopNotifierCur.loading=!0,t&&(re(geByClass1("_notify_header")),re(geByClass1("_top_notify_header"))),TopNotifierCur.from=0,ajax.post("/al_feed.php",TopNotifierCur._qParams,{cache:1,onDone:(e,t,n,r)=>{TopNotifierCur.loading=!1,TopNotifier.onLoad(e,t,n,r)},showProgress:()=>{t&&TopNotifier.showProgress()},stat:["feed.css"],onFail(){TopNotifierCur.loading=!1,hide(geByClass1("top_notify_show_all")),TopNotifier.hideProgress(),val(TopNotifier.getContentNode(),'<div class="top_notify_empty no_rows error_message"><div>'+getLang("global_notify_error_occured")+'</div><button class="flat_button button_small secondary" onclick="TopNotifier.refresh(event);">'+getLang("global_notify_refresh")+"</button></div>")},no_ads_params:!0}))},unifiedDeleteRow:function(e,t,n,r,a){cancelEvent(e);var i=gpeByClass("feed_row",a),o=geByClass1("post_actions",i),s=geByClass1("feedback_row_wrap",i);ajax.post("al_feed.php",{act:"a_feedback_unified_delete",query:t,hash:n,from:"top_notifier"},{onDone:function(e){"."!==r.substr(-1)&&(r+=".");var a=getLang("notifications_cancel_disable"),o=`${r} <a onclick="TopNotifier.unifiedRestoreRow('${t}', '${n}', this);return cancelEvent(event);">${a}</a>`;e&&(o+="<br>"+e);var c=ce("div",{className:"feedback_deleted_container"});c.appendChild(ce("div",{className:"feedback_row dld _feedback_deleted _top_feedback_deleted",innerHTML:o})),i.appendChild(c),hide(s),hasClass(i,"feedback_row_clickable")&&addClass(i,"feedback_row_touched")},showProgress:addClass.pbind(o,"post_actions_progress"),hideProgress:removeClass.pbind(o,"post_actions_progress")})},unifiedRestoreRow:function(e,t,n){var r=gpeByClass("feed_row",n),a=gpeByClass("feedback_deleted_container",geByClass1("_feedback_deleted",r)),i=geByClass1("feedback_row_wrap",r);if(a&&i){var o=ce("span",{className:"progress_inline"});ajax.post("al_feed.php",{act:"a_feedback_unified_restore",query:e,hash:t,from:"top_notifier"},{onDone:function(){show(i),re(a),removeClass(r,"feedback_row_touched")},showProgress:()=>n.parentNode.replaceChild(o,n),hideProgress:()=>o.parentNode.replaceChild(n,o)})}},notifyMarkSpam:function(e,t){ajax.post("al_feed.php",{act:"a_feedback_mark_spam",item:e,hash:t},{onDone:function(t){ge("notify_mark_spam_"+e).innerHTML=t}})},notifyDeleteAll:function(e,t,n,r){if(cur.notifyDeletingAll||(cur.notifyDeletingAll={}),!cur.notifyDeletingAll[e]){cur.notifyDeletingAll[e]=1;var a=ce("span",{className:"progress_inline"});ajax.post("al_feed.php",{act:"a_feedback_delete_all",uid:e,item:n,hash:t},{onDone:function(t,n){var a=gpeByClass("_feedback_deleted",r);if(1!=n){var i,o=!1;if((o=hasClass(a,"_top_feedback_deleted")?ge("top_notify_cont"):cur.rowsCont)&&(i=o.firstChild)){var s,c,u=!1,l=scrollGetY();do{i.className&&hasClass(i,"_feed_row")&&i.firstChild&&e==i.firstChild.getAttribute("author")&&(s=i.offsetHeight,c=i.offsetTop,!1===u&&(u=getXY(i.offsetParent)[1]),hide(i),c+u<l&&(l-=s,scrollToY(l,0)))}while(i=i.nextSibling);(0===cur.wasScroll||cur.wasScroll>0)&&(cur.wasScroll=l)}a.innerHTML='<span class="dld_inner">'+t+"</span>"}else re(gpeByClass("_feed_row",a))},showProgress:function(){r&&"button"===r.tagName.toLowerCase()?Object(_web_lib_ui__WEBPACK_IMPORTED_MODULE_6__.lockButton)(r):r.parentNode.replaceChild(a,r)},hideProgress:function(){r&&"button"===r.tagName.toLowerCase()?Object(_web_lib_ui__WEBPACK_IMPORTED_MODULE_6__.unlockButton)(r):a.parentNode.replaceChild(r,a)}})}},checkClick:function(e,t){if(t=t||window.event,!e||!t)return!0;TopNotifier.trackClick(t.target);var n=t.target||t.srcElement,r=8,a=!1,i=/(feedback_row)/;do{if(!n||n===e||n.onclick||n.onmousedown||inArray(n.tagName,["A","IMG","TEXTAREA","EMBED","OBJECT"])||(a=n.className.match(i)))break}while(r--&&(n=n.parentNode));return!!a&&(n||!0)},detectClickRegion:function(e){switch(e.tagName){case"BUTTON":for(var t=e.parentNode.childNodes,n=1,r=0;r<t.length;++r)t[r]===e&&(n=r+1);return"button"+n;case"IMG":return e.dataset.elementName;default:return e.parentNode.closest(".feedback_attachments")?"attachments":"cell"}},trackClick:function(e){var t=e.closest(".feedback_row");if(t){for(var n=t.parentNode,r=TopNotifier.detectClickRegion(e),a=-1,i=geByClass("feedback_row"),o=0;o<i.length;++o)if(i[o]===t){a=o;break}statlogsValueEvent("notifications_click",0,n.dataset.notification_type,a,n.dataset.notification_id,r)}},loadMoreUngrouped:(e,t,n)=>{ajax.post("/al_feed.php",{act:"ungroup_notifications",query:t,from:n},{onDone:(n,r,a)=>{if(!r&&a){if(!n)return TopNotifier.loadMoreUngrouped(e,t,a),!1;n+='<div class="feedback_group_loadmore_button" onclick="TopNotifier.loadMoreUngrouped(this, \''+t+"', '"+a+"')\">"+getLang("notifications_show_more")+"</div>"}e.outerHTML=n},showProgress:function(e){function t(){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}(()=>{e.innerHTML="",showProgress(e)}),hideProgress:()=>e.innerHTML=getLang("notifications_show_more"),no_ads_params:!0})},ungroupUnified:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";if(null!==n){var a=gpeByClass("feed_row",e),i=geByClass1("post_actions",a);ajax.post("/al_feed.php",{act:"ungroup_notifications",query:n,from:r},{onDone:(r,a,i)=>{if(!a&&i){if(!r)return TopNotifier.ungroupUnified(e,t,n,i),!1;r+='<div class="feedback_group_loadmore_button" onclick="TopNotifier.loadMoreUngrouped(this, \''+n+"', '"+i+"')\">"+getLang("notifications_show_more")+"</div>"}e.parentNode.outerHTML=r},showProgress:addClass.pbind(i,"post_actions_progress"),hideProgress:removeClass.pbind(i,"post_actions_progress"),no_ads_params:!0})}else e=domClosest("_feed_row",e),show(domNS(e)),re(e);t.stopPropagation(),t.preventDefault()},showActionsMenu:function(e){var t=!1,n=domClosest("_feed_row",e),r=domPN(n);hasClass(r,"_notify_unread")&&(r=domPN(r)),r.lastChild!=n||hasClass(r,"feed_row_fb_hidden")||hasClass(r,"feedback_sticky_rows")&&domPN(r).lastChild!=r||(t={appendParentCls:"top_notify_wrap",processHoverCls:hasClass(domPN(e),"post_actions")?"feedback_row":"feedback_sticky_row"}),uiActionsMenu.show(e,!1,t)},hideActionsMenu:function(e){uiActionsMenu.hide(e)},frProcess:function(e,t,n,r){var a;Object(_web_lib_ui__WEBPACK_IMPORTED_MODULE_6__.isButtonLocked)(n)||(a=r?{act:"add",mid:e,hash:t,request:1,from:"top_notifier"}:{act:"remove",mid:e,hash:t,report_spam:1,from:"top_notifier"},statlogsValueEvent("feed_top_notify",0,"friends",a.act),ajax.post("/al_friends.php",a,{onDone:function(t){var a=domPN(n);val(a,t),addClass(a,"feedback_buttons_response"),"friends"==cur.module&&window.Friends&&(val("request_controls_"+e,t),window.Friends.processRequest(e,r))},onFail:function(e){if(e)return setTimeout(Object(_web_lib_message_box__WEBPACK_IMPORTED_MODULE_7__.showFastBox)(getLang("global_error"),e).hide,3e3),!0},showProgress:_web_lib_ui__WEBPACK_IMPORTED_MODULE_6__.lockButton.pbind(n),hideProgress:_web_lib_ui__WEBPACK_IMPORTED_MODULE_6__.unlockButton.pbind(n)}))},apiCallProcess:function(e,t,n,r,a,i,o,s){if(Object(_web_lib_ui__WEBPACK_IMPORTED_MODULE_6__.isButtonLocked)(s))return!1;var c=function(){ajax.post("/al_feed.php",{act:"a_api_call",hash:cur.topNotifyHash,query:e},{onDone:function(e){var r=domPN(s);val(r,`<div class="feedback_apicallText">${n?`<div class="feedback_apicallIcon ${n}Icon"></div>`:""}${t}</div>`)},onFail:function(e){if(e)return setTimeout(Object(_web_lib_message_box__WEBPACK_IMPORTED_MODULE_7__.showFastBox)(getLang("global_error"),e).hide,3e3),!0},showProgress:_web_lib_ui__WEBPACK_IMPORTED_MODULE_6__.lockButton.pbind(s),hideProgress:_web_lib_ui__WEBPACK_IMPORTED_MODULE_6__.unlockButton.pbind(s)})};return a?(r=r||getLang("global_action_confirmation"),cur.confirmBox=Object(_web_lib_message_box__WEBPACK_IMPORTED_MODULE_7__.showFastBox)(r,a,i,(function(){c(),cur.confirmBox.hide()}),o)):c(),!0},grProcess:function(e,t,n,r){if(!(hasClass(n,"flat_button")&&Object(_web_lib_ui__WEBPACK_IMPORTED_MODULE_6__.isButtonLocked)(n)||domFC(n)&&"progress_inline"==domFC(n))){var a=-2==r?"spam":r?"enter":"leave",i=-1==r?"_decline":"";ajax.post("/al_groups.php",{act:a,gid:e,hash:t,from:"top_notifier",context:i},{onDone:function(e){var t=domPN(n);val(t,e),addClass(t,"feedback_buttons_response")},onFail:function(e){if(e)return setTimeout(Object(_web_lib_message_box__WEBPACK_IMPORTED_MODULE_7__.showFastBox)(getLang("global_error"),e).hide,3e3),!0},showProgress:function(){if(-2==r){n.oldhtml=n.innerHTML;var e=getSize(n)[0];n.innerHTML='<span class="progress_inline"></span>',setStyle(domFC(n),{width:e})}else Object(_web_lib_ui__WEBPACK_IMPORTED_MODULE_6__.lockButton)(n)},hideProgress:function(){-2==r?n.innerHTML=n.oldhtml:Object(_web_lib_ui__WEBPACK_IMPORTED_MODULE_6__.unlockButton)(n)}})}},gn_grProcess:function(e,t,n,r,a,i){return a.stopPropagation(),hasClass(r,"flat_button")&&Object(_web_lib_ui__WEBPACK_IMPORTED_MODULE_6__.isButtonLocked)(r)||domFC(r)&&"progress_inline"==domFC(r)||ajax.post("groupsedit.php",{act:"user_action",id:e,addr:t,hash:n,from:"top_notifier",action:i},{onDone:function(e){var t=domPN(r);return val(t,e),addClass(t,"feedback_buttons_response"),!1},onFail:function(e){return!!e&&(setTimeout(Object(_web_lib_message_box__WEBPACK_IMPORTED_MODULE_7__.showFastBox)(getLang("global_error"),e).hide,3e3),!1)},showProgress:function(){Object(_web_lib_ui__WEBPACK_IMPORTED_MODULE_6__.lockButton)(r)},hideProgress:function(){Object(_web_lib_ui__WEBPACK_IMPORTED_MODULE_6__.unlockButton)(r)}}),!1},showGiftBox:function(e,t,n){return!showBox("al_gifts.php",{act:"get_gift_box",fids:e,fr:1,ref:n},{stat:["gifts.css","wide_dd.js","wide_dd.css"],cache:1,dark:1},t)},getSourcesTip:function(e,t){return cancelEvent(t),Object(_web_lib_tooltip_utils__WEBPACK_IMPORTED_MODULE_8__.showTooltip)(e,{url:"/al_page.php",params:{act:"notify_get_sources",cur_list:TopNotifierCur._qParams.list},slide:15,ajxdt:200,hidedt:200,dir:"bottom",shift:[100,10],id:"notify_sources",className:"notify_sources",onShowStart:function(){TopNotifierCur.notify_sources.forEach((function(e){val(geByClass1("notify_tooltip_counter"+e.list),e.counter>0?e.counter:"")})),TopNotifier.refreshTooltip()}}),!1},changeSource:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;null!==n&&cancelEvent(n),e!==TopNotifierCur._qParams.list?(re(geByClass1("notify_sources")),t&&val(geByClass1("ui_rmenu_count",t),""),geByClass1("top_notify_show_all")&&attr(geByClass1("top_notify_show_all"),"href","/feed?section=notifications"+(e?"&list="+e:"")),TopNotifierCur._qParams.list=e,TopNotifier.refresh()):hide(geByClass1("notify_sources"))},changeSourceFullCallback:function(){TopNotifier.refreshCounters(),TopNotifierCur.notify_sources.forEach((function(e){e.list&&val(geByClass1("ui_rmenu_count",geByClass1("feed_section_"+e.list)),e.counter>0?e.counter:"")}));var e=geByTag1("a",geByClass1("header_side_link",geByClass1("feed_notifications")));""===TopNotifierCur.settings_url?hide(e):(show(e),attr(e,"href",TopNotifierCur.settings_url)),TopNotifierCur.source_name||(TopNotifierCur.source_name=getLang("news_title_notifications")),val(geByClass1("page_block_header_inner",geByClass1("feed_notifications")),TopNotifierCur.source_name)},hideBanner:function(e,t,n){ajax.post("al_feed.php",{act:"a_feedback_hide_banner",group_id:n,hash:t}),hide(ge("internal_notification131"))},addNewSource:function(e,t,n){return ajax.post("al_settings.php",{act:"a_group_notify_add_source",gid:e,from:n,hash:t},{onDone:function(t){nav.go("/settings?act=group_notify&gid="+e),TopNotifier.changeSource("group-"+e,null,null)},showProgress:_web_lib_ui__WEBPACK_IMPORTED_MODULE_6__.lockButton.pbind(cur.popupSubmitBtnEl),hideProgress:_web_lib_ui__WEBPACK_IMPORTED_MODULE_6__.unlockButton.pbind(cur.popupSubmitBtnEl)}),!0},refreshCounters:function(){var e=0,t=0,n=0,r=geByClass1("top_notify_header_label_groups_counter");TopNotifierCur.notify_sources.forEach((function(r){""!==r.list&&r.counter>0&&(1===r.unmuted?t++:e++),""===r.list&&(n=r.counter)})),vk.counts.ntf=n+t,TopNotifier.setCount(n+t,!0),TopNotifier.createNewEventsBox(n),t>0?(addClass(r,"unmuted"),val(r,t)):(removeClass(r,"unmuted"),val(r,e>0?e:""))},refreshTooltip:function(){var e=geByClass1("groups",geByClass1("notify_sources")),t=[],n=[],r=ce("div");e&&(geByClass("line_cell",e).forEach((function(e,r){val(geByClass1("ui_rmenu_count",e))>0?t.push(e):n.push(e)})),t.concat(n).forEach((function(e){r.appendChild(e)})),val(e,""),e.appendChild(r))},showCommonFriendsBox:function(e,t){return showTabbedBox("al_page.php",{act:"box",oid:t,tab:"common"},{cache:1},e),!1}}},lJdi:function(e,t,n){"use strict";n.r(t),n.d(t,"MAIL_CHAT_FLAG_ONLY_ADMINS_CAN_INVITE",(function(){return c})),n.d(t,"MAIL_CHAT_FLAG_ONLY_ADMINS_CAN_PIN",(function(){return u})),n.d(t,"MAIL_CHAT_FLAG_ONLY_ADMINS_CAN_CHANGE_TITLE",(function(){return l})),n.d(t,"MAIL_CHAT_FLAG_ADMINS_CAN_ADD_ADMINS",(function(){return d})),n.d(t,"MAIL_CHAT_FLAG_ADMINS_CAN_INVITE_LINK",(function(){return _})),n.d(t,"MAIL_CHAT_FLAG_SERVICE_CHAT",(function(){return f})),n.d(t,"MAIL_CHAT_FLAG_IS_CHANNEL",(function(){return h})),n.d(t,"MAIL_CHAT_FLAG_IS_SUPERGROUP",(function(){return p})),n.d(t,"MAIL_CHAT_FLAG_IS_FAKE_CHANNEL",(function(){return g})),n.d(t,"MAIL_CHAT_FLAG_IS_PROMO_CHAT",(function(){return m})),n.d(t,"MAIL_CHAT_FLAG_IS_BUSINESS_NOTIFY",(function(){return b})),n.d(t,"MAIL_CHAT_FLAG_DENY_ANYONE_TO_WRITE",(function(){return v})),n.d(t,"MAIL_CHAT_FLAG_IS_CASPER",(function(){return C})),n.d(t,"MAIL_CHAT_FLAG_IS_COPIED",(function(){return E})),n.d(t,"MAIL_CHAT_FLAG_IS_COMMUNITY_CHAT",(function(){return y})),n.d(t,"MAIL_CHAT_FLAG_IS_COMMUNITY_CHAT_DELETED",(function(){return O})),n.d(t,"MAIL_CHAT_FLAG_ONLY_ADMINS_CAN_MASS_MENTION",(function(){return T})),n.d(t,"MAIL_CHAT_FLAG_ONLY_OWNER_CAN_MASS_MENTION",(function(){return w})),n.d(t,"MAIL_CHAT_FLAG_ONLY_OWNER_CAN_INVITE",(function(){return N})),n.d(t,"MAIL_CHAT_FLAG_ONLY_OWNER_CAN_CHANGE_TITLE",(function(){return I})),n.d(t,"MAIL_CHAT_FLAG_ONLY_OWNER_CAN_PIN",(function(){return k})),n.d(t,"MAIL_CHAT_FLAG_ONLY_ADMINS_CAN_SEE_INVITE_LINK",(function(){return A})),n.d(t,"MAIL_CHAT_FLAG_ONLY_OWNER_CAN_SEE_INVITE_LINK",(function(){return S})),n.d(t,"MAIL_CHAT_FLAG_ONLY_ADMINS_CAN_CALL",(function(){return j})),n.d(t,"MAIL_CHAT_FLAG_ONLY_OWNER_CAN_CALL",(function(){return L})),n.d(t,"MAIL_CHATS_ACTION_SEE_INVITE_LINK",(function(){return M})),n.d(t,"MAIL_CHATS_ACTION_CHANGE_INVITE_LINK",(function(){return P})),n.d(t,"MAIL_CHATS_ACTION_INVITE_USER",(function(){return F})),n.d(t,"MAIL_CHATS_ACTION_PIN_OR_UNPIN",(function(){return R})),n.d(t,"MAIL_CHATS_ACTION_CHANGE_TITLE",(function(){return x})),n.d(t,"MAIL_CHATS_ACTION_ADD_ADMIN",(function(){return D})),n.d(t,"MAIL_CHATS_ACTION_MASS_MENTION",(function(){return B})),n.d(t,"MAIL_CHATS_ACTION_START_GROUP_CALL",(function(){return H})),n.d(t,"canSeeInviteLink",(function(){return G})),n.d(t,"canMassMention",(function(){return q})),n.d(t,"canChangeInviteLink",(function(){return W})),n.d(t,"canAddAdmin",(function(){return K})),n.d(t,"canInviteUser",(function(){return z})),n.d(t,"canKickUser",(function(){return V})),n.d(t,"canPinOrUnpin",(function(){return Y})),n.d(t,"canStartGroupCall",(function(){return $})),n.d(t,"canChangeTitle",(function(){return Q})),n.d(t,"canChangeAvatar",(function(){return X})),n.d(t,"canSeeAllMessages",(function(){return J})),n.d(t,"canSeeSettingsItem",(function(){return Z})),n.d(t,"canCloseChat",(function(){return ee})),n.d(t,"checkChatRights",(function(){return te})),n.d(t,"doesChatTabHaveFlag",(function(){return ne})),n.d(t,"isUserAdminInChat",(function(){return re})),n.d(t,"isUserOwnerInChat",(function(){return ae})),n.d(t,"isUserInvitedByMe",(function(){return ie}));n("HEwt"),n("a1Th"),n("Btvt"),n("rGqo"),n("rE2o"),n("ioFf"),n("OEbY");var r=n("rHUl"),a=n("aong"),i=n("P13b");function o(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var n=[],r=!0,a=!1,i=void 0;try{for(var o,s=e[Symbol.iterator]();!(r=(o=s.next()).done)&&(n.push(o.value),!t||n.length!==t);r=!0);}catch(e){a=!0,i=e}finally{try{r||null==s.return||s.return()}finally{if(a)throw i}}return n}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return s(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return s(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function s(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var c=1,u=4,l=8,d=16,_=32,f=64,h=256,p=512,g=1024,m=2048,b=4096,v=16384,C=32768,E=65536,y=1<<17,O=1<<18,T=1<<19,w=1<<20,N=1<<21,I=1<<22,k=1<<23,A=1<<24,S=1<<25,j=1<<26,L=1<<27,M="see_invite_link",P="change_invite_link",F="invite_user",R="pin_unpin",x="change_title",D="add_admin",B="mass_mention",H="call",U={[P]:[_,_],[D]:[d,d],[M]:[A,S],[F]:[c,N],[R]:[u,k],[x]:[l,I],[B]:[T,w],[H]:[j,L]};function G(e,t,n){return te(e,M,t,n)}function q(e,t,n){return te(e,B,t,n)}function W(e,t,n){return te(e,P,t,n)}function K(e,t,n,i){var o=Object(a.unpackStore)(e);return!ae(Object(r.getTab)(o,n||o.peer),t)&&te(e,D,n,i)}function z(e,t,n){return te(e,F,t,n)}function V(e,t,n,o){var s=Object(a.unpackStore)(e);if(function(e,t){var n=Object(a.unpackStore)(e);return void 0!==n.service&&(n.service&t)>0}(e,1))return!0;var c=Object(r.getTab)(s,n||s.peer);return!(c.data.kicked&&!c.data.closed)&&(!Object(i.isFvkcomgroup)(e,n)&&(!ae(c,t)&&(!!ae(c,o=void 0===o?window.vk.id:o)||(re(c,o)||ie(c,t))&&!re(c,t))))}function Y(e,t,n){return te(e,R,t,n)}function $(e,t,n){return te(e,H,t,n)}function Q(e,t,n){return te(e,x,t,n)}function X(e,t,n){return Q(e,t,n)&&!Object(i.isFvkcomgroup)(e,t)}function J(e,t,n){return!Object(r.isCommunityPeer)(n)||!!Object(r.getTab)(e,t).caccess[n]}function Z(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:window.vk.id,o=Object(a.unpackStore)(e),s=Object(i.isFvkcomgroup)(o,t),c=o.tabs[o.peer];if(Object(r.isCommunityChat)(o,t)){var u=c&&c.data&&Object(r.isChatActive)(c),l=ae(c,-o.gid)&&u,d=l||re(c,n)&&u,_=c.allowedUpdateFlags?c.allowedUpdateFlags.filter(e=>e!==v):[];return!(!d||!_.length)}return ae(c,n)&&!s}function ee(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:window.vk.id,i=Object(a.unpackStore)(e),o=Object(r.isCommunityChat)(i,t),s=Object(r.isCommunityChatDeleted)(i,t),c=i.tabs[i.peer],u=c&&c.data&&Object(r.isChatActive)(c),l=ae(c,-i.gid)&&u,d=l||re(c,n)&&u;return o&&!s&&d&&c.allowedUpdateFlags&&c.allowedUpdateFlags.includes(v)}function te(e,t,n,s){var c=Object(a.unpackStore)(e),u=c.gid?-c.gid:window.vk.id;s=void 0===s?u:s,n=void 0===n?c.peer:n;var l=Object(r.getTab)(c,n),d=l&&l.data&&Object(r.isChatActive)(l),_=o(U[t],2),f=_[0],h=_[1],p=h|f,g=Object(i.isFvkcomgroup)(e,n),m=ae(l,s)&&d,b=m||re(l,s)&&d;if(g)switch(t){case D:case F:return!1;case M:return d;default:return c.gid>0}else if(Object(r.isCommunityChat)(e,n)){if(Object(r.isClosedChat)(e,n))return!1;switch(t){case M:return Object(r.isServiceChatTab)(l)?d:ne(l,p)?ne(l,h)?d:b:m;case P:return m||b;case D:return ne(l,p)?b:m;case B:case H:case F:return Object(r.isServiceChatTab)(l)?d:!m&&(ne(l,p)?b:d);case R:case x:return Object(r.isServiceChatTab)(l)?d:b;default:return!1}}switch(t){case P:return ne(l,f)?b:m;case D:return ne(l,p)?b:m;case M:return ne(l,p)?ne(l,h)?d:b:m;case F:case R:case B:case H:case x:return ne(l,p)?ne(l,f)?b:m:d}return!1}function ne(e,t){return((e&&e.data&&e.data.flags||0)&t)>0}function re(e,t){return(e&&e.adminIds||[]).indexOf(+t)>-1}function ae(e,t){return e.ownerId===t}function ie(e,t){return-1!==e.invitedByMe.indexOf(t)}},nJdr:function(e,t,n){"use strict";n.r(t),n.d(t,"createLongpoll",(function(){return g}));var r=n("DM26"),a=n("BxOC"),i=n("f01n"),o=function(){return(o=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var a in t=arguments[n])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e}).apply(this,arguments)};function s(e,t){e.waitAbortFns.push(t)}function c(e){if(e.isStoppedFn())return Promise.resolve({ts:0,updates:[]});var t=Object(a.plaingetCancelable)(e.url,{act:"a_check",key:e.key,version:e.version,ts:e.ts,wait:25,mode:e.mode}),n=t.request,i=t.cancel;return e.stopFn=i,window.lpDebug={startedAt:Date.now(),finishedAt:null,error:!1,request:n,cancel:i},n.then((function(t){var n=t[0],r=t[1];return window.lpDebug&&(window.lpDebug=o(o({},window.lpDebug),{finishedAt:Date.now(),request:null,cancel:null})),e.onData(e,r),e.waitTimeout=2,JSON.parse(n)})).catch((function(t){var n=t[1];return window.lpDebug&&(window.lpDebug=o(o({},window.lpDebug),{finishedAt:Date.now(),error:!0,request:null,cancel:null})),e.onData(e,n),Promise.reject(new Error(""))})).then((function(t){return function(e,t){var n=t.failed?Object(r.abortablePause)(4,null):{abort:function(){},pause:function(){return Promise.resolve()}},a=n.abort,i=n.pause;switch(t.failed){case 1:return s(e,a),e.onHistoryLost(e,t).then((function(){return e.onResult({ts:t.ts,updates:[[-1]]})})).then(i).then((function(){return c(e)}));case 2:return s(e,a),e.onKeyExpired(e,t).then((function(t){var n=t[0],r=t[1],a=t[2],i=t[3];return e.onResult({ts:+i,updates:[[-2,n,r+"/"+a],[-1]]})})).then(i).then((function(){return c(e)}));case 3:return e.onLpBroken(e,t);default:return Promise.resolve(t)}}(e,t)}))}function u(e){e.isStoppedFn()||c(e).then(e.onResult.bind(e)).then((function(){return e.isReconnecting&&l(e,-5)})).catch((function(t){return function(e,t){if(e.isStoppedFn())return;e.onRequestError(t),e.waitTimeout=Math.min(60,2*e.waitTimeout),l(e,-3);var n=Object(r.abortablePause)(e.waitTimeout,null),a=n.abort,i=n.pause;return s(e,a),i().then((function(){return l(e,-4)}))}(e,t)})).then((function(){return u(e)}))}function l(e,t){e.isReconnecting=-4===t,e.onResult({ts:e.ts,updates:[[t,e.waitTimeout]]})}function d(e){return e||function(){}}function _(e){return e?function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return Promise.resolve(e.apply(void 0,t))}:function(){return Promise.reject()}}var f=n("bP5l"),h=n("vT4u"),p=n("XzvV");function g(e,t){return function(e,t){var n=!!e.stopped,r={id:e.id,key:e.key,ts:e.ts,url:e.url,lpstat:e.lpstat||0,version:e.version||11,mode:202,waitTimeout:2,waitAbortFns:[],isReconnecting:!1,isStoppedFn:function(){return n},onResult:function(e){e.ts&&o(r.ts,e.ts,e.updates.map(i.constructEvent))},onData:d(t.onData),onRequestError:d(t.onRequestError),onHistoryLost:_(t.onHistoryLost),onKeyExpired:_(t.onKeyExpired),onLpBroken:_(t.onHistoryLost)},a=t.onEvents;function o(e,t,n){r.ts=t;for(var o=0;o<n.length;++o)n[o].type===i.REFRESH_LP_KEY&&(r.key=n[o].key||"",r.url=n[o].url||"");a(e,t,n)}var s={options:r,isStopped:function(){return n},stopConnection:function(){n=!0,r.stopFn&&r.stopFn(),r.stopFn=void 0,document.removeEventListener("resume",c),this.abortWaiting()},reinitConnection:function(){this.stopConnection(),document.addEventListener("resume",c),l(r,-4),n=!1,u(r)},abortWaiting:function(){r.waitAbortFns.forEach((function(e){return e()})),r.waitAbortFns=[],r.waitTimeout=2},onLp:o};function c(){s.abortWaiting()}return document.addEventListener("resume",c),u(r),s}(e,{onEvents:t,onData:v,onRequestError:C,onHistoryLost:E,onKeyExpired:y,onLpBroken:O})}var m={},b=Date.now();function v(e,t){if(t&&t.status&&e.lpstat){var n=t.status.toString();t.status>=500&&t.status<600&&Object(p.statlogsValueEvent)("fc_longpoll",1,n,t.getResponseHeader("x-frontend")||""),m[n]=n in m?m[n]+1:1,Date.now()-b>=3e4&&(Object.keys(m).forEach((function(e){Object(p.statlogsValueEvent)("fc_longpoll",m[e],e,t.getResponseHeader("x-frontend")||"")})),m={},b=Date.now())}}function C(e){Object(f.lpLogFc)("red","LP error",e.message||"no message (probably browser reset)")}function E(e,t){Object(f.lpLogFc)("red","LP failed: old timestamp; resync, next ts",t.ts)}function y(e){return Object(f.lpLogFc)("red","LP failed: key is incorrect; refresh key"),Object(a.post)(h.CONTROLLER,{act:"a_get_key",uid:e.id,gid:e.id<0?-e.id:0},1e3)}function O(){throw window.nav.reload({force:!0}),new Error("ts is very wrong")}},qihR:function(e,t,n){"use strict";n.r(t);var r=n("q1tI"),a=n.n(r),i=n("i8i4"),o=n("ZxpX"),s=function(){return(s=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var a in t=arguments[n])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e}).apply(this,arguments)},c=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var a=0;for(r=Object.getOwnPropertySymbols(e);a<r.length;a++)t.indexOf(r[a])<0&&Object.prototype.propertyIsEnumerable.call(e,r[a])&&(n[r[a]]=e[r[a]])}return n};t.default=function(e){var t,n=e.x,u=e.y,l=e.text,d=e.position,_=void 0===d?"b":d,f=e.align,h=void 0===f?"center":f,p=e.removed,g=e.maxWidth,m=e.appearance,b=void 0===m?"dark":m,v=e.className,C=e.tooltipRef,E=c(e,["x","y","text","position","align","removed","maxWidth","appearance","className","tooltipRef"]),y=Object(r.useRef)(null);y.current||(y.current=document.createElement("div"),document.body.appendChild(y.current));var O=Object(o.classNames)("Tooltip","Tooltip--"+_,"Tooltip--"+b,((t={"Tooltip--removed":!!p})["Tooltip--align-"+h]="t"===_||"b"===_,t),v);return Object(i.createPortal)(a.a.createElement("div",s({},E,{className:O,ref:C,style:{top:u,left:n}}),"string"==typeof l&&a.a.createElement("div",{className:"Tooltip__in",style:{maxWidth:g},dangerouslySetInnerHTML:{__html:l}}),"string"!=typeof l&&a.a.createElement("div",{className:"Tooltip__in",style:{maxWidth:g}},l)),y.current)}},r7nW:function(e,t,n){"use strict";n.r(t);var r=n("q1tI"),a=n("i8i4"),i=(n("17x9"),n("ZxpX"));class o extends r.Component{constructor(){super(...arguments),this.getScrollbarWidth=()=>{var e=document.createElement("div");e.classList.add("BaseModal__scrollbarMeasure"),document.body.appendChild(e);var t=e.getBoundingClientRect().width-e.clientWidth;return document.body.removeChild(e),t},this.hideScrollBar=()=>{var e=document.body.getBoundingClientRect(),t=e.left+e.right<window.innerWidth,n=this.getScrollbarWidth();this.calculatedPadding=window.getComputedStyle(document.body)["padding-right"],t&&(document.body.style.paddingRight=parseFloat(this.calculatedPadding)+n+"px"),document.body.classList.add("BaseModal__bodyHiddenOverflow")},this.showScrollBar=()=>{document.body.style.paddingRight=this.calculatedPadding,document.body.classList.remove("BaseModal__bodyHiddenOverflow")},this.onDocumentKeyDown=e=>{var t=this.props.onClose;"Escape"===e.key&&t()},this.onBackdropClick=()=>{var e=this.props,t=e.onClose,n=e.onBackdropClick;e.disableBackdropClick||(n?n():t())}}componentDidMount(){var e=this.props,t=e.disableEscapeClose,n=e.disableBodyScroll;t||document.body.addEventListener("keydown",this.onDocumentKeyDown),n&&this.hideScrollBar()}componentWillUnmount(){var e=this.props,t=e.disableEscapeClose,n=e.disableBodyScroll;t||document.body.removeEventListener("keydown",this.onDocumentKeyDown),n&&this.showScrollBar()}renderModal(){var e=this.props.className,t=Object(i.classNames)("BaseModal",e);return r.createElement("div",{className:t,"aria-modal":"true"},r.createElement("div",{className:"BaseModal__backdrop",onClick:this.onBackdropClick}),r.createElement("div",{className:"BaseModal__content"},this.props.children))}render(){return a.createPortal(this.renderModal(),document.body)}}o.defaultProps={className:"",children:null,disableBackdropClick:!1,disableEscapeClose:!1,disableBodyScroll:!1},t.default=o},rHUl:function(e,t,n){"use strict";n.r(t),n.d(t,"getFirstUnread",(function(){return d})),n.d(t,"isSearchShown",(function(){return _})),n.d(t,"getPeer",(function(){return f})),n.d(t,"getCurrentKeyboard",(function(){return h})),n.d(t,"getKeyboard",(function(){return p})),n.d(t,"getTab",(function(){return g})),n.d(t,"getCurrentTab",(function(){return m})),n.d(t,"getSelectedMessages",(function(){return b})),n.d(t,"getMessageRangeFromSelection",(function(){return v})),n.d(t,"countUnread",(function(){return C})),n.d(t,"getMessageByRid",(function(){return E})),n.d(t,"isRidExist",(function(){return y})),n.d(t,"getLocalId",(function(){return O})),n.d(t,"getLastMessage",(function(){return T})),n.d(t,"parserMessage",(function(){return w})),n.d(t,"getAuthorFullName",(function(){return N})),n.d(t,"getMessage",(function(){return I})),n.d(t,"getPreviousMessage",(function(){return k})),n.d(t,"isClassicInterface",(function(){return A})),n.d(t,"isLocksAvailable",(function(){return S})),n.d(t,"isFoldersAvailable",(function(){return j})),n.d(t,"isCommunityInterface",(function(){return L})),n.d(t,"isChannelPeer",(function(){return M})),n.d(t,"getBareTab",(function(){return P})),n.d(t,"isReversedDialogs",(function(){return F})),n.d(t,"isFullyLoadedTab",(function(){return R})),n.d(t,"makeTabNotFullyLoaded",(function(){return x})),n.d(t,"isGoToEndVisible",(function(){return D})),n.d(t,"isGoToMentionVisible",(function(){return B})),n.d(t,"getUnreadScrollBottom",(function(){return H})),n.d(t,"isSendingAvailable",(function(){return U})),n.d(t,"isCommunityPeer",(function(){return G})),n.d(t,"isCommunityBlocked",(function(){return q})),n.d(t,"checkVoiceMessageAvailable",(function(){return W})),n.d(t,"isSearching",(function(){return K})),n.d(t,"getSearchText",(function(){return z})),n.d(t,"isSearchingValue",(function(){return V})),n.d(t,"isRecentSearchesActive",(function(){return Y})),n.d(t,"getPinnedMessage",(function(){return $})),n.d(t,"doPopularSuggExist",(function(){return Q})),n.d(t,"isAnyMessageBeingEdited",(function(){return X})),n.d(t,"getGroupId",(function(){return J})),n.d(t,"getTabDraft",(function(){return Z})),n.d(t,"getTemplates",(function(){return ee})),n.d(t,"tabIsMessageRequest",(function(){return te})),n.d(t,"tabIsRejectedMessageRequest",(function(){return ne})),n.d(t,"tabIsMessageRequestToChat",(function(){return re})),n.d(t,"removeMessageRequestFolderFlags",(function(){return ae})),n.d(t,"isMessageRequestFolder",(function(){return ie})),n.d(t,"tabIsOutgoingMessageRequest",(function(){return oe})),n.d(t,"existsIncomingMessageRequest",(function(){return se})),n.d(t,"isMessageRequestChangedEvent",(function(){return ce})),n.d(t,"isCommunityChat",(function(){return ue})),n.d(t,"isCommunityChatDeleted",(function(){return le})),n.d(t,"isClosedChat",(function(){return de})),n.d(t,"isCasperChat",(function(){return _e})),n.d(t,"isServiceChatTab",(function(){return fe})),n.d(t,"isCasperChatTab",(function(){return he})),n.d(t,"isChatActive",(function(){return pe})),n.d(t,"isTabMarkedUnread",(function(){return ge}));n("Vd3H"),n("rGqo"),n("Btvt");var r=n("MhhX"),a=n("f01n"),i=n("h++7"),o=n("86+7"),s=n("rjmT"),c=n("aong"),u=n("lJdi"),l=n("rudk");function d(e,t){var n=Object(c.unpackStore)(e),a=n.tabs[n.peer];return Object.keys(a.msgs).filter(n=>{var i=I(e,t,n);return!Object(r.isOut)(i)&&intval(n)>a.in_up_to})[0]}function _(e){return Object(c.unpackStore)(e).searchShown}function f(e){return Object(c.unpackStore)(e).peer}function h(e){return p(e,f(e))}function p(e,t){var n=(g(e,t)||{}).keyboard;if(!n||!n.buttons||n.buttons.length)return n}function g(e,t){var n=Object(c.unpackStore)(e);return n.tabs&&n.tabs[t]}function m(e){var t=Object(c.unpackStore)(e);return t.peer?t.tabs[t.peer]:null}function b(e){return Object(c.unpackStore)(e).selectedMessages}function v(e,t,n){var a=g(e,t),i=b(e)[0];if(void 0===i)return[n];var o=Math.min(n,i),s=Math.max(n,i);return Object.keys(a.msgs).filter(e=>e>=o&&e<=s).filter(t=>{var n=I(e,e.get().peer,t);return!Object(r.isServiceMsg)(n)&&!Object(r.isCallMessage)(n)}).map(intval)}function C(e,t){var n=g(Object(c.unpackStore)(t),e),a=0;for(var i in n.msgs)if(n.msgs.hasOwnProperty(i)){var o=I(t,e,i);Object(r.isOut)(o)||(a+=Object(r.isUnread)(n,o)?1:0)}return a}function E(e,t,n){var r=g(e,t);return Object.keys(r.msgs).filter(r=>intval(I(e,t,r).randomId)===n).length>0}function y(e,t,n){return!!E(e,t,n)}function O(e,t){var n=Object(c.unpackStore)(e),r=n.msg_local_ids_sort&&n.msg_local_ids_sort[t];return void 0!==r?2e9+r:t}function T(e,t,n){var r=g(e,t),i=I(e,t,n),o=Object.keys(r.msgs).filter(n=>{var r=I(e,t,n),o=r.local&&r.type!==a.EDIT_MESSAGE;return!(!i.local&&o)&&(!(!i.local||o)||O(e,i.messageId)>O(e,r.messageId))}).pop();return o?I(e,t,o):null}function w(e){return e&&e.length>0?a.addMessageEvent([0].concat(e)):e}function N(e,t,n){var a=g(e,t),i=I(e,t,n),s=Object(c.unpackStore)(e);return Object(r.isOut)(i)?Object(o.oCacheGet)(e,s.id).name:i.userId!==i.peerId?!!Object(o.oCacheExists)(e,i.userId)&&Object(o.oCacheGet)(e,i.userId).name:a.tab}function I(e,t,n){var r=g(e,t),a=r&&r.msgs&&r.msgs[n];return a?w(a):null}function k(e,t,n){var r=g(e,t),a=r&&r.msgs&&Object.keys(r.msgs).sort((e,t)=>+e-t);if(!a)return null;var i=a&&a.indexOf(""+n),o=i>-1?a[i-1]:null;return r.msgs[o]}function A(e){var t=Object(c.unpackStore)(e);return t.gid||t.isClassic}function S(e){return Object(c.unpackStore)(e).gid}function j(e){return Object(c.unpackStore)(e).gid}function L(e){return!!Object(c.unpackStore)(e).gid}function M(e){return!!(e.peerId>2e9&&Object(u.doesChatTabHaveFlag)(e,1024))}function P(e,t){var n=Object(c.unpackStore)(t);return n.tabs[e]||n.mapped_index[e]}function F(e){var t=Object(c.unpackStore)(e);return!!L(e)&&((19542789===t.gid||103416369==t.gid)&&(t.active_tab===i.FOLDER_UNRESPOND||t.active_tab===i.FOLDER_UNREAD))}function R(e,t){var n=(e=Object(c.unpackStore)(e)).tabs;return!(!n||!n[t]||void 0===n[t].history||!n[t].msgs)}function x(e,t){var n=g(e,t);n&&(n.msgs=void 0,n.msgid=void 0,n.scrollTop=void 0,n.scrollBottom=void 0,n.contHeight=void 0,n.offset=void 0,n.skipped=void 0)}function D(e){var t=e.get().go_to_end_visible;return!!t&&t[0]}function B(e){var t=e.get().go_to_mentions_visible;return!!t&&t[0]}function H(e){var t=e.get().go_to_end_visible;return t?t[1]:0}function U(e){return!Object(c.unpackStore)(e).lockedSending}function G(e){return e>-2e9&&e<0}function q(e,t){return!!G(t)&&!!g(e,t).blocked_community}function W(e){return Object(c.unpackStore)(e).voice_message_available}function K(e){var t=Object(c.unpackStore)(e);return!(!z(t)&&!t.recentSearch)}function z(e){return Object(c.unpackStore)(e).searchText}function V(e,t){var n=Object(c.unpackStore)(e);return!!(t&&t!==z(e)||n.recentSearch)}function Y(e){return Object(c.unpackStore)(e).recentSearch}function $(e){var t=m(e);return t&&t.pinned&&w(t.pinned)}function Q(e){var t=e.get().popular_sugg;return t&&t.length>0}function X(e){return 1==Object(c.unpackStore)(e).isEditing}function J(e){return Object(c.unpackStore)(e).gid}function Z(e){return e.draft||(e.draft=Object(s.loadDraftForPeer)(cur.imDb,e.peerId)),e.draft}function ee(e){return(Object(c.unpackStore)(e).templates||[]).filter(e=>!e.deleted)}function te(e){return!!e&&Boolean(e.is_message_request||e.folders&i.FOLDER_MASKS[i.FOLDER_MESSAGE_REQUEST]||e.folders&i.FOLDER_MASKS[i.FOLDER_MESSAGE_REQUEST_REJECTED])}function ne(e){return Boolean(e.folders&i.FOLDER_MASKS[i.FOLDER_MESSAGE_REQUEST_REJECTED])}function re(e){return Object(l.isChatPeer)(e.peerId)&&te(e)}function ae(e){return e&~i.FOLDER_MASKS[i.FOLDER_MESSAGE_REQUEST]&~i.FOLDER_MASKS[i.FOLDER_MESSAGE_REQUEST_REJECTED]}function ie(e){return Object(c.unpackStore)(e).active_tab===i.FOLDER_MESSAGE_REQUEST}function oe(e){return e.peerId>19e8&&e.peerId<2e9}function se(e){return!!Object(c.unpackStore)(e).dialog_tab_cts[i.FOLDER_MESSAGE_REQUEST]}function ce(e){var t=e.type,n=e.updateType;return t===a.CONVERSATION_UPDATED&&(n===a.MAIL_CHAT_UPDATE_TYPE_MESSAGE_REQUEST_CHANGED||n===a.MAIL_CHAT_UPDATE_TYPE_CONTACT_CONVERTED)}function ue(e,t){return Object(u.doesChatTabHaveFlag)(g(e,t),u.MAIL_CHAT_FLAG_IS_COMMUNITY_CHAT)}function le(e,t){return Object(u.doesChatTabHaveFlag)(g(e,t),u.MAIL_CHAT_FLAG_IS_COMMUNITY_CHAT_DELETED)}function de(e,t){return Object(u.doesChatTabHaveFlag)(g(e,t),u.MAIL_CHAT_FLAG_DENY_ANYONE_TO_WRITE)}function _e(e,t){return Object(u.doesChatTabHaveFlag)(g(e,t),u.MAIL_CHAT_FLAG_IS_CASPER)}function fe(e){return Object(u.doesChatTabHaveFlag)(e,u.MAIL_CHAT_FLAG_SERVICE_CHAT)}function he(e){return Object(u.doesChatTabHaveFlag)(e,u.MAIL_CHAT_FLAG_IS_CASPER)}function pe(e){return!e.data.closed&&!e.data.kicked}function ge(e){return!!(e.folders&i.FOLDER_MASKS[i.FOLDER_MARKED_UNREAD])}},rjmT:function(e,t,n){"use strict";n.r(t),n.d(t,"ImDraft",(function(){return c})),n.d(t,"loadDraftForPeer",(function(){return l}));n("HEwt"),n("a1Th"),n("rGqo"),n("rE2o"),n("ioFf"),n("KKXr"),n("VRzm"),n("Btvt"),n("OEbY"),n("pIFo");var r=n("BxOC"),a=n("f01n"),i=n("vT4u");function o(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var n=[],r=!0,a=!1,i=void 0;try{for(var o,s=e[Symbol.iterator]();!(r=(o=s.next()).done)&&(n.push(o.value),!t||n.length!==t);r=!0);}catch(e){a=!0,i=e}finally{try{r||null==s.return||s.return()}finally{if(a)throw i}}return n}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return s(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return s(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function s(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function c(e,t){this._db=e,this._key=t,this.dData={txt:"",attaches:[],urlBinds:[],cancelled:[]},this.load()}function u(e){switch(e.type){case"mail":case"reply":return e.id<0&&1==e.object.fwd_count;default:return!e.object}}function l(e,t){return new c(e,"draft_"+t)}c.prototype.dump=function(){var e;this._key&&this._db.updateByKey(this._key,{txt:(e=this.dData).txt,attaches:e.attaches.length?e.attaches:void 0,urlBinds:e.urlBinds.length?e.urlBinds:void 0,cancelled:e.cancelled.length?e.cancelled:void 0})},c.prototype.load=function(){if(this._key){var e=this._db.selectByKey(this._key);e&&(this.dData=function(e){return{txt:e.txt,attaches:e.attaches||[],urlBinds:e.urlBinds||[],cancelled:e.cancelled||[]}}(e))}},c.prototype.clear=function(){this.dData={txt:"",attaches:[],urlBinds:[],cancelled:[]},this.dump()},c.prototype.setText=function(e){this.dData.txt=trim(e),this.dump()},c.prototype.addAttach=function(e,t,n){if(("share"===e&&this.removeAttachByType(e),"mail"!==e&&"reply"!==e||(this.removeAttachByType("mail"),this.removeAttachByType("reply")),"audio_playlist"===e||"artist"===e)&&this.dData.attaches.find(t=>t.type===e))return!1;if(!e||!t&&"poll"!==e)return!1;var r=this.dData.attaches.findIndex(n=>n.type===e&&n.id===t);-1===r?(this.dData.attaches.push({type:e,id:t,object:n}),this.dump()):"video"!==e&&"poll"!==e||(this.dData.attaches[r]={type:e,id:t,object:n},this.dump())},c.prototype.syncWithSelector=function(e){var t=this.getFwdRaw();this.dData.attaches=(t?[t]:[]).concat(e.getMedias().map(e=>{var t=o(e,2),n=t[0],r=t[1];return this.dData.attaches.find(e=>e.type==n&&e.id==r)||{type:n,id:r}})),this.dump()},c.prototype.removeAttachByType=function(e){for(var t=this.dData.attaches.length;t--;)this.dData.attaches[t].type===e&&this.dData.attaches.splice(t,1);this.dump()},c.prototype.removeAllAttaches=function(){this.dData.attaches=[],this.dData.cancelled=[],this.dump()},c.prototype.addBindUrl=function(e,t,n){this.getBoundAttach(e)||(this.dData.urlBinds.push({url:e,type:t,id:n}),this.dump())},c.prototype.getBoundAttach=function(e){var t=this.dData.urlBinds.find(t=>t.url===e);return t&&this.dData.attaches.find(e=>e.type===t.type&&e.id===t.id)||null},c.prototype.getShareUrl=function(){var e=this.dData.attaches.find(e=>"share"===e.type);if(e&&e.object)return e.object.url.replace(/&amp;/g,"&")},c.prototype.hasOnlyReplies=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return e?e.flags&a.FLAG_HAS_REPLY&&!this.dData.attaches.find(e=>"mail"!==e.type):this.hasAttaches()&&!this.dData.attaches.find(e=>"reply"!==e.type)},c.prototype.getCancelledShares=function(){return this.dData.cancelled.length?this.dData.cancelled:void 0},c.prototype.hasAttaches=function(){return this.dData.attaches.length>0},c.prototype.destroy=function(){this.dData={},this._key=this._db=null},c.prototype.prepareObjects=function(e,t){return this.dData.attaches.find(u)?Object(r.post)(i.CONTROLLER,{act:"draft_medias",gid:e,messageId:t||0,media:t?void 0:this.dData.attaches.map(e=>[e.type,e.id]).join("*")}).then(e=>{var t=o(e,1)[0];this.dData.attaches=t.map(e=>({type:e[0],id:e[1],object:e[2]}))}):Promise.resolve()},c.prototype.getFwdRaw=function(){return this.dData.attaches.find(e=>"mail"===e.type||"reply"===e.type)},c.prototype.getFwdCount=function(){var e=this.getFwdRaw();return e?e.id<0?e.object.fwd_count:e.id.split(";").length:0}},rudk:function(e,t,n){"use strict";n.r(t),n.d(t,"parseFwd",(function(){return o})),n.d(t,"convertKludgesToAttaches",(function(){return s})),n.d(t,"isReservedPeer",(function(){return c})),n.d(t,"isUserPeer",(function(){return u})),n.d(t,"isChatPeer",(function(){return l})),n.d(t,"convertAttachesToPhpMedia",(function(){return d}));var r=n("jE6c");function a(e,t){void 0===t&&(t=[]);var n=e.split("_");return[n[0],n[1],t]}var i={};function o(e){if(i[e])return i[e];for(var t=e?e.length:0,n=[],r=[],o="",s=0;s<t;s++){var c=e[s],u=c.charCodeAt(0);u>=48&&u<=57||"_"===c||"-"===c?o+=c:"("!==c&&")"!==c&&":"!==c&&","!==c||(""!==o&&(r.push(o),n.push("id"),o=""),r.push(c),n.push(c))}o.length>0&&(r.push(o),n.push("id"));var l=function e(t,n,r,i){if(void 0===r&&(r=0),void 0===i&&(i=0),i>50)return[[],t.length];for(var o=[],s="";r<t.length;){var c=t[r];if("id"===c)s=n[r];else if(","===c&&s)o.push(a(s)),s="";else if("("===c){var u=e(t,n,r+1,i+1),l=u[0];r=u[1],o.push(a(s,l)),s=""}else if(")"===c)return""!==s&&o.push(a(s)),[o,r];r++}return s&&o.push(a(s)),[o,r]}(n,r)[0];return Object.keys(i).length>300&&(i={}),i[e]=l,l}function s(e,t){var n=[];e.fwd_count?n.push({type:"mail",id:-t,object:{fwd_count:e.fwd_count}}):e.fwd&&n.push({type:"mail",id:-t,object:{fwd_count:o(e.fwd).length}});for(var a=1;e["attach"+a+"_type"];++a)"call"===e["attach"+a+"_type"]?n.push({type:e["attach"+a+"_type"],id:e["attach"+a],initiatorId:Object(r.intval)(e["attach"+a+"_call_initiator_id"]),state:e["attach"+a+"_call_state"],duration:Object(r.intval)(e["attach"+a+"_call_duration"]),receiverId:Object(r.intval)(e["attach"+a+"_call_receiver_id"])}):n.push({type:e["attach"+a+"_type"],id:e["attach"+a],kind:e["attach"+a+"_kind"],productId:e["attach"+a+"_product_id"]});return e.geo&&n.push({type:"geo",id:e.geo}),n}function c(e){return 0==e}function u(e){return e>0&&e<2e9}function l(e){return e>2e9}function d(e){return e.map((function(e){var t="audiomsg"===e[2]?"audio_message":e[2];return e[0]+":"+e[1]+":"+t})).join(",")}},uytb:function(e,t,n){"use strict";n.r(t),n.d(t,"RECENT_SEARCH_OP",(function(){return o})),n.d(t,"PIN_HIDDEN_ID_OP",(function(){return s})),n.d(t,"deleteOldStoredFormat",(function(){return d})),n.d(t,"mount",(function(){return f}));n("HEwt"),n("a1Th"),n("Btvt"),n("rGqo"),n("rE2o"),n("ioFf");var r=n("BJj/");function a(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var n=[],r=!0,a=!1,i=void 0;try{for(var o,s=e[Symbol.iterator]();!(r=(o=s.next()).done)&&(n.push(o.value),!t||n.length!==t);r=!0);}catch(e){a=!0,i=e}finally{try{r||null==s.return||s.return()}finally{if(a)throw i}}return n}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return i(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return i(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function i(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var o="recent_search",s="pin_hide";function c(e){return"im_store_"+e}function u(e){return ls.get(c(e))||{}}function l(e,t,n){if(ls.checkVersion()){var r=JSON.stringify(t);rand(0,1e5)<=1&&statlogsValueEvent("im_local_store_size",r.length),n(c(e),r)}}function d(e,t){for(var n=["fwd","draft","bind_attach"],r=u(e),a=!1,i=n.length;i--;)n[i]in r&&(delete r[n[i]],a=!0);a&&l(e,r,t)}function _(e,t,n){n.key===c(e)&&(t.db=JSON.parse(n.newValue),t.checkTime=Date.now())}function f(e){var t=Object(r.debounce)((e,t)=>{localStorage.setItem(e,t)},300);ls.checkVersion()&&d(e,t);var n={db:u(e),checkTime:Date.now()},i=_.bind(null,e,n);return window.addEventListener("storage",i,!1),{select:(t,r)=>(Date.now()-n.checkTime>1e3&&(n.db=u(e)),function(e,t,n){return t===o?e[t]||[]:t===s?e[t]&&e[t][n]:e[t]?extend(!0,{},e[t][n]):null}(n.db,t,r)),selectByKey:t=>(Date.now()-n.checkTime>1e3&&(n.db=u(e)),n.db[t]),update(r,i){var c=function(e,t,n){switch(e[t]||(e[t]={}),t){case o:var r=n;r&&r.length>0?e[t]=r:delete e[t];break;case s:var i=a(n,2),c=i[0],u=i[1];u?e[t][c]=+u:delete e[t][c]}return e}(n.db,r,i);return n.db=c,n.checkTime=Date.now(),l(e,c,t)},updateByKey:(r,a)=>(n.db[r]=a,n.checkTime=Date.now(),l(e,n.db,t)),unmount(){window.removeEventListener("storage",i,!1)}}}},vT4u:function(e,t,n){"use strict";n.r(t),n.d(t,"CONTROLLER",(function(){return w})),n.d(t,"ACTIVITY_PERIOD",(function(){return N})),n.d(t,"ACTIVITY_TYPE_TYPING",(function(){return I})),n.d(t,"ACTIVITY_TYPE_RECORDING_AUDIO",(function(){return k})),n.d(t,"CHAT_ACTION_SETTINGS",(function(){return M})),n.d(t,"CHAT_ACTION_BLOCK",(function(){return P})),n.d(t,"CHAT_ACTION_INVITE",(function(){return F})),n.d(t,"CHAT_ACTION_MEDIA",(function(){return R})),n.d(t,"CHAT_ACTION_SEARCH",(function(){return x})),n.d(t,"CHAT_ACTION_PIN_HIDE",(function(){return D})),n.d(t,"CHAT_ACTION_PIN_UNHIDE",(function(){return B})),n.d(t,"CHAT_ACTION_UNPIN",(function(){return H})),n.d(t,"CHAT_ACTION_MUTE",(function(){return U})),n.d(t,"CHAT_ACTION_UNMUTE",(function(){return G})),n.d(t,"CHAT_ACTION_CLEAR",(function(){return q})),n.d(t,"CHAT_ACTION_LEAVE",(function(){return W})),n.d(t,"CHAT_ACTION_RETURN",(function(){return K})),n.d(t,"CHAT_ACTION_BLOCK_COMMUNITY",(function(){return z})),n.d(t,"CHAT_ACTION_ALLOW_COMMUNITY",(function(){return V})),n.d(t,"CHAT_ACTION_BLOCK_NOTIFY",(function(){return Y})),n.d(t,"CHAT_ACTION_CALL_AUDIO",(function(){return $})),n.d(t,"CHAT_ACTION_CALL_VIDEO",(function(){return Q})),n.d(t,"CHAT_ACTION_UNREAD",(function(){return X})),n.d(t,"ACTION_PRIORITIES",(function(){return J})),n.d(t,"loadHashes",(function(){return Z})),n.d(t,"loadWriteHash",(function(){return ne})),n.d(t,"strHistory",(function(){return ae})),n.d(t,"updateBlockStates",(function(){return ie})),n.d(t,"setCallAvailability",(function(){return oe})),n.d(t,"loadPeer",(function(){return se})),n.d(t,"restoreHistoryQueue",(function(){return ce})),n.d(t,"removeFailed",(function(){return ue})),n.d(t,"removeExpiredFailed",(function(){return le})),n.d(t,"selectPeer",(function(){return _e})),n.d(t,"selectPeerOnMessage",(function(){return he})),n.d(t,"changePeer",(function(){return pe})),n.d(t,"updateMentions",(function(){return ge})),n.d(t,"setActions",(function(){return me})),n.d(t,"loadMoreHistory",(function(){return be})),n.d(t,"loadLessHistory",(function(){return ve})),n.d(t,"readLastMessages",(function(){return Ee})),n.d(t,"readTillSpecificMessage",(function(){return ye})),n.d(t,"markAudioMessageAsListened",(function(){return Oe})),n.d(t,"loadLongPollKey",(function(){return Te})),n.d(t,"loadLongPollTs",(function(){return we})),n.d(t,"setMessageErrored",(function(){return Ne})),n.d(t,"resendMessage",(function(){return Ie})),n.d(t,"loadAdmins",(function(){return Ae})),n.d(t,"updateVideoThumb",(function(){return Le})),n.d(t,"editMessage",(function(){return Me})),n.d(t,"addMessage",(function(){return Pe})),n.d(t,"markInboundMessagesAsRead",(function(){return De})),n.d(t,"markOutboundMessagesAsRead",(function(){return Be})),n.d(t,"initTextStore",(function(){return He})),n.d(t,"processFwd",(function(){return Ue})),n.d(t,"mergeTabs",(function(){return Ge})),n.d(t,"updateOnline",(function(){return qe})),n.d(t,"setActivity",(function(){return We})),n.d(t,"updateActivity",(function(){return Ke})),n.d(t,"waitActivity",(function(){return ze})),n.d(t,"sendMessage",(function(){return Ye})),n.d(t,"deliverMessage",(function(){return $e})),n.d(t,"deliverEditedMessage",(function(){return Qe})),n.d(t,"addSelection",(function(){return Xe})),n.d(t,"cleanSelected",(function(){return Je})),n.d(t,"dropSelection",(function(){return Ze})),n.d(t,"replaceMessage",(function(){return et})),n.d(t,"saveMedia",(function(){return tt})),n.d(t,"loadMedia",(function(){return nt})),n.d(t,"addAttachmentsToStoreData",(function(){return rt})),n.d(t,"replaceMediaAttachesStore",(function(){return at})),n.d(t,"setCurrentSearchDate",(function(){return it})),n.d(t,"setInplaceSearch",(function(){return ot})),n.d(t,"setCurrentSearch",(function(){return st})),n.d(t,"searchHints",(function(){return ct})),n.d(t,"searchHintsIndex",(function(){return ut})),n.d(t,"localIndexToDialog",(function(){return lt})),n.d(t,"searchTopConv",(function(){return _t})),n.d(t,"searchImTopConv",(function(){return ft})),n.d(t,"searchLocalHints",(function(){return ht})),n.d(t,"preloadSearchIndex",(function(){return pt})),n.d(t,"loadDialogs",(function(){return gt})),n.d(t,"searchMessages",(function(){return mt})),n.d(t,"isSearchAllLoaded",(function(){return bt})),n.d(t,"isSearchingInplace",(function(){return vt})),n.d(t,"cancelSearch",(function(){return Ct})),n.d(t,"clearDate",(function(){return Et})),n.d(t,"searchInplaceStart",(function(){return yt})),n.d(t,"searchMessagesInplace",(function(){return Ot})),n.d(t,"loadImportant",(function(){return Tt})),n.d(t,"loadActualLastMessage",(function(){return wt})),n.d(t,"removeUnreadDeletedMsgsFromTab",(function(){return Nt})),n.d(t,"removeMessagesMarkDeleted",(function(){return It})),n.d(t,"removeMessages",(function(){return kt})),n.d(t,"removeMessageSend",(function(){return At})),n.d(t,"removeMessagesWithRestore",(function(){return St})),n.d(t,"restoreMessage",(function(){return jt})),n.d(t,"restoreMessageSend",(function(){return Lt})),n.d(t,"acceptMessageRequest",(function(){return Pt})),n.d(t,"rejectMessageRequest",(function(){return Ft})),n.d(t,"cancelMessageRequest",(function(){return Rt})),n.d(t,"sendTyping",(function(){return xt})),n.d(t,"sendRecordingAudio",(function(){return Dt})),n.d(t,"forwardMessages",(function(){return Bt})),n.d(t,"prepareForward",(function(){return Ht})),n.d(t,"deletedDialog",(function(){return Ut})),n.d(t,"flushHistory",(function(){return Gt})),n.d(t,"updateChatTopic",(function(){return qt})),n.d(t,"loadChatInfo",(function(){return Wt})),n.d(t,"addNewMemberOptimisticly",(function(){return Kt})),n.d(t,"addNewMember",(function(){return zt})),n.d(t,"loadChatMember",(function(){return Vt})),n.d(t,"checkNewPeople",(function(){return Yt})),n.d(t,"loadNewPeople",(function(){return $t})),n.d(t,"updateChatPhoto",(function(){return Qt})),n.d(t,"updateActions",(function(){return Xt})),n.d(t,"leaveChat",(function(){return Jt})),n.d(t,"returnToChat",(function(){return Zt})),n.d(t,"toggleMutePeer",(function(){return en})),n.d(t,"toggleMuteMentionsPeer",(function(){return tn})),n.d(t,"setMutedPeer",(function(){return nn})),n.d(t,"setExecStack",(function(){return rn})),n.d(t,"favMessage",(function(){return an})),n.d(t,"updateFavMessage",(function(){return on})),n.d(t,"updateImportant",(function(){return sn})),n.d(t,"loadSpam",(function(){return cn})),n.d(t,"flushSpam",(function(){return un})),n.d(t,"setCreationType",(function(){return ln})),n.d(t,"getOwnerPhoto",(function(){return dn})),n.d(t,"getContactsList",(function(){return _n})),n.d(t,"presetAvatar",(function(){return fn})),n.d(t,"setChatPhoto",(function(){return hn})),n.d(t,"createChat",(function(){return pn})),n.d(t,"createCommunityChat",(function(){return gn})),n.d(t,"resync",(function(){return mn})),n.d(t,"toggleSendingAbility",(function(){return bn})),n.d(t,"setDelayedMessage",(function(){return vn})),n.d(t,"isAnythingLoading",(function(){return Cn})),n.d(t,"updateUnreadCount",(function(){return En})),n.d(t,"changeSubmitSettings",(function(){return yn})),n.d(t,"updateFavAndTitle",(function(){return On})),n.d(t,"saveHistoryScroll",(function(){return Tn})),n.d(t,"filterFromTab",(function(){return wn})),n.d(t,"changeDialogsTab",(function(){return Nn})),n.d(t,"updateFolderState",(function(){return kn})),n.d(t,"toggleDialogImportant",(function(){return An})),n.d(t,"markDialogAnswered",(function(){return Sn})),n.d(t,"markDialogUnread",(function(){return jn})),n.d(t,"markDialogRead",(function(){return Ln})),n.d(t,"getMutexQueue",(function(){return Mn})),n.d(t,"releaseBlock",(function(){return Pn})),n.d(t,"toggleCommunityMute",(function(){return Fn})),n.d(t,"deleteDialog",(function(){return Rn})),n.d(t,"restoreDialog",(function(){return xn})),n.d(t,"spamDialog",(function(){return Dn})),n.d(t,"updateTabbedPeers",(function(){return Bn})),n.d(t,"isEverythingLoaded",(function(){return Hn})),n.d(t,"cleanTab",(function(){return Un})),n.d(t,"stringifyTab",(function(){return Gn})),n.d(t,"updateGoToEndVisibility",(function(){return qn})),n.d(t,"updateGoToMentionVisibility",(function(){return Wn})),n.d(t,"toggleCommunityMessages",(function(){return Kn})),n.d(t,"updateHistory",(function(){return zn})),n.d(t,"syncHistory",(function(){return Vn})),n.d(t,"startRecording",(function(){return Yn})),n.d(t,"cancelRecording",(function(){return $n})),n.d(t,"setVoiceMessageAvail",(function(){return Qn})),n.d(t,"toggleConversation",(function(){return Xn})),n.d(t,"updateSearchQuery",(function(){return Jn})),n.d(t,"initializeChatResize",(function(){return Zn})),n.d(t,"joinChat",(function(){return er})),n.d(t,"getInviteLink",(function(){return tr})),n.d(t,"resetInviteLink",(function(){return nr})),n.d(t,"leaveInvitation",(function(){return rr})),n.d(t,"saveRecentSearchPeer",(function(){return ar})),n.d(t,"resetRecentSearch",(function(){return ir})),n.d(t,"removeFromRecentSearch",(function(){return or})),n.d(t,"pinMessageOptimistic",(function(){return sr})),n.d(t,"unpinMessageOptimistic",(function(){return cr})),n.d(t,"pinMessage",(function(){return ur})),n.d(t,"unpinMessage",(function(){return lr})),n.d(t,"getPinnedMessage",(function(){return dr})),n.d(t,"getMessageLocalId",(function(){return _r})),n.d(t,"getChatMembers",(function(){return fr})),n.d(t,"getChatDetails",(function(){return hr})),n.d(t,"updateFlags",(function(){return pr})),n.d(t,"removeChatPhoto",(function(){return gr})),n.d(t,"kickUserOptimisticly",(function(){return mr})),n.d(t,"kickUser",(function(){return br})),n.d(t,"toggleAdminOptimisticly",(function(){return vr})),n.d(t,"toggleAdmin",(function(){return Cr})),n.d(t,"checkChatMember",(function(){return Er})),n.d(t,"hidePromoTooltip",(function(){return yr})),n.d(t,"videoAutoPlayHandler",(function(){return Or})),n.d(t,"hideTopBannerAction",(function(){return Tr})),n.d(t,"callbackTopBannerAction",(function(){return wr})),n.d(t,"loadBanner",(function(){return Nr})),n.d(t,"setKeyboard",(function(){return Ir})),n.d(t,"deleteKeyboard",(function(){return kr})),n.d(t,"toggleKeyboard",(function(){return Ar})),n.d(t,"loadKeyboard",(function(){return Sr})),n.d(t,"changeCommunityAccess",(function(){return jr})),n.d(t,"deleteTemplate",(function(){return Lr})),n.d(t,"createTemplate",(function(){return Mr})),n.d(t,"updateTemplate",(function(){return Pr})),n.d(t,"resetTabAll",(function(){return Fr})),n.d(t,"updateMessageRequestsCounter",(function(){return Rr})),n.d(t,"updateCasperMessageExpiringStatus",(function(){return xr})),n.d(t,"prepareCasperMessagesFromMessages",(function(){return Dr})),n.d(t,"peerProfileToggleTag",(function(){return Br})),n.d(t,"peerProfileManageTags",(function(){return Hr})),n.d(t,"peerProfileSaveNote",(function(){return Ur})),n.d(t,"reloadMessage",(function(){return Gr})),n.d(t,"getPeerActiveCallData",(function(){return qr})),n.d(t,"removePeerActiveCallData",(function(){return Wr}));n("HEwt"),n("rE2o"),n("ioFf"),n("hhXQ"),n("a1Th"),n("OG14"),n("OEbY"),n("Vd3H"),n("91GP"),n("SRfc"),n("rGqo"),n("VRzm"),n("Btvt");var r=n("BxOC"),a=n("bIHZ"),i=n("f01n"),o=n("DM26"),s=n("rudk"),c=n("aong"),u=n("uytb"),l=n("P13b"),d=n("h++7"),_=n("rHUl"),f=n("MhhX"),h=n("86+7"),p=n("ERyv"),g=n("Wu9C"),m=n("lJdi"),b=n("O8ze"),v=n("zxIV"),C=n("XzvV"),E=n("ambf");function y(){return(y=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}function O(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var n=[],r=!0,a=!1,i=void 0;try{for(var o,s=e[Symbol.iterator]();!(r=(o=s.next()).done)&&(n.push(o.value),!t||n.length!==t);r=!0);}catch(e){a=!0,i=e}finally{try{r||null==s.return||s.return()}finally{if(a)throw i}}return n}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return T(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return T(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function T(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var w="al_im.php",N=5,I="typing",k="audiomessage",A=Object(a.updateLazyLocation)(),S=A.scheduleNav,j=A.commitNav,L=A.scheduleNavWithTimeOut;var M="settings",P="block",F="invite",R="media",x="search",D="pin_hide",B="pin_unhide",H="unpin",U="mute",G="unmute",q="clear",W="leave",K="return",z="block_community",V="allow_community",Y="block_notify",$="call_audio",Q="call_video",X="unread",J={[M]:0,[P]:1,[F]:2,[R]:3,[x]:6,[X]:6,[D]:7,[B]:7,[H]:8,[U]:10,[G]:10,[q]:11,[W]:12,[K]:12,[z]:12,[V]:12,[Y]:12};function Z(e,t,n){return Object(r.post)(w,{act:"a_renew_hash",peers:e.join(","),gid:t.hidegid?void 0:n.gid})}function ee(e,t,n){return function(e){return e.resync_in_process?e.resync_in_process:Promise.resolve(!1)}(e).then(r=>r?t(...n):function(e){if(!e.renew_hashes){var t=e.last_hashes_update||0;if(Date.now()-t<1e4)return Promise.resolve();var n=Object.keys(e.tabs).filter(t=>Object(l.isFullyLoadedTab)(e,t));e.renew_hashes=Z(n,{},e).then(t=>{var r=O(t,3),a=r[0],i=r[1],o=r[2];return n.forEach(t=>{e.tabs[t].hash=a[t]}),e.writeHash=i,e.manageTagsHash=o,delete e.renew_hashes,e.last_hashes_update=Date.now(),e})}return e.renew_hashes}(e).then(e=>t(...n)))}function te(e){return function(){var t=arguments,n=t[t.length-1];return e(...t).catch(r=>{if(r&&r.match&&r.match(/1001;/))return ee(n,e,t);throw r})}}function ne(e){return Object(r.post)(w,y({act:"a_get_write_hash"},e))}function re(e){return"string"==typeof e?Object(v.se)(`<div>${e}</div>`):e}function ae(e){return"string"==typeof e?e:e.innerHTML}function ie(e,t){return t.block_states=extend(t.block_states,e),Promise.resolve(t)}function oe(e,t){return t.tabs[e].can_start_call=Object(m.canStartGroupCall)(t,e),Promise.resolve(t)}function se(e,t,n,a,i){return i.tabHistoryNotChanged=!1,Object(o.retryFn)(r.post,3,e=>e-1)(w,{act:"a_start",peer:e,msgid:n,history:t,prevpeer:i.prevPeer,gid:i.gid,block:a}).then(t=>{var r=O(t,6),a=r[0],o=r[1],s=r[2],c=r[3],u=r[4],_=r[5];if(o.forEach(e=>Object(h.oCacheAdd)(i,e)),i.tabs||(i.tabs={}),i.dialog_tab_cts=Object.assign({},u,{[d.FOLDER_MESSAGE_REQUEST]:i.dialog_tab_cts[d.FOLDER_MESSAGE_REQUEST]}),i.tabs[e]||(i.tabs[e]=Object(l.normalizeTab)(i,a)),ie(c,i),n){if(i.tabs[e]){var f=i.tabs[e].lastmsg,p=i.tabs[e].lastmsg_meta;extend(i.tabs[e],a),i.tabs[e].lastmsg=f,i.tabs[e].lastmsg_meta=p}}else extend(i.tabs[e],a);return i.admins=extend(i.admins,s),i.imQueue(e,!1),Or(),_&&(i.tabs[e].peer_profile_info=_),ce(e,i)}).catch(e=>Object(p.imWeirdCatch)("loadPeer",e))}function ce(e,t){var n=t.imQueue(e,!1),r=t.tabs[e],a=n.filter(n=>!Object(_.isRidExist)(t,e,n.rid));return r.msgs=a.reduce((e,t)=>(e["rid"+t.rid]=t.mess,e),r.msgs),t.imQueueSet(e,a),t.tabs[e].history=Object(l.restoreQueue)(a,t,re(t.tabs[e].history)),Promise.resolve(t)}function ue(e,t,n,r){var a=r.imQueue(t),i=[],o=[];return a.forEach(e=>{e.failed&&n&&e.mess.messageId!==n&&o.push(e),!e.failed||n&&e.mess.messageId!==n||i.push("rid"+e.rid)}),r.imQueueSet(t,o),r.tabs[t].history=Object(l.removeMessages)(i,re(r.tabs[t].history)),Object(l.removeMessages)(i,e),Promise.resolve(r)}function le(e,t,n){var r=n.imQueue(t),a=[],i=[],o=Date.now();return r.forEach(e=>{e.failed&&o-e.ts<864e5&&i.push(e),e.failed&&o-e.ts>=864e5&&a.push("rid"+e.rid)}),n.imQueueSet(t,i),n.tabs[t].history=Object(l.removeMessages)(a,re(n.tabs[t].history)),Object(l.removeMessages)(a,e),Promise.resolve(n)}function de(e,t){return!1===(t.block_states[e]||{}).free?Promise.resolve(t):Object(r.post)(w,{act:"a_block",peer:e,prevPeer:t.prevPeer,gid:t.gid}).then(e=>ie(O(e,1)[0],t))}function _e(e,t){var n=t.peer;return Promise.resolve(t).then(t=>(t.tabHistoryNotChanged=!1,Object(l.isFullyLoadedTab)(t,n)&&!t.tabs[n].msgid?(t.gid&&de(n,t),Promise.resolve(t).then(me)):(Object(l.isFullyLoadedTab)(t,n)&&(t.tabs[n].msgid=!1),se(n,e,!1,!0,t)))).then(me).then(fe.bind(null,n))}function fe(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return Object(l.isTabLoaded)(t,e)&&(t.tabs[e].last_touched=Date.now()),Object(l.isTabLoaded)(t,e)&&n&&(t.tabs[e].last_visited=Date.now()),t}function he(e,t,n){var r=n.msgid,a=n.peer;return!e&&Object(l.isFullyLoadedTab)(n,a)&&n.tabs[a].msgs[r]?(t===n.peer?n.tabHistoryNotChanged=!0:n.tabHistoryNotChanged=!1,n.gid&&de(a,n),Promise.resolve(n).then(me).then(fe.bind(null,a))):se(a,!0,r,!0,n).then(me).then(()=>(Object(_.getTab)(n,a).msgid=r,n)).then(fe.bind(null,a))}function pe(e,t,n,r){if(Cn(r))throw Object(l.showWaitUntilUploadedBox)(),new Error("Cant change peer while loading something");var a=r.gid?"gim"+r.gid:"im";if(r.prevPeer=r.peer,r.peer=e,r.msgid=t||"",r.currentEntryPoint=n,cur.peer=e,S({sel:e?Object(l.convertPeerToUrl)(e):null,msgid:r.msgid,email:"",0:a}),0!=r.prevPeer&&fe(r.prevPeer,r,!0),0!==e){Object(l.isTabLoaded)(r,e)&&fe(e,r,!0),Bn(r.tabbedPeers.map(e=>e.peer).indexOf(e)<0?[{peer:e,type:"perm"}].concat(r.tabbedPeers):r.tabbedPeers.map(t=>(t.peer==e&&"perm"!==t.type&&(t.type="perm"),t)),!1,r)}else Bn(r.tabbedPeers,!1,r);return j(),Ct(r.prevPeer,r)}function ge(e){var t=e.isMassMentionsMessageAllowed;cur.wallMentions=()=>new Promise((n,r)=>{if(cur.wallMentions=[],!Object(l.isChatPeer)(e.peer)||!Object(l.isFullyLoadedTab)(e,e.peer)||Object(l.isFvkcomgroup)(e,e.peer))return r();var a=e.tabs[e.peer];function i(){var r=[];Object.keys(a.msgs||{}).reverse().forEach(e=>{var t=Object(_.parserMessage)(a.msgs[e]),n=t&&t.userId;n&&n!=vk.id&&-1===r.indexOf(n)&&Object(l.isUserAliveInChat)(a,n)&&r.push(n)}),(a.memberIds||[]).forEach(e=>{-1===r.indexOf(e)&&r.push(e)});var i=[];r.forEach(t=>{if(Object(h.oCacheExists)(e,t)){var n=Object(h.oCacheGet)(e,t),r=n.link.substring(1);i.push([n.id,n.name,"@"+r,n.photo,void 0,void 0,void 0,r,n.first_name,""])}});var o=getLang("mail_im_mention_all"),s=getLang("mail_im_mention_online");t&&Object(m.canMassMention)(e)&&i&&i.length>1&&(d.MASS_MENTION_ALIASES.online.forEach(e=>i.push(["online",s,"@"+e,"/images/mention_online.svg",void 0,void 0,void 0,e,e,""])),d.MASS_MENTION_ALIASES.all.forEach(e=>i.push(["all",o,"@"+e,"/images/mention_all.svg",void 0,void 0,void 0,e,e,""]))),n(i)}a.membersLoaded?i():fr(e.peer,e).then(i)})}function me(e){var t=e.peer;if(0===t)return Promise.resolve(e);var n=e.tabs[t],r=Object(l.isChatPeer)(t),a=Object(_.isChannelPeer)(n),i=Object(_.isCommunityChat)(e,t),o=r&&!Object(_.isChatActive)(n),s=!!n.offset,c=[];s&&c.push(R),s&&c.push(x),0===n.unread&&c.push(X),!Object(l.isEmailPeer)(t)&&!s||a||c.push(q),!Object(l.isCommunityInterface)(e)||a||i||c.push(P),a&&!o&&c.push(M),Object(l.isCommunityPeer)(t)&&(n.can_send_notify?c.push(Y):c.push(n.blocked_community?V:z)),!Object(l.isCommunityInterface)(e)&&(r||Object(l.isUserPeer)(t)||Object(l.isCommunityPeer)(t))&&(!r||!o)&&c.push(inArray(t,e.mutedPeers)?G:U);var u=!Object(l.isCommunityInterface)(e)&&Object(l.isUserPeer)(t)&&n.is_friend&&!n.block_error,d=r&&!o&&Object(m.canInviteUser)(e);(u||d)&&c.push(F),!r||o||Object(l.isCommunityInterface)(e)||c.push(W),r&&n.data.closed&&!n.data.kicked&&c.push(K),r&&n.pinned&&(c.push(Object(g.isPinnedMessageVisibleInTab)(e,t)?D:B),Object(m.canPinOrUnpin)(e)&&c.push(H));var f=Object(l.chatActions)(e,a);return e.curActions=c.sort((e,t)=>J[e]-J[t]).reduce((e,t)=>(e[t]=f[t],e),{}),Promise.resolve(e)}function be(e,t,n){var a=n.tabs[n.peer];return Object(r.post)(w,{peer:n.peer,whole:e,act:"a_history",offset:a.offset+(a.skipped||0),toend:t,gid:n.gid}).then(e=>{var t=O(e,4),r=t[0],i=t[1],o=t[2],s=t[3];return a.allShown=o,n.admins=extend(n.admins,s),a.history=r+ae(a.history),a.historyToAppend=r,a.offset+=Object.keys(i).length,a.msgs=extend(a.msgs,i),n})}function ve(e){var t=e.tabs[e.peer];return Object(r.post)(w,{peer:e.peer,act:"a_history",rev:1,offset:t.skipped,gid:e.gid}).then(n=>{var r=O(n,5),a=r[0],i=r[1],o=r[2];r[3],r[4];t.allShown=t.allShown||o,t.history=ae(t.history)+a,t.historyToAppend=a;var s=Object.keys(i).length;return t.skipped-=s,t.offset+=s,t.msgs=extend(t.msgs,i),e})}function Ce(e,t,n,r){var a=e.tabs[t];return r===i.FLAG_OUTBOUND&&a.out_up_to>n||(r===i.FLAG_OUTBOUND?a.out_up_to=n:a.in_up_to=n),e}var Ee=te((function(e,t){if(Object(l.tabIsMessageRequest)(t.tabs[e]))return Promise.resolve(t);var n=t.tabs[e],a=n.msgs||{},o=Object.keys(a).map(n=>Object(_.getMessage)(t,e,n)).filter(e=>!Object(f.isOut)(e)).map(e=>e.messageId).sort((e,t)=>t-e);return n.skipped>0&&(o=o.filter(e=>intval(e)<=n.lastmsg-n.skipped)),(o=intval(o.shift()))<=n.in_up_to?Promise.resolve(t):(t.longpoll.push([i.readInboundEvent([6,e,o,null])]),Object(r.post)(w,{peer:e,ids:[o],hash:n.hash,act:"a_mark_read",gid:t.gid}).then(()=>Ce(t,e,o,i.FLAG_OUTBOUND)).catch(()=>t))})),ye=te((function(e,t,n){var a=n.tabs[t];return Object(l.tabIsMessageRequest)(a)||Object(l.tabIsOutgoingMessageRequest)(a)||e<=a.in_up_to?Promise.resolve(n):(n.longpoll.push([i.readInboundEvent([6,t,e,null])]),Object(r.post)(w,{peer:t,ids:[e],hash:a.hash,act:"a_mark_read",gid:n.gid}).then(()=>Ce(n,t,e,i.FLAG_OUTBOUND)))})),Oe=te((function(e,t,n){var a=n.tabs[e];return Object(r.post)(w,{peer:e,id:t,hash:a.hash,act:"a_mark_listened",gid:n.gid})}));function Te(e){return Object(r.post)(w,{act:"a_get_key",uid:e.id,gid:e.gid}).then(t=>{var n=O(t,3),r=n[0],a=n[1],i=n[2];return extend({},e,{imKey:r,imUrl:a,imPart:i})})}function we(e){return Object(r.post)(w,{act:"a_get_ts",gid:e.gid}).then(t=>{var n=O(t,1)[0];return extend({},e,{imTs:n})})}function Ne(e,t,n){var r=n.tabs[e];return r.msgs[t.messageId]&&(r.msgs[t.messageId].errored=1,r.history=Object(l.setMessageError)(e,t,re(r.history))),Promise.resolve(n)}function Ie(e,t,n,r){var a=r.tabs[e];return a.msgs[t]&&(a.msgs[t].errored=0,a.lastmsg_meta=n,a.lastmsg=t,a.history=Object(l.startResendMessage)(e,t,re(a.history))),Promise.resolve(r)}function ke(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]&&arguments[4];t.deletedDialog||(e.dialog_tabs=Object.keys(e.dialog_tabs).reduce((e,i)=>(!n&&!wn(i)(t)||a&&!a(i,e[i],t)||(e[i]=Object(c.arrayUnique)(r(e[i],i))),e),e.dialog_tabs))}function Ae(e,t){return 0===e.length?Promise.resolve(t):Object(r.post)(w,{act:"a_get_admin",admins:e.join(","),gid:t.gid}).then(e=>{var n=O(e,1)[0];return t.admins=extend(t.admins,n),t})}function Se(e,t){if(!inArray(e,t.tabbedPeers.map(e=>e.peer))&&(0!==t.peer||t.searchText)&&!inArray(e,t.mutedPeers)){var n={peer:e,type:"temp"};Bn(t.tabbedPeers.concat([n]),!1,t)}}function je(e,t,n){return Object(l.isReversedDialogs)(n)?t.concat([e]):[e].concat(t)}function Le(e,t){var n=e.get().peer,r=Object(_.getTab)(e,n);if(Object(l.isFullyLoadedTab)(e,n)){var a=re(r.history);r.history=Object(l.updateMessageInCache)(e,a,t)}}function Me(e,t){var n=Object(_.getTab)(t,e.peerId);if(Object(l.isFullyLoadedTab)(t,e.peerId)){var r=re(n.history);n.msgs[e.messageId]=extend(!0,{},e),n.history=Object(l.editAndReplaceMessage)(t,e,r)}n&&n.lastmsg===e.messageId&&(n.lastmsg_meta=e);var a=n&&n.pinned&&Object(_.parserMessage)(n.pinned);if(a&&a.messageId===e.messageId&&(n.pinned=e),Object(l.isTabLoaded)(t,e.peerId)&&!Object(f.isOut)(e)&&Object(f.isUnread)(n,e)){var i=Object(f.hasUserMentions)(e,t.id),o=n.mentions&&n.mentions.includes(e.messageId);i&&!o?(n.mentions||(n.mentions=[]),n.mentions.push(e.messageId)):!i&&o&&xe(e.peerId,t=>t!==e.messageId,t)}return Promise.resolve(t)}function Pe(e,t){var n=e.flags&i.FLAG_OUTBOUND,r=e.peerId;if(Object(l.isTabLoaded)(t,r)){var a=t.tabs[r];if(a.lastmsg>e.messageId)return Promise.resolve(t);if(a.deletedDialog=!1,!t.msg_local_ids_sort&&e.local?t.msg_local_ids_sort={[e.messageId]:0}:e.local&&(t.msg_local_ids_sort[e.messageId]=Object.keys(t.msg_local_ids_sort).length),n||Object(l.tabIsMessageRequest)(a)?a.unread=0:(a.lastmsg===e.messageId&&a.unread?Fe(t,1,e.peerId):(!a.unread&&Fe(t,1,e.peerId),a.unread++),E.casperMessagesStore.has(e.messageId)&&!Object(_.isCasperChatTab)(a)&&(a.expiring_messages||(a.expiring_messages=[]),a.expiring_messages.push(e.messageId)),Object(f.hasUserMentions)(e,t.id)&&(a.mentions||(a.mentions=[]),a.mentions.push(e.messageId)),Se(e.peerId,t)),Object(l.isFullyLoadedTab)(t,r)){var o=Object(f.isMessageToBlockedCommunity)(a,e),s=o||0===a.offset;o&&(a.blocked_community=0),a.skipped>0&&a.skipped++,a.offset++,a.msgs[e.messageId]=extend(!0,{},e);var c=re(a.history);a.history=Object(l.appendToHistory)(t,e,c,!0,!0,!0),s&&me(t)}if(a.typing){var u=a.typing.userIds.indexOf(e.userId);u>=0&&a.typing.userIds.splice(u,1)}return a.lastmsg=e.messageId,a.lastmsg_meta=e,Number.isInteger(e.messageId)&&e.messageId>(a.minor_sort_id||0)&&(a.minor_sort_id=e.messageId),fe(e.peerId,t),ke(t,a,!1,je.bind(null,r),In.bind(null,t)),Promise.resolve(t)}return se(r,0,0,0,t).then(t=>(ke(t,t.tabs[r],!1,je.bind(null,r),In.bind(null,t)),fe(e.peerId,t),n||Se(e.peerId,t),t))}function Fe(e,t,n){e.cur_unread_cnt||(e.cur_unread_cnt={}),-1===t&&delete e.cur_unread_cnt[n],e.unread_cnt+=t}function Re(e,t,n){var r=n.tabs[e];return r.expiring_messages&&(r.expiring_messages=r.expiring_messages.filter(t),r.expiring_messages.length||delete r.expiring_messages),n}function xe(e,t,n){var r=n.tabs[e];return r.mentions&&(r.mentions=r.mentions.filter(t),r.mentions.length||delete r.mentions),n}function De(e,t){var n=Object(_.getTab)(t,e.peerId);if(Object(l.isFullyLoadedTab)(t,e.peerId)){var r=n.unread;if(t=Ce(t,e.peerId,e.upToId,0),null!==e.unread?n.unread=e.unread:n.unread=e.upToId>=n.lastmsg?0:Object(_.countUnread)(e.peerId,t)+(n.unread>0?+n.skipped:0),r>0&&!n.unread&&Fe(t,-1,e.peerId),!n.skipped){var a=re(n.history);n.history=Object(l.removewNewUnreadBarAndMerge)(t,a,e.peerId)}}else Object(l.isTabLoaded)(t,e.peerId)&&(t.tabs[e.peerId].unread>0&&Fe(t,-1,e.peerId),t.tabs[e.peerId].unread=0,t.tabs[e.peerId].in_up_to=e.upToId);return Object(l.isTabLoaded)(t,e.peerId)&&e.upToId>=n.lastmsg&&(t.dialog_tabs[d.FOLDER_UNREAD]=t.dialog_tabs[d.FOLDER_UNREAD].filter(t=>intval(t)!==e.peerId)),Object(l.isTabLoaded)(t,e.peerId)&&(Re(e.peerId,t=>t>e.upToId,t),xe(e.peerId,t=>t>e.upToId,t)),0!==t.unread_cnt||t.active_tab!==d.FOLDER_UNREAD||t.gid?Promise.resolve(t):Nn(d.FOLDER_ALL,t)}function Be(e,t){var n=t.tabs[e.peerId];if(Object(l.isTabLoaded)(t,e.peerId)&&Ce(t,e.peerId,e.upToId,i.FLAG_OUTBOUND),Object(l.isFullyLoadedTab)(t,e.peerId)){var r=re(n.history);n.history=Object(l.markMessagesAsRead)(t,e.peerId,r)}return Promise.resolve(t)}function He(e,t,n,r,a){return a.text={},a.imQueue=e,a.imQueueResend=t,a.imQueueSet=n,a.imQueueComplete=r,Promise.resolve(a)}function Ue(e,t,n){function r(e,t){return{id:e.messageId,text:e.text,date:e.date,kludges:e.kludges,authorName:t}}if(1===e.length){var a=e[0],i=Object(_.getMessage)(n,t,a),o=Object(_.getAuthorFullName)(n,t,a);return!1===o?n.set(Vt.bind(null,{[t]:[i.userId]})).then(n=>{var o=Object(_.getAuthorFullName)(n,t,a);return{msgIds:e,object:r(i,o)}}):Promise.resolve({msgIds:e,object:r(i,o)})}return Promise.resolve({msgIds:e})}function Ge(e,t){Object(l.normalizeTabsGotFromServer)(t,e);var n=t.tabs[t.peer];return t.tabs=Object.keys(e).reduce((n,r)=>{var a=t.tabs[r]?t.tabs[r].msgs:{},i=extend({},a||{},e[r].msgs||{});return n[r]=extend(t.tabs[r]||{},e[r]),i&&(n[r].msgs=i),e[r].lastmsg||(n[r].lastmsg=!1),n},t.tabs),n&&(t.tabs[t.peer]=n),Promise.resolve(t)}function qe(e,t,n,r){var a=Object(_.getTab)(r,e);if(a&&a.last_seen&&a.last_seen.can_see){var i=!1!==t?mobPlatforms[t]?1:0:a.last_seen.mobile;a.online=t,a.last_seen={platform:t,time:n||a.last_seen.time,mobile:i,can_see:a.last_seen.can_see}}return Promise.resolve(r)}function We(e,t,n){var r=Object(_.getTab)(n,e.peerId);return r&&(e.ts=Date.now()/1e3,r.activity||(r.activity={}),r.activity[t]=e,r.typing===I&&(r.typing=e)),Promise.resolve(n)}function Ke(e,t){var n=Object(_.getTab)(t,e.peerId),r=Object(f.isAudioMsg)(e)?"audiomessage":"typing";return n&&n.activity&&n.activity[r]&&(n.activity[r].userIds=n.activity[r].userIds.filter(t=>t!==e.userId)),Promise.resolve(t)}function ze(e,t,n){var r=e.peerId;return Object(o.pause)(N+2).then(()=>{if(Object(l.isTabLoaded)(n,r)){var e=n.tabs[r];if((e.activity||{})[t])Date.now()-1e3*e.activity[t].ts>=1e3*N&&(delete e.activity[t],0===Object.keys(e.activity)&&delete e.activity);if(e.typing)Date.now()-1e3*e.typing.ts>=1e3*N&&(e.typing=void 0)}return n})}function Ve(e){var t={},n=e.find(e=>"poll"===e[0]);if(n){var r=O(n,3)[2];Object.assign(t,r)}return t}var Ye=function(e,t,n,a){var i=Date.now()+rand(0,100).toFixed(0),o=a.ref_id,c=a.ref_source;a.ref_source=void 0,a.ref_id=void 0,(c||o)&&(S({ref_source:null,ref:null}),j()),Object(b.statlogsSendingQueueLength)(a);var u=t.attaches.length>0,l=Object(b.statlogsSendingTime)(a,"send","server",u),d=Object.assign({act:"a_send",to:e,hash:n.hash,ref_source:c,ref:o,msg:t.message,payload:t.payload,media:Object(s.convertAttachesToPhpMedia)(t.attaches),guid:i,share_url:t.share_url,cancelled_shares:t.cancelled_shares,random_id:t.rid,gid:n.hidegid?void 0:a.gid,entrypoint:a.currentEntryPoint||"",sticker_referrer:t.sticker_referrer},n.external,Ve(t.attaches));return Object(r.post)(w,d,2e4).then(e=>{var t=O(e,1)[0];return l(),a.version!==t.version&&nav.reload({force:!0}),a.currentEntryPoint="",a}).catch(e=>{throw Object(b.statlogsSendingError)(a,e,"send","server_send"),e})},$e=te((function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=arguments.length>3?arguments[3]:void 0,a=r.tabs[e];return Ye(e,t,y({hash:a.hash},n),r)})),Qe=te((function(e,t,n){var a=t.attaches.length>0,i=Object(b.statlogsSendingTime)(n,"edit","server",a);return Object(r.post)(w,Object.assign({act:"a_edit_message",hash:e.hash,id:t.messageId,peerId:e.peerId,gid:n.gid,msg:t.origText,media:Object(s.convertAttachesToPhpMedia)(t.attaches),share_url:t.share_url,cancelled_shares:t.cancelled_shares},Ve(t.attaches)),2e4).then(e=>{O(e,1)[0];return i(),n}).catch(e=>{throw Object(b.statlogsSendingError)(n,e,"edit","server_send"),e})}));function Xe(e,t){if(t.selectedMessages||(t.selectedMessages=[]),1===e.length&&inArray(e[0],t.selectedMessages))t.selectedMessages=t.selectedMessages.filter(t=>t!==e[0]);else{var n=t.selectedMessages.concat(e);t.selectedMessages=Object(c.arrayUnique)(n).sort((e,t)=>e-t)}return Promise.resolve(t)}function Je(e){return e.selectedMessages=[],Promise.resolve(e)}function Ze(e){return e.selectedMessages=[],Promise.resolve(e)}function et(e,t){if(Object(l.isFullyLoadedTab)(t,e.peerId)){var n=t.tabs[e.peerId],r=t.imQueue(e.peerId).filter(t=>t.failed&&t.rid!==e.randomId);t.imQueueSet(e.peerId,r),t.imQueueComplete(e.peerId,e.randomId),n.lastmsg_meta=e,n.lastmsg=e.messageId,Number.isInteger(e.messageId)&&e.messageId>n.minor_sort_id&&(n.minor_sort_id=e.messageId),n.msgs["rid"+e.randomId]&&(n.msgs[e.messageId]=e,delete n.msgs["rid"+e.randomId]),n.history=Object(l.replaceMessageAttrs)(t,re(n.history),e)}return Promise.resolve(t)}function tt(e,t){return Promise.resolve()}function nt(e,t){var n=Object(b.statlogsSendingTime)(t,"unknown","attach"),a={act:"a_get_media",id:e.messageId,gid:t.gid};return Object(o.retryFn)(r.post,3,e=>e*e)(w,a).then(r=>(n(),rt(e,r,t))).catch(n=>(Object(b.statlogsSendingError)(t,n,"unknown","server_load_attach"),rt(e,null,t)))}function rt(e,t,n){var r=n.tabs[e.peerId],a=t&&t[2];return r.mediacontent||(r.mediacontent={}),r.mediacontent[e.messageId]=t||[getTemplate("im_retry_link")],a&&(a.no_forward&&(r.msgs[e.messageId].kludges.no_forward=!0),a.no_pin&&(r.msgs[e.messageId].kludges.no_pin=!0)),at(e,n)}function at(e,t){var n=t.tabs[e.peerId];return n.history=Object(l.replaceAttaches)(re(n.history),e,t),Promise.resolve(t)}function it(e,t,n){var r=Object(l.dayFromVal)(t),a=n.tabs[e];return a.searchDay=r,a.searchOffset=0,a.searchAllLoaded=!1,a.searchMsgs=[],Promise.resolve(n)}function ot(e,t,n){return n.tabs[t].searchText=e,yt(t,n),n}function st(e,t,n){if(t){var r=n.tabs[t];r.searchText=e,r.searchOffset=0,r.searchAllLoaded=!1}else n.searchText=e,n.searchOffset=0,n.searchAllLoaded=!1;return Promise.resolve(n)}function ct(e,t,n,a,i){return Object(r.post)(w,{act:"a_hints",str:e,gid:a.hidegid?0:i.gid,query:n,peerIds:t.join(",")}).then(t=>{var n=O(t,3),r=n[0],a=n[1];if(ie(n[2],i),a.forEach(e=>Object(h.oCacheAdd)(i,e)),Ge(r,i),e){var o=r&&Object.keys(r).length;Object(C.saveSearchAttemptStats)(C.serviceMessages,0,o,e)}return Object.keys(r).sort((e,t)=>r[e].order-r[t].order).map(e=>r[e])})}function ut(e,t,n,r){return ct(e,t,n,{},r).then(e=>e.map(e=>({peerId:e.peerId,name:e.tab,photo:e.photo,online:e.online,is_friend:"friends"===n})))}function lt(e){var t={peerId:e[0],name:e[1],tab:e[1],photo:e[2],href:e[3],online:e[4],is_friend:e[5],local_index:!0};return e[6]&&(t.data={flags:e[6]}),t}function dt(e){return(t,n)=>e(n).then(e=>{var r=(t?e.search(t):e.list).map(lt);return n.mapped_index||(n.mapped_index={}),r.forEach(e=>{n.mapped_index[e.peerId]=e}),r})}var _t=dt(e=>e.topConvTree),ft=dt(e=>e.imTopConvTree),ht=dt(e=>e.hintsTree);function pt(e,t){var n,a,i;t.topConvTree=new Promise(e=>{n=e}),t.hintsTree=new Promise(e=>{a=e}),t.imTopConvTree=new Promise(e=>{i=e});var s=e.select(u.RECENT_SEARCH_OP);return Object(o.retryFn)(r.post,1,()=>4)(w,{act:"a_dialogs_preload",rs:s.join(","),gid:t.gid}).catch(e=>[[],[],[]]).then(e=>{var r=O(e,4),o=r[0],s=r[1],c=r[2],u=r[3];return t.popular_sugg=c,new vkIndexer(o,e=>e[1],n),new vkIndexer(s,e=>e[1],a),u&&u.length>0?new vkIndexer(u,e=>e[1],i):i(),t})}function gt(e){var t,n,a=e.active_tab,i=e.dialog_tabs[a];return i.length>0?i.forEach(r=>{var a=e.tabs[r],i=a.minor_sort_id,o=a.major_sort_id;void 0===t||t>o?(t=o,n=i):t===o&&n>i&&(n=i)}):(t=0,n=0),Object(r.post)(w,{act:"a_get_dialogs",start_message_id:n,major_sort_id:t,tab:a,gid:e.gid}).then(t=>{var n=O(t,4),r=n[0],o=n[1],s=n[2],c=n[3];return s.forEach(t=>Object(h.oCacheAdd)(e,t)),ie(c,e),Ge(o,e),e.dialog_tabs[a]=i.filter(e=>!o[e]).concat(Object.keys(o).map(intval)),e.dialog_tabs_all[a]=!r.has_more,Promise.resolve(e)})}var mt=te((function(e,t){return Object(r.post)(w,{act:"a_search",q:e,from:"all",gid:t.gid,hash:t.writeHash,offset:t.searchOffset||0}).then(n=>{var r=O(n,5),a=r[0],i=r[1],o=r[2],s=r[3],c=r[4];return i.forEach(e=>Object(h.oCacheAdd)(t,e)),Object(l.normalizeTabsGotFromServer)(t,a),e===t.searchText&&(t.searchOffset=s,t.searchAllLoaded=c),Object.keys(a).filter(e=>!t.tabs[e]).forEach(e=>{t.tabs[e]=a[e]}),[a,o]})}));function bt(e,t){return t.tabs[e].searchAllLoaded}function vt(e,t){return!(t.peer!==e||!Object(l.isFullyLoadedTab)(t,e))&&t.tabs[e].inplaceSearch}function Ct(e,t){if(Object(l.isFullyLoadedTab)(t,e)){var n=t.tabs[e];delete n.inplaceSearch,delete n.searchOffset,delete n.searchAllLoaded,delete n.searchText,delete n.searchDay,delete n.searchMsgs,S({st:""}),j()}return Promise.resolve(t)}function Et(e,t){if(Object(l.isFullyLoadedTab)(t,e)){var n=t.tabs[e];delete n.searchDay,n.searchOffset=0,n.searchAllLoaded=!1,n.searchMsgs=[]}return Promise.resolve(t)}function yt(e,t){return t.tabs[e].inplaceSearch=!0,Promise.resolve(t)}var Ot=te((function(e,t){var n=t.tabs[e],a="";if(yt(e,t),n.searchDay&&(a="day:"+n.searchDay),!a&&!n.searchText)return Promise.reject();var i=`in:${e} ${a} ${n.searchText||""}`;return S({st:n.searchText}),j(),Object(r.post)(w,{act:"a_search",q:i,from:"in",gid:t.gid,hash:t.writeHash,offset:n.searchOffset||0}).then(e=>{var t=O(e,4),r=t[0],a=t[1],i=t[2],o=t[3];return n.searchOffset=a,n.searchAllLoaded=i,n.searchMsgs=(n.searchMsgs||[]).concat(o),r})}));function Tt(e){return Object(r.post)(w,{act:"a_important",offset:e,part:e>0})}function wt(e,t){var n=Object(_.getTab)(e,t);return Object(r.post)(w,{act:"a_load_lastmsg",peerId:t,gid:e.get().gid}).then(r=>{var a=O(r,4),i=a[0],o=a[1],s=a[2],c=a[3],u=intval(i[0]);n.lastmsg=u||!1,n.lastmsg_meta=i,(!Object(_.isCasperChat)(e,t)||u>n.minor_sort_id)&&(n.minor_sort_id=u);var l=O(o,3);n.unread=l[0],n.in_up_to=l[1],n.out_up_to=l[2],s?n.mentions=s:n.mentions&&delete n.mentions,c?n.expiring_messages=c:n.expiring_messages&&delete n.expiring_messages,n.unread||(e.get().dialog_tabs[d.FOLDER_UNREAD]=e.get().dialog_tabs[d.FOLDER_UNREAD].filter(e=>e!=t)),ke(e.get(),n,!1,je.bind(null,t),In.bind(null,e.get()))})}function Nt(e,t,n){n.tabs[e].unread-=t.length;var r=t.reduce((e,t)=>(e[t]=!0,e),{});return Re(e,e=>!r[e],n),xe(e,e=>!r[e],n),Promise.resolve(n)}function It(e,t,n){if(Object(l.isFullyLoadedTab)(n,t)){var r=n.tabs[t];r.deleted=r.deleted?r.deleted.concat(e):e}return Promise.resolve(n)}function kt(e,t,n){if(Object(l.isFullyLoadedTab)(n,t)){var r=n.tabs[t];if(r.history=Object(l.removeMessages)(e,re(r.history)),r.offset-=e.filter(e=>r.msgs[e]).length,e.forEach(e=>delete r.msgs[e]),e.forEach(e=>{var t=(n.selectedMessages||[]).indexOf(e);-1!=t&&n.selectedMessages.splice(t,1)}),r.inplaceSearch){var a=e.reduce((e,t)=>(e[t]=!0,e),{});r.searchMsgs=r.searchMsgs.filter(e=>!a[e]),r.searchOffset=r.searchMsgs.length}}return Promise.resolve(n)}var At=te((function(e,t,n,a,i){return Object(r.post)(w,{act:"a_mark",peer:t,hash:n||i.tabs[t].hash,gid:i.gid,msgs_ids:e.join(","),mark:a})}));function St(e,t,n,r){if(Object(l.isFullyLoadedTab)(r,t)){var a=r.tabs[t];a.deleted=a.deleted?a.deleted.concat(e):e,a.history=Object(l.removeMessagesWithRestore)(e,t,n,re(a.history)),a.offset-=e.filter(e=>a.msgs[e]).length}return Promise.resolve(r)}function jt(e,t,n){if(Object(l.isFullyLoadedTab)(n,t)){var r=n.tabs[t];r.deleted&&(r.deleted=r.deleted.filter(t=>t!==e)),r.history=Object(l.restoreMessage)(e,t,re(r.history)),r.offset++}return Promise.resolve(n)}function Lt(e,t,n,a){return Object(r.post)(w,{act:"a_restore",id:e,peer:t,hash:n,gid:a})}var Mt=te((function(e,t,n){return Object(l.tabIsMessageRequest)(n.tabs[e])?Promise.resolve(n):(n.tabs[e].lastTyping=Date.now(),Object(r.post)(w,{act:"a_activity",type:t,peer:e,gid:n.gid,hash:n.tabs[e].hash}).then(()=>n,()=>n))})),Pt=te((e,t)=>Object(r.post)(w,{act:"a_accept_message_request",peer_id:e,hash:t.tabs[e].hash}).then(()=>{var n=t.tabs[e];return n.is_message_request=!1,n.folders=Object(_.removeMessageRequestFolderFlags)(n.folders),t})),Ft=te((e,t)=>Object(r.post)(w,{act:"a_reject_message_request",peer_id:e,hash:t.tabs[e].hash}).then(()=>(ke(t,t.tabs[e],!0,t=>t.filter(t=>t!==Number(e))),Bn(t.tabbedPeers.filter(t=>t.peer!==e),!0,t),t))),Rt=te((e,t,n)=>Object(r.post)(w,{act:"a_cancel_message_request",peer_id:e,contact_id:t,hash:n.tabs[e].hash}).then(()=>{var r=n.tabs[e];return r&&r.invitedByMessageRequest&&(r.invitedByMessageRequest=r.invitedByMessageRequest.filter(e=>e.id!==t)),n})),xt=te((function(e,t){return Mt(e,I,t)})),Dt=te((function(e,t){return Mt(e,k,t)}));function Bt(e,t,n,r){return t&&(r.pendingForward=null,e||(e={msgIds:[]}),t.addAttach(n?"reply":"mail",e.msgIds.join(";"),e.object||null)),Promise.resolve(r)}function Ht(e,t){return t.pendingForward=e,Promise.resolve(t)}function Ut(e,t,n){if(!Object(l.isTabLoaded)(n,e))return n;n.blockedFlagUpdates||(n.blockedFlagUpdates={}),n.blockedFlagUpdates[e]=!0;var r=n.tabs[e];return ke(n,r,!0,t=>t.filter(t=>t!==e)),r.unread>0&&!Object(l.tabIsMessageRequest)(r)&&Fe(n,-1,e),r.deletedDialog=!0,Bn(n.tabbedPeers.filter(t=>t.peer!==e),!0,n),t.then(t=>{var a=O(t,2);a[0],a[1];return delete n.blockedFlagUpdates[e],r.msgs=null,r.history=null,r.unread=0,r.lastmsg=!1,r.lastmsg_meta=null,r.minor_sort_id=0,n})}var Gt=te((function(e,t){return Ut(e,Object(r.post)("al_im.php",{act:"a_flush_history",id:e,from:"im",gid:t.gid,hash:t.tabs[e].hash}),t)})),qt=te((function(e,t,n){return Object(r.post)(w,{act:"a_set_chat_title",peer:e,new_title:t,gid:n.gid,hash:n.tabs[e].hash}).then(()=>(n.onUpdate&&n.onUpdate(),n))})),Wt=te((function(e,t){return Object(r.post)(w,{act:"a_load_chat_info",peer:e,gid:t.gid,hash:t.tabs[e].hash}).then(n=>{var r=O(n,1)[0];return t.tabs[e]=extend(t.tabs[e],r),t})}));function Kt(e,t,n){var r=n.tabs[e];return r.memberIds=[].concat(r.memberIds,t).filter((e,t,n)=>n.indexOf(e)===t),r.membersCount=r.memberIds.length,Promise.resolve(n)}var zt=te((function(e,t,n,a){return Object(r.post)(w,{act:"a_add_chat_members",peer:e,new_peer:t.join(","),gid:a.gid,hash:a.tabs[e].hash,show_history:n?1:0}).then(e=>a)}));function Vt(e,t){if(isEmpty(e))return Promise.resolve(t);var n=Object.keys(e).map(t=>`${t}:${e[t].join(",")}`).join(";");return Object(r.post)(w,{act:"a_load_member",need:n,gid:t.gid}).then(e=>(O(e,1)[0].forEach(e=>Object(h.oCacheAdd)(t,e)),t))}function Yt(e,t,n){var r={},a=n.get();function o(e,t){Object(l.isChatPeer)(e)&&t&&!Object(h.oCacheExists)(a,t)&&(r[e]?-1===r[e].indexOf(t)&&r[e].push(t):r[e]=[t])}var s=t.filter(e=>!Object(l.isTabLoaded)(a,e.peerId)).map(e=>e.peerId);t.forEach(e=>{o(e.peerId,e.userId)}),e.forEach(e=>{o(e.peerId,+e.kludges.source_mid||+e.kludges.from)});var c=t.filter(e=>e.flags&i.FLAG_OUTBOUND&&!e.local).map(e=>e.kludges.from_admin).filter(e=>e&&!a.admins[e]);return 0===Object.keys(r).length&&0===c.length&&0===s.length?Promise.resolve(a):{shouldLoad:Object.keys(r).length>0||c.length>0||s.length>0,needMembers:r,needAdminIds:c,needPeers:s}}function $t(e,t,n){var r=e.needMembers,a=e.needAdminIds,i=e.needPeers;return t.pause(),Promise.all([Vt(r,n),Ae(a,n),Promise.all(i.map(e=>se(e,0,0,0,n)))]).catch(()=>n).then(()=>t.resume()).then(()=>n)}var Qt=te((function(e,t){return e.kludges.source_act===l.CHAT_PHOTO_REMOVE?(delete t.tabs[e.peerId].photo,delete t.tabs[e.peerId].photoLarge,Promise.resolve(t)):(t.onUpdate&&t.onUpdate(),Object(r.post)(w,{act:"a_get_chat_photo",msg_id:e.messageId}).then(n=>{var r=O(n,2),a=r[0],i=r[1];t.chat_photo_msg=i;var o=t.tabs[e.peerId];if(t.tabs[e.peerId].photo=a[0],t.tabs[e.peerId].photoLarge=a[1],Object(l.isFullyLoadedTab)(t,e.peerId)){var s=e.kludges.source_act;o.history=Object(l.addChatPhotoToUpdate)(e,s,t,re(o.history))}return t}))}));function Xt(e,t,n,r){return t!==vk.id||Object(l.isTabLoaded)(r,n)&&r.peer==n&&(r=me(r)),Promise.resolve(r)}var Jt=te((function(e,t){return Object(r.post)(w,{act:"a_leave_chat",chat:e-2e9,gid:t.gid,hash:t.tabs[e].hash}).then(Xt.bind(null,l.CHAT_KICK_USER,vk.id,e,t))})),Zt=te((function(e,t){return Object(r.post)(w,{act:"a_return_to_chat",chat:e-2e9,gid:t.gid,hash:t.tabs[e].hash}).then(Xt.bind(null,l.CHAT_INVITE_USER,vk.id,e,t))})),en=te((function(e,t,n,a){return Object(r.post)(w,{act:"a_mute",peer:e,hash:a.tabs[e].hash,gid:a.gid,value:Number(t),until:n}).then(()=>{var n=t?"mute":"unmute";return window.Notifier&&Notifier.lcSend("im",{act:n,peer:e}),a}).then(nn.bind(null,e,t))})),tn=te((function(e,t,n){return Object(r.post)(w,{act:"a_mute_mentions",peer:e,hash:n.tabs[e].hash,gid:n.gid,value:Number(t)}).then(()=>n)}));function nn(e,t,n){var r=n.mutedPeers.filter(t=>t!==e);return t&&r.push(e),n.mutedPeers=r,cur.mutedPeers=n.mutedPeers,me(n)}function rn(e,t){return t.stack=e,Promise.resolve(t)}var an=te((function(e,t,n,a){return on(e,n,t,a),Object(r.post)(w,{act:"a_mark_important",ids:e,val:t?1:0,from:"im",gid:a.gid,peer:n,hash:a.tabs[n].hash}).then(()=>a)}));function on(e,t,n,r){if(Object(l.isFullyLoadedTab)(r,t)){var a=r.tabs[t];e.filter(e=>a.msgs[e]).forEach(e=>{var o=Object(_.getMessage)(r,t,e),s=n?o.flags|i.FLAG_IMPORTANT:o.flags&~i.FLAG_IMPORTANT;o.flags=s,a.msgs[e]=o,a.history=Object(l.updateStar)(e,n,re(a.history))})}return Promise.resolve(r)}function sn(e,t,n){return n.importants||(n.importants={}),(n.importants[t]||0)!==e&&(n.important_cnt+=e,n.importants[t]=e),Promise.resolve(n)}function cn(e,t){return Object(r.post)(w,{act:"a_spam",offset:e,gid:t,part:e>0})}function un(e,t){return Object(r.post)(w,{act:"a_flush_spam",gid:t,hash:e})}function ln(e,t,n){return n.creationType=e,n.creationFilter=t,Promise.resolve(n)}function dn(e,t){return Object(r.post)(w,{act:"a_owner_photo",photo:JSON.parse(e).data[0],peer:t})}function _n(e){return Object(r.post)(w,{act:"a_get_contacts"}).then(t=>{var n=O(t,1)[0];return e.contactsList=n,e})}function fn(e,t){return t.next_chat_avatar=e,Promise.resolve(t)}function hn(e,t,n){return Object(r.post)("al_page.php",{act:"owner_photo_save",peer:e,_query:t,gid:n.gid}).then(e=>n)}var pn=te((function(e,t,n,a,i){return i.creating=!0,i.longpoll.pause(),Object(r.post)(w,{act:"a_multi_start",hash:i.writeHash,peers:t.join(","),title:n,flags:a}).then(e=>{var t=O(e,1)[0];return i.next_peer=t.peerId,i.tabs[t.peerId]=t,ke(i,t,!1,e=>[t.peerId].concat(e)),i.longpoll.resume(),i}).then(t=>e?hn(t.next_peer,e,t):t).then(e=>(e.creating=!1,e)).catch(e=>{throw i.creating=!1,i.longpoll.resume(),e})})),gn=te((function(e,t,n){return n.creating=!0,Object(r.post)(w,{act:"a_multi_start",hash:n.writeHash,peers:[],title:t,gid:n.gid,is_community_chat:1}).then(t=>{var r=O(t,1)[0].peer_id;if(!r)throw new Error("No peer_id");return e?hn(r,e,n):n}).then(e=>(e.creating=!1,e)).catch(e=>{throw n.creating=!1,e})}));function mn(e){var t;e.resync_in_process=new Promise(e=>{t=e});var n=Object.keys(e.tabs).length,a=e.active_tab;return Object(r.post)(w,{act:"a_resync",sel:e.peer,gid:e.gid,loaded:n,tab:a,add_peers:e.tabbedPeers.map(e=>e.peer).join(",")}).then(n=>{var r=O(n,5),i=r[0],o=r[1],s=r[2],u=r[3],_=r[4];o.forEach(t=>Object(h.oCacheAdd)(e,t)),Object(l.normalizeTabsGotFromServer)(e,i),s.user_unread&&handlePageCount("msg",s.user_unread),Object(c.lplog)("Resync success","success");var f,p=e.peer;if(Object(l.isReservedPeer)(p))f=Promise.resolve(!1);else{var g={tabs:{[p]:e.tabs[p]},oCache:{}};f=Ge({[p]:i[p]},g)}return f.then(n=>{e.tabs=i,e.admins=extend(e.admins,u),n&&(e.tabs[p]=n.tabs[p],e.tabs[p].history=Object(l.restoreQueue)(p,e,re(e.tabs[p].history))),e.loadingDialogs=!1,e.mutedPeers=s.mutedPeers,e.lastDialogsOptions={has_more:s.has_more},e.dialog_tab_cts=Object.assign({},s.folder_cts,{[d.FOLDER_MESSAGE_REQUEST]:e.dialog_tab_cts[d.FOLDER_MESSAGE_REQUEST]}),e.dialog_tabs[a]=_.map(intval);var r=e.dialog_tabs[a].map(t=>e.tabs[t]);return Object.keys(e.dialog_tabs).filter(e=>e!=a).forEach(t=>{a==d.FOLDER_ALL?e.dialog_tabs[t]=r.filter(wn(t)).map(e=>e.peerId):e.dialog_tabs[t]=[]}),delete e.resync_in_process,setTimeout(t.bind(null,!0),0),En(intval(s.unread),e)})}).catch(t=>(Object(c.lplog)("Resync error: "+t.message+" "+t.stack,"error"),Object(o.pause)(2).then(mn.bind(null,e))))}function bn(e,t){return t.lockedSending=e,Promise.resolve(t)}function vn(e,t,n){return e&&!n.delayed_message?(n.delayed_message=e,n.delayed_ts=t):e||(n.delayed_message=e,n.delayed_ts=t),Promise.resolve(n)}function Cn(e){return!!e.textMediaSelector.urlAttachmentLoading||!!(window.Upload&&Upload.options&&Upload.isSomethingUploading)&&Object.keys(Upload.options).filter(e=>Upload.isSomethingUploading(e)).length>0}function En(e,t){return t.unread_cnt=e,t.dialog_tab_cts[d.FOLDER_UNREAD]=e,Promise.resolve(t)}function yn(e,t){return t.ctrl_submit=!!e,Object(r.post)(w,{act:"a_save_ctrl_submit",to:t.peer,hash:t.tabs[t.peer].hash,value:e?1:0}).then(e=>t)}function On(e,t,n){n.cur_unread_cnt||(n.cur_unread_cnt={}),t&&!inArray(e,n.mutedPeers)&&(n.cur_unread_cnt[e]=!0);var r=document.title,a=window.devicePixelRatio>=2?"_2x":"";if(t&&!n.update_title_to){var i=function(e,t,n){return function(){n.update_old_title=e;var r=Object.keys(n.cur_unread_cnt).length;if(0===r)return Object(v.setDocumentTitle)(e||document.title),setFavIcon("/images/icons/favicons/fav_im"+t+".ico"),clearInterval(n.update_title_to),void(n.update_title_to=!1);e?(Object(v.setDocumentTitle)(e),setFavIcon("/images/icons/favicons/fav_im"+t+".ico"),e=!1):(e=document.title,setFavIcon("/images/icons/favicons/fav_im"+(r>9?10:r)+t+".ico"),Object(v.setDocumentTitle)(winToUtf(getLang("mail_im_new_messages",r))))}}(r,a,n);n.update_title_to=setInterval(i,1e3),i()}else!t&&n.update_old_title&&(Object(v.setDocumentTitle)(n.update_old_title),n.cur_unread_cnt={},r=!1,n.update_old_title=!1,setFavIcon("/images/icons/favicons/fav_im"+a+".ico"),clearInterval(n.update_title_to),n.update_title_to=!1);return Promise.resolve(n)}function Tn(e,t,n,r,a){return Object(l.isFullyLoadedTab)(a,e)&&(a.tabs[e].scrollTop=intval(t),a.tabs[e].scrollBottom=intval(n),a.tabs[e].contHeight=intval(r)),Promise.resolve(a)}function wn(e){return e===d.FOLDER_ALL?e=>!Object(l.tabIsMessageRequest)(e):e===d.FOLDER_UNREAD?e=>!Object(l.tabIsMessageRequest)(e)&&(e.unread>0||Object(_.isTabMarkedUnread)(e)):e===d.FOLDER_MESSAGE_REQUEST?e=>Object(l.tabIsMessageRequest)(e):t=>t.folders&d.FOLDER_MASKS[e]}function Nn(e,t){t.active_tab=e,Object(a.updateLocation)({tab:e===d.FOLDER_ALL?null:e});var n=[];if(e!==d.FOLDER_ALL&&!Object(l.isReversedDialogs)(t)){var r=t.dialog_tabs[e];n=t.dialog_tabs[d.FOLDER_ALL].map(e=>t.tabs[e]).filter(wn(e)).map(e=>e.peerId),t.dialog_tabs[e]=r.length>=n.length?r:n}return Promise.resolve(t)}function In(e,t,n,r){var a=e.dialog_tabs_all;return!(!a[d.FOLDER_ALL]&&!a[t])||(!!n.includes(r.peerId)||("r"===r.lastmsg[0]||n.map(t=>e.tabs[t.toString()]).filter(t=>Object(l.isReversedDialogs)(e)?t.minor_sort_id>r.minor_sort_id:t.minor_sort_id<r.minor_sort_id).length>0))}function kn(e,t,n,r,a,o){if(Object(l.isTabLoaded)(o,e)&&!a){var s=o.tabs[e];return n===i.REPLACE_DIRECTORIES&&(t^=s.folders),function(e,t,n){return!(e===i.SET_DIRECTORIES&&n.folders&t)&&(!!(e!==i.RESET_DIRECTORIES||n.folders&t)&&!Object(l.tabIsMessageRequest)(n))}(n,t,s)&&Object.keys(d.FOLDER_MASKS).filter(e=>d.FOLDER_MASKS[e]&t).forEach(e=>{o.dialog_tab_cts[e]+=function(e,t,n){return t!==i.RESET_DIRECTORIES||e.folders&d.FOLDER_MASKS[n]?t===i.REPLACE_DIRECTORIES?e.folders&d.FOLDER_MASKS[n]?-1:1:t===i.SET_DIRECTORIES?1:-1:0}(s,n,e)}),n===i.SET_DIRECTORIES?o.tabs[e].folders|=t:n===i.RESET_DIRECTORIES?o.tabs[e].folders&=~t:o.tabs[e].folders=t^=s.folders,ke(o,o.tabs[e],!0,(t,n)=>t.concat([e]).map(e=>o.tabs[e]).filter(wn(n)).map(e=>e.peerId),In.bind(null,o)),Promise.resolve(o)}return se(e,0,0,0,o).then(kn.bind(null,e,t,n,null,!1,o))}var An=te((function(e,t){var n=d.FOLDER_MASKS[d.FOLDER_IMPORTANT],a=t.tabs[e].folders&n,o=a?i.resetDirectoriesEvent:i.setDirectoriesEvent;return t.longpoll.push([o([0,e,n,!0])]),Object(r.post)(w,{act:"a_dialog_star",val:a?0:1,peer:e,hash:t.tabs[e].hash,gid:t.gid}).then(()=>t)})),Sn=te((function(e,t,n){var a=d.FOLDER_MASKS[d.FOLDER_UNRESPOND];return n.longpoll.push([i.resetDirectoriesEvent([0,e,a,!0]),i.readInboundEvent([6,e,t,null])]),Object(r.post)(w,{act:"a_mark_answered",peer:e,lastmsg:t,hash:n.tabs[e].hash,gid:n.gid}).then(()=>n)})),jn=te((e,t)=>(t.longpoll.push([i.resetPeer(),i.setDirectoriesEvent([0,e,d.FOLDER_MASKS[d.FOLDER_MARKED_UNREAD],!0])]),Object(r.post)(w,{act:"a_mark_conversation_as_unread",peer_id:e,hash:t.tabs[e].hash,gid:t.gid}))),Ln=te((e,t)=>{t.longpoll.push([i.resetDirectoriesEvent([0,e,d.FOLDER_MASKS[d.FOLDER_MARKED_UNREAD],!0])]);var n=t.tabs[e];return Object(r.post)(w,{peer:e,ids:n.lastmsg?[n.lastmsg]:[],mark_conversation_as_read:!0,hash:n.hash,act:"a_mark_read",gid:t.gid}).then(()=>t)});function Mn(e){return Object(r.post)(w,{act:"a_get_mutex_key",gid:e})}function Pn(e,t){return ie({[e]:{free:!0}},t),Object(r.post)(w,{act:"a_block_release",peer:e,gid:t.gid}).then(()=>t)}function Fn(e,t){var n=ls.get("comm_mute_"+t.gid)?1:0;return e&&(n^=1),ls.set("comm_mute_"+t.gid,n),t.mute=n,Promise.resolve(t)}var Rn=te((function(e,t){return ke(t,t.tabs[e],!0,t=>t.filter(t=>t!==e)),t.tabs[e].deletedDialog=!0,Object(r.post)(w,{act:"a_delete_dialog",peer:e,gid:t.gid,hash:t.tabs[e].hash}).then(n=>(n[0]?(Bn(t.tabbedPeers.filter(t=>t.peer!==e),!0,t),t.tabs[e].unread=0,t.tabs[e].lastmsg=!1,t.tabs[e].lastmsg_meta=null):(t.tabs[e].deletedDialog=!1,ke(t,t.tabs[e],!1,je.bind(null,e),In.bind(null,t))),n))}));function xn(e,t,n,a){return Object(r.post)(w,{act:"a_restore_dialog",hash:t,gid:a.gid,spam:n?1:0,peer:e}).then(t=>(a.tabs[e].deletedDialog=!1,ke(a,a.tabs[e],!1,t=>[e].concat(t)),a.tabs[e].unread=t,a))}function Dn(e,t,n){return Object(r.post)(w,{act:"a_spam_dialog",peer:e,gid:n.gid,hash:t})}function Bn(e,t,n){return n.tabbedPeers=e,Object(l.isClassicInterface)(n)&&(S({peers:n.tabbedPeers.filter(e=>{var t=e.peer,r=e.type;return t!==n.peer&&"perm"===r}).map(e=>Object(l.getBareTab)(e.peer,n)).filter(e=>!e.deletedDialog).map(e=>e.peerId).map(l.convertPeerToUrl).join("_"),to:""}),t&&j()),Promise.resolve(n)}function Hn(e){return!e.peer||(vt(e.peer,e)?bt(e.peer,e):!!Object(l.isFullyLoadedTab)(e,e.peer)&&e.tabs[e.peer].allShown)}function Un(e,t){var n=t.tabs[e];return Object(l.isFullyLoadedTab)(t,e)&&(n.skipped=null,n.msgs=null,n.offset=null,n.allShown=null,n.history=null),Promise.resolve(t)}function Gn(e,t){var n=t.tabs[e];return Object(l.isFullyLoadedTab)(t,e)&&(n.history=ae(n.history)),Promise.resolve(t)}function qn(e,t){return t.go_to_end_visible=e,Promise.resolve(t)}function Wn(e,t){return t.go_to_mentions_visible=e,Promise.resolve(t)}function Kn(e,t,n){if(!Object(l.isCommunityPeer)(t))return Promise.resolve(n);var a=Object(_.getTab)(n,t);return a.blocked_community=!e,!1===e&&(a.can_send_notify=!1),Object(r.post)(w,{act:"a_toggle_community",peer_id:t,hash:a.hash,state:e?1:0}).then(()=>me(n))}function zn(e,t){if(0!==t.peer&&Object(l.isFullyLoadedTab)(t,t.peer)){var n=Object(_.getTab)(t,t.peer);n.history=re(n.history),e(n.history)}return Promise.resolve(t)}function Vn(e){if(0!==e.peer&&Object(l.isFullyLoadedTab)(e,e.peer)){var t=Object(_.getTab)(e,e.peer),n=geByClass1("_im_peer_history");n&&(t.history=re(n.innerHTML))}return Promise.resolve(e)}function Yn(e){return e.audio_msg.isRecording?Promise.reject():(e.audio_msg.isRecording=!0,Promise.resolve(e))}function $n(e){return e.audio_msg.isRecording=!1,Promise.resolve(e)}function Qn(e,t){return t.voice_message_available=e,Promise.resolve(t)}function Xn(e){S({act:e?"create":null}),j()}function Jn(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;S({q:e}),j()}function Zn(e){return void 0===e.chatResizeInitialized&&(e.chatResizeInitialized=!0,Object(l.getClassicChatHeight)()>window.clientHeight()&&Object(l.setClassicChatHeight)(0)),Promise.resolve(e)}var er=te((function(e,t,n,a){return Object(r.post)(w,{act:"a_join_chat",chat_id:e,hash:t,invite_link:n,write_hash:a.writeHash}).then(e=>{var t=O(e,4),n=t[0],r=t[1],i=t[2],o=t[3];return i.forEach(e=>Object(h.oCacheAdd)(a,e)),a.tabs[n]=r,ke(a,r,!1,je.bind(null,n),In.bind(null,a)),a.admins=extend(a.admins,o),[n]})}));function tr(e,t){return Object(r.post)(w,{act:"a_get_link",gid:t.gid,chat_id:e})}var nr=te((function(e,t){var n=t.tabs[e];return Object(r.post)(w,{act:"a_reset_link",chat_id:e-2e9,write_hash:t.writeHash,gid:t.gid}).then(e=>(n.inviteLink=e[0],e))}));function rr(e){return L({invite_chat_id:null,invite_hash:null,mr:null,invite_link:null}),e.invitation=void 0,Promise.resolve(e)}function ar(e,t){var n=Object(c.arrayUnique)([e].concat(t.select(u.RECENT_SEARCH_OP))).slice(0,500);t.update(u.RECENT_SEARCH_OP,n)}function ir(e){e.update(u.RECENT_SEARCH_OP,[])}function or(e,t){var n=t.select(u.RECENT_SEARCH_OP).filter(t=>t!==e);return t.update(u.RECENT_SEARCH_OP,n),n}function sr(e,t,n){var r=n.tabs[t],a=Object(_.getMessage)(n,t,e);return Object(_.isChatActive)(r)&&!a.kludges.source_act&&(r.pinned=a),Promise.resolve(n)}function cr(e,t){return t.tabs[e].pinned=null,Promise.resolve(t)}var ur=te((function(e,t,n){var a=n.tabs[t];return Object(_.isChatActive)(a)?Object(r.post)(w,{act:"a_pin_message",msgid:e,chat:t,gid:n.gid,hash:n.tabs[t].hash}).then(e=>{var r=O(e,1)[0];return n.tabs[t]=Object.assign({},a,r),n}):Promise.resolve(n)})),lr=te((function(e,t){var n=t.tabs[e];return Object(_.isChatActive)(n)?Object(r.post)(w,{act:"a_unpin_message",chat:e,gid:t.gid,hash:t.tabs[e].hash}).then(r=>{var a=O(r,1)[0];return t.tabs[e]=Object.assign({},n,a),t}):Promise.resolve(t)})),dr=te((function(e,t){var n=t.tabs[e];return Object(r.post)(w,{act:"a_get_pinned_message",chat:e,gid:t.gid,hash:t.tabs[e].hash}).then(e=>{var r=O(e,1)[0];return n.pinned=r||null,t})})),_r=te((function(e,t,n){var a=n.tabs[e];return Object(r.post)(w,{act:"a_get_message_local_id",chat:e,chat_local_id:t,hash:a.hash})})),fr=te((function(e,t){var n=t.tabs[e];return n.membersLoaded?Promise.resolve(t):Object(r.post)(w,{act:"a_get_chat_members",chat:e,gid:t.gid,hash:n.hash}).then(e=>{var r=O(e,1),a=O(r[0],3),i=a[0],o=a[1],s=a[2];return n.memberIds=i,n.adminIds=o,s.forEach(e=>Object(h.oCacheAdd)(t,e)),n.membersLoaded=!0,t})})),hr=te((function(e,t){return Promise.all([fr(e,t),function(e,t){var n=t.tabs[e];return Object(r.post)(w,{act:"a_get_chat_details",chat:e,gid:t.gid,hash:n.hash}).then(e=>{var r=O(e,1)[0];return n.photoGrid=r.grid,n.photoLarge=r.photo,n.membersLastSeen=r.lastSeen||null,n.inviters=r.inviters,n.caccess=r.caccess,n.invitedByMe=r.invitedByMe||[],n.inviteLinks=r.links||null,n.invitedByMessageRequest=r.invitedByMessageRequest,n.serverSettings=r.serverSettings||null,n.isDefaultPhotoOwner=r.isDefaultPhotoOwner||null,n.owner=r.owner||null,n.allowedUpdateFlags=r.allowedUpdateFlags,n.canInvite=r.canInvite||null,n.notifications=r.notifications,t})}(e,t)]).then(()=>t)})),pr=te((function(e,t,n){var a=n.tabs[e];return Object(r.post)(w,{act:"a_update_flags",chat:e,gid:n.gid,hash:a.hash,flags:t}).then(e=>(n.onUpdate&&n.onUpdate(),e))})),gr=te((function(e,t){var n=t.tabs[e];return Object(r.post)("al_page.php",{act:"owner_photo_remove",oid:e,gid:t.gid,hash:n.photoHash}).then(()=>(n.photo=null,n.photoLarge=null,t.onUpdate&&t.onUpdate(),t))}));function mr(e,t,n){var r=n.tabs[e];return r.memberIds=r.memberIds.filter(e=>e!==t),r.adminIds=r.adminIds.filter(e=>e!==t),r.membersCount=r.memberIds.length,Promise.resolve(n)}var br=te((function(e,t,n){var a=n.tabs[e];return Object(r.post)(w,{act:"a_kick_user",chat:e,hash:a.hash,mid:t,gid:n.gid}).then(()=>(a.memberIds=a.memberIds.filter(e=>e!==t),a.adminIds=a.adminIds.filter(e=>e!==t),a.membersCount=a.memberIds.length,n))}));function vr(e,t,n,r){var a=r.tabs[e];return a.adminIds=n?[].concat(a.adminIds,t).filter((e,t,n)=>n.indexOf(e)===t):a.adminIds.filter(e=>e!==t),Promise.resolve(r)}var Cr=te((function(e,t,n,a){var i=a.tabs[e];return Object(r.post)(w,{act:"a_toggle_admin",chat:e,hash:i.hash,mid:t,is_admin:+n,gid:a.gid}).then(()=>vr(e,t,n,a))}));function Er(e,t,n,r){var a=Object(_.getMessage)(e,n,t).userId;return Object(h.oCacheGet)(r,a)?Promise.resolve(r):Vt({[n]:[a]},r)}function yr(){ajax.post("al_im.php",{act:"a_hide_promo_tooltip"})}function Or(){cur.videoAutoplayScrollHandler&&cur.videoAutoplayScrollHandler()}var Tr=te((function(e,t){return t.tabs[e].top_banner=void 0,Object(r.post)(w,{act:"a_hide_banner",peer_id:e,gid:t.gid,hash:t.tabs[e].hash}).then(()=>t)})),wr=te((function(e,t,n){n.tabs[e].top_banner=void 0;var a=n.tabs[e];return Object(r.post)(w,{act:"a_callback_banner",peer_id:e,callback_data:t,hash:a.hash}).then(()=>n)}));function Nr(e,t){return Object(r.post)(w,{act:"a_load_banner",peer_id:e,gid:t.gid}).then(n=>{var r=O(n,1)[0];return t.tabs[e].top_banner=r,t})}function Ir(e,t,n){return n.tabs[e].keyboard=t&&t.buttons?t:null,Ar(e,!1,!0,n)}function kr(e,t){return Ir(e,null,t)}function Ar(e,t,n,r){return((r.tabs||{})[e]||{}).keyboard&&(r.tabs[e].keyboard.hide=t,n&&ls.set("is_keyboards_hide",Object.assign(ls.get("is_keyboards_hide")||{},{[e]:t}))),Promise.resolve(r)}var Sr=te((function(e,t){var n=t.tabs[e];return Object(r.post)(w,{act:"a_get_keyboard",peer_id:e,hash:n.hash}).then(n=>{var r=O(n,1)[0];return Ir(e,r,t)})}));function jr(e,t,n,a){var i=a.tabs[e];return i.caccess[t]=n,Object(r.post)(w,{act:"a_change_caccess",peer_id:e,member_id:t,hash:i.hash,access:n?1:0,gid:a.gid}).then(()=>a).catch(e=>{throw i.caccess[t]=!n,e})}var Lr=te((function(e,t){var n=t.tabs[t.peer];return Object(r.post)(w,{act:"a_delete_template",template_id:e,hash:n.hash,gid:t.gid,peer_id:t.peer}).then(()=>{var n=t.templates.find(t=>t.id===e);return n&&(n.deleted=!0),t})}));function Mr(e,t,n){var a=n.tabs[n.peer];return Object(r.post)(w,{act:"a_create_template",hash:a.hash,gid:n.gid,peer_id:n.peer,name:e,text:t}).then(e=>(n.templates.unshift(e[0]),n))}function Pr(e,t,n,a){var i=a.tabs[a.peer];return Object(r.post)(w,{act:"a_update_template",template_id:e,hash:i.hash,gid:a.gid,peer_id:a.peer,group_id:a.gid,name:t,text:n}).then(t=>{var n=a.templates.find(t=>t.id===e);return n&&Object.assign(n,t[0]),a})}function Fr(e,t){if(Object(l.isFullyLoadedTab)(t,e)){var n=Object(_.getTab)(t,e);n.allShown=!1,n.lastReset=Date.now()}return t}function Rr(e,t){var n=e.updateType,r=e.updateArg,a=0;return n===i.MAIL_CHAT_UPDATE_TYPE_MESSAGE_REQUEST_CHANGED&&(a=r===i.MESSAGE_REQUEST_STATUS_NEW?1:-1),n===i.MAIL_CHAT_UPDATE_TYPE_CONTACT_CONVERTED&&(a=-1),t.dialog_tab_cts[d.FOLDER_MESSAGE_REQUEST]+=a,Promise.resolve(t)}function xr(e,t,n){if(Object(l.isFullyLoadedTab)(n,e.peerId)){var r=Object(_.getTab)(n,e.peerId);r.history=Object(l.setCasperMessageExpiringStatusDOM)(r.history,t,e.messageId)}return Promise.resolve(n)}function Dr(e,t){return Promise.resolve().then(()=>{if(Object(l.isFullyLoadedTab)(t,e)){var n=Object(_.getTab)(t,e);Object.values(n.msgs).forEach(e=>{var t=Object(_.parserMessage)(e);Object(f.isCasperMessage)(t)&&!E.casperMessagesStore.has(t.messageId)&&E.casperMessagesStore.add(t)})}return Promise.resolve(t)})}var Br=te((function(e,t,n,a,i,o){return Object(r.post)(w,{act:"a_peer_profile_toggle_tag",hash:o.manage_tags_hash,group_id:o.gid,peer_id:a,tag_id:e,action:n}).then(()=>{o.tabs[a].peer_tags=i;var n=o.peer_profile_tags.findIndex(t=>t.id===e);return t?o.peer_profile_tags[n].uses++:!t&&o.peer_profile_tags[n].uses>0&&o.peer_profile_tags[n].uses--,o})})),Hr=te((function(e,t){return Object(r.post)(w,{act:"a_peer_profile_manage_tags",hash:t.manage_tags_hash,group_id:t.gid,tags:JSON.stringify(e)}).then(e=>(t.peer_profile_tags=e[0].tags,t.peerProfileTagsChanged=!0,t))})),Ur=te((function(e,t,n){return Object(r.post)(w,{act:"a_peer_profile_save_note",hash:n.manage_tags_hash,group_id:n.gid,peer_id:e,note:t}).then(()=>(n.tabs[e].peer_profile_info.note=t,n))})),Gr=te((e,t)=>Object(r.post)(w,{act:"a_reload_message",msg_id:e,hash:t.writeHash}).then(e=>O(e,1)[0])),qr=te((e,t)=>{var n=t.tabs[e];return Object(r.post)(w,{act:"a_get_active_call_data",peer_id:n.peerId,hash:n.hash}).then(e=>{var r=O(e,1)[0];return r?n.callInProgress=r:n.callInProgress&&delete n.callInProgress,t})}),Wr=(e,t)=>{var n=t.tabs[e];return n.callInProgress&&delete n.callInProgress,Promise.resolve(t)}},"wSs/":function(e,t,n){"use strict";n.r(t),n.d(t,"canMessageBeEdited",(function(){return c})),n.d(t,"convertEmojiHtmlToRegularText",(function(){return u})),n.d(t,"findLastMessageToEdit",(function(){return l})),n.d(t,"wasMessageReallyModified",(function(){return d})),n.d(t,"replaceMsgAfterEdit",(function(){return _}));n("Vd3H"),n("rGqo"),n("Btvt"),n("pIFo");var r=n("rHUl"),a=n("MhhX"),i=n("P13b"),o=n("rudk"),s=n("aong");function c(e,t){t=Object(r.parserMessage)(t);var n=Object(s.unpackStore)(e),o=vk.id==t.peerId&&!n.gid,c=n.pinMessageEditSettings,u=c.messageEditAllowedTime,l=c.pinEditDelayTime,d=c.isPinEditEnabled,_=Date.now()/1e3,f=Object(r.getPinnedMessage)(n),h=f&&f.messageId===t.messageId,p=t.kludges&&t.kludges.pinned_at,g=_-t.date>u,m=p&&_-p<l;if(333==t.peerId)return!1;if(!o&&!Object(a.isOut)(t))return!1;if(Object(a.isServiceMsg)(t))return!1;if(h&&g&&d){if(m)return!1}else if(g)return!1;return!(Object(a.isGift)(t)||Object(a.isSticker)(t)||Object(a.isAudioMsg)(t)||Object(a.isGraffiti)(t)||Object(a.isMoney)(t)||Object(a.isVKPay)(t)||Object(a.isCallMessage)(t))&&!Object(i.isAlreadyDeleted)(e,t.peerId,t.messageId)}function u(e){var t=document.createElement("div");return e=e.replace(/\[((id|club)\d+)\|(.+?)]/g,(function(){var e=arguments.length<=1?void 0:arguments[1],t=arguments.length<=3?void 0:arguments[3];return/^\@/.test(t)?t:`@${e} (${t})`})),t.innerHTML=e,Emoji.val(t)}function l(e,t){return+(t&&t.msgs?Object.keys(t.msgs):[]).filter(e=>e>0).sort((e,t)=>t-e).find(n=>c(e,t.msgs[n]))||null}function d(e,t,n){var r=Object(o.convertKludgesToAttaches)(t.kludges,t.messageId),a=n.dData.attaches;if(u(t.text)!==n.dData.txt||r.length!==a.length)return!0;for(var i=r.length;i--;){var s=r[i],c=a[i];if(s.id!=c.id||s.type!=c.type||"poll"==s.type&&c.object&&c.object.poll_is_edited)return!0}return!1}function _(e,t,n,r,a,o){t.origText=n,t.text=Object(i.replaceSpecialSymbols)(clean(n)).replace(/\n/gi,"<br>"),t.attaches=r,t.kludges.emoji=1,t.local=1,t.share_url=a,t.cancelled_shares=o,t.update_time=Math.floor(Date.now()/1e3),e.get().tabs[t.peerId].msgs[t.messageId]=t}},zNZe:function(__webpack_module__,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__);var core_js_modules_es6_promise__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("VRzm"),core_js_modules_es6_object_to_string__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("Btvt"),core_js_modules_es6_regexp_match__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("SRfc"),core_js_modules_es6_regexp_replace__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("pIFo"),core_js_modules_es6_regexp_split__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("KKXr"),_web_lib_debug_tools__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("98sY"),_web_lib_accessibility__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__("QGEU"),_shared_lib_idle_manager__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__("gF8j"),_shared_lib_convert__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__("cGUQ"),_shared_lib_common__WEBPACK_IMPORTED_MODULE_9__=__webpack_require__("jE6c"),_longpoll_singleton__WEBPACK_IMPORTED_MODULE_10__=__webpack_require__("4KwC"),_web_components_im_ServerSentEvents_DEPRECATEDLongpollAdapter__WEBPACK_IMPORTED_MODULE_11__=__webpack_require__("Rfi/"),_shared_user_user_env__WEBPACK_IMPORTED_MODULE_12__=__webpack_require__("W9Tc"),ACTIVE_TAB_SWITCH_SERVER_TIMEOUT=browser.safari?3e3:1e4,LC_SERVER_SWITCH_TO_ACTIVE_FLAG="lc_server_switch_to_active_flag",NOTIFICATION_FADE_TIMEOUT=7e3,NOTIFICATION_FADE_TIMEOUT_ACCESSIBILITY_MODE=35e3,NOTIFICATION_FADE_TIMEOUT_AFTER_UNFREEZE=5e3,NOTIFICATION_FADE_TIMEOUT_ACCESSIBILITY_MODE_AFTER_UNFREEZE=3e4,IS_SSE_ENABLED=Object(_shared_user_user_env__WEBPACK_IMPORTED_MODULE_12__.partConfigEnabled)("mail_sse_longpoll");function showEventThumb(e){var t="",n="";return e.author_photo&&(t="video_process_ready"===e.type?`<div class="notifier_video_thumb" style="background-image: url('${Notifier.fixPhoto(e.author_photo)}')"></div>`:`<img alt="" src="${Notifier.fixPhoto(e.author_photo)}" class="notifier_image" />`,e.icon_type&&(t='<div class="feedback_photo_icon"></div>'+t,n=` feedback_${e.icon_type}_row`),e.author_link&&(t=`<a href="${e.author_link}">${t}</a>`),t=`<div class="notifier_image_wrap${n}">${t}</div>`),t}function showEventAddPhoto(e){var t="";return e.add_photo&&(t=`<div class="notifier_add_image_wrap"><img src="${e.add_photo}" class="notifier_add_image"></div>`),t}function loadCallsModule(){return new Promise(e=>{stManager.add([jsc("web/calls.js"),"calls.css"],()=>{e()})})}window.curNotifier||(window.curNotifier={addQueues:{},recvClbks:{},recvData:{},onConnectionId:[]}),window.Notifier={debug:!1,init:function(e){if(!window.curNotifier||!curNotifier.connection_id){if(Notifier.notificationsGc(),curNotifier=extend({q_events:[],q_prior_events:[],q_shown:[],q_closed:[],negotiations:{},currentIm:{},q_max:3,uiNotifications:[],q_idle_max:5,browser_shown:{},done_events:{},addQueues:curNotifier.addQueues||{},recvClbks:curNotifier.recvClbks||{},recvData:curNotifier.recvData||{},error_timeout:1,request_timeout:1e3,sound:new Sound("mp3/bb1"),sound_im:new Sound("mp3/bb2"),sound_im_current:new Sound("mp3/bb3"),onConnectionId:[],showDoneBoxLastId:-1},e),!this.initFrameTransport())return!1;this.initIdleMan(),this.initCommunityQueues(),IS_SSE_ENABLED||Object(_longpoll_singleton__WEBPACK_IMPORTED_MODULE_10__.lpSingletonOnTabInitialLoaded)(),(curNotifier.cont=ge("notifiers_wrap"))||bodyNode.insertBefore(curNotifier.cont=ce("div",{id:"notifiers_wrap",className:"fixed"}),ge("page_wrap")),loadCallsModule().then(()=>{window.Calls.init(e.callsCredentials,e.imHash,e.participantLimit,e.callsUseDirectAudio)})}},initCommunityQueues:function(e){var t=ls.get("im_m_comms_key"),n=t&&t.split?t.split(";"):[];if("empty"===n[0]&&n[1]&&Date.now()-n[1]<6e4?t="empty":"empty"===n[0]&&(t=!1),t)return Notifier.proccessCommunityQueues(t,e||0);ajax.post("al_im.php",{act:"a_get_comms_key"},{onDone:function(t){"empty"===t?t+=";"+Date.now():Notifier.proccessCommunityQueues(t,e||0),ls.set("im_m_comms_key",t)},onFail:function(){return!0}})},notificationsGc:function(){curNotifier.uiGcTo=setTimeout((function(){for(var e=curNotifier.uiNotifications,t=[],n=0;n<e.length;n++){var r=e[n];Date.now()-r[1]>1e4?r[0].close():t.push(r)}curNotifier.uiNotifications=t,Notifier.notificationsGc()}),5e3)},resetCommConnection:function(e){var t=ls.get("im_m_comms_key");t&&delete curNotifier.addQueues[t.queue],ls.set("im_m_comms_key",!1),Notifier.initCommunityQueues(e||0)},proccessCommunityQueues:function(e,t){if("empty"===e||!e)return!1;Notifier.addKey(e,(function(e,n){if(n.failed)++t<50&&setTimeout(Notifier.resetCommConnection.pbind(t),100);else{(e=ls.get("im_m_comms_key"))&&(e.ts=n.ts,ls.set("im_m_comms_key",e));var r=n.events;r&&r.map((function(e){return e.split("<!>")})).forEach((function(e){if("update_cnt"===e[1]){var t=e[5],n=e[4];handlePageCount("mgid"+t,n)}}))}}))},destroy:function(){Notifier.hideAllEvents(),curNotifier.idle_manager.stop(),curNotifier.uiGcTo&&clearTimeout(curNotifier.uiGcTo),curNotifier={},re("notifiers_wrap"),re("queue_transport_wrap")},reinit:function(){ajax.post("notifier.php?act=a_get_params",{},{onDone:function(e){e?(curNotifier.error_timeout=1,this.init(e)):(curNotifier.error_timeout=curNotifier.error_timeout||1,setTimeout(this.reinit.bind(this),1e3*curNotifier.error_timeout),curNotifier.error_timeout<256&&(curNotifier.error_timeout*=2))}.bind(this),onFail:function(){return curNotifier.error_timeout=curNotifier.error_timeout||1,setTimeout(this.reinit.bind(this),1e3*curNotifier.error_timeout),curNotifier.error_timeout<256&&(curNotifier.error_timeout*=2),!0}.bind(this)})},standby:function(e){this.destroy(),curNotifier.error_timeout=e||1,setTimeout(this.reinit.bind(this),1e3*curNotifier.error_timeout)},freezeEvents:function(){curNotifier.frozen=!0,curNotifier.unfreezeAfterTooltipHide=!1,each(curNotifier.q_shown,(function(){clearTimeout(this.fadeTO),getStyle(this.baloonEl,"opacity")<1&&animate(this.baloonEl,{opacity:1},100)}))},unfreezeEvents:function(){curNotifier.tooltipShown?curNotifier.unfreezeAfterTooltipHide=!0:(curNotifier.frozen=!1,each(curNotifier.q_shown,(function(e,t){t.timeoutConf?t.fadeTO=setTimeout(t.startFading,Object(_web_lib_accessibility__WEBPACK_IMPORTED_MODULE_6__.hasAccessibilityMode)()?t.timeoutConf.unfreeze_am:t.timeoutConf.unfreeze):t.fadeTO=setTimeout(t.startFading,Object(_web_lib_accessibility__WEBPACK_IMPORTED_MODULE_6__.hasAccessibilityMode)()?3e4:5e3)})))},getTransportWrap:function(){return ge("queue_transport_wrap")||utilsNode.appendChild(ce("div",{id:"queue_transport_wrap"}))},setFocus:function(e){var t=(e?"1":"0")+curNotifier.instance_id;"flash"==curNotifier.transport&&curNotifier.flash_transport?curNotifier.flash_transport.setInstanceFocused(t):"frame"==curNotifier.transport&&(Notifier.lcSend("focus",{instance_id:t}),this.onInstanceFocus(t))},initIdleMan:function(){curNotifier.idle_manager&&curNotifier.idle_manager.started||(curNotifier.idle_manager=new _shared_lib_idle_manager__WEBPACK_IMPORTED_MODULE_7__.default({onIdleCb:function(){Notifier.freezeEvents(),Notifier.setFocus(0),cur.onIdle&&each(cur.onIdle,(function(e,t){t()}))},onUnIdleCb:function(){Notifier.unfreezeEvents(),Notifier.setFocus(1),cur.onUnidle&&each(cur.onUnidle,(function(e,t){t()})),FastChat&&FastChat.onUnidle(),vk.spentLastSendTS=Date.now()},id:"window",element:document,focusElement:window}),curNotifier.idle_manager.start())},initFrameTransport:function(){if(!ls.checkVersion()||browser.msie8||!("onmessage"in window)&&!("postMessage"in window))return!1;curNotifier.connection_id="queue_connection_"+curNotifier.queue_id,curNotifier.lc_prev_value="",curNotifier.is_server=!1,curNotifier.lp_connected=!1,curNotifier.error_timeout=1;var e=browser.version.split("."),t=intval(e[0]),n=intval(e[1]);for(var r in curNotifier.post_message=Notifier.debug||!(browser.opera&&intval(browser.version)<15||browser.msie||browser.mozilla&&t>=31||browser.safari&&(t>7||7==t&&n>=1)),curNotifier.transport="frame",this.lcInit(),curNotifier.onConnectionId)curNotifier.onConnectionId[r]();return curNotifier.onConnectionId=[],!0},onActivated:function(){curNotifier.idle_manager&&curNotifier.idle_manager.is_idle?curNotifier.idle_manager.is_idle=!1:curNotifier.idle_manager&&curNotifier.idle_manager.is_idle||Notifier.setFocus(1),removeEvent(document,"mousemove keydown touchstart",Notifier.onActivated)},onConnectionInit:function(){addEvent(document,"mousemove keydown touchstart",Notifier.onActivated)},onConnectionFailed:function(){},onRelogin:function(){setTimeout((function(){Notifier.standby()}),0)},onMessage:function onMessage(msg){if(!curNotifier.focus_instance||curNotifier.focus_instance==curNotifier.instance_id)try{var events=eval("("+msg+")");Notifier.pushEvents(events)}catch(e){debugLog(e.message)}},onInstanceFocus:function(e){var t=e.charAt(0);e=e.substr(1),"1"==t?(curNotifier.focus_instance=e,e!=curNotifier.instance_id&&(curNotifier.idle_manager.is_idle||curNotifier.idle_manager.idle(),Notifier.hideAllEvents())):curNotifier.focus_instance==e&&(curNotifier.focus_instance="")},onInstanceServer:function(e){curNotifier.is_server=!!e,IS_SSE_ENABLED||Object(_longpoll_singleton__WEBPACK_IMPORTED_MODULE_10__.lpSingletonSyncWithNotifier)()},getLpInstance:()=>IS_SSE_ENABLED?(window.sseConnect||(window.sseConnect=new _web_components_im_ServerSentEvents_DEPRECATEDLongpollAdapter__WEBPACK_IMPORTED_MODULE_11__.default(window.vk.lpConfig.key,window.vk.lpConfig.ts,window.vk.lpConfig.sseUrl,window.vk.id)),window.sseConnect):Object(_longpoll_singleton__WEBPACK_IMPORTED_MODULE_10__.lpSingletonGetInstance)(),pushEvents:function(e,t){var n=0;each(e,(function(e,r){n|=Notifier.pushEvent(r,t)})),n&&!ls.get("sound_notify_off")&&curNotifier.is_server&&(2&n?curNotifier.sound_im.play():curNotifier.sound.play())},pushEvent:function pushEvent(ev,cnt){if("nop"!==ev){if("string"==typeof ev)try{ev=JSON.parse(ev)}catch(e){return void Object(_web_lib_debug_tools__WEBPACK_IMPORTED_MODULE_5__.logEvalError)(e,ev)}ev.timeoutConf={default:ev.timeout?ev.timeout:NOTIFICATION_FADE_TIMEOUT,default_am:ev.timeout?5*ev.timeout:NOTIFICATION_FADE_TIMEOUT_ACCESSIBILITY_MODE,unfreeze:ev.timeout?.7*ev.timeout:NOTIFICATION_FADE_TIMEOUT_AFTER_UNFREEZE,unfreeze_am:ev.timeout?4.4*ev.timeout:NOTIFICATION_FADE_TIMEOUT_ACCESSIBILITY_MODE_AFTER_UNFREEZE};var push=cnt?0:1,push_prioritized=!1;if(ev.version!==curNotifier.version&&-1!==ev.version)return debugLog("Notifier old version: "+ev.version+" !== "+curNotifier.version),!1;if("update_cnt"===ev.type)return ev.add&&ev.add.section&&handlePageCount(ev.add.section_id,ev.add.count,ev.add.section_link,ev.add.section_add),0;if(!curNotifier.done_events[ev.id]){switch(curNotifier.done_events[ev.id]=1,void 0!==ev.top_count&&-1!==ev.top_count&&handlePageCount("ntf",ev.top_count),ev.type){case"video_process_ready":if(ev.add.video_raw&&window.Video&&Video.isVideoPlayerOpen(ev.add.video_raw))return;if(ev.add&&window.Video&&Video.isVideoPlayerOpen(ev.add))return;break;case"mail":ev.add&&null!==ev.add.count&&void 0!==ev.add.count&&handlePageCount("msg",ev.add.count);break;case"friend_request":ev.add.fr_count?handlePageCount("fr",ev.add.fr_count):handlePageCount("fr",ev.add);break;case"friend_request_counter":handlePageCount("fr",ev.add.fr_count),push=0;break;case"ach_achieved":ev.add.cnt&&handlePageCount("ach",ev.add.cnt);break;case"ach_achieved_upd":handlePageCount("ach",ev.add),push=0;break;case"bt_upd":if(ev.add.cnt){handlePageCount("bt",ev.add.cnt);var bt=ge("bt_tab_updates");bt&&val(geByClass1("ui_tab_count",bt),ev.add.cnt>0?ev.add.cnt:"")}break;case"bt_upd_upd":ev.add&&ev.add.section&&handlePageCount("bt",ev.add.count,ev.add.section,ev.add.prefix),push=0;var bt=ge("bt_tab_updates");bt&&val(geByClass1("ui_tab_count",bt),ev.add>0?ev.add:"");break;case"push_settings":push=0;var muted=JSON.parse(ev.add);curNotifier.mutedPeers=curNotifier.mutedPeers.filter((function(e){return e!==muted.peer_id})),0!==muted.disabled_until&&curNotifier.mutedPeers.push(muted.peer_id);break;case"mail_cnt":handlePageCount("msg",ev.add),push=0;break;case"clear_notify":TopNotifier&&TopNotifier.invalidate(),Notifier.hideAllEvents(),push=0;break;case"support_reply":handlePageCount("spr",ev.add,"support",ev.author_id?"act=show&id="+ev.author_id:"act=show"),toggle("l_spr",ev.add>0);break;case"support_cnt":handlePageCount("spr",ev.add,"support",ev.author_id?"act=show&id="+ev.author_id:"act=show"),toggle("l_spr",ev.add>0),push=0;break;case"balance_changed":parseInt(ev.add.balance)?updateMoney(parseInt(ev.add.balance)):parseInt(ev.add)&&updateMoney(parseInt(ev.add));break;case"gift_sent":re("left_block10_0");var left_block=ev.add;if(left_block){var leftBlocksElem=ge("left_blocks"),left_unpaid_gifts=se(left_block);leftBlocksElem&&(leftBlocksElem.firstChild?leftBlocksElem.insertBefore(left_unpaid_gifts,leftBlocksElem.firstChild):leftBlocksElem.appendChild(left_unpaid_gifts))}break;case"notify_tt":case"login_attempt":if(ev.add.text&&ev.add.key){var evalText=`(${ev.add})`;try{ev.add=eval(evalText),TopNotifier.showTooltip(ev.add.text,ev.add.key)}catch(e){Object(_web_lib_debug_tools__WEBPACK_IMPORTED_MODULE_5__.logEvalError)(e,evalText)}push=0}break;case"reload_stickers":window.Emoji&&window.Emoji.stickers&&(Emoji.stickers=!1),push=0;break;case"reload_stickers_keywords":window.stickersKeywordsData=null,ls.remove("stickers_keywords"),window.Emoji&&Emoji.updateTabs(),push=0;break;case"any_counter":handlePageCount(ev.add.section_id,ev.add.count,ev.add.link,ev.add.add),push=0;break;case"done_box":case"done_box_full":push=0,push_prioritized=!0}if("mail"===ev.type&&(push=this.sendMailNotification(ev)),ev.add&&ev.add.tooltip_text){var html='<div class="notify_tt_wrap">'+(ev.author_photo?`<img class="notify_tt_img" src="${ev.author_photo}" />`:'<div class="notify_tt_thumb"></div>')+'<h4 class="notify_tt_text">'+ev.add.tooltip_text+"</h4></div>";TopNotifier.showTooltip(html,0),push=0}return 1&push&&(curNotifier.q_events.push(ev),curNotifier.q_events.length>30&&curNotifier.q_events.splice(0,curNotifier.q_events.length-30),this.checkEvents()),push_prioritized&&(curNotifier.q_prior_events.push(ev),curNotifier.q_prior_events.length>5&&curNotifier.q_prior_events.splice(0,curNotifier.q_prior_events.length-5),this.checkEvents()),push}}},isActive:function(){return window.curNotifier&&curNotifier.idle_manager&&!curNotifier.idle_manager.is_idle},sendImProxy:function(e){e.text=winToUtf(e.text),curNotifier.browser_shown[e.id]||(curNotifier.browser_shown[e.id]=!0,Notifier.trySendBrowserNotification(e,!0),setTimeout((function(){curNotifier.browser_shown[e.id]=void 0}),2e3))},shouldShowNotification:function(e){return"im"!==cur.module&&!FastChat.isChatOpen(e.author_id)},sendSimpleNotification:function(e){return Notifier.playSound(e),Notifier.shouldShowNotification(e)?3:0},sendBrowserNotification:function(e){"im"!==cur.module?Notifier.negotiate({message:"send_im_notification",onSuccess:function(t){Notifier.lcSend("negotiate_back",{token:t.msg,ev:e})},onFail:function(){Notifier.showBrowserNotification(e)}}):(e.onclick="IMBRIDGE.activateTab("+e.author_id+");",Notifier.showBrowserNotification(e))},shouldPlaySound:function(e){return!ls.get("sound_notify_off")&&Notifier.shouldDisturb(e)},shouldDisturb:e=>!cur.noDisturbMode&&(cur.focused!=e.author_id&&!inArray(e.author_id,cur.mutedPeers)&&!inArray(e.author_id,curNotifier.mutedPeers)),shouldPlayCurrentSound:function(e){return!ls.get("sound_notify_off")&&cur.focused==e.author_id&&Object(_web_lib_accessibility__WEBPACK_IMPORTED_MODULE_6__.hasAccessibilityMode)()&&!inArray(e.author_id,cur.mutedPeers)},playSound:function(e){curNotifier.sound_im&&curNotifier.sound_im.play&&Notifier.shouldPlaySound(e)?e.author_id==cur.peer&&Object(_web_lib_accessibility__WEBPACK_IMPORTED_MODULE_6__.hasAccessibilityMode)()?curNotifier.sound_im_current.play():curNotifier.sound_im.play():Notifier.shouldPlayCurrentSound(e)&&curNotifier.sound_im_current&&curNotifier.sound_im_current.play()},trySendBrowserNotification:function(e,t){Notifier.negotiate({message:"who_is_active",msg:e.author_id,onFail:function(){!Notifier.canNotifyUi()||cur.peer==e.author_id&&Notifier.isActive()?(t||(Notifier.lcSend("show_notification",e),Notifier.shouldShowNotification(e)&&Notifier.showEvent(e,!0)),Notifier.playSound(e)):Notifier.sendBrowserNotification(e)}})},showBrowserNotification:function(e){Notifier.showEventUi(e),Notifier.playSound(e)},proxyIm:function(e){if(this.isActive())return this.playSound(e),void(Notifier.canNotifyUi()&&cur.peer!=e.author_id&&Notifier.shouldDisturb(e)&&(e.onclick="IMBRIDGE.activateTab("+e.author_id+");",Notifier.showEventUi(e)));curNotifier.is_server?(e.onclick="IMBRIDGE.activateTab("+e.author_id+");",this.sendImProxy(e)):curNotifier.is_server||this.lcSend("message_from_im",e)},sendMailNotification:function(e){if(e.add.is_call)return 0;if("im"==cur.module?e.onclick="IMBRIDGE.activateTab('"+e.author_id+"');":e.onclick="FastChat.selectPeer('"+e.author_id+"');",this.isActive()&&Notifier.canNotifyUi())this.playSound(e),this.shouldDisturb(e)&&cur.peer!=e.author_id&&this.showEventUi(e);else{if(this.isActive()&&this.shouldDisturb(e))return this.sendSimpleNotification(e);curNotifier.is_server&&this.shouldDisturb(e)&&this.trySendBrowserNotification(e)}return 0},checkEvents:function(){var e;(!curNotifier.q_events.length||curNotifier.q_shown.length>=(curNotifier.idle_manager.is_idle?curNotifier.q_idle_max:curNotifier.q_max))&&!curNotifier.q_prior_events.length||!curNotifier.idle_manager.is_idle&&curNotifier.frozen||(cur.noDisturbMode||(e=curNotifier.q_prior_events.length?curNotifier.q_prior_events.shift():curNotifier.q_events.shift())&&this.showEvent(e))},showEvent:function showEvent(ev,force){"mail"!==ev.type&&Math.random()<.1&&statlogsValueEvent("feed_top_notify_popup",1,"show",ev.type),curNotifier.q_shown.push(ev);var thumbEl=showEventThumb(ev),addPhoto=showEventAddPhoto(ev);ev.baloonWrapEl=ce("div",{className:"notifier_baloon_wrap",innerHTML:`\n        <div class="notifier_baloon notifier_type_${ev.type}">\n          <div class="notifier_baloon_head clear_fix">\n            <a class="notifier_close_wrap" role="link" title="${getLang("global_close")}" aria-label="${getLang("global_close")}"></a>\n            <h4 class="notifier_baloon_title">${ev.title||""}</h4>\n          </div>\n          <div class="notifier_baloon_body clear_fix">\n            ${thumbEl}\n            ${addPhoto}\n            <div class="notifier_baloon_msg wrapped">${ev.text||""}</div>\n          </div>\n        </div>`}),!ge("notifier_popup_icon_mask")&&ev.icon_type&&(utilsNode.appendChild(document.createElement("div")).outerHTML='<svg style="display: block;" width="0" height="0"><defs><clipPath id="notifier_popup_icon_mask"><path d="M48.254 34.197A9.958 9.958 0 0 0 42 32c-5.523 0-10 4.477-10 10 0 2.367.822 4.542 2.197 6.254A24.934 24.934 0 0 1 25 50C11.193 50 0 38.807 0 25S11.193 0 25 0s25 11.193 25 25c0 3.247-.62 6.35-1.746 9.197z"/></clipPath></defs></svg>'),ev.baloonEl=geByClass1("notifier_baloon",ev.baloonWrapEl),ev.closeEl=geByClass1("notifier_close_wrap",ev.baloonEl),addEvent(ev.baloonEl,"mouseover mouseout",(function(e){ev.over="mouseover"==e.type,ev.over?Notifier.freezeEvents():Notifier.unfreezeEvents()})),addEvent(ev.baloonEl,"mousedown click",(function(event){event=event.originalEvent||event||window.event;var btn=event.which,nohide=!1;if(1==btn&&(event.ctrlKey||browser.mac&&event.metaKey)&&(btn=2,browser.mac&&(nohide=!0)),"A"!=(event.target||event.srcElement).tagName){switch("mail"!==ev.type&&Math.random()<.1&&statlogsValueEvent("feed_top_notify_popup",1,"click",ev.type),btn){case 1:try{eval(ev.onclick)}catch(e){Object(_web_lib_debug_tools__WEBPACK_IMPORTED_MODULE_5__.logEvalError)(e,ev.onclick)}Notifier.trackEvent("click",{event_id:ev.id}),ev.preventHideByClick||Notifier.hideEvent(ev);break;case 2:if(!ev.link)return;var wnd=window.open(ev.link,"_blank");try{wnd.blur(),window.focus()}catch(e){}Notifier.trackEvent("click",{event_id:ev.id}),nohide||Notifier.hideEvent(ev);break;case 3:if(browser.mozilla)return}return cancelEvent(event)}})),addEvent(ev.baloonEl,"contextmenu",(function(e){return setTimeout((function(){Notifier.hideEvent(ev,!1,!1,!0)}),10),cancelEvent(e)})),addEvent(ev.closeEl,"mousedown click",(function(e){return Notifier.hideEvent(ev,!1,!1,!0),cancelEvent(e)})),ev.startFading=function(){ev.fading=animate(ev.baloonEl,{opacity:0},1e3,Notifier.hideEvent.bind(Notifier).pbind(ev,!1)),ev.over&&ev.fading.stop()},curNotifier.cont.insertBefore(ev.baloonWrapEl,curNotifier.cont.firstChild);var h=ev.baloonWrapEl.offsetHeight;re(ev.baloonWrapEl),curNotifier.cont.appendChild(ev.baloonWrapEl),setStyle(curNotifier.cont,{bottom:-h}),setStyle(ev.baloonWrapEl,{visibility:"visible"}),animate(curNotifier.cont,{bottom:0},200),curNotifier.idle_manager.is_idle&&!force||(ev.timeoutConf?ev.fadeTO=setTimeout(ev.startFading,Object(_web_lib_accessibility__WEBPACK_IMPORTED_MODULE_6__.hasAccessibilityMode)()?ev.timeoutConf.default_am:ev.timeoutConf.default):ev.fadeTO=setTimeout(ev.startFading,Object(_web_lib_accessibility__WEBPACK_IMPORTED_MODULE_6__.hasAccessibilityMode)()?NOTIFICATION_FADE_TIMEOUT_ACCESSIBILITY_MODE:NOTIFICATION_FADE_TIMEOUT)),Object(_shared_lib_common__WEBPACK_IMPORTED_MODULE_9__.isFunction)(ev.tooltipHandler)&&ev.tooltipHandler(ev.baloonWrapEl,{ev,hide:()=>{Notifier.hideEvent(ev,!1,!1,!0)}})},trackEvent:function(e,t){ajax.post("al_feed.php",extend({act:"a_feedback_track_event",event:e},t||{}))},canNotifyUi:function(){if(window.pushNotifier&&window.pushNotifier.loadEndpoint())return!1;var e=!ls.get("im_ui_notify_off")&&DesktopNotifications.supported()&&DesktopNotifications.checkPermission()<=0;return!ls.get("im_notify_flag")&&e&&ls.set("im_notify_flag",1),e&&!cur.noDisturbMode},showEventUi:function showEventUi(ev){if(!this.canNotifyUi())return!1;var title,text;if("mail"===ev.type){var div=ce("div");div.innerHTML=ev.text,title=div.firstChild.textContent.trim(),text=stripHTML(replaceEntities(ev.text.replace(/<br\/?>/g,"\n")).replace(/<span class='notifier_author_quote'.*<\/span>(.*?)/,"$1").replace(/<img.*?alt="(.*?)".*?>/gi,"$1")).replace(/&laquo;|&raquo;/gi,'"').trim()}else title=ev.title,text=ev.text;var notification=ev.uiNotification=DesktopNotifications.createNotification(ev.author_photo,title,text);return curNotifier.uiNotifications.push([notification,Date.now()]),notification.onclick=function(e){if(window.focus(),ev.onclick||("im"===cur.module?ev.onclick="IMBRIDGE.activateTab("+ev.author_id+");":ev.onclick="FastChat.selectPeer('"+ev.author_id+"');"),"IM"===ev.onclick.substr(0,2)&&"im"!==cur.module)FastChat.selectPeer(intval(ev.author_id));else try{eval(ev.onclick)}catch(e){Object(_web_lib_debug_tools__WEBPACK_IMPORTED_MODULE_5__.logEvalError)(e,ev.onclick)}Notifier.hideEvent(ev)},notification.onclose=function(){Notifier.hideEvent(ev,!0)},notification.show(),ev.closeTO=setTimeout(Notifier.hideEvent.bind(Notifier).pbind(ev),5e3),!0},hideEvent:function(e,t,n,r){clearTimeout(e.closeTO),clearTimeout(e.fadeTO),e.fading&&e.fading.stop();var a,i=indexOf(curNotifier.q_shown,e);-1!=i&&curNotifier.q_shown.splice(i,1),Notifier.unfreezeEvents(),t||(e.baloonWrapEl?(cleanElems(e.closeEl,e.baloonEl),re(e.baloonWrapEl)):e.uiNotification&&e.uiNotification.cancel()),!0===r&&isArray(curNotifier.q_closed)&&(curNotifier.q_closed.unshift(vkNow()),(a=curNotifier.q_closed.length)>3&&(curNotifier.q_closed.splice(3,a-3),a=3),3==a&&curNotifier.q_closed[0]-curNotifier.q_closed[2]<700&&Notifier.hideAllEvents()),-1!=r&&this.checkEvents(),"frame"!=curNotifier.transport||n||this.lcSend("hide",{event_id:e.id}),!0!==r&&curNotifier.idle_manager.is_idle||curNotifier.q_events.length||curNotifier.q_shown.length||ajax.post("notifier.php",{act:"a_clear_notifier"}),Object(_shared_lib_common__WEBPACK_IMPORTED_MODULE_9__.isFunction)(e.onHide)&&e.onHide()},hideAllEvents:function(){curNotifier.q_events=[],each(clone(curNotifier.q_shown),(function(){Notifier.hideEvent(this,!1,!0,-1)})),curNotifier.q_shown=[],curNotifier.q_closed=[]},onEventHide:function(e){e&&(each(curNotifier.q_shown,(function(){if(this.id==e)return Notifier.hideEvent(this,!1,!0),!1})),each(curNotifier.q_events,(function(t){if(this.id==e)return curNotifier.q_events.splice(t,1),!1})))},lcInit:function(){if(curNotifier.post_message){addEvent(window,"message",this.lcOnMessage.bind(this));var e=curNotifier.storage_el=ce("iframe",{id:"queue_storage_frame",name:"queue_storage_frame",src:"/notifier.php?act=storage_frame&from="+location.host+(Notifier.debug?"&debug="+vkNow():"&4")+"#"+curNotifier.connection_id});Notifier.getTransportWrap().appendChild(e),curNotifier.storage_frame=e.contentWindow,curNotifier.storage_frame_origin=location.protocol+"//"+locHost}else browser.msie&&intval(browser.version)<9?addEvent(document,"storage",this.lcOnStorage.bind(this)):addEvent(window,"storage",this.lcOnStorage.bind(this)),this.lcStart()},lcStart:function(){Notifier.lcCheckServer()?this.lcServer():(this.lcSend("check"),clearTimeout(curNotifier.becomeServerTO),curNotifier.becomeServerTO=setTimeout(this.lcServer.bind(this).pbind(!0),500)),curNotifier.checkServerInt=setInterval(function(){curNotifier.is_server||(curNotifier.idle_manager&&!curNotifier.idle_manager.is_idle&&curNotifier.idle_manager.getActiveTime()>ACTIVE_TAB_SWITCH_SERVER_TIMEOUT&&(Notifier.debug&&debugLog("this tab wants to become server"),ls.set(LC_SERVER_SWITCH_TO_ACTIVE_FLAG,!0),this.lcServer(!0)),vkNow()-curNotifier.last_succ>8e3&&Notifier.lcCheckServer()&&(Notifier.debug&&debugLog("timeout"),this.lcServer(!0)))}.bind(this),1e3+intval(rand(-100,100))),curNotifier.isServerBroadcastInt=setInterval(function(){curNotifier.is_server&&(Notifier.lcCheckServer()?this.lcSend("check_ok"):(Notifier.debug&&debugLog("no server from server broadcast"),this.lcNoServer()))}.bind(this),5e3+intval(rand(-100,100))),void 0!==curNotifier.fc&&stManager.add([jsc("web/emoji.js")],(function(){FastChat.init(curNotifier.fc)}))},lcStop:function(){clearInterval(curNotifier.isServerBroadcastInt),clearInterval(curNotifier.checkServerInt),clearTimeout(curNotifier.becomeServerTO)},lcSend:function(e,t){if(!curNotifier.connection_id)return curNotifier.onConnectionId&&curNotifier.onConnectionId.push(Notifier.lcSend.pbind(e,t)),!1;Notifier.debug&&debugLog(curNotifier.instance_id+": sending",e,t||"");var n=extend({__client:curNotifier.instance_id,__act:e,__rnd:Math.random()},t||{});if(curNotifier.post_message)try{curNotifier.storage_frame.postMessage(curNotifier.connection_id+":"+JSON.stringify(n),curNotifier.storage_frame_origin)}catch(e){debugLog(e,e.message,e.stack)}else ls.set(curNotifier.connection_id,n)},lcRecv:function(e){if(e&&!isEmpty(e)&&e.__client!=curNotifier.instance_id){var t=e.__act;switch(delete e.__client,delete e.__act,delete e.__rnd,Notifier.debug&&debugLog(curNotifier.instance_id+": recv",t,e),t){case"new_server":curNotifier.last_succ=vkNow()+1e3;break;case"feed":curNotifier.timestamp=e.ts,curNotifier.key=e.key,Notifier.pushEvents(e.events,!e.full);break;case"addfeed":Notifier.addFeed(e[0],e[1]);break;case"new_key":debugLog("new key",e),curNotifier.timestamp=e.ts,curNotifier.key=e.key;break;case"new_addkey":var n=e.queue||e.key,r=curNotifier.addQueues[n],a=!r&&curNotifier.is_server;r?r[0]=Date.now():curNotifier.addQueues[n]=[Date.now(),e.ts,e.key],a&&Notifier.lpReset(Notifier.lpCheck.bind(Notifier));break;case"clear_addkeys":curNotifier.addQueues={};break;case"check_ok":curNotifier.last_succ=Date.now(),curNotifier.becomeServerTO&&(clearTimeout(curNotifier.becomeServerTO),curNotifier.becomeServerTO=!1),curNotifier.lp_connected||(curNotifier.lp_connected=!0,Notifier.onConnectionInit());break;case"focus":Notifier.onInstanceFocus(e.instance_id);break;case"hide":Notifier.onEventHide(e.event_id);break;case"check_playlist":var i=ls.get("pad_playlist");i&&i.instance==curNotifier.instance_id&&ls.set("pad_pltime",vkNow());break;case"who_is_active":Notifier.isActive()&&(intval(e.msg)>2e9&&"im"===cur.module||intval(e.msg)<2e9)&&this.lcSend("negotiate_back",e);break;case"show_notification":Notifier.shouldShowNotification(e)&&Notifier.showEvent(e,!0);break;case"send_im_notification":if("im"===cur.module){var o=Notifier.createNegotiationSlot({onSuccess:function(e){e.ev.onclick="IMBRIDGE.activateTab("+e.ev.author_id+");",Notifier.showBrowserNotification(e.ev)}});Notifier.lcSend("negotiate_back",{msg:o.token,token:e.token})}break;case"negotiate_back":Notifier.endNegotiation(e);break;case"recent_emoji_set":window.Emoji&&Emoji.setRecentEmojiList(e);break;case"lp_data":IS_SSE_ENABLED||Object(_longpoll_singleton__WEBPACK_IMPORTED_MODULE_10__.lpSingletonOnNotifierRecv)(e);break;default:if(curNotifier.recvClbks&&curNotifier.recvClbks[t])for(var s in curNotifier.recvClbks[t])curNotifier.recvClbks[t][s](e);else curNotifier.recvData[t]=e}if(curNotifier.is_server)switch(t){case"new_server":case"new_key":case"check_ok":Notifier.debug&&debugLog("no server from lcRecv",t),Notifier.lcNoServer();break;case"check":this.lcSend("check_ok");break;case"message_from_im":Notifier.sendImProxy(e)}}},negotiate:function(e){e=this.createNegotiationSlot(e),this.lcSend(e.message,{token:e.token,msg:e.msg})},createNegotiationSlot:function(e){var t="negotiations_"+Date.now()+Math.round(rand(0,1e4));return e=extend({timeout:3e3,token:t,msg:""},e),curNotifier.negotiations[e.token]={},curNotifier.negotiations[e.token].timer=setTimeout((function(){e.onFail&&e.onFail(),curNotifier.negotiations[e.token]&&(curNotifier.negotiations[e.token]=void 0)}),e.timeout),curNotifier.negotiations[e.token].success=e.onSuccess,e},endNegotiation:function(e){var t=e.token,n=curNotifier.negotiations[t];n&&(clearTimeout(n.timer),curNotifier.negotiations[t].success&&curNotifier.negotiations[t].success(e),curNotifier.negotiations[t]=void 0)},lcOnStorage:function(e){e=e||window.event,Notifier.debug&&debugLog("onstorage",e.key,e.newValue,e);var t=e.key,n=e.newValue;if(n){if(t){if(e.key!=curNotifier.connection_id)return}else{if(t=curNotifier.connection_id,(n=localStorage.getItem(t))==curNotifier.lc_prev_value)return;curNotifier.lc_prev_value=n}this.lcRecv(JSON.parse(n)||{})}},lcOnMessage:function(e){if(e=e||window.event,Notifier.debug&&debugLog("onmessage",e.data,e.origin,e),!(e.origin&&e.origin!=curNotifier.storage_frame_origin||"string"!=typeof e.data||e.data.indexOf("q_st"))){var t,n=e.data.substr(4);if("ready"==n)curNotifier.storage_frame=e.source,this.lcStart();else{if(-1==(t=n.indexOf(":"))||n.substr(0,t)!=curNotifier.connection_id||!n.substr(t+1))return;this.lcRecv(JSON.parse(n.substr(t+1)))}}},lcServer:function(e){Notifier.debug&&debugLog("becoming server"),this.lpInit(),this.lcSend("new_server"),Notifier.lcCheckServer(!0),Notifier.onInstanceServer(1),curNotifier.lp_connected||(curNotifier.lp_connected=!0,Notifier.onConnectionInit()),this.lpStop(),e?this.lpReset(this.lpStart.bind(this)):this.lpStart()},lcNoServer:function(){this.lpStop(),curNotifier.is_server&&(Notifier.debug&&debugLog("not server now"),this.onInstanceServer(0))},lcCheckServer:function(e){var t,n="server_"+curNotifier.connection_id,r=vkNow();return!(!e&&isArray(t=ls.get(n))&&t[0]!=curNotifier.instance_id&&r-t[1]<8e3)&&(ls.set(n,[curNotifier.instance_id,r]),!0)},lpInit:function(){curNotifier.lpMakeRequest||(delete curNotifier.lpMakeRequest,re("queue_transport_frame"),Notifier.getTransportWrap().appendChild(ce("iframe",{id:"queue_transport_frame",name:"queue_transport_frame",src:curNotifier.frame_path})))},lpStart:function(){curNotifier.lp_started=!0,curNotifier.lpInvalid?Notifier.lpGetKey():Notifier.lpCheck()},lpStop:function(){curNotifier.lp_started=!1,clearTimeout(curNotifier.lp_check_to),clearTimeout(curNotifier.lp_error_to),clearTimeout(curNotifier.lp_req_check_to)},lpCheck:function lpCheck(){if(curNotifier.lp_started&&!curNotifier.lpActive&&!curNotifier.lpInvalid){if(!curNotifier.lpMakeRequest)return clearTimeout(curNotifier.lp_check_to),void(curNotifier.lp_check_to=setTimeout(this.lpCheck.bind(this),1e3));if(!Notifier.lcCheckServer())return Notifier.debug&&debugLog("no server from check"),void this.lcNoServer();var now=vkNow(),add_queues=[],completed=!1,params={act:"a_check",ts:curNotifier.timestamp,key:curNotifier.key,id:curNotifier.uid,wait:25};each(curNotifier.addQueues,(function(e,t){if(now-t[0]>3e4&&!e.match(/nccts/))return debugLog("drop key",e,now-t[0]),void delete curNotifier.addQueues[e];add_queues.push(e),params.ts+="_"+t[1],params.key+=t[2]}));var onFail=function(e){completed||(completed=!0,curNotifier.lpActive=!1,clearTimeout(curNotifier.lp_req_check_to),curNotifier.error_timeout=curNotifier.error_timeout||1,clearTimeout(curNotifier.lp_error_to),curNotifier.lp_error_to=setTimeout(this.lpCheck.bind(this),1e3*curNotifier.error_timeout+irand(1e3,1e4)),curNotifier.error_timeout<64&&(curNotifier.error_timeout*=2))}.bind(this);curNotifier.lpActive=!0,clearTimeout(curNotifier.lp_req_check_to),curNotifier.lp_req_check_to=setTimeout(onFail,1e3*(params.wait+5)),curNotifier.lpMakeRequest(curNotifier.frame_url,params,function(text){if(!completed&&(completed=!0,curNotifier.lpActive=!1,curNotifier.lp_started)){this.lcSend("check_ok");try{var response=eval("("+text+")"),main_response=response,add_response,add_queue,busy=0;if(isArray(response))for(main_response=response.shift();(add_response=response.shift())&&(add_queue=add_queues.shift(),add_queue);)2!=add_response.failed||4!=add_response.err?(this.lcSend("addfeed",[add_queue,add_response]),this.addFeed(add_queue,add_response),add_response.failed&&delete curNotifier.addQueues[add_queue]):(Notifier.debug&&debugLog("!!notifier key busy!! "+curNotifier.instance_id),busy|=1);else if(response.failed){for(;add_queue=add_queues.shift();)this.lcSend("addfeed",[add_queue,response]),this.addFeed(add_queue,response),delete curNotifier.addQueues[add_queue];this.lcSend("clear_addkeys")}switch(this.lpChecked(main_response)){case 0:break;case 1:return;case 2:busy|=2;break;default:return}busy?ls.get(LC_SERVER_SWITCH_TO_ACTIVE_FLAG)?ls.remove(LC_SERVER_SWITCH_TO_ACTIVE_FLAG):this.lcNoServer():(clearTimeout(curNotifier.lpCheckTO),curNotifier.lpCheckTO=setTimeout(this.lpCheck.bind(this),curNotifier.request_timeout||1e3),curNotifier.error_timeout=Math.max(1,(curNotifier.error_timeout||1)/1.5))}catch(e){text&&-1==text.indexOf("Ad Muncher")&&(topError("Notifier error: "+e.message,{dt:-1,type:5,stack:e.stack,answer:text+"\n\nbusy:"+busy+"\nserver:"+curNotifier.is_server+"\ninstance:"+curNotifier.instance_id,url:curNotifier.frame_url,query:params&&Object(_shared_lib_convert__WEBPACK_IMPORTED_MODULE_8__.toQueryString)(params)}),debugLog(e.message,e.stack,e)),curNotifier.error_timeout=curNotifier.error_timeout||1,clearTimeout(curNotifier.lp_error_to),curNotifier.lp_error_to=setTimeout(this.lpCheck.bind(this),1e3*curNotifier.error_timeout),curNotifier.error_timeout<64&&(curNotifier.error_timeout*=2)}}}.bind(this),onFail)}},lpChecked:function(e){var t=e.failed;if(2==t)return 4==e.err?2:(curNotifier.lpInvalid=!0,debugLog("notifier lpCheck error",e),clearTimeout(curNotifier.lp_error_to),curNotifier.lp_error_to=setTimeout(this.lpGetKey.bind(this),1e3*curNotifier.error_timeout),curNotifier.error_timeout<64&&(curNotifier.error_timeout*=2),1==e.err?1:3);if(t)throw new Error(getLang("global_unknown_error"));return this.lcSend("feed",extend({full:curNotifier.idle_manager&&curNotifier.idle_manager.is_idle&&!this.canNotifyUi(),key:curNotifier.key},e)),curNotifier.timestamp=e.ts,Notifier.pushEvents(e.events),0},lpOnReset:function(){curNotifier.lpOnReset&&curNotifier.lpOnReset()},lpReset:function(e){curNotifier.lpOnReset=e,clearTimeout(curNotifier.resetTO),curNotifier.resetTO=setTimeout((function(){if(!curNotifier.is_server||curNotifier.lp_started)if(curNotifier.lpMakeRequest&&!curNotifier.lpInvalid){var e=curNotifier.key,t=curNotifier.timestamp;each(curNotifier.addQueues,(function(n,r){e+=r[2],t+="_"+r[1]})),curNotifier.lpMakeRequest(curNotifier.frame_url,{act:"a_release",key:e,ts:t,id:curNotifier.uid,wait:25},Notifier.lpOnReset,Notifier.lpOnReset)}else ajax.post("notifier.php?act=a_reset",!1,{onDone:Notifier.lpOnReset,onFail:function(){return Notifier.lpOnReset(),!0}});else Notifier.lpStart()}),100)},lpGetKey:function(){ajax.post("notifier.php?act=a_get_key",{id:curNotifier.uid,hash:curNotifier.notifierHash},{onDone:function(e,t){curNotifier.timestamp=t,curNotifier.key=e,curNotifier.lpInvalid=!1,debugLog("notifier lpGetKey done"),this.lcSend("new_key",{ts:t,key:e}),this.lpCheck()}.bind(this),onFail:function(e){switch(debugLog("notifier lpGetKey fail",e),e){case 1:case 3:return void Notifier.standby();case 4:return void Notifier.standby(300);case 2:return void Notifier.onRelogin()}return curNotifier.error_timeout=64,clearTimeout(this.lp_error_to),this.lp_error_to=setTimeout(this.lpGetKey.bind(this),1e3*curNotifier.error_timeout),!0}.bind(this)})},addKey:function(e,t,n){if(curNotifier.flash_transport||!e)return!1;var r=e.queue||e.key,a=curNotifier.addQueues[r],i=!a&&curNotifier.is_server;return a?(a[0]=vkNow(),a[3]=t,a[4]=n):curNotifier.addQueues[r]=[vkNow(),e.ts,e.key,t,n],n||Notifier.lcSend("new_addkey",e),i&&Notifier.lpReset(Notifier.lpCheck.bind(Notifier)),!0},addFeed:function(e,t){var n=curNotifier.addQueues[e];isArray(n)&&n.length&&(n[1]=t.ts,Object(_shared_lib_common__WEBPACK_IMPORTED_MODULE_9__.isFunction)(n[3])&&n[3](e,t))},addRecvClbk:function(e,t,n,r){curNotifier.recvClbks||(curNotifier.recvClbks={}),curNotifier.recvClbks[e]||(curNotifier.recvClbks[e]={}),curNotifier.recvClbks[e][t]&&!r||(curNotifier.recvClbks[e][t]=n)},setRecvClbk:function(e,t){curNotifier.recvClbks||(curNotifier.recvClbks={}),curNotifier.recvClbks[e]=[t]},fixPhoto:function(e,t){return-1==(e=clean(e)).indexOf("question_c.gif")?e:t?"/images/question_inv_xc.png":"/images/question_inv_c.png"}}}});