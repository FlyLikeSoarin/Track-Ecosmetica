!function(e){function t(t){for(var a,s,o=t[0],l=t[1],c=t[2],u=0,g=[];u<o.length;u++)s=o[u],Object.prototype.hasOwnProperty.call(r,s)&&r[s]&&g.push(r[s][0]),r[s]=0;for(a in l)Object.prototype.hasOwnProperty.call(l,a)&&(e[a]=l[a]);for(d&&d(t);g.length;)g.shift()();return i.push.apply(i,c||[]),n()}function n(){for(var e,t=0;t<i.length;t++){for(var n=i[t],a=!0,o=1;o<n.length;o++){var l=n[o];0!==r[l]&&(a=!1)}a&&(i.splice(t--,1),e=s(s.s=n[0]))}return e}var a={},r={"web/imn":0},i=[];function s(t){if(a[t])return a[t].exports;var n=a[t]={i:t,l:!1,exports:{}};return e[t].call(n.exports,n,n.exports,s),n.l=!0,n.exports}s.m=e,s.c=a,s.d=function(e,t,n){s.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},s.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},s.t=function(e,t){if(1&t&&(e=s(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(s.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var a in e)s.d(n,a,function(t){return e[t]}.bind(null,a));return n},s.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return s.d(t,"a",t),t},s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},s.p="/js/cmodules/";var o=window.webpackJsonp=window.webpackJsonp||[],l=o.push.bind(o);o.push=t,o=o.slice();for(var c=0;c<o.length;c++)t(o[c]);var d=l;i.push([188,"vendors","common","145f605746e8e55e54cfd5bb0b7dca57","15942e60c2552d8c9c8d9c9d8dcedf2e"]),n()}({"+/AQ":function(e,t,n){"use strict";n.r(t),n.d(t,"getNativeOption",(function(){return r})),n.d(t,"setNativeOption",(function(){return i})),n.d(t,"createScroll",(function(){return c}));var a=n("ofcU");function r(e,t){return bodyNode[e]||document.documentElement[e]}function i(e,t,n){"scrollTop"===e&&window.scrollTo(0,t)}class s{constructor(e,t){this.el=e,this.opts=t,this.module=Object(a.createModule)({handlers:(e,t)=>{e(window,"scroll",this.onScroll.bind(this)),e(window,"resize",this.resize.bind(this))}}),this.innerHeight=window.innerHeight,this.prevScroll=this.scrollTop()}update(){}resize(){this.innerHeight=window.innerHeight}scrollTop(e){if(void 0===e)return r("scrollTop",this.el);i("scrollTop",e,this.el)}contHeight(){return r("scrollHeight")}smoothScroll(e){scrollToY(e+this.scrollTop(),300)}getContainer(){return this.el}getScroller(){return null}scrollBottom(e){if(void 0===e)return this.contHeight()-this.scrollTop()-this.getScrollHeight();var t=this.contHeight()-e-this.getScrollHeight();this.scrollTop(t)}scrollBottomFixSave(e){var t=()=>{Date.now()-n<500&&this.scrollBottom(e),window.removeEventListener("scroll",t)},n=Date.now();window.addEventListener("scroll",t),this.scrollBottom(e)}onScroll(e){var t=this.scrollTop(),n=t-this.prevScroll,a=this.contHeight();this.opts.onScroll&&this.opts.onScroll(-n,this),this.opts.scrollChange&&this.opts.scrollChange(t),this.opts.more&&a-t<2*this.innerHeight&&this.opts.more(this),this.prevScroll=t}getScrollHeight(){return this.innerHeight}destroy(){Object(a.destroyModule)(this.module)}}class o{constructor(e,t){this.prevTop=0,this.scroll=new uiScroll(e,{hidden:void 0===t.hidden||t.hidden,shadows:t.shadows,stopScrollPropagation:!1,theme:t.scrollTheme,onmore:()=>t.more&&t.more(this),onscroll:e=>{var n=this.scrollTop(),a=this.prevTop-n;this.prevTop=n,t.scrollChange&&t.scrollChange(n),t.onScroll&&t.onScroll(a,this)}})}update(){this.scroll.update("sync")}scrollTop(e){return void 0!==e?this.scroll.scrollTop(e):this.scroll.data.scrollTop}getContainer(){return this.scroll.content}getScroller(){return this.scroll.scroller}contHeight(){return this.scroll.data.scrollHeight}smoothScroll(e){this.scroll.scrollTop(this.scrollTop()+e,300)}scrollBottom(e){return void 0!==e?this.scroll.scrollBottom(e):this.scroll.data.scrollBottom}scrollBottomFixSave(e){var t=Date.now();this.scroll.emitter.addOnceListener("resize",()=>{Date.now()-t<500&&this.scroll&&this.scrollBottom(e)}),this.scrollBottom(e)}getScrollHeight(){return this.scroll.data.viewportHeight}destroy(){this.scroll.destroy()}}class l{constructor(e,t){this.el=e}update(){}getContainer(){return this.el}getScroller(){return null}scrollTop(e){return 0}contHeight(){return 0}smoothScroll(e){}scrollBottom(e){return 0}scrollBottomFixSave(e){}getScrollHeight(){return 0}destroy(){}}function c(e,t){return t.noScroll?new l(e):t.nativeScroll?new s(e,t):new o(e,t)}},"+tmx":function(e,t,n){"use strict";n.r(t),n.d(t,"MILLISECOND",(function(){return a})),n.d(t,"SECOND",(function(){return r})),n.d(t,"MINUTE",(function(){return i})),n.d(t,"HOUR",(function(){return s})),n.d(t,"DAY",(function(){return o})),n.d(t,"WEEK",(function(){return l})),n.d(t,"MONTH",(function(){return c})),n.d(t,"ruLocale",(function(){return d})),n.d(t,"EVENTS",(function(){return u}));var a=1,r=1e3*a,i=60*r,s=60*i,o=24*s,l=7*o,c=30*o,d="ru-RU",u={MOUSE_DOWN:"mousedown",KEY_DOWN:"keydown",SCROLL:"scroll",CLICK:"click"}},"/cSr":function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return i}));var a=n("q1tI"),r=(n("17x9"),n("ZxpX"));function i(e){return a.createElement("div",{className:Object(r.classNames)("ChatSettingsRoundedIcon","ChatSettingsRoundedIcon--"+e.type,"ChatSettingsRoundedIcon--"+e.backgroundColor)})}},"/eGY":function(e,t,n){"use strict";n.r(t),n.d(t,"VKPAY_APP_ID",(function(){return d})),n.d(t,"BUTTON_TYPE_TEXT",(function(){return u})),n.d(t,"BUTTON_TYPE_VKPAY",(function(){return g})),n.d(t,"BUTTON_TYPE_LOCATION",(function(){return m})),n.d(t,"BUTTON_TYPE_OPEN_APP",(function(){return _})),n.d(t,"BUTTON_TYPE_OPEN_LINK",(function(){return p})),n.d(t,"BUTTON_COLOR_DEFAULT",(function(){return h})),n.d(t,"BUTTON_COLOR_SECONDARY",(function(){return f})),n.d(t,"BUTTON_COLOR_PRIMARY",(function(){return b})),n.d(t,"BUTTON_COLOR_NEGATIVE",(function(){return v})),n.d(t,"BUTTON_COLOR_POSITIVE",(function(){return O})),n.d(t,"handleButtonClick",(function(){return C})),n.d(t,"getButtonAppearance",(function(){return E})),n.d(t,"getButtonLabel",(function(){return j})),n.d(t,"getActionObjectFromElement",(function(){return S})),n.d(t,"getAttributesFromActionObject",(function(){return I}));n("HEwt"),n("a1Th"),n("rE2o"),n("ioFf"),n("rGqo"),n("Btvt"),n("/8Fb"),n("pIFo");var a=n("t7n3"),r=n("nAFc"),i=n("/PiP"),s=n("EasH"),o=n("N4ZS");function l(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var n=[],a=!0,r=!1,i=void 0;try{for(var s,o=e[Symbol.iterator]();!(a=(s=o.next()).done)&&(n.push(s.value),!t||n.length!==t);a=!0);}catch(e){r=!0,i=e}finally{try{a||null==o.return||o.return()}finally{if(r)throw i}}return n}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return c(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return c(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function c(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,a=new Array(t);n<t;n++)a[n]=e[n];return a}var d=6217559,u="text",g="vkpay",m="location",_="open_app",p="open_link",h="default",f="secondary",b="primary",v="negative",O="positive",y=["app-id","owner-id","type","payload","hash","label"];function C(e,t,n,a){var r=e.app_id,o=e.owner_id,l=e.type,c=e.payload,h=e.hash,f=void 0===h?"":h;switch(l){case p:break;case g:case _:var b="app"+(l===g?d:r)+(o?"_"+o:"");Object(i.showWiki)({w:b+encodeURIComponent("#"+f),from_keyboard:1,app_hash:n});break;case m:cur.sendLocation=function(e,n){n(),t({keyboardAuthorId:a,action:{label:"",attaches:[e],payload:c}})},Object(s.showBox)("al_places.php",{act:"a_choose_place_box",from_keyboard:1},{stat:["places.css","map.css","maps.js","ui_controls.css","ui_controls.js","boxes.css"],width:640,bodyStyle:"padding: 0px;",dark:1});break;case u:t({action:e,appHash:n,keyboardAuthorId:a});break;default:e.payload=JSON.stringify({command:"not_supported_button",button_type:l,payload:e.payload}),t({action:e,appHash:n,keyboardAuthorId:a})}}function E(e){return T(e)?b:e.color.toLowerCase().replace(h,f)}function j(e){var t=e.action,n=t.label;return t.type===m?getLang("mail_keyboard_label_location"):T(e)?getLang("mail_keyboard_label_vkpay").replace(/ VK Pay$/,""):function(e){var t=e;return t=Object(r.decodeHTMLEntities)(t||""),t=Object(a.clean)(t).replace(/\n(\r)?/gi," "),t=Emoji.emojiToHTML(t,!0)}(n)}function T(e){var t=e.action,n=t.app_id,a=t.type;return a===g||a===_&&n===d}function S(e){return y.reduce((t,n)=>(t[n.replace("-","_")]=e.getAttribute("data-"+n)||void 0,t),{})}function I(e){var t=Object.entries(e).reduce((e,t)=>{var n=l(t,2),r=n[0],i=n[1];return e+` data-${r.replace("_","-")}="${Object(a.clean)(""+i)}"`},"");e.type===p&&(t+=` href="${Object(o.wrapAwayIfExternal)(encodeURI(e.link),!0)}" target="_blank" rel="nofollow noopener"`);return t}},"0Rlc":function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return o}));n("91GP"),n("ioFf"),n("rGqo"),n("Btvt");var a=n("q1tI"),r=(n("17x9"),n("ZxpX"));function i(){return(i=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e}).apply(this,arguments)}function s(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},i=Object.keys(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}class o extends a.Component{constructor(){super(...arguments),this.onChange=e=>{this.props.onChange&&this.props.onChange(this.props.name,e.target.checked,e)}}render(){var e=this.props,t=e.children,n=e.checked,o=e.disabled,l=e.indeterminate,c=e.name,d=e.id,u=s(e,["children","checked","disabled","indeterminate","name","id"]),g=Object(r.classNames)("CheckBox",u.className,{"CheckBox--disabled":o,"CheckBox--indeterminate":l});return a.createElement("label",{className:g},a.createElement("input",i({},u,{className:"CheckBox__input",id:d,type:"checkbox",checked:n,name:c,disabled:o,onChange:this.onChange})),a.createElement("span",{className:"CheckBox__indicator","aria-hidden":!0}),t)}}},"0toi":function(e,t,n){"use strict";n.r(t);n("91GP");var a=n("q1tI"),r=n.n(a),i=(n("17x9"),n("r7nW")),s=n("Xq7/"),o=n("6aSF"),l=function(e){var t=e.children,n=e.hasScroll;return void 0===n||n?r.a.createElement(o.default,{className:"ModalBody"},t):r.a.createElement("div",{className:"ModalBody"},t)},c=n("7ZXl"),d=n("ZxpX");function u(){return(u=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e}).apply(this,arguments)}var g=e=>{var t=e.className,n=e.appearance,r=void 0===n?"white":n,o=e.title,g=e.actionButtons,m=e.onClose,_=e.children,p=e.footerHint,h=e.hasScroll,f=Object(d.classNames)("Modal","Modal--"+r,t);return a.createElement(i.default,u({},e,{className:f}),a.createElement(s.ModalHeader,{title:o,onClose:m,appearance:r}),Boolean(_)&&a.createElement(l,{hasScroll:h},_),a.createElement(c.ModalFooter,{actionButtons:g,hint:p}))};g.Header=s.ModalHeader,g.Body=l,g.Footer=c.ModalFooter;t.default=g},188:function(e,t,n){e.exports=n("M24l")},"1y80":function(e,t,n){"use strict";function a(e,t,n,a,r){return window.statlogsValueEvent(e,t,n,a,r)}function r(e){return Math.random()<e}function i(e,t,n,i,s,o){r(e)&&a(t,n,i,s,o)}n.r(t),n.d(t,"statlogsValueEvent",(function(){return a})),n.d(t,"randEnabled",(function(){return r})),n.d(t,"statlogsProbValueEvent",(function(){return i}))},"2zsc":function(e,t,n){"use strict";n.r(t);var a=n("q1tI"),r=n.n(a),i=function(){return(i=Object.assign||function(e){for(var t,n=1,a=arguments.length;n<a;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)},s=function(e,t){var n={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(n[a]=e[a]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(a=Object.getOwnPropertySymbols(e);r<a.length;r++)t.indexOf(a[r])<0&&Object.prototype.propertyIsEnumerable.call(e,a[r])&&(n[a[r]]=e[a[r]])}return n};t.default=function(e){var t=e.children,n=e.className,a=s(e,["children","className"]),o=t?String(t):"";return r.a.createElement("span",i({},a,{dangerouslySetInnerHTML:{__html:o},className:n||""}))}},"4cFO":function(e,t,n){"use strict";n.r(t);n("VRzm"),n("Btvt");var a=n("BJj/"),r=n("ERyv");function i(e,t){if(!t)return ls.get(e);ls.set(e,t)}function s(e){try{var t={};return Error.captureStackTrace(t,e),t.stack}catch(e){return""}}t.default=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=Object(a.debounce)(i,300),o=extend({},e),l=[],c=[];return t.store&&(o=ls.get(t.key)||o),{get:()=>o,set(e){var a=Object(r.isWeirdLogging)()?s(this.set):null;return e(o).then(e=>(o=e,t.store&&n(t.key,e),this.emit(),this)).catch(e=>Object(r.imWeirdCatch)("store_set_catch",e,{stack:a}))},setState(e){return this.set(t=>(t=extend(t,e),this.emit(),Promise.resolve(t)))},stash(){l.push(o),o=extend({},e),this.emit()},reset(){o=extend({},e),this.emit()},unmount(){o={},e=!1,c=[]},pop(){l.length>0&&(o=l.pop(),this.emit())},emit(){c.length>0&&c.forEach(e=>e(this))},subscribe(e){-1===c.indexOf(e)&&c.push(e)},unsubscribe(e){c=c.filter(t=>t!==e)},mutate(e){e(o),t.store&&n(t.key,o),this.emit()}}}},"6aSF":function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return l}));n("91GP"),n("ioFf"),n("rGqo"),n("Btvt");var a=n("q1tI"),r=(n("17x9"),n("+/AQ")),i=n("ZxpX");function s(){return(s=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e}).apply(this,arguments)}function o(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},i=Object.keys(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}class l extends a.Component{constructor(){super(...arguments),this.getWrapperRef=e=>{this.wrapper=e}}componentDidMount(){var e=this.props,t=e.isNative,n=e.isShadows,a=e.neverHide,i=e.onScroll;this.scroller||(this.scroller=Object(r.createScroll)(this.wrapper,{shadows:n,nativeScroll:t,hidden:!a,onScroll:i}))}componentDidUpdate(){this.scroller.update()}componentWillUnmount(){this.scroller.destroy(),this.scroller=null}render(){var e=this.props,t=e.children,n=(e.isNative,e.isShadows,e.neverHide,e.className),r=void 0===n?"":n,l=o(e,["children","isNative","isShadows","neverHide","className"]);return a.createElement("div",s({},l,{className:Object(i.classNames)("Scroll",r),ref:this.getWrapperRef}),t)}}l.defaultProps={isNative:!1,isShadows:!1,neverHide:!1,onScroll:null}},"6krn":function(e,t,n){"use strict";n.r(t),n.d(t,"getLang",(function(){return s}));var a=n("nAFc"),r=n("4+be"),i={};function s(e,t,n){void 0===t&&(t=!1);var s="number"==typeof t,o=t||s,l=e+(o?".raw":"");if(void 0===i[l]){var c=o?Object(r.getLang)(e,"raw"):Object(r.getLang)(e);"string"==typeof c?i[l]=Object(a.decodeHTMLEntities)(c):Array.isArray(c)&&(i[l]=c.map(a.decodeHTMLEntities))}if(s){var d=t;return Object(r.langNumeric)(d,i[l],n)}return i[l]||""}t.default={getLang:s}},"754W":function(e,t,n){"use strict";n.r(t);n("91GP"),n("ioFf"),n("rGqo"),n("Btvt");var a=n("q1tI"),r=(n("17x9"),n("ZxpX"));function i(){return(i=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e}).apply(this,arguments)}function s(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},i=Object.keys(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}t.default=e=>{var t=e.children,n=e.className,o=s(e,["children","className"]),l=Object(r.classNames)("LinkButton",n),c=i({},o,{onMouseDown:e=>{e.preventDefault(),o.onMouseDown&&o.onMouseDown(e)}});return a.createElement("button",i({},c,{className:l}),t)}},"756/":function(e,t,n){"use strict";n.r(t),n.d(t,"ConversationNoPhoto",(function(){return l}));var a=n("q1tI"),r=n.n(a),i=n("ZxpX"),s=function(){return(s=Object.assign||function(e){for(var t,n=1,a=arguments.length;n<a;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)},o=function(e,t){var n={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(n[a]=e[a]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(a=Object.getOwnPropertySymbols(e);r<a.length;r++)t.indexOf(a[r])<0&&Object.prototype.propertyIsEnumerable.call(e,a[r])&&(n[a[r]]=e[a[r]])}return n},l=function(e){var t=e.id,n=e.size,a=void 0===n?"m":n,l=e.text,c=e.specificType,d=e.className,u=o(e,["id","size","text","specificType","className"]),g=c||t%6+1,m=Object(i.classNames)("ConversationNoPhoto","ConversationNoPhoto--"+g,"ConversationNoPhoto--"+a,d);return r.a.createElement("figure",s({},u,{className:m,dangerouslySetInnerHTML:{__html:l}}))}},"7ZXl":function(e,t,n){"use strict";n.r(t),n.d(t,"ModalFooter",(function(){return i}));var a=n("q1tI"),r=n.n(a),i=function(e){var t=e.actionButtons,n=e.hint;return r.a.createElement("div",{className:"ModalFooter"},r.a.createElement("div",{className:"ModalFooter__inner"},n&&r.a.createElement("div",{className:"ModalFooter__hint"},n),t))}},"7hRE":function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return o}));n("91GP"),n("ioFf"),n("rGqo"),n("Btvt");var a=n("q1tI"),r=(n("17x9"),n("ZxpX"));function i(){return(i=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e}).apply(this,arguments)}function s(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},i=Object.keys(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}class o extends a.Component{constructor(e){super(e),this.onError=()=>{this.setState({errored:!0})},this.state={}}render(){var e=this.props,t=e.photo,n=e.title,o=e.isOnline,l=e.isMobile,c=e.onlineSize,d=e.element,u=e.className,g=s(e,["photo","title","isOnline","isMobile","onlineSize","element","className"]),m=d||"div",_="Avatar--badge-"+c,p=Object(r.classNames)("Avatar",_,u,{"Avatar--online":o,"Avatar--mobile":l});return a.createElement(m,i({className:p},g),a.createElement("div",{className:"Avatar__wrapper"},a.createElement("img",{onError:this.onError,className:"Avatar__img",src:this.state.errored?"/images/camera_c.gif":t,alt:n})))}}o.defaultProps={isOnline:!1,isMobile:!1,onlineSize:"m"}},"83Q7":function(e,t,n){"use strict";var a,r,i;n.r(t),n.d(t,"SearchResultType",(function(){return r})),n.d(t,"Mode",(function(){return i})),n.d(t,"LOAD_PEERS",(function(){return u})),n.d(t,"CHANGE_MODE",(function(){return g})),n.d(t,"CALL_STATE",(function(){return m})),n.d(t,"REMOVE_USER",(function(){return _})),n.d(t,"TIME_START",(function(){return p})),n.d(t,"HANGUP",(function(){return h})),n.d(t,"SET_CHAT_INFO",(function(){return f})),n.d(t,"GROUP_CALL_SETUP",(function(){return b})),n.d(t,"TOGGLE_POPUP",(function(){return v})),n.d(t,"UPDATE_HASH",(function(){return O})),n.d(t,"CHANGE_UI_MODE",(function(){return y})),n.d(t,"SET_ORATOR",(function(){return C})),n.d(t,"TOGGLE_ORATOR_MODE",(function(){return E})),n.d(t,"TOGGLE_PARTICIPANTS_ASIDE",(function(){return j})),n.d(t,"SET_PINNED_PARTICIPANT",(function(){return T})),n.d(t,"MANAGEMENT",(function(){return S})),n.d(t,"CALL_NOTIFICATION",(function(){return I})),n.d(t,"JOIN",(function(){return A})),n.d(t,"ERROR",(function(){return w})),n.d(t,"CHANGE_PARTICIPANT_STATE",(function(){return L})),n.d(t,"SET_SCREEN_SHARER",(function(){return k})),n.d(t,"SET_FRIENDS",(function(){return M})),n.d(t,"SET_SPEAKERS",(function(){return N})),n.d(t,"UPDATE_PARTICIPANTS_BATCH",(function(){return P})),n.d(t,"SET_UNREAD_COUNT",(function(){return D})),n.d(t,"CallType",(function(){return s})),n.d(t,"UIMode",(function(){return o})),n.d(t,"CallStatus",(function(){return l})),n.d(t,"NotificationType",(function(){return c})),n.d(t,"SdkHandType",(function(){return d})),n.d(t,"defaultNotificationLifeSpan",(function(){return U})),n.d(t,"VOLUME_LEVEL_DETECTION",(function(){return G})),n.d(t,"BAD_CONNECTION_DISABLED_CAMERA_LEVEL",(function(){return q})),n.d(t,"HANGUP_DELAY",(function(){return V})),n.d(t,"CLIENT_ERROR_NOT_AUTHORIZED",(function(){return W})),n.d(t,"CLIENT_ERROR_NO_PERMISSIONS",(function(){return K})),n.d(t,"SERVER_ERROR_UNKNOWN",(function(){return Y})),n.d(t,"SERVER_ERROR_INVALID_REQUEST",(function(){return $})),n.d(t,"SERVER_ERROR_FLOOD_CONTROL",(function(){return z})),n.d(t,"SERVER_ERROR_INTERNAL",(function(){return X})),n.d(t,"SERVER_ERROR_OLD_RECEIVER_APP",(function(){return Q})),n.d(t,"SERVER_ERROR_PRIVACY",(function(){return Z})),n.d(t,"SERVER_ERROR_BUSY",(function(){return J})),n.d(t,"POPUP_SETTINGS",(function(){return ee})),n.d(t,"POPUP_EXIT",(function(){return te})),n.d(t,"CallStatReachedType",(function(){return R})),n.d(t,"CallStatResult",(function(){return x})),n.d(t,"CallStatFailReason",(function(){return B})),n.d(t,"CallStatSource",(function(){return H})),n.d(t,"CallActionEventType",(function(){return F})),n.d(t,"HANGUP_TYPE_BUSY",(function(){return ne})),n.d(t,"HANGUP_TYPE_CALLEE_IS_OFFLINE",(function(){return ae})),n.d(t,"HANGUP_TYPE_CALLER_IS_BLOCKED",(function(){return re})),n.d(t,"HANGUP_TYPE_CANCELED",(function(){return ie})),n.d(t,"HANGUP_TYPE_EXTERNAL_API_ERROR",(function(){return se})),n.d(t,"HANGUP_TYPE_FAILED",(function(){return oe})),n.d(t,"HANGUP_TYPE_HUNGUP",(function(){return le})),n.d(t,"HANGUP_TYPE_MISSED",(function(){return ce})),n.d(t,"HANGUP_TYPE_NOT_FRIENDS",(function(){return de})),n.d(t,"HANGUP_TYPE_OLD_VERSION",(function(){return ue})),n.d(t,"HANGUP_TYPE_REJECTED",(function(){return ge})),n.d(t,"HANGUP_TYPE_REMOVED",(function(){return me})),n.d(t,"HANGUP_TYPE_SERVICE_DISABLED",(function(){return _e})),n.d(t,"HANGUP_TYPE_UNKNOWN_ERROR",(function(){return pe})),n.d(t,"HANGUP_TYPE_UNSUPPORTED",(function(){return he})),function(e){e.BUSY="BUSY",e.CALLEE_IS_OFFLINE="CALLEE_IS_OFFLINE",e.CALLER_IS_BLOCKED="CALLER_IS_BLOCKED",e.CANCELED="CANCELED",e.EXTERNAL_API_ERROR="EXTERNAL_API_ERROR",e.FAILED="FAILED",e.HUNGUP="HUNGUP",e.MISSED="MISSED",e.NOT_FRIENDS="NOT_FRIENDS",e.OLD_VERSION="OLD_VERSION",e.REJECTED="REJECTED",e.REMOVED="REMOVED",e.SERVICE_DISABLED="SERVICE_DISABLED",e.UNKNOWN_ERROR="UNKNOWN_ERROR",e.UNSUPPORTED="UNSUPPORTED"}(a||(a={})),function(e){e[e.HEADER=0]="HEADER",e[e.CALL_ALL_IN_CHAT=1]="CALL_ALL_IN_CHAT",e[e.MEMBERS_MORE=2]="MEMBERS_MORE",e[e.FRIENDS_MORE=3]="FRIENDS_MORE"}(r||(r={})),function(e){e[e.READY=0]="READY",e[e.CALL=1]="CALL",e[e.INCOMING=2]="INCOMING",e[e.JOIN=3]="JOIN",e[e.ERROR=4]="ERROR"}(i||(i={}));var s,o,l,c,d,u="load_peer",g="change_mode",m="call_state",_="remove_user",p="time_start",h="hangup",f="set_chat_info",b="group_call_setup",v="toggle_popup",O="update_hash",y="change_ui_mode",C="set_orator",E="toggle_orator_mode",j="toggle_participants_aside",T="set_pinned_participant",S="management",I="call_notification",A="join",w="error",L="change_participant_state",k="set_screen_sharer",M="set_friends",N="set_speakers",P="update_participants_batch",D="set_unread_count";!function(e){e.AUDIO="audio",e.VIDEO="video"}(s||(s={})),function(e){e.DEFAULT="default",e.COLLAPSED="collapsed",e.FULLSCREEN="fullscreen"}(o||(o={})),function(e){e.WAITING="WAITING",e.CONNECTING="CONNECTING",e.CONNECTED="CONNECTED",e.RECONNECT="RECONNECT",e.ERROR="ERROR",e.HANGUP="HANGUP",e.PERMISSIONS="PERMISSIONS"}(l||(l={})),function(e){e.SPEAKING_ON_MUTE="SPEAKING_ON_MUTE",e.RAISED_HAND="RAISED_HAND",e.SCREEN_SHARING_STARTED="SCREEN_SHARING_STARTED",e.BAD_NETWORK_CONNECTION="BAD_NETWORK_CONNECTION",e.BAD_NETWORK_CONNECTION_DISABLE_CAMERA="BAD_NETWORK_CONNECTION_DISABLE_CAMERA"}(c||(c={})),function(e){e.LOWERED="0",e.RAISED="1"}(d||(d={}));var R,x,B,H,F,U=5e3,G=.25,q=3,V=2,W=-1,K=-2,Y=1,$=8,z=9,X=10,Q=923,Z=928,J=948,ee="settings",te="exit";!function(e){e.AUDIO="ok_audio",e.AUDIO_TO_VIDEO="ok_video",e.VIDEO="ok_started_as_video",e.GROUP_AUDIO="group_audio",e.GROUP_AUDIO_TO_VIDEO="group_video",e.GROUP_VIDEO="group_started_as_video"}(R||(R={})),function(e){e.SUCCESS="success",e.FAIL="fail"}(x||(x={})),function(e){e.REMOTE_NO_CONNECT="push_not_delivered",e.REMOTE_FAILED_ACCEPT="сant_connect",e.REMOTE_DECLINE="declined_remote",e.LOCAL_DECLINE="declined_local",e.REMOTE_TIMEOUT="declined_timeout",e.REMOTE_BUSY="busy",e.CONNECTION_LOST="lost_connection"}(B||(B={})),function(e){e.CONVO_HEADER="im_header",e.CONVO_SNIPPET="im_message",e.CONVO_LIST="im_create",e.CONVO_JOIN_SNIPPET="im_join_message",e.CONVO_JOIN_HEADER="im_join_header",e.CONVO_JOIN_BANNER="im_join_header",e.LINK_JOIN_SNIPPET="join_deeplink",e.LINK_JOIN_PAGE="join_deeplink"}(H||(H={})),function(e){e.OUTGOING_CALL_STARTED_VIDEO="OutgoingCallStartedVideo",e.OUTGOING_CALL_STARTED_AUDIO="OutgoingCallStartedAudio",e.OUTGOING_CALL_ADD_PARTICIPANTS_SENT="OutgoingCallAddParticipantsSent",e.OUTGOING_CALL_REMOTE_RINGING="OutgoingCallRemoteRinging",e.OUTGOING_CALL_ACCEPTED_REMOTELY="OutgoingCallAcceptedRemotely",e.OUTGOING_CALL_FAILED="OutgoingCallFailed",e.OUTGOING_CALL_COMPLETED="OutgoingCallCompleted",e.INCOMING_CALL_RECEIVED="IncomingCallReceived",e.INCOMING_CALL_ACCEPTED="IncomingCallAccepted",e.CALL_DECLINED_OR_HANGED_LOCALLY="CallDeclinedOrHangedLocally",e.CALL_DECLINED_OR_HANGED_REMOTELY="CallDeclinedOrHangedRemotely",e.CALL_CONNECTED="CallConnected",e.CALL_DISCONNECTED="CallDisconnected",e.VIDEO_ENABLED="VideoEnabled",e.VIDEO_DISABLED="VideoDisabled",e.RELAY_CONNECTION_ESTABLISHED="RelayConnectionEstablished",e.USER_FEEDBACK_RECEIVED="UserFeedbackReceived",e.SYSTEM_STAT="SystemStat",e.GROUP_CALL_JOINED="GroupCallJoined",e.HAND_RAISED="HandRaised",e.HAND_LOWERED="HandLowered",e.SCREEN_SHARING_STARTED="ScreenSharingStarted",e.SCREEN_SHARING_STOPPED="ScreenSharingStopped",e.ALL_MICS_DISABLED="AllMicsDisabled",e.MIC_OFF_WHILE_TALKING_ALERT="MicOffWhileTalkingAlert",e.MIC_OFF_WHILE_TALKING_ENABLE_CLICK="MicOffWhileTalkingEnableClick",e.VIDEO_DISABLED_DUE_TO_BAD_CONNECTION_ALERT="VideoDisabledDueToBadConnectionAlert"}(F||(F={}));var ne=a.BUSY,ae=a.CALLEE_IS_OFFLINE,re=a.CALLER_IS_BLOCKED,ie=a.CANCELED,se=a.EXTERNAL_API_ERROR,oe=a.FAILED,le=a.HUNGUP,ce=a.MISSED,de=a.NOT_FRIENDS,ue=a.OLD_VERSION,ge=a.REJECTED,me=a.REMOVED,_e=a.SERVICE_DISABLED,pe=a.UNKNOWN_ERROR,he=a.UNSUPPORTED},"86+7":function(e,t,n){"use strict";n.r(t),n.d(t,"oCacheExists",(function(){return r})),n.d(t,"oCacheGet",(function(){return i})),n.d(t,"oCacheAdd",(function(){return s}));n("KKXr");var a=n("aong");function r(e,t){return t in Object(a.unpackStore)(e).oCache}function i(e,t){var n=Object(a.unpackStore)(e).oCache[t];return n&&!n._n&&(!function(e){if(!e.first_name){var t=e.name.split(" ",2);e.first_name=t[0],e.short_name=t[1]?t[0]+" "+t[1].substr(0,1)+".":t[0]}e.inv_name||(e.inv_name=e.name),e.kick_name||(e.kick_name=e.inv_name)}(n),n._n=1),n}function s(e,t){var n=Object(a.unpackStore)(e);n.oCache||(n.oCache={}),t.id&&(n.oCache[t.id]=t)}},"8h6g":function(e,t,n){"use strict";n.r(t),n.d(t,"VIDEO_UPLOAD_EXTS",(function(){return a})),n.d(t,"VIDEO_UPLOAD_MAX_FILE_SIZE_IN_GB",(function(){return r})),n.d(t,"VIDEO_UPLOAD_CHUNK_SIZE",(function(){return i}));n("KKXr");var a="avi mp4 3gp mpeg mov flv f4v wmv mkv webm vob rm rmvb m4v mpg ogv ts m2ts mts mxf".split(" "),r=5,i=4194304},As6E:function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return o}));n("91GP"),n("rGqo"),n("Btvt");var a=n("q1tI"),r=n("i8i4"),i=(n("17x9"),n("ZxpX")),s=n("clTp");class o extends a.Component{constructor(e){super(e),this.onClick=()=>{if(!this.state.dropdown||this.state.dropdown.removed){var e=this.props,t=e.text,n=e.position,a=e.align,r=e.marginTop,i=e.marginLeft,o=Object(s.default)(this.el);this.update({text:t,position:n,align:a,rect:o,marginTop:r,marginLeft:i})}else this.update()},this.onMouseEnter=e=>{this.callerHovered=!0,this.timeouts.appear=setTimeout(()=>{if(this.el&&this.callerHovered){var e=this.props,t=e.position,n=e.align,a=e.marginTop,r=e.marginLeft,i=Object(s.default)(this.el);this.update({position:t,align:n,rect:i,marginTop:a,marginLeft:r})}},80)},this.onMouseLeave=e=>{this.callerHovered=!1,this.timeouts.callerDisappear=setTimeout(()=>{this.callerHovered||this.hovered||this.update()},250)},this.onDropdownMouseEnter=()=>{"hover"===this.props.trigger&&(this.hovered=!0)},this.onDropdownMouseLeave=e=>{"hover"===this.props.trigger&&(this.hovered=!1,this.timeouts.disappear=setTimeout(()=>{this.callerHovered||this.hovered||this.update()},250))},this.onDocumentClick=e=>{!this.state.dropdown||this.state.dropdown.removed||this.el.contains(e.target)||this.update()},this.onResize=e=>{if(this.state.dropdown&&!this.state.dropdown.removed){var t=this.props,n=t.text,a=t.position,r=t.align,i=t.marginTop,o=t.marginLeft,l=Object(s.default)(this.el);this.update({text:n,position:a,align:r,rect:l,marginTop:i,marginLeft:o})}},this.onTransitionEnd=e=>{"visibility"===e.propertyName&&this.state.dropdown&&this.state.dropdown.removed&&this.setState({dropdown:void 0})},this.onItemClick=(e,t)=>{t.separator||(this.update(),t.onClick(e))},this.state={},this.timeouts={}}componentDidMount(){this.el=r.findDOMNode(this),"click"===this.props.trigger?(this.el.addEventListener("click",this.onClick),document.addEventListener("mousedown",this.onDocumentClick),window.addEventListener("resize",this.onResize)):(this.el.addEventListener("mouseenter",this.onMouseEnter),this.el.addEventListener("mouseleave",this.onMouseLeave))}componentWillUnmount(){Object.keys(this.timeouts).forEach(e=>{clearTimeout(this.timeouts[e])}),"click"===this.props.trigger?(this.el.removeEventListener("click",this.onClick),document.removeEventListener("mousedown",this.onDocumentClick),window.removeEventListener("resize",this.onResize)):(this.el.removeEventListener("mouseenter",this.onMouseEnter),this.el.removeEventListener("mouseleave",this.onMouseLeave)),this.defaultNode&&(this.defaultNode.parentNode.removeChild(this.defaultNode),delete this.defaultNode)}update(e){if(!e)return this.setState({dropdown:Object.assign({},this.state.dropdown,{removed:!0})});var t=e.position,n=e.align,a=e.rect,r=e.marginTop,i=e.marginLeft,s=a.left,o=a.top;switch(t){case"t":s+=.5*a.width;break;case"r":s+=a.width,o+=.5*a.height;break;case"b":s+=.5*a.width,o+=a.height;break;case"l":o+=.5*a.height}s=Math.round(s+i),o=Math.round(o+r),this.setState({dropdown:{position:t,align:n,x:s,y:o}})}renderDropdown(){if(!this.state.dropdown)return null;var e=this.state.dropdown,t=e.x,n=e.y,r=e.position,s=e.align,o=e.removed,l=Object(i.classNames)("Dropdown","Dropdown--"+r,{"Dropdown--removed":!!o,["Dropdown--align-"+s]:"t"===r||"b"===r},this.props.className);return a.createElement("div",{className:l,style:{top:n,left:t},onTransitionEnd:e=>this.onTransitionEnd(e),onMouseEnter:this.onDropdownMouseEnter,onMouseLeave:this.onDropdownMouseLeave},a.createElement("ul",{className:"Dropdown__in"},this.props.data.map((e,t)=>a.createElement("li",{className:Object(i.classNames)("Dropdown__item",{Dropdown__item_separator:e.separator}),onClick:t=>this.onItemClick(t,e),key:void 0!==e.id?e.id:t},e.text))))}render(){var e=this.renderDropdown();return e?(this.defaultNode||"undefined"==typeof window||(this.defaultNode=document.createElement("div"),document.body.appendChild(this.defaultNode)),a.createElement(a.Fragment,null,this.props.children,r.createPortal(e,this.defaultNode))):this.props.children}}o.defaultProps={position:"b",align:"center",marginTop:0,marginLeft:0,trigger:"click",className:""}},"BN/X":function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return o}));n("91GP"),n("ioFf"),n("rGqo"),n("Btvt");var a=n("q1tI"),r=(n("17x9"),n("ZxpX"));function i(){return(i=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e}).apply(this,arguments)}function s(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},i=Object.keys(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}class o extends a.Component{render(){var e=this.props,t=e.hovered,n=e.className,o=e.children,l=s(e,["hovered","className","children"]),c=Object(r.classNames)("Link",{"Link--hovered":!!t},n);return this.props.href?a.createElement("a",i({},l,{className:c}),o):a.createElement("span",i({},l,{className:c}),o)}}o.defaultProps={href:void 0,hovered:!1}},BxOC:function(e,t,n){"use strict";n.r(t),n.d(t,"post",(function(){return r})),n.d(t,"plainget",(function(){return i})),n.d(t,"plaingetCancelable",(function(){return s}));n("VRzm"),n("Btvt");var a=n("cGUQ");function r(e,t,n){return t&&(t.im_v=3),new Promise((a,r)=>{ajax.post(e,t,{timeout:n,onDone(){a.apply(null,[[...arguments]])},onFail(){return r.apply(null,arguments),!0}})})}function i(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},a=s(e,t,n),r=a.request;return r}function s(e,t){var n,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};function i(){n.abort()}n=window.XDomainRequest?new XDomainRequest:ajax._getreq();var s=new Promise((i,s)=>{var o,l=Date.now(),c=r.timeout||60,d=Object(a.toQueryString)(t);if(window.XDomainRequest)n.open("get",`${e}?${d}`),n.ontimeout=function(e){s([e,{}])},n.onerror=function(e){s([e,{}])},n.onload=function(){i([n.responseText,{}])},setTimeout((function(){n.send()}),0);else{n.onreadystatechange=function(){4==n.readyState&&(clearInterval(o),n.status>=200&&n.status<300?i([n.responseText,n]):s([n.responseText,n]))};try{n.open("GET",`${e}?${d}`,!0)}catch(e){return s([e,n])}n.send()}o=setInterval((function(){Date.now()-l>1e3*c&&(window.browser.safari&&n.abort(),s(["",{}]),clearInterval(o))}),1e3)});return{request:s,cancel:i}}},ERyv:function(e,t,n){"use strict";n.r(t),n.d(t,"isWeirdLogging",(function(){return c})),n.d(t,"imWeirdLog",(function(){return d})),n.d(t,"imWeirdCatch",(function(){return u})),n.d(t,"startLoggingAllUnhandled",(function(){return g})),n.d(t,"stopLoggingAllUnhandled",(function(){return m}));n("VRzm"),n("Btvt");var a,r=n("BxOC"),i=n("DM26"),s=1;function o(e,t,n,r,i){if("Script error."!==e){var s=i?i.stack||i.message:null;d("unhandled_error",s?{err:e,stack:s}:{err:e})}a&&a.apply(this,arguments)}function l(e){e.preventDefault()}function c(){return!!window.imwl}function d(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];c()&&(n&&window.console&&(console.error(e,t),console.trace&&console.trace()),Object(i.retryFn)(r.post,3,()=>2)("al_im.php",{act:"a_weird_log",kind:e,data:JSON.stringify(extend({errIdx:s++,ua:navigator.userAgent},t))}))}function u(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return d(e,extend({err:t&&t.message||t},n)),Promise.reject(t)}function g(){a=window.onerror,window.onerror=o,window.addEventListener("unhandledrejection",l)}function m(){window.onerror=a,a=void 0,window.removeEventListener("unhandledrejection",l)}},FABD:function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return m}));n("91GP"),n("ioFf"),n("rGqo"),n("a1Th"),n("Btvt");var a=n("q1tI"),r=(n("17x9"),n("ZxpX")),i=n("vRp6"),s=n("xGYt"),o=n("dt/K");function l(){return(l=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e}).apply(this,arguments)}function c(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},i=Object.keys(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function d(e){var t=e.id,n=e.name,i=e.tokens,s=e.onRemoveToken,d=e.removeTokenTooltip,u=e.removeTokenAriaLabel,g=e.renderToken,m=e.onChange,_=e.value,p=e.placeholder,h=e.onSubmit,f=e.className,b=c(e,["id","name","tokens","onRemoveToken","removeTokenTooltip","removeTokenAriaLabel","renderToken","onChange","value","placeholder","onSubmit","className"]),v=a.useRef(),O=a.useCallback(e=>m(e),[m]),y=a.useCallback(e=>{"Esc"===e.key&&v.current&&(v.current.value="",v.current.blur(),m(e),e.stopPropagation()),"Enter"===e.key&&h()},[h]),C=a.useCallback(e=>{var t=e.target.dataset.id;s(t),v.current&&v.current.focus()},[s]);return a.createElement("div",{className:Object(r.classNames)("TokenInput",f)},a.createElement("label",{htmlFor:t,className:"TokenInput__back"}),i.map(e=>a.createElement("span",{key:e.id,className:"TokenInput__token"},a.createElement("input",{type:"hidden",name:n+"[]",value:e.value||e.id}),a.createElement("span",{className:"TokenInput__label"},g?g(e):e.text),!e.locked&&d&&a.createElement(o.default,{text:d},a.createElement("button",{"data-id":e.id,className:"TokenInput__remove",onClick:C,"aria-label":u})),!e.locked&&!d&&a.createElement("button",{"data-id":e.id,className:"TokenInput__remove",onClick:C,"aria-label":u}))),a.createElement("div",{className:"TokenInput__caret"},a.createElement("div",{className:"TokenInput__caretIn"},a.createElement("input",l({},b,{id:t,type:"text",value:_,onChange:O,onPaste:O,placeholder:0===i.length?p:"",onKeyDown:y,className:"TokenInput__input",ref:v})))))}function u(){return(u=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e}).apply(this,arguments)}function g(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},i=Object.keys(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}d.defaultProps={id:"token-input",name:"tokens",removeTokenTooltip:"",removeTokenAriaLabel:"Remove item",placeholder:"",className:""};class m extends a.PureComponent{constructor(e){super(e),this.onRemoveToken=e=>{var t=this.searchContainer.offsetHeight;this.props.onRemoveToken(e.target.getAttribute("data-id")).then(()=>{this.updateScroll(t)})},this.onChange=e=>{var t=e.target.value;t!==this.value&&(this.value=t,this.props.onChange(e),this.scrollContainer.scrollTop=0)},this.onSelect=e=>{var t=this.searchContainer.offsetHeight;this.props.onSelect(e.currentTarget.getAttribute("data-id")).then(()=>{this.updateScroll(t)})},this.updateScroll=e=>{var t=this.searchContainer.offsetHeight;this.searchContainer.querySelector("#"+this.inputId).focus(),this.searchContainer.scrollTop=this.searchContainer.scrollHeight,e!==t&&(this.scrollContainer.scrollTop=this.scrollContainer.scrollTop+t-e)},this.searchContainerRef=e=>{this.searchContainer=e},this.scrollContainerRef=e=>{var t=e;if(e&&e.container)for(t=e;t.container;)t=t.container;this.scrollContainer=t},this.value=e.value,this.inputId="token-input-"+Math.floor(1e6*Math.random()).toString(16)}render(){var e=this.props,t=e.className,n=e.tokens,o=(e.onSelect,e.renderToken),l=e.onRemoveToken,c=e.removeTokenPlaceholder,m=e.value,_=e.placeholder,p=e.useInfiniteScroll,h=e.loadMore,f=e.hasMore,b=e.virtualized,v=e.notFoundText,O=e.children,y=e.emptyText,C=e.isSearching,E=e.renderSuggest,j=e.useSuggestsWrapper,T=e.data,S=g(e,["className","tokens","onSelect","renderToken","onRemoveToken","removeTokenPlaceholder","value","placeholder","useInfiniteScroll","loadMore","hasMore","virtualized","notFoundText","children","emptyText","isSearching","renderSuggest","useSuggestsWrapper","data"]),I=p?i.default:"div",A=p?{loadMore:h,hasMore:f,virtualized:b,useCapture:!1}:{},w=O?[].concat(O):[],L=!T&&0===w.length||!!T&&0===T.length&&(m||y)&&!C,k=a.createElement(a.Fragment,null,L&&a.createElement("div",{className:"MultiSelect__empty"},a.createElement("div",{className:"MultiSelect__emptyIn"},m?v:y)),a.createElement(I,u({className:"MultiSelect__scroll",ref:this.scrollContainerRef},A),!!T&&T.map(e=>E(e,this.onSelect)),!T&&w.map(e=>E?E(e,this.onSelect):a.createElement(s.default,{className:"MultiSelect__suggestsItem","data-id":e.props["data-id"],onClick:this.onSelect,key:e.key},e))));return a.createElement("div",{className:Object(r.classNames)("MultiSelect",t)},a.createElement("div",{className:"MultiSelect__search",ref:this.searchContainerRef},a.createElement(d,u({id:this.inputId,tokens:n,onRemoveToken:l,removeTokenTooltip:c,removeTokenAriaLabel:c,placeholder:_,onChange:this.onChange,onSubmit:()=>{},renderToken:o,value:m},S))),j?a.createElement("div",{className:"MultiSelect__suggestsWrapper"},k):k)}}m.defaultProps={removeTokenPlaceholder:"",placeholder:"",value:"",useInfiniteScroll:!1,notFoundText:"Not found",useSuggestsWrapper:!1}},FEsp:function(e,t,n){"use strict";n.r(t);var a=n("q1tI"),r=n.n(a),i=n("ZxpX"),s=function(){return(s=Object.assign||function(e){for(var t,n=1,a=arguments.length;n<a;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)},o=function(e,t){var n={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(n[a]=e[a]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(a=Object.getOwnPropertySymbols(e);r<a.length;r++)t.indexOf(a[r])<0&&Object.prototype.propertyIsEnumerable.call(e,a[r])&&(n[a[r]]=e[a[r]])}return n};t.default=function(e){var t=e.children,n=e.className,a=o(e,["children","className"]);return r.a.createElement("div",s({},a,{className:Object(i.classNames)("Stub",n)}),t||"No results.")}},LYnS:function(e,t,n){"use strict";n.r(t);n("pIFo");var a=n("86+7"),r=n("rHUl"),i=n("6krn").default.getLang;t.default=()=>[{id:"user name",label:i("mail_community_templates_hint_name"),process:e=>Object(a.oCacheGet)(e,Object(r.getPeer)(e)).first_name},{id:"user surname",label:i("mail_community_templates_hint_last_name"),process(e){var t=Object(a.oCacheGet)(e,Object(r.getPeer)(e));return t.name.replace(t.first_name,"").trim()}},{id:"admin name",label:i("mail_community_templates_hint_your_name"),process:e=>Object(a.oCacheGet)(e,vk.id).first_name},{id:"admin surname",label:i("mail_community_templates_hint_your_last_name"),process(e){var t=Object(a.oCacheGet)(e,vk.id);return t.name.replace(t.first_name,"").trim()}},{id:"community",label:i("mail_community_templates_hint_community"),process:e=>Object(a.oCacheGet)(e,e.get().id).name},{id:"greeting",label:i("mail_community_templates_hint_greeting"),process(e){var t=(new Date).getHours();return i(t>=3&&t<12?"mail_greeting_good_morning":t>=12&&t<17?"mail_greeting_good_afternoon":t>=17&&t<=23?"mail_greeting_good_evening":"mail_greeting_good_night")}}]},M24l:function(e,t,n){"use strict";n.r(t);n("HEwt"),n("a1Th"),n("rE2o"),n("ioFf"),n("91GP"),n("VRzm"),n("Vd3H"),n("pIFo"),n("OEbY"),n("SRfc"),n("rGqo"),n("Btvt"),n("OG14");var a=n("vT4u"),r=n("P13b"),i=n("rHUl"),s=n("MhhX"),o=n("4+be"),l=n("FWc3"),c=n("nAFc");function d(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var n=[],a=!0,r=!1,i=void 0;try{for(var s,o=e[Symbol.iterator]();!(a=(s=o.next()).done)&&(n.push(s.value),!t||n.length!==t);a=!0);}catch(e){r=!0,i=e}finally{try{a||null==o.return||o.return()}finally{if(r)throw i}}return n}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return u(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return u(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function u(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,a=new Array(t);n<t;n++)a[n]=e[n];return a}function g(e,t){var n=0,a=[],r=[],i=!1;return e.forEach(e=>{e.width=e.width?e.width:function(e){return 12+9*Object(c.decodeHTMLEntities)(e.name).length}(e),e.width+(i?0:69)>=t-n?(r.push(e),i||(n+=69,i=!0)):(a.push(e),n+=e.width)}),[a,r]}function m(e,t){var n=t.peer_tags&&t.peer_tags.length?e.peer_profile_tags.filter(e=>t.peer_tags.includes(e.id)):[];return t.ad_id&&n.unshift(function(e){var t,n;return e.is_easy_promoted_market?(t=Object(o.getLang)("mail_ad_tag_easy_promoted_market"),n=145):(t=e.has_ad_access?`${Object(o.getLang)("mail_ad_tag_text_prefix")} ${e.ad_id}`:Object(o.getLang)("mail_ad_tag_no_access_text"),n=e.has_ad_access?104:97),{isAdTag:!0,adTagText:t,width:n,name:t,color:"#e5ebf1"}}(t)),n}var _=n("aong"),p=n("ofcU"),h=n("f01n");function f(e,t,n){var i=intval(domData(n,"msgid"));if(!Object(_.getSelectionText)()&&!Object(r.checkSelectClick)(t)){var s=intval(domData(n,"peer"));return e.set(a.cancelSearch.bind(null,s)),e.get().longpoll.push([Object(h.changePeer)(s,i)]),!1}}function b(e,t){return{isAll:e=>Object(a.isSearchAllLoaded)(e.get().peer,e.get()),loadMore:e=>function(e){return Object(a.isSearchAllLoaded)(e.get().peer,e.get())?Promise.resolve(""):Object(a.searchMessagesInplace)(e.get().peer,e.get())}(e),unmount(){Object(p.destroyModule)(t)}}}function v(e){return e.findIndex(e=>"number"==typeof e.peerId&&e.href)>-1}function O(e,t){var n=f.bind(null,t);return b(0,Object(p.createModule)({handlers:(t,a)=>{a(e,"click","_im_mess",n)}}))}var y=n("h++7"),C=n("4cFO"),E=n("+/AQ");function j(e,t){return Object(_.toArray)(e).find(e=>domData(e,"list-id")===t)}function T(e,t){return Object(_.toArray)(e).findIndex(e=>domData(e,"list-id")===t)}function S(e,t,n,a){if(n){I(e,t,a);var r=domData(n,"list-id"),i=r&&j(t.children,r);i&&a.forEach(e=>addClass(i,e)),e.setState({hoveredListItemId:r})}}function I(e,t,n){var a=domQuery("."+n.join("."),t);a&&Object(_.toArray)(a).forEach(e=>{n.forEach(t=>removeClass(e,t))}),e.setState({hoveredListItemId:null})}function A(e,t){var n=t&&domQuery("."+t.join("."),e)[0];return n?domData(n,"list-id"):null}function w(e,t,n){return e.map(t).reduce((e,t)=>(e[t]=!0,e),n)}function L(e,t,n){return{ids:w(n.get().elements,e,{}),scrolls:t,activated:!0}}function k(e,t,n){return n.elements=n.elements.filter(n=>t(n)!==e),delete n.ids[e],Promise.resolve(n)}function M(e,t,n){var a=[];n.elements=n.elements.map(n=>{var r=t(n),i=e.filter(e=>t(e)===r)[0];return a.push(r),i||n});var r=e.filter(e=>!inArray(t(e),a));return n.elements=n.elements.concat(r),Promise.resolve(n)}function N(e){var t={};return e.forEach(e=>{"r"===e[0]&&t["a,"+e[1]]?delete t["a,"+e[1]]:t[`${e[0]},${e[1]}`]=e}),Object.keys(t).map(e=>t[e])}function P(e,t,n,a,r,i,s){for(var o=0;o<a;o++)e=domNS(e);var l=se(r(t));return domData(l,"list-id",n),e?i.insertBefore(l,e):i.appendChild(l),s&&s(l),e}function D(e,t,n,a,r){var i=a.get(),s=i.limit,o=i.offset,l=function(e,t){var n=t.get();return!n._sortedEls&&e&&t.setState({elements:n.elements.sort(e),_sortedEls:!0}),t.get().elements}(n().sortFn,a).slice(0,o+s),c=function(e,t){for(var n=[],a=Math.max(e.length,t.length),r=0;r<a;r++){var i=e[r],s=t[r];!i&&s?n.push(["a",s,r]):i&&!s?n.push(["r",i,r]):i!==s&&(n.push(["r",i,r]),n.push(["a",s,r]))}var o=N(n),l=N(n.reverse());return o.length>l.length?l:o}(Object(_.toArray)(e.children).map(e=>domData(e,"list-id")).filter(e=>!!e),l.map(e=>n().idFn(e).toString()));if(function(e,t,n,a,r){if(0!==t.length){var i=(t=t.sort((e,t)=>e[2]-t[2])).filter(e=>"a"===e[0]);if(t.filter(e=>"r"===e[0]).map(t=>e.children[t[2]]).forEach(e=>re(e)),0!==i.length)for(var s=i.shift(),o=s[2],l=(P(e.children[o],n[s[2]],s[1],0,a,e,r),0);l<i.length;l++)s=i[l],P(e.children[o],n[s[2]],s[1],s[2]-o,a,e,r),o=s[2]}}(e,c,l,n().renderFn,n().onRenderFn),function(e,t){e.get().loading?t.update(!1,!0):(e.get().loading=!0,t.update(!1,!0),e.get().loading=!1)}(a,t),r)return c.filter(e=>"a"==e[0]).map(e=>parseInt(e[1]))}function R(e,t,n,a){var r=arguments.length>4&&void 0!==arguments[4]&&arguments[4],i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0,o=e.get(),l=t.getContainer().children,c=T(l,a||o.hoveredListItemId);c<0||(o.limit+o.offset<c?e.setState({offset:c-o.limit+1}).then(D.bind(null,t.getContainer(),t,n)):Promise.resolve()).then(()=>{var e=l[c],n=t.scrollTop(),a=t.getScrollHeight(),o=e.offsetHeight;i="center"===i?-.5*t.getScrollHeight():i,s="center"===s?a/2:s;var d=r?function(e){t.smoothScroll(e-t.scrollTop())}:t.scrollTop.bind(t),u=n+i>e.offsetTop,g=o+e.offsetTop>n+a-s;u?d(e.offsetTop-i):g&&d(e.offsetTop-a+o+s)})}function x(e,t){if(e.get().loading||e.get().stop||!e.get().activated)return Promise.resolve([]);e.get().loading=!0;for(var n=arguments.length,a=new Array(n>2?n-2:0),r=2;r<n;r++)a[r-2]=arguments[r];return t(...a).then(()=>{e.get().loading=!1})}function B(e,t,n){return n.scrolls||(n.scrolls={}),n.scrolls[e]&&!t||(n.scrolls[e]={scrolled:n.scrolled||0,scrollItem:n.scrollItem}),Promise.resolve(n)}function H(e,t,n,a){var i=e.get(),s=i.elements,o=a.getContainer(),l=e.setState({offset:i.offset+i.limit}).then(()=>{var n,r=i.offset,l=i.limit;return l+r>s.length?n=t().more(r,l).then(t=>!1===t?[]:(0===t.length&&e.setState({stop:!0}),t)).then(U.bind(null,e,o,a,t,i.pipeId)):(n=Promise.resolve(),D(o,a,t,e)),n});if(!n){var c=s.length>0?"im-preloader_fixed-bottom":"im-preloader_fixed-center";Object(r.wrapLoading)(o)(l,"bottom",c)}return l}function F(e,t){var n=e.get().pipeId;return!(void 0!==n&&void 0!==t&&n!==t)}function U(e,t,n,a,r,i){return!!F(e,r)&&e.setState(function(e,t,n){var a=e.filter(e=>!n.ids[t(e)]);return{_sortedEls:!1,els:a,ids:w(a,t,n.ids),elements:n.elements.concat(a)}}(i,a().idFn,e.get())).then(D.bind(null,t,n,a))}function G(e,t,n){var a=x.bind(null,t,H.bind(null,t,n)),r=(e,a)=>{(t.get().activated||e)&&(void 0!==a&&t.get().elements.length>0&&t.setState({scrolled:a}),n().onScroll&&n().onScroll())},i=Object(E.createScroll)(e,{noScroll:t.get().noScroll,nativeScroll:t.get().nativeScroll,scrollChange:r.bind(null,!1),more:!!n().more&&a.bind(null,!1)}),s=Object(p.createModule)({handlers:(a,r)=>{r(e,"click",t.get().elCls,n().onClick)}});return t.setState(L(n().idFn,{},t)),{pipe:(e,a)=>(t.setState({pipeId:a}),e.then(U.bind(null,t,i.getContainer(),i,n,a))),replacePreserveOrder:e=>t.set(M.bind(null,e,n().idFn)).then(D.bind(null,i.getContainer(),i,n)),pipeReplace(e,a){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return t.setState({pipeId:a,stop:!1}),e.then(e=>{if(F(t,a))return t.setState({elements:e,_sortedEls:!1,ids:w(e,n().idFn,{})}).then(D.bind(null,i.getContainer(),i,n,t,r))})},wipe(){i.getContainer().innerHTML=""},deactivate(){t.setState({activated:!1})},activate(){t.setState({activated:!0})},saveScroll:(e,n)=>t.set(B.bind(null,e,n)),updateScroll(){i.update(!1,!0)},toTop(e){arguments.length>1&&void 0!==arguments[1]&&arguments[1]?i.smoothScroll(-i.scrollTop()):i.scrollTop(0),e&&r(e,0)},scrollTop:e=>i.scrollTop(e),restoreScroll(e){var n=t.get().scrolls,a=n[e];return a&&(t.setState({scrolls:extend({},n,{[e]:null})}),i.scrollTop(a.scrolled)),!!a},unsetScroll(e){t.setState({scrolls:extend({},t.get().scrolls,{[e]:null})})},scrollPage(e,t){var n=i.scroll.scroller,a=i.scrollTop(),r=a+("up"===e?-1:1)*n.clientHeight;t?i.smoothScroll(r-a):i.scrollTop(r)},scrollToElement(e,a,r,s){R(t,i,n,e,a,r,s)},getScroller:()=>i.getScroller(),checkMore:e=>t.get().elements.length<t.get().limit?a(e,i):Promise.resolve([]),add:(e,a)=>U(t,i.getContainer(),i,n,a,e),hoverNextElement(e,a){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},s=i.getContainer(),o=s.children,l=T(o,t.get().hoveredListItemId||A(s,a)),c=Object(_.toArray)(o).slice(l+1).find(n().hoverableFn);S(t,s,c,e),R(t,i,n,null,!1,r.top,r.bottom)},hoverPrevElement(e,a){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},s=i.getContainer(),o=s.children,l=T(o,t.get().hoveredListItemId||A(s,a)),c=l>=0&&Object(_.toArray)(o).slice(0,l).reverse().find(n().hoverableFn);S(t,s,c,e),R(t,i,n,null,!1,r.top,r.bottom)},hoverFirstElement(e,a){var r=i.getContainer(),s=r.children,o=Object(_.toArray)(s).findIndex(n().hoverableFn),l=s[o];!t.get().hoveredListItemId&&l&&(S(t,r,l,e),R(t,i,n,o,!1,a.top,a.bottom))},hoverElement(e,a,r){var s=i.getContainer(),o=s.children,l=T(o,e),c=o[l];c&&(S(t,s,c,a),R(t,i,n,l,!1,r.top,r.bottom))},unhoverElements(e){I(t,i.getContainer(),e)},reset(){var e=t.get().scrolls;t.reset(),t.setState(L(n().idFn,e,t))},getHoveredElement:()=>j(i.getContainer().children,t.get().hoveredListItemId),getCurrentElements:()=>t.get().elements,isLoading:()=>t.get().loading,isEmpty:()=>0===t.get().elements.length,remove(e){t.set(k.bind(null,e,n().idFn)).then(D.bind(null,i.getContainer(),i,n))},unmount(){Object(p.destroyModule)(s),i.destroy()}}}var q=n("1y80"),V=n("86+7"),W=n("lJdi");function K(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var n=[],a=!0,r=!1,i=void 0;try{for(var s,o=e[Symbol.iterator]();!(a=(s=o.next()).done)&&(n.push(s.value),!t||n.length!==t);a=!0);}catch(e){r=!0,i=e}finally{try{a||null==o.return||o.return()}finally{if(r)throw i}}return n}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return Y(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Y(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Y(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,a=new Array(t);n<t;n++)a[n]=e[n];return a}var $=["_im_dialog_selected","nim-dialog_selected"],z=["_im_dialog_hovered","nim-dialog_hovered"];function X(e,t,n){removeClass(t.parentNode,"im-page--dialogs_with-mess");var a=n.getCurrentElements().filter(e=>e.message);n.toTop(),n.reset(),Object(q.statlogsProbValueEvent)(.01,"im_search_stat",1,"search_messages_only"),a.length>0?(a=[{type:"sep_messages"}].concat(a),e.setState({searchOnlyMessages:!0})):a=[je()],n.pipeReplace(Promise.resolve(a))}function Q(e){return hasClass(e,"_im_search")}function Z(e,t,n,s){if(Object(i.isSearching)(e)&&e.get().searchAllLoaded||Object(i.isRecentSearchesActive)(e))return Promise.resolve([]);if(e.get().dialog_search_going||Object(r.isClassicInterface)(e)&&0!==e.get().peer)return Promise.resolve(!1);if(Object(i.isSearching)(e))return Object(a.searchMessages)(Object(i.getSearchText)(e),e.get()).then(e=>{var t=K(e,2),n=t[0];return Ee(t[1],n)});var o=e.get().active_tab,l=e.get().dialog_tabs_all;return o!==y.FOLDER_MESSAGE_REQUEST&&l[y.FOLDER_ALL]&&!Object(r.isReversedDialogs)(e)||l[o]?0===Fe(e).length?Object(i.isMessageRequestFolder)(e)?Promise.resolve([{type:"message_request_notice"},{type:"empty_message_requests"}]):Promise.resolve([{type:"empty_dialogs"}]):Promise.resolve([]):e.set(a.loadDialogs).then(t=>{var n=Fe(e);return 0===n.length?Object(i.isMessageRequestFolder)(e)?Promise.resolve([{type:"message_request_notice"},{type:"empty_message_requests"}]):[{type:"empty_dialogs"}]:n})}function J(e,t,n,s,o,l){var c=gpeByClass("_im_peer_target",o.target)&&checkEvent(o),d=Object(r.isCommunityInterface)(n)&&gpeByClass("_im_dialog_peer_tags",o.target);if(!c&&!d){var u=n.get(),g=Q(l),m=parseInt(domData(l,"peer"),10),_=parseInt(domData(l,"msgid"),10),p=Object(i.getTab)(n,m);if(function(e,t){return e.get().active_tab===y.FOLDER_MESSAGE_REQUEST&&Object(i.tabIsMessageRequestToChat)(t)}(n,p))return t().showInvitationBox(n,m),cancelEvent(o);var f="";if(Object(i.isSearching)(n)&&(f="conversations_search"),Object(i.isRecentSearchesActive)(n)&&(f="recent_searches"),hasClass(l,"_im_sugg_"+m)&&(f="popular_suggestions"),g&&(f="message_search"),checkEvent(o))return window.open(function(e,t,n){var a=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i=Object(r.getBaseLink)(e),s=()=>`${i}?sel=${Object(r.convertPeerToUrl)(t.peerId)}${a&&n?"&msgid="+n:""}`;if(a)return s();if(Object(r.isUserPeer)(t.peerId)||Object(r.isCommunityPeer)(t.peerId))return Object(r.isClassicInterface)(e)?s():t.href;return s()}(n,p,_,g));if(s.saveScroll("list"),g&&u.msgid!==_)u.longpoll.push([h.changePeer(m,_,!1,!1,f)]);else if(m!==u.peer){u.longpoll.push([h.changePeer(m,!1,!0,!0,f)]);var b=Object(i.isSearching)(n);b&&!hasClass(l,"_dont_add_recent")&&Object(a.saveRecentSearchPeer)(m,cur.imDb),b&&p&&!Object(r.isClassicInterface)(n)&&setTimeout(()=>{var e=p.message?p.message.messageId:p.peerId;s.scrollToElement(e.toString(),!0,0,"center")},100)}else m===u.peer&&e().goToHistoryEnd();cancelEvent(o)}}function ee(e,t,n,a){var s,o="string"==typeof n.photo&&""!==n.photo,l=Object(r.isContactPeer)(t),c=n.tab||n.name,d=l?Object(r.prepareContactName)(c):c;if(Object(r.isChatPeer)(t)&&!o)s=Object(r.renderPhotosFromTab)(e,n,!a);else{if(l){var u=Object(r.getUserInitials)(c);s=`<div class="nim-peer--contact-avatar nim-peer--contact-avatar_${Object(i.isSearching)(e)&&!n.message?34:a?50:46}">${u}</div>`}else s=`<img src="${n.photo}" alt="">`;a&&(s=getTemplate("im_dialogs_link_img",{href:n.href||n.link,photo:s}))}return{photo:s,userLink:`<span class="_im_dialog_link">${d}</span>`}}function te(e){return!Object(r.isPendingForward)(e)}function ne(e,t,n,a){return n?"":a?getTemplate("im_img_prebody",{photo:t}):e+":"}function ae(e,t,n,a,s,o,l,c,d,u){var g="",m=Object(i.isChannelPeer)(Object(i.getTab)(e,n));return t&h.FLAG_OUTBOUND?g=ne(getLang("mail_by_you"),u,m,d):Object(r.isChatPeer)(n)&&0!==a&&(g=ne(Object(V.oCacheGet)(e,a).first_name,Object(V.oCacheGet)(e,a).photo,m,d)),l=Object(r.renderShortText)(n,c,l,s,o),g?getTemplate("im_drow_prebody",{prebody:g,body:l}):l}function ie(e,t,n,a){var s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{},o=[];return Object(r.isClassicInterface)(a)&&o.push("nim-dialog_classic"),Object(i.isRecentSearchesActive)(a)&&o.push("nim-dialog_recent"),o.push("nim-dialog_empty"),s.search&&o.push("_im_search"),getTemplate("im_drow",{peer:e.peerId,msg_id:"",photo:t,user_link:n,date:"",body:"",unread:"",more:o.join(" "),is_star:"",unread_message_string:"",is_online:onlinePlatformClass(e.online),is_unread:"",is_unread_out:"",is_selected:e.peerId==a.get().peer?"nim-dialog_selected _im_dialog_selected":""})}function oe(e,t,n){return!!(n&h.FLAG_OUTBOUND)&&(!Object(r.isSelfMessage)(t.peerId,e.get().gid)&&(!(Object(r.isChatPeer)(t.peerId)&&t.data&&t.data.closed)&&(!t.unread&&!(!t.lastmsg||t.lastmsg<=t.out_up_to))))}function le(e){var t=fe(e);return!!(e.unread>0&&t)||!!Object(i.isTabMarkedUnread)(e)}function de(e){return!(!e.mentions||!e.mentions.length)}function ue(e){return function(e){return!(!e.expiring_messages||!e.expiring_messages.length)}(e)&&!de(e)}function me(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},o=n||fe(t),l=ee(e,t.peerId,t,Object(r.isClassicInterface)(e)),c=l.photo,d=l.userLink;if(!o)return ie(t,c,d,e,a);var u=o.flags,g=Object(r.isFvkcomgroup)(e,t.peerId),m=Object(i.tabIsMessageRequestToChat)(t),_=Object(i.isCasperChat)(e,t.peerId),p=Object(r.isContactPeer)(t.peerId),f=he(t,e,n),b=Object(i.isCommunityChat)(e,t.peerId),v=[];a.search&&v.push("_im_search","nim-dialog_search"),inArray(t.peerId,e.get().mutedPeers)&&v.push("nim-dialog_muted"),t.verified&&v.push("nim-dialog_verified"),_&&v.push("nim-dialog_casper"),Object(i.isRecentSearchesActive)(e)&&v.push("nim-dialog_recent"),Object(s.isMessageEmpty)(o)&&!_&&v.push("nim-dialog_empty"),Object(r.isClassicInterface)(e)&&v.push("nim-dialog_classic"),t.folders&h.FOLDER_IMPORTANT&&v.push("nim-dialog_starred"),!a.search&&Object(r.isUnrespond)(e,t.peerId,t)&&v.push("nim-dialog_unrespond"),(g||b)&&e.get().gid&&v.push("nim-dialog_deny-remove"),de(t)&&v.push("nim-dialog_unread-mentions"),ue(t)&&v.push("nim-dialog_unread-expiring"),t.callInProgress&&v.push("nim-dialog_active-call"),t.callInProgress&&t.callInProgress.participants.count<1&&v.push("nim-dialog_active-call-empty");var O=Object(i.tabIsMessageRequestToChat)(t)?t.mr&&t.mr.request_date:o.date,y=e.get().timeshift,C=O?getShortDateOrTime(O,y,!0,getLang("months_sm_of","raw")):"",E=!oe(e,t,u)||m||Object(i.isSearching)(e)?"":"nim-dialog_unread-out",j=t.unread>0?getLang("mail_im_new_messages",t.unread):"",T=p?Object(r.prepareContactName)(t.tab):t.tab;return getTemplate("im_drow",{peer:t.peerId,msg_id:o.messageId,photo:c,user_link:d,date:C,body:f,unread_message_string:j,tab_name:stripHTML(T),unread:Object(r.simplifyCounter)(t.unread),more:v.join(" "),is_online:onlinePlatformClass(t.online),is_unread:le(t)?"nim-dialog_unread":"",is_unread_out:E,is_selected:a.noselect||m||t.peerId!=e.get().peer?"":"nim-dialog_selected _im_dialog_selected"})}function _e(e,t,n,a,o){if(!t.deletedDialog)if(hasClass(e,"nim-conversation-search-row"))pe(e,t,n);else{var l=n.get(),c=fe(t),d=c.flags,u=he(t,n),g=ee(n,t.peerId,t,Object(r.isClassicInterface)(n)),m=g.photo,p=g.userLink,f=n.get().timeshift,b=c.date?getShortDateOrTime(c.date,f,!0,getLang("months_sm_of","raw")):"";we(e,t),val(geByClass1("_dialog_body",e),u),val(geByClass1("_im_dialog_date",e),b),val(geByClass1("_im_dialog_unread_ct",e),Object(r.simplifyCounter)(t.unread));var v=geByClass1("_im_dialog_link",e);v&&val(v.parentNode,p);var O=geByClass1("_im_dialog_photo",e);O.innerHTML!==m&&val(O,m),l.is_peer_profile_enabled&&(l.peer||Re(e,n));var y=Object(i.isCasperChat)(n,t.peerId);toggleClass(e,"nim-dialog_verified",!!t.verified),toggleClass(e,"nim-dialog_casper",y),toggleClass(e,"nim-dialog_muted",inArray(t.peerId,n.get().mutedPeers)),toggleClass(e,"nim-dialog_unrespond",Object(r.isUnrespond)(n,t.peerId,t)),toggleClass(e,"nim-dialog_classic",Object(r.isClassicInterface)(n)),toggleClass(e,"nim-dialog_unread",le(t)),toggleClass(e,"nim-dialog_unread-mentions",de(t)),toggleClass(e,"nim-dialog_unread-expiring",ue(t)),toggleClass(e,"nim-dialog_active-call",!!t.callInProgress),toggleClass(e,"nim-dialog_active-call-empty",!!t.callInProgress&&t.callInProgress.participants.count<1),toggleClass(e,"nim-dialog_deny-remove",n.get().gid>0&&(Object(r.isFvkcomgroup)(n,t.peerId)||Object(i.isCommunityChat)(n,t.peerId))),removeClass(e,"nim-dialog_failed"),removeClass(e,"nim-dialog_deleted"),addClass(e,"_im_dialog"),Object(_.toggleOnline)(geByClass1("_im_peer_online",e),t.online),toggleClass(e,"nim-dialog_recent",Object(i.isRecentSearchesActive)(n)),toggleClass(e,"nim-dialog_empty",Object(s.isMessageEmpty)(c)&&!y),toggleClass(e,"nim-dialog_unread-out",oe(n,t,d)&&!Object(i.isSearching)(n)),De(e),toggleClass(e,"nim-dialog_starred",t.folders&h.FOLDER_IMPORTANT),o&&setTimeout((function(){addClass(geByClass1("_im_dialog_"+t.peerId,a),"nim-dialog_injected")}),100)}}function pe(e,t,n){we(e,t),toggleClass(e,"nim-dialog_recent",Object(i.isRecentSearchesActive)(n)),val(geByClass1("_im_dialog_unread_ct",e),Object(r.simplifyCounter)(t.unread)),toggleClass(e,"nim-dialog_unread",le(t)),toggleClass(e,"nim-dialog_unread-expiring",ue(t)),toggleClass(e,"nim-dialog_unread-mentions",de(t));var a=ee(n,t.peerId,t,Object(r.isClassicInterface)(n)).photo,s=geByClass1("_im_dialog_photo",e);s.innerHTML!==a&&val(s,a),Object(_.toggleOnline)(geByClass1("_im_peer_online",e),t.online)}function he(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],a=n||fe(e),o=Object(i.tabIsMessageRequestToChat)(e),l=Object(i.isCasperChat)(t,e.peerId);if(o){var c=Object(r.isClassicInterface)(t),d=e.mr&&e.mr.inviter_id,u=Object(V.oCacheGet)(t,d),g=c?u.name:u.short_name,m=c?getTemplate("im_img_prebody",{photo:u.photo}):"",_=getLang("mail_mr_service_message").replace(/{user}/,g);return m+_}if(Object(r.isPeerBlocked)(e.peerId,t)){var p=t.get().block_states[e.peerId].name,h=getLang("mail_community_answering").replace("{username}",p);return getTemplate("im_drow_prebody",{prebody:h,body:""})}return Object(s.isServiceMsg)(a)&&!o?Object(r.renderServiceMsg)(t,a,e,!1):l&&Object(s.isMessageEmpty)(a)?getLang("mail_empty_casper_message"):Object(s.isExpiredCasperMessage)(a)?getLang("mail_expired_message"):ae(t,a.flags,e.peerId,a.userId,!0,a.attaches,a.text,a.subject,Object(r.isClassicInterface)(t),Object(V.oCacheGet)(t,t.get().id).photo)}function fe(e){var t=e.lastmsg_meta;return isArray(t)&&(t=h.addMessageEvent([4].concat(t))),t||h.addMessageEvent([4,-1,0,e.peer,0,"",{},{},-1,-1,0])}function be(e,t,n){var s=Object(i.getTab)(e,t),o=Object(i.tabIsMessageRequestToChat)(s),l=Object(r.showLeaveDialog)(e,t,i=>{n().updateMenu(e);var s=Promise.resolve();Object(r.isChatPeer)(t)&&(s=o?e.set(a.rejectMessageRequest.bind(null,t)):e.set(a.leaveChat.bind(null,t))),i&&s.then(()=>Object(r.cleanHistory)(e,l,n,a.flushHistory,t)),l.hide()})}function ve(e,t,n,i,s,o){var l=gpeByClass("_im_dialog",o,n);if(cancelEvent(s),!l)return!1;var c=intval(domData(l,"peer")),d=t.get(),u=Object(r.isCommunityPeer)(c)||Object(r.isUserPeer)(c);if(d.recentSearch){var g=Object(a.removeFromRecentSearch)(c,cur.imDb);re(l),0===g.length&&Pe(t,i,e)}else Object(r.isClassicInterface)(t)&&u?Object(a.deleteDialog)(c,d).then(n=>{var a=K(n,2),r=a[0],i=a[1];r?(!function(e,t,n,a,r){var i=geByClass1("_dialog_body",t);addClass(t,"nim-dialog_deleted"),removeClass(t,"_im_dialog"),val(i,getTemplate("im_delete_actions",{text:langNumeric(n,getLang("mail_im_X_message_deleted","raw")),peer:e,spam_id:a}))}(c,l,r,i),e().updateMenu(t)):be(t,c,e)}):be(t,c,e);return!1}function Oe(e,t){Object(r.toggleMessageRequestsTab)(e,t,a.changeDialogsTab)}function ye(e,t){switch(t.type){case"sep_btn_search_msg":return Object(r.renderBtnSearchOnlyMessages)(e);case"sep_messages":return Object(r.renderMessagesSep)();case"sep_conversations":return Object(r.renderConversationsSep)();case"sep_popular":return Object(r.renderPopularSuggSep)();case"popular_sugg":return Object(r.renderPopularSuggestions)(e);case"clear_recent":return Object(r.renderClearRecent)();case"empty_dialogs":return getTemplate("im_dialogs_none",{msg:getLang("mail_dialogs_list_empty")});case"empty_message_requests":return getTemplate("im_dialogs_none",{msg:getLang("mail_dialogs_mr_empty")});case"empty":return getTemplate("im_dialogs_none",{msg:getLang("mail_im_search_empty")});case"message_request_notice":return getTemplate("im_dialogs_message_requests_notice",{msg:getLang("mail_message_request_tab_notice")});case"message_request_button_go":return getTemplate("im_dialogs_message_requests_button",{msg:getLang("mail_tab_mr")});case"message_request_button_return":return getTemplate("im_dialogs_message_requests_button",{msg:getLang("mail_go_to_all_tab")});default:return t.message?me(e,t,t.message,{noselect:!0,search:!0}):t.local_index||Object(i.isSearching)(e)?function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",a=ee(e,t.peerId,t,Object(r.isClassicInterface)(e)),s=a.photo,o=a.userLink,l=te(e),c=""===n?[]:[n];return Object(i.isRecentSearchesActive)(e)&&c.push("nim-dialog_recent"),Object(r.isClassicInterface)(e)&&c.push("nim-csr_classic"),inArray(t.peerId,e.get().mutedPeers)&&c.push("nim-dialog_muted"),Object(i.isCasperChatTab)(t)&&c.push("nim-dialog_casper"),de(t)&&c.push("nim-dialog_unread-mentions"),ue(t)&&c.push("nim-dialog_unread_expiring"),getTemplate("im_conversation_search_row",{peer:t.peerId,msg_id:t.lastmsg||"",photo:s,user_link:o,unread:Object(r.simplifyCounter)(t.unread),tab_name:stripHTML(name),is_unread:le(t)?"nim-dialog_unread":"",is_online:onlinePlatformClass(t.online),is_selected:t.peerId==e.get().peer&&l?"nim-dialog_selected _im_dialog_selected":"",more:c.join(" ")})}(e,t):me(e,t)}}function Ce(e,t,n,i,s,o){var l=intval(domData(o,"peer")),c=domData(o,"action"),d=domData(o,"sid"),u=geByClass1("_im_dialog_"+l,t),g=intval(domData(o,"spam"));switch(c){case"restore":u&&e.set(a.restoreDialog.bind(null,l,d,g)).then(()=>{addClass(u,"_im_dialog"),removeClass(u,"nim-dialog_deleted"),_e(u,e.get().tabs[l],e,t,!1),i().updateMenu(e)});break;case"spam":var m=`${getLang("mail_im_dialog_marked_spam")}\n        <button type="button" class="nim-dialog--daction nim-dialog--daction_last _im_dialog_daction"\n          data-action="restore"\n          data-spam="1"\n          data-sid="${d}" data-peer="${l}">\n            ${getLang("mail_restore")}\n        </button>`;if(u){var _=geByClass1("_dialog_body",u);val(_,m),Object(a.spamDialog)(l,d,e.get())}break;case"block":(Object(r.isCommunityInterface)(e)?Object(r.showBlacklistBox)(l,e):Object(r.showBlacklistBoxUser)(l,e)).once("success",(function(){e.set(a.flushHistory.bind(null,l)).then(()=>{n().restoreDialogs(e)})}))}cancelEvent(s)}function Ee(e,t){return e.map(e=>h.addMessageEvent([4].concat(e))).map(e=>extend({},t[e.peerId],{message:e}))}function je(e){return{type:"empty",lang:e}}function Te(e,t){var n=e.get().msg_local_ids_sort,a=n&&n[t.lastmsg];return void 0!==a?2e9+a:t.minor_sort_id}function Se(e,t,n,r){var i=gpeByClass("_im_dialog",r,t),s=intval(domData(i,"peer"));return e.set(a.toggleDialogImportant.bind(null,s)),setTimeout((function(){Ae(e,t,n,r)}),100),cancelEvent(n),!1}function Ie(e,t,n){var a=t.major_sort_id||0,i=n.major_sort_id||0,s=a!==i?i-a:Te(e,n)-Te(e,t);return s=Object(r.isReversedDialogs)(e)?-s:s}function Ae(e,t,n,a){Object(l.showTooltip)(a,{text:function(){var n=gpeByClass("_im_dialog",a,t),r=domData(n,"peer");return e.get().tabs[r].folders&h.FOLDER_IMPORTANT?getLang("mail_im_toggle_important_off"):getLang("mail_im_toggle_important")},black:1,zIndex:1,shift:[14,8],toup:Ue(e,a.getBoundingClientRect().top)})}function we(e,t){var n=t.unread>0?getLang("mail_im_new_messages",t.unread):"",a=geByClass1("_im_unread_blind_label",e);val(a,n)}function Le(e,t,n,r,s){var o=gpeByClass("_im_dialog",s,t),l=intval(domData(o,"peer")),c=e.get().tabs[l].lastmsg;return e.set(a.markDialogAnswered.bind(null,l,c)).then(()=>{_e(o,e.get().tabs[l],e,t),Object(i.isRecentSearchesActive)(e)||n().restoreDialogs(e)}),showDoneBox(getLang("mail_marked_as_answered"),{out:1e3}),cancelEvent(r),!1}function ke(e){var t=Object(i.isSearching)(e),n=e.get().searchOnlyMessages;return Object(r.isClassicInterface)(e)?{top:t&&!n?96:60,bottom:Object(r.isCommunityInterface)(e)?42:87}:{top:t&&!n?36:0,bottom:0}}function Me(e,t){e.hoverFirstElement(z,ke(t))}function Ne(e){e.unhoverElements(z)}function Pe(e,t,n){if(Object(i.doPopularSuggExist)(e)){t.pipeReplace(Promise.resolve([{type:"sep_popular"},{type:"popular_sugg"}])),t.toTop()}else n().cancelSearch(e),cancelStackFilter("im_search")}function De(e){var t=geByClass1("_im_dialog_star",e),n=geByClass1("_im_dialog_date",e);if(t&&n){var a=n.offsetWidth;t.style.right=15+a+14+"px"}}function Re(e,t){var n=t.get(),a=parseInt(domData(e,"peer")),s=Object(i.getTab)(n,a);if(n.is_peer_profile_enabled&&Object(r.isCommunityInterface)(n)&&s&&!Object(i.isChannelPeer)(s)&&!Object(i.isCommunityChat)(n,a)){var l=geByClass1("_im_dialog_peer_tags",e);if(s.ad_id||n.peer_profile_tags&&s.peer_tags){var c=s.peerTagsMaxWidth||0;if(!c){var u=geByClass1("_im_dialog_name_w",e).offsetWidth;c=340-(u+6+(s.verified?16:0)),t.set(e=>(e.tabs[a].peerTagsMaxWidth=c,Promise.resolve(e)))}!function(e,t,n,a){if(t<69)e.innerHTML="";else{e.style.maxWidth=t+"px";var r=n.get(),s=Object(i.getTab)(r,a),l=m(r,s);if(l.length){var c=d(g(l,t),2),u=c[0],_=c[1],p=u.reduce((e,t)=>(t.isAdTag?e+=getTemplate("sImPeerTagsAdTag",{ad_tag_text:t.adTagText,url:`ads?act=office&union_id=${s.ad_id}&utm_medium=community_messages_ad_tag&utm_source=dialog`,extra_class:s.has_ad_access?"PeerTagsItem--hasAdAccess":""}):e+=getTemplate("sImPeerTagsItem",{name:t.name,color:t.color}),e),""),h=_.length,f="+"+Object(o.getLang)("mail_im_peer_profile_extra_tags",h);h&&(p+=getTemplate("sImPeerTagsExtra",{text:f})),e.innerHTML=p}else e.innerHTML=""}}(l,c,t,a)}else l.innerHTML&&(l.innerHTML="")}}function xe(e,t){hasClass(t,"_im_dialog")&&(Object(r.isCommunityInterface)(e)&&De(t),Re(t,e))}function Be(e){checkEvent(e)||cancelEvent(e)}function He(e,t,n,s,o){return{selectPeer(t,n){for(var a=geByClass("_im_dialog",e),r=n.get().peer,i=0;i<a.length;i++){var s=a[i],o=intval(domData(s,"peer")),l=intval(domData(s,"msgid"));o===r&&(!Q(s)||t===l&&Q(s))?(addClass(s,"nim-dialog_selected"),addClass(s,"_im_dialog_selected")):hasClass(s,"_im_dialog_selected")&&(removeClass(s,"nim-dialog_selected"),removeClass(s,"_im_dialog_selected"))}},appendFastDialogs(t,a,s){removeClass(e.parentNode,"im-page--dialogs_with-mess"),n.saveScroll("list"),s?(n.reset(),Object(r.isPendingForward)(t)||Object(i.isRecentSearchesActive)(t)||!v(a)?Object(i.isRecentSearchesActive)(t)&&(v(a)&&(a=[{type:"clear_recent"}].concat(a)),Object(i.doPopularSuggExist)(t)&&(a=[{type:"sep_popular"},{type:"popular_sugg"}].concat(a))):a=[{type:"sep_btn_search_msg"},{type:"sep_conversations"}].concat(a),t.setState({searchOnlyMessages:!1}),n.pipeReplace(Promise.resolve(a)).then(()=>Me(n,t))):n.pipe(Promise.resolve(a)),Object(r.isClassicInterface)(t)&&!Object(r.isReservedPeer)(t.get().peer)||n.toTop()},deactivate(){n.deactivate()},activate(){n.activate()},hoverFirstDialog(e){Me(n,e)},hoverNextDialog(e){n.hoverNextElement(z,$,ke(e))},hoverPrevDialog(e){n.hoverPrevElement(z,$,ke(e))},unhoverDialogs:Ne.bind(n),selectHoveredDialog(t){var a=geByClass1("_im_dialog_hovered",e);a||(a=geByClass1("_im_dialog",e)),a&&J(s,this,t,n,{},a)},appendSearch(t,a,r){var i=Ee(r,a);r.length>0?(addClass(e.parentNode,"im-page--dialogs_with-mess"),n.pipe(Promise.resolve([{type:"sep_messages"}].concat(i))).then(()=>Me(n,t))):(0===n.getCurrentElements().length&&n.pipeReplace(Promise.resolve([je()])),removeClass(e.parentNode,"im-page--dialogs_with-mess"))},update(e){n.pipeReplace(Promise.resolve(Fe(e)))},updateDialog(t,n){var a=geByClass1("_im_dialog_"+t,e);a&&!Q(a)&&_e(a,Object(i.getTab)(n,t),n,e)},focusOnSelected(t){var a=t.get().peer;if(a){var r=geByClass1("_im_dialog_"+a,e);r?n.scrollTop(r.offsetTop-r.offsetHeight):n.toTop()}},restoreScroll(e){n.restoreScroll("list")||n.toTop()},forceScrollReinit(){var e=n.getScroller();e&&(e.style.overflowY="hidden",setTimeout(()=>e.style.overflowY="",0))},restoreDialogs:(t,a,i)=>(removeClass(e.parentNode,"im-page--dialogs_with-mess"),t.setState({searchOnlyMessages:!1}),0!==Fe(t).length||n.isLoading()||(a=!0),a&&n.reset(),i&&n.wipe(),n.pipeReplace(Promise.resolve(Fe(t))).then(()=>{if(a&&(!Object(r.isClassicInterface)(t)||!t.get().peer)){var e=function(e,t,n){return Object(r.isClassicInterface)(n)||t().toggleSettingsLoader(n,!0),e.checkMore(!Object(r.isClassicInterface)(n)).then(()=>{Object(r.isClassicInterface)(n)||t().toggleSettingsLoader(n,!1)})}(n,s,t);return n.toTop(),e}}).then(()=>Ne(n))),appendDialogs(t,a){removeClass(e.parentNode,"im-page--dialogs_with-mess"),a.forEach(n=>{var a=geByClass1("_im_dialog_"+n.peerId,e);a&&pe(a,n,t)}),Object(r.isPendingForward)(t)||Object(i.isRecentSearchesActive)(t)||!v(a)||(a=[{type:"sep_btn_search_msg"},{type:"sep_conversations"}].concat(a)),t.setState({searchOnlyMessages:!1}),n.isEmpty()&&0===a.length&&Object(r.isPendingForward)(t)&&(a=[je(getLang("mail_im_search_empty_chats"))]),n.replacePreserveOrder(a)},updateCounter(t,n){var a=geByClass1("_im_dialog_"+n,e),s=Object(i.getTab)(t,n);if(a&&!Q(a)&&(we(a,s),val(geByClass1("_im_dialog_unread_ct",a),Object(r.simplifyCounter)(s.unread)),toggleClass(a,"nim-dialog_unread",le(s)),toggleClass(a,"nim-dialog_unread-out",oe(t,s,fe(s).flags)),toggleClass(a,"nim-dialog_unread-mentions",de(s)),toggleClass(a,"nim-dialog_unread-expiring",ue(s))),Object(i.isRecentSearchesActive)(t)){var o=geByClass1("_im_sugg_"+n,e);o&&(val(geByClass1("_sugg_unread_ct",o),Object(r.simplifyCounter)(s.unread)),toggleClass(o,"sugg-is_unread",s.unread>0))}},removeDialog(e,t){n.remove(t)},updateOnline(t,n){var a=geByClass1("_im_dialog_"+t,e);if(a){var r=n.get().tabs[t],i=geByClass1("_im_peer_online",a);Object(_.toggleOnline)(i,r.online)}},setDialogFailed(t,n,a){var r=geByClass1("_im_dialog_"+t,e);r&&(a.get().tabs[t].lastmsg===n&&(addClass(r,"nim-dialog_failed"),val(geByClass1("_im_dialog_unread_ct",r),"!")))},scrollUp(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];n.toTop(e,t),n.saveScroll("list",!0)},saveScroll(e){n.saveScroll("list",!0)},promoteDialog(a,r){var s=geByClass1("_im_dialog_"+r,e);s&&!Q(s)||!Object(i.isSearching)(a)?(n.pipeReplace(Promise.resolve(Fe(a)),void 0,!0).then(t=>{!inArray(r,t)&&s&&_e(s,Object(i.getTab)(a,r),a,e)}),t().updateTyping(r,a)):n.unsetScroll("list")},removeSelection(t){var a=t.get().peer.toString(),i=`._im_dialog_${a}.${$.join(".")}`,s=domQuery(i,e)[0];$.forEach(e=>removeClass(s,e)),Object(r.isClassicInterface)(t)||n.hoverElement(a,z,ke(t))},updateScroll(){n.updateScroll()},updateTyping(t,n){var a=geByClass1("_im_dialog_"+t,e);if(a&&!Q(a)&&!n.get().tabs[t].deletedDialog){var s=geByClass1("_im_dialog_typing",a),o=!Object(r.isClassicInterface)(n),l=Object(r.formatTyper)(Object(i.getTab)(n,t).activity,t,!Object(r.isChatPeer)(t),n.get(),1,o);val(s,l),toggleClass(a,"nim-dialog_typing",l)}},showInvitationBox(e,t){var n=()=>this.removeDialog(e,t),o=()=>Object(r.isClassicInterface)(e)&&s().updateMenu(e);return(Boolean(Object(i.getTab)(e,t))?Promise.resolve():e.set(a.loadPeer.bind(null,t,0,0,0))).then(()=>{var s=Object(i.getTab)(e,t);if(!Object(i.tabIsMessageRequestToChat)(s)){var l=h.changePeer(t,!1,!1,!1,"");return e.get().longpoll.push([l])}return Object(r.showInvitationBox)(e,{receiver_peer_id:t},a.leaveInvitation,!1,{updateList:n,updateMenu:o})})},updateStarPosition(){!function(e){geByClass("_im_dialog",e).forEach(e=>{De(e)})}(e)},renderPeerTags(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;n?Re(geByClass1("_im_dialog_"+n,e),t):function(e,t){var n=t.get();n.is_peer_profile_enabled&&Object(r.isCommunityInterface)(n)&&geByClass("_im_dialog",e).forEach(e=>{Re(e,t)})}(e,t)},unmount(){n.unmount(),Object(p.destroyModule)(o)}}}function Fe(e){var t=e.get(),n=t.active_tab,a=t.dialog_tabs[n],i=t.tabs,s=a.map(e=>i[""+e]).sort(Ie.bind(null,e)),o=t.dialog_tab_cts.mr;if(n===y.FOLDER_MESSAGE_REQUEST&&s.unshift({type:"message_request_notice"}),!Object(r.isClassicInterface)(e))switch(n){case y.FOLDER_ALL:o>0&&s.unshift({type:"message_request_button_go"});break;case y.FOLDER_MESSAGE_REQUEST:s.unshift({type:"message_request_button_return"})}return s}function Ue(e,t){return t>(e.get().gid?220:150)||Object(i.isSearching)(e)}function Ge(e,t,n,s){var o=Object(p.createMutations)(He),c=o.callMutations,u=o.bindMutations,h=function(e,n){Object(l.showTooltip)(n,{text:()=>{if(Object(i.isRecentSearchesActive)(t))return getLang("mail_hide_from_recent");var e=Number(n.getAttribute("data-peer")),a=Object(i.getTab)(t,e),s=Object(i.tabIsMessageRequestToChat)(a);return Object(r.isChatPeer)(e)&&!s?Object(W.doesChatTabHaveFlag)(Object(i.getTab)(t,e),1024)?getLang("mail_unfollow_channel"):Object(i.isChatActive)(a)?getLang("mail_leave_chat"):getLang("mail_delete"):getLang("mail_delete")},black:1,[Object(r.isClassicInterface)(t)?"center":"needLeft"]:!0,shift:Object(r.isClassicInterface)(t)?[-4,10]:[0,10],toup:Ue(t,n.getBoundingClientRect().top),zIndex:1})},f=function(e,n){Object(l.showTooltip)(n,{text:getLang("mail_end_conversation"),black:1,center:!0,zIndex:1,shift:[1,4],toup:Ue(t,n.getBoundingClientRect().top)})},b=Ae.bind(null,t,e),v=Se.bind(null,t,e),O=Le.bind(null,t,e,c),y={idFn:e=>function(e,t){return t.message?t.message.messageId:Object(i.isSearching)(e)&&t.peerId?t.peerId+"cr":t.peerId||t.type}(t,e),hoverableFn:e=>hasClass(e,"_im_dialog"),renderFn:ye.bind(null,t),more:Z.bind(null,t,c),onScroll:!!Object(r.isClassicInterface)(t)&&(()=>{(bodyNode.scrollTop||document.documentElement.scrollTop)<=0&&!layers.visible&&browser.safari?addClass(s,"im-page--header_static"):removeClass(s,"im-page--header_static")}),onRenderFn:xe.bind(null,t)},E=G(e,Object(C.default)({limit:40,offset:0,nativeScroll:!!Object(r.isClassicInterface)(t),height:64,elements:Fe(t)}),()=>y),j=J.bind(null,n,c,t,E),T=X.bind(null,t,e,E),S=Ce.bind(null,t,e,c,n),I=ve.bind(null,n,t,e,E),A=Oe.bind(null,t,n),w=Object(p.createModule)({handlers:(s,o)=>{o(e,"click","_im_dialog_close",I),o(e,"click","_im_dialog_markre",O),o(e,"click","_im_dialog_star",v),o(e,"click","_im_dialog",j),o(e,"click",r.MESSAGE_SEARCH_CLASS,T),o(e,"mouseover","_im_dialog_close",h),o(e,"mouseover","_im_dialog_markre",f),o(e,"click",r.CLEAR_RECENT_CLASS,()=>{Object(a.resetRecentSearch)(cur.imDb),Pe(t,E,n)}),o(e,"click",r.TOGGLE_MR_TAB,A),o(e,"mouseover","_im_dialog_star",b),o(e,"click","_im_dialog_daction",S),o(e,"click","_im_peer_target",Be),Object(r.isCommunityInterface)(t)&&t.get().is_peer_profile_enabled&&o(e,"mouseover","_im_peer_tags_extra",e=>function(e,t){var n=e.target,a=gpeByClass("_im_dialog",n),r=parseInt(domData(a,"peer")),s=t.get(),o=Object(i.getTab)(s,r),c=o.peerTagsMaxWidth;if(c){var u=d(g(m(s,o),c),2)[1].reduce((e,t)=>e+=getTemplate("sImPeerTagsExtraTooltipItem",{name:t.name,color:t.color}),"");Object(l.showTooltip)(n,{text:u,center:!0,dir:"bottom",className:"PeerTagsExtraTooltip",hasover:!0})}}(e,t)),s(e,"mouseover",Object(_.throttle)(E.unhoverElements.bind(E,z),100))}});return u(e,c,E,n,w)}n("KKXr"),n("hhXQ");var qe=n("O8ze"),Ve=n("/eGY"),We=n("RQ7Z"),Ke=n("EasH"),Ye=n("ZxpX"),$e=n("Wu9C"),ze=n("ZoqV"),Xe=n("q1tI"),Qe=n.n(Xe),Ze=n("i8i4"),Je=n("MCfn"),et=(n("17x9"),n("gqqU")),tt=n("PjZB"),nt=n("grKM"),at=n("FEsp"),rt=n("vRp6"),it=n("xGYt"),st=n("NsuH"),ot=n("ThPM"),lt=n("7hRE"),ct=n("gdug"),dt=n("6krn");function ut(){return(ut=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e}).apply(this,arguments)}function gt(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var n=[],a=!0,r=!1,i=void 0;try{for(var s,o=e[Symbol.iterator]();!(a=(s=o.next()).done)&&(n.push(s.value),!t||n.length!==t);a=!0);}catch(e){r=!0,i=e}finally{try{a||null==o.return||o.return()}finally{if(r)throw i}}return n}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return mt(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return mt(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function mt(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,a=new Array(t);n<t;n++)a[n]=e[n];return a}function _t(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},i=Object.keys(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var pt=Xe.useEffect,ht=Xe.useState,ft=dt.default.getLang,bt=e=>{var t,n=e.searchValue,a=e.isLoading,s=e.convos,o=e.mode,l=e.selectedConvos,c=e.store,d=e.onSearchValueChange,u=e.onSearchInputKeydown,g=e.onConvoSelect,m=e.onListLoadMore,_=e.searchInputGetter,p=e.className,h=_t(e,["searchValue","isLoading","convos","mode","selectedConvos","store","onSearchValueChange","onSearchInputKeydown","onConvoSelect","onListLoadMore","searchInputGetter","className"]),f=Object(Ye.classNames)("ConvoPicker",p),b=Xe.createRef(),v=gt(ht(0),2),O=v[0],C=v[1],E=o||"default",j=e=>{e!==O&&(C(e),T(e))},T=e=>{if(t){var n=s[e].peerId,a=t.querySelector(`[data-id="${n}"]`);if(a){var r=a.offsetTop,i=t.scrollTop;if(r<i)t.scrollTop=r;else{var o=t.offsetHeight,l=r+a.offsetHeight;l>i+o&&(t.scrollTop=l-o)}}}};return pt(()=>{_&&_(b.current.element)},[]),Xe.createElement("div",ut({className:f,onMouseLeave:()=>C(-1)},h),Xe.createElement(nt.BlockSearchInput,{value:n,onChange:d,onKeyDown:e=>{switch(e.which||e.keyCode){case y.ARROW_UP:j(Math.max(O-1,0)),e.preventDefault();break;case y.ARROW_DOWN:j(Math.min(O+1,s.length-1)),e.preventDefault();break;case y.ENTER:g(s[O].peerId),e.preventDefault()}u(e)},placeholder:ft("mail_top_search"),autoFocus:!0,key:"search",ref:b}),a&&Xe.createElement(at.default,{className:"ConvoPicker__stub",key:"loading"},Xe.createElement(tt.default,null)),!a&&0===s.length&&Xe.createElement(at.default,{className:"ConvoPicker__stub",key:"no-results"},ft("mail_im_search_empty_chats")),!a&&s.length>0&&Xe.createElement(rt.default,{virtualized:!0,className:"ConvoPicker__results",loadMore:m,hasMore:!1,ref:e=>t=Ze.findDOMNode(e),key:"results"},s.map((e,t)=>{var n=e.peerId,a=e.name,s=e.photo,o=e.online,d=Object(i.getTab)(c,n),u=(d||{}).online||o,m=d&&Object(i.isCasperChatTab)(d)?`<span class="ConvoPicker__resultTitle ConvoPicker__resultTitle--casper">\n                    <span class="ConvoPicker__resultTitleText">\n                      ${a}\n                    </span>\n                  </span>`:a,_="radio"===E?Xe.createElement("span",{className:Object(Ye.classNames)("ConvoPicker__radio",{"ConvoPicker__radio--selected":l.includes(n)})}):"",p=Array.isArray(s)?Xe.createElement(ot.default,{photos:s}):Xe.createElement(lt.default,{isOnline:!!u,isMobile:!!ct.mobPlatforms[u],title:a,photo:s,onlineSize:"s"});return Xe.createElement(it.default,{key:n,"data-id":n,active:t===O,canBeHovered:!1,chevron:"default"===E,aside:_,onClick:()=>g(n),onMouseEnter:()=>C(t)},Xe.createElement(st.default,{size:"34",title:m,photo:p,description:d&&Object(r.getChatMemberCount)(d)}))})))},vt=n("DM26"),Ot=n("rjmT");function yt(){return(yt=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e}).apply(this,arguments)}function Ct(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var n=[],a=!0,r=!1,i=void 0;try{for(var s,o=e[Symbol.iterator]();!(a=(s=o.next()).done)&&(n.push(s.value),!t||n.length!==t);a=!0);}catch(e){r=!0,i=e}finally{try{a||null==o.return||o.return()}finally{if(r)throw i}}return n}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return Et(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Et(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Et(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,a=new Array(t);n<t;n++)a[n]=e[n];return a}var jt=Object(vt.debouncedPromise)(a.searchHints,300),Tt=dt.default.getLang;class St extends Xe.Component{constructor(e){var t;super(e),t=this,this.toggleMode=()=>{var e=this.props.store;if(Object(i.isCommunityInterface)(e)){var t=0===this.state.mode?1:0,n=0===t?a.searchImTopConv:a.searchTopConv;this.setState({value:"",mode:t,loading:!0,selected:null,found:[]},()=>n("",e.get()).then(e=>this.setSearchResults(this.filterResults(e))).then(()=>this.searchInput.focus()).catch(e=>console.error(e)))}},this.onChange=e=>{this.setState({value:e.target.value,loading:!0,error:null});var t=e.target.value;this.searchQuery!==t&&(this.searchQuery=t,this.onSearch(t))},this.filterResults=e=>{var t=Object(i.isCommunityInterface)(this.props.store)&&1===this.state.mode;return e.filter(e=>{var n=e.peerId;return!(t&&n<0)&&(!(t&&n>2e9&&!Object(W.doesChatTabHaveFlag)(e,1024))&&!(!t&&n>2e9&&Object(W.doesChatTabHaveFlag)(e,1024)))})},this.onSearch=e=>{var t=this.props.store,n=t.get(),r=Object(i.isCommunityInterface)(t)&&0===this.state.mode,s=r?a.searchImTopConv:a.searchTopConv;return 1===this.state.mode&&""===e?this.emptySearch().then(e=>{this.setSearchResults(this.filterResults(e))}):s(e,n).then(t=>{var a=t.map(e=>e.peerId);return t=this.filterResults(t),this.setSearchResults(t,!1,!t.length),e?jt(e,a,"all",{hidegid:r},n):Promise.resolve([])}).then(t=>{e===this.state.value&&this.setSearchResults(this.filterResults(t),!0)}).catch(()=>{})},this.emptySearch=()=>{var e=this.props.store,t=e.get(),n=t.dialog_tabs.all,r={},s={};return Object(a.searchTopConv)("",t).then(a=>(a.forEach(e=>{s[e.peerId]=e}),[t.peer].concat(n.filter(e=>e!=t.peer)).map(t=>{var n=Object(i.getTab)(e,t);return r[t]=!0,{name:s[t]&&s[t].name||n.tab,photo:s[t]&&s[t].photo||n.photo,data:n.data,peerId:t}}).concat(a.filter(e=>!r[e.peerId]))))},this.sendRecipient=e=>{var t=this.props.store,n=t.get();1===this.state.mode?(n.longpoll.push([Object(h.changePeer)(e,!1,!0,!0,"forward_messages_popup")]),Object(qe.statlogsForwardEvent)(t),Object(i.isCommunityInterface)(t)&&Object(qe.statlogsForwardFromCommunityEvent)(t,!1)):this.setState({selected:e,error:null},()=>{Emoji.focus(this.input)})},this.loadMore=()=>{},this.getSearchInputEl=e=>this.searchInput=e,this.setSearchResults=function(e,n){var a=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!t.unmounted)if(n){var r=e.filter(e=>!t.found[e.peerId]);r.forEach(e=>{t.found[e.peerId]=!0}),t.setState({found:[].concat(t.state.found,r),loading:a})}else t.found=e.reduce((e,t)=>(e[t.peerId]=!0,e),{}),t.setState({found:e,loading:a,activeElement:0})},this.getFormRef=e=>{this.form=e},this.getInputRef=e=>{this.input=e},this.getEmojiButtonRef=e=>{this.emojiButton=e},this.onEmojiButtonMouseOver=e=>{e.persist(),Emoji.show(this.emojiButton,e)},this.onEmojiButtonMouseOut=e=>{e.persist(),Emoji.hide(this.emojiButton,e)},this.send=()=>{var e=this.props.store,t=this.state.selected,n=Emoji.val(this.input).trim(),s=new Ot.ImDraft({},0),o=e.get().pendingForward;if(t&&!Object(r.isMessageTooLong)(val)){this.setState({sending:!0});var l=Object(i.isCommunityInterface)(e)&&0===this.state.mode;l||s.addAttach("mail",o.msgIds.join(";"),o.object||null);var c={message:n,attaches:s.dData.attaches.map(e=>[e.type,e.id])||[]},d={hidegid:!0,external:{original_gid:e.get().id,fwd_group_msg_ids:l?o.msgIds.join(";"):void 0}};new Promise(n=>{Object(a.loadHashes)([t],{hidegid:!0},e.get()).then(e=>{var a=Ct(e,1)[0];return n(a[t])})}).then(n=>e.set(a.sendMessage.bind(null,t,c,yt({hash:n},d)))).then(()=>{Object(qe.statlogsForwardFromCommunityEvent)(e,!0),e.setState({pendingForward:null}),this.props.closePopup(),showDoneBox(Tt("mail_send3"))}).catch(e=>{this.unmounted||this.setState({sending:!1},()=>{Object(Ke.showFastBox)(Tt("mail_error"),e)})})}},this.onSearchKeyDown=e=>{27===e.keyCode&&this.state.value&&(this.searchInput.blur(),this.searchQuery="",this.setState({value:"",loading:!0,error:null},this.onSearch.bind(this,"")),e.stopPropagation())},this.onMessageInputKeyDown=e=>{27===e.keyCode&&(this.state.sending||(Emoji.val(this.input,""),this.setState({selected:null}),this.searchInput.focus()),e.stopPropagation())},this.state={value:"",found:[],mode:1,loading:!0,sending:!1,selected:null,activeElement:0},this.emptySearch().then(e=>{this.setSearchResults(this.filterResults(e))}).catch(e=>console.error(e))}componentDidMount(){this.props.updatePopup(),Emoji.init(this.input,{noStickers:!0,onSend:this.send}),this.input.addEventListener("keydown",this.onMessageInputKeyDown)}componentWillUnmount(){this.input.removeEventListener("keydown",this.onMessageInputKeyDown),this.unmounted=!0}render(){var e=this.props,t=e.store,n=e.closePopup,a=this.state,r=a.mode,s=a.loading,o=a.selected,l=a.found,c=a.sending,d=Object(Ye.classNames)("MessageForward",{"MessageForward--form":0===r&&!!o});return Xe.createElement("section",{className:d},Xe.createElement(et.default,{title:Xe.createElement(Xe.Fragment,null,Xe.createElement("span",{className:"MessageForward__title"},Tt("mail_forward_messages")),Object(i.isCommunityInterface)(t)&&Xe.createElement("span",{className:"MessageForward__switch",onClick:this.toggleMode},Tt(0===r?"mail_forward_to_community_messages":"mail_forward_to_im"))),onCloseClick:n}),Xe.createElement("div",{className:"MessageForward__content"},Xe.createElement(bt,{searchValue:this.state.value,isLoading:s,convos:l,mode:1===r?"default":"radio",selectedConvos:[o],store:t,onSearchValueChange:this.onChange,onSearchInputKeydown:this.onSearchKeyDown,onConvoSelect:this.sendRecipient,onListLoadMore:this.loadMore,searchInputGetter:this.getSearchInputEl,className:"MessageForward__convoPicker"}),Xe.createElement("footer",{className:"MessageForward__footer",ref:this.getFormRef,key:"footer"},Xe.createElement("div",{className:"MessageForward__form _emoji_field_wrap"},Xe.createElement("div",{className:"MessageForward__input",tabIndex:"0",contentEditable:!0,role:"textbox","aria-multiline":!0,ref:this.getInputRef,placeholder:Tt("mail_im_enter_msg")}),Xe.createElement("div",{className:"MessageForward__emoji emoji_smile_wrap _emoji_wrap"},Xe.createElement("div",{ref:this.getEmojiButtonRef,className:"emoji_smile _emoji_btn",title:Tt("global_emoji_hint"),onMouseOver:this.onEmojiButtonMouseOver,onMouseOut:this.onEmojiButtonMouseOut,onClick:this.onEmojiButtonClick},Xe.createElement("div",{className:"emoji_smile_icon_vector emoji_smile_icon"})))),c?Xe.createElement("div",{className:"MessageForward__send-spinner"},Xe.createElement(tt.default,null)):Xe.createElement("button",{className:"MessageForward__send",onClick:this.send}))))}}var It,At=Object(Je.connect)(St);function wt(){It&&It.hide()}function Lt(){It&&It.updateBoxCoords()}function kt(){return document.querySelector("#MessageForward")}function Mt(e){var t=document.querySelector("#box_layer_wrap"),n=document.querySelector("#box_loader"),a=isVisible(t);return{unmount(){var t=kt();t&&Ze.unmountComponentAtNode(t),Object(p.destroyModule)(e)},showLoader(){boxRefreshCoords(n),show(n),a||show(t)},hideLoader(){hide(n),a||hide(t)}}}function Nt(e,t,n){var r=(0,Object(p.createMutations)(Mt).bindMutations)(Object(p.createModule)({handlers:(e,t)=>{}})),i={hideButtons:!0,bodyStyle:"padding: 0; background: none;",width:500,onShow(){!function(e){var t=kt();t&&Ze.render(Xe.createElement(Je.default,{value:e},Xe.createElement(At,{closePopup:wt,updatePopup:Lt})),t)}(t),requestAnimationFrame(()=>It.updateBoxCoords())},onHideAttempt:()=>(t.set(a.prepareForward.bind(null,null)),r.unmount(),!0)};return r.showLoader(),Promise.resolve().then(e=>{r.hideLoader(),It=new MessageBox(i).content('<div id="MessageForward"></div>').show()}),r}var Pt=n("r7nW"),Dt=n("0toi"),Rt=function(e){var t=e.icon,n=e.children,a=Object(Ye.classNames)("ContactIconRow__icon","ContactIconRow__icon--"+t);return Qe.a.createElement("div",{className:"ContactIconRow"},Qe.a.createElement("div",{className:a}),Qe.a.createElement("div",{className:"ContactIconRow__text"},n))},xt=n("756/"),Bt=n("2zsc"),Ht=function(e){var t=e.contact,n=t.id+19e8;return Qe.a.createElement("div",{className:"ContactPopupContent"},Qe.a.createElement("header",{className:"ContactPopupContent__header"},Qe.a.createElement("div",{className:"ContactPopupContent__photo"},Qe.a.createElement(xt.ConversationNoPhoto,{text:Object(r.getUserInitials)(t.name),size:"80",id:n,specificType:7,key:t.id})),Qe.a.createElement("h3",{className:"ContactPopupContent__title"},Qe.a.createElement(Bt.default,null,Object(r.prepareContactName)(t.name))),Qe.a.createElement("div",{className:"ContactPopupContent__meta"},Object(dt.getLang)("mail_from_contacts_list"))),Qe.a.createElement("div",{className:"ContactPopupContent__info"},t.main_phone&&Qe.a.createElement(Rt,{icon:"phone"},Object(r.formatPhoneNumber)(t.main_phone)),t.emails[0]&&Qe.a.createElement(Rt,{icon:"mail"},Qe.a.createElement("a",{href:"mailto:"+t.emails[0]},t.emails[0]))),t.sync_date&&Qe.a.createElement("div",{className:"ContactPopupContent__info"},Qe.a.createElement(Rt,{icon:"sync"},t.sync_date)))},Ft=function(e){var t=e.className,n=Qe.a.useState(!1),a=n[0],r=n[1];return Qe.a.useEffect((function(){var e=setTimeout((function(){r(!0)}),140);return function(){return clearTimeout(e)}}),[]),a?Qe.a.createElement("div",{className:Object(Ye.classNames)("ModalPreloader",t)},Qe.a.createElement("div",{className:"ModalPreloader__animation"},Qe.a.createElement("div",{className:"ModalPreloader__dot"}),Qe.a.createElement("div",{className:"ModalPreloader__dot"}),Qe.a.createElement("div",{className:"ModalPreloader__dot"})),Qe.a.createElement("div",{className:"ModalPreloader__background"})):null},Ut=function(e){var t=e.getContactInfo,n=e.onClose,a=Qe.a.useState({kind:"loading"}),r=a[0],i=a[1];switch(Qe.a.useEffect((function(){var e=function(e){Object(_.showErrorBox)(e),i({kind:"failed"}),n()};t().then((function(t){t?i({kind:"loaded",contact:t}):e(Object(dt.getLang)("mail_contact_was_removed"))})).catch((function(){e(Object(dt.getLang)("global_error"))}))}),[]),r.kind){case"failed":return Qe.a.createElement(Qe.a.Fragment,null);case"loading":return Qe.a.createElement(Ft,null);case"loaded":return Qe.a.createElement(Pt.default,{onClose:n,className:"ContactPopup"},Qe.a.createElement(Dt.default.Header,{title:Object(dt.getLang)("mail_contact"),onClose:n,appearance:"blue"}),Qe.a.createElement(Ht,{contact:r.contact}))}};function Gt(e,t,n){var a=qt();if(a){var r=t-19e8;Ze.render(Xe.createElement(Ut,{store:e,onClose:n.closeContactPopup,getContactInfo:()=>function(e,t){return $t(e).then(e=>{var n=function(e,t){var n=e.get().contactsList;return n?n.find(e=>e.id===t):null}(e,t);return Promise.resolve(n)})}(e,r)}),a)}}function qt(){return document.querySelector("._im_contact_popup_container")}function Vt(e,t){return{unmount:()=>function(e,t){var n=qt();n&&Ze.unmountComponentAtNode(n),Object(p.destroyModule)(e)}(e),closeContactPopup(){var e=qt();Ze.unmountComponentAtNode(e)}}}var Wt="im-page--header-action_loading";function Kt(e,t,n){return!e.map(e=>{var a=Object(i.getMessage)(t,n,e);return Object(s.isImportant)(a)}).reduce((e,t)=>e&&t,!0)}function Yt(e,t){var n=t.get(),a=n.peer,r=n.tabs[a].pinned;return 1===e.length&&r&&e[0]===Object(i.parserMessage)(r).messageId}function $t(e){return e.get().contactsList?Promise.resolve(e):e.set(a.getContactsList)}function zt(e,t,n){var a=Object(o.getLang)("mail_selected_shorted",t.length);Jt({actions:!0},"im-page--chat-header"),val(geByClass1("im-page--selected-messages"),getTemplate("im_selected_messages",{label:a.replace("{count}",t.length),tip:Object(o.getLang)("mail_deselect_all")}));var s=Object(i.getTab)(n,n.get().peer),l=e.querySelector("._im_mess_actions"),c=Kt(t,n,n.get().peer),d=Yt(t,n),u=t.length>1,g=!u&&Object(r.isChatPeer)(s.peerId)&&Object(r.canPinMessage)(n,t[0]),m=Object(r.canForwardMessages)(n,t),_=e.querySelector('._im_page_action[data-action="respond"]'),p=e.querySelector('._im_page_action[data-action="forward"]'),h=Boolean(Object(i.tabIsOutgoingMessageRequest)(s)),f=Boolean(Object(i.tabIsMessageRequest)(s));l.className=Object(Ye.classNames)("im-page--mess-actions _im_mess_actions",{"im-page--mess-actions_important":!c,"im-page--mess-actions_pinned":d,"im-page--mess-actions_channel":Object(i.isChannelPeer)(s)&&!n.get().gid,"im-page--mess-actions_multiple-selection":u,"im-page--mess-actions_no-pin-btn":!g,"im-page--mess-actions_out-mr":h,"im-page--mess-actions_in-mr":f,"im-page--mess-actions_no-important-btn":!Object(r.canMarkImportant)(n,t)}),t.length>1?_.innerHTML=Object(o.getLang)("mail_forward_here"):_.innerHTML=Object(o.getLang)("mail_im_mark_reply"),m?(p.removeAttribute("disabled"),p.classList.remove("button_disabled")):(p.setAttribute("disabled","disabled"),p.classList.add("button_disabled")),u&&!m?(_.setAttribute("disabled","disabled"),_.classList.add("button_disabled")):(_.removeAttribute("disabled"),_.classList.remove("button_disabled"));var b=c?Object(o.getLang)("mail_im_toggle_important"):Object(o.getLang)("mail_im_toggle_important_off"),v=d?Object(o.getLang)("mail_unpin"):Object(o.getLang)("mail_pin");attr(geByClass1("im-page-action_star",e),"aria-label",b),attr(geByClass1("im-page-action_pin",e),"aria-label",v)}function Xt(e,t,n){var s=t.get(),o=s.peer,l=s.tabs[o],c=geByClass1("_im_chat_verified",e),d=geByClass1(r.PINNED_CONTAINER_CLASS,e),u=Object(r.isChatPeer)(o),g=u&&Object(i.isChannelPeer)(l),m=s.selectedMessages&&!!s.selectedMessages.length;c.tt=!1;var _=Object(r.renderPhotosFromTab)(t,l,!0),p=getTemplate("im_simple_link",{href:g?"/club"+-l.ownerId:l.href,content:getTemplate("im_peer_photo",{online_class:"",owner_photo:_,modifier_class:"nim-peer_smaller"})});val(geByClass1("im-page--aside-photo",e),p);var h=u&&Object(i.isChatActive)(l),f={muted:inArray(o,s.mutedPeers),verified:!!l.verified,chat:u,vkcomgroup:g,actions:m,derelict:u&&!h&&!g,pinned:!1};if(u){var b=Object(i.getPinnedMessage)(t),v=function(e){var t=Object(i.getPinnedMessage)(e);if(!t||Object(V.oCacheGet)(e,t.userId))return!1;return t.userId}(t);b&&Object($e.isPinnedMessageVisibleInTab)(t,o)&&(v?t.set(a.loadChatMember.bind(null,{[o]:[v]})).then(Xt.bind(null,e,t,n)):f.pinned=!0)}Qt(t,l,e);var O=!l.top_banner&&d.innerHTML,y=!l.top_banner&&Zt(t,e,d),C=geByClass1("_im_page_peer_name",e);removeClass(C,r.DESELECT_ALL_CLASS),function(e,t,n){var a=n.length>0;geByClass("_im_header_icon",e).forEach(e=>{if("star"===e.dataset.type&&Object(r.isFoldersAvailable)(t)&&(toggleClass(e,"im-page--header-icon_shown",!a),toggleClass(e,"im-page--header-icon_star-active",Object(r.isImportant)(t))),"answer"===e.dataset.type&&Object(r.isFoldersAvailable)(t)&&toggleClass(e,"im-page--header-icon_shown",!a&&Object(r.isUnrespond)(t)),"search"===e.dataset.type&&!Object(r.isCommunityInterface)(t)){var n=t.get().peer,s=!a&&Object(r.isFullyLoadedTab)(t,n)&&Object(i.getTab)(t,n).offset&&!Object(r.isCommunityInterface)(t)&&(!Object(r.isCallToPeerAvailable)(t,n)||!Object(r.isClassicInterface)(t));toggleClass(e,"im-page--header-icon_shown",s)}})}(e,t,[]);var E=e.querySelector("._im_dialog_call_action_wrapper"),j=e.querySelector("._im_header_icon[data-type=call]");if(E&&E.classList.toggle("im-page--header-call-is-hidden",!Object(r.isCallToPeerAvailable)(t,o)||!!l.callInProgress),j&&(j.classList.toggle("im-page--header-icon_shown",Object(r.isCallToPeerAvailable)(t,o)&&!!l.callInProgress),j.classList.toggle("im-page--header-icon_call-active",!!l.callInProgress&&l.callInProgress.participants.count>0)),Object(r.isClassicInterface)(t)){var T=geByClass1("_im_page_back",e);attr(T,"href",`${Object(r.getBaseLink)(t)}?tab=${s.active_tab}`)}Jt(f,"im-page--chat-header"),Object(r.compensateHistoryHeightChange)(t,y,O,n)}function Qt(e,t,n){var a=Object(r.isChatPeer)(t.peerId),s=a&&Object(i.isChannelPeer)(t),l=a&&Object(i.isChatActive)(t),c=a&&Object(i.isCasperChatTab)(t),d=Object(r.isContactPeer)(t.peerId),u=t.name,g="";a?g=s?getTemplate("im_vkcomgroup_members",{name:Object(o.getLang)("mail_im_n_vkcomgroup_members",Object(r.getAliveMembersCount)(t))}):l?getTemplate("im_chat_members",{name:Object(o.getLang)("mail_im_n_chat_members",Object(r.getAliveMembersCount)(t))}):"":Object(r.isUserPeer)(t.peerId)&&(g=Object(r.getLastSeenTextInHeader)(e,t.peerId));var m=[];""===g&&m.push("im-page--title--1line"),c&&m.push("im-page--title--casper"),m=m.join(" ");var _=getTemplate("im_simple_name",{name:d?Object(r.prepareContactName)(t.name):t.tab,href:s?"/club"+-t.ownerId:t.href,name_attr:u,ads_union:t.ad_union_ids_attr,online:g,more_cls:m});val(geByClass1("im-page--title-wrapper",n),_)}function Zt(e,t,n){var a=Object(i.getPinnedMessage)(e),o=n||geByClass1(r.PINNED_CONTAINER_CLASS,t);if(removeClass(o,"im-page--pinned_with-bar"),a&&Object(s.isMoneyRequest)(a)){if(void 0===a.kludges.attach1_tr_amount)return;a.kludges.attach1_total_amount&&addClass(o,"im-page--pinned_with-bar")}var l=Object(r.renderPinnedMessage)(e);return val(o,l),!!l}function Jt(e,t){var n=geByClass1(t);Object.keys(e).forEach(a=>{toggleClass(n,`${t}_${a}`,!!e[a])})}function en(e,t,n,r,i){e.set(a.removeMessagesWithRestore.bind(null,n,i,r)).then(t().removeMessagesRestore.bind(null,n,i,r)),Object(a.removeMessageSend)(n,i,null,r,e.get())}function tn(e,t,n,s,o){var l=e.get().selectedMessages,c=domData(o,"action"),d=e.get().peer,u=Object(i.getTab)(e,d),g=!0;if("star"!==c&&Object(i.tabIsOutgoingMessageRequest)(u))return an(e,t,n);switch(c){case"delete":var m=!(vk.id==d&&!e.get().gid)&&l.every(t=>Object(r.canMessageBeDeletedForAll)(e,Object(i.getMessage)(e,d,t)));if(m||l.length>1){g=!1;var _=Object(r.showMsgDeleteDialog)(d,l.length,m,r=>{an(e,t,n),_.hide(),cur.imDb.updateByKey("del_forall_checked",r),r?Object(a.removeMessageSend)(l,d,null,"deleteforall",e.get()):en(e,t,l,c,d)})}else en(e,t,l,c,d);break;case"spam":en(e,t,l,c,d);break;case"forward":if(!Object(r.canForwardMessages)(e,l))return;Object(a.processFwd)(l,d,e).then(t=>e.set(a.prepareForward.bind(null,t))).then(()=>n().showForward(e)).catch(e=>console.error(e));break;case"star":var p=Kt(l,e,d);e.set(a.favMessage.bind(null,l,p,d)),e.get().longpoll.push(l.map(e=>({type:p?h.SET_FLAGS:h.RESET_FLAGS,messageId:e,peerId:d,flags:h.FLAG_IMPORTANT})));break;case"respond":var f=e.get(),b=1===l.length;Object(a.processFwd)(l,f.peer,e).then(t=>e.set(a.forwardMessages.bind(null,t,f.tfdraft,b))).then(()=>{t().respond(e,d)});break;case"pin":var v=Object(i.getLocalId)(e,l[0]);if(!Object(r.canPinMessage)(e,v))return;var O=Yt(l,e),y=O?a.unpinMessageOptimistic.bind(null,d):a.pinMessageOptimistic.bind(null,v,d),C=O?a.unpinMessage.bind(null,d):a.pinMessage.bind(null,v,d),E=dn.bind(null,t,d);e.set(a.checkChatMember.bind(null,e,v,d)).then(e=>e.set(y)).then(E).then(e=>e.set(C)).then(E)}g&&an(e,t,n)}function nn(e,t,n,s,l,c){var d=domData(c,"action"),u=s.querySelector("._im_dialog_action_wrapper ._ui_menu").parentNode,g=e.get().peer;switch(d){case a.CHAT_ACTION_CLEAR:var m=Object(i.getTab)(e,g),_=Object(r.showFlushChat)(m,g,()=>{Object(r.cleanHistory)(e,_,t,a.flushHistory,e.get().peer)});break;case a.CHAT_ACTION_MEDIA:showWiki({w:"history"+Object(r.convertPeerToUrl)(g)+"_photo"},null,{});break;case a.CHAT_ACTION_CALL_AUDIO:case a.CHAT_ACTION_CALL_VIDEO:Object(r.isCallToPeerAvailable)(e,g)&&Object(r.startCallFromIm)(e,g,d===a.CHAT_ACTION_CALL_VIDEO,[],r.CALL_ENTRY_POINT_HEADER);break;case a.CHAT_ACTION_SEARCH:t().showSearch(e);break;case a.CHAT_ACTION_BLOCK_NOTIFY:case a.CHAT_ACTION_BLOCK_COMMUNITY:e.set(a.toggleCommunityMessages.bind(null,!1,g)).then(()=>{e.get().longpoll.push([Object(h.resetPeer)()]),showDoneBox(Object(o.getLang)("mail_community_was_blocked"))});break;case a.CHAT_ACTION_ALLOW_COMMUNITY:e.set(a.toggleCommunityMessages.bind(null,!0,g)).then(()=>{n().changeActions(e)});break;case a.CHAT_ACTION_BLOCK:Object(r.showBlacklistBox)(g,e).once("success",t=>{t.delta&&(showDoneBox(t.msg),e.get().longpoll.push([Object(h.resetPeer)()]))});break;case a.CHAT_ACTION_LEAVE:var p=Object(r.showLeaveDialog)(e,g,n=>{var i=e.set(a.leaveChat.bind(null,g)).then(()=>e.set(a.unpinMessageOptimistic.bind(null,g)));n&&i.then(()=>Object(r.cleanHistory)(e,p,t,a.flushHistory,g)),p.hide(),e.get().longpoll.push([Object(h.resetPeer)()])});break;case a.CHAT_ACTION_UNREAD:var f=e.get();Object(a.markDialogUnread)(f.peer,f);break;case a.CHAT_ACTION_RETURN:e.set(a.returnToChat.bind(null,g)).then(e=>e.set(a.getPinnedMessage.bind(null,g))).then(t().updateChatTopic.bind(null,g)).catch(e=>{Object(Ke.showFastBox)(Object(o.getLang)("global_error"),e)});break;case a.CHAT_ACTION_MUTE:case a.CHAT_ACTION_UNMUTE:e.set(a.toggleMutePeer.bind(null,g,d===a.CHAT_ACTION_MUTE,-1)).then(t().updateState.bind(null,g));break;case a.CHAT_ACTION_INVITE:if(Object(r.isChatPeer)(g))Object(r.inviteUser)(e,g,t,a.setCreationType);else if(Object(r.isUserPeer)(g)){var b=e.get().tabs[g],v=[[g,b.tab]];e.set(a.setCreationType.bind(null,"chat",[])).then(()=>t().showCreation(e,v))}break;case a.CHAT_ACTION_PIN_HIDE:Object($e.pinnedMessageHide)(e,Object(i.getPeer)(e),t);break;case a.CHAT_ACTION_PIN_UNHIDE:Object($e.pinnedMessageUnHide)(e,Object(i.getPeer)(e),t);break;case a.CHAT_ACTION_UNPIN:Object($e.pinnedMessageUnpin)(e,Object(i.getPeer)(e),t);break;case a.CHAT_ACTION_SETTINGS:n().showSettings(e)}uiActionsMenu.toggle(u,!1),t().cancelEditing()}function an(e,t,n){var r=e.get().selectedMessages;e.set(a.cleanSelected).then(n().changedMessageSelection).then(t().cleanSelection.bind(null,r))}function rn(e,t,n,a){var i,s,c=Object(r.isClassicInterface)(e);switch(domData(a,"type")){case"star":s=[4,6],i=()=>Object(r.isImportant)(e)?Object(o.getLang)("mail_im_toggle_important_off"):Object(o.getLang)("mail_im_toggle_important");break;case"answer":s=[4,6],i=Object(o.getLang)("mail_end_conversation");break;case"search":s=c?[5,6]:[4,-9],i=Object(o.getLang)("mail_search_in_peer")}Object(l.showTooltip)(a,{text:i||"",black:1,shift:s,forcetoup:!0,appendParentCls:c?"_im_dialog_actions":"_im_mess_actions"})}function sn(e,t,n){var a=Object(r.isClassicInterface)(e),i=domData(n.target,"action");"respond"!==i&&"forward"!==i&&Object(l.showTooltip)(n.target,{text:on.bind(null,e,i)||"",black:1,shift:[2,a?-4:11],forcetodown:!0,appendParentCls:"_im_dialog_actions"})}function on(e,t){var n=e.get(),a=n.selectedMessages,r=n.peer;switch(t){case"pin":return Yt(a,e)?Object(o.getLang)("mail_unpin"):Object(o.getLang)("mail_pin");case"star":return Kt(a,e,r)?Object(o.getLang)("mail_im_toggle_important"):Object(o.getLang)("mail_im_toggle_important_off");case"delete":return Object(o.getLang)("mail_delete");case"spam":return Object(o.getLang)("mail_im_mark_spam")}}function ln(e,t,n,s,l){var c=domData(l,"type"),d=e.get().peer;switch(c){case"star":e.set(a.toggleDialogImportant.bind(null,d)).then(()=>{setTimeout(()=>rn(e,0,0,l),40)});break;case"search":n().showSearch(e),window.tooltips&&tooltips.hide(l,{fasthide:!0});break;case"answer":var u=Object(i.getTab)(e,d);u&&(e.set(a.markDialogAnswered.bind(null,e.get().peer,u.lastmsg)),showDoneBox(Object(o.getLang)("mail_marked_as_answered"),{out:1e3}),e.get().longpoll.push([Object(h.resetPeer)()]));break;case"call":if(Object(r.isCallToPeerAvailable)(e,d)){var g=Object(i.getTab)(e,d).callInProgress;g&&Object(r.joinCallFromIm)(e,d,g.join_link,!1,r.CALL_ENTRY_POINT_JOIN_HEADER)}}}function cn(e,t){var n=Number(t),a=Object(r.formatTimespan)(n,!0),i=Object(o.getLang)("mail_network_waiting").replace(/{timer}/gi,a);e.querySelector("._im_page_status").innerHTML=i}function dn(e,t,n){return e().updateChatTopic(t,n),n}function un(e,t,n,s){var l={};return{changeActions(t){var n=e.querySelector("._im_dialog_action_wrapper ._ui_menu"),r=geByClass1("_im_dialog_action_wrapper",e),i=t.get().curActions,s=Object.keys(i).map((e,t)=>{var n="";return 7!==a.ACTION_PRIORITIES[e]&&10!==a.ACTION_PRIORITIES[e]||0===t||(n='<div class="ui_actions_menu_sep"></div>'),n+getTemplate("sImUiActionMenuItem",{action:e,name:i[e].name,icon:i[e].icon,classes:"_im_action"})}).join("");0===Object.keys(i).length?addClass(r,Wt):(val(n,s),removeClass(r,Wt))},setNetworkWaitingStatus(t){l.interval&&clearInterval(l.interval),cn(e,t),l.timeout=t,l.interval=setInterval(()=>{l.timeout>1?(l.timeout--,cn(e,l.timeout)):(clearInterval(l.interval),l={})},1e3)},setNetworkReconnectingStatus(){var t,n;l.interval&&clearInterval(l.interval),l={},t=e.querySelector("._im_page_status"),n=Object(o.getLang)("mail_network_reconnecting"),t&&(t.innerHTML=n)},clearNetworkStatus(){l.interval&&clearInterval(l.interval),l={},e.querySelector("._im_page_status").innerHTML=""},showSettings(t){var n=t.get(),a=Object(i.getTab)(t,n.peer);Object(i.isChatActive)(a)&&Object(ze.mount)(e,t,s)},showForward(e){Nt(0,e)},renderPeer(n){Xt(e,n,t)},reRenderPinned(t){var n=Object(i.getCurrentTab)(t);n&&n.pinned&&Zt(t,e)},reRenderTitle(t){var n=Object(i.getCurrentTab)(t);n&&Qt(t,n,e)},renderActions(t){var n=t.get().selectedMessages||[];n.length>0&&zt(e,n,t)},hideActions(t){if(!Object(r.isFullyLoadedTab)(t,t.get().peer)){geByClass("_im_header_icon",e).forEach(e=>{addClass(e,Wt)});var n=geByClass1("_im_dialog_action_wrapper",e);addClass(n,Wt);var a=geByClass1("_im_dialog_call_action_wrapper",e);addClass(a,Wt)}},showActions(t){if(Object(r.isFullyLoadedTab)(t,t.get().peer)){geByClass("_im_header_icon",e).forEach(e=>{removeClass(e,Wt)});var n=geByClass1("_im_dialog_action_wrapper",e);removeClass(n,Wt);var a=geByClass1("_im_dialog_call_action_wrapper",e);removeClass(a,Wt)}},changedMessageSelection(n){if(0!==n.get().peer){var a=n.get().selectedMessages||[];a.length>0?zt(e,a,n):Xt(e,n,t)}},updateLastSeen(t){!function(e,t){var n=e.get().peer,a=geByClass1("_im_page_peer_online",t);a&&Object(r.isUserPeer)(n)&&Object(i.getTab)(e,n)&&Object(r.applyInnerHtml)(a,Object(r.getLastSeenTextInHeader)(e,n))}(t,e)},deselectAll(e){an(e,t,s)},updateState(e){t().updateState.bind(null,e)},unmount(){Object(p.destroyModule)(n),cancelStackFilter("fowrward")}}}function gn(e,t,n){var i=Object(p.createMutations)(un),s=i.callMutations,o=i.bindMutations,l=tn.bind(null,t,n,s),c=nn.bind(null,t,n,s,e),d=an.bind(null,t,n,s),u=(e,n)=>Object(r.showVerifiedTooltip)(n,t.get().peer),g=rn.bind(null,t,e),m=sn.bind(null,t,e),_=ln.bind(null,t,e,n),f=()=>s().showSettings(t),b=n=>{var a=t.get().peer;Object(r.isContactPeer)(a)&&(!function(e,t,n,a){var r=(0,Object(p.createMutations)(Vt).bindMutations)(Object(p.createModule)({handlers:(e,t)=>{}}),e);Gt(e,t,r)}(t,a),cancelEvent(n)),!gpeByClass("im-page--chat-header_chat",n.target,e)||gpeByClass("im-page--chat-header_vkcomgroup",n.target,e)||checkEvent(n)||(f(),cancelEvent(n))},v=()=>function(e,t){var n=()=>{t&&(t.classList.remove("im-page--chat-header_reconnected"),t.removeEventListener("mouseleave",n))};t&&(t.classList.add("im-page--chat-header_reconnected"),t.addEventListener("mouseleave",n)),e.get().longpoll.abortWaiting()}(t,e),O=Object(p.createModule)({handlers:(n,a)=>{a(e,"click","_im_page_action",l),a(e,"click","_im_action",c),a(e,"click",r.DESELECT_ALL_CLASS,d),a(e,"mouseover","_im_chat_verified",u),a(e,"mouseover","_im_header_icon",g),a(e,"mouseover","_im_page_action",m),a(e,"click","_im_header_icon",_),a(e,"click","_im_header_link",b),a(e,"click","_im_page_peer_name",b),a(e,"click","_im_chat_members",f),a(e,"click","_im_page_reconnect",v),a(e,"click","_im_page_back",e=>{checkEvent(e)||(t.get().longpoll.push([Object(h.resetPeer)()]),cancelEvent(e))})}});return Object(r.isReservedPeer)(t.get().peer)||setTimeout(()=>{t.set(a.setActions).then(s().changeActions)}),o(e,n,O,s)}n("/8Fb");var mn,_n,pn,hn,fn,bn,vn,On,yn,Cn,En,jn,Tn,Sn,In,An=n("ZVxX"),wn=browser.msie&&intval(browser.version)<10?window.XDomainRequest:window.XMLHttpRequest;function Ln(e){var t=e%60;return parseInt(e/60)+":"+(t<10?"0":"")+t}var kn=!1,Mn=!1,Nn=100;function Pn(e){var t=e.get().peer;Object(r.isFullyLoadedTab)(e,t)&&!Object(r.isAnyMessageBeingEdited)(e)&&Date.now()-(Object(r.getTab)(e,t).lastTyping||0)>1e3*a.ACTIVITY_PERIOD&&e.set(a.sendRecordingAudio.bind(null,t))}function Dn(e){if(!Mn){Mn=!0,Object(r.lockButton)(bn);var t={peer:yn.get().peer,from_place:cur.docsChooseFrom,imhash:cur.docsChooseImHash,blockPersonal:cur.docsChooseBlockPersonal,mail_add:cur.docsChooseMailAdd};(function(e){return new Promise((t,n)=>{for(var a=new FormData,r=[],i=0;i<e.wave.length;i++)r.push(parseInt(31*e.wave[i]));a.append("waveform",JSON.stringify(r)),a.append("file",e.buffer,"voice_message."+function(e){var t=e.match(/.*\/(\w*).*/);switch(t[1]){case"mpeg":return"mp3";case"ogg":case"webm":case"wav":return t[1]}return""}(e.mimeType));var s=new wn;s.onload=s.onerror=function(e){var a=e.currentTarget.response;200==this.status&&a.length>0&&"{"==a[0]?(a=JSON.parse(a),t(a)):n()},s.open("POST",In.upload_url,!0),s.send(a)})})(e).then(e=>e.file?new Promise((n,a)=>{ajax.post("/docs.php",extend({act:"a_save_doc",from:"choose",from_place:t.from_place,imhash:t.imhash,blockPersonal:t.blockPersonal,mail_add:t.mail_add},e),{onDone:(e,a)=>{Fn(),jn([["doc",e+"_"+a,"audiomsg"]],{},t.peer),Kn(),n()},onFail:function(e){a(e)},progress:null})}):Promise.reject()).then(()=>{Object(r.unlockButton)(bn),Mn=!1}).catch(()=>{Mn=!1,Object(r.unlockButton)(bn),Object(Ke.showFastBox)(getLang("global_error"),getLang("mail_audio_message_upload_error"))})}}function Rn(){Sn(),_n.innerHTML=Ln(kn.duration),kn.duration>=600&&Wn()}function xn(e){e.set(a.cancelRecording).then(qn)}function Bn(){Sn(),stManager.add(["voice_message_player.js","speech.js"],(function(){kn||(kn=Speech.newRecorder(),addEvent(kn,"progress",Rn)),AudioMessagePlayer.detachPlayer(),AudioMessagePlayer.pauseGlobalMedia(),kn.record().then(()=>{var e;e=yn,In.isRecording=!0,cancelStackPush("audio_message_cancel",xn.bind(null,e)),hideProgress(geByClass1("im-audio-message-send-wrapper",mn)),_n.innerHTML="0:00",addClass(mn,"im-audio-message_recording"),removeClass(mn,"im-audio-message_recorded"),function(){mn&&mn.classList&&mn.classList.remove("im-audio-message-input--hidden");geByClass1("_im_chat_input_parent",On).classList.add("im-chat-input--hidden")}(),(En=Speech.createVisualization("wave",kn.source,pn)).start();var t=pn.getBoundingClientRect();Nn=(t.right-t.left)/3}).catch(e=>{AudioMessagePlayer.resumeGlobalMedia();var t=e.name;switch(e.name){case"DevicesNotFoundError":case"NotFoundError":case"NotAllowedError":t="mail_audio_message_device_error";break;case"PermissionDeniedError":case"PermissionDismissedError":t="mail_audio_message_permission_error";break;case"Unsupported":t="mail_audio_message_unsupported_error"}Object(Ke.showFastBox)(getLang("global_error"),getLang(t)),console.error(e)})}))}function Hn(){kn&&kn.stop(),En&&(En.destroy(),En=null)}function Fn(){In.isRecording=!1,cancelStackFilter("audio_message_cancel")}function Un(){Gn(),Dn(kn)}function Gn(){var e;AudioMessagePlayer.loaded&&AudioMessagePlayer.resumeGlobalMedia(),removeEvent(kn,"finish",Gn),removeEvent(kn,"finish",Un),e=URL.createObjectURL(kn.buffer),domData(Cn,"duration",kn.duration),domData(Cn,"ogg",e),domData(Cn,"mp3",e),geByClass1("audio-msg-track--duration",Cn).innerHTML=Ln(kn.duration),geByClass1("audio-msg-track--wave-wrapper",Cn).innerHTML=AudioMessagePlayer.getWave(kn.wave,Nn),removeClass(mn,"im-audio-message_recording"),addClass(mn,"im-audio-message_recorded")}function qn(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];Fn(),AudioMessagePlayer.loaded&&(AudioMessagePlayer.resumeGlobalMedia(),AudioMessagePlayer.detachPlayer()),removeEvent(kn,"finish",Gn),removeEvent(kn,"finish",Un),Hn(),Kn(),e&&Tn()}function Vn(){kn.isRecording?(addEvent(kn,"finish",Un),removeEvent(kn,"finish",Gn),Hn()):Dn(kn)}function Wn(){addEvent(kn,"finish",Gn),removeEvent(kn,"finish",Un),Hn()}function Kn(){removeClass(mn,"im-audio-message_recorded"),removeClass(mn,"im-audio-message_recording"),mn&&mn.classList&&mn.classList.add("im-audio-message-input--hidden"),geByClass1("_im_chat_input_parent",On).classList.remove("im-chat-input--hidden")}function Yn(){ge("audiomsg_record"),Cn=ge("audiomsg_player"),On=geByClass1("_im_chat_input_w"),mn=geByClass1("im-audio-message-input",On),_n=geByClass1("audio-msg-track--duration",mn),pn=geByClass1("audio-msg-track--wave",mn),fn=geByClass1("im-audio-message--cancel-btn",mn),bn=geByClass1("_im_audio_send",mn),vn=geByClass1("audio-msg-track--btn",mn),geByClass1("im-chat-input--text",On);var e=geByClass1("im-chat-input--textarea",On);addClass(e,"_voice_field_wrap"),addEvent(hn,"click",Bn),addEvent(fn,"click",qn),addEvent(bn,"click",Vn),addEvent(vn,"click",Wn)}function $n(){!function(){kn&&removeEvent(kn,"progress",Rn);removeEvent(hn,"click",Bn),removeEvent(fn,"click",qn),removeEvent(bn,"click",Vn),removeEvent(vn,"click",Wn)}(),Cn=mn=_n=pn=hn=fn=bn=vn=null}function zn(e,t,n){return{cancelRecording:qn,start:function(){Bn()},unmount(){qn(!1),$n()}}}function Xn(e,t,n,i,s){return yn=t,In=t.get().audio_msg,Sn=Pn.bind(null,t),jn=n,Tn=s,Object(An.initFailBack)(),Object(r.getAvailableMicrophones)().then(e=>{var n=e.length>0;n?(Yn(),i()):setCookie("remixvoice","0",7),t.set(a.setVoiceMessageAvail.bind(null,n))}).catch(e=>{throw setCookie("remixvoice","0",7),e}),(0,Object(p.createMutations)(zn).bindMutations)(e,t,n)}var Qn=n("6aSF"),Zn=n("Ht+d"),Jn=n("N4ZS"),ea=n("Egk5");function ta(){return(ta=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e}).apply(this,arguments)}function na(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},i=Object.keys(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}class aa extends Xe.Component{constructor(){super(...arguments),this.onLinkClick=e=>{var t=this.props.action.link;if(/^https:\/\/(.+\.)?vk\.com\/gifts580392144\?act=send&ref=[^&]+$/.test(t))return Object(Ke.showBox)("al_gifts.php",{act:"get_gift_box",mid:580392144,fr:0,ref:t.split("&ref=")[1]},{stat:["gifts.css","wide_dd.js","wide_dd.css"],dark:1}),Object(ea.cancelEvent)(e)},this.onButtonClick=()=>{var e=this.props,t=e.action,n=e.sendMessage,a=e.appHash,r=e.keyboardAuthorId;return Object(Ve.handleButtonClick)(t,n,a,r)}}render(){var e=this.props,t=e.action,n=(e.sendMessage,e.appHash,e.keyboardAuthorId,na(e,["action","sendMessage","appHash","keyboardAuthorId"])),a=Object(Ve.getButtonAppearance)(this.props),r=Object(Ve.getButtonLabel)(this.props),i=t.type,s=Xe.createElement(Zn.default,ta({wide:!0,overflow:!0},n,{type:t.type,appearance:a,className:"BotButton BotButton--"+i,onClick:this.onButtonClick}),Xe.createElement("span",{className:"BotButtonLabel Button--overflow",dangerouslySetInnerHTML:{__html:r}}));switch(t.type){case Ve.BUTTON_TYPE_OPEN_LINK:return this.wrapLinkButton(s);default:return s}}wrapLinkButton(e){var t=this.props.action,n=Object(Jn.wrapAwayIfExternal)(t.link,!0);return Xe.createElement("a",{href:n,className:"Keyboard__buttonWrapper",target:"_blank",rel:"nofollow noopener",onClick:this.onLinkClick},e)}}aa.defaultProps={color:Ve.BUTTON_COLOR_DEFAULT};var ra=aa;class ia extends Xe.Component{static getButtonWidth(e){return`calc(100% / ${e} - 10px)`}render(){var e=this.props.store,t=this.props.send,n=e.get(),a=Object(i.getCurrentKeyboard)(e),r=n.keyboard_app_hash;return a&&a.buttons?Xe.createElement("div",{className:Object(Ye.classNames)("Keyboard",{"Keyboard--hidden":a.hide})},Xe.createElement(Qn.default,{className:"Keyboard__scroll-wrapper"},Xe.createElement("div",{className:"Keyboard__container"},a.buttons.map((e,n)=>Xe.createElement("div",{key:"row-"+n,className:"Keyboard__row"},e.map((n,i)=>Xe.createElement("div",{className:"Keyboard__button",key:"cell-"+i,style:{width:ia.getButtonWidth(e.length)}},Xe.createElement(ra,{sendMessage:t,appHash:r,keyboardAuthorId:a.author_id,action:n.action,type:n.action.type,color:n.color})))))))):null}}var sa=Object(Je.connect)(ia);function oa(){return document.getElementById("_im_keyboard_container")}function la(e,t,n){return{init(){return new Promise(e=>{this.isMounted=!0,function(e,t,n){var a=oa();if(a){var r=Xe.createElement(Je.default,{value:e},Xe.createElement(sa,{send:t}));Ze.render(r,a,n)}}(t,n,e)})},toggle:(e,n,r)=>t.set(a.toggleKeyboard.bind(null,e,n,r)),unmount(){var t=oa();t&&this.isMounted&&Ze.unmountComponentAtNode(t),this.isMounted=!1,Object(p.destroyModule)(e)}}}var ca=n("LYnS"),da=n("fD+e").default,ua=n("m5nf").default,ga=n("m5nf"),ma=ga.MAIN,_a=ga.EDIT;function pa(e,t){return Object(ca.default)().reduce((function(t,n){return t.replace(new RegExp("({"+n.id+"})","gi"),n.process(e))}),t).replace(/&lt;br&gt;/gi,"<br>")}function ha(e,t,n,r,s){var o;return{closeSettingsPopup:function(){o&&o.hide()},showSettingsPopup:function(e){var n=this,a={hideButtons:!0,bodyStyle:"padding: 0; background: none;",width:500,onShow:function(){var a=document.getElementById("TemplatesSettings");a&&Ze.render(Xe.createElement(Je.default,{value:t},Xe.createElement(ua,{popup:o,section:e,getTemplates:function(){return Object(i.getTemplates)(t)},saveTemplate:n.saveTemplate.bind(n),deleteTemplate:n.deleteTemplate.bind(n),closePopup:n.closeSettingsPopup.bind(n)})),a),requestAnimationFrame((function(){return o.updateBoxCoords()}))}};(o=new Ke.MessageBox(a).content('<div id="TemplatesSettings"></div>')).show()},applyTemplate:function(e){var n=Object(i.getTemplates)(t).find((function(t){return t.id===e}));Object(qe.statlogsCommunityTemplatesClickEvent)(),r(pa(t,Object(c.prepareToWriting)(n.text)))},getPreparedTemplates:function(){return Object(i.getTemplates)(t).map((function(e){return Object.assign({},e,{name:e.name,text:pa(t,e.text)})}))},saveTemplate:function(e){var n=Object(c.decodeHTMLEntities)(e.name),r=Object(c.decodeHTMLEntities)(e.text);return t.set(e.id?a.updateTemplate.bind(null,e.id,n,r):a.createTemplate.bind(null,n,r))},deleteTemplate:function(e){return t.set(a.deleteTemplate.bind(null,e))},isNeedRenderTemplates:function(){return!!Object(i.getPeer)(t)&&(!!Object(i.isCommunityInterface)(t)&&(!(Object(i.getPeer)(t)>2e9&&Object(W.doesChatTabHaveFlag)(Object(i.getCurrentTab)(t),1024))&&!Object(i.isCommunityChat)(t,Object(i.getPeer)(t))))},toggleImText:function(e){void 0===e&&(e=this.isNeedRenderTemplates()),s(e)},update:function(){this.toggleImText()},unmount:function(){this.toggleImText(!1)}}}function fa(e,t){return t.queues[e].currEv=!1,Promise.resolve(t)}function ba(e,t){var n=t.queues[e].currEv;return n?(t.queues[e].errored.push(n),fa(e,t)):Promise.resolve(t)}function va(e,t,n){return n.queues[e]?(n.queues[e].errored=t?[]:n.queues[e].errored.concat(n.queues[e].evs),n.queues[e].evs=[],fa(e,n)):Promise.resolve(n)}function Oa(e,t,n,a){var r=a.get().queues[e];if(r&&!r.currEv&&r.evs.length>0&&!r.pause){var i=Oa.bind(null,e,t,n,a),s=r.evs.shift();r.currEv=s,t(e,s).then(()=>{a.get().opts.waitCommit||a.set(fa.bind(null,e))}).then(i).catch(t=>a.set(ba.bind(null,e)).then(()=>{n(e,function(e,t){var n=ja(e,t.get()).errored;return n.length>0&&n[n.length-1]}(e,a),t)}).then(i))}}function ya(e,t,n){var a=n.queues[e];return a.errored.filter(e=>e.mess.messageId===t).forEach(e=>{e.failed=!1,a.evs.push(e)}),a.errored=a.errored.filter(e=>e.mess.messageId!==t),Promise.resolve(n)}function Ca(e){var t=Date.now();return Object.keys(e.queues).forEach(n=>Ea(n,e,t,18e5)),Promise.resolve(e)}function Ea(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,r=t.queues[e],i=[];return r.errored.forEach(e=>{e.ts>=n-a?(e.failed=!1,r.evs.push(e)):i.push(e)}),r.errored=i,Promise.resolve(t)}function ja(e,t){return t.queues[e]||(t.queues[e]={evs:[],pause:!1,errored:[],currEv:!1}),t.queues[e]}function Ta(e,t,n){return ja(e,n).pause=t,Promise.resolve(n)}function Sa(e,t,n){return t.ts=Date.now(),ja(e,n).evs.push(t),Promise.resolve(n)}function Ia(e){Object.keys(e.get().queues).forEach(t=>{e.set(ba.bind(null,t)),e.set(va.bind(null,t,!1))})}function Aa(e,t,n){var a=Object(C.default)({queues:{},debug:n&&n.debug,opts:extend({},n)},n);return n&&n.store?(a.setState(function(e){for(var t={},n=Object.keys(e.queues),a=n.length,r=0;r<a;r++){var i=n[r],s=e.queues[i];(s.currEv||s.evs.length||s.errored.length)&&(t[i]=s)}return{queues:t,opts:e.opts}}(a.get())),Ia(a)):Ia(a),{pushMessage:(n,r)=>a.set(Sa.bind(null,n,r)).then(a=>{Oa(n,e,t,a)}),resend(n){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return a.set(ya.bind(null,n,r)).then(()=>{var i=a.get().queues[n].evs.filter(e=>e.mess.messageId===r)[0];return Oa(n,e,t,a),i})},resendAll:()=>a.set(Ca).then(()=>{Object.keys(a.get().queues).forEach(n=>{Oa(n,e,t,a)})}),resendPeer:n=>a.set(Ea.bind(null,n)).then(()=>{Oa(n,e,t,a)}),reset:n=>a.set(va.bind(null,n,!0)).then(a=>{Oa(n,e,t,a)}),setErrored:(e,t)=>a.set(n=>(ja(e,n).errored=t,Promise.resolve(n))),pause(e){a.set(Ta.bind(null,e,!0))},isPaused:e=>!!ja(e,a.get()).pause,complete(n,r){var i=a.get();i.queues[n].currEv&&i.queues[n].currEv.rid===r&&a.set(fa.bind(null,n)).then(()=>{Oa(n,e,t,a)})},resume(n){a.set(Ta.bind(null,n,!1)).then(Object(vt.pause)(.1)).then(()=>{Oa(n,e,t,a)})},inspectQueue(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!a.get().queues[e])return[];var n=a.get().queues[e];return(t&&n.currEv?[n.currEv]:[]).concat(n.evs.slice()).concat(n.errored.slice().map(e=>extend({},e,{failed:!0}))).sort((e,t)=>e.ts-t.ts)}}}var wa=n("hOuX"),La=n("QGEU"),ka=n("BJj/"),Ma=(n("Oyvg"),n("rCUf")),Na="jpg jpeg png gif heic heif".split(" "),Pa=["application/vnd.rn-realmedia-vbr","application/vnd.rn-realmedia"];function Da(e){var t=Na.slice(0,Na.length);if("types"===e){for(var n=t.length,a=0;a<n;++a)t.push(t[a].toUpperCase());return"*."+t.join(";*.")}return"accept"===e?"."+Na.join(",."):"mask"===e?Na.join("|"):""}function Ra(e,t,n){var a=void 0!==t.ind?t.ind:t,r=t.fileName?a+"_"+t.fileName:t;if(re("upload"+r+"_progress_wrap"),e().unchoose(r),!geByClass1("popup_box_container")){var i=Object(o.getLang)("mail_add_doc_error");"wrong_music_file"===n?i=Object(o.getLang)("mail_upload_music_fail"):"wrong_arch_file"===n||"wrong_arch_mp3_file"===n?i=Object(o.getLang)("mail_upload_arch_fail"):"photo"===Upload.options[a].file_name?i=Object(o.getLang)("mail_add_photo_error"):"video_file"===Upload.options[a].file_name&&(i=Object(o.getLang)("video_upload_error")),setTimeout(Object(Ke.showFastBox)({title:Object(o.getLang)("global_error")},i).hide,2e3)}topError("Upload failed",{dt:-1,type:102,url:(ge("file_uploader_form"+a)||{}).action}),Upload.embed(a)}function xa(e){var t=void 0!==e.ind?e.ind:e,n=(e.fileName||e.filename||"").replace(/[&<>"']/g,""),a=n?t+"_"+n:e,r=ge("upload"+a+"_progress_wrap");return r&&hide(geByClass1("progress_x",r)),a}function Ba(e,t){if(!e().canAddMedia())return"none";if(!t.items||!t.items.length)return"media";var n="^("+Da("mask")+")";return[].slice.call(t.items).every(e=>{var t=e.type.split("/");return new RegExp(n,"i").test(t[1])})?"photo":[].slice.call(t.items).every(e=>"video"===e.type.split("/")[0]||~Pa.indexOf(e.type))?"video":"doc"}function Ha(e){var t=geByClass1("_im_upload_dropbox"),n=geByClass1("im-page--chat-header").getBoundingClientRect(),a=geByClass1("im-chat-input").getBoundingClientRect();(n.width<10||a.bottom-n.bottom<10)&&(e="none"),t.style.top=n.bottom+"px",t.style.left=n.left+1+"px",t.style.width=n.width-2+"px",t.style.height=a.bottom-n.bottom+"px",t.setAttribute("data-mode",e),"none"!==e&&t.classList.add("im-dropbox--visible")}function Fa(){geByClass1("_im_upload_dropbox").classList.remove("im-dropbox--visible")}function Ua(e,t,n){return{loaded:t,total:n,fileName:e.fileName?e.fileName.replace(/[&<>"']/g,""):void 0}}function Ga(e,t,n,a){"string"==typeof t&&t.indexOf("TERMINATED")>-1||(t=JSON.parse(t),Upload.onUploadError(e,t.error)),a().reHeight(n)}function qa(e,t,n,a,r){var i=t.get().upload_opts,s=geByClass1("_im_upload_photo",r),o=geByClass1("_im_drop_photo",r);return Upload.init(s,i.url,i.params,{accept:Da("accept"),file_name:"photo",file_size_limit:26214400,file_types:Da("types"),file_match:i.opts.ext_re,lang:i.opts.lang,multiple:1,multi_progress:1,max_files:10,chooseBox:1,clear:1,type:"photo",max_attempts:3,server:i.opts.server,error:i.opts.default_error,error_hash:i.opts.error_hash,dropbox:o,dragEl:bodyNode,onNoFilteredCallback(e){Upload.onFileApiSend(a,e)},onUploadStart(e,t){delete cur.notStarted,this.onUploadProgress(e,0,0)},onUploadComplete(e,a){var r=window.parseJSON(a);r.photos?function(e,t,n,a){var r=xa(e);ajax.post("al_photos.php",extend({act:"choose_uploaded"},t),{onDone:function(e,t){a().choose("photo",e,extend(t,{upload_ind:r}))},onFail:Ra.bind(null,a,e)})}(e,r,0,n):Ga(e,a,t,n)},onUploadProgress(e,t,a){var r=void 0!==e.ind?e.ind:e;n().progress("photo",r,Ua(e,t,a))},onUploadError(e,t){statlogsValueEvent("upload_photo_fails",1,i.opts.server,t),Ra(n,e,t)},onDragEnter(e){var t=geByClass1("im-audio-message_recording");e.dataTransfer&&!t&&Ha(Ba(n,e.dataTransfer))},onDragOut(){Fa()},onDrop(){Fa()}})}function Va(e,t,n,a){var r=t.get().upload_doc_opts,i=geByClass1("_im_upload_doc",a),s=geByClass1("_im_drop_doc",a);return Upload.init(i,r.url,r.params,{file_name:"file",file_size_limit:1024*(parseInt(r.file_size_limit_in_MB)||2048)*1024,file_types:"*.*;",lang:r.opts.lang,multiple:1,multi_progress:1,max_files:10,chooseBox:1,clear:1,type:"doc",max_attempts:3,server:r.opts.server,error:r.opts.default_error,error_hash:r.opts.error_hash,dropbox:s,dragEl:bodyNode,onUploadStart(e,t){delete cur.notStarted,this.onUploadProgress(e,0,0)},onUploadComplete(e,a){var i=window.parseJSON(a);i.file?function(e,t,n,a){var r=xa(e),i={act:"a_save_doc",blockPersonal:1,from:"choose",mail_add:1};n.opts.imhash&&(i=extend(i,{from_place:"from_gim",imhash:n.opts.imhash})),ajax.post("docs.php",extend(i,t),{onDone:function(e,t,n){a().choose("doc",e+"_"+t,extend(n,{upload_ind:r}))},onFail:Ra.bind(null,a,e)})}(e,i,r,n):Ga(e,a,t,n)},onUploadProgress(e,t,a){var r=void 0!==e.ind?e.ind:e;n().progress("doc",r,Ua(e,t,a))},onUploadError(e,t){statlogsValueEvent("upload_doc_fails",1,r.opts.server,t),Ra(n,e,t)}})}function Wa(e,t,n){removeEvent(bodyNode,"dragover dragenter");var r=geByClass1("_im_upload_dropbox"),i=Va(0,t,n,r),s=function(e,t,n,r,i){var s=t.get().upload_video_params;if(s){var o=geByClass1("_im_upload_video",i),l=geByClass1("_im_drop_video",i);return s.options.visible_dropbox=!1,Object(Ma.getUploadModule)(o,l,s,null,{onUploadStart:function(e,t){delete cur.notStarted,this.onUploadProgress(e,0,0)},onUploadComplete:function(e,r){var i=window.parseJSON(r);i.video_id?Object(Ma.onVideoUploaded)(e,i,t.get().textMediaSelector,(e,n)=>{var r=document.querySelector('[data-video="'+n+'"]'),i=e.editable.sizes.x[0]||e.thumb;if(r&&i){r.style.backgroundImage=`url(${i})`;var s=gpeByClass("_im_mess",r);"im"===cur.module&&s&&Object(a.updateVideoThumb)(t,s)}}):Ga(e,r,t,n)},onUploadProgress:function(e,t,a){var r=void 0!==e.ind?e.ind:e;n().progress("video",r,Ua(e,t,a))},onUploadError:function(e,t){statlogsValueEvent("upload_video_fails",1,s.options.server,t),Ra(n,e,t)},onNoFilteredCallback:function(e){Upload.onFileApiSend(r,e)},onDragEnter:function(e){var t=geByClass1("im-audio-message_recording");e.dataTransfer&&!t&&Ha(Ba(n,e.dataTransfer))},onDragOut:function(){Fa()},onDrop:function(){Fa()}})}}(0,t,n,i,r),l=qa(0,t,n,s,r);cur.lang.attachments_limit=t.get().upload_opts.opts.lang.max_files_warning;var c=Object(p.createModule)({handlers:e=>{var t=ge("im_full_upload");e(t,"change",(function a(r){if(window.Upload&&r.target.files){if(n().canAddMedia()){var i=Array.from(r.target.files),d=i.filter(e=>Upload.checkFileType(e.name,Da("types"))),u=i.filter(e=>Upload.checkFileType(e.name,Object(Ma.getUploadVideoExtMasks)("types")));Upload.onFileApiSend(l,d),Upload.onFileApiSend(s,u)}else Object(Ke.showFastBox)(Object(o.getLang)("global_error"),Object(o.getLang)("global_error"));Object(p.destroyModule)(c);var g=t.cloneNode();g.value="",t.parentNode.replaceChild(g,t),e(t=g,"change",a)}}))}});return{paste(e){Upload.onFileApiSend(l,e)},unmount(){Object(p.destroyModule)(c),Upload.deinit(l),Upload.deinit(s),Upload.deinit(i)}}}var Ka=n("wSs/"),Ya=n("rudk"),$a=n("g1O2");function za(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var n=[],a=!0,r=!1,i=void 0;try{for(var s,o=e[Symbol.iterator]();!(a=(s=o.next()).done)&&(n.push(s.value),!t||n.length!==t);a=!0);}catch(e){r=!0,i=e}finally{try{a||null==o.return||o.return()}finally{if(r)throw i}}return n}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return Xa(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Xa(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Xa(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,a=new Array(t);n<t;n++)a[n]=e[n];return a}function Qa(e,t){if(!e)return!1;window.tooltips&&tooltips.hide(e,t)}function Za(e){return e.map(e=>({id:e[1],type:e[0],kind:e[2]||null}))}function Ja(e,t,n,a,i,s){var o=!(arguments.length>6&&void 0!==arguments[6])||arguments[6];if(wr(t,a))return Promise.resolve(!1);var l=or(a);l.getBoundAttach(n.message)&&(n.message=""),n.share_url=l.getShareUrl(),n.cancelled_shares=l.getCancelledShares();var c=Object(wa.random)(),d={peerId:t,messageId:"rid"+c,flags:h.FLAG_OUTBOUND,date:intval(Date.now()/1e3)-a.get().timeshift,subject:"",text:Object(r.replaceSpecialSymbols)(clean(n.message)).replace(/\n/gi,"<br>"),local:!0,kludges:{emoji:!0,from_admin:a.get().gid?vk.id:null},type:h.ADD_MESSAGE,attaches:Za(n.attaches)};return n.rid=c,n.mess=d,e(t,n),a.get().longpoll.push([d]),o&&s().clearText(t,a),i().newMessage(a),Promise.resolve(!0)}function er(e,t,n,a,r,i,s){var o=arguments.length>7&&void 0!==arguments[7]&&arguments[7];o||(o=e.get().peer);var l=or(e),c=tr(l,s),d=c?l.dData.attaches.map(e=>[e.type,e.id]):[],u={message:"",attaches:[].concat(d,i)};s&&extend(u,s),nr(e,t,!1).then(()=>Ja(n,o,u,e,t,a,!1).then(n=>(c&&br(e,r,t),Promise.resolve(n)))).catch(t=>{debugLog(t),sr(e,r)})}function tr(e,t){var n=e.dData,a=t&&t.sticker_referrer,r=a&&0===a.indexOf("suggestion"),i=t&&t.is_hintach_item;return(!n.txt.trim()||r||i)&&0===n.attaches.filter(e=>"reply"!==e.type).length}function nr(e,t,n){return e.get().tabs[e.get().peer].skipped>0?(t().loadingPeer(e),e.setState({no_moving_down:!0}),e.set(a.changePeer.bind(null,e.get().peer,!1,!1)).then(()=>e.set(a.loadPeer.bind(null,e.get().peer,!0,-1,!1))).then(()=>(t().changePeer(e,!1),e.setState({no_moving_down:!1}),n))):Promise.resolve(n)}function ar(e,t,n){var r=!!intval(domData(n,"val"));r!==cur.ctrl_submit&&(cur.ctrl_submit=r,e.set(a.changeSubmitSettings.bind(null,r)))}function rr(e,t,n,r){return!e.get().delayed_ts&&setTimeout(()=>{e.set(a.setDelayedMessage.bind(null,!1,!1)).then(()=>{n(...r)})},t)}function ir(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Object(o.getLang)("mail_send_error"),t=Object(o.getLang)("global_error");Object(Ke.showFastBox)({title:t},e,Object(o.getLang)("mail_ok"),()=>{nav.reload({force:!0})})}function sr(e,t){document.activeElement&&document.activeElement.blur(),ir();var n=geByClass1("_im_send",t);return e.set(a.toggleSendingAbility.bind(null,!0)).then(()=>{Object(r.lockButton)(n)})}function or(e){return e.get().tfdraft||new Ot.ImDraft}function lr(e,t,n,s,o,l){var d=Object(i.getPeer)(e),u=Object(i.getCurrentKeyboard)(e)||{},g=u.one_time,m=void 0!==g&&g,p=geByClass1("_im_send",s);return Promise.resolve().then(()=>{if(Object(i.isSendingAvailable)(e)){if(Object(a.isAnythingLoading)(e.get())||!Object(r.isFullyLoadedTab)(e,e.get().peer)){var s=rr(e,2e3,lr,Object(_.toArray)(arguments));return e.set(a.setDelayedMessage.bind(null,!0,s)).then(()=>{Object(r.lockButton)(p)})}return clearTimeout(e.get().delayed_ts),e.set(a.setDelayedMessage.bind(null,!1,!1)).then(()=>Object(r.unlockButton)(p)).then(nr.bind(null,e,t)).then(()=>{var a=l.keyboardAuthorId,i=l.action||{},s=i.attaches||[],u=Object(c.decodeHTMLEntities)(i.payload||""),g=Object(c.decodeHTMLEntities)(i.label||"");Object(r.isChatPeer)(d)&&(g=`@${Object(V.oCacheGet)(e,a).link.slice(1)} ${g}`);return Object(q.statlogsValueEvent)("message_send_from_keyboard",0,e.get().id,d,a),Ja(n,d,{message:g,attaches:s,payload:u},e,t,o,!1)}).then(()=>m?e.set(a.deleteKeyboard.bind(null,d)):Promise.resolve()).then(()=>o().fixKeyboard())}}).catch(t=>{debugLog(t),sr(e,s)})}function cr(e,t,n,s,l,c){var d=arguments.length>6&&void 0!==arguments[6]?arguments[6]:[];return Promise.resolve().then(()=>{var u=geByClass1("_im_send",s);if(!Object(i.isSendingAvailable)(e))return!1;if(Object(a.isAnythingLoading)(e.get())||!Object(r.isFullyLoadedTab)(e,e.get().peer)){var g=rr(e,2e3,cr,Object(_.toArray)(arguments));return e.set(a.setDelayedMessage.bind(null,!0,g)).then(()=>{Object(r.lockButton)(u)})}clearTimeout(e.get().delayed_ts),l().saveText(e);var m=!1,p=or(e),f=p.dData.attaches.map(e=>{if("poll"==e.type){var t=c.pollData();return t||(m=!0),[e.type,e.id,t]}return[e.type,e.id]}).concat(d);if(m)return!1;var b=e.set(a.setDelayedMessage.bind(null,!1,!1)).then(()=>{Object(r.unlockButton)(u)}),v=Object(i.getPeer)(e);return b.then(nr.bind(null,e,t)).then(()=>{var a=p.dData.txt,i=t().getEditingMessage();if(i||a||f.length){if(i)return a||f.length&&!p.hasOnlyReplies(i)?Object(r.isMessageTooLong)(a)?void Object(Ke.showFastBox)(Object(o.getLang)("global_error"),Object(o.getLang)("mail_err_edit_too_long")):(t().cancelEditing(),void(Object(Ka.wasMessageReallyModified)(e,i,p)&&(Object(Ka.replaceMsgAfterEdit)(e,i,a,f,p.getShareUrl(),p.getCancelledShares()),t().sendEditMessage(e,i),e.get().longpoll.push([h.editMessageLocallyEvent(i)])))):void dr(e,t,s,i.messageId);var c=Object(r.splitMessageToParts)(a,f).map(a=>Ja(n,v,{message:a.msgText||"",attaches:a.attaches||[]},e,t,l));return Promise.all(c)}})}).catch(t=>{debugLog(t),sr(e,s)})}function dr(e,t,n,r){var i=e.get(),s=i.peer,l=Object(Ke.showFastBox)({title:Object(o.getLang)("mail_dialog_msg_delete_title"),dark:1},Object(o.getLang)("mail_dialog_msg_delete_for_all"),Object(o.getLang)("mail_delete"),(function(e){Object(a.removeMessageSend)([r],s,null,"deleteforall",i),l.hide(),t().cancelEditing()}),Object(o.getLang)("global_cancel"),(function(){l.hide(),pr(geByClass1("_im_text",n))}))}function ur(e,t,n){return e.set(a.deliverMessage.bind(null,t,n,{}))}function gr(e,t,n,a){e.get().longpoll.push([h.failedMessage(t,n.mess,a)])}function mr(e,t,n,s,o,l,c,d,u){var g,m=Object(ka.debounce)(Lr.bind(null,e,n),500);var _=Emoji.init(geByClass1("_im_text",t),{ttDiff:93,rPointer:!0,ref:"im",onSend:()=>Dr(e,t).then(e=>e&&s([])),controlsCont:t,forceTxt:!e.get().editable,checkEditable:function(n,s){var o=e.get().peer,l=Emoji.val(s);Object(r.isReservedPeer)(o)||wr(o,e)||or(e).dData.txt==l||!l||function(e){var t=e.get().peer;Object(r.isFullyLoadedTab)(e,t)&&!Object(i.isAnyMessageBeingEdited)(e)&&Date.now()-(Object(i.getTab)(e,t).lastTyping||0)>1e3*a.ACTIVITY_PERIOD&&e.set(a.sendTyping.bind(null,t))}(e),Rr(e,t,l),Br(e,t,l),m(s);var c=t.offsetHeight;if(g&&g!==c){var u=d().updateScroll();d().scrollFix(e,e.get().peer,u)}g=c},onStickerSend:(e,t,n)=>o([["sticker",e,n]],{sticker_referrer:t}),onHintachSend:(e,t)=>l([[e,t]],{is_hintach_item:!0}),uploadActions:c,suggestionsConfig:e.get().suggestionsConfig,clearText:function(){u().clearText(e.get().peer,e)}});return Emoji.emojiLoadMore(_),e.setState({emojiOptId:_}),_}function _r(e,t,n){var a=Emoji.val(geByClass1("_im_text",t));Object(i.isAnyMessageBeingEdited)(e)&&""!==a||Dr(e,t).then(t=>{var r=intval(domData(n.target,"tttype"));(2===r&&!0!==t||1===r&&!0===t||3!==r&&""===a)&&window.tooltips&&tooltips.destroy(n.target,{fasthide:!0});var s=or(e).dData.attaches.length>0;if(Object(i.isAnyMessageBeingEdited)(e)&&""===a&&!s)return domData(n.target,"tttype",3),Object(l.showTooltip)(n.target,{text:Object(o.getLang)("mail_delete_for_all"),black:!0,force:3!==r,appendParentCls:"_im_chat_input_parent",shift:[-8,-10]});if(!0!==t)return domData(n.target,"tttype",1),Object(l.showTooltip)(n.target,{text:Object(o.getLang)("mail_added_audiomsg"),black:!0,force:1!==r,appendParentCls:"_im_chat_input_parent",shift:[-8,-10]});domData(n.target,"tttype",2);var c=e.get().ctrl_submit?1:0;return Object(l.showTooltip)(n.target,{text:getTemplate("ctrl_submit_hint",{enter_on:c?"":"on",ctrl_on:c?"on":""}),dir:"down",shift:[-28,-5],needLeft:!0,className:"im-chat-input--tt",hasover:!0,force:2!==r,showdt:700,zIndex:200,hidedt:700,appendParentCls:"_im_chat_input_parent",onCreate(){radioBtns.im_submit={els:Object(_.toArray)(geByClass("_im_submit_btn")),val:c}}})})}function pr(e){Emoji.focus(e,!0),setTimeout(Emoji.correctCaret.pbind(e),10)}function hr(e,t,n,a){var l=e.getFwdRaw(),c=t.querySelector("._im_media_fwd"),d=t.parentNode.querySelector("._im_replied_content");if(!(Object(i.getCurrentKeyboard)(a)||{}).hide&&l&&n.toggleKeyboard(!0),c.innerHTML="",d.innerHTML="",l){var u=function(e,t){if(e.get().isEditing){var n=Object(r.getNowEditingMessage)(e);return n&&Object(s.hasReply)(n)}return"reply"===t.type}(a,l),g=u?d:c,m=l.object;g.innerHTML=u?fr(m):function(e,t,n,a){if(n.object&&n.object.authorName){var i=Object(r.renderShortText)(0,"",a.text,!0,Object(Ya.convertKludgesToAttaches)(a.kludges,0));return getTemplate("im_attach_mess",{messages:i,text:a.authorName,date:getSmDate(a.date,e.get().timeshift),modifier:"im-fwd_msg"})}return getTemplate("im_attach_mess",{messages:Object(o.getLang)("mail_title_X_msgs",t.getFwdCount()),text:Object(o.getLang)("mail_im_fwd_msgs_title"),date:"",modifier:""})}(a,e,l,m)}}function fr(e){var t=Object(r.renderShortText)(0,"",e.text,!0,Object(Ya.convertKludgesToAttaches)(e.kludges,0));return getTemplate("im_replied_message",{authorName:e.authorName,text:t})}function br(e,t,n){return e.set(a.forwardMessages.bind(null,null,or(e),!1)).then(()=>{var a=t.querySelector("._im_media_fwd"),r=t.parentNode.querySelector("._im_replied_content"),i=document.querySelector("._im_chat_audio_input_parent ._im_replied_content");r&&r.children.length&&(r.innerHTML="",yr(e,n)),i&&i.children.length&&(i.innerHTML="",yr(e,n)),a&&a.children.length&&(a.innerHTML="",yr(e,n)),Rr(e,t)})}function vr(e,t,n){var r=Object(i.getPeer)(e);e.set(a.acceptMessageRequest.bind(null,r)).then(()=>{Pr(e,r,t),n()}).catch(()=>ir())}function Or(e,t,n){var s=Object(i.getPeer)(e);e.set(a.rejectMessageRequest.bind(null,s)).then(()=>{Object(r.isClassicInterface)(e)&&t(e),n(e,s),s===e.get().peer&&e.get().longpoll.push([h.resetPeer()])}).catch(()=>ir())}function yr(e,t){var n=t().updateScroll();t().scrollFix(e,e.get().peer,n)}function Cr(e,t,n,r){var i=e.get().peer,s=inArray(i,e.get().mutedPeers);e.set(a.toggleMutePeer.bind(null,i,!s,-1)).then(n().updateState.bind(null,i)),cancelEvent(r)}function Er(e,t,n,r){var i=e.get().peer;e.set(a.returnToChat.bind(null,i)).then(e=>e.set(a.getPinnedMessage.bind(null,i))).then(n().updateChatTopic.bind(null,i)),cancelEvent(r)}function jr(e,t,n,a,s,o,l,c){if("close"!==l&&"open"!==l&&"hide"!==l)throw new Error(`Action "${l}" not found`);var d=e.get(),u=Object(i.getCurrentKeyboard)(e);(Object(r.isCommunityInterface)(e)||!u||d.isEditing)&&(l="hide");var g="close"===l||"hide"===l,m=Promise.resolve();g||n.isMounted||(m=n.init());var _=!u&&"open"!==l;return m.then(()=>(toggleClass(t,"im-chat-input_open-keyboard",!g),toggleClass(t,"im-chat-input_close-keyboard",g&&"hide"!==l),toggleClass(a,"im_chat-input--keyboard-button_hidden","hide"===l),n.toggle(d.peer,g,o))).then(()=>{if(!_||c){var t=s().updateScroll();return s().scrollFix(e,d.peer,t)}})}function Tr(e,t){if(Object(i.isAnyMessageBeingEdited)(e))return!1;var n=e.get();if(Object(r.isCommunityInterface)(e))return!1;if(!Object(i.getCurrentTab)(e).moneyTransferAvail)return!1;if(Object(r.isCommunityPeer)(t))return n.moneyTransferCommAvail;if(Object(r.isUserPeer)(t)){var a=inArray(t,n.moneyTransferExcept);return t!=vk.id&&!a&&!Object(r.isContactPeer)(t)}return!1}function Sr(e,t){return!Object(i.isAnyMessageBeingEdited)(e)&&(!!e.get().moneyRequestAvail&&(!!Object(i.getCurrentTab)(e).moneyRequestAvail&&(!(!Object(r.isCommunityPeer)(t)&&!Object(r.isChatPeer)(t))||!!Object(r.isUserPeer)(t)&&(t!=vk.id&&!Object(r.isContactPeer)(t)))))}function Ir(e,t,n,a,s,o,l,c,d,u,g,m,_,h,f,b){return{restoreKeyboard(){this.toggleKeyboard(!!(ls.get("is_keyboards_hide")||{})[Object(i.getPeer)(e)])},toggleKeyboard(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:!Object(i.getCurrentKeyboard)(e).hide,n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return jr(e,a,m,g,o,n,t?"close":"open")},initKeyboard(){if(!e.get().peer||!Object(i.getCurrentKeyboard)(e))return Promise.resolve();var t=!!(ls.get("is_keyboards_hide")||{})[Object(i.getPeer)(e)];return jr(e,a,m,g,o,!0,t?"close":"open")},fixKeyboard(){var t,n=Object(i.getCurrentKeyboard)(e);return t=n?n.hide?"close":"open":"hide",jr(e,a,m,g,o,!0,t,!0)},hideKeyboard:()=>jr(e,a,m,g,o,!1,"hide"),restoreDraft(e,s,l){t.chosenMedias.length>0&&(e.setState({removingMedias:!0}),t.unchooseMedia(),t.chosenMedias=[],e.setState({removingMedias:!1}));var c=e.get().peer,d={gift:Object(r.isGiftOptionAvailableForPeer)(e,c)&&!Object(i.isAnyMessageBeingEdited)(e),money:Object(r.isMoneyOptionAvailableForPeer)(e,c)&&!Object(i.isAnyMessageBeingEdited)(e),poll:Object(r.isChatPeer)(c)},u=geByClass1("ms_items_more",a);Object.entries(d).forEach(e=>{var t=za(e,2),n=t[0],a=t[1],r=geByClass1("ms_item_"+n,u);toggleClass(r,"ms_item--hidden",!a)});var g={im:!0,fromId:-Object(i.getGroupId)(e)||vk.id,peer:c,moneyTransfer:{request:Sr(e,c),send:Tr(e,c)}},m=e.get().emojiOptId;if(void 0===m?e.setState({suggestionsConfig:g}):Emoji.setSuggestionsConfig(m,g),Object(r.isReservedPeer)(c))return Promise.resolve();var _=or(e);return Emoji.val(n)!==_.dData.txt?(!function(e,t){Emoji.val(e,clean(t)),pr(e)}(n,_.dData.txt),Br(e,a,_.dData.txt)):pr(n),_.prepareObjects(e.get().gid,s&&s.messageId).then(()=>{if(!Pr(e,c,n)&&c==e.get().peer){for(var r=_.dData.attaches,i=0;i<r.length;i++)t.chooseMedia(r[i].type,r[i].id,r[i].object||{});if(hr(_,a,this,e),l){var s=o().updateScroll();o().scrollFix(e,c,s)}Rr(e,a,_.dData.txt)}})},sendMessage(){s([])},sendMessageFromKeyboard(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return lr.call(null,e,o,h,a,...n)},choose(e,n,a){t.chooseMedia(e,n,a)},updateChosenMedia(e,n,a){t.updateChosenMedia(e,n,a)},canAddMedia:()=>!t.hasRestrictingAttach()&&!wr(e.get().peer,e),isEmpty:e=>!trim(Emoji.val(n))&&!or(e).hasAttaches(),unchoose(e){t.unchooseMedia(e)},attachCount:()=>t.attachCount(),progress(e,n,a){t.showMediaProgress(e,n,a)},updateState(e){this.restoreKeyboard(),Pr(e,e.get().peer,n)},focusOn(e){Emoji.editableFocus(n,!1,!0)},setDraft(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],a=Object(i.getTab)(e,e.get().peer);Object(W.doesChatTabHaveFlag)(a,1024)&&!e.get().gid||(_&&_.update(),e.setState({tfdraft:t}),t&&this.restoreDraft(e,o().getEditingMessage(),n))},clearText(e,r){or(r).clear(),t.cancelCheckUrl(),t.unchooseMedia(),t.chosenMedias=[],Emoji.val(n,""),br(r,a,o);var i=o().updateScroll();o().scrollFix(r,r.get().peer,i)},attachMessages(e,t){if(e.get().peer===t){hr(or(e),a,this,e);var n=o().updateScroll();o().scrollFix(e,t,n),Rr(e,a)}},detachMessages(t){var n=or(e).getFwdRaw();if(n&&!!n.id.split(";").find(e=>Math.abs(e)===t.messageId))return br(e,a,o).then(()=>{var t=o().updateScroll();o().scrollFix(e,e.get().peer,t)});return Promise.resolve()},cancelRecording(){u.cancelRecording()},reHeight(e){var t=o().updateScroll();o().scrollFix(e,e.get().peer,t)},isBlocked:()=>wr(e.get().peer,e),toggleStickers(e,t){Emoji.toggleStickers(e.get().emojiOptId,!t)},saveText(e){or(e).setText(Emoji.val(geByClass1("_im_text",a)))},resendAll(){f()},resendPeer(){b(e.get().peer)},unmount(){Object(p.destroyModule)(d),t.destroy(),c.unmount(),m.unmount(),_&&_.unmount(),Emoji.destroy(e.get().emojiOptId),u.unmount()}}}function Ar(e,t){return!!Object(r.isChatPeer)(e)&&t.get().tabs[e].data.kicked}function wr(e,t){return Ar(e,t)||Object(i.getTab)(t,e)&&Object(i.getTab)(t,e).block_error>0||Object(r.isLocksAvailable)(t)&&Object(r.isPeerBlocked)(e,t)}function Lr(e,t,n){var a=e.get().peer,i=Emoji.val(n);Object(r.isReservedPeer)(a)||or(e).dData.txt==i||wr(a,e)||(t.checkMessageURLs(i,!0,2e3),or(e).setText(i))}function kr(e){var t=or(e).getFwdRaw();t&&window.showForwardBox({act:"a_show_forward_box",will_fwd:t.id,gid:e.get().gid})}function Mr(e,t){e.disabled=!0,e.contentEditable="false",addClass(e,"im-chat-input--text_disabled"),addClass(t,"im-chat-input_error"),addClass(geByClass1("_im_page_history"),"is_tf_blocked")}function Nr(e,t){e.disabled=!1,e.contentEditable="true",removeClass(e,"im-chat-input--text_disabled"),removeClass(t,"im-chat-input_error"),removeClass(geByClass1("_im_page_history"),"is_tf_blocked")}function Pr(e,t,n){var a=gpeByClass("_im_chat_input_parent",n),s=geByClass1("_im_chat_input_error",a),l=Object(i.getTab)(e,t);if(wr(t,e)){Mr(n,a);var c=function(e,t,n){switch(n.block_error){case 7:case 5:return Object(o.getLang)("mail_peer_deleted");case 14:return Object(o.getLang)("mail_community_deleted");case 11:return Object(o.getLang)("mail_group_banned_messages");case 28:return Object(o.getLang)("mail_cant_send_messages_by_time");case 29:return Object(o.getLang)("mail_cant_send_messages_by_web_bot");case 4:case 6:case 9:case 19:case 20:case 13:return Object(r.isCommunityPeer)(t)?Object(o.getLang)("mail_send_privacy_community_error"):Object(o.getLang)("mail_send_privacy_error");case 23:var a=Object(V.oCacheGet)(e,t);return langSex(a.sex,Object(o.getLang)("mail_blacklist_user","raw")).replace("{user}",a.kick_name);case 12:return Object(o.getLang)("mail_cant_send_messages_to_community");case 16:return Object(o.getLang)("mail_chat_youre_kicked");case 26:return Object(o.getLang)("mail_chats_is_disabled");case 0:if(Ar(t,e))return Object(o.getLang)("mail_chat_youre_kicked");var i=e.get().block_states[t].name;return Object(o.getLang)("mail_community_answering").replace("{username}",i);default:return Object(o.getLang)("mail_send_privacy_error")}}(e,t,l);if(Object(i.isChannelPeer)(l)&&addClass(geByClass1("_im_page_history"),"is_channel"),Object(r.isFvkcomgroup)(e,t)&&!e.get().gid){addClass(a,"is-f-vkcomgroup");var d=inArray(t,e.get().mutedPeers);c=Object(i.isChatActive)(l)?getTemplate("sImPeerMuteUnmute",{text:d?Object(o.getLang)("mail_im_unmute"):Object(o.getLang)("mail_im_mute"),cls:d?"im-action_unmute":"im-action_mute"}):getTemplate("sImPeerReturnToChat",{text:Object(o.getLang)("mail_return_to_vkcomgroup")})}else removeClass(a,"is-f-vkcomgroup");return val(s,c),!0}return l&&Object(r.tabIsMessageRequest)(l)&&!Object(r.tabIsRejectedMessageRequest)(l)?(Mr(n,a),addClass(a,"is-message_request"),val(s,getTemplate("sImPeerAcceptOrRejectMessageRequest",{cls_accept:"_mr_button_accept",cls_reject:"_mr_button_reject"})),!0):(a.classList.contains("is-message_request")&&(Nr(n,a),removeClass(a,"is-message_request"),val(s,"")),n.disabled&&(removeClass(a,"is-f-vkcomgroup"),removeClass(geByClass1("_im_page_history"),"is_channel"),Nr(n,a),removeClass(a,"is-message_request"),val(s,"")),!1)}function Dr(e,t,n){return Object(r.isVoiceMessageAvailable)(e).then(a=>{if(!a&&!Object(i.isAnyMessageBeingEdited)(e))return!0;var s=null!=n?n:Emoji.val(geByClass1("_im_text",t));if(trim(s))return!Object(i.isAnyMessageBeingEdited)(e)||!Object(r.isMessageTooLong)(s);var o=or(e),l=Object(r.getNowEditingMessage)(e);return o.hasAttaches()&&!o.hasOnlyReplies(l)})}function Rr(e,t,n){var a=geByClass1("_im_send",t.parentNode);Qa(a,{fasthide:!0}),Dr(e,t,n).then(t=>{if(Object(i.isAnyMessageBeingEdited)(e))toggleClass(a,"is_input_empty",!t),attr(a,"aria-label",Object(o.getLang)("mail_im_edit"));else{toggleClass(a,"im-send-btn_audio",!t),toggleClass(a,"im-send-btn_send",t),t&&removeClass(a,"im-send-btn_saudio");var n=t?Object(o.getLang)("mail_send2"):Object(o.getLang)("mail_added_audiomsg");attr(a,"aria-label",n)}})}function xr(e){var t=geByClass1("MassMentionWarning",e);t.classList.contains("MassMentionWarning--hidden")||t.classList.add("MassMentionWarning--hidden")}function Br(e,t,n){var a=Object(i.getCurrentTab)(e);if(a){if(!Object(r.isChatPeer)(a.peerId)||Object(i.isChannelPeer)(a))return xr(t);var s=(n.match(y.RE_MASSMENTION)||[]).map(e=>e.slice(1));if(0===s.length)return xr(t),void e.set(e=>(a.dontReopenWarningForCurrentMassMention=!1,Promise.resolve(e)));var l=geByClass1("MassMentionWarning",t),c=geByClass1("MassMentionWarning__title",l),d=geByClass1("MassMentionWarning__text",l),u=(e,t)=>{a.dontReopenWarningForCurrentMassMention||(c.innerHTML!==e&&(c.innerHTML=e),d.innerHTML!==t&&(d.innerHTML=t),l.classList.remove("MassMentionWarning--hidden"))},g=y.MASS_MENTION_ALIASES.all.some(e=>s.includes(e)),m=y.MASS_MENTION_ALIASES.online.some(e=>s.includes(e));switch(!0){case g&&a.membersCount>=11:return u(Object(o.getLang)("mail_im_mass_mention_warning_title"),Object(o.getLang)("mail_im_mass_mention_warning_many_people_mentioned_text",a.membersCount-1));case m&&a.membersCount>=30:return u(Object(o.getLang)("mail_im_mass_mention_warning_title"),Object(o.getLang)("mail_im_mass_mention_warning_maybe_many_people_mentioned_text"));default:return xr(t)}}}function Hr(e,t,n,s,c){cur.share_timehash=t.get().share_timehash;var d=Object(p.createMutations)(Ir),u=d.callMutations,g=d.bindMutations,m=Wa(0,t,u),_=ur.bind(null,t);ls.remove("im_send_queue_2"+vk.id),ls.remove("im_send_queue_1"+vk.id);var f=Aa(_,gr.bind(null,t),{store:"ls",key:"im_send_queue_"+vk.id,waitCommit:!0}),b=f.pushMessage,v=f.inspectQueue,O=f.resend,y=f.resendAll,C=f.resendPeer,E=f.setErrored,j=f.complete,T=er.bind(null,t,c,b,u,e),S=er.bind(null,t,c,b,u,e),I=kr.bind(null,t);hide(geByClass1("ms_items_more_helper",e));var A=t.get().mediaTypes||[["photo",Object(o.getLang)("mail_added_photo")],["video",Object(o.getLang)("profile_wall_video")],["audio",Object(o.getLang)("profile_wall_audio")],["doc",Object(o.getLang)("profile_wall_doc")],["map",Object(o.getLang)("profile_wall_map")],["gift",Object(o.getLang)("profile_wall_gift")]];(t.get().moneyTransferAvail||t.get().moneyRequestAvail)&&A.push(["money",Object(o.getLang)("profile_wall_money")]);var w=new MediaSelector(geByClass1("_im_media_selector",e),"_im_media_preview",A,{from:"message",maxShown:0,vectorIcon:!0,ignoreMobile:!0,onAddMediaChange:function(n,r,i,s){return n&&u().toggleKeyboard(!0),function(e,t,n,r,i,s,o,l,c){if(!t.get().removingMedias){if("album"===i||"page"===i||"mail"===i||"reply"===i)return!1;if("share"===i&&!o.title)return!1;var d,u;s&&"string"==typeof i?(l&&or(t).addBindUrl(l,i,s),or(t).addAttach(i,s,o)):(or(t).syncWithSelector(c),"number"==typeof s&&c.chosenMedias[s]&&(d=c.chosenMedias[s],u=or(t),("string"==typeof d[0]&&"string"==typeof d[1]&&d[1]||"string"==typeof d[0]&&"group"===d[0])&&u.dData.cancelled.push(`${d[0]},${d[1]}`)));var g=e().updateScroll();if(e().scrollFix(t,t.get().peer,g),t.get().delayed_message&&!Object(a.isAnythingLoading)(t.get()))return n([]),!1;Rr(t,r)}}(c,t,L,e,n,r,i,s,w)},onMediaChange:function(){return function(e,t,n,a,r){if(!t.get().removingMedias){var i=r.getMedias().find(e=>"poll"===e[0]);i&&or(t).addAttach(i[0],i[1],r.pollData(!0,!0)),Rr(t,a)}}(0,t,0,e,w)},editable:1,onChangedSize:function(){var n,a,r=c().updateScroll();c().scrollFix(t,t.get().peer,r),n=e,a=ge("_im_media_preview").offsetHeight,toggleClass(n,"im-chat-input--overflowed",a>400)},sortable:1,teWidth:150,mail:1,teHeight:100,forceToUp:!0,toId:t.get().gid?-t.get().gid:void 0,blockPersonal:t.get().gid?1:0,docParams:t.get().gid?{imhash:t.get().upload_doc_opts.opts.imhash,from:"from_gim"}:{}}),L=cr.bind(null,t,c,b,e,u,w),k=_r.bind(null,t,e),M=geByClass1("_im_send",e),N=er.bind(null,t,c,b,u,e),P=Xn(e,t,N,()=>{addClass(M,"im-send-btn_audio"),removeClass(M,"im-send-btn_static")},()=>{u().restoreKeyboard()});!function(e,t){var n=geByClass1("_im_text",e),a=Object(vt.promisify)(stManager.add);(window.Wall?Promise.resolve():a(["page.js"])).then((function(){Wall.initComposer(n,{lang:{introText:Object(o.getLang)("profile_mention_start_typing"),noResult:Object(o.getLang)("profile_mention_not_found")},toup:!0,getValue:()=>t.get().peer>2e9?(window.Emoji&&Emoji.editableVal||val)(n):"",onShow:()=>{addClass(e,"im_mention_shown");var t=data(n,"composer");if(t&&t.wdd&&t.wdd.shown){var a=0,r=!1,i=function(){t.ignoredTerm=t.curTerm,t.curTerm=!1,val(t.wddInput,""),Composer.toggleSelectList(t)};each(t.wdd.shown,(function(){this[0]&&(a++,"@"+t.curTerm==this[2]&&(r=!0))})),!a||r&&1==a?i():cancelStackPush("im_mention",i)}},onHide:()=>{removeClass(e,"im_mention_shown"),cancelStackFilter("im_mention")},searchKeys:[1,7,9],wddOpts:{}})}))}(e,t),t.get().textMediaSelector=w,t.set(a.initTextStore.bind(null,v,O,E,j));var D=geByClass1("_im_text",e);setTimeout(()=>{Object(i.getPeer)(t)&&u().setDraft(t,Object(i.getTabDraft)(Object(i.getCurrentTab)(t))),mr(t,e,w,L,T,S,m,c,u)},0);var R=br.bind(null,t,e,c),x=vr.bind(null,t,D,()=>{var e=c().updateScroll();c().scrollFix(t,Object(i.getPeer)(t),e)}),B=Or.bind(null,t,n,s),H=Cr.bind(null,t,e,c),F=Er.bind(null,t,e,c),U=ar.bind(null,t);Pr(t,t.get().peer,D);var G=e.querySelector("._im_keyboard_button"),q=function(e,t,n,a,r){return(0,Object(p.createMutations)(la).bindMutations)(Object(p.createModule)({handlers:(e,t)=>{}}),t,a)}(0,t,0,lr.bind(null,t,c,b,e,u)),V=Object(r.isCommunityInterface)(t)?function(e,t,n,a){var r=(0,Object(p.createMutations)(ha).bindMutations)(Object(p.createModule)({handlers:function(){}}),e,t,n,a);if("function"!=typeof r){r.toggleImText();var i=Xe.createElement(Je.default,{value:e},Xe.createElement(da,{getTemplates:r.getPreparedTemplates,applyTemplate:r.applyTemplate.bind(r),isNeededRendering:r.isNeedRenderTemplates,showSettingsPopup:r.showSettingsPopup.bind(r,ma),showCreatingTemplatePopup:r.showSettingsPopup.bind(r,_a)}));Ze.render(i,t)}return r}(t,e.querySelector("._message_templates_container"),e=>Object($a.setHTML)(D,e),t=>toggleClass(e,"im-chat-input--textarea_show-templates",t)):null,W=Object(p.createModule)({handlers:(n,r)=>{n(M,"click",()=>{xr(e),Promise.resolve().then(()=>Dr(t,e)).then(e=>{if(e||Object(i.isAnyMessageBeingEdited)(t))L([]);else{var n=or(t);tr(n)&&function(e){var t=document.querySelector("._im_chat_audio_input_parent ._im_replied_content"),n=e.getFwdRaw();if(n){var a=n.object;t&&(t.innerHTML=fr(a))}else t.innerHTML=""}(n),Qa(M,{fasthide:!0}),P.start(),setTimeout(()=>removeClass(M,"im-send-btn_saudio"),300)}})}),n(M,"mouseover",k),n(D,"focus",()=>{t.get().longpoll.push([h.transitionEvent("message")]),cur.focused=t.get().peer}),n(D,"blur",()=>{var e=0===t.get().peer?"search":"default";t.get().longpoll.push([h.transitionEvent(e)]),cur.focused=!1}),n(G,"click",()=>u().toggleKeyboard(void 0)),n(G,"mouseover",()=>{Object(l.showTooltip)(G,{text(){var e=Object(i.getCurrentKeyboard)(t);return!e||e.hide?Object(o.getLang)("mail_show_keyboard"):Object(o.getLang)("mail_hide_keyboard")},black:!0,shift:[4,5]})}),n(geByClass1("MassMentionWarning__close"),"click",()=>{!function(e,t){xr(t),e.set(e=>(Object(i.getCurrentTab)(e).dontReopenWarningForCurrentMassMention=!0,Promise.resolve(e)))}(t,e),pr(D)}),r(e.parentNode,"click","_im_peer_mute_unmute",H),r(e.parentNode,"click","_im_peer_return_to_chat",F),r(e.parentNode,"click","_im_remove_replied",R),r(e.parentNode,"click","_mr_button_accept",x),r(e.parentNode,"click","_mr_button_reject",B),r(e,"click","_im_fwd_close",R),r(e,"click","_im_will_fwd",I),r(e,"keydown","_im_text",e=>function(e,t,n,r){if(38===r.which&&n().isEmpty(e)&&!t().getEditingMessage()&&!Emoji.shown&&!Object(La.hasAccessibilityMode)()&&!Object(a.isAnythingLoading)(e.get())){var s=Object(Ka.findLastMessageToEdit)(e,Object(i.getCurrentTab)(e));s&&t().startEditing(Object(i.getMessage)(e,e.get().peer,s))}}(t,c,u,e)),r(bodyNode,"click","_im_submit_btn",U)}}),K=g(t,w,D,e,L,c,v,m,W,P,G,q,V,b,y,C);return K.initKeyboard(),K}function Fr(e,t,n,a,r,i){return{focus(e){uiSearch.focus(t),function(e,t,n,a){cancelStackPush("im_hist_search",Wr.bind(null,e,t,n,a))}(e,t,n,a)},changePeer(e,n){uiSearch.getFieldEl(t).value=n.get().tabs[e].searchText||""},search(){i({})},unmount(){Object(p.destroyModule)(r),cancelStackFilter("im_hist_search"),a.then(e=>e.destroy())}}}function Ur(e,t,n,r){e.set(a.setCurrentSearchDate.bind(null,e.get().peer,`${r.d}.${r.m}.${r.y}`)).then(qr.bind(null,e,t,n))}function Gr(e,t){e.then(e=>{triggerEvent(geByClass1("datepicker_control",t),"mousedown",!1,!0)})}function qr(e,t,n){var r=e.get().peer;uiSearch.showProgress(n),Object(a.searchMessagesInplace)(r,e.get()).then(a=>{uiSearch.hideProgress(n),t().insertSearch(a,e)}).catch(()=>{uiSearch.focus(n),uiSearch.hideProgress(n)})}function Vr(e,t,n,r,i,s){if("keyup"!==s.type||13==s.which){var o=clean(uiSearch.getFieldEl(t).value);e.set(a.setCurrentSearch.bind(null,o,e.get().peer)).then(i.bind(null,e,r,t))}}function Wr(e,t,n,r){cancelStackFilter("im_hist_search"),r.then(e=>{e.hide()}),e.set(a.cancelSearch.bind(null,e.get().peer)).then(()=>{uiSearch.getFieldEl(t).value="",n().cancelSearch(e)})}function Kr(e,t,n,r){n.then(e=>{e.hide()}),e.set(a.clearDate.bind(null,e.get().peer)).then(qr.bind(null,e,t,r))}function Yr(e,t,n){var a=geByClass1("_im_search_date_input",e),r=geByClass1("_im_search_history_input",e),i=function(e,t,n,a){var r='<td class="cal_clear" colspan="7"><button type="button" class="im_cal_clear_lnk _im_clear_date">'+getLang("wall_clear_date_filter")+"</button></td>";return new Promise(e=>{stManager.add(["ui_controls.js",window.jsc("web/datepicker.js"),"datepicker.css"],(function(){var t=new Datepicker(n,{width:140,resfmt:"plain",addRows:'<tr id="im_day_clear">'+r+"</tr>",addRowsM:'<tr id="im_month_clear">'+r+"</tr>",onUpdate:a,pastActive:!0,noFuture:!0});e(t)}))})}(0,0,a,Ur.bind(null,t,n,r)),s=Gr.bind(null,i,e),o=Vr.bind(null,t,r,a,n,Object(ka.debounce)(qr,300)),l=Wr.bind(null,t,r,n,i),c=Kr.bind(null,t,n,i,r),d=Object(p.createModule)({handlers:(t,n)=>{t(geByClass1("_im_search_date",e),"click",s),t(uiSearch.getFieldEl(r),"keyup",o),t(geByClass1("_im_start_inplace_search",e),"click",o),t(geByClass1("_im_cancel_inplace_search",e),"click",l),n(e,"click","_im_clear_date",c)}});return Fr(0,r,n,i,d,o)}function $r(e,t,n,a,i){var s=Object(r.getHistoryTopIndent)(e);Object(l.showTooltip)(t,{shift:[n,10],black:1,className:"_im_history_tooltip "+a,appendParentCls:"_im_mess_stack",toup:t.getBoundingClientRect().top>s+37,text:i})}function zr(e,t,n){var r=gpeByClass("_im_mess",n),o=intval(domData(r,"msgid")),l=e.get().peer,c=Object(i.getMessage)(e,l,o),d=!Object(s.isImportant)(c);return e.get().longpoll.push([{peerId:l,messageId:o,type:d?h.SET_FLAGS:h.RESET_FLAGS,flags:h.FLAG_IMPORTANT}]),e.set(a.favMessage.bind(null,[o],d,l)),Xr(e,-10,t,n,!0),!1}function Xr(e,t,n,a,r){var o=domData(gpeByClass("_im_mess",a),"msgid"),l=Object(i.getMessage)(e,e.get().peer,o),c=getLang("mail_im_unmark_important"),d=getLang("mail_im_toggle_important"),u=Object(s.isImportant)(l)?c:d,g=u.length>16;r&&window.tooltips&&tooltips.destroy(a),$r(e,a,g?84:34,g?"im-star-tt_long":"im-star-tt",l?u:"")}function Qr(e,t,n,i){var s=e.get().peer,o=+domData(domClosest("im-mess",i.target),"msgid");if(Object(r.canForwardMessages)(e,[o]))return Object(qe.statlogsForwardFromChannel)(),Object(a.processFwd)([o],s,e).then(t=>e.set(a.prepareForward.bind(null,t))).then(()=>{Nt(0,e)}),!1}function Zr(e,t,n){var r=e.get().peer,i=+domData(domClosest("im-mess",n.target),"msgid");return Object(a.processFwd)([i],r,e).then(t=>e.set(a.forwardMessages.bind(null,t,e.get().tfdraft,!0))).then(()=>t().respond(e,r)),!1}function Jr(e,t,n,a){$r(e,a,18,"im-reply-tt",getLang("mail_im_mark_forward"))}function ei(e,t,n,a){$r(e,a,18,"im-reply-tt",getLang("mail_im_reply"))}function ti(e,t,n,a){var r=intval(domData(gpeByClass("_im_mess",a),"msgid")),s=Object(i.getMessage)(e,e.get().peer,r);return s&&t().startEditing(s),!1}function ni(e,t,n){$r(e,n,18,"im-edit-tt",getLang("mail_im_edit"))}function ai(e,t,n){var a=Xr.bind(null,t,0),i=zr.bind(null,t),s=Jr.bind(null,t,0),o=Qr.bind(null,t,e.querySelector("_im_dialog_actions"),n),l=ei.bind(null,t,0),c=Zr.bind(null,t,n),d=ni.bind(null,t),u=ti.bind(null,t,n),g=Object(p.createModule)({handlers:(t,n)=>{n(e,"click","_im_mess_fav",i),n(e,"mouseover","_im_mess_fav",a),n(e,"click","_im_mess_forward",o),n(e,"mouseover","_im_mess_forward",s),n(e,"click","_im_mess_reply",c),n(e,"mouseover","_im_mess_reply",l),n(e,"click","_im_mess_edit",u),n(e,"mouseover","_im_mess_edit",d)}});return function(e,t){return{markImportant(t,n,a){Object(r.updateStar)(t,n,e)},unmount(){Object(p.destroyModule)(t)}}}(e,g)}function ri(e,t,n,s,o){if(!Object(a.isSearchingInplace)(e.get().peer,e.get())&&!(hasClass(o,r.FAILED_CLASS)||hasClass(o,r.SENDING_CLASS)||hasClass(o,"_im_mess_srv")||Object(r.checkSelectClick)(s,o)||Object(i.isAnyMessageBeingEdited)(e)||"A"===s.target.tagName||domClosest("_im_replied_message",s.target)||s.target.classList.contains("_im_retry_media")||s.target.closest("."+r.MESSAGE_KEYBOARD_BUTTON_CLASS))){var l,c,d=intval(domData(o,"msgid")),u=e.get().peer;if(!Object(r.isAlreadyDeleted)(e,u,d))l=s.shiftKey?Object(i.getMessageRangeFromSelection)(e,u,d):[d],e.set(a.addSelection.bind(null,l)).then(()=>{var a=Object(i.getSelectedMessages)(e),r=!1;l.forEach(e=>{var t=geByClass1("_im_mess_"+e,n);if(t){var i=inArray(e,a);r|=i,toggleClass(t,"im-mess_selected",i);var s=i?getLang("mail_deselect_message"):getLang("mail_select_message"),o=geByClass1("_im_mess_blind_label_select",t);attr(o,"aria-label",s)}}),r&&(window.getSelection?window.getSelection().empty?window.getSelection().empty():window.getSelection().removeAllRanges&&window.getSelection().removeAllRanges():document.selection&&document.selection.empty()),t().changedMessageSelection(e)}).then(()=>{1!==e.get().selectedMessages.length||c?c&&c.hide():c=function(e){var t=e.get();if(t.pinnedMessagesPromo&&Object(r.isChatPeer)(t.peer)){var n=geByClass1("_mess-action-promo"),i=new ElementTooltip(n,{autoShow:!1,appendTo:n,content:getTemplate("im_pinned_messages_promo",{content:getLang("mail_pinned_messages_promo_tooltip")}),forceSide:"bottom",cls:"feature_intro_tt",width:260,onHide:function(){e.setState({pinnedMessagesPromo:!1}),Object(a.hidePromoTooltip)()}});return i.show(),i}}(e)})}}function ii(e,t,n){var a=ri.bind(null,t,n,e),r=Object(p.createModule)({handlers:(t,n)=>{n(e,"click","_im_mess",a)}});return function(e,t){return{cleanSelection(t){t&&Array.isArray(t)&&t.length&&t.map(t=>geByClass1("_im_mess_"+t,e)).filter(e=>e).forEach(e=>removeClass(e,"im-mess_selected"))},unmount(){Object(p.destroyModule)(t)}}}(e,r)}function si(e,t,n){var a=n.get(),r=a.observer,o=a.targets;o.length&&o.forEach(r.unobserve.bind(r));var l=function(e,t){var n=e.get().peer,a=Object(i.getTab)(e,n);return Object(i.isFullyLoadedTab)(e,n)?Object.keys(a.msgs).reduce((e,n)=>{var r=a.msgs[n],o=t||document;if(Object(s.isUnread)(a,Object(i.parserMessage)(r))){var l=o.querySelector("._im_mess_"+n);l&&e.push(l)}return e},[]):[]}(e,t);n.setState({targets:l}),l.length&&l.forEach(r.observe.bind(r))}var oi=n("Syd7");var li={onNewMessagesChunk:function(e){var t=geByClass("post");LongView.clearElemsCache&&LongView.clearElemsCache(),t.forEach(e=>LongView.register(e,"im"))},onHistoryScroll:function(e){LongView.onScroll(e,window.innerHeight)}};function ci(){return(ci=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e}).apply(this,arguments)}function di(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var n=[],a=!0,r=!1,i=void 0;try{for(var s,o=e[Symbol.iterator]();!(a=(s=o.next()).done)&&(n.push(s.value),!t||n.length!==t);a=!0);}catch(e){r=!0,i=e}finally{try{a||null==o.return||o.return()}finally{if(r)throw i}}return n}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return ui(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return ui(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function ui(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,a=new Array(t);n<t;n++)a[n]=e[n];return a}function gi(e,t,n,a){var r=e instanceof Array?e:geByClass("_im_bar_date",e),i=t.contHeight();li.onNewMessagesChunk();var s=r.reduce((e,t)=>(e[domData(t,"date")]=[t.offsetTop+10,i,t],e),{}),o=!n&&a.barMap?a.barMap:{};return a.barMap=extend(o,s),a.barMapKeys=Object.keys(a.barMap).sort(),Promise.resolve(a)}function mi(e,t){return t.barMapKeys.forEach(n=>{t.barMap[n][0]-=e}),Promise.resolve(t)}function _i(e,t,n,a,i){var s=e.get().barMap[t],o=Object(r.isClassicInterface)(i)?68:20;return n-(s[0]+n-s[1])+a-o}function pi(e,t,n,a){return a.barTransition=a.barMap[t][2],n>0?(addClass(a.barMap[t][2],"im-page--date-bar-transition-inverse"),addClass(e,"im-page--date-bar-transition-inverse")):n<0&&(removeClass(a.barMap[t][2],"im-page--date-bar-transition-inverse"),removeClass(e,"im-page--date-bar-transition-inverse")),addClass(a.barMap[t][2],"im-page--date-bar-transition"),addClass(e,"im-page--date-bar-transition"),Promise.resolve(a)}function hi(e,t){return t.barTransition&&(removeClass(t.barTransition,"im-page--date-bar-transition"),t.barTransition=null),removeClass(e,"im-page--date-bar-transition"),Promise.resolve(t)}function fi(e,t,n,a,r){var i,s,o=e.get(),l=n-t;o.barMapKeys.forEach(t=>{var o=_i(e,t,n,a,r);if(o>=l){var c=i?_i(e,i,n,a,r):n;i=c>o?t:i}else if(o<l){var d=s?_i(e,s,n,a,r):0;s=o>d?t:s}});var c={};return[[s,"prev"],[i,"cur"]].forEach(t=>{var i=di(t,2),s=i[0],o=i[1];s&&(c[o+"Bar"]=function(e,t){var n=e.get().barMap[t][2];return{text:n.textContent,date:domData(n,"date")}}(e,s),c[o+"Left"]=_i(e,s,n,a,r)-l)}),c}function bi(e,t,n,i,s){var o=e.get(),l=Object(a.isEverythingLoaded)(o),c=t.get(),d=s.scrollTop(),u=c.lastTop?c.lastTop-d:0;c.lastTop=d;var g=Object($e.isPinnedMessageVisibleInTab)(o,o.peer)?Object(r.getPinnedMessageHeight)(e):0,m=Object(a.isSearchingInplace)(o.peer,o)&&o.tabs[o.peer]&&o.tabs[o.peer].top_banner?50:0,_=(Object(r.isClassicInterface)(e)?68+g+m:0)-16,p=fi(t,d,s.contHeight(),_,e),h=p.prevBar,f=p.curBar,b=p.prevLeft,v="translateY(0px)",O=!1,y=!1,C=!1;f||l||(f=function(e){var t=geByClass1("_im_mess",e),n=domData(t,"ts");return t&&n?{text:getShortDate(intval(n),!1,!0,getLang("months_of","raw")),date:n}:null}(i)),f?O=f:y=!0,h&&f&&b>-32&&b<0&&(C=!0,y=!1,O=f,v=`translateY(${-32-b}px)`),O&&function(e,t){domData(e,"ts")!==t.date&&(e.innerHTML=t.text,domData(e,"ts",t.date),e.style.visibility="visible")}(n,O),C?t.set(pi.bind(null,n,h.date,u)):t.set(hi.bind(null,n)),v&&(n.style.transform=v),toggleClass(n,"im-page--top-date-bar_no-b",y)}function vi(e,t){var n=geByClass1("_im_top_date_bar",t),a={lastTop:!1,barMap:{},barMapKeys:[],isDisabled:!1},r=Object(C.default)(a),i=null,s=null,o=null,l=Object(ka.debounce)(e=>{var n=r.get();Object.keys(n).length&&!n.isDisabled&&r.set(gi.bind(null,t,e,!1))},500);return{reset(a){r.get().isDisabled||r.set(gi.bind(null,t,a,!0)).then(bi(e,r,n,t,a))},disable(){r.setState(ci({},a,{isDisabled:!0}))},enable(){r.setState({isDisabled:!1})},heightIncreased(e,t){r.get().isDisabled||(l(t),r.set(mi.bind(null,e)))},parseMore(a,i){r.get().isDisabled||r.set(gi.bind(null,a,i,!1)).then(()=>{bi(e,r,n,t,i)})},toggle(e){r.get().isDisabled&&e||n.classList.toggle("im-page--top-date-bar--hidden",!e)},show(){r.get().isDisabled||(s=Date.now(),o||(addClass(t,"im-page--top-date-bar_visible"),o=setInterval((function(){Date.now()-s>2e3&&(removeClass(t,"im-page--top-date-bar_visible"),clearInterval(o),o=null)}),100)))},update(a){r.get().isDisabled||(i&&(clearTimeout(i),i=null),i=setTimeout((function(){bi(e,r,n,t,a)}),300),bi(e,r,n,t,a))},unmount(){i&&(clearTimeout(i),i=null),o&&(clearInterval(o),o=null),r.unmount()}}}var Oi=n("bIHZ"),yi=n("uytb"),Ci=n("S2bU"),Ei=n("t7n3"),ji=n("zxIV");function Ti(){return(Ti=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e}).apply(this,arguments)}function Si(e){return!e.children.length}function Ii(e,t){var n=geByClass1("_im_dialog_actions",e);Object(ji.toggleClass)(n,"im-page--chat-header_top-banner",t)}function Ai(e,t){var n=geByClass1("_im_top_banner_hide",e);n&&window.tooltips&&tooltips.hide(n),Ii(e,!1),t.innerHTML=""}function wi(e,t,n){var a=t.participants,i=a.count>0?langNumeric(a.count,getLang("mail_im_n_chat_members","raw")):"";return Object(Ei.getTemplate)("sImCallBannerContent",{user_list:Object(r.renderCallUserList)(e,a.list),title:getLang("calls_group_call_banner_title"),desc:i,cls:n?"CallBanner--classic":""})}function Li(e){var t=e.peerId;if(Object(r.isChatPeer)(e.peerId)&&!Object(i.isChatActive)(e))return!1;var n=e.callInProgress,a=cur.imDb.selectByKey("hiddenCallBanners");return a?!(!n||a[t]&&a[t]===n.join_link):!!n}function ki(e,t,n){var s=geByClass1("_im_top_banner",e),o=Object(p.createModule)({handlers:(o,c)=>{var d=geByClass1("_im_dialog_actions",e);c(e,"click","_im_top_banner_hide",()=>{var o=t.get().peer,l=Object(i.getTab)(t,o);Li(l)?function(e){var t=e.peerId,n=e.callInProgress,a=cur.imDb.selectByKey("hiddenCallBanners")||{};cur.imDb.updateByKey("hiddenCallBanners",Ti({},a,{[t]:n.join_link}))}(l):t.set(e=>Object(a.hideTopBannerAction)(o,e)),Ai(e,s);var c=!!Object(r.renderPinnedMessage)(t);Object(r.compensateHistoryHeightChange)(t,c,!0,n)}),c(e,"click","_im_top_banner_button",i=>{var o=function(e,t,n,i){var s=e.target,o=t.get().peer;if(s.classList.contains("_im_call_banner_join_btn")){var l=s.dataset.link;return Object(r.joinCallFromIm)(t,o,l,!1,r.CALL_ENTRY_POINT_JOIN_BANNER),!1}var c=s.dataset.payload;return c?(t.set(e=>Object(a.callbackTopBannerAction)(o,c,e)),Ai(n,i),!0):(s.classList.contains("_im_top_banner_button_gifts")&&(showBox("al_gifts.php",{act:"get_gift_box",mid:o,ref:"im_birthday_banner"},{stat:["gifts.css","wide_dd.js","wide_dd.css"],dark:1}),Object(q.statlogsValueEvent)("gifts_im_birthday_banner","click",o),e.originalEvent.preventDefault()),!1)}(i,t,e,s),l=!o,c=!!Object(r.renderPinnedMessage)(t)||!o;Object(r.compensateHistoryHeightChange)(t,c,l,n)}),c(d,"mouseover","_im_top_banner_hide",(e,t)=>{Object(l.showTooltip)(t,{text:getLang("mail_top_banner_hide"),black:1,shift:[8,4],appendEl:bodyNode})})}});return{renderPeer(t){var a=Object(i.getTab)(t,t.get().peer),o=a.top_banner,l=a.callInProgress,c=!Si(s),d=Li(a);!d&&!o||Object(i.isSearchShown)(t)?c&&Ai(e,s):(Ii(e,!0),s.innerHTML=d?function(e,t){return Object(Ei.getTemplate)("im_top_banner",{text:wi(e,t,Object(i.isClassicInterface)(e)),icon:"",buttons:[Object(Ei.getTemplate)("sImCallBannerButton",{call_link:t.join_link}),Object(Ei.getTemplate)("im_top_banner_hide_btn",{})].join(""),classes:"im-top-banner_call"})}(t,l):function(e){var t=e.icon?Object(Ei.getTemplate)("im_top_banner_icon",{icon:e.icon}):"",n=e.text;"employees_banner"===e.name&&(n=Object(Ci.replaceHyperLinks)(n,e=>Object(Ci.linksReplacer)(!1,e)),n=Object(Ci.replaceMentions)(n));var a=(e.buttons||[]).map(e=>{var t="";switch(e.layout){case"tertiary":t="im-top-banner--button-tertiary";break;case"secondary":t="secondary";break;default:t="blue_button"}switch(e.type){case"link":return Object(Ei.getTemplate)("im_top_banner_button_link",{link:e.link,text:e.text,css_class:t});case"gifts_link":return t+=" _im_top_banner_button_gifts",Object(Ei.getTemplate)("im_top_banner_button_link",{link:e.link,text:e.text,css_class:t});default:return Object(Ei.getTemplate)("im_top_banner_button",{callback_data:e.callback_data,text:e.text,css_class:t})}});return a=a.concat([Object(Ei.getTemplate)("im_top_banner_hide_btn",{})]),Object(Ei.getTemplate)("im_top_banner",{text:n,icon:t,buttons:a.join("")})}(o),o&&"birthday"===o.name&&Object(q.statlogsValueEvent)("gifts_im_birthday_banner","view",t.get().peer));var u=!Si(s);Object(r.compensateHistoryHeightChange)(t,u,c,n)},unmount(){Object(p.destroyModule)(o)}}}var Mi=n("cGUQ");function Ni(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var n=[],a=!0,r=!1,i=void 0;try{for(var s,o=e[Symbol.iterator]();!(a=(s=o.next()).done)&&(n.push(s.value),!t||n.length!==t);a=!0);}catch(e){r=!0,i=e}finally{try{a||null==o.return||o.return()}finally{if(r)throw i}}return n}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return Pi(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Pi(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Pi(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,a=new Array(t);n<t;n++)a[n]=e[n];return a}var Di="im-audio-message_recorded",Ri=!1,xi={};function Bi(e){return e.get().isMassMentionsMessageAllowed}function Hi(e){var t=Object(i.getTab)(e,e.get().peer);return!!Object(i.getPinnedMessage)(e)||!(!t||!t.top_banner)}function Fi(e,t){var n=Object(_.unpackStore)(e),a=Object(i.getTab)(n,t);return Object(r.isChatPeer)(t)&&Object($e.isPinnedMessageVisibleInTab)(n,t)||!!a.top_banner&&!Object(i.isSearchShown)(t,n)}function Ui(e){return Object(r.getPinnedMessageHeight)(e)}function Gi(e,t,n){var a=n||window.clientHeight();return Math.min(a-15,Math.max(0,e,742+t.offsetTop))}function qi(e,t){var n=intval(domData(t.target,"msgid")),a=gpeByClass("_im_mess_"+n,t.target),r=geByClass1("_im_log_body",a),i=geByClass1("_im_mess_susp_cont",a);r.innerHTML=i.innerHTML}function Vi(e,t){return geByClass1("_im_mess_"+t,e)}function Wi(e,t,n){var a,i,s,o,l,c,d,u,g,m=geByClass1(e,t);o={onStartDrag:(e,t)=>{addClass(bodyNode,"cursor_ns_resize"),a=t,i=t},onDrop:()=>{removeClass(bodyNode,"cursor_ns_resize")},onDrag:(e,s)=>{var o=Gi(i-a+s,t);Object(r.setClassicChatHeight)(o),n().fixHeight()}},d=function(e){l=void 0!==e.clientX?e.clientX:e.touches[0].clientX,c=void 0!==e.clientY?e.clientY:e.touches[0].clientY,o.onDrag&&o.onDrag.call(s,l,c)},u=function e(t){o.onDrop&&o.onDrop.call(s,l,c),removeEvent(document,"mouseup touchend mouseleave",e),removeEvent(document,"mousemove touchmove",d)},g=function(e){(1===e.which||e.touches&&e.touches[0])&&(addEvent(document,"mouseup touchend mouseleave",u),addEvent(document,"mousemove touchmove",d),l=void 0!==e.clientX?e.clientX:e.touches[0].clientX,c=void 0!==e.clientY?e.clientY:e.touches[0].clientY,o.onStartDrag&&o.onStartDrag.call(s,l,c),o.onDrag&&o.onDrag.call(s,l,c),cancelEvent(e))},(s=m).beginDragHandler=g,addEvent(s,"mousedown touchstart",g)}function Ki(e,t){var n;n=geByClass1(e,t),removeEvent(n,"mousedown touchstart",n.beginDragHandler)}function Yi(e){e().hideError()}function $i(e,t,n,r,i){if(checkEvent(r))return!0;var s=Object(Mi.fromQueryString)(i.getAttribute("href")),o=intval(s.msgid);o&&e.set(a.changePeer.bind(null,e.get().peer,o,!1)).then(()=>os(n,t,o,e)),cancelEvent(r)}function zi(e,t,n){var r=Object(i.getTab)(t,n),s=Object(a.strHistory)(r.history);toggleClass(e,"im-page--history_empty-hist",!s)}function Xi(e,t,n,a){if(hasClass(n.target,"_im_mess_marker")){var i=n.target,s=Object(_.toArray)(geByClass(r.FAILED_CLASS,t));window.tooltips&&s.map(e=>geByClass1("_im_mess_marker",e)).filter(e=>e!==i).forEach(e=>tooltips.hide(e,{fasthide:!0}));var o=domData(a,"msgid");Object(l.showTooltip)(i,{content:getTemplate("im_failed_menu",{count:s.length,modifiers:Object(Ye.classNames)("im-settings_failed",{"im-settings_no_delete":o>0,"im-settings_single":1===s.length}),id:o}),className:"im-page--failed-tt",appendParentCls:"_chat_body_wrap",dir:"down",noZIndex:!0,shift:[12,8],hasover:!0,force:!0})}}function Qi(e){return geByClass1("_im_peer_history",e)}function Zi(e,t){var n=t.contHeight(),a=e.scrollTop+(n-e.contHeight);t.scrollTop(a)}function Ji(e,t,n,s,o,l,c,d,u){var g=!(arguments.length>9&&void 0!==arguments[9])||arguments[9],m=arguments.length>10&&void 0!==arguments[10]&&arguments[10],_=(t.get().tabs||{})[n];o().hideError(),l.renderPeer(t),d.renderPeer(t),u.render(t);var p=Object(i.isCasperChat)(t,n);if(toggleClass(e,"im-page--history_casper",p),!t.get().tabHistoryNotChanged){l.reRenderTitle(t),zi(e,t,n);var h=Object(a.strHistory)(_.history);if(h){var f=geByClass1("_im_peer_history",e);val(f,h)}else o().showEmptyScreen();getAudioPlayer().isPlaying()&&getAudioPlayer().updateCurrentPlaying(),js(t,s,e)}if(Object(a.isSearchingInplace)(n,t.get())?o().showSearch(t):o().cancelSearch(t,!1),c.changePeer(n,t),t.get().msgid)os(s,e,t.get().msgid,t);else if(_.scrollBottom&&g){Zi(_,s);var b=Object(r.isMessagesVisible)(t,e,s),v=Ni(b,1),O=v[0];_.skipped||setTimeout(()=>{_.unread&&!O&&(us(t,e,!0),gs(t,e,!0)),ns(t,s,e),as(t,s,e)},100)}else ss(s,e,o,t,m)||s.scrollBottom(-30);window.LazyLoad&&window.LazyLoad.scan(!!s.scroll&&s.scroll.scroller)}function es(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=n||t.scrollTop(),i=t.scrollBottom(),s=t.contHeight(),o=e.get().peer;e.set(a.saveHistoryScroll.bind(null,o,r,i,s))}function ts(){return We.screenfull.isFullscreen}function ns(e,t,n){var a=Object(i.isGoToMentionVisible)(e),r=Object(i.isGoToEndVisible)(e),s=t.getScrollHeight()/4,o=t.scrollTop()>0;t.scrollBottom()>s&&(!r||a)&&o&&us(e,n,!0,40)}function as(e,t,n){if(Bi(e)){var a=t.getScrollHeight()/4,r=t.scrollTop()>0,s=Object(i.isGoToMentionVisible)(e);t.scrollBottom()>a&&!s&&r&&gs(e,n,!0,40)}}function rs(e,t,n,s,o,l,c,d){var u=!(arguments.length>8&&void 0!==arguments[8])||arguments[8];if((e.get().history_init||(e.get().history_init=!0,!(d.scrollTop()>0)))&&!ts()){o.update(d),o.show();var g=e.get().peer;if(0!==g&&Object(r.isFullyLoadedTab)(e.get(),g)&&(li.onHistoryScroll(d.scrollTop()),!layers.visible)){var m=Object(i.getTab)(e,g);m&&!m.skipped&&d.scrollBottom()>40?(ns(e,d,l),as(e,d,l)):m.skipped||m.unread||(As(e,l),ws(e,l));var _=Object(r.wrapLoading)(n);if(!Object(a.isSearchingInplace)(g,e.get())&&u&&s(d),!Ri&&(c<0||0===d.scrollBottom())&&d.scrollBottom()<1e3){if(Object(a.isSearchingInplace)(g,e.get()))return;if(m.skipped>0&&!e.get().no_moving_down){var p=gpeByClass("_im_page_history",l),h=e.get();Ri=!0;var f=e.set(a.loadLessHistory).then(t().loadHistory.bind(null,h.peer,{reversed:!0})).then(()=>{t().updateObserver(),Ri=!1,us(e,p),gs(e,p),m.skipped||e.set(a.changePeer.bind(null,e.get().peer,!1,!1))});return ys(p,!0),void f.then(ys.bind(null,p,!1))}}if(!Ri&&d.scrollTop()<1e3){if(Object(a.isSearchingInplace)(g,e.get())){Ri=!0;var b=t().getSearchResulstModule();return b.isAll(e)?void(Ri=!1):void _(b.loadMore(e).then(n=>{Ri=!1,n&&(t().loadHistory(e.get().peer,{},e,n),s(d))}),"up")}var v=e.get();m.allShown||(Ri=!0,_(e.set(a.loadMoreHistory.bind(null,0,0)).then(t().loadHistory.bind(null,v.peer,{})).then(()=>{Ri=!1,s(d)}),"up"))}c<0&&Rs(e,g,d.scrollBottom(),l,t),Object(a.videoAutoPlayHandler)()}}}function is(e,t){if(!(window.curNotifier&&curNotifier.idle_manager&&curNotifier.idle_manager.is_idle))return e.set(a.readTillSpecificMessage.bind(null,t,e.get().peer))}function ss(e,t,n,i,s){var o=geByClass1("_im_unread_bar_row",t);if(o){var l=i.get(),c=l.peer,d=o.getBoundingClientRect(),u=geByClass1("_im_chat_body_abs",t).getBoundingClientRect().top+20;Object(r.isClassicInterface)(i)&&(u+=47+(Fi(l,c)?Ui(i):0));var g=e.scrollTop()-u+d.top;return e.scrollTop(g),es(i,e,g),setTimeout(()=>{c===i.get().peer&&rs(i,n,Qi(t),(function(){}),s,t,0,e)},80),function(e){var t=e.get().peer;if(!(window.curNotifier&&curNotifier.idle_manager&&curNotifier.idle_manager.is_idle)&&t)e.set(a.readLastMessages.bind(null,t))}(i),!0}return!1}function os(e,t,n,a){var i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"top",s=Vi(t,n);if(s){var o=Object(r.isClassicInterface)(a),l=a.get().peer,c=o?window.clientHeight():geByClass1("_im_chat_body_abs",t).offsetHeight,d=s.offsetTop+domPN(s).offsetTop+domPN(domPN(s)).offsetTop+domPN(domPN(domPN(s))).offsetTop;o&&Fi(a,l)&&(d-=Ui(a)),"top"===i?e.scrollTop(d-e.getScrollHeight()/2+c/2):e.scrollTop(d-e.getScrollHeight()+c/4),addClass(s,"im-mess_light"),setTimeout(()=>{removeClass(s,"im-mess_light")},2e3)}}function cs(e,t,n){n.updateLastSeen(e)}function ds(e,t,n,r,i,s){var o=domData(s,"action"),l=domData(s,"msgid"),c=geByClass1("_im_mess_marker",Vi(n,l)),d=Number(l)>0?"edit":"send",u=e.get().peer,g=Qi(n);switch(o){case"resend":Object(qe.statlogsSendingRetry)("retry",d),t(i,s);break;case"resend_all":Object(qe.statlogsSendingRetry)("retry",d),r().resendPeer();break;case"delete":Object(qe.statlogsSendingRetry)("delete",d),e.set(a.removeFailed.bind(null,g,u,l));break;case"delete_all":Object(qe.statlogsSendingRetry)("delete",d),e.set(a.removeFailed.bind(null,g,u,void 0))}tooltips.hide(c,{fasthide:!0})}function us(e,t,n){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,s=e.get(),o=s.peer;if(!Object(r.isReservedPeer)(o)){var l=e.get().tabs[o],c=(t||document).querySelector("._im_to_end"),d=!1;(n||l.skipped>0||l.unread>0)&&!Object(a.isSearchingInplace)(o,e.get())?(d=!0,ms(t,e),addClass(c,"im-navigation_shown")):Is(c,!0),e.set(a.updateGoToEndVisibility.bind(null,[d,+i]))}}function gs(e,t,n){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;if(!Bi(e))return!1;var s=e.get(),o=s.peer;if(!Object(r.isReservedPeer)(o)){var l=e.get().tabs[o],c=(t||document).querySelector("._im_to_mention"),d=ps(e).length,u=!1;l.unread>0&&d>0&&!Object(a.isSearchingInplace)(o,e.get())?(u=!0,_s(t,e,d),addClass(c,"im-navigation_shown")):Is(c,!0),e.set(a.updateGoToMentionVisibility.bind(null,[u,+i]))}}function ms(e,t){var n=t.get().peer,a=Object(i.getTab)(t,n);(e||document).querySelector("._im_to_end").querySelector("._im_to_end_label").innerHTML=Number(a.unread)>0?Object(Ei.formatCount)(a.unread):""}function _s(e,t,n){(e||document).querySelector("._im_to_mention").querySelector("._im_to_mention_label").innerHTML=n>0?Object(Ei.formatCount)(n):""}function ps(e){var t=e.get(),n=t.id,a=t.peer,r=Object(i.getTab)(e,a);if(!a||!r)return[];var o=r.msgs||{};return Object.values(o).filter(e=>!(!e||Array.isArray(e)||Object(s.isOut)(e)||!Object(s.isUnread)(r,e))&&Object(s.hasUserMentions)(e,n))}function hs(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(0===e.scrollTop()&&0===e.scrollBottom())return!1;var n=e.scrollBottom();return n<(t?30+t:30)}function fs(e,t,n,a,r){var s=domData(r,"msgid"),o=e.get().peer,l=Object(i.getMessage)(e,o,s);l.type===h.EDIT_MESSAGE?(n().sendEditMessage(e,l),n().resendMessage(o,s)):e.get().imQueueResend(o,s).then(t=>{e.get().longpoll.push([Object(h.resendEvent)(o,t.mess)])})}function bs(e,t,n,i,s){var o=intval(domData(s,"peer")),l=intval(domData(gpeByClass("_im_mess",s),"msgid")),c=e.get().tabs[o].hash;return Object(a.restoreMessageSend)(l,o,c,e.get().gid),e.set(a.restoreMessage.bind(null,l,o)).then(r.restoreMessage.bind(null,l,o,Qi(t))).then(()=>js(e,n,t)),!1}function vs(e,t){e().showCreation(t)}function Os(e,t){if(e){var n=e.querySelector("._im_to_end");toggleClass(n,"im-navigation_loading",t)}}function ys(e,t){if(e){var n=e.querySelector("._im_to_end");toggleClass(n,"im-navigation_loading",t)}}function Cs(e,t,n,o){var l=t.get().peer,c=Object(i.getTab)(t,l);if(Object(r.isFullyLoadedTab)(t,l)){var d=Object.keys(c.msgs).find(e=>{var t=c.msgs[e];return!Array.isArray(t)&&Object(s.isUnread)(c,t)});if(!c.skipped)return d?os(o,n,d,t):o.scrollBottom(-30),us(t,n),gs(t,n),Rs(t,l,0,n,e),void Object(a.readTillSpecificMessage)(c.lastmsg,l,t.get());Os(n,!0),t.set(a.changePeer.bind(null,l,!1,!1)).then(()=>t.set(a.loadPeer.bind(null,l,!0,-1,!1))).then(()=>{Os(n,!1),e().changePeer(t,!1,!1)})}}function Es(e,t,n,r){var s=Object(i.getTab)(t,t.get().peer),o=ps(t),l=!!o.length&&o[0].messageId;if(!s.skipped)return l&&os(r,n,l,t,"center"),us(t,n,!0),gs(t,n),is(t,l),void Rs(t,t.get().peer,0,n,e);Os(n,!0),t.set(a.changePeer.bind(null,t.get().peer,!1,!1)).then(()=>t.set(a.loadPeer.bind(null,t.get().peer,!0,-1,!1))).then(()=>{Os(n,!1),e().changePeer(t,!1,!1),is(t,l)})}function js(e,t,n){var a=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(Object(r.isClassicInterface)(e)){var i=t.contHeight(),s=geByClass1("_im_chat_input_w",n),o=geByClass1("_im_chat_resize",n);if(!1!==(a=!1!==a?a:Object(r.getClassicChatHeight)())&&a>0){var l=window.clientHeight(),c=geByClass1("_im_chat_audio_input_parent",n),d=Gi(a,n,l),u=hasClass(c,"im-audio-message_recording")||hasClass(c,Di),g=u?c:geByClass1("_im_chat_input_parent",n),m=d-g.offsetHeight;o.style.height=l-d-15+"px",setStyle(s,{top:m+"px",bottom:"auto"})}else o.style.height="0px",setStyle(s,{top:"auto",bottom:"0px"});var _=geByClass1("_im_peer_history_w",n);return setStyle(_,{borderBottomWidth:s.offsetHeight-15-1}),t.contHeight()-i}var p=t.getScrollHeight();t.update(!1,!0);var h=t.getScrollHeight();return p-h}function Ts(e,t,n,a){var r=t.offsetHeight;a(),e.heightIncreased(t.offsetHeight-r,n)}function Ss(e,t){var n=t.getBoundingClientRect().top;Object(l.showTooltip)(t,{className:"im-page--admin-tt",text:getLang("mail_only_admin_see"),appendParentCls:"_chat_body_wrap",shift:[20,5],dir:"auto",showdt:400,noZIndex:!0,toup:n>200})}function Is(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];hasClass(e,"im-navigation_shown")&&(t&&addClass(e,"im-navigation_fast"),removeClass(e,"im-navigation_shown"),t&&(e.offsetHeight,removeClass(e,"im-navigation_fast")))}function As(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=t.querySelector("._im_to_end");e.set(a.updateGoToEndVisibility.bind(null,[!1,0])),Is(r,n)}function ws(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=t.querySelector("._im_to_mention");e.set(a.updateGoToMentionVisibility.bind(null,[!1,0])),Is(r,n)}function Ls(e,t,n){We.screenfull.isFullscreen||0===t.get().peer||Object(r.isClassicInterface)(t)||e().restoreScroll(t,t.get().peer)}function ks(e,t){var n=e.get(),o=n.peer,l=domClosest("_im_mess_srv",t.target),c=intval(domData(l,"msgid")),d=Object(i.getMessage)(e,o,c),u=d&&Object(s.isServiceMsg)(d)&&d.kludges.source_act;if(u===r.CHAT_PIN_MESSAGE||u===r.CHAT_UNPIN_MESSAGE){var g=l.querySelector(".im_srv_mess_link");if(g&&"A"!==g.tagName){var m=d.kludges.source_chat_local_id;if(!m||xi[m])return;xi[m]=Object(a.getMessageLocalId)(o,m,n).then(e=>{var t=Ni(e,1)[0];if(t){var n=`/im?sel=${Object(r.convertPeerToUrl)(o)}&msgid=${t}`,a=g.innerHTML;domReplaceEl(g,Object(r.serviceLink)(n,a,!0,"im_srv_mess_link")),delete xi[m]}})}}}function Ms(e,t,n){var a=e.get(),s=a.peer,o=n.target.href&&n.target.href.match(/msgid=([\d]+)/),l=o&&o[1];"A"!==n.target.tagName||!l||Object(r.isAlreadyDeleted)(e,s,l)||checkEvent(n)||(Object(i.getMessage)(e,s,l)?(e.setState({msgid:l}),Object(Oi.updateLocation)({msgid:l}),t().focusOnMessage()):a.longpoll.push([Object(h.changePeer)(s,l)]));cancelEvent(n)}function Ns(e){var t=Object(i.getCurrentTab)(e);Object(r.isChatPeer)(t.peerId)&&(t.pinHideId=cur.imDb.select(yi.PIN_HIDDEN_ID_OP,t.peerId))}function Ps(e,t,n,a,r){e.setState({isEditing:!1}),removeClass(a,"im-mess_is_editing"),removeClass(geByClass1("_im_page_history"),"is_msg_editing"),cancelStackFilter("cancel_edit"),n.setDraft(e,Object(i.getPeer)(e)?Object(i.getTabDraft)(Object(i.getCurrentTab)(e)):null),n.toggleStickers(e,!0),n.restoreKeyboard(),Ds(t)}function Ds(e){Object(_.toArray)(geByClass("_im_history_tooltip",e)).forEach(hide)}function Rs(e,t,n,r,s){var o=Object(i.getTab)(e,t);if(!(Date.now()-(o.lastReset||0)<1e3)&&(o&&o.msgs&&o.history&&!Ri&&o.offset>300&&0==o.skipped&&n<50&&n>=0&&0===(e.get().selectedMessages||[]).length)){var l=Object.keys(o.msgs).filter(e=>e>0).sort((e,t)=>e-t).slice(0,-50),c=l.slice(-1)[0];e.mutate(a.resetTabAll.bind(null,t)),e.set(a.removeMessages.bind(null,l,t)).then(()=>s().removeStartingFromMessage(c,t,e))}}function xs(e,t,n,a){var i=a.target,s=domClosest("_im_replied_message",i),o=Number(s.getAttribute("data-msgid")),l=domClosest("im-mess",i),c=Number(l.getAttribute("data-msgid")),d=e.get().peer;o&&!Object(r.isAlreadyDeleted)(e,d,o)?(e.setState({msgid:o}),Object(Oi.updateLocation)({msgid:o}),Object(r.focusOnMessage)(e,t().focusOnMessage,d,o)):c&&Object(r.showRepliedBox)(e,c,a)}function Bs(e){checkEvent(e)||cancelEvent(e)}function Hs(e,t){var n=domClosest("_im_mess",t);if(n){var r=Number(n.getAttribute("data-msgid")),o=e.get().peer,l=Object(i.getMessage)(e,o,r);r&&l&&!Object(s.isOut)(l)&&Object(a.markAudioMessageAsListened)(o,r,e.get())}}function Fs(e,t,n){var a=n.target.closest("."+r.MESSAGE_KEYBOARD_BUTTON_CLASS),i=n.target.closest("."+r.MESSAGE_STACK_CLASS);if(a){var s=t.get().keyboard_app_hash,o=e.sendMessageFromKeyboard.bind(null,()=>e),l=Object(Ve.getActionObjectFromElement)(a),c=i?i.dataset.peer:void 0;return Object(Ve.handleButtonClick)(l,o,s,c)}}function Us(e,t){var n=e.get().peer,a=t.reduce((t,a)=>{if(a.isIntersecting){var r=+a.target.getAttribute("data-msgid");r&&!Object(s.isOut)(Object(i.getMessage)(e,n,r))&&t.push(r)}return t},[]);if(a.length){var r=Math.max(...a);is(e,r)}}function Gs(e,t){var n=t.target.closest("._im-call-snippet"),a=n.closest("._im_mess_callsnippet"),i=n.dataset.type,s=n.dataset.participants,o=s&&s.split(",").reduce((t,n)=>(+n!==e.get().id&&t.push(+n),t),[]),l=+a.dataset.peer;Object(r.isCallToPeerAvailable)(e,l)&&Object(r.startCallFromIm)(e,l,"video"===i,o,r.CALL_ENTRY_POINT_SNIPPET)}function qs(e,t,n){Vs(e,t,n.target.closest("._im_mess_pinned"))}function Vs(e,t,n){var a=+n.dataset.msgid,s=Object(i.getMessage)(e,e.get().peer,a),o=Object(Ka.canMessageBeEdited)(e,s);o!==n.classList.contains("im-mess_editable")&&(n.classList.toggle("im-mess_editable",o),Object(r.updateMessageInCache)(e,t,n))}function Ws(e,t,n,o,l,c,d,u,g,m,f,b,v,y,C,E,j,T){var S,I=Object(_.throttle)((function(){n.smoothScroll(...arguments)}),300);return{fixKeyboard(){l.fixKeyboard()},removeUnpinnedMessageEditable(e,n){var a=t.querySelector("._im_mess_pinned:not(._im_mess_"+n);a&&(a.classList.remove("_im_mess_pinned"),Vs(e,t,a))},changePeer(e){var s=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],d=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],g=e.get().peer;if(revertLastInlineVideo(t),0===g)return C.disable(),l.setDraft(e,null),function(e){addClass(e,"im-page--history_empty"),Qi(e).innerHTML=""}(t);if(Object(r.isFullyLoadedTab)(e.get(),e.get().peer)){removeClass(t,"im-page--history_search"),e.set(a.dropSelection),o.changeActions(e),o.showActions(e);var m=e.get().prevPeer;removeClass(t,"im-page--history_loading"),toggleClass(t,"im-page--history_vkcomgroup",Object(r.isFvkcomgroup)(e,g)),s?l.setDraft(e,Object(i.getTabDraft)(Object(i.getCurrentTab)(e))):l.updateState(e),us(e,t),gs(e,t),c().updateTyping(g,e),cs(e,0,o),Object(r.isReservedPeer)(m)&&!Object(r.isReservedPeer)(g)?function(e,t,n,a,r,i,s,o,l,c,d){removeClass(e,"im-page--history_empty"),Ji(e,t,n,a,r,i,s,o,l,c,d)}(t,e,g,n,c,o,u,E,T,d,C):Object(r.isReservedPeer)(m)||Object(r.isReservedPeer)(g)||Ji(t,e,g,n,c,o,u,E,T,d,C),Object(i.isCasperChat)(e,g)||(C.enable(),C.toggle(!0),C.reset(n)),Object(r.isReservedPeer)(g)||setTimeout(()=>{rs(e,c,Qi(t),v,C,t,0,n)}),Object(r.ensureDomHasActions)(t)}},preparePeer(e){var n=Object(i.getPeer)(e);Ns(e),l.setDraft(e,Object(i.getTabDraft)(Object(i.getTab)(e,n)),!1),c().updateTyping(n,e),c().hideError(),o.renderPeer(e),E.renderPeer(e),o.hideActions(e),u.changePeer(n,e),cs(e,0,o),C.toggle(!1),As(e,t,!0),ws(e,t,!0)},saveScroll:e=>es(e,n),loadingPeer(e){Object(a.isAnythingLoading)(e.get())||(removeClass(t,"im-page--history_empty"),addClass(t,"im-page--history_loading"))},stopLoading(e){removeClass(t,"im-page--history_loading")},deselectDialog(e){d().removeSelection(e)},replaceMessageAttrs(e,n){Object(r.replaceMessageAttrs)(n.get(),Qi(t),e)},cleanSelection(e){m.cleanSelection(e)},updateDialogFilters(e){d().updateDialogFilters(e)},getSearchResulstModule:()=>S,showSearchResults(e){e?(removeClass(t,"im-page--history_search-empty"),Qi(t).innerHTML=e):(addClass(t,"im-page--history_search-empty"),Qi(t).innerHTML=Object(r.renderEmptySearch)())},insertSearch(e,a){S||(o.deselectAll(a),S=O(t,a)),addClass(t,"im-page--history_search"),c().showSearchResults(e),js(a,n,t),n.scrollBottom(0),us(a,t),gs(a,t),C.reset(n)},updateChatTopic(e,t){d().updateDialog(e,t),e===t.get().peer&&(o.renderPeer(t),o.renderActions(t),E.renderPeer(t))},updateActions(e){o.changeActions(e)},updateChatPhoto(e,a,i){if(Object(r.isPeerActive)(e.peerId,i.get())){o.renderPeer(i),E.renderPeer(i);var s=hs(n);Object(r.addChatPhotoToUpdate)(e,a,i.get(),Qi(t)),s&&n.scrollBottom(-30)}},markImportant(e,n,a){Vi(t,e)&&(o.changedMessageSelection(a),g.markImportant(e,n,a))},isNewMessagesVisible:e=>function(e,t){return Object(i.getUnreadScrollBottom)(e)>=intval(t.scrollBottom())}(e,n),loadHistory(e,a,i){var s=arguments.length>3&&void 0!==arguments[3]&&arguments[3],o=i.get();if(Object(r.isPeerActive)(e,o)){var l=s||o.tabs[e].historyToAppend;if(!l)return;var c=geByClass1("_im_peer_history",t),d=domFC(c),u=n.scrollBottom(),g=a.reversed?e=>c.appendChild(e):e=>c.insertBefore(e,d),m=0;a.reversed&&(m=c.offsetHeight);var _=sech(l),p=document.createDocumentFragment();_.forEach(e=>p.appendChild(e)),g(p),a.reversed&&C.heightIncreased(c.offsetHeight-m,n),a.reversed||n.scrollBottomFixSave(u),n.update(!1,!0);var h=_.filter(e=>hasClass(e,"_im_bar_date"));C.parseMore(h,n),Object(r.ensureDomHasActions)(t)}},sendMessage(e){0!==e.get().peer&&l.sendMessage()},editMessage(e,a){if(Object(r.isFullyLoadedTab)(e,a.peerId)&&Object(r.isPeerActive)(a.peerId,e.get())){if(!Vi(t,a.messageId))return;es(e,n),Object(r.editAndReplaceMessage)(e.get(),a,t),Zi(Object(i.getTab)(e,a.peerId),n),o.reRenderPinned(e),C.reset(n)}},addMessage(e,o){if(!Object(a.isSearchingInplace)(o.peerId,e.get())&&Object(r.isFullyLoadedTab)(e,o.peerId)&&Object(r.isPeerActive)(o.peerId,e.get())){if(Vi(t,o.messageId))return;var l=Qi(t);Ts(C,l,n,()=>{var a=hs(n),d=geByClass1("_im_unread_bar_row",t),u=Ni(Object(r.isMessagesVisible)(e,t,n),2),g=u[0],m=u[1];Object(r.appendToHistory)(e.get(),o,l,!0,!0,!g&&!d),removeClass(t,"im-page--history_empty-hist");var _=Object(i.getTab)(e,e.get().peer),p=Object(s.isServiceMsg)(o)&&o.userId===vk.id,h=o.kludges&&o.kludges.source_act,f=p&&h!==r.CHAT_PIN_MESSAGE&&h!==r.CHAT_UNPIN_MESSAGE;_.skipped||g||!Object(s.isUnread)(_,o)||Object(s.isOut)(o)||(us(e,t,!0,m),gs(e,t,!0,m)),(o.local||a||f)&&n.scrollBottom(0),c().updateTyping(o.peerId,e),ms(t,e),Ds(t)});var d=domPS(domLC(l));if(hasClass(d,"_im_bar_date")){var u=ce("div");u.innerHTML=d.outerHTML,C.parseMore(u,n)}c().hideError(),C.update(n),Object(a.updateMentions)(e.get()),Rs(e,o.peerId,n.scrollBottom(),0,c),this.updateObserver()}},setMessageErrored(e,n,a,i){a&&"string"==typeof a&&c().showError(a),Object(r.setMessageError)(e,n,t)},markMessagesAsRead(e,n){e.get().peer===n.peerId&&Object(r.markMessagesAsRead)(e.get(),n.peerId,t)},compensateHistoryHeightChange(e){n.scrollTop(n.scrollTop()+e*Ui(b))},updateTyping(e,n){if(!Object(a.isSearchingInplace)(e,n.get())){var s=n.get();if(s.peer===e&&Object(r.isFullyLoadedTab)(s,e)){var o=Object(r.formatTyper)(Object(i.getTab)(n,e).activity,e,!1,s),l=geByClass1(r.TYPING_CLASS,t);if(l||o){if(!l){var d=geByClass1("_im_typer_c",t);val(d,getTemplate("im_typing",{cls:Object(r.isClassicInterface)(n)?"im-activity_classic":""})),l=geByClass1(r.TYPING_CLASS,t)}val(geByClass1("_im_typing_name",l),o);var u=Object(r.loadSummaryActivityType)(Object(i.getTab)(n,e).activity||{})===a.ACTIVITY_TYPE_RECORDING_AUDIO;l.setAttribute("data-activity-type",u?"recording":"typing"),o?(addClass(l,"im-page--typing_vis"),c().hideError()):removeClass(l,"im-page--typing_vis")}}}},scrollFix(e,t,a){C.heightIncreased(a,n),C.update(n),Object(r.isPeerActive)(t,e.get())&&hs(n,a)&&n.scrollBottom(-30)},goToEnd(){Cs(()=>this,b,t,n)},updateGoToEnd(e,a){var r=Object(i.getTab)(e,e.get().peer);r&&(r.skipped||r.unread)?us(e,t):As(e,t,a),f(0,n,!1);var s=e.get().peer;setTimeout(()=>{e.get().peer===s&&es(e,n)})},updateGoToMention(e,a){var r=Object(i.getTab)(e,e.get().peer),s=ps(e),o=s.length>0&&s[0].messageId;r&&o?gs(e,t):ws(e,t,a),f(0,n,!1);var l=e.get().peer;setTimeout(()=>{e.get().peer===l&&es(e,n)})},newMessage(e){d().newMessage(e),As(e,t,!0),ws(e,t,!0)},scroll(e,t){var a=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(0!==e.get().peer){var i=a?n.getScrollHeight():40;!0===r&&(i=n.contHeight()),i="up"===t?-i:i,a||r?I(i,()=>{f(i,n)}):(n.scrollTop(n.scrollTop()+i),f(i,n))}},showCreation(e,t){d().showCreation(e,t)},updateScroll:()=>js(b,n,t),toggleBarDate(e){C.toggle(e)},changedMessageSelection(e){o.changedMessageSelection(e)},updateOnline(e,t){Object(r.isTabLoaded)(t.get(),e)&&e===t.get().peer&&o.renderPeer(t)},isEmpty:e=>l.isEmpty(e),replaceAttachmentPlaceholders(e,a){if(Object(r.isPeerActive)(a.peerId,e.get()))Ts(C,Qi(t),n,()=>{var s=hs(n);Object(r.replaceAttaches)(t,a,e.get());var l=Object(i.getTab)(e,a.peerId);if(l.mediacontent[a.messageId].length>=3&&l.mediacontent[a.messageId][2].pinned){var c=Object(i.parserMessage)(l.pinned);c&&c.messageId==a.messageId&&(l.pinned=l.mediacontent[a.messageId][2].pinned,o.reRenderPinned(e))}s&&n.scrollBottom(0)}),C.update(n);else if(Object(s.isMoneyRequest)(a)){var l=Object(i.getTab)(e,a.peerId);if(l.mediacontent[a.messageId].length>=3&&l.mediacontent[a.messageId][2].pinned){var c=Object(i.parserMessage)(l.pinned);c&&c.messageId==a.messageId&&(l.pinned=l.mediacontent[a.messageId][2].pinned)}}},removeMessages(e,a,i){i.get().peer===a&&(Object(r.removeMessages)(e,Qi(t)),Object(r.removeExpiredMessagesStub)(e,Qi(t)),js(i,n,t),o.changedMessageSelection(i),this.updateObserver())},removeStartingFromMessage(e,a,i){if(i.get().peer===a){var s=Qi(t),l=geByClass1("_im_mess_"+e,s);Object(r.removeStartingFromMessage)(l,s),js(i,n,t),o.changedMessageSelection(i)}},hideGoToEnd(e){As(b,t,e)},hideGoToMention(e){ws(b,t,e)},removeMessagesRestore(e,n,a,i){i.get().peer===n&&Object(r.removeMessagesWithRestore)(e,n,a,Qi(t))},removeExpiredFailedMessages(e){b.get().peer===e&&b.set(a.removeExpiredFailed.bind(null,Qi(t),e))},handleMessageExpiration(e){Object(r.isFullyLoadedTab)(b.get(),e.peerId)&&(Object(r.replaceExpiredMessageWithPlaceholder)(b,t,e),Object(r.replaceExpiredRepliedMessageWithPlaceholder)(t,e),l.detachMessages(e))},updateState(e,t){d().updateState(e,t)},updateBanner(e){E.renderPeer(e)},updateHeader(e){o.renderPeer(e)},updateChat(e,t){e.get().peer===t&&(o.changeActions(e),o.renderPeer(e),o.renderActions(e),E.renderPeer(e),l.updateState(e),Object(a.updateMentions)(e.get()))},focustTxt(e){l.focusOn(e)},startSearch(e){c().showSearch(e),u.changePeer(e.get().peer,e),u.search()},showSearch(e){addClass(t,"im-page--hisory_search-open"),e.setState({searchShown:!0}),Hi(e)&&this.updateChatTopic(e.get().peer,e),this.cancelEditing(),setTimeout(()=>u.focus(e),10)},cancelSearch(e){var i=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(e.get().searchShown&&(removeClass(t,"im-page--hisory_search-open"),removeClass(t,"im-page--history_search"),removeClass(t,"im-page--history_search-empty"),e.setState({searchShown:!1}),Hi(e)&&this.updateChatTopic(e.get().peer,e),o.changedMessageSelection(e)),i&&!Object(r.isReservedPeer)(e.get().peer)&&S){var s=e.get().tabs[e.get().peer],l=Object(a.strHistory)(s.history);l?Qi(t).innerHTML=l:c().showEmptyScreen(),js(e,n,t),n.scrollBottom(0),e.get().msgid&&(os(n,t,e.get().msgid,e),us(e,t),gs(e,t)),v(n),C.reset(n)}S&&(S.unmount(),S=!1,Object(r.ensureDomHasActions)(t))},showEmptyScreen(){var e=geByClass1("_im_peer_history",t);addClass(t,"im-page--history_empty-hist");var n=Object(i.isCasperChat)(b,b.get().peer)?getTemplate("sImEmptyCasper"):getLang("mail_im_here_history");val(e,n)},updateHistory(e){0!==b.get().peer&&e(t)},focusOnMessage(){os(n,t,b.get().msgid,b)},sendEditMessage(e,t){e.set(a.deliverEditedMessage.bind(null,Object(i.getTab)(e,t.peerId),t)).catch(n=>e.get().longpoll.push([Object(h.failedMessage)(t.peerId,t,n)]))},unmount(){Object(p.destroyModule)(e),n.destroy(),clearInterval(y),l.unmount(),o.unmount(),g.unmount(),m.unmount(),u.unmount(),C.unmount(),cancelStackFilter("forward"),Ki("_im_chat_resize_track",t),T.destroy()},removePeer(e,t){d().removePeer(e,t)},restoreScroll(e,t){var a=e.get().tabs[t];a.scrollBottom?Zi(a,n):n.scrollBottom(-30)},resendMessage(e,n){e===b.get().peer&&Object(r.startResendMessage)(e,n,t)},resendPeer(){l.resendPeer()},resendAll(){l.resendAll()},respond(e,t){l.attachMessages(e,t),l.focusOn(e);var a=Object(i.getTab)(e,t);a&&!a.skipped&&(n.scrollBottom(-30),v(n))},cancelRecording(){l.cancelRecording()},hideError(){geByClass1("_im_error",t).classList.remove("im-page--error--visible")},showError(e){var a=geByClass1("_im_error",t);a.innerHTML=e,a.classList.add("im-page--error--visible"),n.scrollBottom(-30)},startEditing(e){if(Object(a.isAnythingLoading)(b.get()))Object(r.showWaitUntilUploadedBox)();else{e=Object(i.parserMessage)(e);var n=Object(r.getNowEditingMessage)(b);if(!(l.isBlocked()||n&&n.messageId==e.messageId)){n&&this.cancelEditing(),Ds(t),b.get().searchShown&&this.cancelSearch(b);var s=Vi(t,e.messageId);s&&(this.cancelRecording(),function(e,t,n,a,r){e.setState({isEditing:!0}),n.saveText(e),addClass(a,"im-mess_is_editing"),addClass(geByClass1("_im_page_history"),"is_msg_editing"),cancelStackPush("cancel_edit",()=>Ps(e,t,n,a,r));var i=new Ot.ImDraft;i.dData.txt=Object(Ka.convertEmojiHtmlToRegularText)(r.text),i.dData.attaches=Object(Ya.convertKludgesToAttaches)(r.kludges,r.messageId),n.toggleStickers(e,!1),n.setDraft(e,i),setTimeout(()=>n.focusOn(e),0)}(b,t,l,s,e),l.hideKeyboard(),o.deselectAll(b))}}},cancelEditing(){var e=Object(r.getNowEditingMessage)(b);e&&Ps(b,t,l,Vi(t,e.messageId))},messageKeyboardButtonClick:e=>Fs(l,b,e),getEditingMessage:()=>Object(r.getNowEditingMessage)(b),focusEditingMessage(){var e=Object(r.getNowEditingMessage)(b);e&&os(n,t,e.messageId,b),l.focusOn(b)},setNetworkWaitingStatus(e){o.setNetworkWaitingStatus(e)},setNetworkReconnectingStatus(){o.setNetworkReconnectingStatus()},clearNetworkStatus(){o.clearNetworkStatus()},updateCasperMessageStatus(e){var n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];Object(r.isFullyLoadedTab)(b.get(),e.peerId)&&b.set(a.updateCasperMessageExpiringStatus.bind(null,e,n)).then(()=>{b.get().peer===e.peerId&&Object(r.setCasperMessageExpiringStatusDOM)(t,n,e.messageId)})},updateObserver(){j.update()},renderPeerProfile(e){T.render(e)},destroyPeerProfile(){T.destroy()}}}function Ks(e,t,n,s,o){var c=geByClass1("_im_peer_history_w",e);Object(La.hasAccessibilityMode)()&&addClass(c,"history_a11y");var d,u,g,m=Object(p.createMutations)(Ws),f=m.callMutations,b=m.bindMutations,v=(d=es.bind(null,t),u=Object(ka.debounce)(d,100),g=Object(_.throttle)(d,100),e=>{u(e),g(e)}),O=vi(t,e),j=rs.bind(null,t,f,c,v,O,e),T=Object(E.createScroll)(geByClass1("_im_chat_body_abs",e),{onScroll:j,nativeScroll:Object(r.isClassicInterface)(t),shadows:!1}),S=Object(r.isClassicInterface)(t)?void 0:T.scroll.container,I=function(e,t,n){var a=Object(C.default)({observer:new IntersectionObserver(n,{root:t}),targets:[]});si(e,t,a);var r=Object(p.createModule)({handlers:(e,t)=>{}});return{update(){si(e,t,a)},unmount(){var e=a.get(),t=e.observer;e.targets.forEach(t.unobserve.bind(t)),Object(p.destroyModule)(r)}}}(t,S,Us.bind(null,t));setTimeout((function(){var n=t.get().peer;if(n){if(Ns(t),(Object(i.getCurrentTab)(t).pinned||Object(i.getCurrentTab)(t).top_banner)&&(f().updateChatTopic(n,t),t.set(a.setActions),A.changeActions(t)),Object(i.getCurrentTab)(t).callInProgress&&f().updateBanner(t),t.get().msgid)os(T,e,t.get().msgid,t);else if(!ss(T,e,f,t,O)){T.scrollBottom(-30);var s=Object(i.getCurrentTab)(t);Object(r.isTabMarkedUnread)(s)&&t.set(e=>Object(a.markDialogRead)(s.peerId,e))}t.get().history_init=!1,Object(i.isCasperChat)(t,n)?O.disable():O.reset(T),us(t,e),gs(t,e),rs(t,f,c,v,O,e,0,T),Object(r.ensureDomHasActions)(e),nav.objLoc.st&&(t.mutate(a.setInplaceSearch.bind(null,nav.objLoc.st,n)),f().startSearch(t))}else O.disable()}),15);var A=gn(geByClass1("_im_dialog_actions",e),t,f),w=Hr(geByClass1("_im_text_input",e),t,Object(r.isClassicInterface)(t)?s.updateMenu:void 0,(e,t)=>{n.removeDialog(e,t),n.restoreDialogs(e,!0)},f),L=Yr(geByClass1("_im_dialog_actions",e),t,f),k=ai(e,t,f),M=ii(e,t,()=>({changedMessageSelection:A.changedMessageSelection})),N=Object(oi.mount)(c);Object($e.mount)(e,t,f);var P=ki(e,t,()=>({hidePinned(){Object($e.pinnedMessageHide)(t,t.get().peer,f,!1)},compensateHistoryHeightChange(e){f().compensateHistoryHeightChange(e)},showPinned(){Object($e.pinnedMessageUnHide)(t,t.get().peer,f,!1)}}));Object(r.isReservedPeer)(t.get().peer)||t.set(a.restoreHistoryQueue.bind(null,t.get().peer)).then(()=>{Object(r.restoreQueue)(t.get().peer,t.get(),Qi(e)),zi(e,t,t.get().peer)}),AudioMessagePlayer.events.on("listened",Hs.bind(null,t)),Wi("_im_chat_resize_track",e,o);var D=fs.bind(null,t,e,f),R=bs.bind(null,t,e,T),x=vs.bind(null,o,t),B=Cs.bind(null,f,t,e,T),H=Es.bind(null,f,t,e,T),F=Xi.bind(null,t,e),U=r.showEditTimeTooltip.bind(null,t),G=r.showMessageInfoTooltip.bind(null,t),q=ds.bind(null,t,D,e,f),V=$i.bind(null,t,e,T),W=Ls.bind(null,f,t,T),K=ks.bind(null,t),Y=Ms.bind(null,t,f),$=xs.bind(null,t,f,e),z=Fs.bind(null,w,t),X=Yi.bind(null,f),Q=r.showCasperExpiringTooltip.bind(null,t,e),Z=()=>showWiki({w:"expired_messages"}),J=Gs.bind(null,t),ee=e=>function(e,t){var n=t.target.closest("._im_call_snippet_join_btn"),a=n.closest("._im_mess_callsnippet"),i=n.dataset.link,s=+a.dataset.peer;Object(r.isCallToPeerAvailable)(e,s)&&Object(r.joinCallFromIm)(e,s,i,!1,r.CALL_ENTRY_POINT_JOIN_SNIPPET)}(t,e),te=qs.bind(null,t,e),ne=Object(p.createModule)({handlers:(n,s)=>{s(e,"click",r.RESTORE_CLASS,R),s(e,"mouseover click",r.FAILED_CLASS,F),s(e,"mouseover","_im_edit_time",U),s(e,"mouseover","_im_page_info",G),s(e,"click","_im_mess_susp",qi.bind(null,e)),s(e,"click","_im_failed_action",q),s(e,"click","_im_mess_link",V),s(e,"mouseover","_im_admin_name",Ss),s(e,"mouseover","_im_mess_srv",K),s(e,"mouseover","im-mess-stack--bomb",Q),s(e,"mouseover","mem_pseudolink",e=>function(e,t){var n=e.target.dataset.mention,a=null;switch(!0){case y.MASS_MENTION_ALIASES.all.includes(n):a=getLang("mail_im_mention_all");break;case y.MASS_MENTION_ALIASES.online.includes(n):a=getLang("mail_im_mention_online")}a&&(window.tooltips&&window.tooltips.destroy(e.target),Object(l.showTooltip)(e.target,{shift:[0,5],center:!0,black:1,className:"im-mass-mention-tt",reverseOffset:!0,toup:e.target.getBoundingClientRect().top>Object(r.getHistoryTopIndent)(t)+37,text:a,noZIndex:!0}))}(e,t)),s(e,"mouseover","_im_mess_pinned",te),s(e,"click","im_srv_mess_link",Y),s(e,"click","_im_error",X),s(e,"click","_im_replied_message",$),s(e,"click","_im_replied_author_link",Bs),s(e,"click","_chat_invitation",(e,n)=>{if(checkEvent(e))return!0;if(!gpeByClass("wall_postlink_preview_btn",e.target)&&!hasClass(e.target,"wall_postlink_preview_btn"))return!0;var i=geByClass1("flat_button",n),s={invite_chat_id:domData(i,"inv-id"),invite_hash:domData(i,"hash")};Object(r.showInvitationBox)(t,s,a.leaveInvitation),cancelEvent(e)}),s(e,"click","_im_join_call_by_link",r.handleCallLinkClick),s(e,"click","_im_join_cancel",()=>t.get().longpoll.push([Object(h.resetPeer)()])),s(e,"click","_im_retry_media",e=>function(e,t,n){var s=e.get(),o=domClosest("_im_mess",n.target),l=domData(o,"msgid"),c=Object(i.getMessage)(s,s.peer,l),d=e=>t().replaceAttachmentPlaceholders(e,c);c&&(Object(qe.statlogsSendingRetry)("retry_attach"),e.set(a.addAttachmentsToStoreData.bind(null,c,[Object(r.renderMessageMedia)(e,c)])).then(d),e.set(a.loadMedia.bind(null,c)).then(d))}(t,f,e)),s(e,"click",r.MESSAGE_KEYBOARD_BUTTON_CLASS,z),s(e,"click","_im-call-snippet",J),s(e,"click","_im_call_snippet_join_btn",ee),n(geByClass1("_im_peer_history_w",e),"mousemove",O.show),n(geByClass1("_im_start_new",e),"click",x),n(e.querySelector("._im_to_end"),"click",B),n(e.querySelector("._im_to_mention"),"click",H),n(geByClass1("_im_cancel_edit",e),"click",()=>(f().cancelEditing(),!1)),n(geByClass1("_im_edit_focus_cur",e),"click",()=>(f().focusEditingMessage(),!1)),We.screenfull.raw&&n(document,We.screenfull.raw.fullscreenchange,W),n(window,"im_goToMessage",e=>{var n=intval(e.msgid);if(n)return window.statlogsValueEvent("im_links_to_attachments",1,"to_message"),t.set(a.changePeer.bind(null,e.sel,n,!1)).then(()=>Object(r.focusOnMessage)(t,f().focusOnMessage,t.get().peer,n))}),s(e,"click","im-expired-message--in",Z)}});curNotifier.recvClbks.pin_hide=[function(e){e.hide?Object($e.pinnedMessageHide)(t,e.peer,f,!1):Object($e.pinnedMessageUnHide)(t,e.peer,f,!1)}],window.showForwardBox=e=>function(e,t){Object(r.boxHandleMessagesLabelsTooltips)(showBox("al_im.php",t,{dark:1}),e)}(t,e);var ae=setInterval(cs.bind(null,t,e,A),1e4);return b(ne,e,T,A,w,f,o,L,k,M,j,t,v,ae,O,P,I,N)}function Ys(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var n=[],a=!0,r=!1,i=void 0;try{for(var s,o=e[Symbol.iterator]();!(a=(s=o.next()).done)&&(n.push(s.value),!t||n.length!==t);a=!0);}catch(e){r=!0,i=e}finally{try{a||null==o.return||o.return()}finally{if(r)throw i}}return n}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return $s(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return $s(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function $s(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,a=new Array(t);n<t;n++)a[n]=e[n];return a}var zs=[],Xs=0,Qs=!1;function Zs(e){zs=zs.reduce((t,n)=>{var a=Ys(n,2),r=a[0],i=a[1];return i(e)?t:t.concat([[r,i]])},[])}function Js(e,t){!1===Qs&&(Qs=!0,document.body.addEventListener("click",Zs,!0)),zs=zs.concat([[e,t]])}function eo(e){zs=zs.filter(t=>Ys(t,1)[0]!==e),0===Xs&&(document.body.removeEventListener("click",Zs,!0),Qs=!1)}function to(e,t){zs=zs.map(n=>{var a=Ys(n,2),r=a[0],i=a[1];return r===e?[e,t]:[r,i]})}function no(e,t){return 0===t.length?t=>(e(t),!0):n=>{var a=t.reduce((e,t)=>e&&!domClosest(t,n.target),!0);return a&&e(n),a}}var ao=n("XzvV"),ro=n("enZq"),io=n("RdBX"),so=n("xGYt").default,oo=function(e){var t=e.onClose,n=e.contacts,a=e.selectPeer,i=Qe.a.useState(""),s=i[0],o=i[1],l=Qe.a.useState(n),c=l[0],d=l[1],u=Object(Xe.useMemo)((function(){return new io.vkIndexer(n,(function(e){return[e.name,e.user&&e.user.full_name].filter(Boolean).join(" ")}))}),[n]);Qe.a.useEffect((function(){if(0!==s.length){var e=u.search(s);d(e)}else d(n)}),[s]);return Qe.a.createElement("div",{className:"ContactsListContent"},Qe.a.createElement(nt.BlockSearchInput,{onChange:function(e){return t=e.target.value,void o(t);var t},placeholder:Object(dt.getLang)("mail_top_search"),autoFocus:!0,key:"search",value:s}),0===c.length?Qe.a.createElement(at.default,{className:"ContactsListContent__stub",key:"no-results"},Object(dt.getLang)("mail_im_search_empty_contacts")):Qe.a.createElement(Qn.default,{className:"ContactsListContent__scroll"},Qe.a.createElement(ro.default,{className:"ContactsListContent__list"},c.map((function(e){var n=e.user?e.user.user_id:19e8+e.id,i=Object(r.prepareContactName)(e.name);return Qe.a.createElement(so,{key:e.id,onClick:function(){return function(e){a(e),t()}(n)},className:"ContactsListContent__contact"},Qe.a.createElement("div",{className:"ContactsListContent__contactAvatar"},e.user?Qe.a.createElement("img",{className:"ContactsListContent__contactAvatarImage",src:e.user.photo,alt:e.name}):Qe.a.createElement(xt.ConversationNoPhoto,{text:Object(r.getUserInitials)(e.name),size:"34",id:n,specificType:7,key:e.id})),Qe.a.createElement("div",{className:"ContactsListContent__contactName"},Qe.a.createElement(Bt.default,null,i)))})))))},lo=function(e){var t=e.onClose,n=e.selectPeer,a=e.getContactsList,r=Qe.a.useState({kind:"loading"}),i=r[0],s=r[1];switch(Qe.a.useEffect((function(){a().then((function(e){s({kind:"loaded",contactsList:e})})).catch((function(e){Object(_.showErrorBox)(Object(dt.getLang)("global_error")),s({kind:"failed",error:e}),t()}))}),[]),i.kind){case"failed":return Qe.a.createElement(Qe.a.Fragment,null);case"loading":return Qe.a.createElement(Ft,null);case"loaded":return Qe.a.createElement(Pt.default,{onClose:t,disableBodyScroll:!0,className:"ContactsList"},Qe.a.createElement(Dt.default.Header,{title:Object(dt.getLang)("mail_contacts_list"),onClose:t,appearance:"blue"}),Qe.a.createElement("div",{className:"ContactsList__body"},Qe.a.createElement(oo,{contacts:i.contactsList,onClose:t,selectPeer:n})))}};function co(e,t){var n=uo();Ze.render(Xe.createElement(lo,{onClose:t.closeContactList,getContactsList:()=>function(e){return $t(e).then(e=>{var t=e.get().contactsList;return Promise.resolve(t)})}(e),selectPeer:t=>function(e,t){e.get().longpoll.push([Object(h.changePeer)(t,!1,!0,!0,"")])}(e,t)}),n)}function uo(){var e=document.getElementById("_im_contacts_list");if(e)return e;var t=document.createElement("section");return t.setAttribute("id","_im_contacts_list"),document.body.appendChild(t),t}function go(e,t){return{unmount:()=>function(e,t){var n=uo();n&&Ze.unmountComponentAtNode(n),Object(p.destroyModule)(e)}(e),closeContactList(){var e=uo();Ze.unmountComponentAtNode(e)}}}function mo(e){var t=(0,Object(p.createMutations)(go).bindMutations)(Object(p.createModule)({handlers:(e,t)=>{}}),e);return co(e,t),t}function _o(){return(_o=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e}).apply(this,arguments)}function po(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var n=[],a=!0,r=!1,i=void 0;try{for(var s,o=e[Symbol.iterator]();!(a=(s=o.next()).done)&&(n.push(s.value),!t||n.length!==t);a=!0);}catch(e){r=!0,i=e}finally{try{a||null==o.return||o.return()}finally{if(r)throw i}}return n}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return ho(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return ho(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function ho(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,a=new Array(t);n<t;n++)a[n]=e[n];return a}var fo=Object(ka.debounce)(q.statlogsProbValueEvent,1e3);function bo(e,t,n,r,s,o,l){var c=trim(o);if(Object(i.isSearchingValue)(e,c)){var d=()=>l.clearSearch(e,t);c?(e.setState({recentSearch:!1}),s.stop()):s.replaceOrAdd(d),cancelStackPush("im_search",d),c&&e.set(e=>Object(a.setCurrentSearch)(c,!1,e)).then(t),r.classList.add("im-page--dialogs-search_fill","_im_d_search"),Object(i.isCommunityInterface)(e)||l.showCancelControl()}else c||(s.stop(),e.set(e=>Object(a.setCurrentSearch)("",!1,e)).then(t),r.classList.remove("im-page--dialogs-search_fill","_im_d_search"),Object(i.isCommunityInterface)(e)||l.hideCancelControl())}function vo(e,t,n){return function(){var a=Object(i.getSearchText)(t);a===e&&n(...arguments)}}function Oo(e,t,n){var r=Object(i.getSearchText)(n);return fo(.01,"im_search_stat",1,"search_start"),Object(a.updateSearchQuery)(r),n.setState({recentSearch:!1}),e().toggleSettingsButton(n,!!r),r?(n.get().dialog_search_going=!0,function(e,t,n){var r=vo(e,n,e=>t().appendFastDialogs(n,e));return Object(a.searchTopConv)(e,n.get()).then(e=>(r(e),e))}(r,e,n).then(a=>{var i=a.map(e=>e.peerId);return t(r,e,i,n)}).then(()=>{n.get().dialog_search_going=!1}).catch(()=>{})):(e().restoreDialogs(n,!1,!0),Object(ao.removeSearchPositionTracker)("messages"),Promise.resolve(!1))}function yo(e,t,n,i){var s=i.get(),o=vo(e,i,e=>t().appendDialogs(i,e)),l=vo(e,i,t().appendSearch);return Object(r.isPendingForward)(i)?Object(a.searchHints)(e,n,"all",{},s).then(o):Promise.all([Object(a.searchHints)(e,n,"all",{},s).then(o),Object(a.searchMessages)(e,s)]).then(e=>{var t=po(e,2),n=po(t[1],2),a=n[0],r=n[1];l(i,a,r,!0)})}function Co(e,t,n){var r=n.target;e.set(e=>Object(a.toggleCommunityMute)(t,e)).then(()=>{r.classList.toggle("im-page--gim-mute_muted",e.get().mute),t&&Eo(e,{target:r})})}function Eo(e,t){var n=t.target;return Object(l.showTooltip)(n,{text:()=>e.get().mute?Object(o.getLang)("mail_im_sound_off"):Object(o.getLang)("mail_im_sound_on"),black:1,shift:[13,9],appendCls:"js-im-page"})}function jo(e,t,n,a,r,s,o,l,c){return{focusInput(){uiSearch.focus(a.parentNode)},hideCancelControl(){n.classList.remove("im-page--dialogs-header-controls_hidden"),t.classList.add("im-dialog-select_hidden"),t.classList.remove("im-dialog-select_rotated")},showCancelControl(){n.classList.add("im-page--dialogs-header-controls_hidden"),t.classList.add("im-dialog-select_rotated"),t.classList.remove("im-dialog-select_hidden")},setSearch(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2]?c:()=>{};a.value=t,bo(e,n,0,a,s,t,l())},clearSearch(e,t){cancelStackFilter("im_search"),Object(i.isCommunityInterface)(e)||l().hideCancelControl(),uiSearch.reset(a),e.setState({recentSearch:!1}),bo(e,t||(()=>{}),0,a,s,a.value,l())},unmount(){s.stop(),Object(p.destroyModule)(o),uiSearch.destroy(r),cancelStackFilter("im_search")}}}function To(e,t,n){var s=Object(p.createMutations)(jo),c=s.callMutations,d=s.bindMutations,u=geByClass1("_im_dialogs_header_controls",e),g=geByClass1("_im_create_convo",e),m=geByClass1("_im_create_call",e),_=geByClass1("_im_search_cancel",e),f=ge("im_dialogs_search",e),b=geByClass1("_im_gim_mute",e),v=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return Xs++,{stop(){Xs--,eo(e)},replaceOrAdd(n){var a=zs.filter(t=>{var n=Ys(t,1)[0];return e===n}),r=no(n,t);a.length>0?to(e,r):Js(e,r)}}}("im_search",["_im_search_more","_im_create_convo","_im_create_call","_im_page_dcontent","_im_d_search","_im_dialog"]),O=Object(vt.debouncedPromise)(yo,300),y=e=>Oo(n,O,e),C=e=>bo(t,y,0,f,v,e,c()),E=()=>c().clearSearch(t,y),j=geByClass1("_im_dialogs_search_input",e);uiSearch.init(j,{onChange:C}),f.value&&setTimeout(()=>C(f.value),0);var T=e=>{Object(l.showTooltip)(e.target,{text:Object(o.getLang)("mail_admin_av_time"),dir:geByClass1("_im_top_notice")||geByClass1("im-page--dialogs--group-status")?"down":"up",shift:[0,8]})},S=()=>{var e;e=0===t.get().peer||Object(r.isPendingForward)(t)?"search":"default",Object(i.isSearching)(t)||n().toggleSettingsButton(t,!1),t.get().longpoll.push([Object(h.transitionEvent)(e)])},I=()=>{Object(i.isSearching)(t)&&n().toggleSettingsButton(t,!0),function(e,t,n,s,o,l){if(!Object(i.isSearching)(e)){var c=cur.imDb.select(yi.RECENT_SEARCH_OP);if(0!==c.length||Object(i.doPopularSuggExist)(e)){e.setState({recentSearch:!0}),bo(e,()=>{Object(i.isSearching)(e)||(s.stop(),o().toggleSettingsButton(e,!1),o().restoreDialogs(e,!1,!0))},0,n,s,"",l);var d=c.filter(t=>!Object(r.isTabLoadedWithMessage)(e.get(),t)),u=c.filter(t=>Object(r.isTabLoadedWithMessage)(e.get(),t)).reduce((t,n)=>(t[n]=Object(i.getTab)(e,n),t),{});e.get().topConvTree.then(t=>{var n=t.list.filter(e=>d.includes(e[0])).reduce((e,t)=>(e[t[0]]=Object(a.localIndexToDialog)(t),e),{}),r=_o({},n,{},u);return o().appendFastDialogs(e,c.map(e=>r[e])),n}).then(t=>Object(a.searchHints)(!1,Object.keys(t),!1,{},e.get())).then(t=>{o().appendDialogs(e,t)})}}}(t,0,f,v,n,c())},A=(e,n)=>{switch(n.dataset.action){case"contacts":mo(t);break;case"favorites":nav.go("/im?box=fav")}},w=Object(p.createModule)({handlers:(a,s)=>{a(_,"click",E),a(_,"mouseover",()=>function(e,t){return Object(l.showTooltip)(t,{appendEl:bodyNode,text:Object(o.getLang)("mail_cancel"),black:1,shift:[3,-1],appendCls:"js-im-page"})}(0,_)),a(g,"click",()=>n().showCreation(t)),a(m,"click",()=>Object(r.startCallFromIm)(t,null,!1,null,r.CALL_ENTRY_POINT_LIST)),s(e,"click","_im_search_more_action",A),a(geByClass1("_im_av_time",e),"mouseover",T),Object(i.isCommunityInterface)(t)&&(a(b,"click",e=>Co(t,!0,e)),a(b,"mouseover",e=>Eo(t,e))),a(f,"click",I),a(f,"blur",S),a(f,"focus",()=>{t.get().longpoll.push([Object(h.transitionEvent)("search")])})}});return Object(i.isCommunityInterface)(t)&&Co(t,!1,{target:b}),d(e,_,u,f,j,v,w,c,y)}var So=n("W9Tc");function Io(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var n=[],a=!0,r=!1,i=void 0;try{for(var s,o=e[Symbol.iterator]();!(a=(s=o.next()).done)&&(n.push(s.value),!t||n.length!==t);a=!0);}catch(e){r=!0,i=e}finally{try{a||null==o.return||o.return()}finally{if(r)throw i}}return n}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return Ao(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Ao(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Ao(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,a=new Array(t);n<t;n++)a[n]=e[n];return a}function wo(e,t,n,i){if(!e.loading&&!e.all&&n.scrollTop+window.innerHeight-n.scrollHeight>-300){var s=geByClass1("_im_peer_history",t.bodyNode);e.loading=!0,Object(r.wrapLoading)(s)(Object(a.loadSpam)(e.offset,i.get().gid).then(t=>{var n=Io(t,4),o=(n[0],n[1]),l=(n[2],n[3]);e.all=l.all,e.offset=l.offset,e.all?addClass(s,"im-important_all"):e.loading=!1,i.set(a.mergeTabs.bind(null,Object(r.tabFromIds)(l.msgs,l.hash)));var c=ce("div");c.innerHTML=o,s.appendChild(c),Object(r.ensureDomHasActions)(s)}),"bottom")}}function Lo(e,t){var n=t.get().selectedMessages,a=geByClass1("_im_spam_box",e.bodyNode),i=geByClass1("ui_tab_sel",e.bodyNode);if(n.length>0){var s=getLang("mail_selected",n.length);s=s.replace("{count}",n.length),val(i,s+`<button aria-label="${getLang("mail_deselect_all")}" type="button" class="im-deselect ${r.DESELECT_ALL_CLASS}"></button>`)}else val(i,getLang("mail_spam"));0===n.length?removeClass(a,"im-important-box_with-sel"):(addClass(a,"im-important-box_with-sel"),val(geByClass1("_im_spam_not_spam"),getLang("mail_im_mark_notspam",n.length)),val(geByClass1("_im_spam_spam"),getLang("mail_im_mark_delspam",n.length)))}function ko(e,t,n){var r=e.get().selectedMessages;e.set(a.cleanSelected).then(n.cleanSelection.bind(null,r)).then(n=>Lo(t,e))}function Mo(e,t,n,i){var s=gpeByClass("_im_mess",i,t);if(s){var o=intval(domData(s,"msgid"));s&&(Object(a.removeMessageSend)([o],0,e.get().tabs[0].hash,"undel",e.get()),Object(r.restoreMessage)(o,0,t))}}function No(e,t,n){var i=e.get().selectedMessages;Object(a.removeMessageSend)(i,0,e.get().tabs[0].hash,"delete",e.get()),Object(r.removeMessagesWithRestore)(i,0,"delete",t),ko(e,t,n)}function Po(e,t,n){var i=e.get().selectedMessages;Object(a.removeMessageSend)(i,0,e.get().tabs[0].hash,"nospam",e.get()),i.map(e=>geByClass1("_im_mess_"+e)).filter(e=>e).forEach(e=>{var t=intval(domData(e,"peer")),n=intval(domData(e,"msgid"));val(e,Object(r.renderGoTo)(t,n)),addClass(e,"im-mess_light")}),ko(e,t,n)}function Do(e,t,n,a,r){var i=gpeByClass("_im_mess",r,t.bodyNode),s=intval(domData(i,"peer")),o=intval(domData(i,"msgid"));return t.hide(),n().unmount(),e.get().longpoll.push([Object(h.changePeer)(s,o)]),Object(ea.stopEvent)(a),cancelEvent(a),!1}function Ro(e,t,n,r){var i=Object(Ke.showFastBox)({title:getLang("mail_deleteall1"),dark:1,bodyStyle:"padding: 20px; line-height: 160%;"},getLang("mail_delete_all_spam"),getLang("mail_delete"),()=>{Object(a.flushSpam)(e,r).then(e=>{var t=Io(e,2),n=(t[0],t[1]);showDoneBox(n)}),i.hide(),t.hide(),n().unmount()},getLang("mail_close"),()=>i.hide())}function xo(e,t){return{unmount(){t.unmount(),Object(p.destroyModule)(e)}}}function Bo(e,t,n){var a=ge("box_layer_wrap"),i=Object(p.createMutations)(xo),s=i.callMutations,o=i.bindMutations,l=Object(C.default)({peer:0,oCache:{},tabs:Object(r.tabFromIds)(n.msgs,n.hash),gid:t.get().gid}),c=wo.bind(null,{all:n.all,loading:!1,offset:n.offset},e,a,l),d=Mo.bind(null,l,e.bodyNode),u=Do.bind(null,t,e,s),g=Ro.bind(null,n.hash,e,s,t.get().gid),m=ii(e.bodyNode,l,t=>({changedMessageSelection:Lo.bind(null,e)})),_=No.bind(null,l,e.bodyNode,m),h=Po.bind(null,l,e.bodyNode,m),f=ko.bind(null,l,e,m);return Object(r.ensureDomHasActions)(e.bodyNode),o(Object(p.createModule)({handlers:(t,n)=>{t(a,"scroll",c),t(geByClass1("_im_spam_spam",e.bodyNode),"click",_),t(geByClass1("_im_spam_not_spam",e.bodyNode),"click",h),t(geByClass1("_im_spam_flush",e.bodyNode),"click",g),n(e.bodyNode,"click","_im_mess_restore",d),n(e.bodyNode,"click","_im_go_to",u),n(e.bodyNode,"click",r.DESELECT_ALL_CLASS,f)}}),m)}function Ho(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"im_settings",t={sound:ls.get("sound_notify_off")?getLang("mail_im_sound_off"):getLang("mail_im_sound_on")};return window.pushNotifier&&window.pushNotifier.loadEndpoint()||Object(So.partConfigEnabled)("push_notifier")&&ls.get("im_ui_notify_off")?t.browser=getLang("mail_notification_settings"):t.browser=Uo()?getLang("mail_im_notifications_on"):getLang("mail_im_notifications_off"),getTemplate(e,t)}function Fo(e,t){Object(l.showTooltip)(t.target,{content:Ho("im_settings_pop"),dir:"down",shift:[220,9],hasover:!0,showdt:10})}function Uo(){return DesktopNotifications.supported()&&!DesktopNotifications.checkPermission()&&!ls.get("im_ui_notify_off")}function Go(e,t,n,a,i){var s=domData(i,"action"),o=gpeByClass("_im_settings_menu",i),l=hasClass(o,"_im_settings_popup")?"im_settings_pop":"im_settings";switch(s){case"spam":Object(r.showSpamLayer)(e,Bo,a);break;case"sound":ls.get("sound_notify_off")?ls.set("sound_notify_off",0):ls.set("sound_notify_off",1),o.outerHTML=Ho(l);break;case"browser":Uo()?(ls.set("im_ui_notify_off",1),o.outerHTML=Ho(l),Object(qe.statlogsBrowserNotificationsOff)()):DesktopNotifications.checkPermission()?DesktopNotifications.requestPermission(()=>{o.parentNode&&(o.outerHTML=Ho(l))}):Object(So.partConfigEnabled)("push_notifier")?nav.go("/settings?act=notify"):(ls.set("im_ui_notify_off",0),o.outerHTML=Ho(l),Object(qe.statlogsBrowserNotificationsOn)())}}function qo(e,t,n){var s=Fo.bind(null,t),o=Go.bind(null,t,n,e),l=function(e,i){if(Object(r.showUnreadOnly)(t,n,a.changeDialogsTab)){var s=t.get().active_tab===y.FOLDER_UNREAD;val(i,getTemplate("im_filter",{filter:s?getLang("mail_to_all_dialogs"):getLang("mail_to_unread")}))}},c=Object(p.createModule)({handlers:(t,n)=>{n(e,"mouseover","_im_dialogs_cog_settings",s),n(e,"click","_im_settings_action",o),n(e,"click","_im_to_unread",l)}});return function(e,t){return{updateFilter(t){var n,a=t.get().active_tab===y.FOLDER_UNREAD,r=[];Object(i.isSearching)(t)&&r.push("im-page--dialogs-filter_hidden"),t.get().unread_cnt>0?n=a?getLang("mail_to_all_dialogs"):getLang("mail_to_unread"):(n=getLang("mail_all_dialogs"),r.push("im-page--dialogs-filter_disabled")),val(geByClass1("_im_to_unread",e),getTemplate("im_filter",{filter:n,cls:r.join(" ")}))},toggleButton(t,n){var a=geByClass1("im-page--dialogs-filter",e);toggleClass(a,"im-page--dialogs-filter_hidden",n)},toggleLoader(t,n){var a=geByClass1("_im_dialogs_cog_settings",e);toggleClass(a,"im-page--dialogs-settings_loading",n)},updateSettings(t){geByClass1("_im_settings_menu",e).outerHTML=Ho()},unmount(){Object(p.destroyModule)(t)}}}(e,c)}var Vo=n("iukX");function Wo(e,t){return t.selection||(t.selection=[]),t.selection.push(e),Promise.resolve(t)}function Ko(e){return e.selection=[],Promise.resolve(e)}function Yo(e,t){return t.selection=t.selection.filter(t=>t.id!==e),Promise.resolve(t)}function $o(e,t,n,a,r,i,s){var o=intval(domData(s,"peer"));tooltips.hide(s),t.set(Yo.bind(null,o)).then(i=>{Xo(e,a,t,r),n().selectionDeleted(t,o)})}function zo(e,t,n,r){e.set(a.setCurrentSearch.bind(null,n,!1)).then(t().onChange)}function Xo(e,t,n,a){var r=n.get().selection,i=uiSearch.getFieldEl(e);uiSearch.focus(e),r.length>0?attr(i,"placeholder",""):attr(i,"placeholder",unclean(Object(o.getLang)("mail_search_creation"))),t.innerHTML=r.map(e=>`<div class="token">\n      <div class="token_title">${e.name}</div>\n      <div data-peer="${e.id}" class="token_del _ui_multiselect_cancel"></div>\n    </div>`).join(""),toggleClass(e,"ui_multiselect_has_selection",r.length>0),domFC(e).scrollTop+=50,a()}function Qo(e,t){return Object(l.showTooltip)(t,{text:Object(o.getLang)("mail_create_chat_remove_user"),black:1,shift:[15,8],appendParentCls:"_wrap"})}function Zo(e,t,n){uiSearch.init(e,{onChange:zo.bind(null,t,n)});var a=uiSearch.getFieldEl(e),r=ce("div",{className:"_ui_multiselection ui_multiselect_cnt"});a&&a.parentNode.insertBefore(r,a);var i,s,o=(i=a,s=0,function(){var e=i.offsetWidth;setStyle(i,{width:1});var t=i.offsetLeft;s!==t?(s=t,e=i.parentNode.offsetWidth,setStyle(i,{width:Math.max(30,e-t-20)})):setStyle(i,{width:e})});t.set(Ko);var l=$o.bind(null,e,t,n,r,o),c=t=>{document.activeElement!==a&&uiSearch.focus(e)},d=Object(p.createModule)({handlers:(t,n)=>{n(e,"click","_ui_multiselect_cancel",l),n(e,"mouseover","_ui_multiselect_cancel",Qo),t(e,"click",c)}});return{addSelection:(n,a)=>t.set(Wo.bind(null,{id:n,name:a})).then(Xo.bind(null,e,r,t,o)),removeSelection:n=>t.set(Yo.bind(null,n)).then(Xo.bind(null,e,r,t,o)),resetSelection(){!function(e,t,n,a){e.set(Ko).then(Xo.bind(null,t,n,e,a))}(t,e,r,o)},focus(){uiSearch.focus(e)},save(){t.stash(),Xo(e,r,t,o)},restore(){t.pop(),Xo(e,r,t,o)},unmount(){uiSearch.destroy(e),Object(p.destroyModule)(d)}}}var Jo=n("v+DW"),el="_im_dialogs_creation_name",tl="_im_create_select",nl=["im-creation--item_hovered"],al=0;function rl(e){!function(e){var t=e.querySelector("._im_creation_settings_modal_wrap"),n=il.bind(null,t);Ze.render(Xe.createElement(Pt.default,{onClose:n,className:"im-creation--modal-settings"},Xe.createElement(et.default,{title:Object(o.getLang)("mail_chat_creation_settings"),onCloseClick:n}),Xe.createElement(Vo.default,{flags:al,back:n,isChatCreation:!0,onSave:sl,afterSave:ol.bind(null,t),onCancel:n})),t)}(e)}function il(e){e&&Ze.unmountComponentAtNode(e)}function sl(e){return al=e,Promise.resolve()}function ol(e){il(e)}function ll(e){return Object(l.showTooltip)(e,{text:Object(o.getLang)("mail_chat_creation_settings_icon_tooltip"),black:1,center:!0,zIndex:1e3,shift:[0,10]})}function cl(e,t,n,r,i,s){Object(a.toggleConversation)(!1),removeClass(t,"im-create_shown"),removeClass(t,"im-create_photo-attached"),setTimeout(ul.bind(null,t,!1),100),hl(s).map(e=>geByClass1("_im_dialog"+e)).forEach(e=>{removeClass(e,"olist_item_wrap_on")}),n().createCanceled(e),i.resetSelection(),"add_member"===e.get().creationType&&e.set(a.setCreationType.bind(null,"chat",[])),e.set(a.presetAvatar.bind(null,!1));var o=geByClass1("_im_avatar_img",t);gl(e,s,t),uiSearch.reset(geByClass1(el,t)),uiSearch.reset(geByClass1(tl,t)),o&&o.parentNode.removeChild(o),gl(e,s,t),cancelStackFilter("im_search");var l=0===e.get().peer?"search":"default";e.get().longpoll.push([Object(h.transitionEvent)(l)]),attr(t,"aria-hidden","true")}function dl(e,t,n){return t&&(n.current_create_peer_ids={},n.current_create_peers=[]),n.current_create_peer_ids||(n.current_create_peer_ids={}),n.current_create_peers||(n.current_create_peers=[]),e.forEach(e=>{e.then(e=>{e=e.filter(e=>!n.current_create_peer_ids[e.peerId]),n.current_create_peer_ids=e.reduce((e,t)=>(e[t.peerId]=!0,e),n.current_create_peer_ids),n.current_create_peers=n.current_create_peers.concat(e)})}),Promise.resolve(n)}function ul(e,t){toggleClass(e,"im-create_material",t)}function gl(e,t,n){var a=geByClass1("_im_confirm_creation",n),r=t.get().selection.length,i="add_member"===e.get().creationType,s=r>0,l=uiSearch.getFieldEl(geByClass1(el,n)).value.length>0,c=!s&&(i||!l),d=i?1===r?Object(o.getLang)("mail_append_chat"):Object(o.getLang)("mail_im_create_chat_with"):l||r>1?Object(o.getLang)("mail_im_create_chat"):Object(o.getLang)("mail_im_go_to_dialog");val(a,d),toggleClass(a,"button_disabled",c)}function ml(e,t,n,a,r,i,s){if(s){var o,l=intval(domData(s,"list-id")),c=hl(i),d=trim(s.textContent),u=geByClass1(tl,t),g=getSize(u)[1];inArray(l,c)?(o=a.removeSelection(l,d),removeClass(s,"olist_item_wrap_on")):(o=a.addSelection(l,d),addClass(s,"olist_item_wrap_on")),o.then(()=>{var e=g-getSize(u)[1],t=r.scrollTop();r.scrollTop(t-e)}),gl(e,i,t);var m=geByClass1(tl,t);uiSearch.reset(m)}}function _l(e,t){var n=hl(e),a=["_im_dialog","_im_dialog"+t.peerId,"im-creation--item"],r=[];return t.online&&r.push("online"),mobPlatforms[t.online]&&r.push("mobile"),inArray(t.peerId,n)&&a.push("olist_item_wrap_on"),getTemplate("im_owner_item",{owner_id:t.peerId,cls:" "+a.join(" "),photo:t.photo,name:t.name,link:t.href,img_cls:r.join(" ")})}function pl(e){return Object(i.getSearchText)(e)||!1}function hl(e){return e.get().selection.map(e=>e.id)}function fl(e,t,n){return e.then(e=>e.filter(e=>e.is_friend&&!inArray(e.peerId,n.get().creationFilter)))}function bl(e,t,n,r,i){var s,o,l=geByClass1(tl,e),c=Object(a.searchLocalHints)(r,t.get()),d=n.hoverFirstElement.bind(n,nl,jl(t));t.get().creation_shown_all=!1,n.reset(),n.pipe(fl(c,0,t),r),n.toTop(),r?(o=Object(a.searchTopConv)(r,t.get()),s=Object(a.searchHintsIndex)(r,[],"friends",t.get()),n.pipe(fl(s,0,t),r).then(d),n.pipe(fl(o,0,t),r).then(d)):(s=Promise.resolve([]),o=Promise.resolve([])),t.set(dl.bind(null,[c,o,s],!0)),uiSearch.showProgress(l),Promise.all([c,s,o]).then(()=>uiSearch.hideProgress(l))}function vl(e,t,n,r){var i=2e9+Math.round(rand(1e6,2e6));cur.recieveCropResult=n=>{cur.recieveCropResult=!1,curBox()&&curBox().hide(),e.set(a.presetAvatar.bind(null,n)),Object(a.getOwnerPhoto)(n,i).then(e=>{geByClass1("_im_create_avatar",t).appendChild(ce("img",{className:"im-chat-placeholder--img _im_avatar_img",src:e}))}),addClass(t,"im-create_photo-attached")},Page.ownerPhoto(i)}function Ol(e,t){geByClass1("_im_create_avatar",t).innerHTML="",e.set(a.presetAvatar.bind(null,!1)),removeClass(t,"im-create_photo-attached")}function yl(e,t,n,a,r,i){hl(t).map(e=>geByClass1("_im_dialog"+e)).forEach(e=>removeClass(e,"olist_item_wrap_on")),t.reset(),bl(n,e,a,!1,hl(t)),r.resetSelection(),cl(e,n,i,0,r,t)}function Cl(e,t,n,r,s,l,c){var d=hl(t),u=e.get(),g=geByClass1("_im_confirm_creation",n),m=uiSearch.getFieldEl(geByClass1(el,n)).value,_="add_member"===e.get().creationType,p=!_&&(m.length||d.length>1),f=geByClass1("_im_creation_show_history_input",n).checked;if(_)return e.set(a.addNewMember.bind(null,u.peer,d,f)).catch(e=>Object(Ke.showFastBox)(Object(o.getLang)("global_error"),e)),cl(e,n,l,0,s,t);if(Object(Jo.lockButton)(g),!p)return b(d[0]);function b(a){al=0,yl(e,t,n,r,s,l),function(e,t,n,a,r,i){cl(e,t,n,0,r,i),e.get().longpoll.push([Object(h.changePeer)(a,!1,!1,!1,"create_conversation")])}(e,n,l,a,s,t),Object(Jo.unlockButton)(g),Object(i.isSearching)(e)?l().cancelSearch(e):l().restoreDialogs(e)}e.set(a.createChat.bind(null,u.next_chat_avatar,d,m,al)).then(()=>b(u.next_peer)).catch(e=>{Object(Jo.unlockButton)(g),topMsg(Object(o.getLang)("global_unknown_error"),2,"#FFB4A3")})}function El(e,t){return Object(l.showTooltip)(e,{text:Object(o.getLang)("mail_cancel"),black:1,zIndex:1e3,shift:[3,-2],appendCls:"js-im-page"})}function jl(e,t){var n=t&&t.get().selection.length;return{top:-1,bottom:Object(r.isClassicInterface)(e)?n>0?69:0:-1}}function Tl(e,t,n){gl(e,t,n)}function Sl(e,t,n,a,r,i,s,l){return{show(t){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];t.setState({shown:!0}),ul(e,!0),cancelStackPush("im_create",s),addClass(e,"im-create_shown");var l=a.get().selection.reduce((e,t)=>(e[t.id]=!0,e),{});i&&i.forEach(t=>{if(!l[t[0]]){var n=e.querySelector("._im_dialog"+t[0]);r.addSelection(t[0],t[1]),n&&!n.classList.contains("olist_item_wrap_on")&&n.classList.add("olist_item_wrap_on")}}),function(e,t,n,a){toggleClass(e,"im-create_chat","chat"===a.get().creationType),toggleClass(e,"im-create_invite","add_member"===a.get().creationType);var r="chat"===a.get().creationType?Object(o.getLang)("mail_im_group_dialog"):Object(o.getLang)("mail_im_friends_tab"),i=geByClass1("_im_create_title",e);val(i,r),val(geByClass1("_im_confirm_creation",e),"add_member"===a.get().creationType?Object(o.getLang)("mail_im_create_chat_with"):Object(o.getLang)("mail_im_create_chat")),bl(e,a,t,!1,n.get().selection.map(e=>e.id))}(e,n,a,t),setTimeout(()=>{t.get().longpoll.push([Object(h.transitionEvent)("create")]),attr(e,"aria-hidden","false"),r.focus()},1)},focusSearch(e){r.focus()},confirmCreate(e){l()},hide(n){n.get().shown=!1,cl(n,e,t,0,r,a)},scroll(e){n.scrollPage(e,!0)},updateScroll(){n.updateScroll()},selectElement(t){ml(t,e,0,r,n,a,n.getHoveredElement())},hoverPrevElement(e){n.hoverPrevElement(nl,null,jl(e,a))},hoverNextElement(e){n.hoverNextElement(nl,null,jl(e,a))},unmount(){Object(p.destroyModule)(i),n.unmount(),r.unmount(),cancelStackFilter("im_create"),cur.recieveCropResult=void 0}}}function Il(e,t,n){var r=Object(C.default)({selection:[]}),i=G(geByClass1("_im_create_list",e),Object(C.default)({offset:0,limit:100,elements:[],elCls:"_im_dialog"}),()=>({idFn:e=>intval(e.peerId),hoverableFn:e=>hasClass(e,"_im_dialog"),renderFn:_l.bind(null,r),more(e,n){var i;return t.get().shown?(t.get().creation_shown_all||!1!==pl(r)?i=Promise.resolve([]):(t.get().creation_shown_all=!0,i=Object(a.searchTopConv)(pl(r),t.get())),t.set(dl.bind(null,[i],!1)),fl(i,pl(r),t)):Promise.resolve(!1)},onClick(n,a){checkEvent(n)||(ml(t,e,0,l,i,r,a),cancelEvent(n))}}));t.get().creationQuery=!1,t.get().creationType="chat";var s=geByClass1(tl,e),o=Object(vt.debouncedPromise)(n=>function(e,t,n,a){var r=a.get(),i=pl(r);r.selection.map(e=>e.id),n.unhoverElements(nl),e.get().creationQuery=i,bl(t,e,n,i)}(t,e,i,n),300),l=Zo(s,r,()=>({selectionDeleted(n,a){gl(t,n,e),removeClass(geByClass1("_im_dialog"+a),"olist_item_wrap_on")},onChange:o})),c=cl.bind(null,t,e,n,"cross",l,r),d=vl.bind(null,t,e),u=Ol.bind(null,t,e),g=yl.bind(null,t,r,e,i,l,n),m=Cl.bind(null,t,r,e,i,l,n),h=Tl.bind(null,t,r,e),f=rl.bind(null,e),b=geByClass1("_im_create_cancel",e),v=geByClass1(el,e),O=geByClass1("_im_creation_settings",e),y=v.querySelector(".ui_search_reset"),E=Object(p.createModule)({handlers:(t,n)=>{t(b,"click",c),t(b,"mouseover",El.bind(null,b)),t(geByClass1("_im_create_avatar",e),"click",d),t(geByClass1("_im_create_remove_avatar",e),"click",u),t(geByClass1("_im_cancel_creation",e),"click",g),t(v,"change",h),t(v,"input",h),t(v,"paste",h),t(y,"click",h),t(geByClass1("_im_confirm_creation",e),"click",m),t(O,"click",f),t(O,"mouseenter",ll.bind(null,O)),t(e,"mouseover",Object(_.throttle)(i.unhoverElements.bind(i,nl),100))}});return Sl(e,n,i,r,l,E,c,m)}var Al,wl=n("BxOC");!function(e){e.Online="online"}(Al||(Al={}));var Ll=function(){function e(){var e=this;this.ADD_KEY_INTERVAL=25e3,this.RETRIES=5,this.retriesLeft=this.RETRIES,this.restart=function(){0!==e.retriesLeft&&(e.intervalId&&clearInterval(e.intervalId),e.retriesLeft--,Object(wl.post)("al_im.php",{act:"a_messenger_queue_subscribe"}).then((function(e){return e[0]})).then((function(t){e.retriesLeft=e.RETRIES,e.subscription=t,e.intervalId=window.setInterval((function(){e.subscription&&window.Notifier.addKey(e.subscription,e.listen)}),e.ADD_KEY_INTERVAL)})).catch((function(){setTimeout(e.restart,e.ADD_KEY_INTERVAL)})))},this.subscribe=function(t){e.listener||(e.listener=t,e.restart())},this.unsubscribe=function(){e.listener=void 0,e.subscription=void 0,e.retriesLeft=e.RETRIES,e.intervalId&&clearInterval(e.intervalId)},this.listen=function(t,n){if(function(e){return void 0!==e.err}(n))e.restart();else if(e.subscription&&(e.subscription.ts=n.ts),e.listener)for(var a=0,r=n.events;a<r.length;a++){var i=r[a];e.listener(i)}}}return e.getInstance=function(){return this.instance||(this.instance=new e),this.instance},e}();function kl(e,t){return t.state=e,Promise.resolve(t)}function Ml(e,t,n,a,i){switch(t){case y.ARROW_UP:Object(r.isEditableFocused)()||(a.scroll(i,"up"),cancelEvent(n));break;case y.ARROW_DOWN:Object(r.isEditableFocused)()||(a.scroll(i,"down"),cancelEvent(n));break;case y.PAGE_UP:n.ctrlKey||Object(r.isClassicInterface)(i)||(a.scroll(i,"up",!0),cancelEvent(n));break;case y.PAGE_DOWN:n.ctrlKey||Object(r.isClassicInterface)(i)||(a.scroll(i,"down",!0),cancelEvent(n));break;case y.HOME:Object(r.isEditableFocused)()||(a.scroll(i,"up",!1,!0),cancelEvent(n));break;case y.END_KEY:Object(r.isEditableFocused)()||(a.scroll(i,"down",!1,!0),cancelEvent(n));break;case y.PRINTABLE:a.focustTxt(e)}}function Nl(e,t,n,a,i,s){var o=Object(C.default)({state:t||"default"});return{signal(t,l){if(!(cur.storyLayer||cur.articleEditorLayer||window.isArticleLayerOpen()))switch(o.get().state){case"default":return Ml(o,t,l,a,e);case"fwd":case"search":return function(e,t,n,a,i,s){switch(t){case y.ARROW_DOWN:a.hoverNextDialog(s),cancelEvent(n);break;case y.ARROW_UP:a.hoverPrevDialog(s),cancelEvent(n);break;case y.ENTER:Object(r.isEditableFocused)()&&!gpeByClass("_im_dialogs_search_input",document.activeElement)||a.selectHoveredDialog(s);break;case y.PRINTABLE:i.focusInput()}}(0,t,l,n,i,e);case"create":return function(e,t,n,a,i){switch(t){case y.PAGE_UP:!n.ctrlKey&&Object(r.isClassicInterface)(i)&&(a.scroll("up"),cancelEvent(n));break;case y.PAGE_DOWN:!n.ctrlKey&&Object(r.isClassicInterface)(i)&&(a.scroll("down"),cancelEvent(n));break;case y.ARROW_DOWN:a.hoverNextElement(i);break;case y.ARROW_UP:a.hoverPrevElement(i);break;case y.ENTER:gpeByClass("_im_dialogs_creation_name",document.activeElement)?a.confirmCreate(i):gpeByClass("im-create--search",document.activeElement)&&a.selectElement(i);break;case y.PRINTABLE:a.focusSearch(i)}}(0,t,l,s,e);case"message":return function(e,t,n,a,r){switch(t){case y.HOME:case y.END_KEY:a.isEmpty(r)&&Ml(e,t,n,a,r);break;case y.PAGE_UP:case y.PAGE_DOWN:Ml(e,t,n,a,r)}}(o,t,l,a,e);default:throw new Error("Unknown state: "+o.get().state)}},transition:e=>o.set(kl.bind(null,e))}}var Pl=n("nJdr"),Dl=n("V1Nw"),Rl=n("ERyv");function xl(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var n=[],a=!0,r=!1,i=void 0;try{for(var s,o=e[Symbol.iterator]();!(a=(s=o.next()).done)&&(n.push(s.value),!t||n.length!==t);a=!0);}catch(e){r=!0,i=e}finally{try{a||null==o.return||o.return()}finally{if(r)throw i}}return n}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return Bl(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Bl(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Bl(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,a=new Array(t);n<t;n++)a[n]=e[n];return a}var Hl={},Fl=Date.now();function Ul(e,t){var n=Math.floor(t.status/100);t.status&&e.stat&&(t.status>=500&&t.status<600&&statlogsValueEvent("im_longpoll",1,n+"0x",t.getResponseHeader("x-frontend")),Hl[n]=Hl[n]?Hl[n]+1:1,Date.now()-Fl>=3e4&&(Object.keys(Hl).forEach(e=>{statlogsValueEvent("im_longpoll",Hl[e],e+"0x",t.getResponseHeader("x-frontend"))}),Hl={},Fl=Date.now()))}function Gl(e,t){return Promise.resolve(extend({},t,{timeout:e<64?2*e:e}))}function ql(e,t){return Promise.resolve(extend({},t,{imTs:e}))}function Vl(e){e.set(e=>Promise.resolve(extend({},e,{stopped:!0}))).then(()=>{e.get().cancelToken()})}function Wl(e,t){return t.cancelToken=e,Promise.resolve(t)}function Kl(e,t){return t.pauses||(t.pauses=[]),t.pauses.push(e),Promise.resolve(t)}function Yl(e){return e.pauses||(e.pauses=[]),Object(_.lplog)("Aborting all pauses","error"),e.pauses.forEach(e=>e()),e.pauses=[],Promise.resolve(e)}function $l(e,t,n,r){var i=r.failed?Object(vt.abortablePause)(4,e):{},s=i.abort,o=i.pause;switch(r.failed){case 1:return Object(_.lplog)("Old timestamp, init resync","error"),e.set(Kl.bind(null,s)),n([h.resyncEvent()]),e.set(a.loadLongPollTs).then(o).then(zl.bind(null,e,t,n));case 2:return Object(_.lplog)("Key is incorrect","error"),e.set(Kl.bind(null,s)),e.set(a.loadLongPollKey).then(o).then(zl.bind(null,e,t,n));case 3:throw Object(Rl.imWeirdLog)("im_longpoll_force_reload",r,!1),nav.reload({force:!0}),new Error("ts is very wrong");default:return e.set(ql.bind(null,r.ts)).then(()=>r)}}function zl(e,t,n){if(e.get().stopped)return Promise.resolve({updates:[]});if(t())return Promise.reject(new Error("pause"));var a=e.get(),r=`${a.imUrl}/${a.imPart}`,i=Object(wl.plaingetCancelable)(r,{act:"a_check",key:a.imKey,version:11,ts:a.imTs,wait:25,mode:a.mode}),s=i.request,o=i.cancel;return e.set(Wl.bind(null,o)).then(()=>s).then(t=>{var n=xl(t,2),r=n[0],i=n[1];return i&&Ul(a,i),e.set(Gl.bind(null,1)),JSON.parse(r)}).catch(e=>{var t=xl(e,2),n=(t[0],t[1]);return n&&Ul(a,n),Promise.reject(new Error(""))}).then($l.bind(null,e,t,n))}function Xl(e){var t=e.id,n=e.gid,a=e.key,r=e.ts,i=e.url,s=e.lhost,o=e.lpstat,l=new EventEmitter,c=window.vk.lpConfig&&window.vk.lpConfig.enabled&&window.longpollTesting_onImEvents,d=Aa((function(e,t){return c&&window.longpollTesting_onImEvents(t),l.trigger("data",t),Promise.resolve({})})),u=d.pause,g=d.resume,m=d.pushMessage,p=d.isPaused,f=d.reset,b=Object(C.default)({id:t,gid:n,mode:202,timeout:1,imKey:a,imTs:r,imPart:i,imUrl:s,pause:!1,stat:o});return function e(t,n,a){t.get().stopped||(Object(_.lplog)("New request"),zl(t,a,n).then(e=>e.map(h.constructEvent)).then(e=>(Object(_.lplog)("Request success","success"),e)).then(n).catch(e=>{if(!t.get().stopped)return Object(_.lplog)("Error, waiting: "+(e.message||"no message (probably browser reset)"),"error"),t.set(Gl.bind(null,a()?2:t.get().timeout)).then(()=>{var e=Object(vt.abortablePause)(t.get().timeout,t),n=e.abort,a=e.pause;return t.set(Kl.bind(null,n)).then(a)});Object(_.lplog)("Stopped longpoll")}).then(e.bind(null,t,n,a)))}(b,m.bind(null,"main"),p.bind(null,"main")),{onData:e=>l.on("data",e),offData:e=>l.off("data",e),abortWaiting:()=>b.set(Yl),stop:Vl.bind(null,b),pause:u.bind(null,"main"),resume:g.bind(null,"main"),reset:f.bind(null,"main"),push:e=>l.trigger("data",e),isEnabled:()=>!b.get().pause&&!b.get().stopped}}n("9AAn");var Ql=new Map,Zl=!1;function Jl(e){return e.queue||e.key}function ec(){Ql.forEach((e,t)=>{var n=e.onData,a=e.onUpdateKey,r=e.ts;(function(e){return!!window.curNotifier&&!curNotifier.addQueues[Jl(e)]})(t)&&Notifier.addKey(extend(t,{ts:r}),ac.bind(null,n,a,t))})}function tc(){Zl||(Zl=setInterval(ec,3e3))}function nc(e){!function(e){if(!window.curNotifier)return!1;delete curNotifier.addQueues[Jl(e)]}(e),Ql.delete(e),0===Ql.size&&(clearInterval(Zl),Zl=!1)}function ac(e,t,n,a,r){if(r.failed)return nc(n),void function(e,t,n,a){var r;switch(e){case 1:case 2:case 3:case 5:r=a(t,e);break;case 4:r=Object(vt.pause)(1).then(()=>t);break;default:throw new Error("Unkonwn error from queue: "+e)}Object(vt.pause)(3).then(()=>r).then(e=>{Ql.set(e,{onUpdateKey:a,onData:n,ts:e.ts}),ec(),tc()})}(r.err,n,e,t);Ql.set(n,{onData:e,onUpdateKey:t,ts:intval(r.ts)}),r.events.map(e=>e.split("<!>")).forEach(e)}function rc(e){var t=e.get().tabbedPeers.map(t=>e.get().tabs[t.peer]||e.get().mapped_index&&e.get().mapped_index[t.peer]).filter(e=>e).filter(e=>!e.deletedDialog).map(e=>({type:"peer",peer:e.peerId}));return t.length>0&&(t=[{type:"sep"}].concat(t)),t}function ic(e,t){if("sep"===t.type)return getTemplate("im_right_menu_sep",{});var n=`${Object(r.getBaseLink)(e)}?sel=${t.peer}&tab=${e.get().active_tab}`,a=Object(r.getBareTab)(t.peer,e),i=Object(r.isContactPeer)(t.peer)?Object(r.prepareContactName)(a.tab):a.tab,s="";switch(!0){case a.unread>0:s=a.unread;break;case Object(r.isTabMarkedUnread)(a):s=1}return i=getTemplate("im_right_menu_ct",{name:i,count:s}),getTemplate("im_right_menu_tpl",{href:n,label:i,peer:t.peer,attrs:`title="${stripHTML(a.tab)}"`,cls:a.unread>0?"im-right-menu--unread":""})}function sc(e,t,n,r){var i=gpeByClass("_im_peer_tab",r),s=intval(domData(i,"list-id")),o=e.get().tabbedPeers.filter(e=>e.peer!==s);return e.set(a.updateTabbedPeers.bind(null,o,!0)).then(()=>{if(oc(t,e),s===e.get().peer)e.get().longpoll.push([Object(h.resetPeer)()]);else if(0!==e.get().peer){var n=gpeByClass("_im_right_menu",r);uiRightMenu.hideSliding(n)}}),cancelEvent(n),!1}function oc(e,t){return e.pipeReplace(Promise.resolve(rc(t)))}function lc(e,t,n,a){return{updateMenu(t){!function(e,t){geByClass("_im_peer_tab",e).forEach(e=>{var n=Object(Mi.fromQueryString)(attr(e,"href").split("?")[1]);n.tab!==t.get().active_tab&&attr(e,"href",`${Object(r.getBaseLink)(t)}?sel=${n.sel}&tab=${t.get().active_tab}`)})}(e,t);var a=gpeByClass("_im_right_menu",e);oc(n,t).then(()=>{var e;(e=t.get().peer?ge("ui_rmenu_peer_"+t.get().peer):ge("ui_rmenu_"+t.get().active_tab))&&uiRightMenu.switchMenu(e,!0),uiRightMenu.hideProgress(a)})},updateName(e,t){var n=ge("ui_rmenu_peer_"+e);if(n){var a=geByClass1("_im_r_tx",n),r=t.get().tabs[e].tab;val(a,r)}},updateCounter(e,t){var n=ge("ui_rmenu_peer_"+t);if(n){var a=geByClass1("_im_r_ct",n),i=Object(r.getTab)(e,t),s="";switch(!0){case i.unread>0:s=i.unread;break;case Object(r.isTabMarkedUnread)(i):s=1}val(a,s),toggleClass(n,"im-right-menu--unread",i.unread>0||Object(r.isTabMarkedUnread)(i))}},unmount(){Object(p.destroyModule)(a),n.unmount()}}}function cc(e,t,n){1===n.which&&(e.get().peer&&e.get().longpoll.push([Object(h.resetPeer)()]),e.get().longpoll.push([Object(h.changeTab)(t)]),cancelEvent(n))}function dc(e,t,n){var a=G(e,Object(C.default)({limit:50,offset:0,noScroll:!0,elements:rc(t)}),()=>({idFn:e=>e.peer||"000",renderFn:ic.bind(null,t)})),r=sc.bind(null,t,a),i=Object(p.createModule)({handlers:(n,a)=>{a(e,"click","_im_r_cl",r),a(e,"click","_im_peer_tab",(e,n)=>{if(!checkEvent(e)){var a=intval(domData(n,"list-id"));Object(_.unpackStore)(t).longpoll.push([Object(h.changePeer)(a,!1,!0,!0)]),cancelEvent(e)}}),y.FOLDERS.forEach(a=>{n(geByClass1("_ui_item_"+a,e.parentNode),"mousedown",cc.bind(null,t,a))}),n(geByClass1("_im_contact_list_menu_item",e.parentNode),"click",()=>mo(t))}});return lc(e,0,a,i)}function uc(e){var t=e.get().tabs,n=e.get().peer,i=Object.keys(t).filter(t=>Object(r.isFullyLoadedTab)(e,t)&&intval(t)!==n).map(e=>t[e]);i.filter(e=>Date.now()-e.last_visited>54e6).forEach(t=>e.set(a.cleanTab.bind(null,t.peerId))),i.filter(t=>Object(r.isFullyLoadedTab)(e,t.peerId)&&"string"!=typeof t.history&&Date.now()-t.last_touched>72e5).forEach(t=>e.set(a.stringifyTab.bind(null,t.peerId)))}function gc(e){var t=setInterval(uc.bind(null,e),5e3);return{unmount(){clearInterval(t)}}}function mc(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var n=[],a=!0,r=!1,i=void 0;try{for(var s,o=e[Symbol.iterator]();!(a=(s=o.next()).done)&&(n.push(s.value),!t||n.length!==t);a=!0);}catch(e){r=!0,i=e}finally{try{a||null==o.return||o.return()}finally{if(r)throw i}}return n}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return _c(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return _c(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function _c(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,a=new Array(t);n<t;n++)a[n]=e[n];return a}function pc(e,t,n,i){if(!e.loading&&!e.all&&n.scrollTop+window.innerHeight-n.scrollHeight>-300){var s=geByClass1("_im_peer_history",t.bodyNode);e.loading=!0,Object(r.wrapLoading)(s)(Object(a.loadImportant)(e.offset).then(t=>{var n=mc(t,4),o=(n[0],n[1]),l=(n[2],n[3]);e.all=l.all,e.offset=l.offset,e.all?addClass(s,"im-important_all"):e.loading=!1,i.set(a.mergeTabs.bind(null,Object(r.tabFromIds)(l.msgs,l.hash)));var c=ce("div");c.innerHTML=o,s.appendChild(c),Object(r.ensureDomHasActions)(s)}),"bottom")}}function hc(e,t,n){for(var r=arguments.length,i=new Array(r>3?r-3:0),s=3;s<r;s++)i[s-3]=arguments[s];i.filter(e=>inArray(e.type,[h.SET_FLAGS,h.RESET_FLAGS,h.CHANGE_PEER])).forEach(r=>{if(r.type!==h.CHANGE_PEER){if(r.flags===h.FLAG_IMPORTANT){var i=r.type===h.SET_FLAGS;e.set(a.updateFavMessage.bind(null,[r.messageId],0,i)).then(n=>{t.markImportant(r.messageId,i,e)})}}else n.hide()})}function fc(e,t,n,a){var i=ge("box_layer_wrap"),s=t.get().longpoll,o=Object(C.default)({peer:0,longpoll:s,oCache:{},tabs:Object(r.tabFromIds)(a.msgs,a.hash)}),l=ai(e.bodyNode,o,()=>({})),c=O(e.bodyNode,t);Object(r.ensureDomHasActions)(e.bodyNode);var d=hc.bind(null,t,l,e);s.onData(d);var u=pc.bind(null,{all:!1,loading:a.all,offset:a.offset},e,i,o),g=Object(p.createModule)({handlers:(e,t)=>{e(i,"scroll",u)}});return{unmount(){Object(p.destroyModule)(g),c.unmount(),l.unmount(),s.offData(d)}}}function bc(e){return e.which||e.keyCode}function vc(e,t,n){!n||inArray(bc(n),y.UNPRINTABLE_KEYS)||Object(a.isSearchingInplace)(e.get().peer,e.get())||Object(r.isEditableFocused)()||n.ctrlKey||browser.mac&&n.metaKey||n.key&&1!==n.key.length||t.signal("printable",n)}function Oc(e,t,n){bc(n)===y.ENTER&&e.signal(bc(n),n)}function yc(e,t,n,a){var i=bc(a);if(!layers.visible){if(i>=49&&i<=57&&(a.ctrlKey||a.metaKey&&browser.mac)&&Object(r.isClassicInterface)(t))return function(e,t){var n=e.get().tabbedPeers[t];n&&e.get().longpoll.push([Object(h.changePeer)(n.peer,!1,!0,!0)])}(t,i-49),cancelEvent(a);inArray(i,y.UP_DOWN_CONTROLS)&&e.signal(i,a)}}function Cc(e,t){var n=browser.mozilla?"keydown":"keypress",a=Object(C.default)({signalTimer:!1}),r=vc.bind(null,e,t),i=yc.bind(null,t,e,a),s=Oc.bind(null,t,a),o=Object(p.createModule)({handlers:(e,t)=>{e(document,"keydown",i),e(document,"keyup",s),e(document,n,r)}});return{unmount(){Object(p.destroyModule)(o)}}}function Ec(e,t){return-1===(e?e.indexOf(t):0)&&(e.push(t),!0)}function jc(e,t){var n=e?e.indexOf(t):-1;return-1!==n&&(e.splice(n,1),!0)}function Tc(e,t,n,s,o,l){var c=Object(i.getTab)(e,t);switch(n){case h.MAIL_CHAT_UPDATE_TYPE_ADMIN_GRANTED:case h.MAIL_CHAT_UPDATE_TYPE_ADMIN_KICKED:return n===h.MAIL_CHAT_UPDATE_TYPE_ADMIN_GRANTED?Ec(c.adminIds,s):jc(c.adminIds,s),e.set(e=>Object(a.setCallAvailability)(t,e)).then(()=>{Sc(e,t,o),Ic(e,t,o,l)}),!0;case h.MAIL_CHAT_UPDATE_TYPE_FLAGS_CHANGED:return c.data.flags=s,e.set(e=>Object(a.setCallAvailability)(t,e)).then(()=>{Sc(e,t,o),Ic(e,t,o,l)}),!0;case h.MAIL_CHAT_UPDATE_TYPE_PINNED:delete c.pinHideId,cur.imDb.update(yi.PIN_HIDDEN_ID_OP,[c.peerId,void 0]);var d=c&&c.pinned&&Object(r.parserMessage)(c.pinned).messageId;return o.removeUnpinnedMessageEditable(e,d),!1;case h.MAIL_CHAT_UPDATE_TYPE_USER_JOINED:var u=s===vk.id;return function(e,t,n){if(Object(r.isTabLoaded)(n.get(),e)){var s=Object(i.getTab)(n,e);Ec(s.memberIds,t)&&s.membersCount++,-1===s.data.active.indexOf(t)&&s.data.active.push(t),t===vk.id&&(s.data.kicked=0,s.data.closed=0)}return n.set(n=>Object(a.loadChatMember)({[e]:[t]},n))}(t,s,e).then(()=>{if(u&&e.get().peer===t)return e.set(e=>Object(a.getPinnedMessage)(t,e))}).then(()=>Ic(e,t,o,l)).then(()=>{if(u&&e.get().peer===t)return Promise.all([e.set(e=>Object(a.getPeerActiveCallData)(t,e)),e.set(e=>Object(a.loadKeyboard)(t,e))])}).then(()=>(e.get().peer===t&&c.callInProgress&&(o.updateBanner(e),o.updateHeader(e)),o.fixKeyboard())),!0;case h.MAIL_CHAT_UPDATE_TYPE_USER_LEFT:case h.MAIL_CHAT_UPDATE_TYPE_USER_KICKED:return function(e,t,n,s,o){if(Object(r.isTabLoaded)(s.get(),e)){var l=Object(i.getTab)(s,e);jc(l.memberIds,t)&&l.membersCount--,l.data.active=l.data.active.filter(e=>e!==t),t===vk.id&&(n?l.data.kicked=1:l.data.closed=1,s.set(t=>Object(a.removePeerActiveCallData)(e,t)))}return t===vk.id&&s.get().peer===e?(o.cancelEditing(),s.set(t=>Object(a.unpinMessageOptimistic)(e,t))):Promise.resolve()}(t,s,n===h.MAIL_CHAT_UPDATE_TYPE_USER_KICKED,e,o).then(()=>Ic(e,t,o,l)),e.get().id!==s&&(Object(i.getKeyboard)(e,t)||{}).author_id!==s||e.set(e=>Object(a.deleteKeyboard)(t,e)).then(()=>o.fixKeyboard()),!0;case h.MAIL_CHAT_UPDATE_TYPE_BANNER_CHANGED:return e.set(e=>Object(a.loadBanner)(t,e)).then(()=>o.updateBanner(e)),!0;case h.MAIL_CHAT_UPDATE_TYPE_KEYBOARD_CHANGED:case h.MAIL_CHAT_UPDATE_TYPE_MESSAGE_REQUEST_CHANGED:return!0;case h.MAIL_CHAT_UPDATE_TYPE_CALL_IN_PROGRESS_CHANGED:var g=s?e=>Object(a.getPeerActiveCallData)(t,e):e=>Object(a.removePeerActiveCallData)(t,e);return e.set(g).then(()=>{e.get().peer===t&&(o.updateBanner(e),o.updateHeader(e)),l.updateDialog(t,e)}),!0;default:return!1}}function Sc(e,t,n){e.get().peer===t&&(Object(a.setActions)(e.get()),n.updateActions(e))}function Ic(e,t,n,r){e.get().peer===t&&(Object(a.setActions)(e.get()),n.updateChat(e,t),r.updateDialog(t,e))}var Ac=n("gF8j"),wc=n("ambf");function Lc(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var n=[],a=!0,r=!1,i=void 0;try{for(var s,o=e[Symbol.iterator]();!(a=(s=o.next()).done)&&(n.push(s.value),!t||n.length!==t);a=!0);}catch(e){r=!0,i=e}finally{try{a||null==o.return||o.return()}finally{if(r)throw i}}return n}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return kc(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return kc(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function kc(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,a=new Array(t);n<t;n++)a[n]=e[n];return a}function Mc(e,t,n,s,o){var l=o.reduce((e,t)=>(e[t.peerId]||(e[t.peerId]=[]),e[t.peerId].push(t.messageId),e),{});Object.keys(l).forEach(o=>{var c=l[o],d=Object(i.getTab)(e,o),u=d&&!d.offset,g=d&&d.inplaceSearch&&!!d.searchOffset;e.set(a.removeMessages.bind(null,c,o)).then(()=>e.set(a.removeMessagesMarkDeleted.bind(null,c,o))).then(()=>{if(e.get().peer===+o&&Object(r.isFullyLoadedTab)(e.get(),o)){var n=Object(i.getTab)(e,o);t.removeMessages(c,+o,e);var s=n.inplaceSearch;if(!n.offset&&!u&&(Object(a.setActions)(e.get()),t.updateActions(e),s||t.showEmptyScreen()),s&&g&&!n.searchOffset&&(t.showSearchResults(),browser.safari)){var l=geByClass1("_im_peer_history_w");l.style.display="none",setTimeout(()=>l.style.display="",0)}}}).then(()=>{var r=Object(i.getTab)(e,o),l=r&&c.some(e=>e>=r.lastmsg),d=r&&c.filter(e=>e>r.in_up_to);l?Object(a.loadActualLastMessage)(e,+o).then(()=>{n.promoteDialog(e,o),s&&s.updateCounter(e,o),t.updateGoToEnd(e,!0),t.updateGoToMention(e,!0)}):d&&Object(a.removeUnreadDeletedMsgsFromTab)(o,d,e.get()).then(()=>n.updateDialog(o,e))})})}function Nc(e,t){"spam"===t?Object(r.showSpamLayer)(e,Bo,{}):"fav"===t&&Object(r.showFavvedBox)(e,{},fc,{})}function Pc(e,t,n,i,s){e.forEach(e=>{switch(e.kludges.source_act){case r.CHAT_PHOTO_REMOVE:case r.CHAT_PHOTO_UPDATE:!function(e,t,n,r){t.set(a.updateChatPhoto.bind(null,e)).then(()=>{var a=e.kludges.source_act;n.updateDialog(e.peerId,t),r.updateChatPhoto(e,a,t)})}(e,t,n,i)}})}function Dc(e,t){var n=e.get().longpoll.push.bind(null,[h.resetPeer()]),a=()=>{var r=e.get().selectedMessages;r&&r.length?(e.setState({selectedMessages:[]}).then(()=>{t.changedMessageSelection(e),t.cleanSelection(r)}),setTimeout(()=>cancelStackPush("im_peer",a),0)):n()};cancelStackPush("im_peer",a)}function Rc(e){var t=e.attaches.filter(e=>"sticker"!==e.type&&"call"!==e.type);return Object(s.isServiceMsg)(e)||0===t.length}function xc(e,t,n){addClass(n,"im-page_history-show"),t.loadingPeer(e)}function Bc(e,t){var n=function(e,t){var n=document.querySelector("._im_aside_notice"),a=Object(r.isCommunityInterface)(e)?236:120;return a+=10,a+=n?n.offsetHeight:0,Math.floor((t.offsetHeight-a)/32)}(e,t);if(e.get().tabbedPeers.length>n){var i=e.get().tabbedPeers.filter(t=>{var n=t.peer;return intval(n)!==e.get().peer}).map(t=>{var n=t.peer;return e.get().tabs[n]}).sort((e,t)=>t.last_touched-e.last_touched),s=[];0!==e.get().peer&&s.push(e.get().tabs[e.get().peer]);var o=s.concat(i).slice(n).map(e=>e.peerId),l=e.get().tabbedPeers.filter(e=>!inArray(e.peer,o));return e.set(a.updateTabbedPeers.bind(null,l,!0))}return Promise.resolve(e)}function Hc(){for(var e=curBox();e;)e.hide(),e=curBox()}function Fc(e,t,n,s,o,l,c,d,u){e.get().audio_msg.isRecording&&e.set(a.cancelRecording).then(()=>{s.cancelRecording()}),AudioMessagePlayer.detachPlayer(),Object(i.isAnyMessageBeingEdited)(e)&&s.cancelEditing(),Object(i.isSearching)(e)&&t.cancelSearch&&(o.clearSearch(e),n.restoreDialogs(e),u().toggleSettingsButton(e,!1)),Uc(e,d,u),xc(e,s,l);var g=e.get().peer;Object(a.updateMentions)(e.get()),Object(a.videoAutoPlayHandler)(),Object(r.isFullyLoadedTab)(e,t.peerId)&&(t.msgid&&!Object(i.getMessage)(e,t.peerId,t.msgid)||!t.msgid&&!Object(i.getMessage)(e,t.peerId,Object(i.getTab)(e,t.peerId).lastmsg)||Object(i.getTab)(e,t.peerId).skipped)&&e.mutate(e=>Object(i.makeTabNotFullyLoaded)(e,t.peerId));var m=e.set(a.changePeer.bind(null,t.peerId,t.msgid,t.entryPoint)).then(e=>{var n=e.get(),r=a.loadPeer.bind(null,t.peerId,!1,t.msgid,!1,n);return n.tabs[t.peerId]?Promise.resolve(n):e.set(r)}).then(()=>{n.selectPeer(t.msgid,e),function(e,t){Object(r.isPendingForward)(e)&&(cancelStackFilter("forward"),e.set(a.forwardMessages.bind(null,e.get().pendingForward,Object(i.getTabDraft)(Object(i.getTab)(e,t)),!1)))}(e,e.get().peer),window.tooltips&&tooltips.hideAll(),Hc(),s.preparePeer(e),Dc(e,s),Object(r.isClassicInterface)(e)&&(n.deactivate(),Bc(e,l).then(()=>c.updateMenu(e)),Object(r.updateMessageRequestsCounterInDOM)(e))});return(m=t.msgid?m.then(()=>e.set(a.selectPeerOnMessage.bind(null,t.peerId===g,g))):m.then(()=>e.set(a.selectPeer.bind(null,!0)))).then(()=>e.set(a.prepareCasperMessagesFromMessages.bind(null,t.peerId))).then(()=>{if(e.get().peer===t.peerId){if(t.forward){var n=e.get().tabs[e.get().peer];!n.scrollBottom&&n.unread?e.set(a.readLastMessages.bind(null,e.get().peer)).then(()=>e.set(a.setActions)).then(()=>s.updateActions(e)):!n.unread&&Object(i.isTabMarkedUnread)(n)&&e.set(e=>Object(a.markDialogRead)(t.peerId,e))}Object(r.isClassicInterface)(e)&&c.updateMenu(e),s.changePeer(e,!1),s.updateTyping(t.peerId,e),s.removeExpiredFailedMessages(t.peerId),Object(a.updateMentions)(e.get())}}).catch(e=>Object(Rl.imWeirdCatch)("applyNewPeer",e))}function Uc(e,t,n){t&&e.get().shown&&(t.hide(e),n().createCanceled(e))}function Gc(e,t,n){Object(i.isSearching)(e)&&(t.clearSearch(e),n.restoreDialogs(e))}function qc(e,t,n,i,s,o,l){Object(r.isClassicInterface)(e)&&(s.saveScroll(e),o.saveScroll(e)),i.showCancelControl(),addClass(l,"im-page_creating"),e.setState({isCreating:!0}),n&&n.show(e,t),Object(r.isClassicInterface)(e)&&(setStyle(l,{height:Xc(l,e).page}),setTimeout((function(){addClass(l,"im-page_cropped")}),200)),Object(a.toggleConversation)(!0)}function Vc(e,t,n,a){Object(r.isTabLoaded)(e.get(),a)&&(t.updateTyping(a,e),n.updateTyping(a,e))}function Wc(e,t,n,i,s){i.activityType||(i.activityType=s);var o=e=>Vc(e,t,n,i.peerId);Object(r.isSelfMessage)(i.peerId,e.get().gid)||(e.set(a.setActivity.bind(null,i,s)).then(o),e.set(a.waitActivity.bind(null,i,s)).then(o))}function Kc(e,t){t?e.classList.add("im-page_reconnecting"):e.classList.remove("im-page_reconnecting")}function Yc(e,t,n){var r=null;if(n.kludges.keyboard&&!n.kludges.keyboard.inline){var o=Object.assign(n.kludges.keyboard,{author_id:n.userId});r=e.set(a.setKeyboard.bind(null,n.peerId,o))}else{var l=Object(i.getKeyboard)(e,n.peerId);l&&l.one_time&&l.author_id!==Object(s.getAuthorId)(e,n)&&(r=e.set(a.deleteKeyboard.bind(null,n.peerId)))}n.peerId===Object(i.getPeer)(e)&&r&&r.then(t.fixKeyboard)}function $c(e,t,n,o,l,c,d,u,g,m,_,f,b,v,O,C,E,j,T,S,I){var A=!1;return{changePeer(e,n){t.selectPeer(e,n)},cancelSearch(e){Gc(e,o,t)},loadingPeer(e){xc(e,n,l)},restoreDialogs(e,n,a){t.restoreDialogs(e,n,a)},toggleSettingsButton(e,t){_.toggleButton(e,t)},focusSearch(e){o.focusInput()},appendSearch(e,n,a,r){t.appendSearch(e,n,a,r)},appendDialogs(e,n){t.appendDialogs(e,n)},showCreation(e,a){qc(e,a,m,o,t,n,l)},updateState(e,a){t.updateDialog(e,a),a.get().peer===e&&n.updateChat(a,e)},appendFastDialogs(e,n){t.appendFastDialogs(e,n,!0)},createCanceled(e){o.hideCancelControl(),Object(r.isClassicInterface)(e)?(setStyle(l,{height:"auto"}),removeClass(l,"im-page_cropped"),setTimeout(()=>o.focusInput(),0),0===e.get().peer?t.restoreScroll(e):n.restoreScroll(e,e.get().peer)):setTimeout(()=>{0===e.get().peer?o.focusInput():n.focustTxt(e)},0),removeClass(l,"im-page_creating"),e.setState({isCreating:!1})},updateMenu(e){C&&C.updateMenu(e)},goToHistoryEnd(){n.goToEnd()},updateDialog(e,n){t.updateDialog(e,n)},focusTxt(e){n.focustTxt(e)},resync(e){Object(i.isSearching)(e)&&o.clearSearch(e),t.restoreDialogs(e,!0,!0).then(()=>t.focusOnSelected(e)),m&&m.hide(e),Object(r.isCommunityInterface)(e)&&e.get().tabbedPeers.forEach(t=>{var n=t.peer;C.updateCounter(e,n)}),Object(r.isClassicInterface)(e)&&(e.get().tabbedPeers.forEach(t=>{var n=t.peer;C.updateCounter(e,n),C.updateName(n,e)}),Object(r.updateMessageRequestsCounterInDOM)(e)),n.cleanSelection(e.get().selectedMessages||[]),n.cancelSearch(e,!0),Object(r.isReservedPeer)(e.get().peer)||n.changePeer(e,!1);var a=e.get().gid?"l_mgid"+e.get().gid:"msg";handlePageCount(a,e.get().unread_cnt)},toggleSettingsLoader(e,t){_.toggleLoader(e,t)},onUserActions(e,t){if(!Object(a.isSearchingInplace)(e.get().peer,e.get())){var s=e.get(),o=s.peer;if(Object(r.isFullyLoadedTab)(s,o))if(!c.is_idle)if(Object(i.countUnread)(e.get().peer,e.get())>0)!s.tabs[o].skipped&&n.isNewMessagesVisible(e)&&(n.hideGoToEnd(!0),n.hideGoToMention(!0),e.set(a.readLastMessages.bind(null,o)).then(()=>e.set(a.setActions)).then(()=>n.updateActions(e)))}},removeSelection(e){t.removeSelection(e),o.focusInput()},route(e,i,s,c){if(void 0!==e[0])return!0;e.box&&(e={box:e.box});var d=!1;return!!(e.mr||e.invite_chat_id&&s.invite_hash)||(c&&c.params&&"left_nav"===c.params._ref&&void 0===e.sel&&t.scrollUp(!0,!0),Object.keys(e).sort().forEach(e=>{switch(e){case"sel":s.q||(d=!0);var u=s.sel?Object(r.unUrlPeer)(s.sel):0,_=c.back;0===u?f.get().longpoll.push([h.resetPeer(!1,_)]):u!==f.get().peer&&f.get().longpoll.push([h.changePeer(u,s.msgid||!1)]);break;case"invite_chat_id":case"invite_hash":!function(e){e.set(a.leaveInvitation).then(()=>{e.get().longpoll.push([h.resetPeer(!1,!1)])})}(f);break;case"tab":Uc(f,m,g),d=!0;var p=s.tab||y.FOLDER_ALL;f.get().longpoll.push([h.changeTab(p)]);break;case"act":s.act&&"create"===s.act?qc(f,[],m,o,t,n,l):function(e,t,n,a){n&&n.hide(e,t)}(f,[],m);break;case"st":s.st&&s.sel?(curBox()&&curBox().hide(),f.mutate(a.setInplaceSearch.bind(null,unescape(s.st),s.sel)),n.startSearch(f)):(f.mutate(a.cancelSearch.bind(null,i.sel)),n.cancelSearch(f,!0));break;case"q":s.q?(curBox()&&curBox().hide(),o.setSearch(f,s.q,!0)):o.clearSearch(f);break;case"box":Nc(f,s.box)}}),s.msgid&&(f.get().msgid=s.msgid,n.focusOnMessage()),Object(r.isClassicInterface)(f)&&void 0===e.sel&&C.updateMenu(f),d&&Gc(f,o,t),!1)},updateDialogFilters(e){Object(i.isSearching)(e)||t.restoreDialogs(e),_.updateFilter(e)},removePeer(e,n){t.removeDialog(e,n),t.saveScroll(e),e.get().peer===n&&e.get().longpoll.push([h.resetPeer()]),Object(r.isClassicInterface)(e)&&C.updateMenu(e)},newMessage(e){Object(r.isClassicInterface)(e)||t.scrollUp(!0)},onQueueEvent(e,i){switch(i.entity_type){case Al.Online:e.set(e=>Object(a.updateOnline)(i.data.user_id,!!i.data.online&&i.data.platform,i.data.last_seen,e)).then(e=>{Object(r.isTabLoaded)(e.get(),i.data.user_id)&&(t.updateOnline(i.data.user_id,e),n.updateOnline(i.data.user_id,e))})}},onEvents(e,p){var f=function(e){for(var t=!1,n=e.length-1;n>=0;n--)e[n].type!==h.UNREAD_COUNT||t?e[n].type===h.UNREAD_COUNT&&e.splice(n,1):t=!0;return e}(p.filter(e=>e.type!==h.ADD_MESSAGE||!(e.flags&h.FLAG_STEALTH))),v=p.filter(s.isServiceMsg),O=p.filter(e=>e.type===h.ADD_MESSAGE);Pc(v,e,t,n);var E=Object(a.checkNewPeople)(v,O,e),j=Promise.resolve();E.shouldLoad&&(j=e.set(a.loadNewPeople.bind(null,E,d))),j.then(()=>{f.forEach(d=>{switch(d.type){case h.ADD_MESSAGE:var p=Object(i.getTab)(e,d.peerId),f=!p||!p.msgs||0===p.msgs.length,v=Object(r.getMessageStoreStatus)(d,e.get()),O=Object(i.isCommunityBlocked)(e,d.peerId),E=p&&!p.offset;switch(Yc(e,n,d),Object(s.isCasperMessage)(d)&&wc.casperMessagesStore.add(d),v){case r.MSG_NEW:e.set(a.addMessage.bind(null,d)),Bc(e,l),function(e,t){var n=e.get().tabs[t.peerId],r=e.get().active_tab;return r===y.FOLDER_ALL||Object(a.filterFromTab)(r)(n)}(e,d)&&(Object(i.tabIsMessageRequest)(p)||(d.flags&h.FLAG_OUTBOUND||e.set(a.updateFavAndTitle.bind(null,d.peerId,!0)),function(e,t){var n=t.flags&h.FLAG_OUTBOUND,a=inArray(t.peerId,e.get().mutedPeers),i=t.flags&h.FLAG_DELETED,s=e.get().gid;if(!n&&!a&&!i){var o,l,c=function(e,t){return t<2e9&&e&&!e.match(/^\s*(Re(\(\d*\))?\:)?\s*\.\.\.\s*$/)}(t.subject,t.peerId)||"",d=(c?c+" ":"")+t.text||"",u=t.userId,g=t.peerId,m=e.get().tabs[g];if(t.kludges&&t.kludges.source_act&&(d=stripHTML(Object(r.renderServiceMsg)(e,t,m,!1))),(!e.get().notify_msg&&!Object(r.isChatPeer)(g)||s&&!e.get().mute)&&window.Notifier&&Notifier.playSound({author_id:g}),!Object(r.isChatPeer)(g))return;d=trim(replaceEntities(stripHTML(d.replace(/<br>/g,"\n").replace(/<\*>.*$/,"")))),d=Object(Ci.replaceMentions)(d,(e,t,n,a,r)=>r),Object(r.isChatPeer)(g)?(o=Object(V.oCacheGet)(e,u).name,m.tab&&(o+=" » "+m.tab),l=Object(V.oCacheGet)(e,u).photo):(o=m.tab,l=m.photo);var _=t.attaches[0];if(_&&"mail"===_.type)d+="\n["+getLang("mail_added_msgs")+"]";else if(_){var p="doc"===_.type&&"graffiti"===_.kind?"graffiti":_.type;d+="\n["+getLang("mail_added_"+p)+"]"}o=trim(replaceEntities(stripHTML((o||"").replace("&nbsp;"," ")))),window.Notifier&&Notifier.proxyIm({id:t.messageId,text:d,author_id:g,title:o,author_photo:l})}}(e,d)),t.updateTyping(d.peerId,e),Object(i.isSearching)(e)?t.updateDialog(d.peerId,e):t.promoteDialog(e,d.peerId));var j=Object(i.isCommunityBlocked)(e,d.peerId),T=p&&!p.offset;(O&&!j||E&&!T)&&n.updateActions(e),Object(r.isClassicInterface)(e)?(C.updateCounter(e,d.peerId),C.updateMenu(e)):_.updateFilter(e),e.set(a.updateActivity.bind(null,d)).then(Vc.bind(null,e,n,t,d.peerId)),n.addMessage(e,d),Rc(d)||!Object(r.isFullyLoadedTab)(e,d.peerId)||d.local||e.set(a.loadMedia.bind(null,d)).then(e=>{n.replaceAttachmentPlaceholders(e,d),Object(a.videoAutoPlayHandler)()}),Object(qe.statlogsSendingTimeStart)(e,d,"send","opt_to_lp");break;case r.MSG_LOCAL_DUPLICATE:Rc(d)||e.set(a.loadMedia.bind(null,d)).then(e=>{n.replaceAttachmentPlaceholders(e,d)}),e.set(a.replaceMessage.bind(null,d)),n.replaceMessageAttrs(d,e),t.updateDialog(d.peerId,e),d.randomId&&Object(qe.statlogsSendingTimeEnd)(e,d,"send","opt_to_lp");break;case r.MSG_DUPLICATE:Object(i.isSearching)(e)||t.promoteDialog(e,d.peerId)}Object(i.tabIsMessageRequest)(p)&&Object(r.checkMessageRequestsTab)(e,t.update),p&&f&&p.peerId===Object(i.getPeer)(e)&&S();break;case h.EDIT_MESSAGE:case h.REPLACE_MESSAGE:e.set(a.editMessage.bind(null,d)).then(e=>{if(Yc(e,n,d),d.kludges.is_expired)return Object(r.removeExpiredMessageIfNeed)(d,n.handleMessageExpiration),void t.updateDialog(d.peerId,e);t.updateDialog(d.peerId,e),n.updateTyping(d.peerId,e),n.editMessage(e,d),Rc(d)||!Object(r.isFullyLoadedTab)(e,d.peerId)||d.local||e.set(a.loadMedia.bind(null,d)).then(e=>n.replaceAttachmentPlaceholders(e,d))});break;case h.INVALIDATE_MESSAGE:Object(a.reloadMessage)(d.messageId,e.get()).then(t=>{var n=h.addMessageEvent([4].concat(t));return e.set(e=>Object(a.editMessage)(n,e)).then(()=>n)}).then(i=>{n.editMessage(e,i),t.updateDialog(i.peerId,e),!Rc(i)&&Object(r.isFullyLoadedTab)(e,i.peerId)&&e.set(e=>Object(a.loadMedia)(i,e)).then(e=>n.replaceAttachmentPlaceholders(e,i))});break;case h.READ_INBOUND:e.set(a.markInboundMessagesAsRead.bind(null,d)).then(e=>{t.updateCounter(e,d.peerId),n.updateGoToEnd(e,!0),n.updateGoToMention(e,!0),n.updateObserver(),Object(r.isClassicInterface)(e)&&C.updateCounter(e,d.peerId),Object(i.isSearching)(e)||t.restoreDialogs(e),_.updateFilter(e)});break;case h.READ_OUTBOUND:e.set(a.markOutboundMessagesAsRead.bind(null,d)).then(e=>{t.updateCounter(e,d.peerId),n.markMessagesAsRead(e,d)});break;case h.UNREAD_COUNT:e.set(a.updateUnreadCount.bind(null,d.count)).then(()=>{var t=e.get().gid?"l_mgid"+e.get().gid:"msg";handlePageCount(t,d.count),_.updateFilter(e),Object(r.isClassicInterface)(e)&&e.get().tabbedPeers.forEach(t=>{var n=t.peer;C.updateCounter(e,n)})});break;case h.SET_FLAGS:case h.REPLACE_FLAGS:case h.RESET_FLAGS:if(!(d.flags&h.FLAG_DELETED||d.flags&h.FLAG_SPAM)||d.type!==h.SET_FLAGS||Object(r.isAlreadyDeleted)(e,d.peerId,d.messageId)||e.get().blockedFlagUpdates[d.peerId]||u(d),d.flags===h.FLAG_IMPORTANT){var I=d.type===h.SET_FLAGS;e.set(a.updateImportant.bind(null,I?1:-1,d.messageId)),e.set(a.updateFavMessage.bind(null,[d.messageId],d.peerId,I)).then(()=>{n.markImportant(d.messageId,I,e)})}break;case h.RECORDING_AUDIO:Wc(e,n,t,d,a.ACTIVITY_TYPE_RECORDING_AUDIO);break;case h.TYPING:Wc(e,n,t,d,a.ACTIVITY_TYPE_TYPING);break;case h.NOTIFY_SETTINGS_CHANGED:!function(e,t,n,r){e.set(a.setMutedPeer.bind(null,n,r)).then(t().updateState.bind(null,n))}(e,g,d.peerId,!d.sound);break;case h.RESYNC:e.get().longpoll.pause(),e.set(a.resync).then(g().resync).then(()=>e.get().longpoll.resume());break;case h.TRANSITION:b.transition(d.state);break;case h.RESET_PEER:if(d.removeActivePeer){var w=e.get().tabbedPeers.filter(t=>{var n=t.peer,a=t.type;return n!==e.get().peer&&"perm"===a});e.setState({tabbedPeers:w})}!function(e,t,n,s){e.set(a.cancelRecording).then(()=>{n.cancelRecording()}),AudioMessagePlayer.detachPlayer(),t.removeSelection(e),removeClass(s,"im-page_history-show"),t.updateStarPosition(),n.stopLoading(),n.destroyPeerProfile(),Object(i.isAnyMessageBeingEdited)(e)&&n.cancelEditing();var o=e.get().peer;e.set(a.changePeer.bind(null,0,!1,!1)).then(()=>{window.tooltips&&window.tooltips.hideAll(),Hc(),Object(r.isClassicInterface)(e)&&t.activate(),n.changePeer(e),Object(r.isClassicInterface)(e)&&t.restoreScroll(e),setTimeout(()=>{e.get().longpoll.push([h.transitionEvent("search")])},13),Object(r.isLocksAvailable)(e)&&Object(r.isPeerBlockedByMe)(o,e)&&e.set(a.releaseBlock.bind(null,o))})}(e,t,n,l),e.get().peerProfileTagsChanged?e.setState({peerProfileTagsChanged:!1}).then(()=>t.renderPeerTags(e)):t.renderPeerTags(e,e.get().prevPeer),d.cancelSearch&&Gc(e,o,t),Object(r.isClassicInterface)(e)&&C.updateMenu(e),o.focusInput();break;case h.CHANGE_TAB:Object(i.isSearching)(e)&&o.clearSearch(e),Object(r.changeTab)(d.tab,e,g,a.changeDialogsTab).then(e=>{_.updateFilter(e)});break;case h.RESET_DIRECTORIES:case h.SET_DIRECTORIES:case h.REPLACE_DIRECTORIES:var L=d.type,k=d.peerId,M=d.mask;if(M===h.FOLDER_HAS_BANNER)break;var N=M===h.FOLDER_AD_TAG;e.set(a.updateFolderState.bind(null,k,M,L,d.local,N)).then(e=>{Object(i.isSearching)(e)||L===h.RESET_DIRECTORIES&&M===y.FOLDER_MASKS[y.FOLDER_IMPORTANT]||L===h.RESET_DIRECTORIES&&M===y.FOLDER_MASKS[y.FOLDER_MESSAGE_REQUEST]||L===h.SET_DIRECTORIES&&M===y.FOLDER_MASKS[y.FOLDER_MESSAGE_REQUEST_REJECTED]||L===h.REPLACE_DIRECTORIES||t.restoreDialogs(e),t.updateDialog(k,e),Object(r.isClassicInterface)(e)&&C.updateCounter(e,k),e.get().peer===k&&n.changedMessageSelection(e)});break;case h.DELETE_DIALOG:e.set(a.deletedDialog.bind(null,d.peerId,Promise.resolve([]))).then(()=>{g().removePeer(e,d.peerId),g().updateDialogFilters(e)});break;case h.CHANGE_PEER:Fc(e,d,t,n,o,l,C,m,g);break;case h.MUTEX:var P={[d.peerId]:d},D=Object(r.isPeerBlocked)(d.peerId,e);e.set(a.updateBlockStates.bind(null,P)).then(()=>{t.updateDialog(d.peerId,e);var a=Object(r.isPeerBlocked)(d.peerId,e);Object(r.isFullyLoadedTab)(e.get(),d.peerId)&&D!==a&&n.updateChat(e,d.peerId)});break;case h.FAILED_MESSAGE:e.set(a.setMessageErrored.bind(null,d.peer,d.message)).then(()=>{n.setMessageErrored(d.peer,d.message,d.error,e),t.setDialogFailed(d.peer,d.message.messageId,e)});break;case h.RESEND:var R=d.message.messageId;e.set(a.resendMessage.bind(null,d.peerId,R,d.message)).then(()=>{n.resendMessage(d.peerId,R),t.promoteDialog(e,d.peerId)});break;case h.CONVERSATION_UPDATED:if(Object(i.isMessageRequestChangedEvent)(d)){var x=Promise.resolve(),B=Object(i.getCurrentTab)(e);switch(d.updateType){case h.MAIL_CHAT_UPDATE_TYPE_CONTACT_CONVERTED:B&&B.peerId===d.updateArg&&e.get().longpoll.push([h.changePeer(d.peerId)]),x=e.set(a.deletedDialog.bind(null,d.updateArg,Promise.resolve([]))).then(()=>{g().removePeer(e,d.updateArg),g().updateDialogFilters(e)});break;case h.MAIL_CHAT_UPDATE_TYPE_MESSAGE_REQUEST_CHANGED:x.then(()=>e.set(a.updateMessageRequestsCounter.bind(null,d))).then(()=>{Object(r.updateMessageRequestsCounterInDOM)(e),Object(r.checkMessageRequestsTab)(e,t.update),d.updateArg===h.MESSAGE_REQUEST_STATUS_ACCEPTED&&Object(r.isClassicInterface)(e)&&C.updateMenu(e)})}}else{if(Object(r.isTabLoaded)(e.get(),d.peerId))Tc(e,d.peerId,d.updateType,d.updateArg,n,t)||g().reloadChatInfo(d.peerId)}break;case h.WAITING_FOR_RECONNECT:setTimeout(()=>{Kc(l,!0),n.setNetworkWaitingStatus(d.timeout-1)},1e3);break;case h.RECONNECTING:Kc(l,!0),n.setNetworkReconnectingStatus();break;case h.RECONNECTED:Kc(l,!1),setTimeout(n.clearNetworkStatus,0),browser.chrome&&!Object(r.isClassicInterface)(e)&&e.get().peer&&(c.is_idle?A||(c.once("unidle",()=>{A=!1,t.forceScrollReinit()}),A=!0):t.forceScrollReinit())}})})},updateHistory:e=>n.updateHistory(e),reloadChatInfo(e){Object(r.isTabLoaded)(f.get(),e)&&f.set(a.loadChatInfo.bind(null,e)).then(()=>function(e,t,n,i,s){i.updateChatTopic(t,e),Object(r.isClassicInterface)(e)&&s.updateName(t,e),e.get().peer==t&&(Object(a.setActions)(e.get()),i.updateActions(e))}(f,e,0,n,C))},cancelRecording:()=>f.set(a.cancelRecording).then(()=>n.cancelRecording()),fixHeight(){S()},unmount(){Object(p.destroyModule)(e),clearInterval(f.get().update_title_to),c.stop(),Ll.getInstance().unsubscribe(),I(),wc.casperMessagesStore.destroy(),t.unmount();var i=window.devicePixelRatio>=2?"_2x":"";setFavIcon("/images/icons/favicons/fav_logo"+i+".ico"),n.unmount(),o.unmount(),cancelStackFilter("im_peer"),_.unmount(),m&&m.unmount(),C&&C.unmount(),E&&E(),v&&v(),Object(r.isLocksAvailable)(f)&&f.get().peer&&f.set(a.releaseBlock.bind(null,f.get().peer)),j.unmount(),C&&C.unmount(),T.unmount(),clearInterval(O),cur.imDb.unmount(),cur.imDb=!1}}}function zc(e,t,n,i){var s=t.get();Object(r.isReservedPeer)(s.peer)||e().onUserActions(t,i),s.update_old_title&&t.set(a.updateFavAndTitle.bind(null,!1,!1))}function Xc(e,t){var n=ge("page_header"),a=geByClass1("_im_page_history",e),i=window.clientHeight()-n.offsetHeight-30-2,s=Object(r.isClassicInterface)(t)?250:400,o={page:Math.max(i,s)};if(Object(r.isClassicInterface)(t)){var l=Object(r.getClassicChatHeight)();l=l>0?Math.min(l-n.offsetHeight-30-2,i):i;var c=hasClass(a,"im-page--history_empty-hist")?l:i;o.history=Math.max(l,s),o.chat=Math.max(c,s)}return o}function Qc(e,t,n,i,s){var o=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],l=arguments.length>6&&void 0!==arguments[6]&&arguments[6];if(!Object(_.isFullScreen)()){var c=Xc(e,t);if(setStyle(e,{minHeight:c.page}),Object(r.isClassicInterface)(t)&&(void 0===t.get().chatResizeInitialized&&t.set(a.initializeChatResize),setStyle(e,{height:t.get().isCreating?c.page:"auto"}),setStyle(geByClass1("_im_page_dialogs",e),{minHeight:c.page,position:"static",top:0}),setStyle(geByClass1("_im_page_history",e),{minHeight:c.history,position:"relative",top:0}),setStyle(geByClass1("_im_chat_body_abs",e),{minHeight:c.chat,height:c.chat,position:"relative",top:0})),browser.safari&&l&&"function"==typeof l&&l(),i&&i.updateScroll(),s&&s.updateScroll(),n){var d=n.updateScroll();n.scrollFix(t,t.get().peer,d)}o&&setTimeout(()=>Qc(e,t,n,i,s,!1),100)}}function Zc(e,t){e.get().resendAllOnOnline&&t()}function Jc(){!function(e){var t="safari-repaint";e.forEach((function(e){hasClass(e,t)&&removeClass(e,t),addClass(e,t)})),setTimeout((function(){e.forEach((function(e){removeClass(e,t)}))}),100)}([geByClass1("_im_dialog_actions"),geByClass1("_im_chat_input_w"),ge("side_bar"),geByClass1("_im_right_menu"),geByClass1("_im_dialogs_settings"),geByClass1("_im_dialogs_search")])}function ed(e){var t,n,i,s=e.get();return Object(r.isLocksAvailable)(e)?(t=s.mutex_key,n=function(e){s.longpoll.push([h.mutexEvent(e)])},i=function(e,t){return Object(a.getMutexQueue)(s.gid).then(e=>Lc(e,1)[0])},Notifier.addKey(t,ac.bind(null,n,i,t)),Ql.set(t,{onData:n,onUpdateKey:i,ts:t.ts}),tc(),{stop:nc.bind(null,t)}).stop:null}function td(e,t){var n,s=t.get(),o=window.devicePixelRatio>=2?"_2x":"";setFavIcon("/images/icons/favicons/fav_im"+o+".ico"),Qc(e,t,!1,!1,!1,!0),Object(qe.statlogsBrowserNotificationsUser)();var l=Object(p.createMutations)($c),c=l.callMutations,d=l.bindMutations,u=s.useFcLongpoll&&vk.lpConfig.enabled&&Notifier.getLpInstance&&Notifier.getLpInstance(),g=u?Notifier.getLpInstance():t.get().gid?function(e){Object(Rl.imWeirdLog)("im_start_longpoll_group",{},!1);var t=Object(Dl.createLongpollEventsQueue)(e.ts,e=>{a.trigger("data",e)}),n=Object(Pl.createLongpoll)(e,t.onLp),a=new window.EventEmitter;return{onData:e=>a.on("data",e),offData:e=>a.off("data",e),push:e=>a.trigger("data",e),pause:t.pause.bind(t),resume:t.resume.bind(t),abortWaiting:n.abortWaiting.bind(n),onLp:t.onLp.bind(t),stop:n.stopConnection.bind(n),isEnabled:()=>!(!n||n.isStopped())}}(s.lpConfig):Xl(s);function m(){for(var e=arguments.length,n=new Array(e),a=0;a<e;a++)n[a]=arguments[a];c().onEvents(t,n)}g.onData(m),Ll.getInstance().subscribe(e=>c().onQueueEvent(t,e)),u&&Object(Rl.imWeirdLog)("im_use_fc_longpoll",{},!1);var h=geByClass1("_im_dialogs_search",e),f=geByClass1("_im_dialogs_settings",e),b=Ge(geByClass1("_im_page_dcontent",e),t,c,h);b.updateStarPosition(),b.renderPeerTags(t);var v,O,y=To(h,t,c),C=qo(f,t,c),j=gc(t);(cur.imDb=Object(yi.mount)(t.get().gid?-t.get().gid:vk.id),t.set(a.preloadSearchIndex.bind(null,cur.imDb)),Object(r.isClassicInterface)(t)&&C.updateSettings(t),Object(r.isClassicInterface)(t))&&(v=dc(geByClass1("_im_ui_peers_list",e.parentNode),t),O=function(e,t,n,a){if(browser.mobile)return!1;var r=[t,n,geByClass1("_im_chat_input_w",a),geByClass1("_im_dialog_actions",a)],i=null,s=hasClass(e,"im-page--header_static"),o=ge("im-group-online-disabled-notice");function l(){var t=Object(E.getNativeOption)("scrollLeft"),n=hasClass(e,"im-page--header_static"),a=[];i!==t?a=r.slice().concat([e]):n!==s&&(a=[e]),i=t,s=n,a.length>0&&a.forEach(a=>{var r=e===a&&n?0:-t;setStyle(a,{[cssTransformProp]:0===r?"unset":"translateX("+r+"px)"})})}return o&&r.push(o),r=r.concat(geByClass("_im_aside_notice"),geByClass("_im_aside_promo_block")),addEvent(window,"scroll",l),l(),()=>{removeEvent(window,"scroll",l)}}(h,f,geByClass1("_im_right_menu",e.parentNode),e));Object(r.isClassicInterface)(t)&&s.peer&&b.deactivate(),s.gid||(n=Il(geByClass1("_im_dialogs_creation",e),t,c));var T=Ks(geByClass1("_im_page_history",e),t,b,v,c),S=s.isCreating,I=S?"create":0===s.peer?"search":"default";S&&n.show(t,[]);var A=Nl(t,I,b,T,y,n),w=Cc(t,A);T.renderPeerProfile(t),T.updateScroll();var L=zc.bind(null,c,t,A);s.peer&&t.set(a.prepareCasperMessagesFromMessages.bind(null,s.peer)),Object(r.isReservedPeer)(s.peer)||setTimeout(()=>Dc(t,T),10);var k=new Ac.default({id:"im",element:document,focusElement:window,triggerEvents:"mouseover mousedown keypress"}),M=Object(ka.debounce)(Jc,300),N=Qc.bind(null,e,t,T,b,n,!1,M),P=Zc.bind(null,t,T.resendAll);t.setState({longpoll:g}),t.set(a.setExecStack.bind(null,[])),k.on("unidle",(function(){g.abortWaiting(),L()})),k.start(),nav.objLoc.box&&(Nc(t,nav.objLoc.box),Object(Oi.updateLocation)({box:null})),nav.objLoc.mr&&Object(r.isChatPeer)(Number(nav.objLoc.mr))&&b.showInvitationBox(t,nav.objLoc.mr);var D,R=ed(t);if(Object(r.isLocksAvailable)(t)&&(D=setInterval(r.blockLatencyCompensation.bind(null,t,s.longpoll),2e3)),t.get().invitation&&Object(r.showInvitationBox)(t,t.get().invitation,a.leaveInvitation),Object(r.isClassicInterface)(t)&&Object(i.existsIncomingMessageRequest)(t)){var x=document.getElementById("ui_rmenu_mr");x&&x.classList.remove("unshown")}var B=Object(_.throttleAccumulate)(Mc.bind(null,t,T,b,v),200),H=r.hideTopNotice.bind(null,t),F=r.hideAsideNotice.bind(null,t);return wc.casperMessagesStore.subscribe(e=>function(e,t,n,a,r){var s=r.type,o=r.message;switch(s){case wc.EXPIRING:return t.updateCasperMessageStatus(o);case wc.EXPIRING_SOON:return t.updateCasperMessageStatus(o,!0);case wc.EXPIRED:Object(i.isCasperChat)(e,o.peerId)?a(o):(t.handleMessageExpiration(o),n.updateDialog(o.peerId,e))}}(t,T,b,B,e)),wc.casperMessagesStore.setTimeshift(s.timeshift),d(Object(p.createModule)({handlers:(t,n)=>{t(document,"mousemove mousedown keypress",L),t(window,"resize",N),t(window,"online",P),n(e,"click",r.HIDE_TOP_NOTICE_CLASS,H),n(gpeByClass("_im-page-wrap",e),"click",r.HIDE_ASIDE_NOTICE_CLASS,F),n(gpeByClass("_im-page-wrap",e),"click",r.HIDE_ASIDE_PROMO_BLOCK_CLASS,r.hideAsidePromoBlock),n(gpeByClass("_im-page-wrap",e),"click",r.INSTALL_VKADMIN_LINK,r.installVKAdminApp),browser.safari&&t(document,"visibilitychange",Jc)}}),b,T,y,e,k,g,B,c,n,C,t,A,R,D,v,O,j,w,N,(function(){u?g.offData(m):g.stop()}))}var nd,ad;function rd(e){var t=ge("page_header"),n=window.clientHeight()-t.offsetHeight-30-2;setStyle(e,{height:Math.max(n,400)})}function id(e){var t=Object(r.formatTimespan)(Math.floor(Math.max(e,0)/1e3),!0);return t?getLang("mail_sick_timer").replace(/{timer}/gi,t):""}function sd(){nav.reload({force:!0})}function od(e){return{unmount(){clearInterval(ad),clearTimeout(nd),Object(p.destroyModule)(e)}}}function ld(e,t,n){rd(e);var a,r,i=(0,Object(p.createMutations)(od).bindMutations)(Object(p.createModule)({handlers:(t,n)=>{t(e.querySelector("._im_sick_reload"),"click",sd),t(window,"resize",rd.bind(null,e))}})),s=(a=localStorage.getItem("im_sick_timer"),r=a?Math.min(2*parseInt(a),6e5):5e3,localStorage.setItem("im_sick_timer",r),r),o=e.querySelector("._im_sick_timer"),l=+new Date;return o.innerHTML=id(s),ad=setInterval(()=>{o.innerHTML=id(l+s-new Date)},500),nd=setTimeout(sd,s),i}var cd=n("f4YT");window.IM={init(e){if(window.imwl=e.imwl,Object(Rl.startLoggingAllUnhandled)(),addTemplates(cd),window.cur.lang.dont_attach=getLang("mail_dont_add_media"),e.failed)return ld(geByClass1("im-sick",ge("page_body")));localStorage.removeItem("im_sick_timer"),e.tabbedPeers=(e.tabbedPeers||[]).map(e=>({peer:e,type:"perm"})),cur.ctrl_submit=e.ctrl_submit,cur.module="im",cur.mutedPeers=e.mutedPeers,cur.gid=e.gid,cur.peer=e.peer,e.blockedFlagUpdates={},e.msgid=intval(nav.objLoc.msgid),cur.options={blacklist_hash:e.thash};var t=-10800-60*(new Date).getTimezoneOffset(),n=e.timeshift;e.timeshift=n-t,e.oCache={},e.ref_id=nav.objLoc.ref,e.ref_source=nav.objLoc.ref_source;var i=e.owners;e.owners=void 0;var s=Object(C.default)(e);i.forEach(e=>Object(V.oCacheAdd)(s,e)),i=void 0,Object(r.normalizeTabsGotFromServer)(s,s.get().tabs),cur.imClassicInterface=Object(r.isClassicInterface)(s);var o=td(geByClass1("js-im-page",ge("page_body")),s);Object(a.updateMentions)(s.get()),window.IMBRIDGE={chatPhotoSaved(e){curBox()&&curBox().hide();var t=(e||{})[1];return t?(cur.pvShown&&layers.fullhide(!0,!0),"im"!=cur.module||s.get().peer!=t?nav.go("/im?sel=c"+(t-2e9)):void 0):nav.reload()},updateHistory(e){s.set(a.updateHistory.bind(null,e)).then(()=>{o.updateHistory(e)})},syncHistory(){s.set(e=>Object(a.syncHistory)(e))},activateTab(e){s.get().gid||s.get().longpoll.push([Object(h.changePeer)(intval(e),!1,!1,!0)])}};var l=!1;cur.nav.push((function(){return!!l||(s.get().audio_msg&&s.get().audio_msg.isRecording&&o.cancelRecording(),AudioMessagePlayer.detachPlayer(),o.route.apply(null,arguments))})),cur.destroy.push((function(){if(l)return!0;o.unmount(),window.IMBRIDGE=void 0,s.unmount(),window.store=void 0,l=!0,e=!1,s=!1,o=!1,Object(Rl.stopLoggingAllUnhandled)()}))}};try{stManager.done("imn.js")}catch(e){}},MCfn:function(e,t,n){"use strict";n.r(t),n.d(t,"connect",(function(){return l}));n("91GP");var a=n("q1tI");function r(){return(r=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e}).apply(this,arguments)}var i=a.createContext(),s=i.Provider,o=i.Consumer;function l(e){return class extends a.Component{constructor(){super(...arguments),this.onUpdate=()=>{this.setState({})}}componentDidMount(){this.store.subscribe(this.onUpdate)}componentWillUnmount(){this.store.unsubscribe(this.onUpdate)}render(){return a.createElement(o,null,t=>(this.store||(this.store=t),a.createElement(e,r({},this.props,{store:t}))))}}}t.default=s},"MV/q":function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return o}));n("91GP"),n("ioFf"),n("rGqo"),n("Btvt");var a=n("q1tI"),r=(n("17x9"),n("ZxpX"));function i(){return(i=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e}).apply(this,arguments)}function s(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},i=Object.keys(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}class o extends a.Component{constructor(e){super(e),this.getRef=e=>{this.element=e},this.resize=()=>{var e=this.element;if(e){var t=e.offsetHeight,n=e.scrollHeight,a=0;n+a<=t&&(a=0),e.value&&this.setState({height:n-a}),this.setState({height:0},()=>{var t=e.scrollHeight-a;this.setState({height:t}),this.props.onResize(e)})}},this.onChange=e=>{this.props.grow&&this.resize(),this.isControlledOutside||this.setState({value:e.target.value}),this.props.onChange&&this.props.onChange(e)},this.state={value:void 0===e.value?e.initialValue||"":void 0},void 0!==e.value&&(this.isControlledOutside=!0)}componentDidMount(){this.props.grow&&this.resize()}render(){var e=this.props,t=e.className,n=(e.initialValue,e.grow,e.style),o=(e.onResize,e.value),l=s(e,["className","initialValue","grow","style","onResize","value"]),c=this.isControlledOutside?o:this.state.value,d=this.state.height||n.height||66;return a.createElement("textarea",i({},l,{value:c,onChange:this.onChange,onInput:this.onChange,onPaste:this.onChange,ref:this.getRef,style:i({},n,{height:d}),className:Object(r.classNames)("Textarea",t)}))}}o.defaultProps={initialValue:"",grow:!0,onResize:()=>{},style:{}}},MhhX:function(e,t,n){"use strict";n.r(t),n.d(t,"isUnread",(function(){return i})),n.d(t,"isServiceMsg",(function(){return s})),n.d(t,"isCallMessage",(function(){return o})),n.d(t,"isActiveGroupCallMessage",(function(){return l})),n.d(t,"isOut",(function(){return c})),n.d(t,"hasReply",(function(){return d})),n.d(t,"isGraffiti",(function(){return g})),n.d(t,"isAudioMsg",(function(){return m})),n.d(t,"isSticker",(function(){return _})),n.d(t,"isGift",(function(){return p})),n.d(t,"isMoney",(function(){return h})),n.d(t,"isMoneyRequest",(function(){return f})),n.d(t,"isVKPay",(function(){return b})),n.d(t,"isImportant",(function(){return v})),n.d(t,"getUserId",(function(){return O})),n.d(t,"getAuthorId",(function(){return y})),n.d(t,"getAdminId",(function(){return C})),n.d(t,"wasEdited",(function(){return E})),n.d(t,"isMessageSelected",(function(){return j})),n.d(t,"isCasperMessage",(function(){return T})),n.d(t,"isMessageToBlockedCommunity",(function(){return S})),n.d(t,"hasPrivateStory",(function(){return I})),n.d(t,"isMessageEmpty",(function(){return A})),n.d(t,"getMessageTTL",(function(){return w})),n.d(t,"isExpiredCasperMessage",(function(){return L})),n.d(t,"MARKED_TYPE_MENTIONS",(function(){return k})),n.d(t,"MARKED_TYPE_CASPER",(function(){return M})),n.d(t,"getFromMessageMarkedDataByType",(function(){return N})),n.d(t,"getMentionsFromMessage",(function(){return P})),n.d(t,"hasUserMentions",(function(){return D}));n("OEbY");var a=n("f01n"),r=n("aong");function i(e,t){return"number"!=typeof t.messageId||(c(t)?t.messageId>e.out_up_to:t.messageId>e.in_up_to)}function s(e){return e.kludges&&void 0!==e.kludges.source_act}function o(e){return!(!e.kludges||"call"!==e.kludges.attach1_type)}function l(e){return e&&e.attaches&&e.attaches[0]&&"group_call_in_progress"===e.attaches[0].type}function c(e){return e.flags&a.FLAG_OUTBOUND}function d(e){var t=e.attaches.filter(e=>"mail"===e.type).length>0;return e.attaches.filter(e=>"reply"===e.type).length>0||e.flags&a.FLAG_HAS_REPLY&&t}function u(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,a=e.attaches[0];return a&&(a.type===t||a.type===n)}function g(e){return u(e,"doc")&&"graffiti"===e.attaches[0].kind}function m(e){return Boolean(e.attaches.find(e=>"doc"===e.type&&"audiomsg"===e.kind))}function _(e){return Boolean(e.attaches.find(e=>"sticker"===e.type))}function p(e){return u(e,"gift")}function h(e){return u(e,"money_transfer","money_request")}function f(e){return u(e,"money_request")}function b(e){return u(e,"link","vkpay")&&6217559==e.kludges.attach1_app_id}function v(e){return e.flags&a.FLAG_IMPORTANT}function O(e){return c(e)?vk.id:e.userId}function y(e,t){var n=Object(r.unpackStore)(e);return c(t)?n.id:t.userId}function C(e,t){var n=Object(r.unpackStore)(e);return n.gid&&c(t)?+t.kludges.from_admin||-n.gid:0}function E(e){return e.update_time>0}function j(e,t){return(e.get().selectedMessages||[]).indexOf(t)>=0}function T(e){return Boolean(e.kludges.is_expired||e.kludges.expire_ttl||e.kludges.ttl&&e.flags&a.FLAG_DELETE_BY_TTL)}function S(e,t){return!(!e.blocked_community||!c(t))}function I(e){return!(!e||!e.kludges.has_private_story)}function A(e){return e.messageId<=0}function w(e){var t=e.kludges.ttl||e.kludges.expire_ttl;return t?Number(t):void 0}function L(e){return!(!e.kludges||!e.kludges.is_expired)}var k=1,M=2;function N(e,t){var n=e.kludges&&e.kludges.marked_users,a=n&&n.find(e=>e[0]===t);return a?a[1]:void 0}function P(e){if(!e.kludges&&!e.kludges.marked_users)return[];var t=N(e,k);return t?Array.isArray(t)?t:[t]:[]}function D(e,t){if(!e.kludges&&!e.kludges.mentions&&!e.kludges.marked_users)return!1;var n=e.kludges.marked_users?P(e):e.kludges.mentions;return!!n&&n.findIndex(e=>e===t||"all"===e)>-1}},N4ZS:function(e,t,n){"use strict";function a(e){return"https://vk.com/web/away.php?to="+e}function r(e,t){var n=decodeURIComponent(e);return/^\/[^/]/.test(n)||/^(https?:\/\/)?([a-z0-9_\-.]+\.)?vk.com(\/.*)?/.test(n)?e:"/away.php?to="+encodeURIComponent(n)+(t?"&utf=1":"")}n.r(t),n.d(t,"wrapAway",(function(){return a})),n.d(t,"wrapAwayIfExternal",(function(){return r}))},NsuH:function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return s}));var a=n("q1tI"),r=(n("17x9"),n("ZxpX")),i=n("BN/X");class s extends a.PureComponent{constructor(e){super(e),this.onError=()=>{this.setState({errored:!0})},this.state={}}getPhotoImage(){var e=this.props,t=e.photo,n=e.title;return a.createElement("img",{src:this.state.errored?"/images/camera_c.gif":t,alt:n,onError:this.onError,className:"Entity__photo"})}render(){var e=this.props,t=e.className,n=e.style,s=e.size,o=e.photo,l=e.href,c=e.title,d=e.description,u=e.target,g={["Entity--size"+s]:!!s};return a.createElement("div",{className:Object(r.classNames)("Entity",t,g),style:n},a.createElement("div",{className:"Entity__aside"},"string"==typeof o?l?a.createElement("a",{href:l,target:u},this.getPhotoImage()):this.getPhotoImage():o),a.createElement("div",{className:"Entity__main"},c&&l?a.createElement("div",{className:"Entity__title"},a.createElement(i.default,{href:l,dangerouslySetInnerHTML:{__html:c},target:u})):a.createElement("div",{className:"Entity__title",dangerouslySetInnerHTML:{__html:c}}),"string"!=typeof d?a.createElement("div",{className:"Entity__description"},d):a.createElement("div",{className:"Entity__description",dangerouslySetInnerHTML:{__html:d}})))}}s.defaultProps={size:null,photo:"",title:"",description:"",href:"",target:null}},O8ze:function(e,t,n){"use strict";n.r(t),n.d(t,"statlogsForwardEvent",(function(){return m})),n.d(t,"statlogsForwardFromCommunityEvent",(function(){return _})),n.d(t,"statlogsCommunityTemplatesClickEvent",(function(){return p})),n.d(t,"statlogsForwardFromChannel",(function(){return h})),n.d(t,"statlogsSendingTime",(function(){return b})),n.d(t,"statlogsSendingTimeStart",(function(){return v})),n.d(t,"statlogsSendingTimeEnd",(function(){return O})),n.d(t,"statlogsSendingError",(function(){return y})),n.d(t,"statlogsSendingQueueLength",(function(){return j})),n.d(t,"statlogsSendingRetry",(function(){return T})),n.d(t,"statlogsBrowserNotificationsUser",(function(){return S})),n.d(t,"statlogsBrowserNotificationsOn",(function(){return I})),n.d(t,"statlogsBrowserNotificationsOff",(function(){return A}));n("pIFo");var a,r=n("1y80"),i=n("Bj12"),s=n("HLtZ"),o=function(){function e(){}return e.prototype.getCurrentTime=function(e){void 0===e&&(e=!0);var t=Date.now().toString(10);return e?t+"000":t},e.prototype.getIntId=function(){return Math.floor(Math.random()*e.MAX_INT32)},e.prototype.getBaseEvent=function(){return{id:this.getIntId(),timestamp:this.getCurrentTime()}},e.prototype.logEvent=function(e){e.type&&e[e.type]?Object(i.saveCustomStats)(e):Object(s.logError)(new Error("CustomStatCollector: invalid event."))},e.MAX_INT32=2147483647,e}();!function(e){e.TYPE_DEV_NULL_ITEM="type_dev_null_item"}(a||(a={}));var l=function(){return(l=Object.assign||function(e){for(var t,n=1,a=arguments.length;n<a;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)},c=function(){function e(e){this.customStatCollector=e}return e.prototype.logEvent=function(e){var t,n=l(l({},this.customStatCollector.getBaseEvent()),((t={type:a.TYPE_DEV_NULL_ITEM})[a.TYPE_DEV_NULL_ITEM]=e,t));this.customStatCollector.logEvent(n)},e}(),d=n("aong"),u=new c(new o),g={};function m(e){Object(r.statlogsProbValueEvent)(.1,"im_forward_stat",f(e),!!e.get().gid)}function _(e,t){Object(r.statlogsProbValueEvent)(.1,"im_forward_from_community_stat",f(e),!!e.get().gid,+t)}function p(){Object(r.statlogsProbValueEvent)(1,"im_apply_community_template_stat",1)}function h(){Object(r.statlogsProbValueEvent)(1,"messages_channel_forward_click",1)}function f(e){var t=e.get().pendingForward;return+(t&&t.msgIds&&t.msgIds.length)}function b(e,t,n){var a=arguments.length>3&&void 0!==arguments[3]&&arguments[3],s=1;if(!Object(r.randEnabled)(s))return()=>{};var o=+new Date,l=C(e),c=E(e)?"sse":"longpoll";return function(){var e=+new Date-o;Object(i.saveStatlogEvents)({name:"messages_send_time_web",value:e,keys:[t,n,l,a,c]}),"opt_to_lp"===n&&u.logEvent({key:"messages_send_time_web",value_str:c,value:e})}}function v(e,t,n,a){if(t.messageId&&-1!==String(t.messageId).indexOf("rid")){var r=[t.messageId.replace("rid",""),n,a].join("_"),i=t.attaches.length>0;g[r]=b(e,n,a,i)}}function O(e,t,n,a){var r=[t.randomId,n,a].join("_"),i=g[r];i&&(i(),delete g[r])}function y(e,t,n,a){var i=C(e),s=""===t?"network":"unknown";Object(r.randEnabled)(1)&&Object(r.statlogsValueEvent)("messages_send_errors_web",s,n,a,i)}function C(e){var t=Object(d.unpackStore)(e);return Boolean(t.longpoll&&t.longpoll.isEnabled&&t.longpoll.isEnabled())}function E(e){var t=Object(d.unpackStore)(e);return Boolean(t.longpoll&&t.longpoll.isSSE)}function j(e){var t=Object(d.unpackStore)(e),n=t.imQueue(t.peer).length;Object(r.randEnabled)(1)&&Object(r.statlogsValueEvent)("messages_send_queue_size",n)}function T(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"unknown",n=1;Object(r.randEnabled)(n)&&Object(r.statlogsValueEvent)("messages_send_retry",1,t,e)}function S(){var e="im_browser_notifications_users";ls.get(e)||ls.get("im_ui_notify_off")||(ls.set(e,1),Object(r.statlogsValueEvent)(e,1))}function I(){Object(r.statlogsProbValueEvent)(1,"im_browser_notifications_on",1)}function A(){Object(r.statlogsProbValueEvent)(1,"im_browser_notifications_off",1)}},P13b:function(e,t,n){"use strict";n.r(t),n.d(t,"getFirstUnread",(function(){return s.getFirstUnread})),n.d(t,"isSearchShown",(function(){return s.isSearchShown})),n.d(t,"getPeer",(function(){return s.getPeer})),n.d(t,"getCurrentKeyboard",(function(){return s.getCurrentKeyboard})),n.d(t,"getKeyboard",(function(){return s.getKeyboard})),n.d(t,"getTab",(function(){return s.getTab})),n.d(t,"getCurrentTab",(function(){return s.getCurrentTab})),n.d(t,"getSelectedMessages",(function(){return s.getSelectedMessages})),n.d(t,"getMessageRangeFromSelection",(function(){return s.getMessageRangeFromSelection})),n.d(t,"countUnread",(function(){return s.countUnread})),n.d(t,"getMessageByRid",(function(){return s.getMessageByRid})),n.d(t,"isRidExist",(function(){return s.isRidExist})),n.d(t,"getLocalId",(function(){return s.getLocalId})),n.d(t,"getLastMessage",(function(){return s.getLastMessage})),n.d(t,"parserMessage",(function(){return s.parserMessage})),n.d(t,"getAuthorFullName",(function(){return s.getAuthorFullName})),n.d(t,"getMessage",(function(){return s.getMessage})),n.d(t,"getPreviousMessage",(function(){return s.getPreviousMessage})),n.d(t,"isClassicInterface",(function(){return s.isClassicInterface})),n.d(t,"isLocksAvailable",(function(){return s.isLocksAvailable})),n.d(t,"isFoldersAvailable",(function(){return s.isFoldersAvailable})),n.d(t,"isCommunityInterface",(function(){return s.isCommunityInterface})),n.d(t,"isChannelPeer",(function(){return s.isChannelPeer})),n.d(t,"getBareTab",(function(){return s.getBareTab})),n.d(t,"isReversedDialogs",(function(){return s.isReversedDialogs})),n.d(t,"isFullyLoadedTab",(function(){return s.isFullyLoadedTab})),n.d(t,"makeTabNotFullyLoaded",(function(){return s.makeTabNotFullyLoaded})),n.d(t,"isGoToEndVisible",(function(){return s.isGoToEndVisible})),n.d(t,"isGoToMentionVisible",(function(){return s.isGoToMentionVisible})),n.d(t,"getUnreadScrollBottom",(function(){return s.getUnreadScrollBottom})),n.d(t,"isSendingAvailable",(function(){return s.isSendingAvailable})),n.d(t,"isCommunityPeer",(function(){return s.isCommunityPeer})),n.d(t,"isCommunityBlocked",(function(){return s.isCommunityBlocked})),n.d(t,"checkVoiceMessageAvailable",(function(){return s.checkVoiceMessageAvailable})),n.d(t,"isSearching",(function(){return s.isSearching})),n.d(t,"getSearchText",(function(){return s.getSearchText})),n.d(t,"isSearchingValue",(function(){return s.isSearchingValue})),n.d(t,"isRecentSearchesActive",(function(){return s.isRecentSearchesActive})),n.d(t,"getPinnedMessage",(function(){return s.getPinnedMessage})),n.d(t,"doPopularSuggExist",(function(){return s.doPopularSuggExist})),n.d(t,"isAnyMessageBeingEdited",(function(){return s.isAnyMessageBeingEdited})),n.d(t,"getGroupId",(function(){return s.getGroupId})),n.d(t,"getTabDraft",(function(){return s.getTabDraft})),n.d(t,"getTemplates",(function(){return s.getTemplates})),n.d(t,"tabIsMessageRequest",(function(){return s.tabIsMessageRequest})),n.d(t,"tabIsRejectedMessageRequest",(function(){return s.tabIsRejectedMessageRequest})),n.d(t,"tabIsMessageRequestToChat",(function(){return s.tabIsMessageRequestToChat})),n.d(t,"removeMessageRequestFolderFlags",(function(){return s.removeMessageRequestFolderFlags})),n.d(t,"isMessageRequestFolder",(function(){return s.isMessageRequestFolder})),n.d(t,"tabIsOutgoingMessageRequest",(function(){return s.tabIsOutgoingMessageRequest})),n.d(t,"existsIncomingMessageRequest",(function(){return s.existsIncomingMessageRequest})),n.d(t,"isMessageRequestChangedEvent",(function(){return s.isMessageRequestChangedEvent})),n.d(t,"isCommunityChat",(function(){return s.isCommunityChat})),n.d(t,"isCommunityChatDeleted",(function(){return s.isCommunityChatDeleted})),n.d(t,"isClosedChat",(function(){return s.isClosedChat})),n.d(t,"isCasperChat",(function(){return s.isCasperChat})),n.d(t,"isServiceChatTab",(function(){return s.isServiceChatTab})),n.d(t,"isCasperChatTab",(function(){return s.isCasperChatTab})),n.d(t,"isChatActive",(function(){return s.isChatActive})),n.d(t,"isTabMarkedUnread",(function(){return s.isTabMarkedUnread})),n.d(t,"SENDING_CLASS",(function(){return H})),n.d(t,"FAILED_CLASS",(function(){return F})),n.d(t,"ORIGINAL_CLASS",(function(){return U})),n.d(t,"RESTORE_CLASS",(function(){return G})),n.d(t,"TYPING_CLASS",(function(){return q})),n.d(t,"MESSAGE_KEYBOARD_BUTTON_CLASS",(function(){return V})),n.d(t,"MESSAGE_STACK_CLASS",(function(){return W})),n.d(t,"MESSAGE_CLASS",(function(){return K})),n.d(t,"CREATE_CHAT_ACTION",(function(){return Y})),n.d(t,"CHAT_TITLE_ACTION",(function(){return $})),n.d(t,"CHAT_INVITE_USER",(function(){return z})),n.d(t,"CHAT_KICK_USER",(function(){return X})),n.d(t,"CHAT_PHOTO_UPDATE",(function(){return Q})),n.d(t,"CHAT_PHOTO_REMOVE",(function(){return Z})),n.d(t,"CHAT_PIN_MESSAGE",(function(){return J})),n.d(t,"CHAT_UNPIN_MESSAGE",(function(){return ee})),n.d(t,"CHAT_INVITE_BY_LINK",(function(){return te})),n.d(t,"CHAT_SCREENSHOT",(function(){return ne})),n.d(t,"CHAT_GROUP_CALL_STARTED",(function(){return ae})),n.d(t,"CHAT_INVITE_TO_CALL",(function(){return ie})),n.d(t,"CHAT_INVITE_BY_CALL_LINK",(function(){return oe})),n.d(t,"ACCEPTED_MESSAGE_REQUEST",(function(){return le})),n.d(t,"DESELECT_ALL_CLASS",(function(){return ce})),n.d(t,"HIDE_TOP_NOTICE_CLASS",(function(){return de})),n.d(t,"HIDE_ASIDE_NOTICE_CLASS",(function(){return ue})),n.d(t,"HIDE_ASIDE_PROMO_BLOCK_CLASS",(function(){return ge})),n.d(t,"INSTALL_VKADMIN_LINK",(function(){return me})),n.d(t,"CLEAR_RECENT_CLASS",(function(){return _e})),n.d(t,"TOGGLE_MR_TAB",(function(){return pe})),n.d(t,"MESSAGE_SEARCH_CLASS",(function(){return he})),n.d(t,"PINNED_CONTAINER_CLASS",(function(){return fe})),n.d(t,"getClassicChatHeight",(function(){return be})),n.d(t,"setClassicChatHeight",(function(){return ve})),n.d(t,"applyInnerHtml",(function(){return Oe})),n.d(t,"compensateHistoryHeightChange",(function(){return ye})),n.d(t,"renderSticker",(function(){return Ce})),n.d(t,"isAlreadyDeleted",(function(){return Ee})),n.d(t,"replaceMessageAttrs",(function(){return je})),n.d(t,"isVoiceMessageAvailable",(function(){return Te})),n.d(t,"getAvailableMicrophones",(function(){return Se})),n.d(t,"renderAttach",(function(){return Ie})),n.d(t,"dayFromVal",(function(){return Ae})),n.d(t,"formatPhoneNumber",(function(){return we})),n.d(t,"getUserInitials",(function(){return Le})),n.d(t,"prepareContactName",(function(){return ke})),n.d(t,"showInvisibleBar",(function(){return Me})),n.d(t,"updateMessageInCache",(function(){return Ne})),n.d(t,"editAndReplaceMessage",(function(){return Pe})),n.d(t,"setCasperMessageExpiringStatusDOM",(function(){return De})),n.d(t,"renderMessage",(function(){return Re})),n.d(t,"renderMessageMedia",(function(){return xe})),n.d(t,"ensureDomHasActions",(function(){return Be})),n.d(t,"secondsToHuman",(function(){return He})),n.d(t,"renderCallMessage",(function(){return Fe})),n.d(t,"renderCallUserList",(function(){return Ue})),n.d(t,"appendToHistory",(function(){return Ge})),n.d(t,"restoreQueue",(function(){return qe})),n.d(t,"markMessagesAsRead",(function(){return Ve})),n.d(t,"replaceAttaches",(function(){return We})),n.d(t,"MSG_NEW",(function(){return Ke})),n.d(t,"MSG_DUPLICATE",(function(){return Ye})),n.d(t,"MSG_LOCAL_DUPLICATE",(function(){return $e})),n.d(t,"getMessageStoreStatus",(function(){return ze})),n.d(t,"isChatPeer",(function(){return d.isChatPeer})),n.d(t,"isUserPeer",(function(){return d.isUserPeer})),n.d(t,"isReservedPeer",(function(){return d.isReservedPeer})),n.d(t,"isContactPeer",(function(){return Qe})),n.d(t,"isEmailPeer",(function(){return Xe})),n.d(t,"isPeerActive",(function(){return Ze})),n.d(t,"isFvkcomgroup",(function(){return Je})),n.d(t,"isTabLoaded",(function(){return et})),n.d(t,"isTabLoadedWithMessage",(function(){return tt})),n.d(t,"parseMessage",(function(){return rt})),n.d(t,"convertPeerToUrl",(function(){return it})),n.d(t,"unUrlPeer",(function(){return st})),n.d(t,"simplifyCounter",(function(){return ot})),n.d(t,"chatActions",(function(){return lt})),n.d(t,"renderPhotos",(function(){return ut})),n.d(t,"renderPhotosFromTab",(function(){return gt})),n.d(t,"renderBtnSearchOnlyMessages",(function(){return mt})),n.d(t,"renderMessagesSep",(function(){return _t})),n.d(t,"renderConversationsSep",(function(){return pt})),n.d(t,"renderPopularSuggSep",(function(){return ht})),n.d(t,"renderClearRecent",(function(){return ft})),n.d(t,"renderPopularSuggestions",(function(){return bt})),n.d(t,"setMessageError",(function(){return vt})),n.d(t,"startResendMessage",(function(){return Ot})),n.d(t,"removeMessages",(function(){return yt})),n.d(t,"removeExpiredMessagesStub",(function(){return Ct})),n.d(t,"removeStartingFromMessage",(function(){return jt})),n.d(t,"removeMessagesWithRestore",(function(){return Tt})),n.d(t,"restoreMessage",(function(){return St})),n.d(t,"formatTyper",(function(){return It})),n.d(t,"loadSummaryActivityType",(function(){return At})),n.d(t,"renderEmptySearch",(function(){return Lt})),n.d(t,"serviceLink",(function(){return kt})),n.d(t,"renderServiceMsg",(function(){return Mt})),n.d(t,"addChatPhotoToUpdate",(function(){return Nt})),n.d(t,"replaceSpecialSymbols",(function(){return Pt})),n.d(t,"isSelfMessage",(function(){return Dt})),n.d(t,"showVerifiedTooltip",(function(){return Rt})),n.d(t,"wrapLoading",(function(){return xt})),n.d(t,"tabFromIds",(function(){return Bt})),n.d(t,"checkSelectClick",(function(){return Ht})),n.d(t,"renderGoTo",(function(){return Ft})),n.d(t,"showFlushChat",(function(){return Ut})),n.d(t,"showLeaveDialog",(function(){return Gt})),n.d(t,"showUnpinDialog",(function(){return qt})),n.d(t,"showMsgDeleteDialog",(function(){return Vt})),n.d(t,"cleanHistory",(function(){return Wt})),n.d(t,"inviteUser",(function(){return Kt})),n.d(t,"toggleMessageRequestsTab",(function(){return Yt})),n.d(t,"showUnreadOnly",(function(){return $t})),n.d(t,"changeTab",(function(){return zt})),n.d(t,"isImportant",(function(){return Xt})),n.d(t,"isUnrespond",(function(){return Qt})),n.d(t,"isPeerBlocked",(function(){return Zt})),n.d(t,"isPendingForward",(function(){return Jt})),n.d(t,"isPeerBlockedByMe",(function(){return en})),n.d(t,"blockLatencyCompensation",(function(){return tn})),n.d(t,"showSpamLayer",(function(){return nn})),n.d(t,"getLastSeenTextInHeader",(function(){return an})),n.d(t,"getLastSeenText",(function(){return rn})),n.d(t,"showBlacklistBoxUser",(function(){return on})),n.d(t,"showBlacklistBox",(function(){return ln})),n.d(t,"getBaseLink",(function(){return cn})),n.d(t,"showFavvedBox",(function(){return dn})),n.d(t,"isEditableFocused",(function(){return un})),n.d(t,"updateStar",(function(){return gn})),n.d(t,"removewNewUnreadBarAndMerge",(function(){return mn})),n.d(t,"isMessagesVisible",(function(){return _n})),n.d(t,"hideTopNotice",(function(){return pn})),n.d(t,"hideAsideNotice",(function(){return hn})),n.d(t,"hideAsidePromoBlock",(function(){return fn})),n.d(t,"installVKAdminApp",(function(){return bn})),n.d(t,"renderShortText",(function(){return On})),n.d(t,"attachToText",(function(){return yn})),n.d(t,"lockButton",(function(){return Cn})),n.d(t,"unlockButton",(function(){return En})),n.d(t,"renderPinnedMessage",(function(){return jn})),n.d(t,"renderPinnedMedia",(function(){return Tn})),n.d(t,"showMessageInfoTooltip",(function(){return Sn})),n.d(t,"showEditTimeTooltip",(function(){return In})),n.d(t,"showCasperExpiringTooltip",(function(){return An})),n.d(t,"getHistoryTopIndent",(function(){return wn})),n.d(t,"getPinnedMessageHeight",(function(){return Ln})),n.d(t,"boxHandleMessagesLabelsTooltips",(function(){return kn})),n.d(t,"showPinnedBox",(function(){return Mn})),n.d(t,"showRepliedBox",(function(){return Nn})),n.d(t,"isUserAliveInChat",(function(){return Pn})),n.d(t,"getAliveMembersCount",(function(){return Dn})),n.d(t,"normalizeTab",(function(){return Rn})),n.d(t,"normalizeTabsGotFromServer",(function(){return xn})),n.d(t,"splitMessageToParts",(function(){return Bn})),n.d(t,"isMessageTooLong",(function(){return Hn})),n.d(t,"showInvitationBox",(function(){return Fn})),n.d(t,"showWaitUntilUploadedBox",(function(){return Gn})),n.d(t,"canMessageBeDeletedForAll",(function(){return qn})),n.d(t,"getTopChatMembers",(function(){return Vn})),n.d(t,"getChatMembersByIds",(function(){return Wn})),n.d(t,"getChatMembers",(function(){return Kn})),n.d(t,"formatTimespan",(function(){return Yn})),n.d(t,"focusOnMessage",(function(){return $n})),n.d(t,"getNowEditingMessage",(function(){return zn})),n.d(t,"checkMessageRequestsTab",(function(){return Xn})),n.d(t,"updateMessageRequestsCounterInDOM",(function(){return Qn})),n.d(t,"hideAllBoxes",(function(){return Zn})),n.d(t,"getMessageRequestDateText",(function(){return Jn})),n.d(t,"canPinMessage",(function(){return ea})),n.d(t,"canForwardMessages",(function(){return ta})),n.d(t,"canMarkImportant",(function(){return na})),n.d(t,"removeExpiredMessageIfNeed",(function(){return aa})),n.d(t,"isPeerCurrentUser",(function(){return ra})),n.d(t,"isGiftOptionAvailableForPeer",(function(){return ia})),n.d(t,"isMoneyOptionAvailableForPeer",(function(){return sa})),n.d(t,"replaceExpiredMessageWithPlaceholder",(function(){return oa})),n.d(t,"replaceExpiredRepliedMessageWithPlaceholder",(function(){return ua})),n.d(t,"getChatMemberCount",(function(){return ga})),n.d(t,"CALL_ENTRY_POINT_SNIPPET",(function(){return ma})),n.d(t,"CALL_ENTRY_POINT_HEADER",(function(){return _a})),n.d(t,"CALL_ENTRY_POINT_LIST",(function(){return pa})),n.d(t,"CALL_ENTRY_POINT_JOIN_SNIPPET",(function(){return ha})),n.d(t,"CALL_ENTRY_POINT_JOIN_HEADER",(function(){return fa})),n.d(t,"CALL_ENTRY_POINT_JOIN_BANNER",(function(){return ba})),n.d(t,"startCallFromIm",(function(){return va})),n.d(t,"handleCallLinkClick",(function(){return Oa})),n.d(t,"isCallToPeerAvailable",(function(){return ya})),n.d(t,"joinCallFromIm",(function(){return Ca})),n.d(t,"getConvoLocation",(function(){return Ea}));n("rE2o"),n("ioFf"),n("HEwt"),n("Vd3H"),n("a1Th"),n("91GP"),n("rGqo"),n("pIFo"),n("SRfc"),n("KKXr"),n("VRzm"),n("Btvt");var a=n("f01n"),r=n("h++7"),i=n("bIHZ"),s=n("rHUl"),o=n("MhhX"),l=n("S2bU"),c=n("jE6c"),d=n("rudk"),u=n("ZxpX"),g=n("yqpO"),m=n("FWc3"),_=n("EasH"),p=n("1BRX"),h=n("v+DW"),f=n("vT4u"),b=n("ofcU");function v(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var n=[],a=!0,r=!1,i=void 0;try{for(var s,o=e[Symbol.iterator]();!(a=(s=o.next()).done)&&(n.push(s.value),!t||n.length!==t);a=!0);}catch(e){r=!0,i=e}finally{try{a||null==o.return||o.return()}finally{if(r)throw i}}return n}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return O(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return O(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function O(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,a=new Array(t);n<t;n++)a[n]=e[n];return a}function y(e){return e.parentNode.getAttribute("data-receiver-chat-peer-id")}function C(e,t,n){var r=Object(b.createModule)({handlers:(r,i)=>{i(e,"click","_im_join_chat",e=>function(e,t){var n=domData(t,"chat-id"),r=domData(t,"hash"),i=domData(t,"chat-link");return Object(h.lockButton)(t),Object(f.joinChat)(n,r,i,e.get()).then(n=>{var r=v(n,1)[0];Object(h.unlockButton)(t);var i=e.get();i.longpoll.push([Object(a.changePeer)(r)]),i.onJoinChat&&i.onJoinChat(r)}).catch(e=>{Object(_.showFastBox)(getLang("mail_join_invite_error_title"),e),Object(h.unlockButton)(t)})}(t,e.target)),i(e,"click","_im_accept_mr",e=>function(e,t){var n=y(t);return Object(h.lockButton)(t),e.set(f.acceptMessageRequest.bind(null,n)).then(()=>{Object(h.unlockButton)(t),e.get().longpoll.push([Object(a.changePeer)(n)])}).catch(e=>{Zn(),Object(_.showFastBox)(getLang("mail_join_invite_error_title"),e),Object(h.unlockButton)(t)})}(t,e.target)),i(e,"click","_im_reject_mr",e=>function(e,t,n){var a=y(n);return Object(h.lockButton)(n),e.set(f.rejectMessageRequest.bind(null,a)).then(()=>{t.updateMenu(),t.updateList(),Object(h.unlockButton)(n),Zn()}).catch(e=>{Zn(),Object(_.showFastBox)(getLang("mail_error"),e),Object(h.unlockButton)(n)})}(t,n,e.target))}});return{unmount(){Object(b.destroyModule)(r)}}}var E=n("83Q7"),j=n("aong"),T=n("86+7"),S=n("Wu9C"),I=n("wSs/"),A=n("ERyv"),w=n("lJdi"),L=n("t7n3");var k=n("/eGY"),M=n("ambf"),N=n("Syd7"),P=n("nAFc"),D=n("S6+Z");function R(){return(R=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e}).apply(this,arguments)}function x(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var n=[],a=!0,r=!1,i=void 0;try{for(var s,o=e[Symbol.iterator]();!(a=(s=o.next()).done)&&(n.push(s.value),!t||n.length!==t);a=!0);}catch(e){r=!0,i=e}finally{try{a||null==o.return||o.return()}finally{if(r)throw i}}return n}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return B(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return B(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function B(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,a=new Array(t);n<t;n++)a[n]=e[n];return a}var H="_im_mess_sending",F="_im_mess_failed",U="_im_mess_original",G="_im_mess_restore",q="_im_typing",V="_im_mess_btn",W="_im_mess_stack",K="_im_mess",Y="chat_create",$="chat_title_update",z="chat_invite_user",X="chat_kick_user",Q="chat_photo_update",Z="chat_photo_remove",J="chat_pin_message",ee="chat_unpin_message",te="chat_invite_user_by_link",ne="chat_screenshot",ae="chat_group_call_started",ie="chat_invite_user_by_call",oe="chat_invite_user_by_call_join_link",le="accepted_message_request",ce="_im_deselect_all",de="_im_top_notice_hide",ue="_im_aside_notice_hide",ge="_im_aside_promo_block_hide",me="_im_vkadmin_promo_link",_e="_im_clear_recent",pe="_im_toggle_mr_tab",he="_im_mess_search",fe="_im_pinned";function be(){return ls.get("chatPosition")||0}function ve(e){e>=window.clientHeight()-30&&(e=0),ls.set("chatPosition",e)}function Oe(e,t){e&&e.innerHTML!==t&&(e.innerHTML=t)}function ye(e,t,n,a){var r=t&&!n?1:!t&&n?-1:0;r&&!Object(s.isClassicInterface)(e)&&a().compensateHistoryHeightChange(r)}function Ce(e,t,n,a){var r=window.devicePixelRatio>=2?"256":"128",i="animation"===n,s="im_gift";i&&(s+=" sticker_img");var o=`<img height="128" class="${s}" src="${Stickers.getStickerUrl(intval(e),r)}"/>`;if(i){var l="animatedSticker"+a;o=`<div id="${l}" data-loop-count=3 data-animation-path="${"/stickers.php?act=proxy_animation&product_id="+t+"&sticker_id="+e}" onmouseenter="StickersAnimation.loadAndPlaySticker(this);"\n     data-uniq-id="${a}" data-sticker-id="${intval(e)}" class="sticker_animation sticker_animation_128 im_gift">${o}</div>`;var c=!1;browser.msie?(0^a)===a&&(c=!0):c=Number.isInteger(a),c&&window.StickersSettings.getAutoplay()&&window.StickersAnimation&&window.StickersAnimation.loadAndPlayStickerWithTimer(l,10)}return t&&(o=`<a onmouseover="return Emoji.stickerOver(${intval(e)}, this);"\n        onclick="return Emoji.clickSticker(${intval(t)}, this, event);">${o}</a>`),o=`<div class="im_sticker_row">${o}</div>`}function Ee(e,t,n){var a=e.get?e.get():e;if(et(a,t)){var r=a.tabs[t].deleted||[];return inArray(n,r)}return!1}function je(e,t,n){var a=n.randomId,r=geByClass1("_im_mess_rid"+a,t);return r&&(t=Ge(e,n,t=Et([r],t),!0,!1)),t}function Te(e){var t=Object(s.checkVoiceMessageAvailable)(e);return browser.mobile&&browser.safari?Promise.resolve(!1):void 0!==t?Promise.resolve(t):Se().then(e=>e.length>0).catch(e=>!1)}function Se(){return window.AudioContext&&navigator.mediaDevices?navigator.mediaDevices.enumerateDevices().then((function(e){for(var t=[],n=0;n<e.length;n++)"audioinput"==e[n].kind&&t.push(e[n]);return t})):Promise.reject(new Error("NotSupported"))}function Ie(e){return Object(L.getTemplate)("im_preloader",{preloader:rs(vk.pr_tpl,{id:""}),cls:"im-preloader_attach im-preloader_visible im-preloader_"+e})}function Ae(e){var t=e.split(".");return(t[0]<10?"0":"")+t[0]+(t[1]<10?"0":"")+t[1]+t[2]}function we(e){var t=(""+e).replace(/\D/g,"").match(/^(\d+)(\d{3})(\d{3})(\d{2})(\d{2})$/);return t?`+${t[1]} (${t[2]}) ${t[3]}-${t[4]}-${t[5]}`:""}function Le(e){var t=Object(P.decodeHTMLEntities)(e),n=Object(D.emojiRegex)().exec(t);return n?0===n.index?Object(g.emojiReplace)(n[0]):t[0]:t.split(/\s/).reduce((e,t)=>e+t.slice(0,1),"").slice(0,2)}function ke(e){var t=Object(c.replaceEntities)(e);return Object(g.emojiToHTML)(Object(L.clean)(t),!0)}function Me(e){var t=geByClass1("_im_invisible_bar",e);t&&(removeClass(t,"_im_invisible_bar"),removeClass(t,"im-page--history-new-bar_hide"))}function Ne(e,t,n){var a=domData(n,"msgid"),r=geByClass1("_im_mess_"+a,t),i=n.cloneNode(!0);return r&&(r.parentNode.replaceChild(i,r),Be(t)),t}function Pe(e,t,n){var a=geByClass1("_im_mess_"+t.messageId,n);if(a){var r=se(Re(e,t));a.classList.contains("im-mess_is_editing")&&r.classList.add("im-mess_is_editing"),a.parentNode.replaceChild(r,a),Be(n)}return n}function De(e,t,n){var a=geByClass1("_im_mess_"+n,e);if(a){var r=a.closest("._im_mess_stack"),i=r&&r.querySelector(".im-mess-stack--bomb");i&&i.classList.add(t?"im-mess-stack--bomb_expiring-soon":"im-mess-stack--bomb_expiring")}return e}function Re(e,t){var n=[],a=Object(o.isUnread)(e.tabs[t.peerId],t),r=Object(o.isCallMessage)(t)||Object(o.isActiveGroupCallMessage)(t),i=Object(s.getPinnedMessage)(e),c=Object(o.hasReply)(t)?Object(L.getTemplate)("im_message_media",{type:"reply",messageId:t.messageId,attaches:Ie("reply"),text:""}):"";r||n.push("_im_mess"),Object(o.isOut)(t)&&a&&!r&&n.push("im-mess_unread _im_mess_unread"),Object(o.isOut)(t)&&!r&&n.push("im-mess_out"),Object(o.wasEdited)(t)&&n.push("im-mess_was_edited"),Object(I.canMessageBeEdited)(e,t)&&n.push("im-mess_editable"),Object(o.isImportant)(t)&&n.push("im-mess_fav"),-1!==(e.selectedMessages||[]).indexOf(t.messageId)&&n.push("im-mess_selected"),i&&i.messageId===t.messageId&&n.push("_im_mess_pinned");var u=Date.now()-1e3*t.date>1e3;t.local&&u&&n.push("im-mess_sending"),t.local&&n.push(""+H),t.local&&Object(o.wasEdited)(t)&&!a&&n.push("im-mess_unread im-mess_nobg"),t.failed&&n.push("im-mess_failed "+F),Object(o.isGift)(t)&&n.push("im-mess_gift"),r&&n.push("_im_mess_callsnippet"),Object(o.isCasperMessage)(t)&&n.push("im-mess_casper");var g=xe(t).concat(function(e){if(e.kludges.keyboard&&e.kludges.keyboard.inline){var t=e.kludges.keyboard.buttons;return[].concat(Object(L.getTemplate)("sImMessageKeyboard",{content:t.map(e=>Object(L.getTemplate)("sImMessageKeyboardRow",{content:e.map(e=>Object(L.getTemplate)("sImMessageKeyboardButton",{label:Object(k.getButtonLabel)(e),appearance:Object(k.getButtonAppearance)(e),type:e.action.type,modifier:e.action.type.replace("_","-"),attributes:Object(k.getAttributesFromActionObject)(e.action),tagName:e.action.type===k.BUTTON_TYPE_OPEN_LINK?"a":"button"})).join("")})).join("")}))}return[]}(t)),m=function(e,t){var n="",a=Object(j.unpackStore)(e).sourceEnabled&&t.kludges&&t.kludges.from_widget&&t.kludges.ref_source;Object(o.wasEdited)(t)&&(n+=Object(L.getTemplate)("sImLblWasEdited",{update_time:t.update_time}));if(Object(s.isCommunityInterface)(e)&&a){var r=t.kludges.ref_source,i={};try{(i=JSON.parse(Object(L.unclean)(r))).link&&i.info&&(i.link=Object(l.replaceHyperLinks)(Object(L.clean)(i.link),l.linksReplacer.bind(null,!1)),i=Object(L.clean)(langStr(getLang("mail_source_info"),"link",i.link,"info",Object(L.clean)(i.info))),n+=Object(L.getTemplate)("sImLblWasSourceInfo",{source:i}))}catch(e){}}return n}(e,t),_=c+rt(e,t.text,t.kludges,!1,t.peerId);t.subject&&"..."!==t.subject.trim()&&!Object(d.isChatPeer)(t.peerId)&&(_=Object(L.getTemplate)("im_topic",{topic:t.subject})+_);var p=Object(o.isGift)(t)?`<div class="im-mess--gift-lbl">${_}</div>`:"",h=g.length>0?Object(L.getTemplate)("im_message_media",{type:"media",messageId:t.messageId,attaches:g.join(""),text:p}):"";if(Object(o.isGift)(t)||(h=_+h),Object(o.isCallMessage)(t)){var f=Fe(t,!1,!0,e);h+=Object(L.getTemplate)("sImCallSnippet",f)}return h+=m,Object(L.getTemplate)("im_msg_row",{msg_id:t.messageId,from_id:t.peerId,aria_hidden:t.local&&!t.failed?"true":"false",ts:t.date,marker_params:t.failed?`aria-label="${getLang("mail_send_message_error")}" role="link"`:"",unread_params:a?`aria-label="${getLang("mail_unread_message")}"`:"",cls:n.join(" ")}).replace("%text%",()=>h)}function xe(e){return e.attaches.reduce((t,n)=>!Object(o.hasReply)(e)||"mail"!==n.type&&"reply"!==n.type?("call"===n.type||("sticker"===n.type?e.messageId?t.push(Ce(n.id,n.productId,n.kind,e.messageId)):t.push(Ce(n.id,n.productId)):t.push(Ie(n.type))),t):t,[])}function Be(e){for(var t=e.querySelectorAll("._im_mess_noa:not(._im_mess_callsnippet):not(._im_mess_srv)"),n=t.length;n--;)hasClass(t[n],"im-mess_fwd")||t[n].insertAdjacentHTML("afterbegin",Object(L.getTemplate)("sImHistoryRowActions")),removeClass(t[n],"_im_mess_noa")}function He(e){var t=Math.floor(e/3600),n=Math.floor(e/60)-60*t,a=!1,r=!1;return[t,n,e-3600*t-60*n].reduce((e,t)=>{if(0===t&&!r)return r=!0,e;a&&(t=t<10?"0"+t:t);var n=`${e}${""!==e?":":""}${t}`;return a=!0,r=!0,n},"")}function Fe(e,t,n,a){var r=vk.id,i=e.attaches[0],s=i.initiatorId,o=i.state,l=r===s,c=Boolean(e.kludges.attach1_call_video),d=e.kludges.attach1_call_participants&&JSON.parse(e.kludges.attach1_call_participants)||{},u="group_call"===e.kludges.attach1_kind,g={title:"",description:"",modifier:""},m=c?getLang("mail_call_snippet_outgoing_video"):getLang("mail_call_snippet_outgoing"),_=c?getLang("mail_call_snippet_incoming_video"):getLang("mail_call_snippet_incoming");switch(o){case"reached":var p=t?"":He(i.duration);g.title=l?m:_,g.description=`${getLang("mail_call_snippet_finished")} · ${p}`;break;case"canceled_by_initiator":g=l?{title:m,description:getLang("mail_call_snippet_canceled")}:{title:_,description:getLang("mail_call_snippet_missed")};break;case"canceled_by_receiver":if(l){if(t)return getLang("mail_call_declined");g={title:m,description:getLang("mail_call_snippet_declined")}}else g={title:_,description:getLang("mail_call_snippet_canceled")};break;default:g.title=getLang("mail_added_call")}u&&(g.title=getLang("mail_call_snippet_group"));var h=Object.keys(d);return g.user_list=Ue(a,h),g.button="",g.classes="im-mess--call-snippet CallSnippet--interactive _im-call-snippet",g.attributes=`data-participants="${h.join(",")}"`,g}function Ue(e,t){if(!t.length)return"";var n=t.slice(0,3).reduce((t,n)=>{var a=Object(T.oCacheGet)(e,n);return a&&(t+=Object(L.getTemplate)("sImCallUser",{url:a.photo,name:a.name})),t},"");return Object(L.getTemplate)("sImCallUsers",{users:n})}function Ge(e,t,n){!(arguments.length>3&&void 0!==arguments[3])||arguments[3];var a=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],r=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],i=Date.now()-1e3*t.date>1e3,l=e.tabs[t.peerId];if(!n||geByClass1("_im_mess",n)||geByClass1("_im_bar_date",n)||(n.innerHTML=""),l.skipped>0)return n;var c=[];t.local||(c=e.imQueue(t.peerId,a)),c.length>0&&Et(c.map(e=>geByClass1("_im_mess_rid"+e.rid,n),n).filter(e=>e));var u=Re(e,t),g=domLC(n);hasClass(g,"_im_mess_stack")||(g=domClosestSibling(g,"._im_mess_stack",-1));for(var m=Object(s.getLastMessage)(e,t.peerId,t.messageId);t.peerId===e.peer&&m&&!geByClass1("_im_mess_"+m.messageId);)m=Object(s.getLastMessage)(e,t.peerId,m.messageId);var _=geByClass1("_im_unread_bar_row",n),h=m?nt(m.date,e):0,f=Object(d.isChatPeer)(t.peerId)&&Object(s.isCasperChat)(e,t.peerId);if(!m||at(l,m,t,e,r)){var b="",v=!1;if(_&&Object(o.isOut)(t)&&mn(e,n,t.peerId),1===l.unread&&!Object(o.isOut)(t)&&r&&(b+=Object(L.getTemplate)("im_mess_bar",{}),v=!0,mn(e,n,t.peerId)),!Object(p.isToday)(new Date(h))&&!f){var O=new Date,y=v?"im-page--history-new-bar_hide _im_invisible_bar":"";b+=Object(L.getTemplate)("im_day_bar",{day:getShortDate(t.date,e.timeshift,!0,getLang("months_of","raw"),!0),date:t.date,day_class:O.getDate()+O.getMonth()+O.getFullYear()+" "+y})}if(Object(o.isServiceMsg)(t))b+=Object(L.getTemplate)("im_service_row",{text:Mt(e,t,l),type:"",date:t.date,from_id:"",message_id:t.messageId});else{var C=da(e,t);b+=Object(L.getTemplate)("im_mess_stack",Object.assign(C,{messages:u}))}Object(j.toArray)(sech(b)).forEach(e=>n&&n.appendChild(e))}else _&&e.peer===t.peerId&&!l.inplaceSearch&&Object(o.isOut)(t)&&mn(e,n,t.peerId),geByClass1("_im_stack_messages",g).appendChild(se(u));return Object(o.isOut)(t)&&!i&&setTimeout(()=>{var e=geByClass1("_im_mess_"+t.messageId,n);hasClass(e,H)&&addClass(e,"im-mess_sending")},500),c=c.filter(e=>e.rid!==t.randomId),Be(n),qe(c,e,n)}function qe(e,t,n){var a;return(a="object"==typeof e?e:t.imQueue(e,!1)).length>0&&a.map(e=>(e.mess.failed=!!e.failed,e.mess)).filter(e=>Object(s.getMessage)(t,e.peerId,e.messageId)).forEach(e=>Ge(t,e,n,!1)),n}function Ve(e,t,n){var a=e.tabs[t];return Object(j.toArray)(geByClass("_im_mess_unread",n)).forEach(e=>{var t,n=intval(domData(e,"msgid"));n>0&&a.out_up_to>=n&&(removeClass(e,"_im_mess_unread"),removeClass(e,"im-mess_unread"),(t=geByClass1("_im_mess_blind_unread_marker",e))&&(t.removeAttribute("aria-label"),t.removeAttribute("role"),t.removeAttribute("tabindex")))}),n}function We(e,t,n){var a=t.peerId,r=t.messageId,i=geByClass1("_im_msg_reply"+r,e),s=geByClass1("_im_msg_media"+r,e),o=n.tabs[a].mediacontent[r][0];return i&&(i.innerHTML=o[0]),s&&(s.innerHTML=o[1]),e}var Ke=0,Ye=1,$e=2;function ze(e,t){if(!Object(s.isFullyLoadedTab)(t,e.peerId))return Ke;var n=t.tabs[e.peerId];return n.msgs[e.messageId]?Ye:n.msgs["rid"+e.randomId]?$e:Ke}function Xe(e){return e<-2e9}function Qe(e){return e>19e8&&e<2e9}function Ze(e,t){return e===t.peer}function Je(e,t){return Object(w.doesChatTabHaveFlag)(Object(s.getTab)(e,t),1024)}function et(e,t){return!!e.tabs[t]}function tt(e,t){return!!et(e,t)&&null!==e.tabs[t].lastmsg}function nt(e,t){return 1e3*e+1e3*t.timeshift}function at(e,t,n,a,r){if(Object(o.getUserId)(t)!==Object(o.getUserId)(n))return!0;var i=nt(t.date,a),l=nt(n.date,a);if(!isSameDate(i,l))return!0;if(Object(s.isCommunityInterface)(a)&&intval(t.kludges.from_admin)!==intval(n.kludges.from_admin))return!0;if(n.date-t.date>300)return!0;if(Object(o.isServiceMsg)(t)||Object(o.isServiceMsg)(n))return!0;var c=Object(o.isCasperMessage)(t),d=Object(o.isCasperMessage)(n);if(c!==d)return!0;var u=t.kludges.is_expired,g=n.kludges.is_expired;return!(!c||!d||u===g)||(!(!c||!d||u||g)||!(c&&d&&u&&g)&&(!(!Object(o.isCallMessage)(n)&&!Object(o.isCallMessage)(t))||(!(!Object(o.isActiveGroupCallMessage)(n)&&!Object(o.isActiveGroupCallMessage)(t))||(!(!Object(o.isGift)(t)&&!Object(o.isGift)(n))||(!(!Object(o.isGraffiti)(t)&&!Object(o.isGraffiti)(n))||(!!Object(o.hasReply)(n)||!(Object(o.isUnread)(e,t)===Object(o.isUnread)(e,n)||!r||Object(o.isOut)(n)||Dt(n.peerId,a.gid))))))))}function rt(e,t,n){var a=arguments.length>3&&void 0!==arguments[3]&&arguments[3],r=arguments.length>4&&void 0!==arguments[4]&&arguments[4],i=Math.round(1e9*Math.random()).toString(16),o={},c=0;return t=(t=Object(l.replaceHyperLinks)(t||"",l.linksReplacer.bind(null,a))).replace(/(<a.+?<\/a>)/gi,e=>{var t=`!link_${c}_${i}!`;return o[t]=e,c++,t}),t=Object(l.replaceMentions)(t),e.isMassMentionsMessageAllowed&&(t=Object(l.replaceMassMentions)(t)),t=Object(l.replaceEmailLinks)(t),t=Object(l.replaceHashtags)(t,t=>{var n=Object(s.getGroupId)(e);return`<a href="/${n?"gim"+n:"im"}?sel=${r||Object(s.getPeer)(e)}&st=${encodeURIComponent(t)}">${t}</a>`}),Object.keys(o).forEach(e=>{t=t.replace(e,()=>o[e])}),n.emoji&&(t=Emoji.emojiToHTML(t,!0)),t}function it(e){return Object(d.isChatPeer)(e)?"c"+(e-2e9):Xe(e)?"e"+Math.abs(e+2e9):Qe(e)?"mr"+(e-19e8):e}function st(e){switch(e.substr(0,1)){case"e":return-2e9-intval(e.substr(1));case"c":return 2e9+intval(e.substr(1));default:return intval(e)}}function ot(e){return e>9999999?Math.floor(e/1e6)+"M":e>9999?Math.floor(e/1e3)+"K":e>0?e.toString():""}function lt(e,t){return{[f.CHAT_ACTION_SEARCH]:{name:getLang("mail_im_peer_search"),icon:"search"},[f.CHAT_ACTION_BLOCK_COMMUNITY]:{icon:"block",name:getLang("mail_block_comm_messages")},[f.CHAT_ACTION_BLOCK_NOTIFY]:{icon:"block",name:getLang("mail_block_notify_messages")},[f.CHAT_ACTION_ALLOW_COMMUNITY]:{icon:"unblock",name:getLang("mail_allow_comm_messages")},[f.CHAT_ACTION_CLEAR]:{name:Xe(e.peer)?getLang("mail_im_delete_email_contact"):getLang("mail_im_delete_all_history"),icon:"clear"},[f.CHAT_ACTION_MUTE]:{name:getLang("mail_im_mute"),icon:"mute"},[f.CHAT_ACTION_UNMUTE]:{name:getLang("mail_im_unmute"),icon:"unmute"},[f.CHAT_ACTION_MEDIA]:{name:Object(s.isCommunityInterface)(e)?getLang("mail_im_show_media_history_group"):getLang("mail_im_show_media_history"),icon:"media"},[f.CHAT_ACTION_BLOCK]:{icon:"block",name:getLang("mail_block_user")},[f.CHAT_ACTION_INVITE]:{icon:"invite",name:getLang("mail_im_create_chat_with")},[f.CHAT_ACTION_LEAVE]:{icon:"leave",name:t?getLang("mail_leave_channel"):getLang("mail_leave_chat")},[f.CHAT_ACTION_RETURN]:{icon:"return",name:t?getLang("mail_return_to_vkcomgroup"):getLang("mail_return_to_chat")},[f.CHAT_ACTION_PIN_HIDE]:{icon:"pin_hide",name:getLang("mail_menu_pin_hide")},[f.CHAT_ACTION_PIN_UNHIDE]:{icon:"pin_unhide",name:getLang("mail_menu_pin_show")},[f.CHAT_ACTION_UNPIN]:{icon:"unpin",name:getLang("mail_menu_unpin")},[f.CHAT_ACTION_SETTINGS]:{icon:"settings",name:t?getLang("mail_vkcomgroup_settings"):getLang("mail_settings")},[f.CHAT_ACTION_CALL_AUDIO]:{icon:"call_audio",name:getLang("mail_im_call_audio")},[f.CHAT_ACTION_CALL_VIDEO]:{icon:"call_video",name:getLang("mail_im_call_video")},[f.CHAT_ACTION_UNREAD]:{icon:"unread",name:getLang("mail_menu_mark_unread")}}}function ct(e,t){var n=`<img src="${e}" alt="" class="dialogs_inline_chatter dialogs_inline_chatter_half"/>`;return t&&(n=Object(L.getTemplate)("im_dialogs_link",{href:t,photo:n})),`<div class="im_grid">\n    <div class="dialogs_inline_chatter dialogs_inline_chatter_half">\n      ${n}\n    </div>\n  </div>`}function dt(e,t){var n=`<img src="${e}" alt="" class="dialogs_inline_chatter"/>`;return t&&(n=Object(L.getTemplate)("im_dialogs_link",{href:t,photo:n})),`<div class="im_grid">\n    <div class="dialogs_inline_chatter">\n      ${n}\n    </div>\n  </div>`}function ut(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];if("string"==typeof e)return`<div class="im_grid"><img src="${e}" alt=""/></div>`;switch(e.length){case 1:return`<div class="im_grid"><img src="${e[0]}" alt=""/></div>`;case 2:return e.map((e,n)=>ct(e,t[n])).join("");case 3:return ct(e[0],t[0])+e.slice(1).map((e,n)=>dt(e,t[n+1])).join("");case 4:return e.map((e,n)=>dt(e,t[n])).join("")}}function gt(e,t,n){if(Qe(t.peerId))return`<div class="nim-peer--contact-avatar nim-peer--contact-avatar_30">${Le(t.tab)}</div>`;if("string"==typeof t.photo&&t.photo)return`<div class="im_grid"><img src="${t.photo}" alt=""></div>`;if(Object(d.isChatPeer)(t.peerId)&&t.membersCount<2)return`<div class="im_grid"><img src="${e.get().default_chat_photo}" alt=""></div>`;if(Array.isArray(t.photo))return ut(t.photo);var a=t.data.active.slice(0,4).map(T.oCacheGet.bind(null,e)).filter(e=>!!e);return ut(a.map(e=>e.photo),n?[]:a.map(e=>e.link))}function mt(e){var t=e.get().gid?getLang("mail_search_only_messages_comm"):getLang("mail_search_only_messages");return`<li class="im-page--mess-search-w">\n    <div class="im-page--mess-search ${he}">\n      <button type="button" class="im-i--messages-search"></button>${t}\n    </div>\n  </li>`}function _t(){return`<li class="im-search-results-head">${getLang("mail_search_messages")}</li>`}function pt(){return`<li class="im-search-results-head">${getLang("mail_search_conversations_sep")}</li>`}function ht(){return`<li class="im-search-results-head">${getLang("mail_search_dialogs_sep")}</li>`}function ft(){return`<li class="im-search-results-head _im_recent_bar">\n    ${getLang("mail_recent_searches")}\n    <button type="button" class="${_e} im-page--clear-recent">${getLang("mail_clear_recent")}</button>\n  </li>`}function bt(e){var t=e.get().popular_sugg,n=Object(s.isClassicInterface)(e)?8:5;return t.length>n&&(t=t.slice(0,n)),'<li class="im-popular clear_fix">'+t.map(t=>{var n=t.peerId,a=Object(T.oCacheGet)(e,n)||t,r=e.get().tabs[n]||t,i=(e.get().mutedPeers||[]).indexOf(n)>=0;return`<div class="${["im-popular--item","fl_l","_im_dialog","_dont_add_recent","_im_sugg_"+n,r.unread>0&&"sugg-is_unread",i&&"sugg-is_muted"].filter(e=>!!e).join(" ")}" data-peer="${n}">\n    <a class="im-popular--avatar-w ${onlinePlatformClass(r.online)}" href="${a.link}"><img class="im-popular--avatar" src="${a.photo}"/></a>\n    <div class="im-popular--name-w"><a class="im-popular--name" href="${a.link}">${a.first_name||a.name}</a></div>\n    <span class="im-popular--unread _sugg_unread_ct">${ot(r.unread)}</span>\n</div>`}).join("")+"</li>"}function vt(e,t,n){var a=geByClass1("_im_mess_"+t.messageId,n);if(a){attr(a,"aria-hidden","false"),addClass(a,"im-mess_failed "+F);var r=geByClass1("_im_mess_marker",a);attr(r,"aria-label",getLang("mail_send_message_error")),attr(r,"role","link")}return n}function Ot(e,t,n){var a=geByClass1("_im_mess_"+t,n);if(a){removeClass(a,"im-mess_failed"),attr(a,"aria-hidden","true"),removeClass(a,F);var r=geByClass1("_im_mess_marker",a);attr(r,"aria-label",""),attr(r,"role","")}return n}function yt(e,t){return Et(e.map(e=>geByClass1("_im_mess_"+e,t)).filter(e=>e),t)}function Ct(e,t){var n=t||document,a=[];return e.forEach(e=>{var t=n.querySelector("._im_expired_message_"+e);if(t){var r=+t.dataset.count;if(t.dataset.count=r-1,t.classList.remove("_im_expired_message_"+e),1===r)(!domNS(t)||hasClass(domNS(t),"_im_bar_date"))&&(hasClass(domPS(t),"_im_bar_date")&&re(domPS(t)),hasClass(domPS(t),"_im_unread_bar_row")&&re(domPS(t))),re(t);else a.includes(t)||a.push(t)}}),a.length&&a.forEach(e=>{var t=+e.dataset.count;if(t>0){var n=la(t),a=se(n);a.classList.add(...e.classList),e.replaceWith(a)}}),t}function Et(e,t){var n=e.filter(e=>!hasClass(e,"im-mess_srv")).map(e=>e.parentNode);return e.forEach(e=>{hasClass(e,"im-mess_srv")?e.parentNode.parentNode.removeChild(e.parentNode):e.parentNode&&e.parentNode.removeChild(e)}),n.filter(e=>0===domChildren(e).length).map(e=>gpeByClass("_im_mess_stack",e)).forEach(e=>{hasClass(domPS(e),"_im_bar_date")&&re(domPS(e)),hasClass(domPS(e),"_im_unread_bar_row")&&re(domPS(e)),re(e)}),t}function jt(e){for(var t=e;t;){var n=t;if(null===(t=t.previousElementSibling)){hasClass(n,"mess_srv")&&(t=n.parentNode);var a=gpeByClass("_im_mess_stack",n);a&&(t=a.previousElementSibling,1===domChildren(n.parentNode).length&&a.parentNode.removeChild(a))}hasClass(n,"_im_unread_bar_row")||n.parentNode.removeChild(n)}}function Tt(e,t,n,a){return e.map(e=>geByClass1("_im_mess_"+e,a)).filter(e=>e).forEach(e=>{val(e,function(e,t,n){var a=t.innerHTML;return`<div class="im-mess--text">\n    ${getLang("delete"===n?"mail_deleted_stop":"mail_marked_as_spam")} <button type="button" data-peer="${e}" class="${G} im-mess--btn">${getLang("mail_restore")}</button>\n    <div class="${U} im-mess--original">${a}</div>\n  </div>`}(t,e,n)),addClass(e,"im-mess_light")}),a}function St(e,t,n){var a=geByClass1("_im_mess_"+e,n);if(a){var r=geByClass1(U,a);val(a,r.innerHTML),removeClass(a,"im-mess_light")}return n}function It(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0,n=arguments.length>2?arguments[2]:void 0,a=arguments.length>3?arguments[3]:void 0,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:2,i=arguments.length>5&&void 0!==arguments[5]&&arguments[5];if(i)return wt(e,t,n,a,!0,r);var s=60,o=wt(e,t,n,a,!1,r);return o.length>s?wt(e,t,n,a,!0,r):o}function At(e){var t={[f.ACTIVITY_TYPE_TYPING]:1,[f.ACTIVITY_TYPE_RECORDING_AUDIO]:2},n=Object.keys(e).sort((e,n)=>t[n]-t[e]),a={},r=n.reduce((t,n)=>{var r=(e[n]||{}).userIds;return(void 0===r?[]:r).forEach(e=>{a[e]||(a[e]=!0,t[n]=!0)}),t},{}),i=n.filter(e=>!!r[e]);return i.length>1?"":i[0]}function wt(e,t,n,a,r,i){var o=function(e,t,n){var a=[],r={};return Object.keys(t).map(n=>{((t[n]||{}).userIds||[]).forEach(t=>{Object(T.oCacheExists)(e,t)?parseInt(t,10)!==e.id&&(r[t]=n):a.push(t)})}),a.length&&Object(f.loadChatMember)({[n]:a},e),Object.keys(r).sort((e,n)=>t[r[e]].ts-t[r[n]].ts)}(a,e,t);if(0===o.length)return"";var l=Object(d.isUserPeer)(t)||Object(s.isCommunityPeer)(t)?"first_name":r?"short_name":"name",c=At(e),u="";c===f.ACTIVITY_TYPE_RECORDING_AUDIO?u=getLang("mail_recording_audio_several",o.length):c===f.ACTIVITY_TYPE_TYPING&&(u=getLang("mail_typing_several",o.length));var g=o.slice(0,Math.min(o.length-1,i)),m=g.map(e=>Object(T.oCacheGet)(a,e)[l]).join(", ");if(o.length>i+1){var _=function(e){var t={};return Object.keys(e).forEach(n=>{var a=e[n].userIds;(void 0===a?[]:a).forEach(e=>{t[e]=1})}),Object.keys(t).length}(e);m+=" "+getLang("mail_and_peer").replace("{count}",_-i).replace("{typing}",u)}else{if(o.length>1&&(m+=" "+getLang("mail_and_peer_one")),!Object(d.isChatPeer)(t)&&n)m+=" "+u;else m+=` ${Object(T.oCacheGet)(a,o[g.length])[l]} ${u}`}return m.trim()}function Lt(){return`<div class="im-page--chat-search-empty">\n    ${getLang("mail_im_search_empty")}\n  </div>`}function kt(e,t,n){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";return n?`<a class="im_srv_lnk ${a}" target="_blank" rel="noopener" href="${e}">${t}</a>`:`<span class="${a}">${t}</span>`}function Mt(e,t,n){var a=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],r=t.kludges,i=r.source_act,s=intval(r.source_mid),o=intval(Object(d.isChatPeer)(n.peerId)?r.from:t.userId),l=o===s,c=Object(T.oCacheGet)(e,o),u="";switch(i){case Y:u="mail_im_chat_created";break;case $:u=r.source_is_channel?"mail_im_title_updated_channel":"mail_im_title_updated_dot";break;case z:u=l?"mail_im_returned_to_chat":"mail_im_invited";break;case X:u=l?"mail_im_left":"mail_im_kicked_from_chat";break;case Q:u="mail_im_photo_set";break;case Z:u=r.source_is_channel?"mail_im_photo_removed_channel":"mail_im_photo_removed";break;case J:u=r.source_message?"mail_im_pin_message":"mail_im_pin_message_empty2";break;case ee:u=r.source_message?"mail_im_unpin_message":"mail_im_unpin_message_empty2";break;case te:u="mail_im_invite_by_link";break;case ne:u=Object(j.unpackStore)(e).id===s?"mail_im_chat_own_screenshot":"mail_im_chat_screenshot";break;case ae:u="mail_im_start_group_call";break;case ie:u="mail_im_invited_to_call";break;case oe:u="mail_im_invite_by_call_link";break;case le:u=c.contact_name?"mail_im_accepted_message_request":"mail_im_accepted_message_request_no_name";break;default:return"mail_no_support"}if(u=(u=(u=langSex(c.sex,getLang(u,"raw"))).replace("{from}",kt(c.link,c.name,a))).replace("{contact}",c.contact_name),s&&!l){var g=r.source_email;if(g)u=u.replace("{user}",kt("/im?email="+encodeURIComponent(g),"email",a));else{var m=Object(T.oCacheGet)(e,s),_=i===X?m.inv_name:m.kick_name;u=u.replace("{user}",kt(m.link,_,a))}}if(r.source_text){var p=r.source_old_text?`«<b class="im_srv_lnk">${r.source_old_text}</b>» &rarr; `:"";u=u.replace("{title}",p+`«<b class="im_srv_lnk">${r.source_text}</b>»`)}if(r.source_act===J||r.source_act===ee)if(r.source_message){var h=Pt(Emoji.emojiToHTML(stripHTML(r.source_message.replace(/<br\s?\/?>/gi," ")),!0)),f=kt("",h,!1,"im_srv_mess_link");u=u.replace("{msg}",f)}else u=u.replace(/{link}(.+){\/link}/i,(e,t)=>kt("",t,!1,"im_srv_mess_link"));return u}function Nt(e,t,n,a){if(t===Q){var r=geByClass1("_im_mess_"+e.messageId,a);if(r){var i=n.tabs[e.peerId];r.parentNode.innerHTML=Object(L.getTemplate)("im_msg_row",{msg_id:e.messageId,from_id:e.peerId,text:Mt(n,e,i)+n.chat_photo_msg,ts:e.date,cls:"im-mess_srv _im_mess_srv"})}}return a}function Pt(e){return e.replace(/&lt;&lt;/g,"&laquo;").replace(/&gt;&gt;/g,"&raquo;").replace(/ \-\-/g," &mdash;").replace(/\-\- /g,"&mdash; ").replace(r.MENTION_RAW,"$1$4")}function Dt(e,t){return!t&&e===vk.id}function Rt(e,t){return Object(m.showTooltip)(e,{url:Object(s.isCommunityPeer)(t)?"al_groups.php":"al_profile.php",params:{act:"verified_tt",mid:t,gid:t},slide:15,ajxdt:200,showdt:200,hidedt:200,dir:"auto",shift:[94,7,7],className:"verified_tt"})}function xt(e){return function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"bottom",a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",r=se(Object(L.getTemplate)("im_preloader",{preloader:rs(vk.pr_tpl,{id:""}),cls:["bottom"===n?"im-preloader_bottom":"im-preloader_top",a].join(" ")})),i=!1;function s(){i=!0,removeClass(r,"im-preloader_visible"),r.parentNode&&r.parentNode.removeChild(r)}setTimeout(()=>{i||("bottom"===n?e.appendChild(r):e.insertBefore(r,domFC(e)),addClass(r,"im-preloader_visible"))},0),t.then(s).catch(e=>{Object(A.imWeirdCatch)("wrapLoading",e),s()})}}function Bt(e,t){return{0:{msgs:e.reduce((e,t)=>(e[t]=[t,a.FLAG_IMPORTANT,0,0,"",{},{},0,0,0],e),{}),hash:t,history:1}}}function Ht(e,t){if(!t&&!e)return!1;var n=e.target||e.srcElement,a=8,r=!1,i=/_im_mess|im_log_act|im_log_ract|_im_log_body|im_log_rspacer|_im_graffiti_w|_wall_post_cont/;do{if(!n||n.onclick||n.onmousedown||"A"==n.tagName||hasClass(n,"_im_no_select")||hasClass(n,"im_msg_media_link")||"IMG"==n.tagName&&!hasClass(n,"_im_graffiti")&&!hasClass(n,"emoji")&&!hasClass(n,"emoji_css")&&!hasClass(n,"im_gift")||"TEXTAREA"==n.tagName||hasClass(n,"play_new")||hasClass(n,"videoplayer")||(r=i.test(n.className)))break}while(a--&&(n=n.parentNode));return!r||!!trim((window.getSelection&&window.getSelection()||document.getSelection&&document.getSelection()||"").toString())}function Ft(e,t){return`<div class="im-mess--text">\n      <span>${getLang("mail_restored")}</span>\n      <a class="_im_go_to" href="/im?sel=${it(e)}&msgid=${t}">${getLang("mail_im_goto_conversation")}</a>\n    </div>`}function Ut(e,t,n){var a=getLang("mail_deleteall1"),r=getLang("mail_sure_to_delete_all"),i=getLang("mail_delete");return Object(d.isChatPeer)(t)&&(Object(w.doesChatTabHaveFlag)(e,1024)?(a=getLang("mail_leave_channel"),r=getLang("mail_unfollow_channel_confirmation"),i=getLang("mail_unfollow_channel")):r=getLang("mail_chat_sure_to_delete_all")),Object(s.isCommunityPeer)(t)&&(r=getLang("mail_group_sure_to_delete_all")),Object(_.showFastBox)(a,r,i,n,getLang("global_cancel"))}function Gt(e,t,n){var a=Object(s.getTab)(e,t),r=Object(d.isChatPeer)(t),i=r&&Object(s.isChannelPeer)(a),o=r&&Object(s.tabIsMessageRequestToChat)(a),l=getLang("mail_deleteall1"),c=getLang("mail_sure_to_delete_all"),u=getLang("mail_delete");if(r){if(!Object(s.isChatActive)(a))return Ut(a,t,n.bind(null,!0));i?(l=getLang("mail_leave_channel"),c=getLang("mail_vkcomgroup_leave_confirm"),u=getLang("mail_leave_channel")):o?(l=getLang("mail_reject_mr_confirmation_title"),c=getLang("mail_reject_mr_confirmation_text"),u=getLang("mail_message_request_reject")):(l=getLang("mail_leave_chat"),c=getLang("mail_chat_leave_confirm"),u=getLang("mail_leave_chat"))}Object(s.isCommunityPeer)(t)&&(c=getLang("mail_group_sure_to_delete_all"));var g=new MessageBox({title:l,width:i?450:500}).content(c).setButtons(u,()=>n(!!isChecked(geByClass1("_check_is_delete"))||!r),getLang("global_cancel")).show();return!r||i||o||g.setControlsText(`<div class="checkbox im-delete-forall-checkbox _check_is_delete" onclick="checkbox(this);" role="checkbox" aria-checked="false">${getLang("mail_deleteall1")}</div>`),g}function qt(e){return Object(_.showFastBox)(getLang("mail_unpin_title"),getLang("mail_unpin_text"),getLang("mail_unpin"),e,getLang("global_cancel"))}function Vt(e,t,n,a){var r=getLang("mail_dialog_msg_delete_N",t),i=Object(_.showFastBox)(getLang("mail_dialog_msg_delete_title"),r,getLang("mail_delete"),()=>a(isChecked(geByClass1("_check_forall"))),getLang("global_cancel")),s="",o=!1;return n&&(s=`<div class="checkbox im-delete-forall-checkbox _check_forall" onclick="checkbox(this);" role="checkbox" aria-checked="false">${getLang("mail_delete_for_all")}</div>`,o=cur.imDb.selectByKey("del_forall_checked")),i.setControlsText(s),o&&checkbox(geByClass1("_check_forall")),i}function Wt(e,t,n,a,r){t.showProgress(),e.set(a.bind(null,r)).then(()=>{t.hideProgress(),t.hide(),n().removePeer(e,r),n().updateDialogFilters(e)})}function Kt(e,t,n,a){var r=e.get().tabs[t].memberIds;e.set(a.bind(null,"add_member",r)).then(n().showCreation)}function Yt(e,t,n){var a=e.get();if(a.active_tab===r.FOLDER_ALL&&0===a.dialog_tab_cts.mr)return!1;var i=a.active_tab===r.FOLDER_MESSAGE_REQUEST?r.FOLDER_ALL:r.FOLDER_MESSAGE_REQUEST;return e.set(n.bind(null,i)).then(e=>{t().restoreDialogs(e,!0)})}function $t(e,t,n){if(e.get().active_tab===r.FOLDER_ALL&&0===e.get().unread_cnt)return!1;var a=e.get().active_tab===r.FOLDER_UNREAD?r.FOLDER_ALL:r.FOLDER_UNREAD;return e.set(n.bind(null,a)).then(e=>{t().restoreDialogs(e,!0)})}function zt(e,t,n,a){if(t.get().active_tab===e)return Promise.resolve(t);var r=Object(s.isReversedDialogs)(t);return t.set(a.bind(null,e)).then(e=>(n().restoreDialogs(e,!0,r!==Object(s.isReversedDialogs)(e)),e))}function Xt(e,t){void 0===t&&(t=e.get().peer);var n=e.get().tabs[t];return r.FOLDER_MASKS[r.FOLDER_IMPORTANT]&n.folders}function Qt(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(void 0===t&&(t=e.get().peer),!Object(s.isFoldersAvailable)(e))return!1;var a=n||e.get().tabs[t];return r.FOLDER_MASKS[r.FOLDER_UNRESPOND]&a.folders}function Zt(e,t){return!1===((t.get().block_states||{})[e]||{}).free}function Jt(e){return null!=e.get().pendingForward}function en(e,t){return(t.get().block_states[e]||{}).who===vk.id}function tn(e,t){var n=e.get().block_states;Object.keys(n).forEach(r=>{n[r].time?!1===n[r].free&&Date.now()-n[r].time>=5e4&&t.push([a.mutexEvent([,1,"gim"+e.get().gid,r,0,""])]):n[r].time=Date.now()})}function nn(e,t,n){var a;return!showTabbedBox("al_im.php",{act:"a_spam",offset:"0",gid:e.get().gid},{onDone:(n,r)=>{r&&(a=t(n,e,r))},params:{width:638,onHide:()=>{AudioMessagePlayer.loaded&&AudioMessagePlayer.detachPlayer(!0),a.unmount()}}},n)}function an(e,t){return rn(e.get(),t,Object(s.getTab)(e,t).last_seen)}function rn(e,t,n,a){if(n.platform)return getLang("mail_header_online_status")+(n.mobile?sn(t,!1,!1,!0):"");if(!n.can_see){var r=Object(T.oCacheGet)(e,t),i=r||e.tabs[t];return function(e,t){var n;switch(e){case"recently":n=getLang("global_online_was_recently","raw");break;case"last_week":n=getLang("global_online_was_week","raw");break;case"last_month":n=getLang("global_online_this_month","raw");break;case"long_ago":n=getLang("global_online_long_ago","raw");break;default:return""}return langSex(t,n)}(n.status,i.sex)}if(!n.time||Date.now()-1e3*n.time>7776e6)return"";var s=getDateText(n.time,e.timeshift),o=langSex(Object(T.oCacheGet)(e,t).sex,getLang("mail_last_activity_tip","raw")).replace("{user}","").replace("{time}",s);return n.mobile&&(o+=sn(t,!1,!1,a)),o}function sn(e,t,n,a){var r={mid:e};n||(r.was=1),t?r.forcetoup=!0:r.forcetodown=!0,r=Object.assign(r,a);var i=JSON.stringify(r).slice(1,-1).replace(/"/g,"&quot;");return Object(L.getTemplate)("im_wrap_mobile",{class:"im_status_mob_onl",params:i})}function on(e,t){var n=t.get().tabs[e];return showBox("al_settings.php",{act:"blacklist_box",q:n.href},{stat:[jsc("web/settings.js"),"settings.css"],dark:1})}function ln(e,t){return showBox("groupsedit.php",{act:"bl_edit",name:"/id"+e,gid:t.get().gid},{stat:["page.css","ui_controls.js","ui_controls.css"],dark:1})}function cn(e){return e.get().gid?"/gim"+e.get().gid:"/im"}function dn(e,t,n,a){var r;kn(showTabbedBox("al_im.php",{act:"a_important",offset:"0"},{onDone:(a,i)=>{i&&(r=n(a,e,t,i))},params:{width:638,onHide:()=>{AudioMessagePlayer.loaded&&AudioMessagePlayer.detachPlayer(!0)},onDestroy:()=>{r&&r.unmount()}}},a),e)}function un(){var e=document.activeElement;return null!==e&&("INPUT"===e.tagName||"TEXTAREA"===e.tagName||e.getAttribute("contenteditable"))}function gn(e,t,n){var a=geByClass1("_im_mess_"+e,n);return a&&toggleClass(a,"im-mess_fav",t),n}function mn(e,t,n){var a=geByClass1("_im_unread_bar_row",t);if(!a)return t;var r=domClosestSibling(a,"._im_mess_stack",-1),i=domClosestSibling(a,"._im_mess_stack"),o=r?geByClass("_im_mess",r).pop():null,l=i?geByClass1("_im_mess",i):null;if(re(a),Me(t),!l||!o)return t;var c=domData(l,"msgid"),d=Object(s.getPreviousMessage)(e,n,c),u=Object(s.getMessage)(e,n,c);if(!d||at(e.tabs[n],d,u,e))return t;var g=geByClass1("_im_stack_messages",r),m=geByClass1("_im_stack_messages",i).children;return Object(j.toArray)(m).forEach(e=>{re(e),g.appendChild(e)}),re(i),t}function _n(e,t,n){var a=Object(s.getFirstUnread)(e,e.get().peer);if(!a)return[!1,0];var r=geByClass1("_im_mess_"+a,t);if(!r){var i=Object(s.getLastMessage)(e,e.get().peer,a);if(!i)return[!0,0];r=geByClass1("_im_mess_"+i.messageId,t)}var o=hasClass(r,"_im_mess_srv")?r:gpeByClass("_im_mess_stack",r);if(!o)return[!0,0];var l=r?r.offsetTop:0,c=o.offsetTop+l,d=n.contHeight();return c<=n.scrollTop()+n.getScrollHeight()?[!0,0]:[!1,Math.max(0,d-c)]}function pn(e,t,n){cancelEvent(t);var a=gpeByClass("_im_top_notice",n);fadeOut(a,200,re.pbind(a));var r=gpeByClass("_im_page_dialogs",a);r&&hasClass(r,"im-page--dialogs-notice")&&removeClass(r,"im-page--dialogs-notice"),ajax.post("al_im.php",{act:"a_hide_top_notice",type:a.getAttribute("data-type"),hash:a.getAttribute("data-hash")})}function hn(e,t,n){cancelEvent(t);var a=gpeByClass("_im_aside_notice",n);slideUp(a,200,re.pbind(a)),ajax.post("al_im.php",{act:"a_hide_top_notice",type:a.getAttribute("data-type"),hash:a.getAttribute("data-hash")})}function fn(e,t){cancelEvent(e);var n=gpeByClass("_im_aside_promo_block",t);slideUp(n,200,re.pbind(n)),ajax.post("al_im.php",{act:"a_hide_promo_block",type:n.getAttribute("data-type"),hash:n.getAttribute("data-hash")})}function bn(e,t){gpeByClass("_im_aside_promo_block",t).classList.add("--action-called"),ajax.post("al_im.php",{act:"a_vkadmin_app_install",hash:domData(t,"hash"),platform:domData(t,"platform")})}function vn(e){return e.length>1?function(e){return[].concat(e).sort((e,t)=>"mail"!==e.type?"mail"===t.type?-1:1:0)}(e):e}function On(e,t,n,a,r){if(n=n.replace(/\<br\s*\/?\>(\n)?/gi," ").replace(/[\n\r]/gi," "),n=Object(l.replaceMentions)(n,(e,t,n,a,r)=>r),a&&(n=Emoji.emojiToHTML(n,!0)),t&&"..."!==t.trim()&&!Object(d.isChatPeer)(e)&&(n=Object(L.getTemplate)("im_topic",{topic:t,cls:"im-topic_dialog"})+n),!n&&r.length>0){var i=vn(r);n=Object(L.getTemplate)("im_dialog_media",{name:yn(i[0],i)})}return n}function yn(e,t){var n={photo:getLang("mail_added_photos","raw"),video:getLang("mail_added_videos","raw"),audio:getLang("mail_added_audios","raw")};switch(e.type){case"mail":var a=e.object?e.object.fwd_count:e.id.split(";").length;return langNumeric(a,getLang("mail_fwd_msgs","raw"),!0);case"photo":case"video":case"audio":var r=t.filter(t=>t.type===e.type).length;return langNumeric(r,n[e.type],!0);case"audio_playlist":return"audio_album"===e.kind?getLang("mail_added_audio_album"):getLang("mail_added_audio_playlist");case"artist":return getLang("mail_added_artist");case"doc":switch(e.kind){case"graffiti":return getLang("mail_added_graffiti");case"audiomsg":return getLang("mail_added_audiomsg");default:return getLang("mail_added_docs")}case"geo":case"map":return getLang("mail_added_geo");case"wall":return getLang("mail_added_wall");case"wall_reply":return getLang("mail_added_wall_reply");case"gift":return getLang("mail_added_gift");case"link":case"share":return getLang("mail_added_link");case"sticker":return getLang("mail_added_sticker");case"market":return getLang("mail_added_market_item");case"money_transfer":return getLang("mail_added_money_transfer");case"money_request":return getLang("mail_added_money_request");case"story":return getLang("mail_added_story");case"mask":return getLang("mail_added_mask");case"article":return getLang("mail_added_article");case"call":case"group_call_in_progress":return getLang("mail_added_call");case"poll":return getLang("mail_added_poll");case"podcast":return getLang("mail_added_podcast");default:return getLang("mail_added_"+e.type)}return""}function Cn(e){addClass(e,"im-send-btn_loading")}function En(e){removeClass(e,"im-send-btn_loading")}function jn(e){var t=e.get(),n=Object(s.getPinnedMessage)(e);if(!n||!Object(S.isPinnedMessageVisibleInTab)(e,Object(s.getPeer)(e)))return"";var a=Object(T.oCacheGet)(e,n.userId);if(!a)return"";var r=Tn(e,n);if(!r)if(!(r=n.text)&&n.attaches.length){var i=vn(n.attaches);r=Object(L.getTemplate)("im_pinned_message_media",{text:yn(i[0],i)})}else r=rt(e,r,n&&n.kludges||{})||"";return r=r.replace(/<br\s?\/?>/gi," "),Object(L.getTemplate)("im_pinned_message",{date:getSmDate(n.date,t.timeshift),content:r,link:a.link,name:a.name})}function Tn(e,t){var n="";if(t&&Object(o.isMoneyRequest)(t)&&void 0!==t.kludges.attach1_tr_amount){var a="%s "+t.kludges.attach1_currency;if("RUB"===t.kludges.attach1_currency&&(a=getLang("mail_money_amount_rub","raw")),t.kludges.attach1_total_amount){var r=langNumeric(t.kludges.attach1_tr_amount/1e3,"%s",!0),i=langNumeric(t.kludges.attach1_total_amount/1e3,a,!0);n=getLang("mail_money_request_collected_amount_from").replace("{amount}",r).replace("{total_amount}",i)}else{var s=langNumeric(t.kludges.attach1_tr_amount/1e3,a,!0);n=getLang("mail_money_request_collected_amount").replace("{amount}",s)}if(intval(t.kludges.attach1_held_amount)){var l=langNumeric(t.kludges.attach1_held_amount/1e3,a,!0);n+=" "+getLang("mail_money_request_held_amount").replace("{amount}",l)}t.text&&(n+='<span class="divider"></span>'+rt(e,t.text,t.kludges)),t.kludges.attach1_total_amount&&(n+=Object(L.getTemplate)("im_pinned_message_media_bar",{percent:Math.min(100,Math.floor(t.kludges.attach1_tr_amount/t.kludges.attach1_total_amount*100))}))}return n}function Sn(e,t,n){var a=n.getAttribute("data-info");a&&Object(m.showTooltip)(n,{text:a,className:"_im_history_tooltip",appendParentCls:"_im_mess_stack",black:1,hidedt:1e3,shift:[0,4]})}function In(e,t,n){var a=+n.getAttribute("data-time");a&&Object(m.showTooltip)(n,{text:getLang("mail_message_edited")+" "+getSmDate(a,e.get().timeshift),className:"_im_history_tooltip",appendParentCls:"_im_mess_stack",black:1,shift:[0,4]})}function An(e,t,n){var a=n.target,r=a.closest("."+W),i=r.querySelector("."+K);if(i){var s,o=Number(i.getAttribute("data-msgid")),l=M.casperMessagesStore.getExpireTime(o),c="_im_bomb_tooltip_"+Math.round(1e4*Math.random()).toString(16);if(window.tooltips){var d=t.querySelectorAll(".im-mess-stack--bomb");Array.from(d).forEach(e=>{e!==a&&tooltips.hide(e,{fasthide:!0})})}var u=wn(e);Object(m.showTooltip)(a,{text:_(formatTime(l)),className:"_im_history_tooltip "+c,appendParentCls:W,black:1,shift:[12,4],onShowStart:g,onShowEnd(){s=setTimeout(g,500)},onHide(){clearTimeout(s)},force:!0,toup:a.getBoundingClientRect().top>u+37,hasover:!0}),setTimeout(g,500)}function g(){var e=r.querySelector(`.${c} .tt_text`);e&&(e.innerHTML=_(formatTime(M.casperMessagesStore.getExpireTime(o)))),s=setTimeout(g,500)}function _(e){return`<div class="wrapped">${e}</div>`}}function wn(e){var t=Object(s.getPeer)(e),n=Object(s.getTab)(e,t),a=Object(S.isPinnedMessageVisibleInTab)(e,Object(s.getPeer)(e))||n&&n.top_banner,r=Object(N.getPeerProfileHeight)();return 105+(a?Ln(e):0)+r}function Ln(e){var t=Object(s.getPinnedMessage)(e);return t&&Object(o.isMoneyRequest)(t)?62:52}function kn(e,t){e.bodyNode.addEventListener("mouseover",e=>{hasClass(e.target,"_im_edit_time")?In(t,0,e.target):hasClass(e.target,"_im_page_info")&&Sn(0,0,e.target)})}function Mn(e,t,n,a,r){var i,s=e.get();kn(showTabbedBox("al_im.php",{act:"a_get_pinned_message_box",chat:n,gid:e.get().gid,hash:s.tabs[n].hash},{onDone:(n,r)=>{r&&(i=a(n,e,t,r))},params:{width:638,onHide:()=>{AudioMessagePlayer.loaded&&AudioMessagePlayer.detachPlayer(!0)},onDestroy:()=>{i&&i.unmount()}}},r),e)}function Nn(e,t,n){var a=e.get();kn(showTabbedBox("al_im.php",{act:"a_get_replied_message_box",chat:a.peer,msgid:t,gid:a.gid,hash:a.tabs[a.peer].hash},{onDone:(e,t)=>{},params:{width:638,onHide:()=>{AudioMessagePlayer.loaded&&AudioMessagePlayer.detachPlayer(!0)},onDestroy:()=>{}}},n),e)}function Pn(e,t){return!(!Object(d.isChatPeer)(e.peerId)||!e.memberIds)&&e.memberIds.indexOf(t)>=0}function Dn(e){return!Object(d.isChatPeer)(e.peerId)||e.data.kicked?0:e.membersCount}function Rn(e,t){var n=Object(T.oCacheGet)(e,t.peerId),a=Object(s.getTab)(e,t.peerId)||{};return n&&(t.photo=t.photo||n.photo,t.name=t.name||n.name,t.href=t.link||n.link,t.sex=t.sex||n.sex),t.last_touched=a.last_touched||0,t.verified=!!t.verified,t.lastmsg=t.lastmsg||t.lastmsg_meta&&t.lastmsg_meta[0]||!1,t.folders=t.folders||null,t.unread=t.unread||0,t.last_seen=t.last_seen||{platform:0,time:0,mobile:0,can_see:0},t.online=t.last_seen&&t.last_seen.platform||0,t.out_up_to=null!=t.out_up_to?t.out_up_to:t.in_up_to||0,Object(d.isChatPeer)(t.peerId)&&(t.memberIds=t.memberIds||a.memberIds||null),t}function xn(e,t){for(var n in t)t.hasOwnProperty(n)&&Rn(e,t[n])}function Bn(e,t){var n=[],a=t.find(e=>"mail"===e[0]),r=a?a[1].split(";"):[];for(r.length>100&&(a[1]=r.slice(0,100).join(";"));e.length>4096;){var i=e.substr(0,4096).lastIndexOf(" ");-1==i&&(i=4096),n.push({msgText:trim(e.substr(0,i))}),e=trim(e.substr(i))}for(e.length&&n.push({msgText:e,attaches:t}),n.length||n.push({attaches:t}),r=r.slice(100);r.length;r=r.slice(100))n.push({attaches:[["mail",r.slice(0,100).join(";")]]});return n}function Hn(e){return e.length>4096}function Fn(e,t,n){var a=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,i=Object.assign(Un(t,a),{act:"a_chat_preview"}),s=!1;showBox("al_im.php",i,{stat:["boxes.css"],params:{dark:1,hideButtons:!0,onHide(){e.set(n),s&&s.unmount()}},onFail:e=>(setTimeout(()=>Object(_.showFastBox)(getLang("global_error"),e),0),!0),onDone(t){s=C(t.bodyNode,e,r)}},{})}function Un(e,t){return t?{chat_id:e.invite_chat_id,hash:e.invite_hash,link:e.invite_link}:e}function Gn(){Object(_.showFastBox)(getLang("global_error"),getLang("mail_message_wait_until_uploaded"))}function qn(e,t){var n=Object(s.getTab)(e,t.peerId)||{},a=e.get(),r=Object(d.isChatPeer)(t.peerId)&&Object(w.isUserAdminInChat)(n,a.id),i=Object(d.isChatPeer)(t.peerId)&&Object(w.isUserAdminInChat)(n,t.userId);if(!t)return!1;if(!Object(o.isOut)(t)&&(!r||i))return!1;if(333==t.peerId)return!1;if(Date.now()/1e3-t.date>86400)return!1;if(Ee(e,t.peerId,t.messageId))return!1;if(Object(d.isChatPeer)(t.peerId)){if(!Object(s.isChatActive)(n))return!1}else if(n.block_error>0)return!1;return!0}function Vn(e,t){var n=Object(s.getTab)(e,t),a=-1!==n.memberIds.indexOf(n.ownerId),r=a?[n.ownerId]:[];return(r=r.concat(n.memberIds.filter(t=>t!==n.ownerId&&Object(T.oCacheExists)(e,t)).slice(0,a?4:5))).map(t=>Object(T.oCacheGet)(e,t))}function Wn(e,t){return t.map(t=>Object(T.oCacheGet)(e,t))}function Kn(e,t){return Object(s.getTab)(e,t).memberIds.reduce((t,n)=>{var a=Object(T.oCacheGet)(e,n);return t[a.id]=a,t},{})}function Yn(e,t){if("number"!=typeof e||0===e)return"";var n,a=[[31536e3,t?getLang("global_years_accusative","raw"):getLang("global_age_years","raw")],[2592e3,t?getLang("global_months_accusative","raw"):getLang("global_age_months","raw")],[604800,t?getLang("global_weeks_accusative","raw"):getLang("global_age_weeks","raw")],[86400,t?getLang("global_days_accusative","raw"):getLang("global_age_days","raw")],[3600,t?getLang("global_hours_accusative","raw"):getLang("global_hours","raw")],[60,t?getLang("global_minutes_accusative","raw"):getLang("global_minutes","raw")],[1,t?getLang("global_seconds_accusative","raw"):getLang("global_age_seconds","raw")]],r=e,i=[];if(a.forEach(e=>{var t=x(e,2),n=t[0],a=t[1],s=Math.floor(r/n);r%=n,s>=1&&i.push(langNumeric(s,a))}),1===(n=i.length))return i.pop();var s=i.slice(0,n-1).join(", "),o=i.pop();return getLang("global_and").replace(/{before}/gi,s).replace(/{after}/gi,o)}function $n(e,t,n,r){r&&!Ee(e,n,r)&&(Object(s.getMessage)(e,n,r)?(e.setState({msgid:r}),Object(i.updateLocation)({msgid:r}),t()):e.get().longpoll.push([a.changePeer(n,r)]))}function zn(e){var t=geByClass1("im-mess_is_editing");if(!t)return null;var n=e.get().tabs[e.get().peer],a=Object(s.parserMessage)(n.msgs[domData(t,"msgid")]);return a&&a.peerId==e.get().peer?a:null}function Xn(e,t){if(Object(s.isClassicInterface)(e)){var n=document.getElementById("ui_rmenu_mr");n&&(Object(s.existsIncomingMessageRequest)(e)?n.classList.remove("unshown"):n.classList.add("unshown"))}else t(e)}function Qn(e){var t=Object(j.unpackStore)(e),n=Number(t.dialog_tab_cts[r.FOLDER_MESSAGE_REQUEST]),a=n>0?n:"",i=document.querySelector('._im_right_menu_counter[data-tab="mr"]');i&&(i.innerHTML=a)}function Zn(){for(var e=curBox();e;)e.hide(),e=curBox()}function Jn(e,t){return getLang("mail_invitation_sended_ago").replace("{when}",getDateText(e,t))}function ea(e,t){var n=Object(s.getPeer)(e),a=Object(s.getMessage)(e,n,t);return Object(w.canPinOrUnpin)(e,n)&&!Object(o.hasPrivateStory)(a)&&!Object(o.isCasperMessage)(a)}function ta(e,t){var n=Object(s.getPeer)(e);return!t.find(t=>{var a=Object(s.getMessage)(e,n,t);return Object(o.hasPrivateStory)(a)||Object(o.isCasperMessage)(a)})}function na(e,t){var n=Object(s.getPeer)(e);return!t.find(t=>{var a=Object(s.getMessage)(e,n,t);return Object(o.isCasperMessage)(a)})}function aa(e,t){var n=M.casperMessagesStore.isProcessed(e.messageId),a=M.casperMessagesStore.has(e.messageId),r=M.casperMessagesStore.getExpireTime(e.messageId)>M.MAX_DEVIATION;(!a&&!n||a&&r)&&t(e),a&&r&&M.casperMessagesStore.remove(e.messageId)}function ra(e){return e===vk.id}function ia(e,t){return Object(d.isUserPeer)(t)&&!ra(t)&&!Object(s.isCommunityInterface)(e)&&!Qe(t)}function sa(e,t){var n=e.get(),a=Object(s.isCommunityInterface)(e);return Object(d.isUserPeer)(t)&&!ra(t)&&!a&&!inArray(t,n.moneyTransferExcept)&&!Qe(t)||Object(s.isCommunityPeer)(t)&&n.moneyTransferCommAvail&&Object(s.getCurrentTab)(e).moneyTransferAvail&&!a||a&&n.moneyRequestAvail&&!Object(d.isChatPeer)(t)||Object(d.isChatPeer)(t)&&Object(s.getCurrentTab)(e).moneyRequestAvail&&!Object(s.isCasperChat)(e,t)}function oa(e,t,n){var a=geByClass1("_im_mess_"+n.messageId,t),r=a&&a.closest("._im_mess_stack");if(!a||!r)return t;var i,s,o,l=Array.from(r.querySelectorAll("._im_mess")),c=x((s=(i=r).previousElementSibling,o=i.nextElementSibling,[s&&1===s.nodeType?s:null,o&&1===o.nodeType?o:null]),2),d=c[0],u=c[1],g=d&&d.classList.contains("im-expired-message"),m=u&&u.classList.contains("im-expired-message"),_=g&&0===l.findIndex(e=>+e.getAttribute("data-msgid")===n.messageId),p=m&&l.findIndex(e=>+e.getAttribute("data-msgid")===n.messageId)===l.length-1,h=la((_?+d.getAttribute("data-count"):0)+(p?+u.getAttribute("data-count"):0)+1,"_im_expired_message_"+n.messageId),f=se(h);if(_&&(f.classList.add(...d.classList),d.remove()),p&&(f.classList.add(...u.classList),u.remove()),1===l.length)r.replaceWith(f);else{var b=x(l.reduce((e,t)=>{var a=+t.getAttribute("data-msgid");return a<n.messageId&&e[0].push(t),a>n.messageId&&e[1].push(t),e},[[],[]]),2),v=b[0],O=b[1];r.replaceWith(se(ca(e,v))||"",f,se(ca(e,O))||"")}return t}function la(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return Object(L.getTemplate)("sImExpiredMessagePlaceholder",{text:langNumeric(e,getLang("mail_messages_expired","raw")).replace("{count}",e),count:e,id_classes:Object(u.classNames)(t)})}function ca(e,t){if(0===t.length)return"";var n=+t[0].getAttribute("data-peer"),a=+t[0].getAttribute("data-msgid"),r=Object(s.getMessage)(e,n,a);return Object(L.getTemplate)("im_mess_stack",Object.assign(da(e,r),{messages:t.reduce((e,t)=>e+t.outerHTML,"")}))}function da(e,t){var n=Object(j.unpackStore)(e),a=t.peerId,r=t.messageId,i=Object(s.getTab)(e,a),l=Object(o.getUserId)(t),c=Object(o.getAdminId)(e,t),g=Object(T.oCacheGet)(n,c?-n.gid:l)||i,m=Object(d.isChatPeer)(a)?g.name:g.first_name,_=g.link||i.href,p=Object(d.isChatPeer)(a)&&g.image_status?g.image_status:"",h=Object(L.getTemplate)("im_mess_stack_name",{name:m+p,link:_,class:Object(o.isMoney)(t)?" im-mess-stack--lnk-money-transfer":""});if(Object(o.isGift)(t)&&(h+=Object(L.getTemplate)("sImGiftLabel",{content:langSex(g.sex||0,getLang("mail_gift_message_sent","raw"))})),Object(o.isMoney)(t)){var f=Object(o.isMoneyRequest)(t)?getLang("mail_money_request_message_sent","raw"):getLang("mail_money_tranfer_message_sent","raw");h+=Object(L.getTemplate)("sImMoneyTransferLabel",{content:langSex(g.sex||0,f)})}var b=function(e,t){var n=Object(j.unpackStore)(e),a=t.peerId,r=t.messageId,i=Object(d.isChatPeer)(a)&&Object(s.isCasperChat)(n,a),l=Object(o.getAdminId)(e,t),c=Object(s.isCommunityInterface)(e)?"/gim"+n.gid:"/im",g=i?"":Object(L.getTemplate)("im_stack_date",{date:(m=t.date,_=n.timeshift,langDate(1e3*m,"{hour}:{minute} {am_pm}",1e3*_,[],!0)),link:`${c}?sel=${a}&msgid=${r}`});var m,_;if(l&&n.admins[l]){var p=n.admins[l],h=l===vk.id?getLang("mail_by_you"):p[0];g+=" "+Object(L.getTemplate)("im_admin_link",{name:h,href:p[1]})}return g+function(e,t){if(!Object(o.isCasperMessage)(t))return"";var n=x(M.casperMessagesStore.getTimings(t.messageId),3),a=n[0],r=n[1],i=n[2],l=Math.max(a+r-i,0);return Object(L.getTemplate)("sImBomb",{classnames:Object(u.classNames)({"im-mess-stack--bomb_hidden":Object(s.isCasperChat)(e,t.peerId),"im-mess-stack--bomb_expiring":l<=M.EXPIRING_TIME,"im-mess-stack--bomb_expiring-soon":l<=M.EXPIRING_SOON_TIME})})}(n,t)}(e,t);return{photo:g.photo,href:_,cls:"",date_attr:"",link:`/im?sel=${a}&msgid=${r}`,name:stripHTML(h),stack_name:h,peerId:l,messageMeta:b,admin:c}}function ua(e,t){var n=`._im_replied_message[data-msgid="${t.messageId}"] .im-replied--text`;Array.from(e.querySelectorAll(n)).forEach(e=>{e.innerHTML=Object(L.getTemplate)("im_dialog_media",{name:getLang("mail_expired_message")})})}function ga(e){return Object(d.isChatPeer)(e.peerId)&&e.membersCount?langNumeric(e.membersCount,getLang("mail_im_n_chat_members","raw")):""}var ma=E.CallStatSource.CONVO_SNIPPET,_a=E.CallStatSource.CONVO_HEADER,pa=E.CallStatSource.CONVO_LIST,ha=E.CallStatSource.CONVO_JOIN_SNIPPET,fa=E.CallStatSource.CONVO_JOIN_HEADER,ba=E.CallStatSource.CONVO_JOIN_BANNER;function va(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],a=arguments.length>3?arguments[3]:void 0,r=arguments.length>4?arguments[4]:void 0;if(window.Calls&&window.Calls.call){if(!t)return void window.Calls.startCall(n,r);var i=Object(d.isChatPeer)(t);if(i){var o=Object(s.getTab)(e,t),l=R({},o,{canAddMembers:Object(w.canInviteUser)(e,t,void 0)});window.Calls.startGroupCall(t,[l],a,n,r)}else{var c=Object(T.oCacheGet)(e,t),u=R({},c,{canAddMembers:!0});window.Calls.call(t,n,[u,[c]],r)}}}function Oa(e){var t=decodeURIComponent(e.target.getAttribute("href")).match(/^\/away\.php\?to=(.+)&(.+)?$/),n=t&&t[1];if(n&&window.Calls&&window.Calls.showJoinPopup)return cancelEvent(e),window.Calls.showJoinPopup(n,E.CallStatSource.LINK_JOIN_SNIPPET)}function ya(e,t){var n=Object(s.getTab)(e,t);return!Object(s.isCommunityInterface)(e)&&!!n.can_start_call}function Ca(e,t,n){var a=arguments.length>3&&void 0!==arguments[3]&&arguments[3],r=arguments.length>4?arguments[4]:void 0;if(window.Calls&&window.Calls.call){var i=Object(s.getTab)(e,t);if(!Object(s.isChatActive)(i))return;window.Calls.joinCallByLink(t,n,[i],a,r)}}function Ea(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0,n=t?"&msgid="+t:"";return`/im?sel=${it(e)}${n}`}},PU8N:function(e,t,n){"use strict";n.r(t),n.d(t,"isMvk",(function(){return r})),n.d(t,"getVideoDuration",(function(){return i})),n.d(t,"getMediaBlob",(function(){return s})),n.d(t,"getBlobType",(function(){return o})),n.d(t,"noop",(function(){return l})),n.d(t,"getAverageRGB",(function(){return c})),n.d(t,"loadImage",(function(){return d})),n.d(t,"loadImages",(function(){return u})),n.d(t,"loadFontFace",(function(){return g})),n.d(t,"loadFontFacePromise",(function(){return m})),n.d(t,"getCroppedImage",(function(){return _}));var a=function(){return(a=Object.assign||function(e){for(var t,n=1,a=arguments.length;n<a;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)};function r(){return!!window.isMVK}function i(e){return void 0===e&&(e=""),new Promise((function(t,n){var a=document.createElement("video");a.addEventListener("loadedmetadata",(function(){return t(a.duration)}),{once:!0}),a.addEventListener("error",n,{once:!0}),a.crossOrigin="anonymous",a.preload="metadata",a.src=e}))}function s(e){return new Promise((function(t,n){var a=new XMLHttpRequest;a.open("GET",e,!0),a.responseType="blob",a.onload=function(){if(404===a.response.status)return n();t(a.response)},a.onerror=n,a.send()}))}function o(e){try{return e.type.split("/").splice(-1)[0]}catch(e){return null}}var l=function(){};function c(e){var t,n={r:0,g:0,b:0};try{t=e.getImageData(0,0,e.canvas.width,e.canvas.height)}catch(e){return n}for(var a=-4,r=0;(a+=20)<t.data.length;)++r,n.r+=t.data[a],n.g+=t.data[a+1],n.b+=t.data[a+2];return n.r=~~(n.r/r),n.g=~~(n.g/r),n.b=~~(n.b/r),n}function d(e){return new Promise((function(t,n){var a=new Image;a.crossOrigin=e.startsWith("data:")?null:"Anonymous",a.onerror=function(){return n(new Error("Failed to load image's URL: "+e))},a.onload=function(){return t(a)},a.src=e}))}var u=function(e){return new Promise((function(t){var n=e.map((function(e){return d(e)}));Promise.all(n).then((function(e){return t(e)})).catch((function(){}))}))};function g(e,t){var n,a,r,i,s,o,l,c,d={normal:"400",500:"500",600:"600",bold:"700"},u={tolerance:2,delay:100,glyphs:"",success:function(){},error:function(){},timeout:5e3,weight:"400",style:"normal"},g={display:"block","font-size":"48px","line-height":"normal","font-variant":"normal","white-space":"nowrap",position:"absolute",visibility:"hidden",top:"-9999px",left:"-9999px",width:"auto",height:"auto",margin:"0",padding:"0"};function m(e){var t=[];return each(e,(function(e,n){t.push(e+":"+n)})),t.join(";")}function _(e,t,n){return Math.abs(e.width-t.offsetWidth)>n||Math.abs(e.height-t.offsetHeight)>n}function p(){i||(utilsNode.appendChild(s),i=!0,r={sansSerif:{width:l.offsetWidth,height:l.offsetHeight},serif:{width:o.offsetWidth,height:o.offsetHeight}},browser.opera&&!browser.chrome?(l.style.fontFamily='"'+e+'", sans-serif',o.style.fontFamily='"'+e+'", serif'):(setStyle(l,"font-family",'"'+e+'", sans-serif'),setStyle(o,"font-family",'"'+e+'", serif'))),i&&r&&(_(r.sansSerif,l,t.tolerance)||_(r.serif,o,t.tolerance))?(re(s),t.success()):(new Date).getTime()-a.getTime()>t.timeout?(re(s),t.error()):!i&&"requestAnimationFrame"in window?window.requestAnimationFrame(p):window.setTimeout(p,t.delay)}for(var h in u)t.hasOwnProperty(h)||(t[h]=u[h]);g["font-weight"]=t.weight,g["font-style"]=t.style,!t.glyphs&&"fonts"in document?(t.timeout&&(n=setTimeout((function(){t.error()}),t.timeout)),function(n){each(null===document||void 0===document?void 0:document.fonts,(function(a){a.family.toLowerCase()===e.toLowerCase()&&(d[a.weight]||a.weight)===""+t.weight&&a.style===t.style&&a.load().then((function(){t.success(),clearTimeout(n)}))}))}(n)):(c="AxmTYklsjo190QW"+t.glyphs,a=new Date,s=ce("div"),l=ce("div",{innerHTML:c}),o=ce("div",{innerHTML:c}),l.setAttribute("style",m(extend({"font-family":"sans-serif"},g))),o.setAttribute("style",m(extend({"font-family":"serif"},g))),s.appendChild(l),s.appendChild(o),p())}function m(e,t){return new Promise((function(n,r){g(e,a(a({},t),{glyphs:"",success:function(){var e=function(){n(),(null==t?void 0:t.success)&&t.success()};browser.safari?setTimeout(e,150):e()},error:function(){r(),(null==t?void 0:t.error)&&t.error()}}))}))}function _(e,t,n,a,r){return new Promise((function(i,s){("string"==typeof e?d(e):Promise.resolve(e)).then((function(e){var o=document.createElement("canvas");o.width=e.width,o.height=e.height;var l=o.getContext("2d");if(l){l.drawImage(e,0,0);var c=l.getImageData(t,n,a,r),u=document.createElement("canvas");u.width=a,u.height=r;var g=u.getContext("2d");if(g)return g.putImageData(c,0,0),d(u.toDataURL("image/jpeg",1)).then(i).catch(s);i(e)}else i(e)})).catch(s)}))}},PjZB:function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return i}));n("rGqo"),n("a1Th"),n("Btvt");var a=n("q1tI"),r=(n("17x9"),n("ZxpX"));class i extends a.Component{constructor(e){super(e),this.id=Math.round(1e6*Math.random()).toString(16),this.setSpinnerParams(e)}componentWillReceiveProps(e){this.setSpinnerParams(e)}setSpinnerParams(e){this.offset=Math.round(Math.PI*e.size),this.c=.5*e.size,this.animation=function(e,t){if(!e||!t)return"";var n=Object.keys(t).map(e=>e+" {"+Object.keys(t[e]).map(n=>n+":"+t[e][n]).join(";")+"}").join("");return`@-webkit-keyframes ${e} {${n}} @keyframes ${e} {${n}}`}("dash"+this.id,{"0%":{"stroke-dashoffset":this.offset},"50%":{"stroke-dashoffset":Math.round(.25*this.offset),transform:"rotate(135deg)"},"100%":{"stroke-dashoffset":this.offset,transform:"rotate(360deg)"}})}render(){var e=this.props,t=e.style,n=e.color,i=e.size,s=e.duration,o=e.strokeWidth,l=e.className,c=this.id,d=this.offset,u=this.animation,g=Object(r.classNames)("Spinner",l);return a.createElement("div",{className:g,style:t},a.createElement("svg",{className:"Spinner__svg",width:i,height:i,viewBox:`0 0 ${i} ${i}`,xmlns:"http://www.w3.org/2000/svg"},a.createElement("g",{style:{width:i,height:i,transformOrigin:.5*i+"px "+.5*i+"px"}},a.createElement("style",{dangerouslySetInnerHTML:{__html:u}}),a.createElement("circle",{className:"Spinner__path",fill:"none",stroke:n,strokeDasharray:d,strokeDashoffset:d,strokeWidth:o,style:{animationName:"dash"+c,animationTimingFunction:"ease-in-out",animationDuration:s+"s",animationIterationCount:"infinite"},cx:.5*i,cy:.5*i,r:.5*i-.5*o}))))}}i.defaultProps={color:"#5181b8",size:19,strokeWidth:2,duration:1.4,className:""}},RQ7Z:function(e,t,n){"use strict";n.r(t),n.d(t,"screenfull",(function(){return a}));var a=function(){var e=function(){for(var e,t,n=[["requestFullscreen","exitFullscreen","fullscreenElement","fullscreenEnabled","fullscreenchange","fullscreenerror"],["webkitRequestFullscreen","webkitExitFullscreen","webkitFullscreenElement","webkitFullscreenEnabled","webkitfullscreenchange","webkitfullscreenerror"],["mozRequestFullScreen","mozCancelFullScreen","mozFullScreenElement","mozFullScreenEnabled","mozfullscreenchange","mozfullscreenerror"],["msRequestFullscreen","msExitFullscreen","msFullscreenElement","msFullscreenEnabled","MSFullscreenChange","MSFullscreenError"]],a=0,r=n.length,i={};a<r;a++)if((e=n[a])&&e[1]in document){for(a=0,t=e.length;a<t;a++)i[n[0][a]]=e[a];return i}return!1}(),t={request:function(t){var n=e.requestFullscreen;(t=t||document.documentElement)[n]()},exit:function(){document[e.exitFullscreen]()},toggle:function(e){this.isFullscreen?this.exit():this.request(e)},raw:e};return!!e&&(Object.defineProperties(t,{isFullscreen:{get:function(){return Boolean(document[e.fullscreenElement])}},element:{enumerable:!0,get:function(){return document[e.fullscreenElement]}},enabled:{enumerable:!0,get:function(){return Boolean(document[e.fullscreenEnabled])}}}),t)}()},RdBX:function(e,t,n){"use strict";n.r(t),n.d(t,"vkIndexer",(function(){return a}));n("Vd3H"),n("OG14"),n("a1Th"),n("Btvt"),n("KKXr"),n("Oyvg");function a(e,t,n){this.list=e,this.iterCur=0,this.iterEnd=e?e.length:0,this.index={},this.callback=n||function(){},this.prepareFunc=t||function(e){return e},setTimeout(this.indexIteration.bind(this),10)}a.prototype.delimiter=a.delimiter=new RegExp("[\\s\\-\\.,\\\"\\'\\«\\(\\)\\[\\]\\{\\}\\#\\+\\?\\\\]+","g"),a.prototype.trimmer=new RegExp("^[\\s\\-\\.,\\\"\\'\\«\\(\\)\\[\\]\\{\\}\\+\\?\\\\]+|[\\s\\-,\\\"\\'\\«\\(\\)\\[\\]\\{\\}\\\\]+$","g"),a.prototype.toTranslit={1072:"a",1073:"b",1074:"v",1075:"g",1076:"d",1077:"e",1078:"zh",1079:"z",1080:"i",1081:"y",1082:"k",1083:"l",1084:"m",1085:"n",1086:"o",1087:"p",1088:"r",1089:"s",1090:"t",1091:"u",1092:"f",1093:"h",1094:"ts",1095:"ch",1096:"sh",1097:"sh",1099:"y",1101:"e",1102:"yu",1103:"ya",1105:"e",1098:"",1100:""},a.prototype.toLocalCase={f:"a",",":"b","<":"b",d:"v",u:"g",l:"d",t:"e",";":"zh",":":"zh",p:"z",b:"i",q:"y",r:"k",k:"l",v:"m",y:"n",j:"o",g:"p",h:"r",c:"s",n:"t",e:"u",a:"f","[":"h","{":"kh",w:"ts",x:"ch",i:"sh",o:"sh",s:"y","'":"e",'"':"e",".":"yu",">":"yu",z:"ya","`":"e","~":"e",m:"","]":"","}":""},a.prototype.toLocalTranslit={1072:"f",1074:"d",1075:"u",1076:"l",1077:"t",1079:"p",1080:"b",1081:"q",1082:"r",1083:"k",1084:"v",1085:"y",1086:"j",1087:"g",1088:"h",1089:"c",1090:"n",1091:"e",1092:"a",1094:"w",1095:"x",1096:"i",1097:"o",1099:"s",1103:"z",1098:"m"},a.prototype.indexIteration=function(){for(var e=Math.min(this.iterEnd,this.iterCur+200),t=this.iterCur;t<e;t++){var n=this.list[t];try{n._order=t}catch(e){}this.add(n)}this.iterCur=t,t>=this.iterEnd?this.callback(this):setTimeout(this.indexIteration.bind(this),10)},a.prototype.strToPrefixes=function(e){for(var t={},n=winToUtf(e).toLowerCase().split(this.delimiter),a=n.length;a--;){var r=n[a],i="";if(r){for(var s=0;s<6;s++){var o=r.charCodeAt(s);if(o){var l=this.toTranslit[o],c=r.substr(s,1);i+=null!=l?l:c}}t[i]=1}}return t},a.prototype.strToSearchPrefixes=function(e){for(var t=[],n=e.toLowerCase().split(this.delimiter),a=n.length;a--;){var r={},i=n[a],s="",o="",l="",c=i.length>1;if(i){for(var d=0;d<6;d++){var u=i.charCodeAt(d);if(u){var g=this.toTranslit[u],m=i.substr(d,1);if(s+=null!=g?g:m,c){var _=this.toLocalCase[m],p=this.toLocalTranslit[u];o+=null!=_?_:m,l+=null!=p?p:m}}}r[s]=1,c&&(r[o]=2,r[l]=3),t.push(r)}}return t},a.prototype.toIndexTree=function(e,t){for(var n=this.index,a=0;a<6;a++){var r=e.substr(a,1)||-1;n=n[r]?n[r]:n[r]=5==a?[]:{}}n.push(t)},a.prototype.remove=function(e){var t=this.prepareFunc(e),n=this.strToPrefixes(t);for(var a in n)if(n.hasOwnProperty(a)){for(var r=this.index,i=0;i<6;i++){var s=a.substr(i,1)||-1;if(!r[s])break;r=r[s]}if(r.length)for(var o in r)if(this.equals(r[o],e)){r.splice(o,1);break}}},a.prototype.equals=function(e,t){for(var n in e)if(e.hasOwnProperty(n))switch(typeof e[n]){case"object":if(!this.equals(e[n],t[n]))return!1;break;case"function":if(void 0===e[n]||e[n].toString()!=t[n].toString())return!1;break;default:if(e[n]!=t[n])return!1}for(var a in t)if(void 0===t[a])return!1;return!0},a.prototype.intersect=function(e,t){var n=[];if(isNumeric(e[0])||isNumeric(t[0]))return e.filter((function(e){return-1!==t.indexOf(e)}));for(;e.length>0&&t.length>0;)e[0]._order<t[0]._order?e.shift():(e[0]._order>t[0]._order||this.equals(e[0],t[0])&&n.push(e.shift()),t.shift());return n},a.prototype.add=function(e){var t=this.prepareFunc(e),n=this.strToPrefixes(t);for(var a in n)n.hasOwnProperty(a)&&this.toIndexTree(a,e)},a.prototype.search=function(e){var t=this.index,n=this.strToSearchPrefixes(e),a=[],r=!1;for(var i in n)if(n.hasOwnProperty(i)){if(r&&!a)break;var s=this.localSearch(n[i],0,t);s.sort((function(e,t){return e._order-t._order})),a=r?this.intersect(a,s):s,r=!0}for(var o=a[0],l=a.length+1,c=[],d=1;d<l;d++){var u=a[d];u!=o&&(c.push(o),o=u)}return c},a.prototype.localSearch=function(e,t,n){if(!n)return[];var a={};for(var r in e)if(e.hasOwnProperty(r)){var i=r.substr(t,1)||-1;a[i]||(a[i]={}),a[i][r]=1}if(6==t++||!n)return n;var s=[];for(var o in a)if(-1==o)for(var l in n)n.hasOwnProperty(l)&&s.push.apply(s,this.localSearch(a[o],t,n[l]));else{var c=this.localSearch(a[o],t,n[o]);s.push.apply(s,c)}return s}},S2bU:function(e,t,n){"use strict";n.r(t),n.d(t,"replaceHyperLinks",(function(){return s})),n.d(t,"replaceEmailLinks",(function(){return o})),n.d(t,"replaceMentions",(function(){return l})),n.d(t,"replaceMassMentions",(function(){return c})),n.d(t,"replaceHashtags",(function(){return g})),n.d(t,"linksReplacer",(function(){return m}));var a,r=n("h++7"),i=n("t7n3");function s(e,t){for(var n,a=0,i=e;null!==(n=r.MESSAGE_REGEXP.exec(e));){var s=(n=d(n))[0].length,o=n.index+s,l=e[n.index-1],c=e[o-1],g=void 0!==l&&/([\w\$А-Яа-яёЁєЄҐґЇїІіЈј\—\-\_@;.])/i.test(l),m=void 0!==c&&/([:;$])/i.test(c);if(!g&&!m){var _=u(n),p=_.domain.toLowerCase();if(p.length<=r.MAX_DOMAIN_LENGTH&&r.TOP_DOMAINS.includes(p)){var h=t(_);i=i.slice(0,n.index+a)+h+i.slice(o+a),a+=h.length-s}}}return i}function o(e,t){return e.replace(r.EMAIL,t||function(e){return'<a href="mailto:'+e+'">'+e+"</a>"})}function l(e,t){return e.replace(r.MENTION,t||function(e,t,n,a,r){return'<a href="/'+(t+n)+'" class="mem_link" mention="'+Object(i.clean)(a||"")+'" mention_id="'+Object(i.clean)(t+n)+'" onclick="return mentionClick(this, event)" onmouseover="mentionOver(this)">'+r+"</a>"})}function c(e,t){return e.replace(r.RE_MASSMENTION,(function(e){return t?t(e,"","",e,e):'<span class="mem_pseudolink" data-mention="'+e.slice(1).toLowerCase()+'">'+e+"</span>"}))}function d(e){if(!e[0]||!e[6])return e;var t=e[0].length-1,n=e[6].length-1;return"."===e[0][t]&&"."===e[6][n]&&(e[0]=e[0].slice(0,t),e[6]=e[6].slice(0,n)),e}function u(e){return{full:e[0],protocol:e[1]||"http://",url:e[2],domain:e[4],query:e[6]||""}}function g(e,t){return e.replace((a||(a=new RegExp(r.RE_HASHTAG_EXTRACTION_PATTERN,"ig")),a),(function(e,n,a,r,i){return(n||"")+t(a+(i||""))}))}function m(e,t){var n=t.url,a=t.full,s=t.protocol,o=t.query;try{a=decodeURIComponent(a)}catch(e){}if(a.length>55&&(a=a.substr(0,53)+".."),a=Object(i.clean)(a).replace(/&amp;/g,"&"),!e&&n.match(r.OUR_DOMAINS)){var l=n=Object(i.replaceEntities)(n).replace(r.ENTITIES,encodeURIComponent),c=n.indexOf("#/"),d="";c>=0?l=n.substr(c+1):(c=n.indexOf("#!"))>=0&&(l="/"+n.substr(c+2).replace(/^\//,""));var u=l.match(r.VK_DOMAIN);return u&&u[1].length<32&&(d=' mention_id="'+u[1]+'" onclick="return mentionClick(this, event)" onmouseover="mentionOver(this)"'),'<a href="'+function(e){return e.replace(/"/g,"&quot;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}(s+n+o)+'" target="_blank" rel="noopener"'+d+">"+a+"</a>"}var g=Object(i.replaceEntities)(n+o).toString();return'<a href="'+("away.php?utf=1&to="+encodeURIComponent(s+g))+'" target="_blank" rel="noopener" onclick="'+("return goAway('"+Object(i.clean)((s+n+o).replace(/'/g,"\\'"))+"', {}, event);")+'">'+a+"</a>"}},Syd7:function(e,t,n){"use strict";n.r(t),n.d(t,"getPeerProfileHeight",(function(){return X})),n.d(t,"mount",(function(){return Z}));var a=n("q1tI"),r=n("i8i4"),i=n("rHUl"),s=n("P13b"),o=(n("91GP"),n("17x9"),n("ZxpX")),l=n("ErRf"),c=n("nAFc"),d=n("ERyv"),u=n("4+be"),g=n("6krn"),m=n("754W"),_=n("6aSF"),p=n("dt/K"),h=n("vT4u"),f=n("EasH"),b=g.default.getLang;class v extends a.Component{constructor(){super(...arguments),this.onAdTagAlertClick=()=>{Object(f.showFastBox)(b("mail_ad_tag_no_access_box_title"),b("mail_ad_tag_no_access_box_text"))}}render(){var e=this.props.data;if(e.adId){var t=`ads?act=office&union_id=${e.adId}&utm_medium=community_messages_ad_tag&utm_source=dialog`,n="";n=e.isEasyPromotedMarket?b("mail_ad_tag_easy_promoted_market"):e.hasAdAccess?`${b("mail_ad_tag_text_prefix")} ${e.adId}`:b("mail_ad_tag_no_access_text");var r=a.createElement("span",{className:"PeerProfileTagsListItem__adTagText"},n);return a.createElement("div",{className:"PeerProfileTagsListItem PeerProfileTagsListItem--adTag"},e.hasAdAccess&&a.createElement("a",{className:"PeerProfileTagsListItem__adTagLink",href:t,target:"_blank"},r),!e.hasAdAccess&&a.createElement("button",{className:"PeerProfileTagsListItem__adTagAlert",onClick:this.onAdTagAlertClick},r))}return a.createElement("div",{className:"PeerProfileTagsListItem",style:{backgroundColor:e.color}},a.createElement("span",null,Object(c.decodeHTMLEntities)(e.name)))}}var O=v,y=g.default.getLang;class C extends a.Component{constructor(e){super(e),this.onExtraClick=()=>{this.setState({isTagsCollapsed:!1})},this.state={isTagsCollapsed:!0}}render(){var e=this.props,t=e.peerTags,n=e.tags,r=e.isPeerProfileCollapsed,i=e.adId,s=e.hasAdAccess,o=e.isEasyPromotedMarket,l=e.toggleProfile,c=n.filter(e=>t.includes(e.id));i&&c.unshift({adId:i,hasAdAccess:s,isEasyPromotedMarket:o});var d=0;r&&this.state.isTagsCollapsed&&c.length>5&&(d=c.splice(5).length);return c=c.map((e,t)=>a.createElement(O,{key:t,data:e})),a.createElement("div",{className:"PeerProfileTagsList"},c.length>0&&c,d>0&&a.createElement("div",{className:"PeerProfileTagsListItem PeerProfileTagsListItem--extra",onClick:this.onExtraClick},"+ "+y("mail_im_peer_profile_extra_tags",d)),!c.length&&a.createElement("div",{className:"PeerProfileTagsListItem--empty"},y("mail_im_peer_profile_tags_empty")," ",a.createElement("span",{className:"PeerProfileTagsList__linkDivider"},"·")," ",a.createElement(m.default,{className:"PeerProfileTagsList__toggleProfileLink",onClick:l},y(r?"mail_im_peer_profile_toggle_tags_on":"mail_im_peer_profile_toggle_tags_off"))))}}var E=C,j=n("0Rlc");var T=function(e){var t=e.data,n=e.onCheckboxChange;return a.createElement("div",{className:"PeerProfileTagsGridItem",onClick:e=>{e&&e.preventDefault(),n(t.id,!t.isChecked)}},a.createElement(j.default,{className:"PeerProfileTagsGridItem__checkbox",checked:t.isChecked,onChange:(e,a)=>n(t.id,a)},a.createElement("span",{className:"PeerProfileTagsGridItem__color",style:{backgroundColor:t.color}}),a.createElement("span",{className:"PeerProfileTagsGridItem__name",title:t.name},Object(c.decodeHTMLEntities)(t.name))))};class S extends a.Component{constructor(){super(...arguments),this.onCheckboxChange=(e,t)=>{this.props.onPeerTagsChange(e,t)}}render(){var e=this.props.tags;return a.createElement("div",{className:"PeerProfileTagsGrid"},e.map((e,t)=>a.createElement(T,{key:t,data:e,onCheckboxChange:this.onCheckboxChange})))}}var I=S,A=n("r7nW"),w=n("Ht+d"),L=n("6raB"),k=n("0toi"),M=g.default.getLang;class N extends a.Component{constructor(e){super(e),this.onKeyDown=e=>"Enter"!==e.key||(e.preventDefault(),!1),this.inputRef=a.createRef()}componentDidMount(){this.props.data.id||this.inputRef.current.focus()}render(){var e=this.props,t=e.index,n=e.data,r=e.onNameChange,i=e.onRemove;return a.createElement("div",{className:"PeerProfileTagsModalField"},a.createElement("input",{type:"hidden",value:n.id?n.id:""}),a.createElement("input",{type:"text",className:"PeerProfileTagsModalField__input",value:Object(c.decodeHTMLEntities)(n.name),ref:this.inputRef,onChange:e=>r(e,t),onKeyDown:this.onKeyDown,maxLength:20,placeholder:M("mail_im_peer_profile_manage_tags_placeholder")}),a.createElement("span",{className:"PeerProfileTagsModalField__color",style:{backgroundColor:n.color}}),a.createElement(p.default,{position:"t",text:M("mail_im_peer_profile_manage_tags_remove")},a.createElement("span",{className:"PeerProfileTagsModalField__remove",onClick:()=>i(t)})))}}var P=N;function D(){return(D=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e}).apply(this,arguments)}var R=g.default.getLang,x=["#4bb34b","#5c9ce6","#e64646","#792ec0","#63b9ba","#ffa000","#ffc107","#76787a","#9e8d6b","#45678f","#539b9c","#454647","#7a6c4f","#6bc76b","#5181b8","#ff5c5c","#a162de","#7ececf","#aaaeb3","#bbaa84"],B=x[0];class H extends a.Component{constructor(e){var t;super(e),t=this,this.generateEmptyTag=()=>({name:"",color:this.state&&this.state.tags.length?this.getAvailableColor():B,state:"new"}),this.getAvailableColor=()=>{var e=[...this.state.tags].reduce((e,t)=>("deleted"!==t.state&&(e[t.color]=!0),e),{});return x.find(t=>!e[t])},this.onAddLinkClick=e=>{e&&e.preventDefault(),this.state.tags.filter(e=>"deleted"!==e.state).length>=20||this.setState(e=>({tags:[...e.tags,this.generateEmptyTag()]}),()=>{this.inputsRef.current.scrollIntoView({block:"end"})})},this.onNameChange=(e,t)=>{var n=e.target.value;this.setState({tags:this.state.tags.map((e,a)=>a===t?D({},e,{name:n,state:e.state||"changed"}):e)})},this.onRemove=function(e){var n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],a=t.state.tags,r=a[e];!n&&r.id&&r.uses>0?t.setState({isConfirmationModalOpen:!0,indexToRemove:e}):t.setState({tags:t.state.tags.filter((t,n)=>n!==e),deletedTags:[...t.state.deletedTags,D({},r,{state:"deleted"})]})},this.onSubmit=e=>{e&&e.preventDefault();var t=[...this.state.tags,...this.state.deletedTags].reduce((e,t)=>(t.name.trim()&&t.state&&e.push({id:t.id,name:t.name,color:t.color,state:t.state}),e),[]);this.setState({isLoading:!0}),this.props.onSave(t)},this.toggleConfirmationModal=(e,t)=>{e&&e.preventDefault(),this.setState({isConfirmationModalOpen:t})},this.state={tags:e.tags.length?e.tags.map(e=>D({},e)):[this.generateEmptyTag()],deletedTags:[],isLoading:!1,isConfirmationModalOpen:!1,indexToRemove:null},this.inputsRef=a.createRef()}render(){var e=this.state,t=e.tags,n=e.isConfirmationModalOpen,r=t[e.indexToRemove],i=Object(o.classNames)("PeerProfileTagsModal",{"PeerProfileTagsModal--hidden":n});return a.createElement(a.Fragment,null,a.createElement(A.default,{onClose:this.props.onClose,className:i,disableBackdropClick:!0,disableEscapeClose:!0},a.createElement("form",{onSubmit:this.onSubmit},a.createElement(k.default.Header,{title:R("mail_im_peer_profile_manage_tags_box_title"),onClose:this.props.onClose,appearance:"blue"}),a.createElement(k.default.Body,null,a.createElement(_.default,{className:"PeerProfileTagsModal__scroll",neverHide:!0},a.createElement("div",{className:"PeerProfileTagsModal__tagsInputs",ref:this.inputsRef},this.state.tags.map((e,t)=>a.createElement(P,{index:t,key:t,data:e,onNameChange:this.onNameChange,onRemove:this.onRemove})),this.state.tags.length<20?a.createElement(m.default,{className:"PeerProfileTagsModal__addLink",onClick:this.onAddLinkClick},R("mail_im_peer_profile_manage_tags_add_link")):""))),a.createElement(k.default.Footer,{actionButtons:[a.createElement(w.default,{key:"cancel",appearance:"tertiary",onClick:this.props.onClose},R("global_cancel")),a.createElement(L.default,{key:"save",onClick:this.onSubmit,loading:this.state.isLoading},R("global_save"))]}))),n&&a.createElement(k.default,{title:R("global_warning"),appearance:"blue",actionButtons:[a.createElement(w.default,{key:"cancel",appearance:"tertiary",onClick:e=>this.toggleConfirmationModal(e,!1)},R("global_cancel")),a.createElement(w.default,{key:"delete",onClick:e=>{this.toggleConfirmationModal(e,!1),this.onRemove(this.state.indexToRemove,!0)}},R("global_delete"))],onClose:e=>this.toggleConfirmationModal(e,!1),className:"PeerProfileConfirmationModal"},Object(u.langStr)(1===r.uses?R("mail_im_peer_profile_tag_delete_confirmation_text_single"):R("mail_im_peer_profile_tag_delete_confirmation_text",r.uses,!0),"tag_name",Object(c.decodeHTMLEntities)(r.name))))}}var F=H,U=n("MV/q"),G=g.default.getLang;class q extends a.Component{constructor(e){var t;super(e),t=this,this.onChange=e=>{var t=e.target.value;this.setState({note:t})},this.onSubmit=function(e){var n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];e&&e.preventDefault();var a=t.state.note&&t.state.note.trim();n||a?(t.setState({isLoading:!0}),t.props.onNoteSave(a)):t.setState({note:""})},this.toggleConfirmationModal=(e,t)=>{e&&e.preventDefault(),this.setState({isConfirmationModalOpen:t})},this.state={note:e.note||"",isLoading:!1,isConfirmationBoxOpen:!1,isConfirmationModalOpen:!1},this.inputRef=a.createRef()}componentDidMount(){this.inputRef.current.element.focus()}render(){var e=Object(o.classNames)("PeerProfileNoteModal",{"PeerProfileNoteModal--hidden":this.state.isConfirmationModalOpen}),t=[...this.props.note?[a.createElement(w.default,{key:"delete",appearance:"link",onClick:e=>this.toggleConfirmationModal(e,!0),className:"PeerProfileNoteModal__deleteButton"},G("mail_im_peer_profile_note_delete_link"))]:[],a.createElement(w.default,{key:"cancel",appearance:"tertiary",onClick:this.props.onClose},G("global_cancel")),a.createElement(L.default,{key:"save",onClick:this.onSubmit,loading:this.state.isLoading},G("global_save"))];return a.createElement(a.Fragment,null,a.createElement(A.default,{onClose:this.props.onClose,className:e,disableBackdropClick:!0,disableEscapeClose:!0},a.createElement("form",{onSubmit:this.onSubmit},a.createElement(k.default.Header,{title:G("mail_im_peer_profile_note_box_title"),onClose:this.props.onClose,appearance:"blue"}),a.createElement(k.default.Body,null,a.createElement(U.default,{className:"PeerProfileNoteModal__input",value:Object(c.decodeHTMLEntities)(this.state.note),placeholder:G("mail_im_peer_profile_note_box_placeholder"),onChange:this.onChange,style:{height:21},maxLength:96,ref:this.inputRef})),a.createElement(k.default.Footer,{actionButtons:t}))),this.state.isConfirmationModalOpen&&a.createElement(k.default,{title:G("global_warning"),appearance:"blue",actionButtons:[a.createElement(w.default,{key:"cancel",appearance:"tertiary",onClick:e=>this.toggleConfirmationModal(e,!1)},G("global_cancel")),a.createElement(w.default,{key:"delete",onClick:e=>{this.toggleConfirmationModal(e,!1),this.setState({note:""},()=>this.onSubmit(null,!0))}},G("global_delete"))],onClose:e=>this.toggleConfirmationModal(e,!1),className:"PeerProfileConfirmationModal"},G("mail_im_peer_profile_note_delete_confirmation_text")))}}var V=q;function W(){return(W=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e}).apply(this,arguments)}var K=g.default.getLang;class Y extends a.PureComponent{constructor(e){super(e),this.toggleProfile=()=>{this.setState({isCollapsed:!this.state.isCollapsed})},this.onPeerTagsChange=(e,t)=>{var n=this.props.store,a=n.get().peer;this.setState(n=>({peerTags:t?[].concat(n.peerTags,e):n.peerTags.filter(t=>t!==e)}),()=>{n.set(h.peerProfileToggleTag.bind(null,e,t,t?"bind":"unbind",a,[...this.state.peerTags])).catch(e=>Object(d.imWeirdCatch)("PeerProfile.toggleTag",e))})},this.onSave=e=>{this.setState({tags:e},()=>{this.props.store.set(h.peerProfileManageTags.bind(null,[...this.state.tags])).then(e=>{var t=e.get().peer_profile_tags;this.setState({isCollapsed:0===t.length,tags:t,isTagsModalOpened:!1}),showDoneBox(K("mail_im_peer_profile_manage_tags_success"),{out:1e3})}).catch(e=>Object(d.imWeirdCatch)("PeerProfile.manageTags",e))})},this.onNoteSave=e=>{var t=this.props.store,n=t.get().peer;t.set(h.peerProfileSaveNote.bind(null,n,e)).then(()=>{this.setState({note:e,isNoteModalOpened:!1}),showDoneBox(K(e?"mail_im_peer_profile_save_note_success":"mail_im_peer_profile_delete_note_success"),{out:1e3})}).catch(e=>Object(d.imWeirdCatch)("PeerProfile.saveNote",e))},this.toggleModal=(e,t,n)=>{switch(e&&e.preventDefault(),n){case"tags":this.setState({isTagsModalOpened:t});break;case"note":this.setState({isNoteModalOpened:t})}t&&Object(l.cancelStackPush)("peer_profile_modal",()=>{Object(l.cancelStackFilter)("peer_profile_modal"),this.toggleModal(null,!1,n)})};var t=e.store.get(),n=t.peer,a=Object(i.getTab)(t,n),r=a.peer_profile_info||{};this.state={isCollapsed:!0,tags:t.peer_profile_tags||[],peerTags:a.peer_tags||[],note:r.note,isTagsModalOpened:!1,isNoteModalOpened:!1}}render(){var e=this.props.store.get(),t=Object(i.getTab)(e,e.peer),n=this.state,r=n.isCollapsed,s=n.tags,l=n.peerTags,d=n.note,g=n.isTagsModalOpened,h=n.isNoteModalOpened,f=s.length>0,b=f?s.reduce((e,t)=>(e[t.id]=!0,e),{}):[],v=l.filter(e=>b[e]),O=t.peer_profile_info,y=O&&(O.city||O.age),C=Object(o.classNames)("PeerProfile__wrapper",{"PeerProfile__wrapper--collapsed":r});return a.createElement("div",{className:C},a.createElement(_.default,{className:"PeerProfile__scroll",neverHide:!0},a.createElement("dl",{className:"PeerProfile__container"},a.createElement("dt",{className:"PeerProfile__label"},K("mail_im_peer_profile_tags_label_text")),a.createElement("dd",{className:"PeerProfile__content PeerProfile__tags"},r&&!f&&!t.ad_id&&a.createElement(m.default,{className:"PeerProfile__manageTagsLink",onClick:e=>this.toggleModal(e,!0,"tags")},K("mail_im_peer_profile_manage_tags")),(f||t.ad_id)&&a.createElement(E,{tags:s,peerTags:v,isPeerProfileCollapsed:r,adId:t.ad_id,hasAdAccess:t.has_ad_access,isEasyPromotedMarket:t.is_easy_promoted_market,toggleProfile:this.toggleProfile}),!r&&a.createElement(I,{tags:[...s].map(e=>W({},e,{isChecked:l.includes(e.id)})),onPeerTagsChange:this.onPeerTagsChange}),!r&&a.createElement(m.default,{className:"PeerProfile__manageTagsLink",onClick:e=>this.toggleModal(e,!0,"tags")},K("mail_im_peer_profile_manage_tags")),g&&a.createElement(F,{tags:s,onSave:this.onSave,onClose:e=>this.toggleModal(e,!1,"tags")})),a.createElement("dt",{className:"PeerProfile__label"},K("mail_im_peer_profile_info_label_text")),a.createElement("dd",{className:"PeerProfile__content PeerProfile__info"},y&&a.createElement(a.Fragment,null,O.city&&a.createElement("span",{className:"PeerProfile__infoItem"},Object(c.decodeHTMLEntities)(O.city)),O.age&&a.createElement("span",{className:"PeerProfile__infoItem"},Object(c.decodeHTMLEntities)(O.age)),O.likes_cnt&&a.createElement(p.default,{className:"PeerProfile__infoTooltip",position:"t",text:K("mail_peer_profile_likes_replies_tooltip"),appearance:"light"},a.createElement("span",{className:"PeerProfile__infoItem"},O.likes_cnt&&a.createElement("span",{className:"PeerProfile__infoItem"},Object(c.decodeHTMLEntities)(O.likes_cnt)),O.replies_cnt&&a.createElement("span",{className:"PeerProfile__infoItem"},Object(c.decodeHTMLEntities)(O.replies_cnt))))),!y&&a.createElement("span",null,K("mail_im_peer_profile_info_empty"))),e.is_peer_profile_note_enabled&&a.createElement(a.Fragment,null,a.createElement("dt",{className:"PeerProfile__label"},K("mail_im_peer_profile_note_label_text")),a.createElement("dd",{className:"PeerProfile__content PeerProfile__note"},!d&&a.createElement(m.default,{onClick:e=>this.toggleModal(e,!0,"note")},K("mail_im_peer_profile_note_add_link")),!!d&&a.createElement(a.Fragment,null,a.createElement("span",{className:"PeerProfile__noteText"},Object(c.decodeHTMLEntities)(d)),a.createElement("span",{className:"PeerProfile__noteDivider"}," · "),a.createElement(m.default,{onClick:e=>this.toggleModal(e,!0,"note")},K("mail_im_peer_profile_note_edit_link"))),h&&a.createElement(V,{note:d,onNoteSave:this.onNoteSave,onClose:e=>this.toggleModal(e,!1,"note")}))),a.createElement("dt",{className:"PeerProfile__label"},K("mail_im_peer_profile_join_date_label_text")),a.createElement("dd",{className:"PeerProfile__content"},O&&O.join_date?Object(c.decodeHTMLEntities)(O.join_date):Object(u.langSex)(t.sex,K("mail_im_peer_profile_join_date_empty_text","raw"))))),(f||t.ad_id)&&a.createElement("button",{className:"PeerProfile__toggler",onClick:this.toggleProfile}))}}var $=Y;function z(){return document.querySelector("#PeerProfile")}function X(){var e=z();return e?e.offsetHeight:0}function Q(e,t){if(t){var n=parseInt(getStyle(e,"padding-top"));e.style.paddingTop=n+X()+"px"}else e.style.removeProperty("padding-top")}function Z(e){return{render(t){var n=t.get(),o=z(),l=n.peer,c=Object(i.getTab)(n,l);n.is_peer_profile_enabled&&o&&Object(s.isFullyLoadedTab)(n,l)&&!Object(i.isChannelPeer)(c)&&!Object(i.isCommunityChat)(t,l)&&(o.innerHTML&&r.unmountComponentAtNode(o),r.render(a.createElement($,{store:t}),o,()=>{Q(e,!0)}))},destroy(){var t=z();t&&(r.unmountComponentAtNode(t),Q(e,!1))}}}},ThPM:function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return i}));var a=n("q1tI"),r=(n("17x9"),n("ZxpX"));class i extends a.Component{render(){var e=this.props,t=e.photos,n=e.links,i=e.linkTarget,s=e.onLinkClick,o=e.className,l=Object(r.classNames)("MembersGrid","MembersGrid--"+Math.min(t.length,4),o);return a.createElement("div",{className:l},t.map((e,t)=>{var r=n&&n[t]?n[t]:void 0,o=r?"a":"span";return a.createElement(o,{key:t,href:r,target:i,onClick:e=>s(e),className:"MembersGrid__i",style:{backgroundImage:`url(${e})`}})}))}}i.defaultProps={links:[],className:""}},UlUB:function(e,t,n){"use strict";function a(e,t){var n,a,r=!1;return function i(){if(r)return n=arguments,void(a=this);e.apply(this,arguments),r=!0,setTimeout((function(){r=!1,n&&(i.apply(a,n),n=a=null)}),t)}}n.r(t),n.d(t,"throttle",(function(){return a}))},V1Nw:function(e,t,n){"use strict";function a(e,t,n){var a=0,r=e,i=[],s=!1;function o(){!i.length||a>0||s||(t(i),i=[])}return{pause:function(){a++},resume:function(){a>0&&(a--,o())},onLp:function(e,t,a){s||(r>=e?(r=t,i.push.apply(i,a),o()):n&&(s=!0,n(r).then((function(e){var t=e[1],n=e[2];r=t,s=!1,i.push.apply(i,n),o()}))))}}}n.r(t),n.d(t,"createLongpollEventsQueue",(function(){return a}))},WDXI:function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return l}));n("91GP");var a=n("q1tI"),r=n("i8i4"),i=(n("17x9"),n("ZxpX")),s=n("MV/q"),o={height:"auto"};class l extends a.Component{constructor(e){super(e),this.onChange=e=>{this.props.onChange?this.props.onChange(e):this.setState({value:e.target.value,changed:this.props.value!==this.state.value})},this.onClick=()=>{this.setState({editing:!0},()=>{this.textarea&&elfocus(this.textarea),this.props.onStartEdit&&this.props.onStartEdit()})},this.onBlur=()=>{this.state.changed||this.setState({editing:!1})},this.onSave=()=>{this.props.validate&&!this.props.validate(this.state.value)||(this.setState({editing:!1,changed:!1}),this.props.onSave&&this.props.onSave({value:this.state.value}))},this.onKeydown=e=>{this.state.editing&&(27===e.keyCode&&(this.props.onCancel&&this.props.onCancel(),this.setState({editing:!1,changed:!1,value:this.props.value}),e.preventDefault(),e.stopPropagation()),this.props.useEnter&&13===e.keyCode&&(this.onSave(),e.preventDefault(),e.stopPropagation()))},this.getRef=e=>{e&&e.element&&(this.textarea=e.element)},this.state={value:e.value,editing:!1,changed:!!e.onChange&&e.changed}}componentWillReceiveProps(e){this.setState({value:e.value,changed:e.onChange?e.changed:e.value===this.state.value})}componentDidMount(){this.el=r.findDOMNode(this),this.el.addEventListener("keydown",this.onKeydown)}componentWillUnmount(){this.el.removeEventListener("keydown",this.onKeydown)}render(){var e=this.props,t=e.className,n=e.validate,r=e.placeholder,l=this.state,c=l.editing,d=l.changed,u=l.value,g=Object(i.classNames)("EditableLabel",{"EditableLabel--editing":c,"EditableLabel--changed":d,"EditableLabel--invalid":n&&!n(u),"EditableLabel--placeholder":!u.trim()&&r},t);return a.createElement("div",{className:g},c?a.createElement(a.Fragment,null,a.createElement(s.default,{className:"EditableLabel__textarea",onChange:this.onChange,onInput:this.onChange,onPaste:this.onChange,value:u,onBlur:this.onBlur,style:Object.assign({},o,this.props.textareaStyles),rows:"1",ref:this.getRef,placeholder:r}),d&&a.createElement("button",{className:"EditableLabel__save",onClick:this.onSave})):a.createElement("div",{className:"EditableLabel__text",onClick:this.onClick},u.trim()?u:r))}}l.defaultProps={value:"",changed:!1,useEnter:!1,textareaStyles:{},placeholder:""}},Wu9C:function(e,t,n){"use strict";n.r(t),n.d(t,"isPinnedMessageVisibleInTab",(function(){return g})),n.d(t,"pinnedMessageHide",(function(){return m})),n.d(t,"pinnedMessageUnHide",(function(){return _})),n.d(t,"pinnedMessageUnpin",(function(){return p})),n.d(t,"mount",(function(){return O}));var a=n("ofcU"),r=n("vT4u"),i=n("P13b");function s(e){return{unmount(){Object(a.destroyModule)(e)}}}function o(e,t,n,r){var o=Object(a.createMutations)(s).bindMutations,l=t=>{n().messageKeyboardButtonClick(t),e.hide()};return o(Object(a.createModule)({handlers:(t,n)=>{n(e.bodyNode,"click",i.MESSAGE_KEYBOARD_BUTTON_CLASS,l)}}))}var l=n("rHUl"),c=n("aong"),d=n("uytb"),u=n("FWc3");function g(e,t){if(Object(c.unpackStore)(e).searchShown)return!1;var n=Object(l.getTab)(e,t),a=n&&Object(l.parserMessage)(n.pinned);return!!a&&n.pinHideId!=a.chat_local_id}function m(e,t,n){var a=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],r=Object(l.getTab)(e,t),i=r&&Object(l.parserMessage)(r.pinned);r&&i&&(r.pinHideId=i.chat_local_id,cur.imDb.update(d.PIN_HIDDEN_ID_OP,[r.peerId,r.pinHideId]),f(n,t,e),re(geByClass1("_im_pinned_tt")),a&&window.Notifier&&Notifier.lcSend("pin_hide",{hide:1,peer:t}),statlogsValueEvent("im_pinned_messages","hide"))}function _(e,t,n){var a=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],r=Object(l.getTab)(e,t);r&&r.pinHideId&&(delete r.pinHideId,cur.imDb.update(d.PIN_HIDDEN_ID_OP,[r.peerId,void 0]),f(n,t,e),a&&window.Notifier&&Notifier.lcSend("pin_hide",{hide:0,peer:t}),statlogsValueEvent("im_pinned_messages","show"))}function p(e,t,n){var a=f.bind(null,n,t),s=Object(i.showUnpinDialog)(()=>{s.hideProgress(),s.hide(),e.set(r.unpinMessageOptimistic.bind(null,t)).then(a).then(e=>e.set(r.unpinMessage.bind(null,t))).then(a)})}function h(e,t,n){var a=e.get().peer,r=Object(l.parserMessage)(Object(l.getTab)(e,a).pinned);if(n.target.classList.contains("_im_pin_hide"))r&&m(e,a,t);else if("A"!==n.target.tagName){var s=r&&r.messageId;s&&!Object(i.isAlreadyDeleted)(e,a,s)?Object(i.focusOnMessage)(e,t().focusOnMessage,a,s):Object(i.showPinnedBox)(e,t,a,o,n),statlogsValueEvent("im_pinned_messages","open")}}function f(e,t,n){return e().updateChatTopic(t,n),Object(r.setActions)(n.get()),e().updateActions(n),n}function b(e){Object(u.showTooltip)(e.target,{text:getLang("mail_hide_unpin_hover"),black:1,needLeft:1,shift:[8,4],forcetoup:!0,className:"_im_pinned_tt",appendEl:bodyNode})}function v(e){return{unmount(){Object(a.destroyModule)(e)}}}function O(e,t,n){var r=Object(a.createMutations)(v).bindMutations,i=h.bind(null,t,n),s=b.bind(null);return r(Object(a.createModule)({handlers:(t,n)=>{n(e,"click","_im_pinned_message",i),n(e,"mouseover","_im_pin_hide",s)}}))}},XTb9:function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return o}));n("91GP"),n("ioFf"),n("rGqo"),n("Btvt");var a=n("q1tI"),r=(n("17x9"),n("ZxpX"));function i(){return(i=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e}).apply(this,arguments)}function s(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},i=Object.keys(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}class o extends a.Component{constructor(e){super(e),this.onTransitionEnd=e=>{this.state.shown&&"opacity"===e.propertyName&&(this.timeout=setTimeout(()=>{this.setState({shown:!1}),this.props.callback()},this.props.duration))},this.state={shown:e.shown}}componentWillReceiveProps(e){!this.props.shown&&e.shown&&this.setState({shown:!0})}componentWillUnmount(){this.timeout&&clearTimeout(this.timeout)}render(){var e=this.props,t=(e.shown,e.callback,e.duration,e.className),n=e.children,o=s(e,["shown","callback","duration","className","children"]),l=Object(r.classNames)("BlinkText",{"BlinkText--shown":this.state.shown},t);return a.createElement("span",i({},o,{className:l,onTransitionEnd:this.onTransitionEnd,"aria-hidden":!0}),n)}}o.defaultProps={duration:2e3}},"Xq7/":function(e,t,n){"use strict";n.r(t),n.d(t,"ModalHeader",(function(){return s}));var a=n("q1tI"),r=n.n(a),i=n("ZxpX"),s=function(e){var t=e.title,n=e.onClose,a=e.appearance,s=void 0===a?"white":a,o=e.backText,l=e.onBack,c=Object(i.classNames)("ModalHeader","ModalHeader--"+s);return r.a.createElement("div",{className:c},o&&r.a.createElement("button",{className:"ModalHeader__back",onClick:l},o),r.a.createElement("h1",{className:"ModalHeader__title"},t),r.a.createElement("button",{className:"ModalHeader__cross",type:"button",onClick:n},"Закрыть"))}},Ya1X:function(e,t,n){"use strict";n.r(t);n("91GP"),n("ioFf"),n("rGqo"),n("Btvt");var a=n("q1tI"),r=(n("17x9"),n("ZxpX"));function i(){return(i=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e}).apply(this,arguments)}function s(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},i=Object.keys(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}t.default=e=>{var t=e.className,n=s(e,["className"]);return a.createElement("div",i({className:Object(r.classNames)("HintIcon",t)},n))}},ZO95:function(e,t,n){"use strict";n.r(t);var a,r=n("q1tI"),i=n("t7n3"),s=n("ZxpX"),o=(a=function(e,t){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}a(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),l=function(e){function t(t){var n=e.call(this,t)||this;return n.getActiveTabKey=function(){var e=n.props,t=e.active,a=e.activeRequired,i=[],s=null;return r.Children.forEach(n.props.children,(function(e){r.isValidElement(e)&&(e.key===t?s=e.key:i.push(e))})),s||("number"==typeof t&&i.length>t?i[t].key||t:a&&i.length?i[0].key||0:null)},n.onClick=function(e,t){if(t!==n.state.active){var a=n.refsStore[t],r=n.getTransform(a);n.setState({active:t,isAnimating:!0,transform:r}),n.props.onTabClick&&n.props.onTabClick(e,t)}},n.onTransitionEnd=function(e){"transform"===e.propertyName&&n.setState({isAnimating:!1})},n.storeRef=function(e,t){t&&(n.refsStore[e]=t)},n.refsStore={},n.state={isAnimating:!1,active:n.getActiveTabKey()},n}return o(t,e),t.reactifyTabs=function(e){return(Array.isArray(e)?e:Object.values(e)).map((function(e){return r.createElement("a",{key:e[0],href:e[2],onClick:function(){}},e[1]?Object(i.unclean)(e[1]):"")}))},t.prototype.componentDidUpdate=function(e){void 0!==this.props.active&&this.props.active!==e.active&&this.setState({active:this.props.active})},t.prototype.getTransform=function(e){var t=e.offsetWidth;return"translateX("+(e.offsetLeft-50+.5*t)+"px) scaleX("+t/100+")"},t.prototype.componentDidMount=function(){if(this.state.active){var e=this.refsStore[this.state.active];this.setState({transform:this.getTransform(e)})}},t.prototype.render=function(){var e=this,t={"Tabs--animating":this.state.isAnimating};return r.createElement("nav",{className:Object(s.classNames)("Tabs",this.props.className,t),style:this.props.style},r.createElement("ul",{className:"Tabs__list"},r.Children.map(this.props.children,(function(t,n){if(!r.isValidElement(t))return null;var a=t.key||n;return r.createElement("li",{className:Object(s.classNames)("Tabs__item",{"Tabs__item--active":e.state.active===a}),onClick:function(t){return e.onClick(t,a)},ref:function(t){return e.storeRef(a,t)},key:a},t)}))),this.props.aside&&r.createElement("div",{className:"Tabs__aside"},this.props.aside),r.createElement("div",{style:{transform:this.state.transform},className:"Tabs__divider",onTransitionEnd:this.onTransitionEnd}))},t.defaultProps={active:0,activeRequired:!0,aside:null,style:{},className:""},t}(r.Component);t.default=l},ZVxX:function(e,t,n){"use strict";n.r(t),n.d(t,"initFailBack",(function(){return a}));n("VRzm"),n("Btvt");function a(){var e=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia||window.MediaDevices&&window.MediaDevices.getUserMedia;e&&!navigator.mediaDevices&&(navigator.mediaDevices=navigator.mediaDevices||{}),navigator.mediaDevices&&(navigator.mediaDevices.getUserMedia||(navigator.mediaDevices.getUserMedia=function(t){return new Promise((function(n,a){e?e.call(navigator,t,n,a):a(new Error("NotSupported"))}))}),navigator.mediaDevices.enumerateDevices||(navigator.mediaDevices.enumerateDevices=function(){return new Promise((function(e,t){if(MediaStreamTrack&&MediaStreamTrack.getSources){var n={audio:"audioinput",video:"videoinput"};return MediaStreamTrack.getSources((function(t){e(t.map((function(e){return{label:e.label,kind:n[e.kind],deviceId:e.id,groupId:""}})))}))}t(new Error("NotSupported"))}))})),window.AudioContext=window.AudioContext||window.webkitAudioContext,window.AudioContext&&(window.AudioContext.prototype.createScriptProcessor=window.AudioContext.prototype.createScriptProcessor||window.AudioContext.prototype.createJavaScriptNode)}},ZoqV:function(e,t,n){"use strict";n.r(t),n.d(t,"mount",(function(){return _e}));var a=n("ofcU"),r=n("q1tI"),i=n("i8i4"),s=(n("HEwt"),n("a1Th"),n("rGqo"),n("rE2o"),n("ioFf"),n("OEbY"),n("VRzm"),n("Btvt"),n("P13b")),o=n("vT4u"),l=n("f01n"),c=n("6krn"),d=n("aong"),u=n("gqqU"),g=n("Ht+d"),m=(n("pIFo"),n("ZxpX")),_=n("dt/K"),p=n("WDXI"),h=n("Ya1X"),f=n("lJdi"),b=n("ERyv"),v=c.default.getLang;class O extends r.PureComponent{constructor(e){super(e),this.onSaveTitle=e=>{var t=this.props.store,n=t.get(),a=e.value.trim().replace("\n","");a&&a!==unclean(this.props.title)&&(this.setState({titleChanged:!1}),t.set(o.updateChatTopic.bind(null,n.peer,a)))},this.onChangeTitle=e=>{if(this.state.title!==e.target.value){var t=e.target.value.replace("\n","");this.setState({title:t,titleChanged:unclean(this.props.title)!==t})}},this.onValidateTitle=e=>!!e.trim().replace("\n",""),this.onCancelTitle=()=>{this.setState({title:unclean(this.props.title),titleChanged:!1})},this.onSaveDescription=e=>{},this.onPhotoUpload=()=>{var e=this.props.store,t=e.get().peer;Object(f.canChangeTitle)(e)&&(cur.recieveCropResult=void 0,Page.ownerPhoto(t,{gid:e.get().gid}))},this.onPhotoRemove=()=>{var e=this.props.store,t=e.get().peer;Object(f.canChangeTitle)(e)&&e.set(o.removeChatPhoto.bind(null,t)).then(()=>e.set(o.getChatDetails.bind(null,t))).catch(e=>Object(b.imWeirdCatch)("onPhotoRemove",e))},this.state={title:unclean(e.title),titleChanged:!1}}getCasperInfo(){var e=v("mail_casper_chat_info");return r.createElement(r.Fragment,null,v("mail_casper_chat_label"),r.createElement(_.default,{text:e,position:"t",appearance:"light",maxWidth:280,marginTop:-6},r.createElement(h.default,{"aria-label":e,className:"ChatSettingsInfo__casperHint"})))}render(){var e=this.props,t=e.store,n=e.photo,a=e.title,i=e.description,s=e.grid,o=e.meta,l=e.isDefaultPhotoOwner,c=void 0!==l&&l,d=e.isCasper,u=void 0!==d&&d,g=unclean(a),h=Object(f.canChangeTitle)(t),b=Object(m.classNames)("ChatSettingsInfo",{"ChatSettingsInfo--editable":h}),O=Object(m.classNames)("ChatSettingsInfo__title",{"ChatSettingsInfo__title-service":64&this.props.flags});return r.createElement("div",{className:b},r.createElement("header",{className:"ChatSettingsInfo__header"},r.createElement("div",{className:"ChatSettingsInfo__photo"},r.createElement("div",{className:"ChatSettingsInfo__attach nim-peer nim-peer_larger","data-tip":v("mail_settings_photo"),onClick:this.onPhotoUpload},n?r.createElement("img",{src:n,width:"80",height:"80",alt:g,className:"ChatSettingsInfo__photoSelf"}):r.createElement("div",{className:"nim-peer--photo-w"},r.createElement("div",{className:"ChatSettingsInfo__photoGrid nim-peer--photo",dangerouslySetInnerHTML:{__html:s}}))),n&&h&&!c&&r.createElement(_.default,{text:v("mail_settings_remove_photo"),position:"t",align:"left"},r.createElement("button",{onClick:this.onPhotoRemove,className:"ChatSettingsInfo__photoRemove"}))),r.createElement("h3",{className:O},h?r.createElement(p.default,{value:this.state.title,changed:this.state.titleChanged,useEnter:!0,onSave:this.onSaveTitle,onChange:this.onChangeTitle,onCancel:this.onCancelTitle,validate:this.onValidateTitle}):g),r.createElement("div",{className:"ChatSettingsInfo__meta"},r.createElement("span",{className:"ChatSettingsInfo__metaItem"},o),u&&r.createElement("span",{className:"ChatSettingsInfo__metaItem"},this.getCasperInfo()))),i&&r.createElement("div",{className:"ChatSettingsInfo__description"},h?r.createElement(p.default,{value:i,onSave:this.onSaveDescription}):i))}}n("KKXr");var y=n("dLHM"),C=n("XTb9"),E=n("BN/X"),j=n("giDR"),T=c.default.getLang;class S extends r.Component{constructor(e){super(e),this.onCopy=()=>{this.input&&(elfocus(this.input,0,this.input.value.length),document.execCommand("copy"),this.setState({copied:!0}))},this.onBlinkTextHide=()=>{this.setState({copied:!1})},this.getInputRef=e=>{e&&e.element&&(this.input=e.element)},this.state={copied:!1}}componentDidMount(){this.input&&elfocus(this.input,0,this.input.value.length)}render(){var e=this.props,t=e.onReset,n=e.invitationLinks,a=e.store,i=T("mail_invite_link_reset_explainer").split("{reset_link}"),o=!Object(s.isFvkcomgroup)(a,a.get().peer),l=n.linkWithHistory,c=n.linkWithoutHistory,d=this.props.isInvitationLinkWithHistory?l:c;return r.createElement("div",{className:"ChatSettingsInvitationLink"},this.props.reseted&&r.createElement("div",{className:"ChatSettingsInvitationLink__reseted"},T("mail_invite_link_reseted_explainer")),r.createElement("p",null,T("mail_invite_link_explainer")),r.createElement("div",{className:"ChatSettingsInvitationLink__switch"},r.createElement(j.default,{children:T("mail_im_chat_add_members_show_history"),checked:this.props.isInvitationLinkWithHistory,onChange:this.props.onLinkHistoryOptionToggle})),r.createElement("div",{className:"ChatSettingsInvitationLink__main"},r.createElement(y.default,{ref:this.getInputRef,readOnly:"readonly",className:"ChatSettingsInvitationLink__input",value:d}),r.createElement(g.default,{onClick:this.onCopy},T("mail_get_invite_link_copy")),r.createElement(C.default,{className:"ChatSettingsInvitationLink__copied",shown:this.state.copied,callback:this.onBlinkTextHide},T("mail_invite_link_copied"))),o&&r.createElement("p",null,i[0],r.createElement(E.default,{className:"ChatSettingsInvitationLink__reset",onClick:t},T("mail_invite_reset_link")),i[1]))}}var I=n("6raB"),A=n("hIV1"),w=c.default.getLang;class L extends r.Component{constructor(e){super(e),this.onConfirm=()=>{this.state.loading||(this.setState({loading:!0}),this.props.onConfirm().then(()=>{this.setState({loading:!1}),this.props.onCancel()}).catch(()=>this.setState({loading:!1})))},this.state={}}render(){return r.createElement("div",{className:"ChatSettingsResetInvitationLink"},r.createElement("div",{className:"ChatSettingsResetInvitationLink__text",dangerouslySetInnerHTML:{__html:w("mail_chat_reset_link_warning")}}),r.createElement(A.default,{alignment:"right"},r.createElement(g.default,{appearance:"tertiary",onClick:this.props.onCancel},w("global_cancel")),r.createElement(I.default,{onClick:this.onConfirm,loading:this.state.loading},w("mail_chat_reset_link_confirm"))))}}n("91GP");var k=n("enZq"),M=n("xGYt"),N=n("NsuH"),P=n("aFGQ"),D=n("+tmx"),R=n("/cSr"),x=n("rHUl"),B=c.default.getLang,H=()=>[{label:B("mail_settings_time_one_hour"),value:D.HOUR},{label:B("mail_settings_time_eight_hours"),value:8*D.HOUR},{label:B("mail_settings_time_day"),value:D.DAY},{label:B("mail_settings_time_week"),value:D.WEEK},{label:B("mail_settings_time_forever"),value:-1}];class F extends r.Component{constructor(e){super(e),this.onCopyInviteLink=e=>{this.input&&(this.input.focus(),this.input.select(),document.execCommand("copy"),this.setState({copied:!0})),e.preventDefault(),e.stopPropagation()},this.onBlinkTextHide=()=>{this.setState({copied:!1})},this.getHiddenInput=e=>{this.input=e},this.onDisabledSettingsChange=e=>{var t=e.selected.value,n=t>0?Math.floor((Date.now()+t)/1e3):t,a=0!==n;this.setState({push_disabled_until:n,push_disabled:a,disabledPlaceholder:this.getDisabledPlaceholder(n)},()=>{this.props.onUpdateNotificationSettings(a,Math.floor(t/1e3)).then(()=>{this.props.afterDisableUntilUpdated()})})},this.onMentionSettingsChange=e=>{var t=e.selected.value;this.setState({mentions_push_disabled:t},()=>{this.props.onUpdateMentionNotificationSettings(t).then(()=>{this.props.afterNotificationSettingsUpdated()})})},this.onShowInviteLink=()=>{Object(f.canChangeInviteLink)(this.props.store)&&this.props.showInvitationLink()};var t=this.getPushSettingsFromProps(e),n=t.push_disabled_until,a=n>0?+new Date(n):n;this.state=Object.assign({pushDisabled:n,disabledPlaceholder:this.getDisabledPlaceholder(a),copied:!1},t)}getPushSettingsFromProps(e){var t=e.store.get();return t.tabs[t.peer].notifications}getPushDisabledFromProps(e){var t=e.store.get();return t.tabs[t.peer].notifications.push_disabled}getDisabledPlaceholder(e){if(!e||0===e)return B("mail_settings_configure");if(-1===e)return B("mail_settings_time_forever");var t=getShortDateWithTime(e,0,!1);return`${B("mail_settings_until")} ${t}`}getDisabledOptions(){return this.state.push_disabled_until?[].concat(H(),[{label:B("mail_settings_time_cancel"),value:0}]):H()}render(){var e=this.props,t=e.store,n=e.flagsUpdated,a=e.notificationSettingsUpdated,i=e.disableUntilUpdated,o=e.onHideStatus,l=e.invitationLinks,c=e.isInvitationLinkWithHistory,d=t.get(),u=d.tabs[d.peer],g=Object(s.isFvkcomgroup)(d,d.peer),_=Object(x.isCommunityChat)(d,d.peer),p=u.inviteLinks&&Object(f.canSeeInviteLink)(t)||Object(f.canChangeInviteLink)(t),h=l||u.inviteLinks,b=h&&(c?h.linkWithHistory:h.linkWithoutHistory),v=Object(f.canSeeSettingsItem)(t,d.peer,d.id),O=Object(m.classNames)("ChatSettingsMenu",{"ChatSettingsMenu--copied":this.state.copied}),y=d.isMassMentionsMessageAllowed,j=B(c?"mail_get_invite_link_copy_with_history":"mail_get_invite_link_copy_without_history");return r.createElement("div",{className:"ChatSettings__pane"},_&&r.createElement(k.default,{className:O},r.createElement(M.default,{onClick:e=>nav.go(u.owner.link,e),chevron:!0,className:"ChatSettingsMenu__owner"},r.createElement(N.default,{size:"28",title:u.owner.title,photo:u.owner.photo,href:u.owner.link,description:u.owner.description}))),r.createElement(k.default,{className:O},r.createElement(M.default,{onClick:this.props.showAttachments,chevron:!0},r.createElement(R.default,{type:"attach",backgroundColor:"blue"}),B("mail_im_show_media_history"))),r.createElement(k.default,{className:O},y&&r.createElement(r.Fragment,null,r.createElement(M.default,{selectable:!1,chevron:!1,aside:r.createElement(r.Fragment,null,r.createElement(C.default,{shown:a,callback:o},B("global_changes_saved_short")),r.createElement(P.default,{className:"ChatSettingsMenu__select",onChange:this.onMentionSettingsChange,options:[{label:B("mail_settings_mentions_all"),value:0},{label:B("mail_settings_mentions_except"),value:1},{label:B("mail_settings_mentions_disable"),value:2}],value:this.state.mentions_push_disabled}))},r.createElement(R.default,{type:"mention",backgroundColor:"blue"}),B("mail_settings_mentions")),r.createElement(M.default,{selectable:!1,aside:r.createElement(r.Fragment,null,r.createElement(C.default,{shown:i,callback:o},B("global_changes_saved_short")),r.createElement(P.default,{className:"ChatSettingsMenu__select",onChange:this.onDisabledSettingsChange,options:this.getDisabledOptions(),placeholder:this.state.disabledPlaceholder}))},r.createElement(R.default,{type:"notice",backgroundColor:"red"}),B("mail_settings_notices"))),(p||v)&&r.createElement(r.Fragment,null,p&&r.createElement(M.default,{onClick:this.onShowInviteLink,chevron:Object(f.canChangeInviteLink)(t)},r.createElement(R.default,{type:"link",backgroundColor:"green"}),B(g?"mail_vkcomgroup_invite_link":"mail_chat_invite_link"),b&&r.createElement("span",{className:"ChatSettingsMenu__invite"},r.createElement("span",{className:"ChatSettingsMenu__hidden"},r.createElement("input",{type:"text",readOnly:!0,value:b,ref:this.getHiddenInput})),r.createElement(C.default,{className:"ChatSettingsMenu__copied",shown:this.state.copied,callback:this.onBlinkTextHide},B("mail_invite_link_copied")),r.createElement(E.default,{className:"ChatSettingsMenu__copy",onClick:this.onCopyInviteLink},j))),v&&r.createElement(M.default,{onClick:this.props.showSettings,chevron:!0,aside:r.createElement(C.default,{shown:n,callback:o},B("global_changes_saved"))},r.createElement(R.default,{type:"gear",backgroundColor:"gray"}),B("mail_settings_options")))))}}n("OG14"),n("Vd3H");var U=n("ZO95"),G=n("As6E"),q=c.default.getLang;class V extends r.Component{constructor(){super(...arguments),this.toggleAdmin=()=>{var e=this.props,t=e.store,n=e.mid,a=e.adminMap,r=t.get().peer,i=!a[n];t.set(o.toggleAdminOptimisticly.bind(null,r,n,i)),t.set(o.toggleAdmin.bind(null,r,n,i))},this.kick=()=>{var e=this.props.store,t=e.get().peer,n=this.props.mid;e.set(o.kickUserOptimisticly.bind(null,t,n)),e.set(o.kickUser.bind(null,t,n)).catch(e=>{Object(b.imWeirdCatch)("ChatSettingsMemberEdit.kick",e)})},this.cancelMessageRequest=()=>{var e=this.props.store,t=e.get().peer,n=this.props.mid;e.set(o.cancelMessageRequest.bind(null,t,n)).catch(e=>{Object(b.imWeirdCatch)("ChatSettingsMemberEdit.cancel",e)})},this.changeAccess=e=>{var t=this.props.store,n=t.get().peer,a=this.props.mid;t.set(o.changeCommunityAccess.bind(null,n,a,!e)).catch(e=>{Object(b.imWeirdCatch)("ChatSettingsMemberEdit.changeAccess",e)})}}getMemberRole(e,t){var n=this.props.storeData,a=n.peer;return t===n.tabs[a].ownerId?q("mail_settings_owner"):e[t]?q("mail_settings_admin"):null}getActions(e){var t=this.props,n=t.store,a=t.mid,r=Object(d.unpackStore)(n),i=r.id,s=r.peer,o=i===a,l=[],c=Object(x.isCommunityChat)(n,s);if(o)return c&&Object(x.isCommunityInterface)(n)?[]:[{text:q("mail_leave_chat"),onClick:this.props.onLeave}];if(Object(f.canAddAdmin)(n,a)&&l.push({text:e[a]?q("mail_chat_remove_admin"):q("mail_settings_appoint_admin"),onClick:this.toggleAdmin}),Object(f.canKickUser)(n,a)&&l.push({text:q("mail_settings_kick"),onClick:this.kick}),Object(x.isCommunityPeer)(a)&&!e[a]){var u=Object(f.canSeeAllMessages)(n,n.get().peer,a),g=u?"mail_settings_community_mentions_only":"mail_settings_community_full_access";l.push({text:q(g),onClick:this.changeAccess.bind(this,u)})}return l}render(){var e=this.props,t=e.adminMap,n=e.storeData,a=e.mid,i=e.isContact,s=n.id,o=!!t[s],l=this.getMemberRole(t,a),c=s===a,d=o&&this.getActions(t);return i?r.createElement(_.default,{text:q("mail_cancel_invitation"),position:"t",align:"right"},r.createElement("span",{onClick:this.cancelMessageRequest,className:"ChatSettingsMembersEdit__kick"})):r.createElement(r.Fragment,null,l&&r.createElement("span",{className:"ChatSettingsMembersEdit__role"},l),d&&d.length>0&&r.createElement(G.default,{position:"b",align:"right",trigger:"hover",marginTop:-8,marginLeft:1,data:this.getActions(t)},r.createElement("span",{className:"ChatSettingsMembersEdit__actions"})),!o&&!c&&Object(f.canKickUser)(n,a)&&r.createElement(_.default,{text:q("mail_settings_kick"),position:"t",align:"right"},r.createElement("span",{onClick:this.kick,className:"ChatSettingsMembersEdit__kick"})),!o&&c&&r.createElement(_.default,{text:q("mail_leave_chat"),position:"t",align:"right"},r.createElement("span",{onClick:this.props.onLeave,className:"ChatSettingsMembersEdit__kick"})))}}var W={appendParentCls:"ChatSettingsWrapper"},K=c.default.getLang,Y={all:"allShowMore",admins:"adminsShowMore",invitedByMRShowMore:"invitedByMRShowMore"};class $ extends r.Component{constructor(e){super(e),this.onToggleSearch=()=>{this.state.showSearch?this.setState({showSearch:!1,searchQuery:""}):(this.setState({showSearch:!0}),requestAnimationFrame(()=>{this.searchInput.focus()}))},this.onSearchChange=e=>{e.target.value!==this.state.searchQuery&&this.setState({searchQuery:e.target.value})},this.onShowMore=()=>{var e=Y[this.state.current];this.state[e]&&this.setState({[e]:!1})},this.onTabClick=(e,t)=>{e.preventDefault(),this.state.current!==t&&this.setState({current:t})},this.handleDocumentClick=e=>{!this.state.showSearch||this.state.searchQuery||e.target.closest(".ChatSettingsMembersWidget__search")||e.target.closest(".ChatSettingsMembersWidget__searchIcon")||this.setState({showSearch:!1})},this.onKeydown=e=>{this.state.showSearch&&27===e.keyCode&&(this.searchInput.blur(),this.setState({showSearch:!1,searchQuery:""}),e.preventDefault(),e.stopPropagation())},this.getInviter=e=>{if(this.invitersCache[e])return this.invitersCache[e];var t=this.props.store.get(),n=t.peer,a=t.tabs[n],r=a.inviters;if(!r[e])return"";var i=Object(s.getChatMembersByIds)(t,[r[e][0]])[0],o=getSmDate(r[e][2],t.timeshift,!0);if(Object(f.isUserOwnerInChat)(a,e))return this.invitersCache[e]=K("mail_settings_owner"),K("mail_settings_owner");if(!i)return this.invitersCache[e]=o,o;var l=langSex(r[e][1],K("mail_chat_member_invited_by_X","raw")).replace(/{inviter}/,replaceEntities(i.name))+" "+o;return this.invitersCache[e]=l,l},this.isAddMemberWidgetShown=()=>{var e=this.props.store,t=Object(d.unpackStore)(e),n=t.id,a=t.peer,r=this.state,i=r.current,s=r.showSearch,o=r.searchQuery;return"all"===i&&!(s&&""!==o)&&Object(f.canInviteUser)(e,a,n)},this.searchInputRef=e=>{this.searchInput=e};var t=e.store.get(),n=this.getMembers(t),a=this.getAdmins(t),r=this.getInvitedByMessageRequests(t);this.state={showSearch:!1,searchQuery:"",current:"all",all:n,allShowMore:n.length>50,admins:a,adminsShowMore:a.length>50,invitedByMR:r,invitedByMRShowMore:r.length>50},this.membersMap=n.reduce((e,t)=>(e[t]=!0,e),{}),this.searchIndexPromise=this.getSearchIndex(n).then(e=>{this.searchIndex=e}),this.invitersCache={}}componentWillReceiveProps(e){var t=e.store.get(),n=this.getMembers(t),a=this.getAdmins(t),r=this.getInvitedByMessageRequests(t),i={removes:[],additions:[]},s=n.reduce((e,t)=>(e[t]=!0,e),{});n.forEach(e=>{this.membersMap[e]||i.additions.push(e)}),Object.keys(this.membersMap).forEach(e=>{s[e]||i.removes.push(e)}),(i.removes.length||i.additions.length)&&(this.updateSearchIndex(t,i),this.membersMap=s);var o={all:n,allShowMore:this.state.allShowMore&&n.length>50,admins:a,adminsShowMore:this.state.adminsShowMore&&a.length>50,invitedByMR:r,invitedByMRShowMore:this.state.invitedByMRShowMore&&r.length>50};o.current=o[this.state.current].length>0?this.state.current:"all",this.setState(o)}getMembers(e){var t=e.peer,n=e.tabs[t],a=-1!==(n.memberIds||[]).indexOf(n.ownerId),r=(n.adminIds||[]).reduce((e,t)=>(e[t]=!0,e),{});return(a?[n.ownerId]:[]).concat((n.adminIds||[]).filter(e=>e!==n.ownerId),(n.memberIds||[]).filter(e=>e!==n.ownerId&&!r[e]))}getAdmins(e){var t=e.peer,n=e.tabs[t];return(-1!==(n.memberIds||[]).indexOf(n.ownerId)?[n.ownerId]:[]).concat((n.adminIds||[]).filter(e=>e!==n.ownerId))}getInvitedByMessageRequests(e){var t=e.peer;return e.tabs[t].invitedByMessageRequest.sort((function(e,t){return e.date-t.date}))}getInvitedByMessageRequestList(e){return e.map(e=>({isContact:!0,id:e.id,photo:"/images/contact_icon.svg",name:e.name,date:e.date}))}getCurrentList(){var e=this.props.store,t=this.state,n=t.current,a=t.showSearch,r=t.searchQuery,i=t.invitedByMR;if(a&&r&&this.searchIndex){var o=this.getInvitedByMessageRequestList(i.filter(e=>!!e.name.toLowerCase().trim().split(/\s+/).find(e=>0===e.indexOf(r.toLowerCase()))));return this.searchIndex.search(r).concat(o)}var l=this.state[n],c="invitedByMR"===n?this.getInvitedByMessageRequestList(l):Object(s.getChatMembersByIds)(e.get(),l);return this.state[n+"ShowMore"]?c.slice(0,50):c}getSearchIndex(e){var t=window.vkIndexer,n=Object(s.getChatMembersByIds)(this.props.store.get(),e);return this.membersMap=n.reduce((e,t)=>(e[t.id]=!0,e),{}),new Promise((e,a)=>{var r=new t(n,e=>e.name,()=>{e(r)})})}updateSearchIndex(e,t){var n=Object(s.getChatMembersByIds)(e,t.removes),a=Object(s.getChatMembersByIds)(e,t.additions);(this.searchIndex?Promise.resolve(this.searchIndex):this.searchIndexPromise).then(e=>{n.forEach(t=>{e.remove(t)}),a.forEach(t=>{e.add(t)})})}componentDidMount(){this.searchInput.addEventListener("keydown",this.onKeydown)}componentWillUnmount(){this.searchInput.removeEventListener("keydown",this.onKeydown)}render(){var e=this.props,t=e.store,n=e.membersCount,a=e.membersAdded,i=e.onHideStatus,o=this.state,l=o.current,c=o.showSearch,d=o.searchQuery,u=o.admins,g=o.invitedByMR,_=t.get(),p=_.peer,h=_.tabs[p],f=this.getCurrentList(),b=this.isAddMemberWidgetShown()?["add"].concat(f):f,v=this.state[Y[l]],O=h.membersLastSeen,y={"ChatSettingsMembersWidget--search":!!c},E=h.adminIds.reduce((e,t)=>(e[t]=!0,e),{});return r.createElement("div",{className:Object(m.classNames)("ChatSettingsMembersWidget",y)},r.createElement("header",{className:"ChatSettingsMembersWidget__header"},r.createElement("input",{placeholder:K("mail_members_search"),className:"ChatSettingsMembersWidget__search",onChange:this.onSearchChange,onInput:this.onSearchChange,onPaste:this.onSearchChange,value:this.state.searchQuery,ref:this.searchInputRef}),r.createElement("button",{className:"ChatSettingsMembersWidget__searchIcon",onClick:this.onToggleSearch}),r.createElement(U.default,{className:"ChatSettingsMembersWidget__tabs",onTabClick:this.onTabClick},r.createElement("span",{key:"all"},K("mail_settings_everyone")+" ",r.createElement("span",{className:"Tabs__desc"},Object(s.getAliveMembersCount)(h))),u.length>0&&r.createElement("span",{key:"admins"},K("mail_settings_admins")+" ",r.createElement("span",{className:"Tabs__desc"},u.length)),g.length>0&&r.createElement("span",{key:"invitedByMR"},K("mail_invited_members")+" ",r.createElement("span",{className:"Tabs__desc"},g.length)))),r.createElement("div",{className:"ChatSettingsMembersWidget__list"},r.createElement(k.default,{border:!1},b.length>0&&b.map(e=>{if("add"===e)return r.createElement(M.default,{selectable:!1,border:!1,key:"add",onClick:this.props.showMembersSettings,aside:r.createElement(C.default,{className:"ChatSettingsMembersWidget__blink",shown:a,callback:i},langNumeric(n||0,K("mail_settings_members_added","raw")))},r.createElement("span",{className:"ChatSettingsMembersWidget__add"},r.createElement("span",null,K("mail_settings_add_members"))));var o=this.getInviter(e.id),l=e.isContact,c=e.covid_status?e.name+`<span class="ChatSettingsMembersWidget__covidStatus">${e.covid_status}</span>`:e.name,d="";return O&&O[e.id]?d=Object(s.getLastSeenText)(_,e.id,O[e.id],W):l&&(d=Object(s.getMessageRequestDateText)(e.date,t.get().timeshift)),r.createElement(M.default,{selectable:!1,border:!1,aside:r.createElement(V,{adminMap:E,store:t,storeData:_,mid:e.id,onLeave:this.props.onLeave,isContact:l}),key:e.id},r.createElement(N.default,{photo:e.photo,title:c,description:r.createElement("span",{title:o,dangerouslySetInnerHTML:{__html:d}}),href:e.link}))}),!b.length&&c&&d&&r.createElement("div",{className:"ChatSettingsMembersWidget__empty"},K("mail_settings_not_found")),!(c&&d)&&v&&r.createElement("div",{className:"ChatSettingsMembersWidget__more",onClick:this.onShowMore},K("mail_settings_show_all_members")))))}}var z=n("FABD"),X=n("0Rlc"),Q=n("EasH"),Z=n("DM26"),J=c.default.getLang,ee=()=>{};class te extends r.Component{constructor(e){super(e),this.onChange=e=>{var t=this.props.store.get(),n=e.target.value;Object(o.searchLocalHints)(n,t).then(e=>(this.setSearchResults({},!1,n,e),n?(this.isSearching=!0,this.serverSearch(n,e.map(e=>e.peerId))):Promise.resolve([]))).then(this.appendSearchResults).catch(()=>{})},this.serverSearch=Object(Z.debouncedPromise)((e,t)=>{var n=this.props.store;return Object(o.searchHints)(e,t,"friends",n.get())},300),this.onRemoveToken=e=>new Promise(t=>{var n=this.state.selected.filter(t=>t!==e);this.selected=n.reduce((e,t)=>(e[t]=!0,e),{}),this.setState({selected:n},t)}),this.onSelect=e=>new Promise(t=>{var n=this.selected[e]?this.state.selected.filter(t=>t!==e):[].concat(this.state.selected,e).filter((e,t,n)=>n.indexOf(e)===t);this.selected=n.reduce((e,t)=>(e[t]=!0,e),{}),this.resetSearch({selected:n,value:""},t)}),this.onShowHistoryToggle=()=>{this.setState({isShowHistoryChecked:!this.state.isShowHistoryChecked})},this.onAddPeople=()=>{var e=this.props.store,t=e.get().peer,n=this.state.selected.map(e=>parseInt(e)),a=this.state.isShowHistoryChecked;this.setState({loading:!0}),e.set(o.addNewMember.bind(null,t,n,a)).then(()=>e.set(o.getChatDetails.bind(null,t)).then(()=>{this.selected={},this.resetSearch({selected:[],loading:!1},()=>{this.props.afterSave(n.length)})})).catch(e=>{this.selected={},this.resetSearch({selected:[],loading:!1}),Object(Q.showFastBox)(J("global_error"),e)})},this.setSearchResults=(e,t,n,a)=>{var r=this.props.store.get(),i=Object(x.getTab)(r,r.peer),s=[];a.forEach(e=>{this.data[e.peerId]||(this.data[e.peerId]=e),-1===i.memberIds.indexOf(e.peerId)&&s.push(e.peerId)}),this.setState(Object.assign({},e,{found:s,value:n}),t||ee)},this.appendSearchResults=e=>{var t=this.props.store.get(),n=Object(x.getTab)(t,t.peer),a=this.state.found;e.forEach(e=>{this.data[e.peerId]||(this.data[e.peerId]=e),-1===n.memberIds.indexOf(e.peerId)&&-1===a.indexOf(e.peerId)&&a.push(e.peerId)}),this.isSearching=!1,this.setState({found:a})},this.state={selected:[],value:"",loading:!1,found:[],isShowHistoryChecked:!0},this.data={},this.selected={}}resetSearch(e,t){return Object(o.searchLocalHints)("",this.props.store.get()).then(this.setSearchResults.bind(this,e,t,""))}componentDidMount(){this.resetSearch()}render(){var e=Object.keys(this.state.selected).length;return r.createElement("div",{className:"ChatSettingsMembers"},r.createElement(z.default,{className:"ChatSettingsMembers__multiSelect",tokens:this.state.selected.map(e=>({text:unclean(this.data[e].name),id:e})),removeTokenPlaceholder:J("mail_create_chat_remove_user"),onRemoveToken:this.onRemoveToken,placeholder:J("mail_search_creation"),value:this.state.value,onChange:this.onChange,onSelect:this.onSelect,useInfiniteScroll:!1,hasMore:!1,virtualized:!1,loadMore:()=>{},notFoundText:J("mail_not_found"),autoFocus:!0,isSearching:this.isSearching},this.state.found.map(e=>r.createElement("div",{className:Object(m.classNames)("ChatSettingsMembers__entity",{"ChatSettingsMembers__entity--selected":this.selected[e]}),key:e,"data-id":e},r.createElement(N.default,{size:"34",title:this.data[e].name,photo:this.data[e].photo})))),r.createElement(A.default,{alignment:"right",className:"ChatSettingsMembers__submitArea"},r.createElement(X.default,{checked:this.state.isShowHistoryChecked,onChange:this.onShowHistoryToggle,className:"ChatSettingsMembers__showHistory"},J("mail_im_chat_add_members_show_history")),r.createElement(I.default,{disabled:0===e,onClick:this.onAddPeople,loading:this.state.loading,className:"ChatSettingsMembers__confirm"},J(e<2?"mail_append_chat":"mail_im_create_chat_with"))))}}var ne=n("iukX");function ae(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var n=[],a=!0,r=!1,i=void 0;try{for(var s,o=e[Symbol.iterator]();!(a=(s=o.next()).done)&&(n.push(s.value),!t||n.length!==t);a=!0);}catch(e){r=!0,i=e}finally{try{a||null==o.return||o.return()}finally{if(r)throw i}}return n}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return re(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return re(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function re(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,a=new Array(t);n<t;n++)a[n]=e[n];return a}var ie,se=c.default.getLang;class oe extends r.Component{constructor(e){super(e),this.showInvitationLink=()=>{var e=this.props.store,t=Object(d.unpackStore)(e),n=t.peer;return this.setState({invitationLoading:!0}),Object(o.getInviteLink)(n-2e9,t).then(e=>{var t=ae(e,1)[0];this.setState({section:2,invitationLoading:!1,invitationLinks:t})})},this.onUpdateNotificationSettings=(e,t)=>{var n=this.props,a=n.store,r=n.parentMutations,i=a.get().peer;return a.set(o.toggleMutePeer.bind(null,i,e,t)).then(r().updateState.bind(null,i))},this.onUpdateMentionNotificationSettings=e=>{var t=this.props,n=t.store,a=t.parentMutations,r=n.get().peer;return n.set(o.toggleMuteMentionsPeer.bind(null,r,e)).then(a().updateState.bind(null,r))},this.onUpdateFlags=e=>{var t=this.props.store.get(),n=t.peer,a=t.hasOwnProperty("onUpdateFlags")?t.onUpdateFlags.bind(null,n,e):e=>Promise.resolve(e);return Object(o.updateFlags)(n,e,t).then(a)},this.afterFlagsUpdated=()=>{this.go(0,()=>this.setBlinkStatus({flagsUpdated:!0}))},this.afterMembersAdded=e=>{this.go(0,()=>this.setBlinkStatus({membersAdded:!0,membersCount:e}))},this.afterNotificationSettingsUpdated=()=>{this.setBlinkStatus({notificationSettingsUpdated:!0})},this.afterDisableUntilUpdated=()=>{this.setBlinkStatus({disableUntilUpdated:!0})},this.setBlinkStatus=e=>{this.timers.push(setTimeout(()=>this.setState(e),300))},this.onHideStatus=()=>{this.setState({membersAdded:!1,flagsUpdated:!1,notificationSettingsUpdated:!1,disableUntilUpdated:!1})},this.onLeave=()=>{var e=this.props,t=e.store,n=e.closePopup,a=t.get().peer,r=Object(s.isFvkcomgroup)(t,a),i=Object(Q.showFastBox)({title:se(r?"mail_leave_channel":"mail_chat_leave_title"),dark:1},se(r?"mail_vkcomgroup_leave_confirm":"mail_chat_leave_confirm"),se(r?"mail_leave_channel":"mail_leave_chat"),(function(){t.set(o.unpinMessageOptimistic.bind(null,a)),t.set(o.leaveChat.bind(null,a)),i.hide(),n(),t.get().longpoll.push([Object(l.resetPeer)()])}),se("global_cancel"),(function(){i.hide()}))},this.onChatClose=()=>{var e=this.props,t=e.store,n=e.closePopup,a=t.get().peer,r=Object(x.getTab)(t,a).data.flags,i=r&f.MAIL_CHAT_FLAG_DENY_ANYONE_TO_WRITE?r&~f.MAIL_CHAT_FLAG_DENY_ANYONE_TO_WRITE:r|f.MAIL_CHAT_FLAG_DENY_ANYONE_TO_WRITE,o=Object(Q.showFastBox)({title:se("global_warning"),dark:1},se("mail_chat_close_confirm"),se("mail_close_chat"),()=>{this.onUpdateFlags(i).then(()=>{o.hide(),n(),Object(s.isCommunityInterface)(t)||t.get().longpoll.push([Object(l.resetPeer)()])})},se("global_cancel"),(function(){o.hide()}))},this.onChatRestore=()=>{var e=this.props,t=e.store,n=e.closePopup,a=t.get().peer,r=Object(x.getTab)(t,a).data.flags,i=r&f.MAIL_CHAT_FLAG_DENY_ANYONE_TO_WRITE?r&~f.MAIL_CHAT_FLAG_DENY_ANYONE_TO_WRITE:r|f.MAIL_CHAT_FLAG_DENY_ANYONE_TO_WRITE;this.onUpdateFlags(i).then(n)},this.onResetLink=()=>{var e=this.props.store,t=Object(d.unpackStore)(e),n=t.peer;return Object(o.resetInviteLink)(n,t).then(e=>{var t=ae(e,1)[0];this.setState({invitationLinksReseted:!0,invitationLinks:t})})},this.onShowAttachments=()=>{var e=Object(x.getPeer)(this.props.store);this.props.closePopup(),window.showWiki({w:"history"+Object(s.convertPeerToUrl)(e)+"_photo"},null,{})},this.onLinkHistoryOptionToggle=()=>{var e=Object(x.getPeer)(this.props.store);this.setState(e=>({isInvitationLinkWithHistory:!e.isInvitationLinkWithHistory}),()=>{this.props.updateHistoryLinkState(e,this.state.isInvitationLinkWithHistory)})},this.state={section:0,invitationLinks:null,invitationLinksReseted:!1,isInvitationLinkWithHistory:this.props.isLinkWithHistorySelected,membersAdded:!1,flagsUpdated:!1,notificationSettingsUpdated:!1,disableUntilUpdated:!1},this.timers=[]}go(e,t){this.setState({section:e},()=>{this.props.updatePopup(),t&&t()})}getPopupTitle(){switch(this.state.section){case 1:return se("mail_settings_add_members");case 2:case 3:return se("mail_chat_invite_link");case 6:return se("mail_settings_options");default:return se("mail_settings_title")}}componentWillReceiveProps(e){var t=e.store.get(),n=t.peer,a=t.tabs[n];a.photoLarge||a.photoGrid||this.resync||(this.resync=!0,e.store.set(o.getChatDetails.bind(null,n)).then(()=>{this.resync=!0}))}componentDidMount(){this.props.updatePopup()}componentWillUnmount(){this.timers.forEach(clearTimeout)}render(){var e=this.props,t=e.store,n=e.closePopup,a=t.get(),i=a.peer,o=a.tabs[i],l=Object(s.isFvkcomgroup)(t,i),c=Object(x.isCasperChat)(t,i),d=Object(x.isCommunityChat)(t,i),m=!l&&!d||!t.get().gid,_=Object(f.canCloseChat)(t,i,a.id),p=Object(x.isClosedChat)(t,i),h=a.isChatTypeEditAllowed,b=se(l?"mail_im_n_vkcomgroup_members":"mail_im_n_chat_members",Object(s.getAliveMembersCount)(o));return r.createElement("section",{className:"ChatSettings"},r.createElement(u.default,{title:this.getPopupTitle(),back:0!==this.state.section?se("global_back"):void 0,onCloseClick:n,onBackClick:()=>this.go(0)}),0===this.state.section&&r.createElement("div",{className:"ChatSettings__content"},r.createElement(O,{store:t,photo:o.photoLarge,grid:o.photoGrid,title:o.name,flags:o.data.flags,isDefaultPhotoOwner:o.isDefaultPhotoOwner,isCasper:c,meta:b,description:""}),r.createElement(F,{store:t,showMembersSettings:()=>this.go(1),showAttachments:this.onShowAttachments,showInvitationLink:this.showInvitationLink,isInvitationLinkWithHistory:this.state.isInvitationLinkWithHistory,invitationLinks:this.state.invitationLinks,showSettings:()=>this.go(6),notificationSettingsUpdated:this.state.notificationSettingsUpdated,disableUntilUpdated:this.state.disableUntilUpdated,flagsUpdated:this.state.flagsUpdated,onHideStatus:this.onHideStatus,onUpdateNotificationSettings:this.onUpdateNotificationSettings,onUpdateMentionNotificationSettings:this.onUpdateMentionNotificationSettings,afterNotificationSettingsUpdated:this.afterNotificationSettingsUpdated,afterDisableUntilUpdated:this.afterDisableUntilUpdated}),l?null:r.createElement("div",{className:"ChatSettings__pane"},r.createElement($,{store:t,onLeave:this.onLeave,showMembersSettings:()=>this.go(1),membersAdded:this.state.membersAdded,onHideStatus:this.onHideStatus,membersCount:this.state.membersCount})),m&&r.createElement("div",{className:"ChatSettings__pane"},r.createElement(g.default,{appearance:["link","mobile"],className:"ChatSettings__criticalAction ChatSettings__leave",onClick:this.onLeave},se(l?"mail_leave_channel":"mail_settings_leave"))),_&&!p&&r.createElement("div",{className:"ChatSettings__pane"},r.createElement(g.default,{appearance:["link","mobile"],className:"ChatSettings__criticalAction ChatSettings__close",onClick:this.onChatClose},se("mail_settings_close"))),_&&p&&r.createElement("div",{className:"ChatSettings__pane"},r.createElement(g.default,{appearance:["link","mobile"],className:"ChatSettings__criticalAction ChatSettings__restore",onClick:this.onChatRestore},se("mail_settings_restore")))),1===this.state.section&&r.createElement(te,{store:t,afterSave:this.afterMembersAdded}),6===this.state.section&&r.createElement(ne.default,{isChatTypeEditAllowed:h,flags:o.data.flags,isCasperChatTab:c,isCommunityChat:d,allowedUpdateFlags:o.allowedUpdateFlags,back:()=>this.go(0),onSave:this.onUpdateFlags,afterSave:this.afterFlagsUpdated}),2===this.state.section&&r.createElement(S,{store:t,onReset:()=>this.go(3),onLinkHistoryOptionToggle:this.onLinkHistoryOptionToggle,reseted:this.state.invitationLinksReseted,isInvitationLinkWithHistory:this.state.isInvitationLinkWithHistory,invitationLinks:this.state.invitationLinks}),3===this.state.section&&r.createElement(L,{onConfirm:this.onResetLink,onCancel:()=>this.go(2)}))}}function le(e,t){var n=ls.get("im_chats_no_invite_link_history")||[],a=e-2e9,r=t?n.filter(e=>e!==a):n.concat(a);ls.set("im_chats_no_invite_link_history",r)}function ce(e,t){var n=ge(),a=function(e){var t=Object(x.getPeer)(e)-2e9;return!(ls.get("im_chats_no_invite_link_history")||[]).includes(t)}(e);n&&i.render(r.createElement(oe,{store:e,closePopup:de.bind(null,e),updatePopup:ue,isLinkWithHistorySelected:a,updateHistoryLinkState:le,parentMutations:t}),n)}function de(e){ie&&ie.hide();var t=e.get();t.hasOwnProperty("onClose")&&t.onClose()}function ue(){ie&&ie.updateBoxCoords()}function ge(){return document.querySelector("#ChatSettings")}function me(e){var t=document.querySelector("#box_layer_wrap"),n=document.querySelector("#box_loader"),r=isVisible(t);return{unmount(){var t=ge();t&&i.unmountComponentAtNode(t),Object(a.destroyModule)(e)},showLoader(){boxRefreshCoords(n),show(n),r||show(t)},hideLoader(){hide(n),r||hide(t)}}}function _e(e,t,n){var r=Object(a.createMutations)(me).bindMutations,i=t.get(),s=Object(a.createModule)({handlers:(e,t)=>{}}),l=i.peer,c=r(s);var u=function(e,t){t.get().peer===l?function(e,t){var n=Object(x.getTab)(e,e.get().peer);n&&n.data&&Object(x.isChatActive)(n)?ce(e,t):de(e)}(t,n):e.unmount()}.bind(null,c),g={hideButtons:!0,bodyStyle:"padding: 0; background: none;",width:560,onShow(){ce(t,n),t.subscribe(u),requestAnimationFrame(()=>ie.updateBoxCoords())},onHideAttempt:()=>(t.unsubscribe(u),c.unmount(),!0)};return c.showLoader(),t.set(o.getChatDetails.bind(null,l)).then(e=>{c.hideLoader();var t=Object(d.unpackStore)(e).peer;t&&t===l?ie=new MessageBox(g).content('<div id="ChatSettings" class="ChatSettingsWrapper"></div>').show():c.unmount()}),c}},ambf:function(e,t,n){"use strict";n.r(t),n.d(t,"MAX_DEVIATION",(function(){return s})),n.d(t,"EXPIRING_TIME",(function(){return o})),n.d(t,"EXPIRING_SOON_TIME",(function(){return l})),n.d(t,"EXPIRING",(function(){return c})),n.d(t,"EXPIRING_SOON",(function(){return d})),n.d(t,"EXPIRED",(function(){return u})),n.d(t,"casperMessagesStore",(function(){return h}));n("HEwt"),n("a1Th"),n("Btvt"),n("rGqo"),n("rE2o"),n("ioFf");var a=n("MhhX");function r(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var n=[],a=!0,r=!1,i=void 0;try{for(var s,o=e[Symbol.iterator]();!(a=(s=o.next()).done)&&(n.push(s.value),!t||n.length!==t);a=!0);}catch(e){r=!0,i=e}finally{try{a||null==o.return||o.return()}finally{if(r)throw i}}return n}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return i(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return i(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function i(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,a=new Array(t);n<t;n++)a[n]=e[n];return a}var s=2e3,o=6e4,l=1e4,c="expiring",d="expiring_soon",u="expired",g=[],m={},_={},p=0,h={add(e){var t=r(b(e),3),n=t[0],a=t[1],i=t[2],s=Math.max(n+a-o-i,0),g=Math.max(n+a-l-i,0),p=Math.max(n+a-i,0),h=setTimeout(()=>{f({type:c,message:e})},s),v=setTimeout(()=>{f({type:d,message:e})},g),O=setTimeout(()=>{f({type:u,message:e}),_[e.messageId]=!0,delete m[e.messageId]},p);m[e.messageId]={message:e,expiringTime:s,expiredTime:p,timers:[h,v,O]}},remove(e){this.has(e)&&(m[e].timers.forEach(clearTimeout),delete m[e])},setTimeshift(e){p=1e3*(e||0)},getTimings:e=>m[e]?b(m[e].message):[0,0,0],getExpireTime(e){if(!m[e])return 0;var t=r(b(m[e].message),3),n=t[0],a=t[1],i=t[2];return Math.max(Math.floor((n+a-i)/1e3),0)},isProcessed:e=>!!_[e],subscribe(e){g.push(e)},unsubscribe(e){g=g.filter(t=>t!==e)},has:e=>!!m[e],destroy(){m={},g=[],_={}}};function f(e){g.forEach(t=>t(e))}function b(e){return[1e3*e.date+p,1e3*(Object(a.getMessageTTL)(e)||0),Date.now()]}},bIHZ:function(e,t,n){"use strict";n.r(t),n.d(t,"updateLocation",(function(){return r})),n.d(t,"updateLazyLocation",(function(){return i}));var a=n("t7n3");function r(e){var t=Object(a.extend)({},window.nav.objLoc,e);Object.keys(t).filter((function(e){return""===t[e]})).forEach((function(e){delete t[e]}));var n=window.nav.toStr(t);window.nav.setLoc(n)}function i(){var e={};return{scheduleNav:function(t){e=Object(a.extend)(e,t)},commitNav:function(){r(e),e={}},scheduleNavWithTimeOut:function(t,n){void 0===n&&(n=100),e=Object(a.extend)(e,t),setTimeout((function(){r(e),e={}}),n)}}}},bP5l:function(e,t,n){"use strict";n.r(t),n.d(t,"lpLogFc",(function(){return i})),n.d(t,"longpollTestingOnFcEvents",(function(){return g})),n.d(t,"longpollTestingOnImEvents",(function(){return m}));var a=n("ERyv"),r=function(){for(var e=0,t=0,n=arguments.length;t<n;t++)e+=arguments[t].length;var a=Array(e),r=0;for(t=0;t<n;t++)for(var i=arguments[t],s=0,o=i.length;s<o;s++,r++)a[r]=i[s];return a};function i(e,t){for(var n=[],a=2;a<arguments.length;a++)n[a-2]=arguments[a];if(window.vk.lpConfig.debug){var i="background: "+e+"; color: white",s=new Date,o=function(e){return e<10?"0"+e.toString():e.toString()};console.log.apply(console,r(["%c "+s.getHours()+":"+o(s.getMinutes())+":"+o(s.getSeconds())+":"+s.getMilliseconds()+" "+t+" ",i],n))}}function s(){return window.lpBufferFc||(window.lpBufferFc=[]),window.lpBufferFc}function o(){return window.lpBufferIm||(window.lpBufferIm=[]),window.lpBufferIm}function l(e,t){window.lpWeird||(window.lpWeird=[]),window.lpWeird.push({msg:e,ev:t,is_master:window.curNotifier.is_server}),setTimeout(c,1e4)}function c(){window.lpWeird&&window.lpWeird.length&&(Object(a.imWeirdLog)("fc_im_differ",{diff:window.lpWeird},!1),window.lpWeird=[])}function d(){return"im"===window.cur.module&&window.store&&window.store.get().longpoll&&!window.store.get().stopped}function u(){var e;d()&&(o().forEach((function(e){!s().find((function(t){return e.ev===t.ev}))&&e.time<Date.now()-1e3&&!e.warned&&(e.warned=!0,i("red","im not fc",e.ev),Object(a.isWeirdLogging)()&&l("im not fc",e.ev))})),s().forEach((function(e){var t=o().find((function(t){return t.ev===e.ev}));t&&t.warned&&!e.warned&&(e.warned=!0,i("red","now fc like im",e.ev),Object(a.isWeirdLogging)()&&l("now fc like im",e.ev))}))),e=Date.now()-3e4,window.lpBufferFc=s().filter((function(t){return t.time>e})),window.lpBufferIm=o().filter((function(t){return t.time>e}))}function g(e){var t;d()&&((t=s()).push.apply(t,e.map((function(e){return{time:Date.now(),ev:JSON.stringify(e),warned:!1}}))),setTimeout(u,0)),i.apply(void 0,r(["green","fc"],e))}function m(e){var t;d()&&((t=o()).push.apply(t,e.map((function(e){return{time:Date.now(),ev:JSON.stringify(e),warned:!1}}))),setTimeout(u,1100)),i.apply(void 0,r(["blue","im"],e))}window.longpollTestingOnImEvents=m},clTp:function(e,t,n){"use strict";function a(e){var t=e.getBoundingClientRect(),n=document.body,a=document.documentElement,r=window.pageYOffset||a.scrollTop||n.scrollTop,i=window.pageXOffset||a.scrollLeft||n.scrollLeft,s=a.clientTop||n.clientTop||0,o=a.clientLeft||n.clientLeft||0;return{top:Math.round(t.top+r-s),left:Math.round(t.left+i-o),width:e.offsetWidth,height:e.offsetHeight}}n.r(t),n.d(t,"default",(function(){return a}))},"dt/K":function(e,t,n){"use strict";n.r(t);var a,r=n("q1tI"),i=n("i8i4"),s=n("ZxpX"),o=n("clTp"),l=n("qihR"),c=(a=function(e,t){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}a(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),d=function(){return(d=Object.assign||function(e){for(var t,n=1,a=arguments.length;n<a;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)},u=function(e){var t=e.position,n=e.align,a=e.text,r=e.rect,i=e.marginTop,s=e.marginLeft,o=e.maxWidth,l=e.appearance,c=e.className,d=r.left,u=r.top;switch(t){case"t":d+=.5*r.width;break;case"r":d+=r.width,u+=.5*r.height;break;case"b":d+=.5*r.width,u+=r.height;break;case"l":u+=.5*r.height}return{tooltip:{position:t,align:n,text:a,x:d=Math.round(d+(s||0)),y:u=Math.round(u+(i||0)),maxWidth:o,appearance:l,className:c}}},g=function(e){function t(t){var n=e.call(this,t)||this;return n.onMouseEnter=function(){if(n.state.el){var e=n.props,t=e.text,a=e.position,r=e.align,i=e.marginTop,s=e.marginLeft,l=e.maxWidth,c=e.appearance,d=e.className,u=Object(o.default)(n.state.el);n.update({text:t,position:a,align:r,rect:u,marginTop:i,marginLeft:s,maxWidth:l,appearance:c,className:d})}},n.onMouseLeave=function(){return n.update()},n.onTransitionEnd=function(e){"visibility"===e.propertyName&&n.state.tooltip&&n.setState({tooltip:void 0})},n.state={el:null},n}return c(t,e),t.prototype.componentDidMount=function(){var e=i.findDOMNode(this);this.setState({el:e}),null==e||e.addEventListener("mouseenter",this.onMouseEnter),null==e||e.addEventListener("mouseleave",this.onMouseLeave)},t.prototype.componentWillUnmount=function(){var e,t;null===(e=this.state.el)||void 0===e||e.removeEventListener("mouseenter",this.onMouseEnter),null===(t=this.state.el)||void 0===t||t.removeEventListener("mouseleave",this.onMouseLeave)},t.getDerivedStateFromProps=function(e,t){return t.tooltip&&(e.text!==t.tooltip.text||e.position!==t.tooltip.position||e.align!==t.tooltip.align||e.maxWidth!==t.tooltip.maxWidth||e.appearance!==t.tooltip.appearance)?u(d(d({},e),{rect:Object(o.default)(t.el)})):null},t.prototype.update=function(e){if(!e)return this.setState({tooltip:Object.assign({},this.state.tooltip,{removed:!0})});this.setState(u(e))},t.prototype.render=function(){var e=this.state.tooltip?Object(s.classNames)(this.state.tooltip.className,"Tooltip--noPointerEvents"):"",t=this.state.tooltip?d(d({},this.state.tooltip),{className:e}):null;return t&&"undefined"!=typeof window?r.createElement(r.Fragment,null,this.props.children,r.createElement(l.default,d({},t,{onTransitionEnd:this.onTransitionEnd}))):this.props.children},t.defaultProps={position:"b",align:"center",marginTop:0,marginLeft:0,appearance:"dark"},t}(r.Component);t.default=g},enZq:function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return i}));var a=n("q1tI"),r=(n("17x9"),n("ZxpX"));function i(e){var t={"List--border":!!e.border};return a.createElement("ul",{className:Object(r.classNames)("List",t,e.className),style:e.style},e.children)}i.defaultProps={border:!0}},f01n:function(e,t,n){"use strict";n.r(t),n.d(t,"constructEvent",(function(){return s})),n.d(t,"DELETE",(function(){return o})),n.d(t,"SET_FLAGS",(function(){return l})),n.d(t,"REPLACE_FLAGS",(function(){return c})),n.d(t,"RESET_FLAGS",(function(){return d})),n.d(t,"ADD_MESSAGE",(function(){return u})),n.d(t,"READ_INBOUND",(function(){return g})),n.d(t,"READ_OUTBOUND",(function(){return m})),n.d(t,"GOT_ONLINE",(function(){return _})),n.d(t,"GOT_OFFLINE",(function(){return p})),n.d(t,"CHAT_CHANGED",(function(){return h})),n.d(t,"CONVERSATION_UPDATED",(function(){return f})),n.d(t,"TYPING",(function(){return b})),n.d(t,"RECORDING_AUDIO",(function(){return v})),n.d(t,"VIDEO_CALL",(function(){return O})),n.d(t,"UNREAD_COUNT",(function(){return y})),n.d(t,"NOTIFY_SETTINGS_CHANGED",(function(){return C})),n.d(t,"KEYBOARD_CALLBACK_RECEIVED",(function(){return E})),n.d(t,"EMPTY",(function(){return j})),n.d(t,"RESET_DIRECTORIES",(function(){return T})),n.d(t,"REPLACE_DIRECTORIES",(function(){return S})),n.d(t,"SET_DIRECTORIES",(function(){return I})),n.d(t,"RESYNC",(function(){return A})),n.d(t,"REFRESH_LP_KEY",(function(){return w})),n.d(t,"TRANSITION",(function(){return L})),n.d(t,"RESET_PEER",(function(){return k})),n.d(t,"MUTEX",(function(){return M})),n.d(t,"CHANGE_PEER",(function(){return N})),n.d(t,"CHANGE_TAB",(function(){return P})),n.d(t,"FAILED_MESSAGE",(function(){return D})),n.d(t,"RESEND",(function(){return R})),n.d(t,"DELETE_DIALOG",(function(){return x})),n.d(t,"EDIT_MESSAGE",(function(){return B})),n.d(t,"REPLACE_MESSAGE",(function(){return H})),n.d(t,"INVALIDATE_MESSAGE",(function(){return F})),n.d(t,"AUDIO_START",(function(){return U})),n.d(t,"WAITING_FOR_RECONNECT",(function(){return G})),n.d(t,"RECONNECTING",(function(){return q})),n.d(t,"RECONNECTED",(function(){return V})),n.d(t,"INCOMING_CALL",(function(){return W})),n.d(t,"FLAG_UNREAD",(function(){return K})),n.d(t,"FLAG_OUTBOUND",(function(){return Y})),n.d(t,"FLAG_IMPORTANT",(function(){return $})),n.d(t,"FLAG_CHAT",(function(){return z})),n.d(t,"FLAG_FRIENDS",(function(){return X})),n.d(t,"FLAG_SPAM",(function(){return Q})),n.d(t,"FLAG_DELETED",(function(){return Z})),n.d(t,"FLAG_MEDIA",(function(){return J})),n.d(t,"FLAG_STEALTH",(function(){return ee})),n.d(t,"FLAG_HAS_REPLY",(function(){return te})),n.d(t,"FLAG_AUDIO_MESSAGE_LISTENED",(function(){return ne})),n.d(t,"FLAG_DELETE_BY_TTL",(function(){return ae})),n.d(t,"FOLDER_IMPORTANT",(function(){return re})),n.d(t,"FOLDER_UNRESPOND",(function(){return ie})),n.d(t,"FOLDER_HAS_BANNER",(function(){return se})),n.d(t,"FOLDER_AD_TAG",(function(){return oe})),n.d(t,"FOLDER_MARKED_UNREAD",(function(){return le})),n.d(t,"MAIL_CHAT_UPDATE_TYPE_TITLE_CHANGED",(function(){return ce})),n.d(t,"MAIL_CHAT_UPDATE_TYPE_AVATAR_CHANGED",(function(){return de})),n.d(t,"MAIL_CHAT_UPDATE_TYPE_ADMIN_GRANTED",(function(){return ue})),n.d(t,"MAIL_CHAT_UPDATE_TYPE_FLAGS_CHANGED",(function(){return ge})),n.d(t,"MAIL_CHAT_UPDATE_TYPE_PINNED",(function(){return me})),n.d(t,"MAIL_CHAT_UPDATE_TYPE_USER_JOINED",(function(){return _e})),n.d(t,"MAIL_CHAT_UPDATE_TYPE_USER_LEFT",(function(){return pe})),n.d(t,"MAIL_CHAT_UPDATE_TYPE_USER_KICKED",(function(){return he})),n.d(t,"MAIL_CHAT_UPDATE_TYPE_ADMIN_KICKED",(function(){return fe})),n.d(t,"MAIL_CHAT_UPDATE_TYPE_BANNER_CHANGED",(function(){return be})),n.d(t,"MAIL_CHAT_UPDATE_TYPE_KEYBOARD_CHANGED",(function(){return ve})),n.d(t,"MAIL_CHAT_UPDATE_TYPE_MESSAGE_REQUEST_CHANGED",(function(){return Oe})),n.d(t,"MAIL_CHAT_UPDATE_TYPE_CONTACT_CONVERTED",(function(){return ye})),n.d(t,"MAIL_CHAT_UPDATE_TYPE_BUSINESS_NOTIFY_DATA_CHANGED",(function(){return Ce})),n.d(t,"MAIL_CHAT_UPDATE_TYPE_MESSAGE_REQUEST_CANCELED",(function(){return Ee})),n.d(t,"MAIL_CHAT_UPDATE_TYPE_MESSAGE_REQUEST_REJECTED",(function(){return je})),n.d(t,"MAIL_CHAT_UPDATE_TYPE_MESSAGE_REQUEST_ACCEPTED",(function(){return Te})),n.d(t,"MAIL_CHAT_UPDATE_TYPE_CONTACT_JOINED",(function(){return Se})),n.d(t,"MAIL_CHAT_UPDATE_TYPE_CALL_IN_PROGRESS_CHANGED",(function(){return Ie})),n.d(t,"MESSAGE_REQUEST_STATUS_ACCEPTED",(function(){return Ae})),n.d(t,"MESSAGE_REQUEST_STATUS_NEW",(function(){return we})),n.d(t,"deleteEvent",(function(){return Le})),n.d(t,"replaceFlagsEvent",(function(){return ke})),n.d(t,"setFlagsEvent",(function(){return Me})),n.d(t,"resetFlagsEvent",(function(){return Ne})),n.d(t,"addMessageEvent",(function(){return Pe})),n.d(t,"editMessageEvent",(function(){return De})),n.d(t,"replaceMessageEvent",(function(){return Re})),n.d(t,"invalidateMessageEvent",(function(){return xe})),n.d(t,"editMessageLocallyEvent",(function(){return Be})),n.d(t,"readInboundEvent",(function(){return He})),n.d(t,"readOutboundEvent",(function(){return Fe})),n.d(t,"gotOnlineEvent",(function(){return Ue})),n.d(t,"gotOfflineEvent",(function(){return Ge})),n.d(t,"resetDirectoriesEvent",(function(){return qe})),n.d(t,"replaceDirectoriesEvent",(function(){return Ve})),n.d(t,"setDirectoriesEvent",(function(){return We})),n.d(t,"deleteDialogEvent",(function(){return Ke})),n.d(t,"chatChangedEvent",(function(){return Ye})),n.d(t,"chatUpdatedEvent",(function(){return $e})),n.d(t,"typingEvent",(function(){return ze})),n.d(t,"recordingAudioEvent",(function(){return Xe})),n.d(t,"videoCallEvent",(function(){return Qe})),n.d(t,"unreadCountEvent",(function(){return Ze})),n.d(t,"notifySettingsChangedEvent",(function(){return Je})),n.d(t,"incomingCallEvent",(function(){return et})),n.d(t,"refreshMessageEvent",(function(){return tt})),n.d(t,"audioStartEvent",(function(){return nt})),n.d(t,"keyboardCallbackReceivedEvent",(function(){return at})),n.d(t,"emptyEvent",(function(){return rt})),n.d(t,"transitionEvent",(function(){return it})),n.d(t,"resyncEvent",(function(){return st})),n.d(t,"refreshLpKeyEvent",(function(){return ot})),n.d(t,"waitingForReconnectEvent",(function(){return lt})),n.d(t,"reconnectingEvent",(function(){return ct})),n.d(t,"reconnectedEvent",(function(){return dt})),n.d(t,"resetPeer",(function(){return ut})),n.d(t,"changePeer",(function(){return gt})),n.d(t,"changeTab",(function(){return mt})),n.d(t,"failedMessage",(function(){return _t})),n.d(t,"mutexEvent",(function(){return pt})),n.d(t,"resendEvent",(function(){return ht}));n("HEwt"),n("a1Th"),n("Btvt"),n("rGqo"),n("rE2o"),n("ioFf"),n("OEbY");var a=n("rudk");function r(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var n=[],a=!0,r=!1,i=void 0;try{for(var s,o=e[Symbol.iterator]();!(a=(s=o.next()).done)&&(n.push(s.value),!t||n.length!==t);a=!0);}catch(e){r=!0,i=e}finally{try{a||null==o.return||o.return()}finally{if(r)throw i}}return n}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return i(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return i(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function i(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,a=new Array(t);n<t;n++)a[n]=e[n];return a}function s(e){switch(e[0]){case 0:return Le(e);case 1:return ke(e);case 2:return Me(e);case 3:return Ne(e);case 4:return Pe(e);case 5:return De(e);case 6:return He(e);case 7:return Fe(e);case 8:return Ue(e);case 9:return Ge(e);case 10:return qe(e);case 11:return Ve(e);case 12:return We(e);case 13:return Ke(e);case 18:return Re(e);case 19:return xe(e);case 51:return Ye(e);case 52:return $e(e);case 63:return ze(e);case 64:return Xe(e);case 70:return Qe(e);case 80:return Ze(e);case 114:return Je(e);case 115:return et(e);case 116:return tt(e);case 117:return nt(e);case 119:return at(e);case-1:return st();case-2:return ot(e);case-3:return lt(e);case-4:return ct();case-5:return dt();default:return rt(e)}}var o="event_delete",l="event_set_flags",c="event_replace_flags",d="event_reset_flags",u="event_add_message",g="event_read_inbound",m="event_read_outbound",_="event_got_online",p="event_got_offline",h="event_chat_changed",f="event_chat_updated",b="event_typing",v="event_recoding_audio",O="event_video_call",y="event_unread_count",C="event_notify_settings_changed",E="event_keyboard_callback_received",j="event_empty",T="event_reset_directories",S="event_replace_directories",I="event_set_directories",A="event_resync",w="event_refresh_lp_key",L="transition_event",k="reset_peer",M="mutex",N="change_peer",P="event_change_tab",D="event_failed_message",R="event_resend",x="event_delete_dialog",B="event_edit_message",H="event_replace_message",F="event_invalidate_event",U="event_audio_start",G="event_waiting_for_reconnect",q="event_reconnecting",V="event_reconnected",W="incoming_call",K=1,Y=2,$=8,z=16,X=32,Q=64,Z=128,J=512,ee=65536,te=1<<21,ne=4096,ae=1<<22,re=1,ie=2,se=8,oe=32768,le=1<<20,ce=1,de=2,ue=3,ge=4,me=5,_e=6,pe=7,he=8,fe=9,be=10,ve=11,Oe=12,ye=13,Ce=14,Ee=15,je=16,Te=17,Se=18,Ie=19,Ae=1,we=3;function Le(e){var t=r(e,2)[1];return{type:o,localId:t}}function ke(e){var t=r(e,4),n=t[1],a=t[2],i=t[3];return{type:c,messageId:n,mask:a,peerId:i}}function Me(e){var t=r(e,4),n=t[1],a=t[2],i=t[3];return{type:l,messageId:n,flags:a,peerId:i}}function Ne(e){var t=r(e,4),n=t[1],a=t[2],i=t[3];return{type:d,messageId:n,flags:a,peerId:i}}function Pe(e){var t=r(e,11),n=t[1],i=t[2],s=t[3],o=t[4],l=t[5],c=t[6],d=t[7],g=t[8],m=t[9],_=t[10],p=extend(c,d||void 0);return{type:u,messageId:intval(n),flags:intval(i),peerId:intval(s),date:intval(o),attaches:Object(a.convertKludgesToAttaches)(p,n),subject:c.title||"",text:l,kludges:p,randomId:intval(g),userId:Object(a.isChatPeer)(s)?intval(p.from):intval(s),update_time:_,chat_local_id:m}}function De(e){var t=Pe(e);return t.type=B,t}function Re(e){var t=Pe(e);return t.type=H,t}function xe(e){var t=r(e,2)[1];return{type:F,messageId:t}}function Be(e){return extend({},e,{type:B})}function He(e){var t=r(e,4),n=t[1],a=t[2],i=t[3];return{type:g,peerId:n,upToId:a,unread:i}}function Fe(e){var t=r(e,4),n=t[1],a=t[2],i=t[3];return{type:m,peerId:n,upToId:a,unread:i}}function Ue(e){var t=r(e,4),n=t[1],a=t[2],i=t[3];return{type:_,userId:-n,platform:a,lastSeenTs:i}}function Ge(e){var t=r(e,4),n=t[1],a=t[2],i=t[3];return{type:p,userId:-n,reason:a,lastSeenTs:i}}function qe(e){var t=r(e,4),n=t[1],a=t[2],i=t[3];return{type:T,peerId:n,mask:a,local:void 0!==i&&i}}function Ve(e){var t=r(e,3),n=t[1],a=t[2];return{type:S,peerId:n,mask:a}}function We(e){var t=r(e,4),n=t[1],a=t[2],i=t[3];return{type:I,peerId:n,mask:a,local:void 0!==i&&i}}function Ke(e){var t=r(e,3),n=t[1],a=t[2];return{type:x,peerId:n,localId:a}}function Ye(e){var t=r(e,3),n=t[1],a=t[2];return{type:h,chatId:n,self:a}}function $e(e){var t=r(e,4),n=t[1],a=t[2],i=t[3];return{type:f,peerId:a,updateType:n,updateArg:i}}function ze(e){var t=r(e,5),n=t[1],a=t[2],i=t[3],s=t[4];return{type:b,peerId:n,userIds:a,totalCount:i,ts:s}}function Xe(e){var t=r(e,5),n=t[1],a=t[2],i=t[3],s=t[4];return{type:v,peerId:n,userIds:a,totalCount:i,ts:s}}function Qe(e){var t=r(e,3),n=t[1],a=t[2];return{type:O,userId:n,callId:a}}function Ze(e){var t=r(e,4),n=t[1],a=t[2],i=t[3];return{type:y,count:n,countNotMuted:a,showOnlyNotMuted:i}}function Je(e){var t=r(e,2)[1],n=void 0===t?{}:t;return{type:C,peerId:n.peer_id,sound:n.sound,disabledUntil:n.disabled_until}}function et(e){var t=r(e,2)[1];return{type:W,payload:t}}function tt(e){var t=r(e,2)[1],n=void 0===t?{}:t,a=Pe([!1,n.id,n.flags,n.peer_id,n.date,n.message,extend(n.kludges,{title:n.title||""}),{},n.random_id,n.chat_local_id,n.update_time]);return a.type=B,a}function nt(e){var t=r(e,2)[1],n=void 0===t?{}:t;return{type:U,uuid:n.uuid,deviceName:n.device_name||""}}function at(e){var t=r(e,2)[1],n=t.event_id,a=t.owner_id,i=t.peer_id,s=t.action;return{type:E,event_id:n,owner_id:a,peer_id:i,action:s}}function rt(e){return{type:j,params:e}}function it(e){return{type:L,state:e}}function st(){return{type:A}}function ot(e){var t=r(e,3),n=t[1],a=t[2];return{type:w,key:n,url:a}}function lt(e){var t=r(e,2)[1];return{type:G,timeout:t}}function ct(){return{type:q}}function dt(){return{type:V}}function ut(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return{type:k,cancelSearch:e,removeActivePeer:t}}function gt(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],a=arguments.length>3&&void 0!==arguments[3]&&arguments[3],r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"";return{type:N,peerId:e,msgid:t,forward:n,cancelSearch:a,entryPoint:r}}function mt(e){return{type:P,tab:e}}function _t(e,t,n){return{type:D,message:t,peer:e,error:n}}function pt(e){var t=r(e,6),n=(t[0],t[1]),a=t[2],i=t[3],s=t[4],o=t[5];return{type:M,free:!!intval(n)||intval(s)===vk.id,resource:a,peerId:intval(i),who:intval(s),name:o}}function ht(e,t){return{type:R,message:t,peerId:e}}},f4YT:function(e,t){e.exports={im_img_prebody:'<div class="im-prebody"> <img alt="" src="%photo%" /> </div>',im_admin_link:' (<a href="%href%" class="_im_admin_name" target="_blank">%name%</a>)',im_right_menu_tpl:'<a id="ui_rmenu_peer_%peer%" href="%href%" class="_im_peer_tab ui_rmenu_item %cls%"%attrs%>\n  <span>%label%</span>\n</a>',im_right_menu_sep:'<div class="ui_rmenu_sep"></div>',im_right_menu_ct:'<span class="ui_rmenu_count im-right-menu--count _im_r_ct">%count%</span> <button type="button" class="im-right-menu--close _im_r_cl"></button><span class="im-right-menu--text _im_r_tx">%name%</span>',im_dialogs_link_img:'<a href="%href%" class="_im_peer_target _online_reader" target="_blank"><div class="im_grid">%photo%</div></a>',im_dialogs_link:'<a href="%href%" class="_im_peer_target _online_reader" target="_blank">%photo%</a>',im_peer_photo:'<div class="nim-peer %online_class% %modifier_class%"> <div class="nim-peer--photo-w"> <div class="nim-peer--photo"> %owner_photo% </div> </div> </div>',im_contact_avatar:' <div class="nim-peer--contact-avatar nim-peer--contact-avatar_%size%">%name%</div>',im_owner_item:'<a href="%link%" class="olist_item_wrap%cls%" id="olist_item_wrap%owner_id%" >\n  <div class="olist_item clear_fix">\n    <div class="olist_item_photo_wrap %img_cls%">\n      <img class="olist_item_photo" src="%photo%"/>\n    </div>\n    <div class="olist_item_name">%name%</div>\n    <div class="olist_checkbox"></div>\n  </div>\n</a>',im_simple_name:function(){return'<div class="im-page--title %more_cls%"> <span class="im-page--title-main" title="%name_attr%" %ads_union%> <span class="im-page--title-main-in"> <a href="%href%" target="_blank" class="im-page--title-main-inner _im_page_peer_name">%name%</a> <span class="im-page--title-main-verified _im_chat_verified"></span> </span> </span> <span class="im-page--title-meta _im_page_peer_online">%online%</span> <span class="im-page--title-status _im_page_status"></span> <button class="im-page--title-reconnect _im_page_reconnect">'+getLang("mail_network_reconnect")+"</button> </div>"},im_simple_link:'<a href="%href%" class="_im_header_link" target="_blank">%content%</a>',im_selected_messages:'<span class="im-page--selected-messages-count">%label%</span> <button aria-label="%tip%" type="button" class="im-page--selected-messages-remove"></button>',im_topic:"<div class='im-topic %cls%'>%topic%</div>",im_stack_date:' <a href="%link%" class="_im_mess_link" >%date%</a>',im_dialogs_none:'<li data-list-id="002300" class="im-page--dialogs-empty"> %msg%</li>',im_dialogs_message_requests_button:'<li class="im-page--dialogs-message-requests-button _im_toggle_mr_tab" data-list-id="%list_id%"> %msg%</li>',im_dialogs_message_requests_notice:'<li class="im-page--dialogs-message-requests-notice-w" data-list-id="message_request_notice"> <div class="im-page--dialogs-message-requests-notice"> %msg% </div> </li>',im_filter:'<a class="im-page--dialogs-filter %cls%">%filter%</a>',im_drow_prebody:'<span class="nim-dialog--who">%prebody%</span> <span class="nim-dialog--inner-text">%body%</span>',im_attach_mess:' <div class="im-fwd %modifier%"> <span class="im-fwd--title"> <span class="im-fwd--title-name">%text%</span> <span class="im-fwd--date">%date%</span></span> <span class="im-fwd--close _im_fwd_close"></span> <div rel="button" tab-index="0" type="button" class="im-fwd--messages _im_will_fwd">%messages%</div> </div>',im_preloader:'<div class="im-preloader %cls%"> %preloader%</div>',im_service_row:'<ul class="ui_clean_list"> <li class="im-mess im-mess_srv _im_mess _im_mess_srv _im_mess_%message_id%" data-msgid="%message_id%" data-from="%from_id%" data-ts="%date%"> <div class="im-mess--text">%text%</div> </li> </ul>',im_chat_members:'<button type="button" class="_im_chat_members im-page--members">%name%</button>',im_vkcomgroup_members:'<span class="im-page--members im-page--members--nohover">%name%</span>',im_mess_stack:'<div class="im-mess-stack _im_mess_stack %cls%" data-peer="%peerId%" data-admin="%admin%"> <div class="im-mess-stack--photo"> <div class="nim-peer nim-peer_small fl_l"> <div class="nim-peer--photo-w"> <div class="nim-peer--photo"> <a target="_blank" class="im_grid" href="%href%"><img alt="%name%" src="%photo%" /></a> </div> </div> </div> </div> <div class="im-mess-stack--content"> <div class="im-mess-stack--info"> <div class="im-mess-stack--pname"> %stack_name% <span class="im-mess-stack--tools">%messageMeta%</span> </div> </div> <ul class="ui_clean_list im-mess-stack--mess _im_stack_messages"> %messages% </ul> </div> </div>',im_mess_stack_name:'<a href="%link%" class="im-mess-stack--lnk%class%" title="" target="_blank">%name%</a>',im_message_media:'<div class="_im_msg_%type%%messageId%" class="wall_module">%attaches%</div>%text%',im_dialog_media:'<span class="nim-dialog--preview nim-dialog--preview-attach">%name%</span>',im_typing:'<div class="im-page--typing _im_typing"> <div class="im-activity %cls%"><div class="pr im-activity--icon"><div class="pr_bt"></div><div class="pr_bt"></div><div class="pr_bt"></div></div><span class="_im_typing_name">&nbsp;</span></div> </div>',ctrl_submit_hint:function(){return'<div class="reply_submit_hint_wrap" >\n  <div class="reply_submit_hint_title">'+getLang("wall_reply_submit_settings")+'</div>\n  <div class="reply_submit_hint_opts" id="">\n    <div class="radiobtn %enter_on% _im_submit_btn" data-val="0" onclick="radiobtn(this, 0, \'im_submit\'); "><div class="radiobtn_label">'+getLang("wall_reply_submit_settings_1")+'</div></div>\n    <div class="radiobtn %ctrl_on% _im_submit_btn" data-val="1" onclick="radiobtn(this, 1, \'im_submit\'); "><div class="radiobtn_label">'+getLang("wall_reply_submit_settings_2")+"</div></div>\n  </div>\n</div>"},im_day_bar:'<h5 class="im-page--history-new-bar im-page--history-new-bar_days _im_bar_date %day_class%" data-date="%date%"><span>%day%</span></h5>',im_mess_bar:function(){return'<h4 class="im-page--history-new-bar _im_unread_bar_row"><span>'+getLang("mail_new_unread_msgs")+"</span></h4>"},im_replied_message:'<div class="im-replied"> <div class="im-replied--photo-wrapper"></div> <div class="im-replied--content"> <div class="im-replied--author"> <span class="im-replied--author-link">%authorName%</span> </div> <div class="im-replied--text">%text%</div> </div> </div>',im_drow:function(){return'<li data-list-id="%peer%" class="nim-dialog _im_dialog _im_dialog_%peer% %is_unread% %is_unread_out% %is_selected% %more%" data-peer="%peer%" data-msgid="%msg_id%"> <div class="nim-dialog--photo"> <div class="nim-peer %is_online% _im_peer_online"> <div class="nim-peer--photo-w"> <div class="nim-peer--photo _im_dialog_photo"> %photo% </div> </div> </div> </div> <div class="nim-dialog--content"> <div class="nim-dialog--cw"> <span role="link" class="blind_label" aria-label="'+getLang("mail_im_to_multidialog")+': %tab_name%"></span> <div class="nim-dialog--date _im_dialog_date">%date%</div> <button type="button" class="nim-dialog--close _im_dialog_close" data-peer="%peer%"></button> <button type="button" class="nim-dialog--markre _im_dialog_markre"></button> <div class="nim-dialog--name"> <span class="nim-dialog--name-w _im_dialog_name_w" aria-hidden="true"> %user_link% </span> <span class="nim-dialog--verfifed _im_dialog_verified"></span> <span class="nim-dialog--casper _im_dialog_casper" aria-label="'+getLang("mail_casper_chat_label")+'" role="img" ></span> <span class="nim-dialog--mute"></span> <button type="button" class="nim-dialog--star _im_dialog_star"></button> <div class="nim-dialog--peer-tags _im_dialog_peer_tags PeerTags"></div> </div> <div class="nim-dialog--text-preview"> <span class="nim-dialog--preview _dialog_body" tabindex="0">%body%</span> <span class="nim-dialog--typing _im_dialog_typing"></span><span class="nim-dialog--typer-el"></span> </div> <div class="nim-dialog--unread_container"> <div class="nim-dialog--unread-badge_mention nim-dialog--unread-badge" aria-label="'+getLang("mail_mention_badge_label")+'" role="img"></div> <div class="nim-dialog--unread-badge_bomb nim-dialog--unread-badge" aria-label="'+getLang("mail_expiring_message_badge_label")+'" role="img"></div> <label class="blind_label _im_unread_blind_label">%unread_message_string%</label> <div class="nim-dialog--unread _im_dialog_unread_ct" aria-hidden="true">%unread%</div> </div> </div> </div> </li>'},im_conversation_search_row:function(){return'<li data-list-id="%peer%" class="nim-dialog nim-conversation-search-row _im_dialog _im_dialog_%peer% %is_unread% %is_selected% %more%" data-peer="%peer%" data-msgid="%msg_id%"> <div class="nim-dialog--photo"> <div class="nim-peer nim-peer_search %is_online% _im_peer_online"> <div class="nim-peer--photo-w"> <div class="nim-peer--photo _im_dialog_photo"> %photo% </div> </div> </div> </div> <div class="nim-dialog--content"> <div class="nim-dialog--cw"> <span role="link" class="blind_label" aria-label="'+getLang("mail_im_to_multidialog")+': %tab_name%"></span> <button type="button" class="nim-dialog--close _im_dialog_close" data-peer="%peer%"></button> <div class="nim-dialog--name"> <span class="nim-dialog--name-w" aria-hidden="true"> %user_link% </span> <span class="nim-dialog--casper _im_dialog_casper" aria-label="'+getLang("mail_casper_chat_label")+'"></span> </div> <div class="nim-dialog--unread_container"> <div class="nim-dialog--unread-badge_mention nim-dialog--unread-badge" aria-label="'+getLang("mail_mention_badge_label")+'" role="img"></div> <div class="nim-dialog--unread-badge_bomb nim-dialog--unread-badge" aria-label="'+getLang("mail_expiring_message_badge_label")+'" role="img"></div> <div class="nim-dialog--unread _im_dialog_unread_ct" aria-hidden="true">%unread%</div> </div> </div> </div> </li>'},im_delete_actions:function(){return'<span class="nim-dialog--who">%text%</span> <button class="nim-dialog--daction ui_bullet _im_dialog_daction" data-sid=%spam_id% data-peer="%peer%" data-action="restore" type="button">'+getLang("mail_restore")+'</button> <button class="nim-dialog--daction ui_bullet _im_dialog_daction" data-sid=%spam_id% data-peer="%peer%" data-action="spam" type="button">'+getLang("mail_im_mark_spam")+'</button> <button class="nim-dialog--daction nim-dialog--daction_last _im_dialog_daction" data-sid=%spam_id% data-peer="%peer%" data-action="block" type="button">'+getLang("mail_user_black_list")+"</button>"},im_chat_change_topic:function(){return'<div class="im_change_topic_wrap clear_fix"> <div class="im_change_topic_label fl_l ta_r">'+getLang("mail_chat_topic_change_label")+'</div> <div class="im_change_topic_labeled fl_l"> <input class="text _im_chat_topic_change_input" value="%value%"/> </div> </div>'},im_msg_row:function(){return'<li class="im-mess %cls% _im_mess_noa _im_mess_%msg_id%" aria-hidden="%aria_hidden%" data-ts="%ts%" data-msgid="%msg_id%" data-peer="%from_id%"> <div class="im-mess--text wall_module _im_log_body">%text%</div> <span tabindex="0" role="link" aria-label="'+getLang("mail_select_message")+'" class="blind_label im-mess--blind-select _im_mess_blind_label_select"></span> <span class="blind_label im-mess--blind-read _im_mess_blind_unread_marker" %unread_params%></span> <span class="im-mess--marker _im_mess_marker" %marker_params%></span> </li>'},sImHistoryRowActions:function(){return'<div class="im-mess--actions"> <span role="link" aria-label="'+getLang("mail_im_mark_forward")+'" class="im-mess--forward _im_mess_forward"></span> <span role="link" aria-label="'+getLang("mail_im_reply")+'" class="im-mess--reply _im_mess_reply"></span> <span role="link" aria-label="'+getLang("mail_im_edit")+'" class="im-mess--edit _im_mess_edit"></span> <span role="link" aria-label="'+getLang("mail_important_message")+'" class="im-mess--fav _im_mess_fav"></span> </div> <div class="im-mess--check fl_l"></div>'},im_wrap_mobile:'<b class="mob_onl %class%" %attrs% onmouseover="mobileOnlineTip(this, {%params%})"></b>',im_pinned_message:'<div class="im-page-pinned _im_pinned_message"> <button class="im-page-pinned--hide _im_pin_hide"></button> <div class="im-page-pinned--meta"> <a href="%link%" target="_blank" class="im-page-pinned--name">%name%</a> <span class="im-page-pinned--date">%date%</span> </div> <div class="im-page-pinned--content">%content%</div> </div>',im_pinned_message_media:'<span class="im-page-pinned--media">%text%</span>',im_pinned_message_media_bar:'<div class="im-page-pinned--media-bar">\n  <div class="im-page-pinned--media-bar_progress" style="width: %percent%%;"></div>\n</div>',im_pinned_messages_promo:'<div class="im-page--mess-actions-promo-content">%content%</div>',im_retry_link:function(){return'<button class="im-page--retry _im_retry_media">'+getLang("mail_retry")+"</button>"},sImLblWasEdited:function(){return" <span class='im-mess--lbl-was-edited _im_edit_time' data-time='%update_time%'>"+getLang("mail_was_edited_short")+"</span>"},sImLblWasSourceInfo:function(){return" <span class='im-mess--lbl-was-edited _im_page_info' data-info='%source%'>"+getLang("mail_was_source_short")+"</span>"},im_top_banner:'<div class="im-top-banner %classes%">\n  %icon%\n  <div class="im-top-banner--text">%text%</div>\n  <div class="im-top-banner--buttons">%buttons%</div>\n</div>',im_top_banner_icon:'<div class="im-top-banner--icon">\n  <img src="%icon%" alt=""/>\n</div>',im_top_banner_button_link:'<a href="%link%" target="_blank" class="_im_top_banner_button im-top-banner--button %css_class% flat_button button_small">%text%</a>',im_top_banner_button:'<button class="_im_top_banner_button im-top-banner--button %css_class% flat_button button_small" data-payload="%callback_data%">%text%</button>',im_top_banner_hide_btn:'<button class="im-top-banner--button im-top-banner--button_hide _im_top_banner_hide"></button>',im_calls_link:'<button class="im_srv_lnk_light _fc_call_link">%text%</button>',sImPeerMuteUnmute:'<a href="#" class="_im_peer_mute_unmute ui_actions_menu_item im-action nohover %cls%">%text%</a>',sImPeerAcceptOrRejectMessageRequest:function(){return"<p>"+getLang("mail_message_request_user_notice")+'</p> <p> <button type="button" class="flat_button %cls_accept%">'+getLang("mail_message_request_accept")+'</button> <button type="button" class="flat_button secondary %cls_reject%">'+getLang("mail_message_request_reject")+"</button> </p>"},sImPeerReturnToChat:'<a href="#" class="_im_peer_return_to_chat">%text%</a>',sImCallSnippet:'<article class="CallSnippet %classes%" %attributes%> <div class="CallSnippet__users">%user_list%</div> <div class="CallSnippet__content"> <h3 class="CallSnippet__title">%title%</h3> <div class="CallSnippet__desc">%description%</div> </div> %button%</article>',sImMessageKeyboard:'<div class="MessageKeyboard">%content%</div>',sImMessageKeyboardRow:'<div class="MessageKeyboard__row">%content%</div>',sImMessageKeyboardButton:' <span class="MessageKeyboard__cell"> <%tagName% class="MessageKeyboard__button MessageKeyboard__button--%modifier% Button Button--size-s Button--%appearance% _im_mess_btn" %attributes% > <span class="MessageKeyboard__label">%label%</span> </%tagName%> </span>',sImBomb:'<span class="im-mess-stack--bomb %classnames%"></span>',sImEmptyCasper:function(){return' <div class="im-page--casper-empty"> '+getLang("mail_im_empty_casper_chat")+" </div>"},sImExpiredMessagePlaceholder:' <div class="im-expired-message _im_expired_message %id_classes%" data-count="%count%"> <a href="/im?w=expired_messages" target="_blank" class="im-expired-message--in"> <span class="im-expired-message--inner">%text%</span> </a> </div>',sImGiftLabel:' <span class="im-mess-stack--gift">%content%</span>',sImMoneyTransferLabel:' <span class="im-mess-stack--money-transfer">%content%</span>',sImUiActionMenuItem:'<a tabindex="0" role="link" class="ui_actions_menu_item im-action im-action_%icon% %classes%" data-action="%action%"> %name%</a>',sImPeerTagsItem:' <div class="PeerTagsItem" style="background-color: %color%;">%name%</div>',sImPeerTagsAdTag:function(){return' <div class="PeerTagsItem PeerTagsItem--adTag %extra_class%"> <a href="%url%" target="_blank" class="PeerTagsItem__adTagLink"> <span class="PeerTagsItem__adTagText">%ad_tag_text%</span> </a> <button onclick="return showFastBox(\''+getLang("mail_ad_tag_no_access_box_title")+"', '"+getLang("mail_ad_tag_no_access_box_text")+'\');" class="PeerTagsItem__adTagAlert"> <span class="PeerTagsItem__adTagText">%ad_tag_text%</span> </button> </div>'},sImPeerTagsExtra:' <div class="PeerTagsItem PeerTagsItem--extra _im_peer_tags_extra">%text%</div>',sImPeerTagsExtraTooltipItem:' <div class="PeerTagsExtraTooltipItem"> <span class="PeerTagsExtraTooltipItem__color" style="background-color: %color%"></span> <span class="PeerTagsExtraTooltipItem__name">%name%</span> </div>',sImCallUser:'<img src="%url%" alt="%name%" class="CallUsers__user">',sImCallUsers:'<div class="CallUsers"> <svg xmlns="http://www.w3.org/2000/svg" class="CallUsers__hidden"> <defs> <clipPath id="user-frame"> <path d="M12 0a12 12 0 11-7.97 20.97C5.89 18.47 7 15.37 7 12c0-3.36-1.1-6.47-2.97-8.97A11.95 11.95 0 0112 0z"/> </clipPath> </defs> </svg> <figure class="CallUsers__list"> %users% </figure> </div>',sImCallBannerContent:'<article class="CallBanner %cls%"> <div class="CallBanner__users">%user_list%</div> <div class="CallBanner__content"> <h3 class="CallBanner__title">%title%</h3> <div class="CallBanner__desc">%desc%</div> </div> </article>',sImCallBannerButton:function(){return'<button class="_im_top_banner_button _im_call_banner_join_btn im-top-banner--button flat_button button_small secondary" data-link="%call_link%">'+getLang("mail_join_chat")+"</button>"}}},"fD+e":function(e,t,n){"use strict";n.r(t),n.d(t,"TemplatesDropDown",(function(){return d}));var a=n("q1tI"),r=(n("17x9"),n("6aSF")),i=n("6krn"),s=n("MCfn"),o=n("BN/X"),l=n("ZxpX"),c=i.default.getLang;class d extends a.Component{constructor(){super(...arguments),this.elementOnClick=(e,t)=>{t.preventDefault(),t.stopPropagation(),this.props.applyTemplate(e),this.toggleDropdown(!1)},this.toggleDropdown=e=>{this.setState({isShowDropDown:e})},this.state={isShowDropDown:!1}}render(){var e=this.props,t=e.getTemplates,n=e.showSettingsPopup,i=e.showCreatingTemplatePopup,s=e.isNeededRendering,d=this.state.isShowDropDown;if(!s())return null;var u=t();return a.createElement("div",{className:"TemplatesDropDown",onMouseOver:this.toggleDropdown.bind(this,!0),onMouseOut:this.toggleDropdown.bind(this,!1)},a.createElement("div",{className:Object(l.classNames)("TemplatesDropDown__wrapper",{"TemplatesDropDown__wrapper--show":d}),"aria-hidden":d},a.createElement("div",{className:"TemplatesDropDown__container"},a.createElement(r.default,{className:"TemplatesDropDown__scroll-wrapper"},a.createElement("div",null," ",a.createElement("header",{className:"TemplatesDropDown__header"},a.createElement("h2",{className:"TemplatesDropDown__title"},c("mail_community_templates")),a.createElement("a",{role:"button",className:"TemplatesDropDown__setting-button",onClick:n},c("mail_settings_configure"))),u.length?a.createElement("ul",{className:"TemplatesDropDown__list"},u.map(e=>a.createElement("li",{key:e.id,className:"TemplatesDropDown__item",onMouseDown:this.elementOnClick.bind(null,e.id)},a.createElement("h3",{className:"TemplatesDropDown__item-name",dangerouslySetInnerHTML:{__html:e.name}}),a.createElement("div",{className:"TemplatesDropDown__item-content",dangerouslySetInnerHTML:{__html:e.text}})))):a.createElement("div",{className:"TemplatesDropDown__not-found-container"},a.createElement("span",null,c("mail_community_templates_not_found")),a.createElement(o.default,{onClick:i},c("mail_add_community_template"))))))),a.createElement("button",{className:"TemplatesDropDown__icon"}))}}t.default=Object(s.connect)(d)},g1O2:function(e,t,n){"use strict";n.r(t),n.d(t,"setHTML",(function(){return s}));n("91GP"),n("ioFf"),n("rGqo"),n("Btvt");var a=n("q1tI");n("17x9");function r(){return(r=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e}).apply(this,arguments)}function i(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},i=Object.keys(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function s(e,t){var n=!!window.getSelection&&window.getSelection(),a=!1;if(n&&n.rangeCount){var r=n.getRangeAt(0);a=r.commonAncestorContainer?r.commonAncestorContainer:r.parentElement?r.parentElement():r.item(0)}for(var i=a;i&&i!=e;)i=i.parentNode;i||Emoji.editableFocus(e,!1,!0),Emoji.insertHTML(t)}class o extends a.Component{constructor(){super(...arguments),this.onChange=()=>{this.props.onChange&&this.props.onChange(Emoji.val(this.container))},this.containerRef=a.createRef(),this.state={value:this.props.initialValue}}componentDidMount(){if(this.container=this.containerRef.current,this.container&&!this.isMount){this.isMount=!0;var e=this.props.initialValue;Emoji.val(this.container,Emoji.emojiToHTML(e)),Emoji.init(this.container,{noStickers:!0,onSend:()=>{},ctrlSend:()=>!0,onChange:this.onChange,noLineBreaks:!this.props.isMultiLine})}}componentWillUnmount(){this.container&&this.isMount&&(this.isMount=!1)}render(){var e=this.props,t=e.tabIndex,n=e.isMultiLine,s=(e.initialValue,i(e,["tabIndex","isMultiLine","initialValue"]));return a.createElement("div",r({role:"textbox",ref:this.containerRef,tabIndex:t,contentEditable:!0,"aria-multiline":n},s))}}o.defaultProps={isMultiLine:!1,tabIndex:0,initialValue:""},t.default=o},gF8j:function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return s})),n.d(t,"getVisibilityState",(function(){return c})),n.d(t,"getVisiblityEvent",(function(){return d}));var a=n("uQjJ"),r=n("PU8N"),i=browser.iphone||browser.ipad||browser.ipod;function s(e){this.started=!1,this.is_idle=!0,this.activeTimeStart=null,this.cbActiveB=this.cbActive.bind(this),this.cbInactiveB=this.cbInactive.bind(this),this.onVisiblityChange=this.onVisiblityChange.bind(this),this.opts=extend({triggerEvents:"mousemove keydown",onIdleCb:function(){},onUnIdleCb:function(){},focusElement:e.element,element:null,idleTimeout:3e4},e)}function o(e,t,n){Object(r.isMvk)()?window.addEvent(e,t,n,{passive:!0}):window.addEvent(e,t,n)}function l(e,t,n){Object(r.isMvk)()?window.removeEvent(e,t,n,{passive:!0}):window.removeEvent(e,t,n)}function c(){return document.visibilityState||document.webkitVisibilityState}function d(){var e="visibilitychange";return document.visibilityState||(document.webkitVisibilityState?e+="webkit":e=""),e}extend(s.prototype,a.default.prototype),extend(s.prototype,{stop:function(){this.started=!1,l(this.opts.element,this.opts.triggerEvents,this.cbActiveB),Object(r.isMvk)()&&this._isTopLevel()&&d()&&l(document,d(),this.onVisiblityChange),Object(r.isMvk)()&&i||(l(this.opts.focusElement,"focus",this.cbActiveB),l(this.opts.focusElement,"blur",this.cbInactiveB)),clearTimeout(this.setIdleTo),clearTimeout(this.checkIdleCbTo),clearTimeout(this.sendCbTO),this.is_idle=!0,this.opts.parentManager&&this.opts.parentManager.off("idle",this.cbInactiveB)},idle:function(e){this.is_idle=!0,e||this.opts.onIdleCb(),this.emit("idle")},unidle:function(e){this.is_idle=!1,e||this.opts.onUnIdleCb(),this.emit("unidle")},start:function(){this.started=!0,!Object(r.isMvk)()&&browser.mobile||(this.is_idle=!this._isFocused(),this.opts.parentManager&&this.opts.parentManager.on("idle",this.cbInactiveB),Object(r.isMvk)()&&this._isTopLevel()&&d()&&o(document,d(),this.onVisiblityChange),Object(r.isMvk)()&&i||(o(this.opts.focusElement,"focus",this.cbActiveB),o(this.opts.focusElement,"blur",this.cbInactiveB)),clearTimeout(this.checkIdleCbTo),this.checkIdleCb(),this.checkIdleCbTo=setTimeout(this.checkIdleCb.bind(this),this.opts.idleTimeout))},checkIdleCb:function(){this.started&&(o(this.opts.element,this.opts.triggerEvents,this.cbActiveB),clearTimeout(this.setIdleTo),this.setIdleTo=setTimeout(this.cbInactiveB,this.opts.idleTimeout))},cbActive:function(){this.started&&(this.activeTimeStart=(new Date).getTime(),clearTimeout(this.setIdleTo),this.is_idle&&(this.is_idle=!1,clearTimeout(this.sendCbTO),this.sendCbTO=setTimeout(function(){this.emit("unidle"),this.opts.onUnIdleCb&&this.opts.onUnIdleCb()}.bind(this),100)),l(this.opts.element,this.opts.triggerEvents,this.cbActiveB),clearTimeout(this.checkIdleCbTo),this.checkIdleCbTo=setTimeout(this.checkIdleCb.bind(this),this.opts.idleTimeout))},cbInactive:function(){this.started&&(this.activeTimeStart=null,this.is_idle||(this.is_idle=!0,clearTimeout(this.sendCbTO),this.sendCbTO=setTimeout(function(){this.emit("idle"),this.opts.onIdleCb&&this.opts.onIdleCb()}.bind(this),100)),clearTimeout(this.checkIdleCbTo),l(this.opts.element,this.opts.triggerEvents,this.cbActiveB),o(this.opts.element,this.opts.triggerEvents,this.cbActiveB),this.checkIdleCbTo=setTimeout(this.checkIdleCb,this.opts.idleTimeout))},getActiveTime(){return!this.is_idle&&this.activeTimeStart?(new Date).getTime()-this.activeTimeStart:0},onVisiblityChange(){"visible"===c()?this.cbActiveB():this.cbInactiveB()},_isTopLevel(){var e=this.opts.focusElement;return e===window||e===document},_isFocused(){var e=this.opts.focusElement;if(this._isTopLevel()){var t=c();return"string"==typeof t&&"visible"===t}return document.activeElement===e}})},giDR:function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return o}));n("91GP"),n("ioFf"),n("rGqo"),n("Btvt");var a=n("q1tI"),r=(n("17x9"),n("ZxpX"));function i(){return(i=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e}).apply(this,arguments)}function s(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},i=Object.keys(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}class o extends a.Component{constructor(){super(...arguments),this.onChange=e=>{var t=this.props.onChange;t&&(this.props.native?t(e):t(this.props.name,e.target.checked))}}render(){var e=this.props,t=e.children,n=e.checked,o=e.disabled,l=e.name,c=e.type,d=void 0===c?"checkbox":c,u=e.id,g=s(e,["children","checked","disabled","name","type","id"]),m=Object(r.classNames)("Switch",g.className,{"Switch--disabled":o,"Switch--last":!t});return a.createElement("label",{className:m,htmlFor:u,tabIndex:"-1","aria-checked":!!n,role:"checkbox"},a.createElement("input",i({},g,{className:"Switch__input",id:u,type:d,checked:n,name:l,disabled:o,onChange:this.onChange})),a.createElement("span",{className:"Switch__indicator","aria-hidden":!0}),t)}}},gqqU:function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return i}));var a=n("q1tI"),r=(n("17x9"),n("ZxpX"));function i(e){return a.createElement("header",{className:Object(r.classNames)("PopupHeader",e.className),style:e.style},e.back&&a.createElement("div",{className:"PopupHeader__back",onClick:e.onBackClick},a.createElement("button",{className:"PopupHeader__backBtn",onClick:e.onBackClick},e.back)),a.createElement("h2",{className:"PopupHeader__title"},e.title),a.createElement("div",{className:"PopupHeader__close"},a.createElement("button",{className:"PopupHeader__closeBtn",onClick:e.onCloseClick})))}i.defaultProps={back:null,title:"",onCloseClick:()=>{}}},grKM:function(e,t,n){"use strict";n.r(t),n.d(t,"BlockSearchInput",(function(){return c}));var a=n("q1tI"),r=n.n(a),i=n("ZxpX"),s=n("dLHM"),o=function(){return(o=Object.assign||function(e){for(var t,n=1,a=arguments.length;n<a;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)},l=function(e,t){var n={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(n[a]=e[a]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(a=Object.getOwnPropertySymbols(e);r<a.length;r++)t.indexOf(a[r])<0&&Object.prototype.propertyIsEnumerable.call(e,a[r])&&(n[a[r]]=e[a[r]])}return n},c=Object(a.forwardRef)((function(e,t){var n=e.className,a=l(e,["className"]);return r.a.createElement(s.default,o({},a,{className:Object(i.classNames)(n,"BlockSearchInput"),ref:t}))}))},"h++7":function(e,t,n){"use strict";n.r(t),n.d(t,"OUR_DOMAINS",(function(){return a})),n.d(t,"ENTITIES",(function(){return r})),n.d(t,"VK_DOMAIN",(function(){return i})),n.d(t,"MENTION",(function(){return s})),n.d(t,"MENTION_RAW",(function(){return o})),n.d(t,"ARROW_UP",(function(){return l})),n.d(t,"ARROW_DOWN",(function(){return c})),n.d(t,"PAGE_UP",(function(){return d})),n.d(t,"PAGE_DOWN",(function(){return u})),n.d(t,"END_KEY",(function(){return g})),n.d(t,"HOME",(function(){return m})),n.d(t,"ENTER",(function(){return _})),n.d(t,"ESC",(function(){return p})),n.d(t,"UNPRINTABLE_KEYS",(function(){return h})),n.d(t,"UP_DOWN_CONTROLS",(function(){return f})),n.d(t,"PRINTABLE",(function(){return b})),n.d(t,"FOLDER_UNREAD",(function(){return v})),n.d(t,"FOLDER_ALL",(function(){return O})),n.d(t,"FOLDER_UNRESPOND",(function(){return y})),n.d(t,"FOLDER_IMPORTANT",(function(){return C})),n.d(t,"FOLDER_MESSAGE_REQUEST",(function(){return E})),n.d(t,"FOLDER_MESSAGE_REQUEST_REJECTED",(function(){return j})),n.d(t,"FOLDER_AD_TAG",(function(){return T})),n.d(t,"FOLDER_MARKED_UNREAD",(function(){return S})),n.d(t,"FOLDERS",(function(){return I})),n.d(t,"FOLDER_MASKS",(function(){return A})),n.d(t,"TOP_DOMAINS",(function(){return w})),n.d(t,"MAX_DOMAIN_LENGTH",(function(){return L})),n.d(t,"EMAIL",(function(){return k})),n.d(t,"MESSAGE_REGEXP",(function(){return M})),n.d(t,"RE_HASHTAG_EXTRACTION_PATTERN",(function(){return P})),n.d(t,"MASS_MENTION_ALIASES",(function(){return D})),n.d(t,"RE_MASSMENTION",(function(){return R})),n.d(t,"LINE_FEED",(function(){return x}));n("Oyvg");var a=/^([a-zA-Z0-9\.\_\-]+\.)?(vkontakte\.ru|vk\.com|vkadre\.ru|vshtate\.ru|userapi\.com|vk\.me)$/,r=/([^a-zA-Z0-9#%;_\-.\/?&=\[\]])/g,i=/^(?:https?:\/\/)?(?:vk\.com|vkontakte\.ru)?\/([a-zA-Z0-9\._]+)\??$/,s=/\[(id|club)(\d+)(?:\:([a-z0-9_\-]+))?\|([^\$]+?)\]/g,o=/(^|[\s.,:\'\";>\)\(])(\*|@)([A-Za-z0-9_\.]{2,32})\s*\((.+?)\)/g,l=38,c=40,d=33,u=34,g=35,m=36,_=13,p=27,h=[l,c,d,u,_,p,g,m],f=[d,u,c,l,m,g],b="printable",v="unread",O="all",y="unrespond",C="important",E="mr",j="mr_rejected",T="ad_tag",S="marked_unread",I=[O,v,y,C,E,T],A={[y]:2,[C]:1,[E]:256,[j]:512,[T]:32768,[S]:1<<20},w=[].concat("aaa,aarp,abarth,abb,abbott,abbvie,abc,able,abogado,abudhabi,ac,academy,accenture,accountant,accountants,aco,active,actor,ad,adac,ads,adult,ae,aeg,aero,aetna,af,afamilycompany,afl,africa,ag,agakhan,agency,ai,aig,aigo,airbus,airforce,airtel,akdn,al,alfaromeo,alibaba,alipay,allfinanz,allstate,ally,alsace,alstom,am,americanexpress,americanfamily,amex,amfam,amica,amsterdam,an,analytics,android,anquan,anz,ao,aol,apartments,app,apple,aq,aquarelle,ar,aramco,archi,army,arpa,art,arte,as,asda,asia,associates,at,athleta,attorney,au,auction,audi,audible,audio,auspost,author,auto,autos,avianca,aw,aws,ax,axa,az,azure,ba,baby,baidu,banamex,bananarepublic,band,bank,bar,barcelona,barclaycard,barclays,barefoot,bargains,baseball,basketball,bauhaus,bayern,bb,bbc,bbt,bbva,bcg,bcn,bd,be,beats,beauty,beer,bentley,berlin,best,bestbuy,bet,bf,bg,bh,bharti,bi,bible,bid,bike,bing,bingo,bio,biz,bj,bl,black,blackfriday,blanco,blockbuster,blog,bloomberg,blue,bm,bms,bmw,bn,bnl,bnpparibas,bo,boats,boehringer,bofa,bom,bond,boo,book,booking,boots,bosch,bostik,boston,bot,boutique,box,bq,br,bradesco,bridgestone,broadway,broker,brother,brussels,bs,bt,budapest,bugatti,build,builders,business,buy,buzz,bv,bw,by,bz,bzh,ca,cab,cafe,cal,call,calvinklein,cam,camera,camp,cancerresearch,canon,capetown,capital,capitalone,car,caravan,cards,care,career,careers,cars,cartier,casa,case,caseih,cash,casino,cat,catering,catholic,cba,cbn,cbre,cbs,cc,cd,ceb,center,ceo,cern,cf,cfa,cfd,cg,ch,chanel,channel,chase,chat,cheap,chintai,chloe,christmas,chrome,chrysler,church,ci,cipriani,circle,cisco,citadel,citi,citic,city,cityeats,ck,cl,claims,cleaning,click,clinic,clinique,clothing,cloud,club,clubmed,cm,cn,co,coach,codes,coffee,college,cologne,com,comcast,commbank,community,company,compare,computer,comsec,condos,construction,consulting,contact,contractors,cooking,cookingchannel,cool,coop,corsica,country,coupon,coupons,courses,cr,credit,creditcard,creditunion,cricket,crown,crs,cruise,cruises,csc,cu,cuisinella,cv,cw,cx,cy,cymru,cyou,cz,dabur,dad,dance,data,date,dating,datsun,day,dclk,dds,de,deal,dealer,deals,degree,delivery,dell,deloitte,delta,democrat,dental,dentist,desi,design,dev,dhl,diamonds,diet,digital,direct,directory,discount,discover,dish,diy,dj,dk,dm,dnp,do,docs,doctor,dodge,dog,doha,domains,dot,download,drive,dtv,dubai,duck,dunlop,duns,dupont,durban,dvag,dvr,dz,earth,eat,ec,eco,edeka,edu,education,ee,eg,eh,email,emerck,energy,engineer,engineering,enterprises,epost,epson,equipment,er,ericsson,erni,es,esq,estate,esurance,et,eu,eurovision,eus,events,everbank,exchange,expert,exposed,express,extraspace,fage,fail,fairwinds,faith,family,fan,fans,farm,farmers,fashion,fast,fedex,feedback,ferrari,ferrero,fi,fiat,fidelity,fido,film,final,finance,financial,fire,firestone,firmdale,fish,fishing,fit,fitness,fj,fk,flickr,flights,flir,florist,flowers,fly,fm,fo,foo,food,foodnetwork,football,ford,forex,forsale,forum,foundation,fox,fr,free,fresenius,frl,frogans,frontdoor,frontier,ftr,fujitsu,fujixerox,fun,fund,furniture,futbol,fyi,ga,gal,gallery,gallo,gallup,game,games,gap,garden,gb,gbiz,gd,gdn,ge,gea,gent,genting,george,gf,gg,ggee,gh,gi,gift,gifts,gives,giving,gl,glade,glass,gle,global,globo,gm,gmail,gmbh,gmo,gmx,gn,godaddy,gold,goldpoint,golf,goo,goodhands,goodyear,goog,google,gop,got,gov,gp,gq,gr,grainger,graphics,gratis,green,gripe,group,gs,gt,gu,guardian,gucci,guge,guide,guitars,guru,gw,gy,hair,hamburg,hangout,haus,hbo,hdfc,hdfcbank,health,healthcare,help,helsinki,here,hermes,hgtv,hiphop,hisamitsu,hitachi,hiv,hk,hkt,hm,hn,hockey,holdings,holiday,homedepot,homegoods,homes,homesense,honda,honeywell,horse,hospital,host,hosting,hot,hoteles,hotmail,house,how,hr,hsbc,ht,htc,hu,hughes,hyatt,hyundai,ibm,icbc,ice,icu,id,ie,ieee,ifm,ikano,il,im,imamat,imdb,immo,immobilien,in,industries,infiniti,info,ing,ink,institute,insurance,insure,int,intel,international,intuit,investments,io,ipiranga,iq,ir,irish,is,iselect,ismaili,ist,istanbul,it,itau,itv,iveco,iwc,jaguar,java,jcb,jcp,je,jeep,jetzt,jewelry,jio,jlc,jll,jm,jmp,jnj,jo,jobs,joburg,jot,joy,jp,jpmorgan,jprs,juegos,juniper,kaufen,kddi,ke,kerryhotels,kerrylogistics,kerryproperties,kfh,kg,kh,ki,kia,kim,kinder,kindle,kitchen,kiwi,km,kn,koeln,komatsu,kosher,kp,kpmg,kpn,kr,krd,kred,kuokgroup,kw,ky,kyoto,kz,la,lacaixa,ladbrokes,lamborghini,lamer,lancaster,lancia,lancome,land,landrover,lanxess,lasalle,lat,latino,latrobe,law,lawyer,lb,lc,lds,lease,leclerc,lefrak,legal,lego,lexus,lgbt,li,liaison,lidl,life,lifeinsurance,lifestyle,lighting,like,lilly,limited,limo,lincoln,linde,link,lipsy,live,living,lixil,lk,loan,loans,local,locker,locus,loft,lol,london,lotte,lotto,love,lpl,lplfinancial,lr,ls,lt,ltd,ltda,lu,lundbeck,lupin,luxe,luxury,lv,ly,ma,macys,madrid,maif,maison,makeup,man,management,mango,market,marketing,markets,marriott,marshalls,maserati,mattel,mba,mc,mcd,mcdonalds,mckinsey,md,me,med,media,meet,melbourne,meme,memorial,men,menu,meo,metlife,mf,mg,mh,miami,microsoft,mil,mini,mint,mit,mitsubishi,mk,ml,mlb,mls,mm,mma,mn,mo,mobi,mobile,mobily,moda,moe,moi,mom,monash,money,monster,montblanc,mopar,mormon,mortgage,moscow,moto,motorcycles,mov,movie,movistar,mp,mq,mr,ms,msd,mt,mtn,mtpc,mtr,mu,museum,mutual,mv,mw,mx,my,mz,na,nab,nadex,nagoya,name,nationwide,natura,navy,nba,nc,ne,nec,net,netbank,netflix,network,neustar,new,newholland,news,next,nextdirect,nexus,nf,nfl,ng,ngo,nhk,ni,nico,nike,nikon,ninja,nissan,nissay,nl,no,nokia,northwesternmutual,norton,now,nowruz,nowtv,np,nr,nra,nrw,ntt,nu,nyc,nz,obi,observer,off,office,okinawa,olayan,olayangroup,oldnavy,ollo,om,omega,one,ong,onl,online,onyourside,ooo,open,oracle,orange,org,organic,orientexpress,origins,osaka,otsuka,ott,ovh,pa,page,pamperedchef,panasonic,panerai,paris,pars,partners,parts,party,passagens,pay,pccw,pe,pet,pf,pfizer,pg,ph,pharmacy,philips,phone,photo,photography,photos,physio,piaget,pics,pictet,pictures,pid,pin,ping,pink,pioneer,pizza,pk,pl,place,play,playstation,plumbing,plus,pm,pn,pnc,pohl,poker,politie,porn,post,pr,pramerica,praxi,press,prime,pro,prod,productions,prof,progressive,promo,properties,property,protection,pru,prudential,ps,pt,pub,pw,pwc,py,qa,qpon,quebec,quest,qvc,racing,radio,raid,re,read,realestate,realtor,realty,recipes,red,redstone,redumbrella,rehab,reise,reisen,reit,reliance,ren,rent,rentals,repair,report,republican,rest,restaurant,review,reviews,rexroth,rich,richardli,ricoh,rightathome,ril,rio,rip,rmit,ro,rocher,rocks,rodeo,rogers,room,rs,rsvp,ru,ruhr,run,rw,rwe,ryukyu,sa,saarland,safe,safety,sakura,sale,salon,samsclub,samsung,sandvik,sandvikcoromant,sanofi,sap,sapo,sarl,sas,save,saxo,sb,sbi,sbs,sc,sca,scb,schaeffler,schmidt,scholarships,school,schule,schwarz,science,scjohnson,scor,scot,sd,se,seat,secure,security,seek,select,sener,services,ses,seven,sew,sex,sexy,sfr,sg,sh,shangrila,sharp,shaw,shell,shia,shiksha,shoes,shop,shopping,shouji,show,showtime,shriram,si,silk,sina,singles,site,sj,sk,ski,skin,sky,skype,sl,sling,sm,smart,smile,sn,sncf,so,soccer,social,softbank,software,sohu,solar,solutions,song,sony,soy,space,spiegel,spot,spreadbetting,sr,srl,srt,ss,st,stada,staples,star,starhub,statebank,statefarm,statoil,stc,stcgroup,stockholm,storage,store,stream,studio,study,style,su,sucks,supplies,supply,support,surf,surgery,suzuki,sv,swatch,swiftcover,swiss,sx,sy,sydney,symantec,systems,sz,tab,taipei,talk,taobao,target,tatamotors,tatar,tattoo,tax,taxi,tc,tci,td,tdk,team,tech,technology,tel,telecity,telefonica,temasek,tennis,teva,tf,tg,th,thd,theater,theatre,tiaa,tickets,tienda,tiffany,tips,tires,tirol,tj,tjmaxx,tjx,tk,tkmaxx,tl,tm,tmall,tn,to,today,tokyo,tools,top,toray,toshiba,total,tours,town,toyota,toys,tp,tr,trade,trading,training,travel,travelchannel,travelers,travelersinsurance,trust,trv,tt,tube,tui,tunes,tushu,tv,tvs,tw,tz,ua,ubank,ubs,uconnect,ug,uk,um,unicom,university,uno,uol,ups,us,uy,uz,va,vacations,vana,vanguard,vc,ve,vegas,ventures,verisign,vermögensberater,vermögensberatung,versicherung,vet,vg,vi,viajes,video,vig,viking,villas,vin,vip,virgin,visa,vision,vista,vistaprint,viva,vivo,vlaanderen,vn,vodka,volkswagen,volvo,vote,voting,voto,voyage,vu,vuelos,wales,walmart,walter,wang,wanggou,warman,watch,watches,weather,weatherchannel,webcam,weber,website,wed,wedding,weibo,weir,wf,whoswho,wien,wiki,williamhill,win,windows,wine,winners,wme,wolterskluwer,woodside,work,works,world,wow,ws,wtc,wtf,xbox,xerox,xfinity,xihuan,xin,xperia,xxx,xyz,yachts,yahoo,yamaxun,yandex,ye,yodobashi,yoga,yokohama,you,youtube,yt,yu,yun,za,zappos,zara,zero,zip,zippo,zm,zone,zuerich,zw".split(","),"бг,бел,дети,ею,католик,ком,мкд,мон,москва,онлайн,орг,рус,рф,сайт,срб,укр".split(","),"qxam,90ae,90ais,d1acj3b,e1a4c,80aqecdr1a,j1aef,d1alf,l1acc,80adxhks,80asehdb,c1avg,p1acf,p1ai,80aswg,90a3ac,j1amh,80ao21a,y9a3aq,9dbq2a,mgbca7dzdo,mgba3a3ejt,mgbayh7gpa,lgbbat1ad8j,mgberp4a5d4ar,mgba7c0bbn0a,mgbc0a9azcg,mgb2ddes,mgbaam7a8h,mgba3a4f16a,mgbbh1a,mgbab2bd,ngbe9e0a,mgbbh1a71e,pgbs0dh,mgbpl2fh,ogbpf8fl,ngbc5azd,mgbtx2b,mgb9awbf,ygbi2ammx,wgbl6a,mgbi4ecexp,fhbei,wgbh1c,mgbx4cd0ab,mgbb9fbpob,4gbrim,mgbt3dhd,mgbai9azgqp6j,mgbgu82a,11b4c3d,c2br7g,h2brj9c,h2breg3eve,h2brj9c8c,i1b6b1a6a2e,54b7fta0cc,45brj9c,45br5cyl,s9brj9c,gecrj9c,3hcrj9c,xkc2dl3a5ee0h,xkc2al3hye2a,clchc0ea0b2g2a9gcd,fpcrj9c3d,2scrj9c,rvc1e0am3e,fzc2c9e2c,42c2d9a,o3cw4h,node,q9jyb4c,gckr3f0f,qcka1pmc,tckwe,cck2b3b,1ck2e1b,bck1b9a5dre4c,eckvdtc9d,rhqv96g,fiq64b,fiqs8s,fiqz9s,fiq228c5hs,vhquv,1qqw23a,vuq861b,nyqy26a,45q11c,55qx5d,55qw42g,kprw13d,kpry57d,czru2d,czrs0t,czr694b,w4rs40l,w4r85el8fhu5dnra,3ds443g,3oq18vl8pn36a,pssy2u,tiq49xqyj,fjq720a,fct429k,estv75g,xhq521b,9krt00a,30rr7y,6qq986b3xl,kput3i,kpu716f,zfr164b,mxtq1m,yfro4i67o,efvy88h,9et52u,rovu88b,nqv7f,b4w605ferd,unup4y,mix891f,mix082f,3pxu8k,pbt977c,6frz82g,nqv7fs00ema,ses554g,hxt814e,5tzm5g,io0a7i,8y0a063a,jlq61u9w7b,flw351e,g2xx48c,gk3at1e,3bst00m,fzys8d69uvgm,kcrx77d1x4a,jvr189m,imr513n,5su34j936bgsg,j6w193g,t60b56a,mk1bu44c,cg4bki,3e0b707e".split(",").map(e=>"xn--"+e)),L=w.reduce((e,t)=>Math.max(e,t.length),0),k=new RegExp("([a-zA-Zа-яА-Я\\-_\\.0-9\\+]+@(((?:[\\w\\$А-Яа-яёЁєЄҐґЇїІіЈј\\—\\-\\_]+\\.){1,5})([A-Za-zа-яА-Я\\-\\d]{2,22})))","ig"),M=new RegExp("(https?:\\/\\/)?(((?:[\\w\\$А-Яа-яёЁєЄҐґЇїІіЈј\\—\\-\\_]+\\.){1,5})([A-Za-zа-яА-Я\\-\\d]{2,22})(?:\\:(\\d{2,5}))?)(([\\/?#])(?:\\&amp;|\\&#\\d{2,6};|,[_%]|!|,*[\\wА-Яа-я\\xa8\\xb8\\xc0-\\xffєЄҐґЇїІіЈј\\—\\-\\_@#%?+\\/\\$.~=;:'ªµºÀ-ÖØ-öø-ˁˆ-ˑˠ-ˤˬˮͰ-ʹͶͷͺ-ͽͿΆΈ-ΊΌΎ-ΡΣ-ϵϷ-ҁҊ-ԯԱ-Ֆՙա-ևא-תװ-ײؠ-يٮٯٱ-ۓەۥۦۮۯۺ-ۼۿܐܒ-ܯݍ-ޥޱߊ-ߪߴߵߺࠀ-ࠕࠚࠤࠨࡀ-ࡘࢠ-ࢴࢶ-ࢽऄ-हऽॐक़-ॡॱ-ঀঅ-ঌএঐও-নপ-রলশ-হঽৎড়ঢ়য়-ৡৰৱਅ-ਊਏਐਓ-ਨਪ-ਰਲਲ਼ਵਸ਼ਸਹਖ਼-ੜਫ਼ੲ-ੴઅ-ઍએ-ઑઓ-નપ-રલળવ-હઽૐૠૡૹଅ-ଌଏଐଓ-ନପ-ରଲଳଵ-ହଽଡ଼ଢ଼ୟ-ୡୱஃஅ-ஊஎ-ஐஒ-கஙசஜஞடணதந-பம-ஹௐఅ-ఌఎ-ఐఒ-నప-హఽౘ-ౚౠౡಀಅ-ಌಎ-ಐಒ-ನಪ-ಳವ-ಹಽೞೠೡೱೲഅ-ഌഎ-ഐഒ-ഺഽൎൔ-ൖൟ-ൡൺ-ൿඅ-ඖක-නඳ-රලව-ෆก-ะาำเ-ๆກຂຄງຈຊຍດ-ທນ-ຟມ-ຣລວສຫອ-ະາຳຽເ-ໄໆໜ-ໟༀཀ-ཇཉ-ཬྈ-ྌက-ဪဿၐ-ၕၚ-ၝၡၥၦၮ-ၰၵ-ႁႎႠ-ჅჇჍა-ჺჼ-ቈቊ-ቍቐ-ቖቘቚ-ቝበ-ኈኊ-ኍነ-ኰኲ-ኵኸ-ኾዀዂ-ዅወ-ዖዘ-ጐጒ-ጕጘ-ፚᎀ-ᎏᎠ-Ᏽᏸ-ᏽᐁ-ᙬᙯ-ᙿᚁ-ᚚᚠ-ᛪᛱ-ᛸᜀ-ᜌᜎ-ᜑᜠ-ᜱᝀ-ᝑᝠ-ᝬᝮ-ᝰក-ឳៗៜᠠ-ᡷᢀ-ᢄᢇ-ᢨᢪᢰ-ᣵᤀ-ᤞᥐ-ᥭᥰ-ᥴᦀ-ᦫᦰ-ᧉᨀ-ᨖᨠ-ᩔᪧᬅ-ᬳᭅ-ᭋᮃ-ᮠᮮᮯᮺ-ᯥᰀ-ᰣᱍ-ᱏᱚ-ᱽᲀ-ᲈᳩ-ᳬᳮ-ᳱᳵᳶᴀ-ᶿḀ-ἕἘ-Ἕἠ-ὅὈ-Ὅὐ-ὗὙὛὝὟ-ώᾀ-ᾴᾶ-ᾼιῂ-ῄῆ-ῌῐ-ΐῖ-Ίῠ-Ῥῲ-ῴῶ-ῼⁱⁿₐ-ₜℂℇℊ-ℓℕℙ-ℝℤΩℨK-ℭℯ-ℹℼ-ℿⅅ-ⅉⅎↃↄⰀ-Ⱞⰰ-ⱞⱠ-ⳤⳫ-ⳮⳲⳳⴀ-ⴥⴧⴭⴰ-ⵧⵯⶀ-ⶖⶠ-ⶦⶨ-ⶮⶰ-ⶶⶸ-ⶾⷀ-ⷆⷈ-ⷎⷐ-ⷖⷘ-ⷞⸯ々〆〱-〵〻〼ぁ-ゖゝ-ゟァ-ヺー-ヿㄅ-ㄭㄱ-ㆎㆠ-ㆺㇰ-ㇿ㐀-䶵一-鿕ꀀ-ꒌꓐ-ꓽꔀ-ꘌꘐ-ꘟꘪꘫꙀ-ꙮꙿ-ꚝꚠ-ꛥꜗ-ꜟꜢ-ꞈꞋ-ꞮꞰ-ꞷꟷ-ꠁꠃ-ꠅꠇ-ꠊꠌ-ꠢꡀ-ꡳꢂ-ꢳꣲ-ꣷꣻꣽꤊ-ꤥꤰ-ꥆꥠ-ꥼꦄ-ꦲꧏꧠ-ꧤꧦ-ꧯꧺ-ꧾꨀ-ꨨꩀ-ꩂꩄ-ꩋꩠ-ꩶꩺꩾ-ꪯꪱꪵꪶꪹ-ꪽꫀꫂꫛ-ꫝꫠ-ꫪꫲ-ꫴꬁ-ꬆꬉ-ꬎꬑ-ꬖꬠ-ꬦꬨ-ꬮꬰ-ꭚꭜ-ꭥꭰ-ꯢ가-힣ힰ-ퟆퟋ-ퟻ豈-舘並-龎ﬀ-ﬆﬓ-ﬗיִײַ-ﬨשׁ-זּטּ-לּמּנּסּףּפּצּ-ﮱﯓ-ﴽﵐ-ﶏﶒ-ﷇﷰ-ﷻﹰ-ﹴﹶ-ﻼＡ-Ｚａ-ｚｦ-ﾾￂ-ￇￊ-ￏￒ-ￗￚ-ￜ　-〿＀-￯*]+|(?:\\(|\\[)[\\w\\$А-Яа-яёЁєЄҐґЇїІіЈј\\d&#%;,]+(?:\\)|\\])){0,200})?","ig"),N="(?:[a-zA-Zа-яА-ЯёіјєїґўЁІЈЄЇҐЎ’_\\d]|(?:&#(?:19[2-9]|(?:[2-9]|1[0-3])[0-9][0-9]);?))",P=`(^|[s.,:'";>)(]?)(${`(#${N}{0,100}(?:[a-zA-Zа-яА-ЯёіјєїґўЁІЈЄЇҐЎ’]|(?:&#(?:19[2-9]|(?:[2-9]|1[0-3])[0-9][0-9]);?))${N}{0,100})`})(@((?:[a-z0-9_]*[a-z0-9])?(?:(?:.[a-z](?:[a-z0-9_]+[a-z0-9])?)*.[a-z][a-z0-9_]{2,40}[a-z0-9])?))?(?=$|[s.,:'"&;?<)(]?)`,D={all:["all","everyone","все"],online:["online","here","здесь","тут"]},R=new RegExp(['(?!,|;|:|\\.|\\s|"|\\(|\\)|\\[|\\]|!|\\?)',"(",[].concat(D.all).concat(D.online).map(e=>`@${e}|\\*${e}`).join("|"),")",'(?=$|,|;|:|\\.(?![a-z0-9_-])|\\s|"|\\(|\\)|\\[|\\]|!|\\?)'].join(""),"gi"),x=10},hIV1:function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return i}));var a=n("q1tI"),r=n("ZxpX");function i(e){var t={"SubmitArea--left":!e.alignment||"left"===e.alignment,"SubmitArea--center":"center"===e.alignment,"SubmitArea--right":"right"===e.alignment};return a.createElement("div",{className:Object(r.classNames)("SubmitArea",t,e.className),style:e.style},e.children)}},hOuX:function(e,t,n){"use strict";n.r(t),n.d(t,"MAX_SAFE_INTEGER",(function(){return a})),n.d(t,"MAX_INTERGER",(function(){return r})),n.d(t,"random",(function(){return i}));n("tuSo");var a=9007199254740991,r=2147483647;function i(){try{if(window.crypto){var e=new Int32Array(1);return crypto.getRandomValues(e),Math.abs(e.reduce((e,t)=>e+t))}}catch(e){}return intval(rand(0,r).toFixed(0))}},iukX:function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return b}));n("OEbY");var a=n("q1tI"),r=n("6krn"),i=n("enZq"),s=n("xGYt"),o=n("aFGQ"),l=n("Ht+d"),c=n("6raB"),d=n("hIV1"),u=n("/cSr"),g=(n("17x9"),n("ZxpX")),m=149946368,_=0;class p extends a.Component{constructor(e){super(e),this.selectPreset=(e,t)=>{var n=3===this.state.selectedPresetId&&null!==this.state.customFlags;this.setState(e=>({selectedPresetId:t,customFlags:n?this.props.flags:e.customFlags})),this.props.onSelectPreset(e)};var t=this.props.flags===m?2:this.props.flags===_?1:3;this.state={customFlags:3===t?this.props.flags:null,selectedPresetId:t}}componentWillReceiveProps(e){![_,m].includes(e.flags)&&this.setState({customFlags:e.flags,selectedPresetId:3})}render(){var e=this.state.customFlags?this.state.customFlags:this.props.flags,t=this.state.selectedPresetId,n=[{id:1,title:Object(r.getLang)("mail_chat_creation_preset_regular"),icon:"regular",flags:_},{id:2,title:Object(r.getLang)("mail_chat_creation_preset_closed"),icon:"closed",flags:m},{id:3,title:Object(r.getLang)("mail_chat_creation_preset_custom"),icon:"custom",flags:e}];return a.createElement("div",{className:"ChatSettingsPresetPanel"},n.map((e,n)=>a.createElement("div",{className:Object(g.classNames)("ChatSettingsPresetPanel__preset",{"ChatSettingsPresetPanel__preset--selected":e.id===t}),onClick:this.selectPreset.bind(null,e.flags,e.id),key:n},a.createElement("div",{className:Object(g.classNames)("ChatSettingsPresetPanel__presetIcon","ChatSettingsPresetPanel__presetIcon--"+e.icon)}),a.createElement("div",{className:"ChatSettingsPresetPanel__presetTitle"},e.title))))}}var h=n("lJdi"),f=r.default.getLang;class b extends a.Component{constructor(e){super(e),this.onChange=e=>{var t=e.name,n=e.selected.value;this.setState(e=>({flags:n?e.flags&~t^n:e.flags&~t}))},this.onCancel=()=>{this.setState({flags:this.props.flags}),this.props.back()},this.onSave=()=>{this.state.loading||(this.setState({loading:!0}),this.props.onSave(this.state.flags).then(()=>{this.setState({loading:!1},this.props.afterSave)}).catch(e=>{this.setState({loading:!1,flags:this.props.flags})}))},this.setFlags=e=>{this.setState({flags:e})},this.isAllowed=e=>{var t=this.props.allowedUpdateFlags;return!t||t.includes(e)},this.state={flags:e.flags,loading:!1}}render(){var e=this.state.flags,t=this.props,n=t.isChatTypeEditAllowed,r=t.isCasperChatTab,g=t.isCommunityChat,m=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return[!g&&{value:e,label:f("mail_settings_only_owner")},{value:t,label:f(g?"mail_settings_only_admins":"mail_settings_owner_and_admins")},{value:n,label:f("mail_settings_all_members")}].filter(Boolean)};return a.createElement("div",{className:"ChatSettingsOptions"},this.props.isChatCreation&&a.createElement(p,{flags:e,onSelectPreset:this.setFlags}),a.createElement(i.default,null,(this.isAllowed(h.MAIL_CHAT_FLAG_ONLY_ADMINS_CAN_INVITE)||this.isAllowed(h.MAIL_CHAT_FLAG_ONLY_OWNER_CAN_INVITE))&&a.createElement(s.default,{selectable:!1,aside:a.createElement(o.default,{className:"ChatSettingsOptions__longselect",onChange:this.onChange,name:h.MAIL_CHAT_FLAG_ONLY_OWNER_CAN_INVITE+h.MAIL_CHAT_FLAG_ONLY_ADMINS_CAN_INVITE,options:m(h.MAIL_CHAT_FLAG_ONLY_OWNER_CAN_INVITE,h.MAIL_CHAT_FLAG_ONLY_ADMINS_CAN_INVITE),value:e&(h.MAIL_CHAT_FLAG_ONLY_OWNER_CAN_INVITE|h.MAIL_CHAT_FLAG_ONLY_ADMINS_CAN_INVITE)})},a.createElement(u.default,{type:"plus",backgroundColor:"green"}),f("mail_settings_can_invite")),(this.isAllowed(h.MAIL_CHAT_FLAG_ONLY_ADMINS_CAN_CHANGE_TITLE)||this.isAllowed(h.MAIL_CHAT_FLAG_ONLY_OWNER_CAN_CHANGE_TITLE))&&a.createElement(s.default,{selectable:!1,aside:a.createElement(o.default,{className:"ChatSettingsOptions__longselect",onChange:this.onChange,name:h.MAIL_CHAT_FLAG_ONLY_OWNER_CAN_CHANGE_TITLE+h.MAIL_CHAT_FLAG_ONLY_ADMINS_CAN_CHANGE_TITLE,options:m(h.MAIL_CHAT_FLAG_ONLY_OWNER_CAN_CHANGE_TITLE,h.MAIL_CHAT_FLAG_ONLY_ADMINS_CAN_CHANGE_TITLE),value:e&(h.MAIL_CHAT_FLAG_ONLY_OWNER_CAN_CHANGE_TITLE|h.MAIL_CHAT_FLAG_ONLY_ADMINS_CAN_CHANGE_TITLE)})},a.createElement(u.default,{type:"pencil",backgroundColor:"blue"}),f("mail_settings_can_edit_info")),(this.isAllowed(h.MAIL_CHAT_FLAG_ONLY_ADMINS_CAN_PIN)||this.isAllowed(h.MAIL_CHAT_FLAG_ONLY_ADMINS_CAN_PIN))&&!r&&a.createElement(s.default,{selectable:!1,aside:a.createElement(o.default,{className:"ChatSettingsOptions__longselect",onChange:this.onChange,name:h.MAIL_CHAT_FLAG_ONLY_OWNER_CAN_PIN+h.MAIL_CHAT_FLAG_ONLY_ADMINS_CAN_PIN,options:m(h.MAIL_CHAT_FLAG_ONLY_OWNER_CAN_PIN,h.MAIL_CHAT_FLAG_ONLY_ADMINS_CAN_PIN),value:e&(h.MAIL_CHAT_FLAG_ONLY_OWNER_CAN_PIN|h.MAIL_CHAT_FLAG_ONLY_ADMINS_CAN_PIN)})},a.createElement(u.default,{type:"pin",backgroundColor:"blue"}),f("mail_settings_can_pin")),(this.isAllowed(h.MAIL_CHAT_FLAG_ONLY_ADMINS_CAN_MASS_MENTION)||this.isAllowed(h.MAIL_CHAT_FLAG_ONLY_OWNER_CAN_MASS_MENTION))&&a.createElement(s.default,{selectable:!1,aside:a.createElement(o.default,{className:"ChatSettingsOptions__longselect",onChange:this.onChange,name:h.MAIL_CHAT_FLAG_ONLY_OWNER_CAN_MASS_MENTION+h.MAIL_CHAT_FLAG_ONLY_ADMINS_CAN_MASS_MENTION,options:m(h.MAIL_CHAT_FLAG_ONLY_OWNER_CAN_MASS_MENTION,h.MAIL_CHAT_FLAG_ONLY_ADMINS_CAN_MASS_MENTION),value:e&(h.MAIL_CHAT_FLAG_ONLY_OWNER_CAN_MASS_MENTION|h.MAIL_CHAT_FLAG_ONLY_ADMINS_CAN_MASS_MENTION)})},a.createElement(u.default,{type:"mention",backgroundColor:"blue"}),f("mail_settings_can_use_mass_mention")),(this.isAllowed(h.MAIL_CHAT_FLAG_ONLY_ADMINS_CAN_SEE_INVITE_LINK)||this.isAllowed(h.MAIL_CHAT_FLAG_ONLY_OWNER_CAN_SEE_INVITE_LINK))&&a.createElement(s.default,{selectable:!1,aside:a.createElement(o.default,{className:"ChatSettingsOptions__longselect",onChange:this.onChange,name:h.MAIL_CHAT_FLAG_ONLY_OWNER_CAN_SEE_INVITE_LINK+h.MAIL_CHAT_FLAG_ONLY_ADMINS_CAN_SEE_INVITE_LINK,options:m(0,h.MAIL_CHAT_FLAG_ONLY_ADMINS_CAN_SEE_INVITE_LINK,h.MAIL_CHAT_FLAG_ONLY_OWNER_CAN_SEE_INVITE_LINK),value:e&(h.MAIL_CHAT_FLAG_ONLY_OWNER_CAN_SEE_INVITE_LINK|h.MAIL_CHAT_FLAG_ONLY_ADMINS_CAN_SEE_INVITE_LINK)})},a.createElement(u.default,{type:"link",backgroundColor:"blue"}),f("mail_settings_can_see_invitation_link")),(this.isAllowed(h.MAIL_CHAT_FLAG_ONLY_ADMINS_CAN_CALL)||this.isAllowed(h.MAIL_CHAT_FLAG_ONLY_OWNER_CAN_CALL))&&a.createElement(s.default,{selectable:!1,aside:a.createElement(o.default,{className:"ChatSettingsOptions__longselect",onChange:this.onChange,name:h.MAIL_CHAT_FLAG_ONLY_OWNER_CAN_CALL+h.MAIL_CHAT_FLAG_ONLY_ADMINS_CAN_CALL,options:m(h.MAIL_CHAT_FLAG_ONLY_OWNER_CAN_CALL,h.MAIL_CHAT_FLAG_ONLY_ADMINS_CAN_CALL),value:e&(h.MAIL_CHAT_FLAG_ONLY_OWNER_CAN_CALL|h.MAIL_CHAT_FLAG_ONLY_ADMINS_CAN_CALL)})},a.createElement(u.default,{type:"call",backgroundColor:"green"}),f("mail_settings_can_start_group_call")),this.isAllowed(h.MAIL_CHAT_FLAG_ADMINS_CAN_ADD_ADMINS)&&a.createElement(s.default,{selectable:!1,aside:a.createElement(o.default,{className:"ChatSettingsOptions__longselect",onChange:this.onChange,name:h.MAIL_CHAT_FLAG_ADMINS_CAN_ADD_ADMINS,options:[{value:0,label:f("mail_settings_only_owner")},{value:h.MAIL_CHAT_FLAG_ADMINS_CAN_ADD_ADMINS,label:f("mail_settings_owner_and_admins")}],value:e&h.MAIL_CHAT_FLAG_ADMINS_CAN_ADD_ADMINS})},a.createElement(u.default,{type:"user",backgroundColor:"green"}),f("mail_settings_admins_can_add_admins")),this.isAllowed(h.MAIL_CHAT_FLAG_SERVICE_CHAT)&&n&&a.createElement(s.default,{selectable:!1,aside:a.createElement(o.default,{className:"ChatSettingsOptions__select",onChange:this.onChange,name:h.MAIL_CHAT_FLAG_SERVICE_CHAT,options:[{value:0,label:f("mail_settings_service_simple")},{value:h.MAIL_CHAT_FLAG_SERVICE_CHAT,label:f("mail_settings_service_service")}],value:e&h.MAIL_CHAT_FLAG_SERVICE_CHAT})},a.createElement(u.default,{type:"gear",backgroundColor:"gray"}),f("mail_settings_service"))),a.createElement(d.default,{alignment:"right",className:"ChatSettingsOptions__submitArena"},a.createElement(l.default,{appearance:"tertiary",onClick:this.onCancel},f("global_cancel")),a.createElement(c.default,{onClick:this.onSave,loading:this.state.loading},f("global_save"))))}}},lJdi:function(e,t,n){"use strict";n.r(t),n.d(t,"MAIL_CHAT_FLAG_ONLY_ADMINS_CAN_INVITE",(function(){return l})),n.d(t,"MAIL_CHAT_FLAG_ONLY_ADMINS_CAN_PIN",(function(){return c})),n.d(t,"MAIL_CHAT_FLAG_ONLY_ADMINS_CAN_CHANGE_TITLE",(function(){return d})),n.d(t,"MAIL_CHAT_FLAG_ADMINS_CAN_ADD_ADMINS",(function(){return u})),n.d(t,"MAIL_CHAT_FLAG_ADMINS_CAN_INVITE_LINK",(function(){return g})),n.d(t,"MAIL_CHAT_FLAG_SERVICE_CHAT",(function(){return m})),n.d(t,"MAIL_CHAT_FLAG_IS_CHANNEL",(function(){return _})),n.d(t,"MAIL_CHAT_FLAG_IS_SUPERGROUP",(function(){return p})),n.d(t,"MAIL_CHAT_FLAG_IS_FAKE_CHANNEL",(function(){return h})),n.d(t,"MAIL_CHAT_FLAG_IS_PROMO_CHAT",(function(){return f})),n.d(t,"MAIL_CHAT_FLAG_IS_BUSINESS_NOTIFY",(function(){return b})),n.d(t,"MAIL_CHAT_FLAG_DENY_ANYONE_TO_WRITE",(function(){return v})),n.d(t,"MAIL_CHAT_FLAG_IS_CASPER",(function(){return O})),n.d(t,"MAIL_CHAT_FLAG_IS_COPIED",(function(){return y})),n.d(t,"MAIL_CHAT_FLAG_IS_COMMUNITY_CHAT",(function(){return C})),n.d(t,"MAIL_CHAT_FLAG_IS_COMMUNITY_CHAT_DELETED",(function(){return E})),n.d(t,"MAIL_CHAT_FLAG_ONLY_ADMINS_CAN_MASS_MENTION",(function(){return j})),n.d(t,"MAIL_CHAT_FLAG_ONLY_OWNER_CAN_MASS_MENTION",(function(){return T})),n.d(t,"MAIL_CHAT_FLAG_ONLY_OWNER_CAN_INVITE",(function(){return S})),n.d(t,"MAIL_CHAT_FLAG_ONLY_OWNER_CAN_CHANGE_TITLE",(function(){return I})),n.d(t,"MAIL_CHAT_FLAG_ONLY_OWNER_CAN_PIN",(function(){return A})),n.d(t,"MAIL_CHAT_FLAG_ONLY_ADMINS_CAN_SEE_INVITE_LINK",(function(){return w})),n.d(t,"MAIL_CHAT_FLAG_ONLY_OWNER_CAN_SEE_INVITE_LINK",(function(){return L})),n.d(t,"MAIL_CHAT_FLAG_ONLY_ADMINS_CAN_CALL",(function(){return k})),n.d(t,"MAIL_CHAT_FLAG_ONLY_OWNER_CAN_CALL",(function(){return M})),n.d(t,"MAIL_CHATS_ACTION_SEE_INVITE_LINK",(function(){return N})),n.d(t,"MAIL_CHATS_ACTION_CHANGE_INVITE_LINK",(function(){return P})),n.d(t,"MAIL_CHATS_ACTION_INVITE_USER",(function(){return D})),n.d(t,"MAIL_CHATS_ACTION_PIN_OR_UNPIN",(function(){return R})),n.d(t,"MAIL_CHATS_ACTION_CHANGE_TITLE",(function(){return x})),n.d(t,"MAIL_CHATS_ACTION_ADD_ADMIN",(function(){return B})),n.d(t,"MAIL_CHATS_ACTION_MASS_MENTION",(function(){return H})),n.d(t,"MAIL_CHATS_ACTION_START_GROUP_CALL",(function(){return F})),n.d(t,"canSeeInviteLink",(function(){return G})),n.d(t,"canMassMention",(function(){return q})),n.d(t,"canChangeInviteLink",(function(){return V})),n.d(t,"canAddAdmin",(function(){return W})),n.d(t,"canInviteUser",(function(){return K})),n.d(t,"canKickUser",(function(){return Y})),n.d(t,"canPinOrUnpin",(function(){return $})),n.d(t,"canStartGroupCall",(function(){return z})),n.d(t,"canChangeTitle",(function(){return X})),n.d(t,"canChangeAvatar",(function(){return Q})),n.d(t,"canSeeAllMessages",(function(){return Z})),n.d(t,"canSeeSettingsItem",(function(){return J})),n.d(t,"canCloseChat",(function(){return ee})),n.d(t,"checkChatRights",(function(){return te})),n.d(t,"doesChatTabHaveFlag",(function(){return ne})),n.d(t,"isUserAdminInChat",(function(){return ae})),n.d(t,"isUserOwnerInChat",(function(){return re})),n.d(t,"isUserInvitedByMe",(function(){return ie}));n("HEwt"),n("a1Th"),n("Btvt"),n("rGqo"),n("rE2o"),n("ioFf"),n("OEbY");var a=n("rHUl"),r=n("aong"),i=n("P13b");function s(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var n=[],a=!0,r=!1,i=void 0;try{for(var s,o=e[Symbol.iterator]();!(a=(s=o.next()).done)&&(n.push(s.value),!t||n.length!==t);a=!0);}catch(e){r=!0,i=e}finally{try{a||null==o.return||o.return()}finally{if(r)throw i}}return n}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return o(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return o(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function o(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,a=new Array(t);n<t;n++)a[n]=e[n];return a}var l=1,c=4,d=8,u=16,g=32,m=64,_=256,p=512,h=1024,f=2048,b=4096,v=16384,O=32768,y=65536,C=1<<17,E=1<<18,j=1<<19,T=1<<20,S=1<<21,I=1<<22,A=1<<23,w=1<<24,L=1<<25,k=1<<26,M=1<<27,N="see_invite_link",P="change_invite_link",D="invite_user",R="pin_unpin",x="change_title",B="add_admin",H="mass_mention",F="call",U={[P]:[g,g],[B]:[u,u],[N]:[w,L],[D]:[l,S],[R]:[c,A],[x]:[d,I],[H]:[j,T],[F]:[k,M]};function G(e,t,n){return te(e,N,t,n)}function q(e,t,n){return te(e,H,t,n)}function V(e,t,n){return te(e,P,t,n)}function W(e,t,n,i){var s=Object(r.unpackStore)(e);return!re(Object(a.getTab)(s,n||s.peer),t)&&te(e,B,n,i)}function K(e,t,n){return te(e,D,t,n)}function Y(e,t,n,s){var o=Object(r.unpackStore)(e);if(function(e,t){var n=Object(r.unpackStore)(e);return void 0!==n.service&&(n.service&t)>0}(e,1))return!0;var l=Object(a.getTab)(o,n||o.peer);return!(l.data.kicked&&!l.data.closed)&&(!Object(i.isFvkcomgroup)(e,n)&&(!re(l,t)&&(!!re(l,s=void 0===s?window.vk.id:s)||(ae(l,s)||ie(l,t))&&!ae(l,t))))}function $(e,t,n){return te(e,R,t,n)}function z(e,t,n){return te(e,F,t,n)}function X(e,t,n){return te(e,x,t,n)}function Q(e,t,n){return X(e,t,n)&&!Object(i.isFvkcomgroup)(e,t)}function Z(e,t,n){return!Object(a.isCommunityPeer)(n)||!!Object(a.getTab)(e,t).caccess[n]}function J(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:window.vk.id,s=Object(r.unpackStore)(e),o=Object(i.isFvkcomgroup)(s,t),l=s.tabs[s.peer];if(Object(a.isCommunityChat)(s,t)){var c=l&&l.data&&Object(a.isChatActive)(l),d=re(l,-s.gid)&&c,u=d||ae(l,n)&&c,g=l.allowedUpdateFlags?l.allowedUpdateFlags.filter(e=>e!==v):[];return!(!u||!g.length)}return re(l,n)&&!o}function ee(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:window.vk.id,i=Object(r.unpackStore)(e),s=Object(a.isCommunityChat)(i,t),o=Object(a.isCommunityChatDeleted)(i,t),l=i.tabs[i.peer],c=l&&l.data&&Object(a.isChatActive)(l),d=re(l,-i.gid)&&c,u=d||ae(l,n)&&c;return s&&!o&&u&&l.allowedUpdateFlags&&l.allowedUpdateFlags.includes(v)}function te(e,t,n,o){var l=Object(r.unpackStore)(e),c=l.gid?-l.gid:window.vk.id;o=void 0===o?c:o,n=void 0===n?l.peer:n;var d=Object(a.getTab)(l,n),u=d&&d.data&&Object(a.isChatActive)(d),g=s(U[t],2),m=g[0],_=g[1],p=_|m,h=Object(i.isFvkcomgroup)(e,n),f=re(d,o)&&u,b=f||ae(d,o)&&u;if(h)switch(t){case B:case D:return!1;case N:return u;default:return l.gid>0}else if(Object(a.isCommunityChat)(e,n)){if(Object(a.isClosedChat)(e,n))return!1;switch(t){case N:return Object(a.isServiceChatTab)(d)?u:ne(d,p)?ne(d,_)?u:b:f;case P:return f||b;case B:return ne(d,p)?b:f;case H:case F:case D:return Object(a.isServiceChatTab)(d)?u:!f&&(ne(d,p)?b:u);case R:case x:return Object(a.isServiceChatTab)(d)?u:b;default:return!1}}switch(t){case P:return ne(d,m)?b:f;case B:return ne(d,p)?b:f;case N:return ne(d,p)?ne(d,_)?u:b:f;case D:case R:case H:case F:case x:return ne(d,p)?ne(d,m)?b:f:u}return!1}function ne(e,t){return((e&&e.data&&e.data.flags||0)&t)>0}function ae(e,t){return(e&&e.adminIds||[]).indexOf(+t)>-1}function re(e,t){return e.ownerId===t}function ie(e,t){return-1!==e.invitedByMe.indexOf(t)}},m5nf:function(e,t,n){"use strict";n.r(t),n.d(t,"MAIN",(function(){return p})),n.d(t,"EDIT",(function(){return h}));n("pIFo"),n("91GP"),n("VRzm"),n("Btvt");var a=n("q1tI"),r=(n("17x9"),n("6krn")),i=n("gqqU"),s=n("MCfn"),o=n("Ht+d"),l=n("6aSF"),c=n("BN/X"),d=n("g1O2"),u=n("LYnS"),g=n("vT4u"),m=n("nAFc"),_=n("EasH"),p="main",h="edit";class f extends a.Component{constructor(){super(...arguments),this.setEditableMessage=e=>{var t=e.id,n=e.name,a=e.text;return new Promise(e=>this.setState({editableMessage:{id:t,name:n,text:a}},e))},this.onChangeEditableMessage=(e,t)=>this.setEditableMessage(Object.assign({},this.state.editableMessage,{[e]:Object(m.escape)(t)})),this.deleteTemplate=e=>Promise.resolve().then(()=>this.state.section!==p?this.go(p):Promise.resolve()).then(()=>this.props.store.set(g.deleteTemplate.bind(null,e))).catch(()=>{Object(_.showFastBox)(Object(r.getLang)("mail_error"),Object(r.getLang)("mail_community_templates_delete_error"))}),this.saveTemplate=e=>{e.preventDefault();var t=this.state.editableMessage,n=t.name,a=t.text;n.length>200||n.length<2||n.length>2e3||a.length<5?Object(_.showFastBox)(Object(r.getLang)("mail_error"),Object(r.getLang)("mail_form_is_filled_in_incorrectly")):this.props.saveTemplate(t).catch(()=>{Object(_.showFastBox)(Object(r.getLang)("mail_error"),Object(r.getLang)("mail_community_templates_save_error"))}).then(()=>this.go(p))},this.addHint=(e,t)=>{t.preventDefault();var n=this.state.editableMessage,a=n.id,r=void 0===a?null:a,i=n.name,s=n.text;return Object(d.setHTML)(this.textarea,`{${e.id}}`),this.setEditableMessage({id:r,name:i,text:`${s}{${e.id}} `})},this.getTextAreaRef=e=>{this.textarea=(e||{}).container},this.state={section:this.props.section,editableMessage:{id:null,name:"",text:""}}}go(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.id,a=void 0===n?null:n,r=t.name,i=void 0===r?"":r,s=t.text,o=void 0===s?"":s;return new Promise(t=>{this.state.section!==e?this.setState({section:e,editableMessage:{id:a,name:i,text:o}},()=>{this.props.popup.updateBoxCoords(),t()}):t()})}render(){var e=this.props,t=e.getTemplates,n=e.closePopup,s=this.state,g=s.section,m=s.editableMessage,_=t();return a.createElement("section",{className:"TemplatesSettings"},a.createElement(i.default,{title:a.createElement("span",{className:"TemplatesSettings__title"},g===p&&Object(r.getLang)("mail_community_templates"),g===h&&Object(r.getLang)("mail_add_community_template")),onCloseClick:n}),a.createElement("main",{className:"TemplatesSettings__content"},g===p&&(_.length?a.createElement(l.default,{className:"TemplatesSettings__scroll-wrapper"},a.createElement("div",{className:"TemplatesSettings__list"},_.map(e=>a.createElement("section",{key:e.id,className:"TemplatesSettings__item"},a.createElement("h3",{className:"TemplatesSettings__item-name",dangerouslySetInnerHTML:{__html:e.name}}),a.createElement("div",{className:"TemplatesSettings__item-content",dangerouslySetInnerHTML:{__html:e.text}}),a.createElement("div",{className:"TemplatesSettings__buttons-row"},a.createElement(c.default,{onClick:()=>this.go(h,e),className:"TemplatesSettings__item-button"},Object(r.getLang)("mail_settings_edit")),a.createElement("span",{className:"TemplatesSettings__buttons-splitter","aria-hidden":"true"}," ","·"," "),a.createElement(c.default,{onClick:this.deleteTemplate.bind(null,e.id),className:"TemplatesSettings__item-button"},Object(r.getLang)("mail_delete"))))))):a.createElement("div",{className:"TemplatesSettings__not-found-container"},a.createElement("span",null,Object(r.getLang)("mail_community_templates_not_found")),a.createElement(c.default,{onClick:()=>this.go(h)},Object(r.getLang)("mail_add_community_template")))),g===h&&a.createElement("form",{className:"TemplatesSettings__form",id:"create_template_form",onSubmit:this.saveTemplate},a.createElement("div",{className:"TemplatesSettings__form-row"},a.createElement("label",{className:"TemplatesSettings__label",htmlFor:"name"},Object(r.getLang)("mail_name"),":"),a.createElement("div",{className:"TemplatesSettings__input-container"},a.createElement(d.default,{id:"name",type:"text",initialValue:m.name,className:"TemplatesSettings__input",onChange:this.onChangeEditableMessage.bind(null,"name")}),a.createElement("span",{className:"TemplatesSettings__notice"},Object(r.getLang)("mail_community_templates_input_size").replace("{min}",2).replace("{max}","200")))),a.createElement("div",{className:"TemplatesSettings__form-row"},a.createElement("label",{className:"TemplatesSettings__label",htmlFor:"text"},Object(r.getLang)("mail_text"),":"),a.createElement("div",{className:"TemplatesSettings__input-container"},a.createElement(d.default,{id:"text",name:"text",isMultiLine:!0,ref:this.getTextAreaRef,initialValue:m.text,className:"TemplatesSettings__textarea",onChange:this.onChangeEditableMessage.bind(null,"text")}),a.createElement("span",{className:"TemplatesSettings__notice"},Object(r.getLang)("mail_community_templates_input_size").replace("{min}",5).replace("{max}","2 000")))),a.createElement("div",{className:"TemplatesSettings__form-row"},a.createElement("label",{className:"TemplatesSettings__label"},Object(r.getLang)("mail_hints"),":"),a.createElement("div",{className:"TemplatesSettings__input-container"},Object(u.default)().map(e=>a.createElement(o.default,{type:"button",onMouseDown:this.addHint.bind(null,e),appearance:"secondary",className:"TemplatesSettings__hint",key:e.id},e.label)))))),a.createElement("footer",{className:"TemplatesSettings__footer"},g===p&&a.createElement(a.Fragment,null,a.createElement(c.default,{onClick:()=>this.go(h)},Object(r.getLang)("mail_add_community_template")),a.createElement(o.default,{onClick:n},Object(r.getLang)("mail_close"))),g===h&&a.createElement(a.Fragment,null,a.createElement("div",null,m.id&&a.createElement(c.default,{onClick:this.deleteTemplate.bind(null,m.id)},Object(r.getLang)("mail_delete_community_template"))),a.createElement("div",null,a.createElement(o.default,{appearance:"tertiary",onClick:()=>this.go(p)},Object(r.getLang)("mail_cancel")),a.createElement(o.default,{onClick:this.saveTemplate,form:"create_template_form",type:"submit"},Object(r.getLang)("mail_save"))))))}}f.defaultProps={section:p},t.default=Object(s.connect)(f)},nJdr:function(e,t,n){"use strict";n.r(t),n.d(t,"createLongpoll",(function(){return h}));var a=n("DM26"),r=n("BxOC"),i=n("f01n"),s=function(){return(s=Object.assign||function(e){for(var t,n=1,a=arguments.length;n<a;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)};function o(e,t){e.waitAbortFns.push(t)}function l(e){if(e.isStoppedFn())return Promise.resolve({ts:0,updates:[]});var t=Object(r.plaingetCancelable)(e.url,{act:"a_check",key:e.key,version:e.version,ts:e.ts,wait:25,mode:e.mode}),n=t.request,i=t.cancel;return e.stopFn=i,window.lpDebug={startedAt:Date.now(),finishedAt:null,error:!1,request:n,cancel:i},n.then((function(t){var n=t[0],a=t[1];return window.lpDebug&&(window.lpDebug=s(s({},window.lpDebug),{finishedAt:Date.now(),request:null,cancel:null})),e.onData(e,a),e.waitTimeout=2,JSON.parse(n)})).catch((function(t){var n=t[1];return window.lpDebug&&(window.lpDebug=s(s({},window.lpDebug),{finishedAt:Date.now(),error:!0,request:null,cancel:null})),e.onData(e,n),Promise.reject(new Error(""))})).then((function(t){return function(e,t){var n=t.failed?Object(a.abortablePause)(4,null):{abort:function(){},pause:function(){return Promise.resolve()}},r=n.abort,i=n.pause;switch(t.failed){case 1:return o(e,r),e.onHistoryLost(e,t).then((function(){return e.onResult({ts:t.ts,updates:[[-1]]})})).then(i).then((function(){return l(e)}));case 2:return o(e,r),e.onKeyExpired(e,t).then((function(t){var n=t[0],a=t[1],r=t[2],i=t[3];return e.onResult({ts:+i,updates:[[-2,n,a+"/"+r],[-1]]})})).then(i).then((function(){return l(e)}));case 3:return e.onLpBroken(e,t);default:return Promise.resolve(t)}}(e,t)}))}function c(e){e.isStoppedFn()||l(e).then(e.onResult.bind(e)).then((function(){return e.isReconnecting&&d(e,-5)})).catch((function(t){return function(e,t){if(e.isStoppedFn())return;e.onRequestError(t),e.waitTimeout=Math.min(60,2*e.waitTimeout),d(e,-3);var n=Object(a.abortablePause)(e.waitTimeout,null),r=n.abort,i=n.pause;return o(e,r),i().then((function(){return d(e,-4)}))}(e,t)})).then((function(){return c(e)}))}function d(e,t){e.isReconnecting=-4===t,e.onResult({ts:e.ts,updates:[[t,e.waitTimeout]]})}function u(e){return e||function(){}}function g(e){return e?function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return Promise.resolve(e.apply(void 0,t))}:function(){return Promise.reject()}}var m=n("bP5l"),_=n("vT4u"),p=n("XzvV");function h(e,t){return function(e,t){var n=!!e.stopped,a={id:e.id,key:e.key,ts:e.ts,url:e.url,lpstat:e.lpstat||0,version:e.version||11,mode:202,waitTimeout:2,waitAbortFns:[],isReconnecting:!1,isStoppedFn:function(){return n},onResult:function(e){e.ts&&s(a.ts,e.ts,e.updates.map(i.constructEvent))},onData:u(t.onData),onRequestError:u(t.onRequestError),onHistoryLost:g(t.onHistoryLost),onKeyExpired:g(t.onKeyExpired),onLpBroken:g(t.onHistoryLost)},r=t.onEvents;function s(e,t,n){a.ts=t;for(var s=0;s<n.length;++s)n[s].type===i.REFRESH_LP_KEY&&(a.key=n[s].key||"",a.url=n[s].url||"");r(e,t,n)}var o={options:a,isStopped:function(){return n},stopConnection:function(){n=!0,a.stopFn&&a.stopFn(),a.stopFn=void 0,document.removeEventListener("resume",l),this.abortWaiting()},reinitConnection:function(){this.stopConnection(),document.addEventListener("resume",l),d(a,-4),n=!1,c(a)},abortWaiting:function(){a.waitAbortFns.forEach((function(e){return e()})),a.waitAbortFns=[],a.waitTimeout=2},onLp:s};function l(){o.abortWaiting()}return document.addEventListener("resume",l),c(a),o}(e,{onEvents:t,onData:v,onRequestError:O,onHistoryLost:y,onKeyExpired:C,onLpBroken:E})}var f={},b=Date.now();function v(e,t){if(t&&t.status&&e.lpstat){var n=t.status.toString();t.status>=500&&t.status<600&&Object(p.statlogsValueEvent)("fc_longpoll",1,n,t.getResponseHeader("x-frontend")||""),f[n]=n in f?f[n]+1:1,Date.now()-b>=3e4&&(Object.keys(f).forEach((function(e){Object(p.statlogsValueEvent)("fc_longpoll",f[e],e,t.getResponseHeader("x-frontend")||"")})),f={},b=Date.now())}}function O(e){Object(m.lpLogFc)("red","LP error",e.message||"no message (probably browser reset)")}function y(e,t){Object(m.lpLogFc)("red","LP failed: old timestamp; resync, next ts",t.ts)}function C(e){return Object(m.lpLogFc)("red","LP failed: key is incorrect; refresh key"),Object(r.post)(_.CONTROLLER,{act:"a_get_key",uid:e.id,gid:e.id<0?-e.id:0},1e3)}function E(){throw window.nav.reload({force:!0}),new Error("ts is very wrong")}},ofcU:function(e,t,n){"use strict";n.r(t),n.d(t,"createMutations",(function(){return c})),n.d(t,"createModule",(function(){return g})),n.d(t,"destroyModule",(function(){return m}));n("HEwt"),n("a1Th"),n("rE2o"),n("ioFf"),n("rGqo"),n("Btvt"),n("KKXr");function a(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var n=[],a=!0,r=!1,i=void 0;try{for(var s,o=e[Symbol.iterator]();!(a=(s=o.next()).done)&&(n.push(s.value),!t||n.length!==t);a=!0);}catch(e){r=!0,i=e}finally{try{a||null==o.return||o.return()}finally{if(r)throw i}}return n}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return r(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return r(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function r(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,a=new Array(t);n<t;n++)a[n]=e[n];return a}var i=new window.Map;function s(e){var t=i.get(e.currentTarget);if(t){var n=t[e.type];if(n)for(var r,s=0;s<n.length;s++){var o=a(n[s],2),l=o[0],c=o[1],d=void 0;if(hasClass(e.target,l)?d=c(e,e.target):(r=gpeByClass(l,e.target,e.currentTarget))&&(d=c(e,r)),!1===d)break}}}var o=n("Egk5"),l=function(){for(var e=0,t=0,n=arguments.length;t<n;t++)e+=arguments[t].length;var a=Array(e),r=0;for(t=0;t<n;t++)for(var i=arguments[t],s=0,o=i.length;s<o;s++,r++)a[r]=i[s];return a};function c(e){return{callMutations:function(){if("function"==typeof e)throw console.trace(),new Error("Mutations are not initialized");return e},bindMutations:function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];if("function"!=typeof e)throw console.trace(),new Error("Mutations are already initialized");return e=e.apply(void 0,t)}}}function d(e,t,n,a){Object(o.addEvent)(t,n,a),e._registeredHandlers.push({handlerType:"bind",elem:t,types:n,handler:a})}function u(e,t,n,a,r){!function(e,t,n,a){var r=i.get(e);r||(i.set(e,{}),r=i.get(e));for(var o=t.split(" "),l=0;l<o.length;l++){var c=o[l];r[c]||(r[c]=[],addEvent(e,c,s)),r[c].push([n,a])}}(t,n,a,r),e._registeredHandlers.push({handlerType:"delegate",elem:t,types:n,selector:a,handler:r})}function g(e){var t={_registeredHandlers:[]};return e.handlers((function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];return d.apply(void 0,l([t],e))}),(function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];return u.apply(void 0,l([t],e))})),t}function m(e){e._registeredHandlers.forEach((function(e){var t,n,a,r,l;"delegate"===e.handlerType?(t=e.elem,n=e.types,a=e.selector,r=e.handler,(l=i.get(t))&&(n.split(" ").forEach(e=>{l[e]&&(l[e]=l[e].filter(e=>e[0]!==a||e[1]!==r),0===l[e].length&&removeEvent(t,e,s))}),0===Object.keys(l).map(e=>l[e].length).reduce((e,t)=>e+t)&&i.delete(t))):Object(o.removeEvent)(e.elem,e.types,e.handler)})),e._registeredHandlers=[]}},qihR:function(e,t,n){"use strict";n.r(t);var a=n("q1tI"),r=n.n(a),i=n("i8i4"),s=n("ZxpX"),o=function(){return(o=Object.assign||function(e){for(var t,n=1,a=arguments.length;n<a;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)},l=function(e,t){var n={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(n[a]=e[a]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(a=Object.getOwnPropertySymbols(e);r<a.length;r++)t.indexOf(a[r])<0&&Object.prototype.propertyIsEnumerable.call(e,a[r])&&(n[a[r]]=e[a[r]])}return n};t.default=function(e){var t,n=e.x,c=e.y,d=e.text,u=e.position,g=void 0===u?"b":u,m=e.align,_=void 0===m?"center":m,p=e.removed,h=e.maxWidth,f=e.appearance,b=void 0===f?"dark":f,v=e.className,O=e.tooltipRef,y=l(e,["x","y","text","position","align","removed","maxWidth","appearance","className","tooltipRef"]),C=Object(a.useRef)(null);C.current||(C.current=document.createElement("div"),document.body.appendChild(C.current));var E=Object(s.classNames)("Tooltip","Tooltip--"+g,"Tooltip--"+b,((t={"Tooltip--removed":!!p})["Tooltip--align-"+_]="t"===g||"b"===g,t),v);return Object(i.createPortal)(r.a.createElement("div",o({},y,{className:E,ref:O,style:{top:c,left:n}}),"string"==typeof d&&r.a.createElement("div",{className:"Tooltip__in",style:{maxWidth:h},dangerouslySetInnerHTML:{__html:d}}),"string"!=typeof d&&r.a.createElement("div",{className:"Tooltip__in",style:{maxWidth:h}},d)),C.current)}},r7nW:function(e,t,n){"use strict";n.r(t);var a=n("q1tI"),r=n("i8i4"),i=(n("17x9"),n("ZxpX"));class s extends a.Component{constructor(){super(...arguments),this.getScrollbarWidth=()=>{var e=document.createElement("div");e.classList.add("BaseModal__scrollbarMeasure"),document.body.appendChild(e);var t=e.getBoundingClientRect().width-e.clientWidth;return document.body.removeChild(e),t},this.hideScrollBar=()=>{var e=document.body.getBoundingClientRect(),t=e.left+e.right<window.innerWidth,n=this.getScrollbarWidth();this.calculatedPadding=window.getComputedStyle(document.body)["padding-right"],t&&(document.body.style.paddingRight=parseFloat(this.calculatedPadding)+n+"px"),document.body.classList.add("BaseModal__bodyHiddenOverflow")},this.showScrollBar=()=>{document.body.style.paddingRight=this.calculatedPadding,document.body.classList.remove("BaseModal__bodyHiddenOverflow")},this.onDocumentKeyDown=e=>{var t=this.props.onClose;"Escape"===e.key&&t()},this.onBackdropClick=()=>{var e=this.props,t=e.onClose,n=e.onBackdropClick;e.disableBackdropClick||(n?n():t())}}componentDidMount(){var e=this.props,t=e.disableEscapeClose,n=e.disableBodyScroll;t||document.body.addEventListener("keydown",this.onDocumentKeyDown),n&&this.hideScrollBar()}componentWillUnmount(){var e=this.props,t=e.disableEscapeClose,n=e.disableBodyScroll;t||document.body.removeEventListener("keydown",this.onDocumentKeyDown),n&&this.showScrollBar()}renderModal(){var e=this.props.className,t=Object(i.classNames)("BaseModal",e);return a.createElement("div",{className:t,"aria-modal":"true"},a.createElement("div",{className:"BaseModal__backdrop",onClick:this.onBackdropClick}),a.createElement("div",{className:"BaseModal__content"},this.props.children))}render(){return r.createPortal(this.renderModal(),document.body)}}s.defaultProps={className:"",children:null,disableBackdropClick:!1,disableEscapeClose:!1,disableBodyScroll:!1},t.default=s},rCUf:function(e,t,n){"use strict";n.r(t),n.d(t,"getUploadVideoExtMasks",(function(){return i})),n.d(t,"getUploadModule",(function(){return o})),n.d(t,"onVideoUploaded",(function(){return l}));n("91GP"),n("pIFo");var a=n("EasH"),r=n("8h6g");function i(e){var t=r.VIDEO_UPLOAD_EXTS.slice(0,r.VIDEO_UPLOAD_EXTS.length);if("types"===e){for(var n=t.length,a=0;a<n;++a)t.push(t[a].toUpperCase());return"*."+t.join(";*.")}return"accept"===e?"."+r.VIDEO_UPLOAD_EXTS.join(",."):""}function s(e){if(!cur.leaving){var t=getLang("video_upload_changed"),n=!1;if(each(window.cur.videoUploaders,(e,t)=>{Upload.isSomethingUploading(t)&&(n=!0)}),1===e){if(!n)return!0;var r=Object(a.showFastBox)({title:getLang("global_warning"),dark:!0},t,getLang("global_continue"),(function(){cur.leaving=!0,r.hide(),cur.onContinueCb&&cur.onContinueCb()}),getLang("global_cancel"),(function(){r.hide(),nav.objLoc.section="upload",nav.setLoc(nav.objLoc)}));return!1}return n?winToUtf(t.replace(/<\/?b>/g,"").replace(/<br\s*\/?>/g,"\n")):void 0}}function o(e,t,n,o,c){if(n){o=o||cur,(c=c||{}).onUploadStart||(c.onUploadStart=e=>{boxQueue.hideLast(),cur.nav.push((function(e,t,n){if(!1===s(1))return cur.onContinueCb=nav.go.pbind(n),!1})),cur.prevBefUnload=window.onbeforeunload,window.onbeforeunload=s,c.onUploadProgress(e,0,0),Wall.showEditPost&&Wall.showEditPost(),c.onUploadStartDone&&c.onUploadStartDone()}),c.onUploadComplete||(c.onUploadComplete=(e,t)=>{var n=window.parseJSON(t);n.video_id?l(e,n,o):"string"==typeof t&&t.indexOf("TERMINATED")>-1||Upload.onUploadError(e);c.onUploadCompleteDone&&c.onUploadCompleteDone(),setTimeout(()=>{c.onUploadAllCompleteDone&&!window.Upload.isSomethingUploading(e.ind)&&c.onUploadAllCompleteDone()})}),c.onUploadProgress||(c.onUploadProgress=(e,t,n)=>{var a=void 0!==e.ind?e.ind:e;show("_im_media_preview"),o.showMediaProgress&&o.showMediaProgress("video",a,function(e,t,n){return{loaded:t,total:n,fileName:e.fileName?e.fileName.replace(/[&<>"']/g,""):void 0}}(e,t,n))}),c.onUploadError||(c.onUploadError=(e,t)=>{statlogsValueEvent("upload_video_fails",1,n.options.server,t),function(e){var t=void 0!==e.ind?e.ind:e,n=e.fileName?t+"_"+e.fileName:e;if(re("upload"+n+"_progress_wrap"),!geByClass1("popup_box_container")){var r=getLang("video_upload_error");setTimeout(Object(a.showFastBox)({title:getLang("global_error")},r).hide,2e3)}topError("Upload failed",{dt:-1,type:102,url:(ge("file_uploader_form"+t)||{}).action}),Upload.embed(t)}(e)}),cur.maxFiles=(cur.chooseParams||{}).maxFiles||10;var d=cur.maxFiles-(cur.savedVideos||[]).length,u=browser.safari?"":"video/*,"+i("accept");n.lang&&(cur.lang=extend(cur.lang||{},n.lang));var g={accept:u,file_input:null,file_name:"video_file",file_size_limit:1024*(n.options.file_size_limit_in_GB||r.VIDEO_UPLOAD_MAX_FILE_SIZE_IN_GB)*1024*1024,file_types_description:"Video files",file_types:i("types"),chooseBox:1,chunked:1,chunkSize:r.VIDEO_UPLOAD_CHUNK_SIZE,clear:1,dragEl:t===boxLayerWrap?boxLayerWrap:bodyNode,dropbox:t,from:n.vars.from,lang:n.lang,max_attempts:3,max_files:d,multiple:1,multi_progress:1,requestOptionsForFile:!0,type:"video",visibleDropbox:!n.options.hasOwnProperty("visible_dropbox")||n.options.visible_dropbox},m=Upload.init(e,"",{},Object.assign(g,c));return window.cur.videoUploaders||(window.cur.videoUploaders=[]),window.cur.videoUploaders.push(m),m}}function l(e,t,n,r){n=n||cur;var i=void 0!==e.ind?e.ind:e,s=(e.fileName||e.filename||"").replace(/[&<>"']/g,""),o=s?i+"_"+s:e,l=t.owner_id+"_"+t.video_id,c=ge("upload"+o+"_progress_wrap");c&&hide(geByClass1("progress_x",c)),ajax.post("al_video.php?act=a_videos_attach_info",{videos:l},{onDone:e=>{n.chooseMedia("video",l,extend(e[l],{upload_ind:o,upload_new:!0}));var i=t.owner_id,s=t.video_id,c=t.video_hash,d=0,u=()=>{ajax.post("al_video.php?act=encode_progress",{oid:i,vid:s,hash:c,need_thumb:1},{onDone:t=>{var c,d=!0;if(t){if(t.error)return c=getLang("video_upload_encode_error"),void setTimeout(Object(a.showFastBox)({title:getLang("global_error")},c).hide,2e3);t.thumb&&(d=!1,ajax.post("al_video.php",{act:"a_video_photo_sizes",oid:i,vid:s},{onDone:t=>{n.hasChosenMedia("video",l)?n.updateChosenMedia("video",l,extend(t,{upload_ind:o,upload_new:!0})):r&&r(e,l)}}))}d&&n.hasChosenMedia("video",l)&&setTimeout(u,1e3)},onFail:()=>{++d<3&&setTimeout(u,2e3*d)}})};u()}})}t.default={getUploadModule:(e,t,n,a,r)=>o(e,t,n,a,r),initModalVideoUploader(){var e=cur.videoUploadParams,t=ge("choose_video_upload");return!!t&&(this.initDragEvents(),o(t,boxLayerWrap,e))},initDragEvents(){var e,t=e=>{cur.dragTimeout&&(clearTimeout(cur.dragTimeout),delete cur.dragTimeout);var t=ge("video_choose_upload_area_wrap");if(!hasClass(t,"video_choose_upload_area_enter")){addClass(t,"video_choose_upload_area_enter");var n=ge("video_choose_wrap"),a=getXY(n)[1],r=getSize(t)[1];return hide("video_choose_wrap"),setStyle(t,"height",scrollGetY()+window.clientHeight()-a+r),cancelEvent(e)}},n=e=>cancelEvent(e),a=e=>{if(n(),e.dataTransfer.files.length&&Upload.checkFilesSizes(window.videoInlineUploader,e.dataTransfer.files))return window.Upload&&Upload.checked&&Upload.checked[window.videoInlineUploader]&&Upload.onFileApiSend(window.videoInlineUploader,e.dataTransfer.files),cancelEvent(e)},r=()=>{addEvent(boxLayerWrap,"dragenter dragover",t),addEvent(boxLayerWrap,"dragleave",n),addEvent(boxLayerWrap,"drop",a)};r();var i=null===(e=curBox().getOptions())||void 0===e?void 0:e.onHide;setTimeout(curBox().setOptions.pbind({onHide:()=>{if(removeEvent(boxLayerWrap,"dragenter dragover",t),removeEvent(boxLayerWrap,"dragleave",n),removeEvent(boxLayerWrap,"drop",a),"function"==typeof i)return i()},onShow:()=>{r()}}),0)}}},rHUl:function(e,t,n){"use strict";n.r(t),n.d(t,"getFirstUnread",(function(){return u})),n.d(t,"isSearchShown",(function(){return g})),n.d(t,"getPeer",(function(){return m})),n.d(t,"getCurrentKeyboard",(function(){return _})),n.d(t,"getKeyboard",(function(){return p})),n.d(t,"getTab",(function(){return h})),n.d(t,"getCurrentTab",(function(){return f})),n.d(t,"getSelectedMessages",(function(){return b})),n.d(t,"getMessageRangeFromSelection",(function(){return v})),n.d(t,"countUnread",(function(){return O})),n.d(t,"getMessageByRid",(function(){return y})),n.d(t,"isRidExist",(function(){return C})),n.d(t,"getLocalId",(function(){return E})),n.d(t,"getLastMessage",(function(){return j})),n.d(t,"parserMessage",(function(){return T})),n.d(t,"getAuthorFullName",(function(){return S})),n.d(t,"getMessage",(function(){return I})),n.d(t,"getPreviousMessage",(function(){return A})),n.d(t,"isClassicInterface",(function(){return w})),n.d(t,"isLocksAvailable",(function(){return L})),n.d(t,"isFoldersAvailable",(function(){return k})),n.d(t,"isCommunityInterface",(function(){return M})),n.d(t,"isChannelPeer",(function(){return N})),n.d(t,"getBareTab",(function(){return P})),n.d(t,"isReversedDialogs",(function(){return D})),n.d(t,"isFullyLoadedTab",(function(){return R})),n.d(t,"makeTabNotFullyLoaded",(function(){return x})),n.d(t,"isGoToEndVisible",(function(){return B})),n.d(t,"isGoToMentionVisible",(function(){return H})),n.d(t,"getUnreadScrollBottom",(function(){return F})),n.d(t,"isSendingAvailable",(function(){return U})),n.d(t,"isCommunityPeer",(function(){return G})),n.d(t,"isCommunityBlocked",(function(){return q})),n.d(t,"checkVoiceMessageAvailable",(function(){return V})),n.d(t,"isSearching",(function(){return W})),n.d(t,"getSearchText",(function(){return K})),n.d(t,"isSearchingValue",(function(){return Y})),n.d(t,"isRecentSearchesActive",(function(){return $})),n.d(t,"getPinnedMessage",(function(){return z})),n.d(t,"doPopularSuggExist",(function(){return X})),n.d(t,"isAnyMessageBeingEdited",(function(){return Q})),n.d(t,"getGroupId",(function(){return Z})),n.d(t,"getTabDraft",(function(){return J})),n.d(t,"getTemplates",(function(){return ee})),n.d(t,"tabIsMessageRequest",(function(){return te})),n.d(t,"tabIsRejectedMessageRequest",(function(){return ne})),n.d(t,"tabIsMessageRequestToChat",(function(){return ae})),n.d(t,"removeMessageRequestFolderFlags",(function(){return re})),n.d(t,"isMessageRequestFolder",(function(){return ie})),n.d(t,"tabIsOutgoingMessageRequest",(function(){return se})),n.d(t,"existsIncomingMessageRequest",(function(){return oe})),n.d(t,"isMessageRequestChangedEvent",(function(){return le})),n.d(t,"isCommunityChat",(function(){return ce})),n.d(t,"isCommunityChatDeleted",(function(){return de})),n.d(t,"isClosedChat",(function(){return ue})),n.d(t,"isCasperChat",(function(){return ge})),n.d(t,"isServiceChatTab",(function(){return me})),n.d(t,"isCasperChatTab",(function(){return _e})),n.d(t,"isChatActive",(function(){return pe})),n.d(t,"isTabMarkedUnread",(function(){return he}));n("Vd3H"),n("rGqo"),n("Btvt");var a=n("MhhX"),r=n("f01n"),i=n("h++7"),s=n("86+7"),o=n("rjmT"),l=n("aong"),c=n("lJdi"),d=n("rudk");function u(e,t){var n=Object(l.unpackStore)(e),r=n.tabs[n.peer];return Object.keys(r.msgs).filter(n=>{var i=I(e,t,n);return!Object(a.isOut)(i)&&intval(n)>r.in_up_to})[0]}function g(e){return Object(l.unpackStore)(e).searchShown}function m(e){return Object(l.unpackStore)(e).peer}function _(e){return p(e,m(e))}function p(e,t){var n=(h(e,t)||{}).keyboard;if(!n||!n.buttons||n.buttons.length)return n}function h(e,t){var n=Object(l.unpackStore)(e);return n.tabs&&n.tabs[t]}function f(e){var t=Object(l.unpackStore)(e);return t.peer?t.tabs[t.peer]:null}function b(e){return Object(l.unpackStore)(e).selectedMessages}function v(e,t,n){var r=h(e,t),i=b(e)[0];if(void 0===i)return[n];var s=Math.min(n,i),o=Math.max(n,i);return Object.keys(r.msgs).filter(e=>e>=s&&e<=o).filter(t=>{var n=I(e,e.get().peer,t);return!Object(a.isServiceMsg)(n)&&!Object(a.isCallMessage)(n)}).map(intval)}function O(e,t){var n=h(Object(l.unpackStore)(t),e),r=0;for(var i in n.msgs)if(n.msgs.hasOwnProperty(i)){var s=I(t,e,i);Object(a.isOut)(s)||(r+=Object(a.isUnread)(n,s)?1:0)}return r}function y(e,t,n){var a=h(e,t);return Object.keys(a.msgs).filter(a=>intval(I(e,t,a).randomId)===n).length>0}function C(e,t,n){return!!y(e,t,n)}function E(e,t){var n=Object(l.unpackStore)(e),a=n.msg_local_ids_sort&&n.msg_local_ids_sort[t];return void 0!==a?2e9+a:t}function j(e,t,n){var a=h(e,t),i=I(e,t,n),s=Object.keys(a.msgs).filter(n=>{var a=I(e,t,n),s=a.local&&a.type!==r.EDIT_MESSAGE;return!(!i.local&&s)&&(!(!i.local||s)||E(e,i.messageId)>E(e,a.messageId))}).pop();return s?I(e,t,s):null}function T(e){return e&&e.length>0?r.addMessageEvent([0].concat(e)):e}function S(e,t,n){var r=h(e,t),i=I(e,t,n),o=Object(l.unpackStore)(e);return Object(a.isOut)(i)?Object(s.oCacheGet)(e,o.id).name:i.userId!==i.peerId?!!Object(s.oCacheExists)(e,i.userId)&&Object(s.oCacheGet)(e,i.userId).name:r.tab}function I(e,t,n){var a=h(e,t),r=a&&a.msgs&&a.msgs[n];return r?T(r):null}function A(e,t,n){var a=h(e,t),r=a&&a.msgs&&Object.keys(a.msgs).sort((e,t)=>+e-t);if(!r)return null;var i=r&&r.indexOf(""+n),s=i>-1?r[i-1]:null;return a.msgs[s]}function w(e){var t=Object(l.unpackStore)(e);return t.gid||t.isClassic}function L(e){return Object(l.unpackStore)(e).gid}function k(e){return Object(l.unpackStore)(e).gid}function M(e){return!!Object(l.unpackStore)(e).gid}function N(e){return!!(e.peerId>2e9&&Object(c.doesChatTabHaveFlag)(e,1024))}function P(e,t){var n=Object(l.unpackStore)(t);return n.tabs[e]||n.mapped_index[e]}function D(e){var t=Object(l.unpackStore)(e);return!!M(e)&&((19542789===t.gid||103416369==t.gid)&&(t.active_tab===i.FOLDER_UNRESPOND||t.active_tab===i.FOLDER_UNREAD))}function R(e,t){var n=(e=Object(l.unpackStore)(e)).tabs;return!(!n||!n[t]||void 0===n[t].history||!n[t].msgs)}function x(e,t){var n=h(e,t);n&&(n.msgs=void 0,n.msgid=void 0,n.scrollTop=void 0,n.scrollBottom=void 0,n.contHeight=void 0,n.offset=void 0,n.skipped=void 0)}function B(e){var t=e.get().go_to_end_visible;return!!t&&t[0]}function H(e){var t=e.get().go_to_mentions_visible;return!!t&&t[0]}function F(e){var t=e.get().go_to_end_visible;return t?t[1]:0}function U(e){return!Object(l.unpackStore)(e).lockedSending}function G(e){return e>-2e9&&e<0}function q(e,t){return!!G(t)&&!!h(e,t).blocked_community}function V(e){return Object(l.unpackStore)(e).voice_message_available}function W(e){var t=Object(l.unpackStore)(e);return!(!K(t)&&!t.recentSearch)}function K(e){return Object(l.unpackStore)(e).searchText}function Y(e,t){var n=Object(l.unpackStore)(e);return!!(t&&t!==K(e)||n.recentSearch)}function $(e){return Object(l.unpackStore)(e).recentSearch}function z(e){var t=f(e);return t&&t.pinned&&T(t.pinned)}function X(e){var t=e.get().popular_sugg;return t&&t.length>0}function Q(e){return 1==Object(l.unpackStore)(e).isEditing}function Z(e){return Object(l.unpackStore)(e).gid}function J(e){return e.draft||(e.draft=Object(o.loadDraftForPeer)(cur.imDb,e.peerId)),e.draft}function ee(e){return(Object(l.unpackStore)(e).templates||[]).filter(e=>!e.deleted)}function te(e){return!!e&&Boolean(e.is_message_request||e.folders&i.FOLDER_MASKS[i.FOLDER_MESSAGE_REQUEST]||e.folders&i.FOLDER_MASKS[i.FOLDER_MESSAGE_REQUEST_REJECTED])}function ne(e){return Boolean(e.folders&i.FOLDER_MASKS[i.FOLDER_MESSAGE_REQUEST_REJECTED])}function ae(e){return Object(d.isChatPeer)(e.peerId)&&te(e)}function re(e){return e&~i.FOLDER_MASKS[i.FOLDER_MESSAGE_REQUEST]&~i.FOLDER_MASKS[i.FOLDER_MESSAGE_REQUEST_REJECTED]}function ie(e){return Object(l.unpackStore)(e).active_tab===i.FOLDER_MESSAGE_REQUEST}function se(e){return e.peerId>19e8&&e.peerId<2e9}function oe(e){return!!Object(l.unpackStore)(e).dialog_tab_cts[i.FOLDER_MESSAGE_REQUEST]}function le(e){var t=e.type,n=e.updateType;return t===r.CONVERSATION_UPDATED&&(n===r.MAIL_CHAT_UPDATE_TYPE_MESSAGE_REQUEST_CHANGED||n===r.MAIL_CHAT_UPDATE_TYPE_CONTACT_CONVERTED)}function ce(e,t){return Object(c.doesChatTabHaveFlag)(h(e,t),c.MAIL_CHAT_FLAG_IS_COMMUNITY_CHAT)}function de(e,t){return Object(c.doesChatTabHaveFlag)(h(e,t),c.MAIL_CHAT_FLAG_IS_COMMUNITY_CHAT_DELETED)}function ue(e,t){return Object(c.doesChatTabHaveFlag)(h(e,t),c.MAIL_CHAT_FLAG_DENY_ANYONE_TO_WRITE)}function ge(e,t){return Object(c.doesChatTabHaveFlag)(h(e,t),c.MAIL_CHAT_FLAG_IS_CASPER)}function me(e){return Object(c.doesChatTabHaveFlag)(e,c.MAIL_CHAT_FLAG_SERVICE_CHAT)}function _e(e){return Object(c.doesChatTabHaveFlag)(e,c.MAIL_CHAT_FLAG_IS_CASPER)}function pe(e){return!e.data.closed&&!e.data.kicked}function he(e){return!!(e.folders&i.FOLDER_MASKS[i.FOLDER_MARKED_UNREAD])}},rjmT:function(e,t,n){"use strict";n.r(t),n.d(t,"ImDraft",(function(){return l})),n.d(t,"loadDraftForPeer",(function(){return d}));n("HEwt"),n("a1Th"),n("rGqo"),n("rE2o"),n("ioFf"),n("KKXr"),n("VRzm"),n("Btvt"),n("OEbY"),n("pIFo");var a=n("BxOC"),r=n("f01n"),i=n("vT4u");function s(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var n=[],a=!0,r=!1,i=void 0;try{for(var s,o=e[Symbol.iterator]();!(a=(s=o.next()).done)&&(n.push(s.value),!t||n.length!==t);a=!0);}catch(e){r=!0,i=e}finally{try{a||null==o.return||o.return()}finally{if(r)throw i}}return n}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return o(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return o(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function o(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,a=new Array(t);n<t;n++)a[n]=e[n];return a}function l(e,t){this._db=e,this._key=t,this.dData={txt:"",attaches:[],urlBinds:[],cancelled:[]},this.load()}function c(e){switch(e.type){case"mail":case"reply":return e.id<0&&1==e.object.fwd_count;default:return!e.object}}function d(e,t){return new l(e,"draft_"+t)}l.prototype.dump=function(){var e;this._key&&this._db.updateByKey(this._key,{txt:(e=this.dData).txt,attaches:e.attaches.length?e.attaches:void 0,urlBinds:e.urlBinds.length?e.urlBinds:void 0,cancelled:e.cancelled.length?e.cancelled:void 0})},l.prototype.load=function(){if(this._key){var e=this._db.selectByKey(this._key);e&&(this.dData=function(e){return{txt:e.txt,attaches:e.attaches||[],urlBinds:e.urlBinds||[],cancelled:e.cancelled||[]}}(e))}},l.prototype.clear=function(){this.dData={txt:"",attaches:[],urlBinds:[],cancelled:[]},this.dump()},l.prototype.setText=function(e){this.dData.txt=trim(e),this.dump()},l.prototype.addAttach=function(e,t,n){if(("share"===e&&this.removeAttachByType(e),"mail"!==e&&"reply"!==e||(this.removeAttachByType("mail"),this.removeAttachByType("reply")),"audio_playlist"===e||"artist"===e)&&this.dData.attaches.find(t=>t.type===e))return!1;if(!e||!t&&"poll"!==e)return!1;var a=this.dData.attaches.findIndex(n=>n.type===e&&n.id===t);-1===a?(this.dData.attaches.push({type:e,id:t,object:n}),this.dump()):"video"!==e&&"poll"!==e||(this.dData.attaches[a]={type:e,id:t,object:n},this.dump())},l.prototype.syncWithSelector=function(e){var t=this.getFwdRaw();this.dData.attaches=(t?[t]:[]).concat(e.getMedias().map(e=>{var t=s(e,2),n=t[0],a=t[1];return this.dData.attaches.find(e=>e.type==n&&e.id==a)||{type:n,id:a}})),this.dump()},l.prototype.removeAttachByType=function(e){for(var t=this.dData.attaches.length;t--;)this.dData.attaches[t].type===e&&this.dData.attaches.splice(t,1);this.dump()},l.prototype.removeAllAttaches=function(){this.dData.attaches=[],this.dData.cancelled=[],this.dump()},l.prototype.addBindUrl=function(e,t,n){this.getBoundAttach(e)||(this.dData.urlBinds.push({url:e,type:t,id:n}),this.dump())},l.prototype.getBoundAttach=function(e){var t=this.dData.urlBinds.find(t=>t.url===e);return t&&this.dData.attaches.find(e=>e.type===t.type&&e.id===t.id)||null},l.prototype.getShareUrl=function(){var e=this.dData.attaches.find(e=>"share"===e.type);if(e&&e.object)return e.object.url.replace(/&amp;/g,"&")},l.prototype.hasOnlyReplies=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return e?e.flags&r.FLAG_HAS_REPLY&&!this.dData.attaches.find(e=>"mail"!==e.type):this.hasAttaches()&&!this.dData.attaches.find(e=>"reply"!==e.type)},l.prototype.getCancelledShares=function(){return this.dData.cancelled.length?this.dData.cancelled:void 0},l.prototype.hasAttaches=function(){return this.dData.attaches.length>0},l.prototype.destroy=function(){this.dData={},this._key=this._db=null},l.prototype.prepareObjects=function(e,t){return this.dData.attaches.find(c)?Object(a.post)(i.CONTROLLER,{act:"draft_medias",gid:e,messageId:t||0,media:t?void 0:this.dData.attaches.map(e=>[e.type,e.id]).join("*")}).then(e=>{var t=s(e,1)[0];this.dData.attaches=t.map(e=>({type:e[0],id:e[1],object:e[2]}))}):Promise.resolve()},l.prototype.getFwdRaw=function(){return this.dData.attaches.find(e=>"mail"===e.type||"reply"===e.type)},l.prototype.getFwdCount=function(){var e=this.getFwdRaw();return e?e.id<0?e.object.fwd_count:e.id.split(";").length:0}},rudk:function(e,t,n){"use strict";n.r(t),n.d(t,"parseFwd",(function(){return s})),n.d(t,"convertKludgesToAttaches",(function(){return o})),n.d(t,"isReservedPeer",(function(){return l})),n.d(t,"isUserPeer",(function(){return c})),n.d(t,"isChatPeer",(function(){return d})),n.d(t,"convertAttachesToPhpMedia",(function(){return u}));var a=n("jE6c");function r(e,t){void 0===t&&(t=[]);var n=e.split("_");return[n[0],n[1],t]}var i={};function s(e){if(i[e])return i[e];for(var t=e?e.length:0,n=[],a=[],s="",o=0;o<t;o++){var l=e[o],c=l.charCodeAt(0);c>=48&&c<=57||"_"===l||"-"===l?s+=l:"("!==l&&")"!==l&&":"!==l&&","!==l||(""!==s&&(a.push(s),n.push("id"),s=""),a.push(l),n.push(l))}s.length>0&&(a.push(s),n.push("id"));var d=function e(t,n,a,i){if(void 0===a&&(a=0),void 0===i&&(i=0),i>50)return[[],t.length];for(var s=[],o="";a<t.length;){var l=t[a];if("id"===l)o=n[a];else if(","===l&&o)s.push(r(o)),o="";else if("("===l){var c=e(t,n,a+1,i+1),d=c[0];a=c[1],s.push(r(o,d)),o=""}else if(")"===l)return""!==o&&s.push(r(o)),[s,a];a++}return o&&s.push(r(o)),[s,a]}(n,a)[0];return Object.keys(i).length>300&&(i={}),i[e]=d,d}function o(e,t){var n=[];e.fwd_count?n.push({type:"mail",id:-t,object:{fwd_count:e.fwd_count}}):e.fwd&&n.push({type:"mail",id:-t,object:{fwd_count:s(e.fwd).length}});for(var r=1;e["attach"+r+"_type"];++r)"call"===e["attach"+r+"_type"]?n.push({type:e["attach"+r+"_type"],id:e["attach"+r],initiatorId:Object(a.intval)(e["attach"+r+"_call_initiator_id"]),state:e["attach"+r+"_call_state"],duration:Object(a.intval)(e["attach"+r+"_call_duration"]),receiverId:Object(a.intval)(e["attach"+r+"_call_receiver_id"])}):n.push({type:e["attach"+r+"_type"],id:e["attach"+r],kind:e["attach"+r+"_kind"],productId:e["attach"+r+"_product_id"]});return e.geo&&n.push({type:"geo",id:e.geo}),n}function l(e){return 0==e}function c(e){return e>0&&e<2e9}function d(e){return e>2e9}function u(e){return e.map((function(e){var t="audiomsg"===e[2]?"audio_message":e[2];return e[0]+":"+e[1]+":"+t})).join(",")}},uytb:function(e,t,n){"use strict";n.r(t),n.d(t,"RECENT_SEARCH_OP",(function(){return s})),n.d(t,"PIN_HIDDEN_ID_OP",(function(){return o})),n.d(t,"deleteOldStoredFormat",(function(){return u})),n.d(t,"mount",(function(){return m}));n("HEwt"),n("a1Th"),n("Btvt"),n("rGqo"),n("rE2o"),n("ioFf");var a=n("BJj/");function r(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var n=[],a=!0,r=!1,i=void 0;try{for(var s,o=e[Symbol.iterator]();!(a=(s=o.next()).done)&&(n.push(s.value),!t||n.length!==t);a=!0);}catch(e){r=!0,i=e}finally{try{a||null==o.return||o.return()}finally{if(r)throw i}}return n}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return i(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return i(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function i(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,a=new Array(t);n<t;n++)a[n]=e[n];return a}var s="recent_search",o="pin_hide";function l(e){return"im_store_"+e}function c(e){return ls.get(l(e))||{}}function d(e,t,n){if(ls.checkVersion()){var a=JSON.stringify(t);rand(0,1e5)<=1&&statlogsValueEvent("im_local_store_size",a.length),n(l(e),a)}}function u(e,t){for(var n=["fwd","draft","bind_attach"],a=c(e),r=!1,i=n.length;i--;)n[i]in a&&(delete a[n[i]],r=!0);r&&d(e,a,t)}function g(e,t,n){n.key===l(e)&&(t.db=JSON.parse(n.newValue),t.checkTime=Date.now())}function m(e){var t=Object(a.debounce)((e,t)=>{localStorage.setItem(e,t)},300);ls.checkVersion()&&u(e,t);var n={db:c(e),checkTime:Date.now()},i=g.bind(null,e,n);return window.addEventListener("storage",i,!1),{select:(t,a)=>(Date.now()-n.checkTime>1e3&&(n.db=c(e)),function(e,t,n){return t===s?e[t]||[]:t===o?e[t]&&e[t][n]:e[t]?extend(!0,{},e[t][n]):null}(n.db,t,a)),selectByKey:t=>(Date.now()-n.checkTime>1e3&&(n.db=c(e)),n.db[t]),update(a,i){var l=function(e,t,n){switch(e[t]||(e[t]={}),t){case s:var a=n;a&&a.length>0?e[t]=a:delete e[t];break;case o:var i=r(n,2),l=i[0],c=i[1];c?e[t][l]=+c:delete e[t][l]}return e}(n.db,a,i);return n.db=l,n.checkTime=Date.now(),d(e,l,t)},updateByKey:(a,r)=>(n.db[a]=r,n.checkTime=Date.now(),d(e,n.db,t)),unmount(){window.removeEventListener("storage",i,!1)}}}},vRp6:function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return c}));n("HEwt"),n("a1Th"),n("Btvt"),n("rGqo"),n("rE2o"),n("ioFf");var a=n("q1tI"),r=(n("17x9"),n("UlUB")),i=n("PjZB"),s=n("ZxpX");function o(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var n=[],a=!0,r=!1,i=void 0;try{for(var s,o=e[Symbol.iterator]();!(a=(s=o.next()).done)&&(n.push(s.value),!t||n.length!==t);a=!0);}catch(e){r=!0,i=e}finally{try{a||null==o.return||o.return()}finally{if(r)throw i}}return n}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return l(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return l(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function l(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,a=new Array(t);n<t;n++)a[n]=e[n];return a}class c extends a.Component{constructor(e){super(e),this.checkLoad=Object(r.throttle)(e=>{var t=o(e,3),n=t[0],a=t[1],r=t[2];if(!this.loading)return this.props.virtualized||this.props.hasMore?void(a-n-r<=this.props.threshold&&(this.loading=!0,this.props.loadMore().then(()=>{this.loading=!1}))):this.detachListeners()},34),this.onScroll=e=>{var t=this.getScrollData();this.props.virtualized&&this.processChildren(this.props.children,t),this.props.hasMore&&this.checkLoad(t)},this.getRef=e=>{this.container=e,this.props.virtualized&&this.setState(this.getChildrenData(this.props.children,this.getScrollData()))},this.useWindowScroll=e.useWindowScroll,e.virtualized&&(this.state={before:0,after:e.children.length,start:0,end:0})}getScrollData(){var e=this.useWindowScroll?document.documentElement:this.container;return[this.getScrollTop(),e?e.scrollHeight:0,e?e.clientHeight:0]}getScrollTop(){var e=document.documentElement||document.body.parentNode||document.body;return this.useWindowScroll?void 0!==window.pageYOffset?window.pageYOffset:e.scrollTop:this.container?this.container.scrollTop:0}attachListeners(){var e=this.useWindowScroll?window:this.container;this.container&&(e.addEventListener("scroll",this.onScroll,this.props.useCapture),e.addEventListener("resize",this.onScroll,this.props.useCapture))}detachListeners(){var e=this.useWindowScroll?window:this.container;this.container&&(e.removeEventListener("scroll",this.onScroll,this.props.useCapture),e.removeEventListener("resize",this.onScroll,this.props.useCapture))}processChildren(e,t){var n=this.state,a=this.getChildrenData(e,t||this.getScrollData()),r=a.start,i=a.end,s=a.before,o=a.after;r===n.start&&i===n.end&&s===n.before&&o===n.after||this.setState(a)}getChildrenData(e,t){var n=o(t,3),a=n[0],r=n[1],i=n[2],s=this.useWindowScroll?window:this.container,l=s&&s.offsetHeight;if(!s||0===r||0===i)return{start:0,end:0,before:0,after:e.length};i=Math.max(i,l);var c=e.length,d=Math.max(Math.floor(a/this.props.itemHeight)-1,0),u=Math.min(Math.floor((a+2*i)/this.props.itemHeight+1),c);return{start:d,end:u,before:d,after:c-u}}componentWillReceiveProps(e){this.props.virtualized&&this.processChildren(e.children)}componentDidMount(){this.attachListeners()}componentWillUnmount(){this.detachListeners()}render(){return a.createElement("div",{className:Object(s.classNames)("InfiniteScroll",this.props.className),ref:this.getRef,style:this.props.style},this.props.virtualized&&this.state.before>0&&a.createElement("div",{style:{height:this.state.before*this.props.itemHeight},key:"before"}),this.props.virtualized?[].concat(this.props.children).slice(this.state.start,this.state.end):this.props.children,this.props.virtualized&&this.state.after>0&&a.createElement("div",{style:{height:this.state.after*this.props.itemHeight},key:"after"}),this.props.hasMore&&(this.props.loader||a.createElement("div",{className:"InfiniteScroll__loader",key:"loader"},a.createElement(i.default,null))))}}c.defaultProps={useWindowScroll:!1,virtualized:!1,hasMore:!0,useCapture:!1,threshold:100,itemHeight:55}},vT4u:function(e,t,n){"use strict";n.r(t),n.d(t,"CONTROLLER",(function(){return T})),n.d(t,"ACTIVITY_PERIOD",(function(){return S})),n.d(t,"ACTIVITY_TYPE_TYPING",(function(){return I})),n.d(t,"ACTIVITY_TYPE_RECORDING_AUDIO",(function(){return A})),n.d(t,"CHAT_ACTION_SETTINGS",(function(){return N})),n.d(t,"CHAT_ACTION_BLOCK",(function(){return P})),n.d(t,"CHAT_ACTION_INVITE",(function(){return D})),n.d(t,"CHAT_ACTION_MEDIA",(function(){return R})),n.d(t,"CHAT_ACTION_SEARCH",(function(){return x})),n.d(t,"CHAT_ACTION_PIN_HIDE",(function(){return B})),n.d(t,"CHAT_ACTION_PIN_UNHIDE",(function(){return H})),n.d(t,"CHAT_ACTION_UNPIN",(function(){return F})),n.d(t,"CHAT_ACTION_MUTE",(function(){return U})),n.d(t,"CHAT_ACTION_UNMUTE",(function(){return G})),n.d(t,"CHAT_ACTION_CLEAR",(function(){return q})),n.d(t,"CHAT_ACTION_LEAVE",(function(){return V})),n.d(t,"CHAT_ACTION_RETURN",(function(){return W})),n.d(t,"CHAT_ACTION_BLOCK_COMMUNITY",(function(){return K})),n.d(t,"CHAT_ACTION_ALLOW_COMMUNITY",(function(){return Y})),n.d(t,"CHAT_ACTION_BLOCK_NOTIFY",(function(){return $})),n.d(t,"CHAT_ACTION_CALL_AUDIO",(function(){return z})),n.d(t,"CHAT_ACTION_CALL_VIDEO",(function(){return X})),n.d(t,"CHAT_ACTION_UNREAD",(function(){return Q})),n.d(t,"ACTION_PRIORITIES",(function(){return Z})),n.d(t,"loadHashes",(function(){return J})),n.d(t,"loadWriteHash",(function(){return ne})),n.d(t,"strHistory",(function(){return re})),n.d(t,"updateBlockStates",(function(){return ie})),n.d(t,"setCallAvailability",(function(){return se})),n.d(t,"loadPeer",(function(){return oe})),n.d(t,"restoreHistoryQueue",(function(){return le})),n.d(t,"removeFailed",(function(){return ce})),n.d(t,"removeExpiredFailed",(function(){return de})),n.d(t,"selectPeer",(function(){return ge})),n.d(t,"selectPeerOnMessage",(function(){return _e})),n.d(t,"changePeer",(function(){return pe})),n.d(t,"updateMentions",(function(){return he})),n.d(t,"setActions",(function(){return fe})),n.d(t,"loadMoreHistory",(function(){return be})),n.d(t,"loadLessHistory",(function(){return ve})),n.d(t,"readLastMessages",(function(){return ye})),n.d(t,"readTillSpecificMessage",(function(){return Ce})),n.d(t,"markAudioMessageAsListened",(function(){return Ee})),n.d(t,"loadLongPollKey",(function(){return je})),n.d(t,"loadLongPollTs",(function(){return Te})),n.d(t,"setMessageErrored",(function(){return Se})),n.d(t,"resendMessage",(function(){return Ie})),n.d(t,"loadAdmins",(function(){return we})),n.d(t,"updateVideoThumb",(function(){return Me})),n.d(t,"editMessage",(function(){return Ne})),n.d(t,"addMessage",(function(){return Pe})),n.d(t,"markInboundMessagesAsRead",(function(){return Be})),n.d(t,"markOutboundMessagesAsRead",(function(){return He})),n.d(t,"initTextStore",(function(){return Fe})),n.d(t,"processFwd",(function(){return Ue})),n.d(t,"mergeTabs",(function(){return Ge})),n.d(t,"updateOnline",(function(){return qe})),n.d(t,"setActivity",(function(){return Ve})),n.d(t,"updateActivity",(function(){return We})),n.d(t,"waitActivity",(function(){return Ke})),n.d(t,"sendMessage",(function(){return $e})),n.d(t,"deliverMessage",(function(){return ze})),n.d(t,"deliverEditedMessage",(function(){return Xe})),n.d(t,"addSelection",(function(){return Qe})),n.d(t,"cleanSelected",(function(){return Ze})),n.d(t,"dropSelection",(function(){return Je})),n.d(t,"replaceMessage",(function(){return et})),n.d(t,"saveMedia",(function(){return tt})),n.d(t,"loadMedia",(function(){return nt})),n.d(t,"addAttachmentsToStoreData",(function(){return at})),n.d(t,"replaceMediaAttachesStore",(function(){return rt})),n.d(t,"setCurrentSearchDate",(function(){return it})),n.d(t,"setInplaceSearch",(function(){return st})),n.d(t,"setCurrentSearch",(function(){return ot})),n.d(t,"searchHints",(function(){return lt})),n.d(t,"searchHintsIndex",(function(){return ct})),n.d(t,"localIndexToDialog",(function(){return dt})),n.d(t,"searchTopConv",(function(){return gt})),n.d(t,"searchImTopConv",(function(){return mt})),n.d(t,"searchLocalHints",(function(){return _t})),n.d(t,"preloadSearchIndex",(function(){return pt})),n.d(t,"loadDialogs",(function(){return ht})),n.d(t,"searchMessages",(function(){return ft})),n.d(t,"isSearchAllLoaded",(function(){return bt})),n.d(t,"isSearchingInplace",(function(){return vt})),n.d(t,"cancelSearch",(function(){return Ot})),n.d(t,"clearDate",(function(){return yt})),n.d(t,"searchInplaceStart",(function(){return Ct})),n.d(t,"searchMessagesInplace",(function(){return Et})),n.d(t,"loadImportant",(function(){return jt})),n.d(t,"loadActualLastMessage",(function(){return Tt})),n.d(t,"removeUnreadDeletedMsgsFromTab",(function(){return St})),n.d(t,"removeMessagesMarkDeleted",(function(){return It})),n.d(t,"removeMessages",(function(){return At})),n.d(t,"removeMessageSend",(function(){return wt})),n.d(t,"removeMessagesWithRestore",(function(){return Lt})),n.d(t,"restoreMessage",(function(){return kt})),n.d(t,"restoreMessageSend",(function(){return Mt})),n.d(t,"acceptMessageRequest",(function(){return Pt})),n.d(t,"rejectMessageRequest",(function(){return Dt})),n.d(t,"cancelMessageRequest",(function(){return Rt})),n.d(t,"sendTyping",(function(){return xt})),n.d(t,"sendRecordingAudio",(function(){return Bt})),n.d(t,"forwardMessages",(function(){return Ht})),n.d(t,"prepareForward",(function(){return Ft})),n.d(t,"deletedDialog",(function(){return Ut})),n.d(t,"flushHistory",(function(){return Gt})),n.d(t,"updateChatTopic",(function(){return qt})),n.d(t,"loadChatInfo",(function(){return Vt})),n.d(t,"addNewMemberOptimisticly",(function(){return Wt})),n.d(t,"addNewMember",(function(){return Kt})),n.d(t,"loadChatMember",(function(){return Yt})),n.d(t,"checkNewPeople",(function(){return $t})),n.d(t,"loadNewPeople",(function(){return zt})),n.d(t,"updateChatPhoto",(function(){return Xt})),n.d(t,"updateActions",(function(){return Qt})),n.d(t,"leaveChat",(function(){return Zt})),n.d(t,"returnToChat",(function(){return Jt})),n.d(t,"toggleMutePeer",(function(){return en})),n.d(t,"toggleMuteMentionsPeer",(function(){return tn})),n.d(t,"setMutedPeer",(function(){return nn})),n.d(t,"setExecStack",(function(){return an})),n.d(t,"favMessage",(function(){return rn})),n.d(t,"updateFavMessage",(function(){return sn})),n.d(t,"updateImportant",(function(){return on})),n.d(t,"loadSpam",(function(){return ln})),n.d(t,"flushSpam",(function(){return cn})),n.d(t,"setCreationType",(function(){return dn})),n.d(t,"getOwnerPhoto",(function(){return un})),n.d(t,"getContactsList",(function(){return gn})),n.d(t,"presetAvatar",(function(){return mn})),n.d(t,"setChatPhoto",(function(){return _n})),n.d(t,"createChat",(function(){return pn})),n.d(t,"createCommunityChat",(function(){return hn})),n.d(t,"resync",(function(){return fn})),n.d(t,"toggleSendingAbility",(function(){return bn})),n.d(t,"setDelayedMessage",(function(){return vn})),n.d(t,"isAnythingLoading",(function(){return On})),n.d(t,"updateUnreadCount",(function(){return yn})),n.d(t,"changeSubmitSettings",(function(){return Cn})),n.d(t,"updateFavAndTitle",(function(){return En})),n.d(t,"saveHistoryScroll",(function(){return jn})),n.d(t,"filterFromTab",(function(){return Tn})),n.d(t,"changeDialogsTab",(function(){return Sn})),n.d(t,"updateFolderState",(function(){return An})),n.d(t,"toggleDialogImportant",(function(){return wn})),n.d(t,"markDialogAnswered",(function(){return Ln})),n.d(t,"markDialogUnread",(function(){return kn})),n.d(t,"markDialogRead",(function(){return Mn})),n.d(t,"getMutexQueue",(function(){return Nn})),n.d(t,"releaseBlock",(function(){return Pn})),n.d(t,"toggleCommunityMute",(function(){return Dn})),n.d(t,"deleteDialog",(function(){return Rn})),n.d(t,"restoreDialog",(function(){return xn})),n.d(t,"spamDialog",(function(){return Bn})),n.d(t,"updateTabbedPeers",(function(){return Hn})),n.d(t,"isEverythingLoaded",(function(){return Fn})),n.d(t,"cleanTab",(function(){return Un})),n.d(t,"stringifyTab",(function(){return Gn})),n.d(t,"updateGoToEndVisibility",(function(){return qn})),n.d(t,"updateGoToMentionVisibility",(function(){return Vn})),n.d(t,"toggleCommunityMessages",(function(){return Wn})),n.d(t,"updateHistory",(function(){return Kn})),n.d(t,"syncHistory",(function(){return Yn})),n.d(t,"startRecording",(function(){return $n})),n.d(t,"cancelRecording",(function(){return zn})),n.d(t,"setVoiceMessageAvail",(function(){return Xn})),n.d(t,"toggleConversation",(function(){return Qn})),n.d(t,"updateSearchQuery",(function(){return Zn})),n.d(t,"initializeChatResize",(function(){return Jn})),n.d(t,"joinChat",(function(){return ea})),n.d(t,"getInviteLink",(function(){return ta})),n.d(t,"resetInviteLink",(function(){return na})),n.d(t,"leaveInvitation",(function(){return aa})),n.d(t,"saveRecentSearchPeer",(function(){return ra})),n.d(t,"resetRecentSearch",(function(){return ia})),n.d(t,"removeFromRecentSearch",(function(){return sa})),n.d(t,"pinMessageOptimistic",(function(){return oa})),n.d(t,"unpinMessageOptimistic",(function(){return la})),n.d(t,"pinMessage",(function(){return ca})),n.d(t,"unpinMessage",(function(){return da})),n.d(t,"getPinnedMessage",(function(){return ua})),n.d(t,"getMessageLocalId",(function(){return ga})),n.d(t,"getChatMembers",(function(){return ma})),n.d(t,"getChatDetails",(function(){return _a})),n.d(t,"updateFlags",(function(){return pa})),n.d(t,"removeChatPhoto",(function(){return ha})),n.d(t,"kickUserOptimisticly",(function(){return fa})),n.d(t,"kickUser",(function(){return ba})),n.d(t,"toggleAdminOptimisticly",(function(){return va})),n.d(t,"toggleAdmin",(function(){return Oa})),n.d(t,"checkChatMember",(function(){return ya})),n.d(t,"hidePromoTooltip",(function(){return Ca})),n.d(t,"videoAutoPlayHandler",(function(){return Ea})),n.d(t,"hideTopBannerAction",(function(){return ja})),n.d(t,"callbackTopBannerAction",(function(){return Ta})),n.d(t,"loadBanner",(function(){return Sa})),n.d(t,"setKeyboard",(function(){return Ia})),n.d(t,"deleteKeyboard",(function(){return Aa})),n.d(t,"toggleKeyboard",(function(){return wa})),n.d(t,"loadKeyboard",(function(){return La})),n.d(t,"changeCommunityAccess",(function(){return ka})),n.d(t,"deleteTemplate",(function(){return Ma})),n.d(t,"createTemplate",(function(){return Na})),n.d(t,"updateTemplate",(function(){return Pa})),n.d(t,"resetTabAll",(function(){return Da})),n.d(t,"updateMessageRequestsCounter",(function(){return Ra})),n.d(t,"updateCasperMessageExpiringStatus",(function(){return xa})),n.d(t,"prepareCasperMessagesFromMessages",(function(){return Ba})),n.d(t,"peerProfileToggleTag",(function(){return Ha})),n.d(t,"peerProfileManageTags",(function(){return Fa})),n.d(t,"peerProfileSaveNote",(function(){return Ua})),n.d(t,"reloadMessage",(function(){return Ga})),n.d(t,"getPeerActiveCallData",(function(){return qa})),n.d(t,"removePeerActiveCallData",(function(){return Va}));n("HEwt"),n("rE2o"),n("ioFf"),n("hhXQ"),n("a1Th"),n("OG14"),n("OEbY"),n("Vd3H"),n("91GP"),n("SRfc"),n("rGqo"),n("VRzm"),n("Btvt");var a=n("BxOC"),r=n("bIHZ"),i=n("f01n"),s=n("DM26"),o=n("rudk"),l=n("aong"),c=n("uytb"),d=n("P13b"),u=n("h++7"),g=n("rHUl"),m=n("MhhX"),_=n("86+7"),p=n("ERyv"),h=n("Wu9C"),f=n("lJdi"),b=n("O8ze"),v=n("zxIV"),O=n("XzvV"),y=n("ambf");function C(){return(C=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e}).apply(this,arguments)}function E(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var n=[],a=!0,r=!1,i=void 0;try{for(var s,o=e[Symbol.iterator]();!(a=(s=o.next()).done)&&(n.push(s.value),!t||n.length!==t);a=!0);}catch(e){r=!0,i=e}finally{try{a||null==o.return||o.return()}finally{if(r)throw i}}return n}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return j(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return j(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function j(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,a=new Array(t);n<t;n++)a[n]=e[n];return a}var T="al_im.php",S=5,I="typing",A="audiomessage",w=Object(r.updateLazyLocation)(),L=w.scheduleNav,k=w.commitNav,M=w.scheduleNavWithTimeOut;var N="settings",P="block",D="invite",R="media",x="search",B="pin_hide",H="pin_unhide",F="unpin",U="mute",G="unmute",q="clear",V="leave",W="return",K="block_community",Y="allow_community",$="block_notify",z="call_audio",X="call_video",Q="unread",Z={[N]:0,[P]:1,[D]:2,[R]:3,[x]:6,[Q]:6,[B]:7,[H]:7,[F]:8,[U]:10,[G]:10,[q]:11,[V]:12,[W]:12,[K]:12,[Y]:12,[$]:12};function J(e,t,n){return Object(a.post)(T,{act:"a_renew_hash",peers:e.join(","),gid:t.hidegid?void 0:n.gid})}function ee(e,t,n){return function(e){return e.resync_in_process?e.resync_in_process:Promise.resolve(!1)}(e).then(a=>a?t(...n):function(e){if(!e.renew_hashes){var t=e.last_hashes_update||0;if(Date.now()-t<1e4)return Promise.resolve();var n=Object.keys(e.tabs).filter(t=>Object(d.isFullyLoadedTab)(e,t));e.renew_hashes=J(n,{},e).then(t=>{var a=E(t,3),r=a[0],i=a[1],s=a[2];return n.forEach(t=>{e.tabs[t].hash=r[t]}),e.writeHash=i,e.manageTagsHash=s,delete e.renew_hashes,e.last_hashes_update=Date.now(),e})}return e.renew_hashes}(e).then(e=>t(...n)))}function te(e){return function(){var t=arguments,n=t[t.length-1];return e(...t).catch(a=>{if(a&&a.match&&a.match(/1001;/))return ee(n,e,t);throw a})}}function ne(e){return Object(a.post)(T,C({act:"a_get_write_hash"},e))}function ae(e){return"string"==typeof e?Object(v.se)(`<div>${e}</div>`):e}function re(e){return"string"==typeof e?e:e.innerHTML}function ie(e,t){return t.block_states=extend(t.block_states,e),Promise.resolve(t)}function se(e,t){return t.tabs[e].can_start_call=Object(f.canStartGroupCall)(t,e),Promise.resolve(t)}function oe(e,t,n,r,i){return i.tabHistoryNotChanged=!1,Object(s.retryFn)(a.post,3,e=>e-1)(T,{act:"a_start",peer:e,msgid:n,history:t,prevpeer:i.prevPeer,gid:i.gid,block:r}).then(t=>{var a=E(t,6),r=a[0],s=a[1],o=a[2],l=a[3],c=a[4],g=a[5];if(s.forEach(e=>Object(_.oCacheAdd)(i,e)),i.tabs||(i.tabs={}),i.dialog_tab_cts=Object.assign({},c,{[u.FOLDER_MESSAGE_REQUEST]:i.dialog_tab_cts[u.FOLDER_MESSAGE_REQUEST]}),i.tabs[e]||(i.tabs[e]=Object(d.normalizeTab)(i,r)),ie(l,i),n){if(i.tabs[e]){var m=i.tabs[e].lastmsg,p=i.tabs[e].lastmsg_meta;extend(i.tabs[e],r),i.tabs[e].lastmsg=m,i.tabs[e].lastmsg_meta=p}}else extend(i.tabs[e],r);return i.admins=extend(i.admins,o),i.imQueue(e,!1),Ea(),g&&(i.tabs[e].peer_profile_info=g),le(e,i)}).catch(e=>Object(p.imWeirdCatch)("loadPeer",e))}function le(e,t){var n=t.imQueue(e,!1),a=t.tabs[e],r=n.filter(n=>!Object(g.isRidExist)(t,e,n.rid));return a.msgs=r.reduce((e,t)=>(e["rid"+t.rid]=t.mess,e),a.msgs),t.imQueueSet(e,r),t.tabs[e].history=Object(d.restoreQueue)(r,t,ae(t.tabs[e].history)),Promise.resolve(t)}function ce(e,t,n,a){var r=a.imQueue(t),i=[],s=[];return r.forEach(e=>{e.failed&&n&&e.mess.messageId!==n&&s.push(e),!e.failed||n&&e.mess.messageId!==n||i.push("rid"+e.rid)}),a.imQueueSet(t,s),a.tabs[t].history=Object(d.removeMessages)(i,ae(a.tabs[t].history)),Object(d.removeMessages)(i,e),Promise.resolve(a)}function de(e,t,n){var a=n.imQueue(t),r=[],i=[],s=Date.now();return a.forEach(e=>{e.failed&&s-e.ts<864e5&&i.push(e),e.failed&&s-e.ts>=864e5&&r.push("rid"+e.rid)}),n.imQueueSet(t,i),n.tabs[t].history=Object(d.removeMessages)(r,ae(n.tabs[t].history)),Object(d.removeMessages)(r,e),Promise.resolve(n)}function ue(e,t){return!1===(t.block_states[e]||{}).free?Promise.resolve(t):Object(a.post)(T,{act:"a_block",peer:e,prevPeer:t.prevPeer,gid:t.gid}).then(e=>ie(E(e,1)[0],t))}function ge(e,t){var n=t.peer;return Promise.resolve(t).then(t=>(t.tabHistoryNotChanged=!1,Object(d.isFullyLoadedTab)(t,n)&&!t.tabs[n].msgid?(t.gid&&ue(n,t),Promise.resolve(t).then(fe)):(Object(d.isFullyLoadedTab)(t,n)&&(t.tabs[n].msgid=!1),oe(n,e,!1,!0,t)))).then(fe).then(me.bind(null,n))}function me(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return Object(d.isTabLoaded)(t,e)&&(t.tabs[e].last_touched=Date.now()),Object(d.isTabLoaded)(t,e)&&n&&(t.tabs[e].last_visited=Date.now()),t}function _e(e,t,n){var a=n.msgid,r=n.peer;return!e&&Object(d.isFullyLoadedTab)(n,r)&&n.tabs[r].msgs[a]?(t===n.peer?n.tabHistoryNotChanged=!0:n.tabHistoryNotChanged=!1,n.gid&&ue(r,n),Promise.resolve(n).then(fe).then(me.bind(null,r))):oe(r,!0,a,!0,n).then(fe).then(()=>(Object(g.getTab)(n,r).msgid=a,n)).then(me.bind(null,r))}function pe(e,t,n,a){if(On(a))throw Object(d.showWaitUntilUploadedBox)(),new Error("Cant change peer while loading something");var r=a.gid?"gim"+a.gid:"im";if(a.prevPeer=a.peer,a.peer=e,a.msgid=t||"",a.currentEntryPoint=n,cur.peer=e,L({sel:e?Object(d.convertPeerToUrl)(e):null,msgid:a.msgid,email:"",0:r}),0!=a.prevPeer&&me(a.prevPeer,a,!0),0!==e){Object(d.isTabLoaded)(a,e)&&me(e,a,!0),Hn(a.tabbedPeers.map(e=>e.peer).indexOf(e)<0?[{peer:e,type:"perm"}].concat(a.tabbedPeers):a.tabbedPeers.map(t=>(t.peer==e&&"perm"!==t.type&&(t.type="perm"),t)),!1,a)}else Hn(a.tabbedPeers,!1,a);return k(),Ot(a.prevPeer,a)}function he(e){var t=e.isMassMentionsMessageAllowed;cur.wallMentions=()=>new Promise((n,a)=>{if(cur.wallMentions=[],!Object(d.isChatPeer)(e.peer)||!Object(d.isFullyLoadedTab)(e,e.peer)||Object(d.isFvkcomgroup)(e,e.peer))return a();var r=e.tabs[e.peer];function i(){var a=[];Object.keys(r.msgs||{}).reverse().forEach(e=>{var t=Object(g.parserMessage)(r.msgs[e]),n=t&&t.userId;n&&n!=vk.id&&-1===a.indexOf(n)&&Object(d.isUserAliveInChat)(r,n)&&a.push(n)}),(r.memberIds||[]).forEach(e=>{-1===a.indexOf(e)&&a.push(e)});var i=[];a.forEach(t=>{if(Object(_.oCacheExists)(e,t)){var n=Object(_.oCacheGet)(e,t),a=n.link.substring(1);i.push([n.id,n.name,"@"+a,n.photo,void 0,void 0,void 0,a,n.first_name,""])}});var s=getLang("mail_im_mention_all"),o=getLang("mail_im_mention_online");t&&Object(f.canMassMention)(e)&&i&&i.length>1&&(u.MASS_MENTION_ALIASES.online.forEach(e=>i.push(["online",o,"@"+e,"/images/mention_online.svg",void 0,void 0,void 0,e,e,""])),u.MASS_MENTION_ALIASES.all.forEach(e=>i.push(["all",s,"@"+e,"/images/mention_all.svg",void 0,void 0,void 0,e,e,""]))),n(i)}r.membersLoaded?i():ma(e.peer,e).then(i)})}function fe(e){var t=e.peer;if(0===t)return Promise.resolve(e);var n=e.tabs[t],a=Object(d.isChatPeer)(t),r=Object(g.isChannelPeer)(n),i=Object(g.isCommunityChat)(e,t),s=a&&!Object(g.isChatActive)(n),o=!!n.offset,l=[];o&&l.push(R),o&&l.push(x),0===n.unread&&l.push(Q),!Object(d.isEmailPeer)(t)&&!o||r||l.push(q),!Object(d.isCommunityInterface)(e)||r||i||l.push(P),r&&!s&&l.push(N),Object(d.isCommunityPeer)(t)&&(n.can_send_notify?l.push($):l.push(n.blocked_community?Y:K)),!Object(d.isCommunityInterface)(e)&&(a||Object(d.isUserPeer)(t)||Object(d.isCommunityPeer)(t))&&(!a||!s)&&l.push(inArray(t,e.mutedPeers)?G:U);var c=!Object(d.isCommunityInterface)(e)&&Object(d.isUserPeer)(t)&&n.is_friend&&!n.block_error,u=a&&!s&&Object(f.canInviteUser)(e);(c||u)&&l.push(D),!a||s||Object(d.isCommunityInterface)(e)||l.push(V),a&&n.data.closed&&!n.data.kicked&&l.push(W),a&&n.pinned&&(l.push(Object(h.isPinnedMessageVisibleInTab)(e,t)?B:H),Object(f.canPinOrUnpin)(e)&&l.push(F));var m=Object(d.chatActions)(e,r);return e.curActions=l.sort((e,t)=>Z[e]-Z[t]).reduce((e,t)=>(e[t]=m[t],e),{}),Promise.resolve(e)}function be(e,t,n){var r=n.tabs[n.peer];return Object(a.post)(T,{peer:n.peer,whole:e,act:"a_history",offset:r.offset+(r.skipped||0),toend:t,gid:n.gid}).then(e=>{var t=E(e,4),a=t[0],i=t[1],s=t[2],o=t[3];return r.allShown=s,n.admins=extend(n.admins,o),r.history=a+re(r.history),r.historyToAppend=a,r.offset+=Object.keys(i).length,r.msgs=extend(r.msgs,i),n})}function ve(e){var t=e.tabs[e.peer];return Object(a.post)(T,{peer:e.peer,act:"a_history",rev:1,offset:t.skipped,gid:e.gid}).then(n=>{var a=E(n,5),r=a[0],i=a[1],s=a[2];a[3],a[4];t.allShown=t.allShown||s,t.history=re(t.history)+r,t.historyToAppend=r;var o=Object.keys(i).length;return t.skipped-=o,t.offset+=o,t.msgs=extend(t.msgs,i),e})}function Oe(e,t,n,a){var r=e.tabs[t];return a===i.FLAG_OUTBOUND&&r.out_up_to>n||(a===i.FLAG_OUTBOUND?r.out_up_to=n:r.in_up_to=n),e}var ye=te((function(e,t){if(Object(d.tabIsMessageRequest)(t.tabs[e]))return Promise.resolve(t);var n=t.tabs[e],r=n.msgs||{},s=Object.keys(r).map(n=>Object(g.getMessage)(t,e,n)).filter(e=>!Object(m.isOut)(e)).map(e=>e.messageId).sort((e,t)=>t-e);return n.skipped>0&&(s=s.filter(e=>intval(e)<=n.lastmsg-n.skipped)),(s=intval(s.shift()))<=n.in_up_to?Promise.resolve(t):(t.longpoll.push([i.readInboundEvent([6,e,s,null])]),Object(a.post)(T,{peer:e,ids:[s],hash:n.hash,act:"a_mark_read",gid:t.gid}).then(()=>Oe(t,e,s,i.FLAG_OUTBOUND)).catch(()=>t))})),Ce=te((function(e,t,n){var r=n.tabs[t];return Object(d.tabIsMessageRequest)(r)||Object(d.tabIsOutgoingMessageRequest)(r)||e<=r.in_up_to?Promise.resolve(n):(n.longpoll.push([i.readInboundEvent([6,t,e,null])]),Object(a.post)(T,{peer:t,ids:[e],hash:r.hash,act:"a_mark_read",gid:n.gid}).then(()=>Oe(n,t,e,i.FLAG_OUTBOUND)))})),Ee=te((function(e,t,n){var r=n.tabs[e];return Object(a.post)(T,{peer:e,id:t,hash:r.hash,act:"a_mark_listened",gid:n.gid})}));function je(e){return Object(a.post)(T,{act:"a_get_key",uid:e.id,gid:e.gid}).then(t=>{var n=E(t,3),a=n[0],r=n[1],i=n[2];return extend({},e,{imKey:a,imUrl:r,imPart:i})})}function Te(e){return Object(a.post)(T,{act:"a_get_ts",gid:e.gid}).then(t=>{var n=E(t,1)[0];return extend({},e,{imTs:n})})}function Se(e,t,n){var a=n.tabs[e];return a.msgs[t.messageId]&&(a.msgs[t.messageId].errored=1,a.history=Object(d.setMessageError)(e,t,ae(a.history))),Promise.resolve(n)}function Ie(e,t,n,a){var r=a.tabs[e];return r.msgs[t]&&(r.msgs[t].errored=0,r.lastmsg_meta=n,r.lastmsg=t,r.history=Object(d.startResendMessage)(e,t,ae(r.history))),Promise.resolve(a)}function Ae(e,t,n,a){var r=arguments.length>4&&void 0!==arguments[4]&&arguments[4];t.deletedDialog||(e.dialog_tabs=Object.keys(e.dialog_tabs).reduce((e,i)=>(!n&&!Tn(i)(t)||r&&!r(i,e[i],t)||(e[i]=Object(l.arrayUnique)(a(e[i],i))),e),e.dialog_tabs))}function we(e,t){return 0===e.length?Promise.resolve(t):Object(a.post)(T,{act:"a_get_admin",admins:e.join(","),gid:t.gid}).then(e=>{var n=E(e,1)[0];return t.admins=extend(t.admins,n),t})}function Le(e,t){if(!inArray(e,t.tabbedPeers.map(e=>e.peer))&&(0!==t.peer||t.searchText)&&!inArray(e,t.mutedPeers)){var n={peer:e,type:"temp"};Hn(t.tabbedPeers.concat([n]),!1,t)}}function ke(e,t,n){return Object(d.isReversedDialogs)(n)?t.concat([e]):[e].concat(t)}function Me(e,t){var n=e.get().peer,a=Object(g.getTab)(e,n);if(Object(d.isFullyLoadedTab)(e,n)){var r=ae(a.history);a.history=Object(d.updateMessageInCache)(e,r,t)}}function Ne(e,t){var n=Object(g.getTab)(t,e.peerId);if(Object(d.isFullyLoadedTab)(t,e.peerId)){var a=ae(n.history);n.msgs[e.messageId]=extend(!0,{},e),n.history=Object(d.editAndReplaceMessage)(t,e,a)}n&&n.lastmsg===e.messageId&&(n.lastmsg_meta=e);var r=n&&n.pinned&&Object(g.parserMessage)(n.pinned);if(r&&r.messageId===e.messageId&&(n.pinned=e),Object(d.isTabLoaded)(t,e.peerId)&&!Object(m.isOut)(e)&&Object(m.isUnread)(n,e)){var i=Object(m.hasUserMentions)(e,t.id),s=n.mentions&&n.mentions.includes(e.messageId);i&&!s?(n.mentions||(n.mentions=[]),n.mentions.push(e.messageId)):!i&&s&&xe(e.peerId,t=>t!==e.messageId,t)}return Promise.resolve(t)}function Pe(e,t){var n=e.flags&i.FLAG_OUTBOUND,a=e.peerId;if(Object(d.isTabLoaded)(t,a)){var r=t.tabs[a];if(r.lastmsg>e.messageId)return Promise.resolve(t);if(r.deletedDialog=!1,!t.msg_local_ids_sort&&e.local?t.msg_local_ids_sort={[e.messageId]:0}:e.local&&(t.msg_local_ids_sort[e.messageId]=Object.keys(t.msg_local_ids_sort).length),n||Object(d.tabIsMessageRequest)(r)?r.unread=0:(r.lastmsg===e.messageId&&r.unread?De(t,1,e.peerId):(!r.unread&&De(t,1,e.peerId),r.unread++),y.casperMessagesStore.has(e.messageId)&&!Object(g.isCasperChatTab)(r)&&(r.expiring_messages||(r.expiring_messages=[]),r.expiring_messages.push(e.messageId)),Object(m.hasUserMentions)(e,t.id)&&(r.mentions||(r.mentions=[]),r.mentions.push(e.messageId)),Le(e.peerId,t)),Object(d.isFullyLoadedTab)(t,a)){var s=Object(m.isMessageToBlockedCommunity)(r,e),o=s||0===r.offset;s&&(r.blocked_community=0),r.skipped>0&&r.skipped++,r.offset++,r.msgs[e.messageId]=extend(!0,{},e);var l=ae(r.history);r.history=Object(d.appendToHistory)(t,e,l,!0,!0,!0),o&&fe(t)}if(r.typing){var c=r.typing.userIds.indexOf(e.userId);c>=0&&r.typing.userIds.splice(c,1)}return r.lastmsg=e.messageId,r.lastmsg_meta=e,Number.isInteger(e.messageId)&&e.messageId>(r.minor_sort_id||0)&&(r.minor_sort_id=e.messageId),me(e.peerId,t),Ae(t,r,!1,ke.bind(null,a),In.bind(null,t)),Promise.resolve(t)}return oe(a,0,0,0,t).then(t=>(Ae(t,t.tabs[a],!1,ke.bind(null,a),In.bind(null,t)),me(e.peerId,t),n||Le(e.peerId,t),t))}function De(e,t,n){e.cur_unread_cnt||(e.cur_unread_cnt={}),-1===t&&delete e.cur_unread_cnt[n],e.unread_cnt+=t}function Re(e,t,n){var a=n.tabs[e];return a.expiring_messages&&(a.expiring_messages=a.expiring_messages.filter(t),a.expiring_messages.length||delete a.expiring_messages),n}function xe(e,t,n){var a=n.tabs[e];return a.mentions&&(a.mentions=a.mentions.filter(t),a.mentions.length||delete a.mentions),n}function Be(e,t){var n=Object(g.getTab)(t,e.peerId);if(Object(d.isFullyLoadedTab)(t,e.peerId)){var a=n.unread;if(t=Oe(t,e.peerId,e.upToId,0),null!==e.unread?n.unread=e.unread:n.unread=e.upToId>=n.lastmsg?0:Object(g.countUnread)(e.peerId,t)+(n.unread>0?+n.skipped:0),a>0&&!n.unread&&De(t,-1,e.peerId),!n.skipped){var r=ae(n.history);n.history=Object(d.removewNewUnreadBarAndMerge)(t,r,e.peerId)}}else Object(d.isTabLoaded)(t,e.peerId)&&(t.tabs[e.peerId].unread>0&&De(t,-1,e.peerId),t.tabs[e.peerId].unread=0,t.tabs[e.peerId].in_up_to=e.upToId);return Object(d.isTabLoaded)(t,e.peerId)&&e.upToId>=n.lastmsg&&(t.dialog_tabs[u.FOLDER_UNREAD]=t.dialog_tabs[u.FOLDER_UNREAD].filter(t=>intval(t)!==e.peerId)),Object(d.isTabLoaded)(t,e.peerId)&&(Re(e.peerId,t=>t>e.upToId,t),xe(e.peerId,t=>t>e.upToId,t)),0!==t.unread_cnt||t.active_tab!==u.FOLDER_UNREAD||t.gid?Promise.resolve(t):Sn(u.FOLDER_ALL,t)}function He(e,t){var n=t.tabs[e.peerId];if(Object(d.isTabLoaded)(t,e.peerId)&&Oe(t,e.peerId,e.upToId,i.FLAG_OUTBOUND),Object(d.isFullyLoadedTab)(t,e.peerId)){var a=ae(n.history);n.history=Object(d.markMessagesAsRead)(t,e.peerId,a)}return Promise.resolve(t)}function Fe(e,t,n,a,r){return r.text={},r.imQueue=e,r.imQueueResend=t,r.imQueueSet=n,r.imQueueComplete=a,Promise.resolve(r)}function Ue(e,t,n){function a(e,t){return{id:e.messageId,text:e.text,date:e.date,kludges:e.kludges,authorName:t}}if(1===e.length){var r=e[0],i=Object(g.getMessage)(n,t,r),s=Object(g.getAuthorFullName)(n,t,r);return!1===s?n.set(Yt.bind(null,{[t]:[i.userId]})).then(n=>{var s=Object(g.getAuthorFullName)(n,t,r);return{msgIds:e,object:a(i,s)}}):Promise.resolve({msgIds:e,object:a(i,s)})}return Promise.resolve({msgIds:e})}function Ge(e,t){Object(d.normalizeTabsGotFromServer)(t,e);var n=t.tabs[t.peer];return t.tabs=Object.keys(e).reduce((n,a)=>{var r=t.tabs[a]?t.tabs[a].msgs:{},i=extend({},r||{},e[a].msgs||{});return n[a]=extend(t.tabs[a]||{},e[a]),i&&(n[a].msgs=i),e[a].lastmsg||(n[a].lastmsg=!1),n},t.tabs),n&&(t.tabs[t.peer]=n),Promise.resolve(t)}function qe(e,t,n,a){var r=Object(g.getTab)(a,e);if(r&&r.last_seen&&r.last_seen.can_see){var i=!1!==t?mobPlatforms[t]?1:0:r.last_seen.mobile;r.online=t,r.last_seen={platform:t,time:n||r.last_seen.time,mobile:i,can_see:r.last_seen.can_see}}return Promise.resolve(a)}function Ve(e,t,n){var a=Object(g.getTab)(n,e.peerId);return a&&(e.ts=Date.now()/1e3,a.activity||(a.activity={}),a.activity[t]=e,a.typing===I&&(a.typing=e)),Promise.resolve(n)}function We(e,t){var n=Object(g.getTab)(t,e.peerId),a=Object(m.isAudioMsg)(e)?"audiomessage":"typing";return n&&n.activity&&n.activity[a]&&(n.activity[a].userIds=n.activity[a].userIds.filter(t=>t!==e.userId)),Promise.resolve(t)}function Ke(e,t,n){var a=e.peerId;return Object(s.pause)(S+2).then(()=>{if(Object(d.isTabLoaded)(n,a)){var e=n.tabs[a];if((e.activity||{})[t])Date.now()-1e3*e.activity[t].ts>=1e3*S&&(delete e.activity[t],0===Object.keys(e.activity)&&delete e.activity);if(e.typing)Date.now()-1e3*e.typing.ts>=1e3*S&&(e.typing=void 0)}return n})}function Ye(e){var t={},n=e.find(e=>"poll"===e[0]);if(n){var a=E(n,3)[2];Object.assign(t,a)}return t}var $e=function(e,t,n,r){var i=Date.now()+rand(0,100).toFixed(0),s=r.ref_id,l=r.ref_source;r.ref_source=void 0,r.ref_id=void 0,(l||s)&&(L({ref_source:null,ref:null}),k()),Object(b.statlogsSendingQueueLength)(r);var c=t.attaches.length>0,d=Object(b.statlogsSendingTime)(r,"send","server",c),u=Object.assign({act:"a_send",to:e,hash:n.hash,ref_source:l,ref:s,msg:t.message,payload:t.payload,media:Object(o.convertAttachesToPhpMedia)(t.attaches),guid:i,share_url:t.share_url,cancelled_shares:t.cancelled_shares,random_id:t.rid,gid:n.hidegid?void 0:r.gid,entrypoint:r.currentEntryPoint||"",sticker_referrer:t.sticker_referrer},n.external,Ye(t.attaches));return Object(a.post)(T,u,2e4).then(e=>{var t=E(e,1)[0];return d(),r.version!==t.version&&nav.reload({force:!0}),r.currentEntryPoint="",r}).catch(e=>{throw Object(b.statlogsSendingError)(r,e,"send","server_send"),e})},ze=te((function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},a=arguments.length>3?arguments[3]:void 0,r=a.tabs[e];return $e(e,t,C({hash:r.hash},n),a)})),Xe=te((function(e,t,n){var r=t.attaches.length>0,i=Object(b.statlogsSendingTime)(n,"edit","server",r);return Object(a.post)(T,Object.assign({act:"a_edit_message",hash:e.hash,id:t.messageId,peerId:e.peerId,gid:n.gid,msg:t.origText,media:Object(o.convertAttachesToPhpMedia)(t.attaches),share_url:t.share_url,cancelled_shares:t.cancelled_shares},Ye(t.attaches)),2e4).then(e=>{E(e,1)[0];return i(),n}).catch(e=>{throw Object(b.statlogsSendingError)(n,e,"edit","server_send"),e})}));function Qe(e,t){if(t.selectedMessages||(t.selectedMessages=[]),1===e.length&&inArray(e[0],t.selectedMessages))t.selectedMessages=t.selectedMessages.filter(t=>t!==e[0]);else{var n=t.selectedMessages.concat(e);t.selectedMessages=Object(l.arrayUnique)(n).sort((e,t)=>e-t)}return Promise.resolve(t)}function Ze(e){return e.selectedMessages=[],Promise.resolve(e)}function Je(e){return e.selectedMessages=[],Promise.resolve(e)}function et(e,t){if(Object(d.isFullyLoadedTab)(t,e.peerId)){var n=t.tabs[e.peerId],a=t.imQueue(e.peerId).filter(t=>t.failed&&t.rid!==e.randomId);t.imQueueSet(e.peerId,a),t.imQueueComplete(e.peerId,e.randomId),n.lastmsg_meta=e,n.lastmsg=e.messageId,Number.isInteger(e.messageId)&&e.messageId>n.minor_sort_id&&(n.minor_sort_id=e.messageId),n.msgs["rid"+e.randomId]&&(n.msgs[e.messageId]=e,delete n.msgs["rid"+e.randomId]),n.history=Object(d.replaceMessageAttrs)(t,ae(n.history),e)}return Promise.resolve(t)}function tt(e,t){return Promise.resolve()}function nt(e,t){var n=Object(b.statlogsSendingTime)(t,"unknown","attach"),r={act:"a_get_media",id:e.messageId,gid:t.gid};return Object(s.retryFn)(a.post,3,e=>e*e)(T,r).then(a=>(n(),at(e,a,t))).catch(n=>(Object(b.statlogsSendingError)(t,n,"unknown","server_load_attach"),at(e,null,t)))}function at(e,t,n){var a=n.tabs[e.peerId],r=t&&t[2];return a.mediacontent||(a.mediacontent={}),a.mediacontent[e.messageId]=t||[getTemplate("im_retry_link")],r&&(r.no_forward&&(a.msgs[e.messageId].kludges.no_forward=!0),r.no_pin&&(a.msgs[e.messageId].kludges.no_pin=!0)),rt(e,n)}function rt(e,t){var n=t.tabs[e.peerId];return n.history=Object(d.replaceAttaches)(ae(n.history),e,t),Promise.resolve(t)}function it(e,t,n){var a=Object(d.dayFromVal)(t),r=n.tabs[e];return r.searchDay=a,r.searchOffset=0,r.searchAllLoaded=!1,r.searchMsgs=[],Promise.resolve(n)}function st(e,t,n){return n.tabs[t].searchText=e,Ct(t,n),n}function ot(e,t,n){if(t){var a=n.tabs[t];a.searchText=e,a.searchOffset=0,a.searchAllLoaded=!1}else n.searchText=e,n.searchOffset=0,n.searchAllLoaded=!1;return Promise.resolve(n)}function lt(e,t,n,r,i){return Object(a.post)(T,{act:"a_hints",str:e,gid:r.hidegid?0:i.gid,query:n,peerIds:t.join(",")}).then(t=>{var n=E(t,3),a=n[0],r=n[1];if(ie(n[2],i),r.forEach(e=>Object(_.oCacheAdd)(i,e)),Ge(a,i),e){var s=a&&Object.keys(a).length;Object(O.saveSearchAttemptStats)(O.serviceMessages,0,s,e)}return Object.keys(a).sort((e,t)=>a[e].order-a[t].order).map(e=>a[e])})}function ct(e,t,n,a){return lt(e,t,n,{},a).then(e=>e.map(e=>({peerId:e.peerId,name:e.tab,photo:e.photo,online:e.online,is_friend:"friends"===n})))}function dt(e){var t={peerId:e[0],name:e[1],tab:e[1],photo:e[2],href:e[3],online:e[4],is_friend:e[5],local_index:!0};return e[6]&&(t.data={flags:e[6]}),t}function ut(e){return(t,n)=>e(n).then(e=>{var a=(t?e.search(t):e.list).map(dt);return n.mapped_index||(n.mapped_index={}),a.forEach(e=>{n.mapped_index[e.peerId]=e}),a})}var gt=ut(e=>e.topConvTree),mt=ut(e=>e.imTopConvTree),_t=ut(e=>e.hintsTree);function pt(e,t){var n,r,i;t.topConvTree=new Promise(e=>{n=e}),t.hintsTree=new Promise(e=>{r=e}),t.imTopConvTree=new Promise(e=>{i=e});var o=e.select(c.RECENT_SEARCH_OP);return Object(s.retryFn)(a.post,1,()=>4)(T,{act:"a_dialogs_preload",rs:o.join(","),gid:t.gid}).catch(e=>[[],[],[]]).then(e=>{var a=E(e,4),s=a[0],o=a[1],l=a[2],c=a[3];return t.popular_sugg=l,new vkIndexer(s,e=>e[1],n),new vkIndexer(o,e=>e[1],r),c&&c.length>0?new vkIndexer(c,e=>e[1],i):i(),t})}function ht(e){var t,n,r=e.active_tab,i=e.dialog_tabs[r];return i.length>0?i.forEach(a=>{var r=e.tabs[a],i=r.minor_sort_id,s=r.major_sort_id;void 0===t||t>s?(t=s,n=i):t===s&&n>i&&(n=i)}):(t=0,n=0),Object(a.post)(T,{act:"a_get_dialogs",start_message_id:n,major_sort_id:t,tab:r,gid:e.gid}).then(t=>{var n=E(t,4),a=n[0],s=n[1],o=n[2],l=n[3];return o.forEach(t=>Object(_.oCacheAdd)(e,t)),ie(l,e),Ge(s,e),e.dialog_tabs[r]=i.filter(e=>!s[e]).concat(Object.keys(s).map(intval)),e.dialog_tabs_all[r]=!a.has_more,Promise.resolve(e)})}var ft=te((function(e,t){return Object(a.post)(T,{act:"a_search",q:e,from:"all",gid:t.gid,hash:t.writeHash,offset:t.searchOffset||0}).then(n=>{var a=E(n,5),r=a[0],i=a[1],s=a[2],o=a[3],l=a[4];return i.forEach(e=>Object(_.oCacheAdd)(t,e)),Object(d.normalizeTabsGotFromServer)(t,r),e===t.searchText&&(t.searchOffset=o,t.searchAllLoaded=l),Object.keys(r).filter(e=>!t.tabs[e]).forEach(e=>{t.tabs[e]=r[e]}),[r,s]})}));function bt(e,t){return t.tabs[e].searchAllLoaded}function vt(e,t){return!(t.peer!==e||!Object(d.isFullyLoadedTab)(t,e))&&t.tabs[e].inplaceSearch}function Ot(e,t){if(Object(d.isFullyLoadedTab)(t,e)){var n=t.tabs[e];delete n.inplaceSearch,delete n.searchOffset,delete n.searchAllLoaded,delete n.searchText,delete n.searchDay,delete n.searchMsgs,L({st:""}),k()}return Promise.resolve(t)}function yt(e,t){if(Object(d.isFullyLoadedTab)(t,e)){var n=t.tabs[e];delete n.searchDay,n.searchOffset=0,n.searchAllLoaded=!1,n.searchMsgs=[]}return Promise.resolve(t)}function Ct(e,t){return t.tabs[e].inplaceSearch=!0,Promise.resolve(t)}var Et=te((function(e,t){var n=t.tabs[e],r="";if(Ct(e,t),n.searchDay&&(r="day:"+n.searchDay),!r&&!n.searchText)return Promise.reject();var i=`in:${e} ${r} ${n.searchText||""}`;return L({st:n.searchText}),k(),Object(a.post)(T,{act:"a_search",q:i,from:"in",gid:t.gid,hash:t.writeHash,offset:n.searchOffset||0}).then(e=>{var t=E(e,4),a=t[0],r=t[1],i=t[2],s=t[3];return n.searchOffset=r,n.searchAllLoaded=i,n.searchMsgs=(n.searchMsgs||[]).concat(s),a})}));function jt(e){return Object(a.post)(T,{act:"a_important",offset:e,part:e>0})}function Tt(e,t){var n=Object(g.getTab)(e,t);return Object(a.post)(T,{act:"a_load_lastmsg",peerId:t,gid:e.get().gid}).then(a=>{var r=E(a,4),i=r[0],s=r[1],o=r[2],l=r[3],c=intval(i[0]);n.lastmsg=c||!1,n.lastmsg_meta=i,(!Object(g.isCasperChat)(e,t)||c>n.minor_sort_id)&&(n.minor_sort_id=c);var d=E(s,3);n.unread=d[0],n.in_up_to=d[1],n.out_up_to=d[2],o?n.mentions=o:n.mentions&&delete n.mentions,l?n.expiring_messages=l:n.expiring_messages&&delete n.expiring_messages,n.unread||(e.get().dialog_tabs[u.FOLDER_UNREAD]=e.get().dialog_tabs[u.FOLDER_UNREAD].filter(e=>e!=t)),Ae(e.get(),n,!1,ke.bind(null,t),In.bind(null,e.get()))})}function St(e,t,n){n.tabs[e].unread-=t.length;var a=t.reduce((e,t)=>(e[t]=!0,e),{});return Re(e,e=>!a[e],n),xe(e,e=>!a[e],n),Promise.resolve(n)}function It(e,t,n){if(Object(d.isFullyLoadedTab)(n,t)){var a=n.tabs[t];a.deleted=a.deleted?a.deleted.concat(e):e}return Promise.resolve(n)}function At(e,t,n){if(Object(d.isFullyLoadedTab)(n,t)){var a=n.tabs[t];if(a.history=Object(d.removeMessages)(e,ae(a.history)),a.offset-=e.filter(e=>a.msgs[e]).length,e.forEach(e=>delete a.msgs[e]),e.forEach(e=>{var t=(n.selectedMessages||[]).indexOf(e);-1!=t&&n.selectedMessages.splice(t,1)}),a.inplaceSearch){var r=e.reduce((e,t)=>(e[t]=!0,e),{});a.searchMsgs=a.searchMsgs.filter(e=>!r[e]),a.searchOffset=a.searchMsgs.length}}return Promise.resolve(n)}var wt=te((function(e,t,n,r,i){return Object(a.post)(T,{act:"a_mark",peer:t,hash:n||i.tabs[t].hash,gid:i.gid,msgs_ids:e.join(","),mark:r})}));function Lt(e,t,n,a){if(Object(d.isFullyLoadedTab)(a,t)){var r=a.tabs[t];r.deleted=r.deleted?r.deleted.concat(e):e,r.history=Object(d.removeMessagesWithRestore)(e,t,n,ae(r.history)),r.offset-=e.filter(e=>r.msgs[e]).length}return Promise.resolve(a)}function kt(e,t,n){if(Object(d.isFullyLoadedTab)(n,t)){var a=n.tabs[t];a.deleted&&(a.deleted=a.deleted.filter(t=>t!==e)),a.history=Object(d.restoreMessage)(e,t,ae(a.history)),a.offset++}return Promise.resolve(n)}function Mt(e,t,n,r){return Object(a.post)(T,{act:"a_restore",id:e,peer:t,hash:n,gid:r})}var Nt=te((function(e,t,n){return Object(d.tabIsMessageRequest)(n.tabs[e])?Promise.resolve(n):(n.tabs[e].lastTyping=Date.now(),Object(a.post)(T,{act:"a_activity",type:t,peer:e,gid:n.gid,hash:n.tabs[e].hash}).then(()=>n,()=>n))})),Pt=te((e,t)=>Object(a.post)(T,{act:"a_accept_message_request",peer_id:e,hash:t.tabs[e].hash}).then(()=>{var n=t.tabs[e];return n.is_message_request=!1,n.folders=Object(g.removeMessageRequestFolderFlags)(n.folders),t})),Dt=te((e,t)=>Object(a.post)(T,{act:"a_reject_message_request",peer_id:e,hash:t.tabs[e].hash}).then(()=>(Ae(t,t.tabs[e],!0,t=>t.filter(t=>t!==Number(e))),Hn(t.tabbedPeers.filter(t=>t.peer!==e),!0,t),t))),Rt=te((e,t,n)=>Object(a.post)(T,{act:"a_cancel_message_request",peer_id:e,contact_id:t,hash:n.tabs[e].hash}).then(()=>{var a=n.tabs[e];return a&&a.invitedByMessageRequest&&(a.invitedByMessageRequest=a.invitedByMessageRequest.filter(e=>e.id!==t)),n})),xt=te((function(e,t){return Nt(e,I,t)})),Bt=te((function(e,t){return Nt(e,A,t)}));function Ht(e,t,n,a){return t&&(a.pendingForward=null,e||(e={msgIds:[]}),t.addAttach(n?"reply":"mail",e.msgIds.join(";"),e.object||null)),Promise.resolve(a)}function Ft(e,t){return t.pendingForward=e,Promise.resolve(t)}function Ut(e,t,n){if(!Object(d.isTabLoaded)(n,e))return n;n.blockedFlagUpdates||(n.blockedFlagUpdates={}),n.blockedFlagUpdates[e]=!0;var a=n.tabs[e];return Ae(n,a,!0,t=>t.filter(t=>t!==e)),a.unread>0&&!Object(d.tabIsMessageRequest)(a)&&De(n,-1,e),a.deletedDialog=!0,Hn(n.tabbedPeers.filter(t=>t.peer!==e),!0,n),t.then(t=>{var r=E(t,2);r[0],r[1];return delete n.blockedFlagUpdates[e],a.msgs=null,a.history=null,a.unread=0,a.lastmsg=!1,a.lastmsg_meta=null,a.minor_sort_id=0,n})}var Gt=te((function(e,t){return Ut(e,Object(a.post)("al_im.php",{act:"a_flush_history",id:e,from:"im",gid:t.gid,hash:t.tabs[e].hash}),t)})),qt=te((function(e,t,n){return Object(a.post)(T,{act:"a_set_chat_title",peer:e,new_title:t,gid:n.gid,hash:n.tabs[e].hash}).then(()=>(n.onUpdate&&n.onUpdate(),n))})),Vt=te((function(e,t){return Object(a.post)(T,{act:"a_load_chat_info",peer:e,gid:t.gid,hash:t.tabs[e].hash}).then(n=>{var a=E(n,1)[0];return t.tabs[e]=extend(t.tabs[e],a),t})}));function Wt(e,t,n){var a=n.tabs[e];return a.memberIds=[].concat(a.memberIds,t).filter((e,t,n)=>n.indexOf(e)===t),a.membersCount=a.memberIds.length,Promise.resolve(n)}var Kt=te((function(e,t,n,r){return Object(a.post)(T,{act:"a_add_chat_members",peer:e,new_peer:t.join(","),gid:r.gid,hash:r.tabs[e].hash,show_history:n?1:0}).then(e=>r)}));function Yt(e,t){if(isEmpty(e))return Promise.resolve(t);var n=Object.keys(e).map(t=>`${t}:${e[t].join(",")}`).join(";");return Object(a.post)(T,{act:"a_load_member",need:n,gid:t.gid}).then(e=>(E(e,1)[0].forEach(e=>Object(_.oCacheAdd)(t,e)),t))}function $t(e,t,n){var a={},r=n.get();function s(e,t){Object(d.isChatPeer)(e)&&t&&!Object(_.oCacheExists)(r,t)&&(a[e]?-1===a[e].indexOf(t)&&a[e].push(t):a[e]=[t])}var o=t.filter(e=>!Object(d.isTabLoaded)(r,e.peerId)).map(e=>e.peerId);t.forEach(e=>{s(e.peerId,e.userId)}),e.forEach(e=>{s(e.peerId,+e.kludges.source_mid||+e.kludges.from)});var l=t.filter(e=>e.flags&i.FLAG_OUTBOUND&&!e.local).map(e=>e.kludges.from_admin).filter(e=>e&&!r.admins[e]);return 0===Object.keys(a).length&&0===l.length&&0===o.length?Promise.resolve(r):{shouldLoad:Object.keys(a).length>0||l.length>0||o.length>0,needMembers:a,needAdminIds:l,needPeers:o}}function zt(e,t,n){var a=e.needMembers,r=e.needAdminIds,i=e.needPeers;return t.pause(),Promise.all([Yt(a,n),we(r,n),Promise.all(i.map(e=>oe(e,0,0,0,n)))]).catch(()=>n).then(()=>t.resume()).then(()=>n)}var Xt=te((function(e,t){return e.kludges.source_act===d.CHAT_PHOTO_REMOVE?(delete t.tabs[e.peerId].photo,delete t.tabs[e.peerId].photoLarge,Promise.resolve(t)):(t.onUpdate&&t.onUpdate(),Object(a.post)(T,{act:"a_get_chat_photo",msg_id:e.messageId}).then(n=>{var a=E(n,2),r=a[0],i=a[1];t.chat_photo_msg=i;var s=t.tabs[e.peerId];if(t.tabs[e.peerId].photo=r[0],t.tabs[e.peerId].photoLarge=r[1],Object(d.isFullyLoadedTab)(t,e.peerId)){var o=e.kludges.source_act;s.history=Object(d.addChatPhotoToUpdate)(e,o,t,ae(s.history))}return t}))}));function Qt(e,t,n,a){return t!==vk.id||Object(d.isTabLoaded)(a,n)&&a.peer==n&&(a=fe(a)),Promise.resolve(a)}var Zt=te((function(e,t){return Object(a.post)(T,{act:"a_leave_chat",chat:e-2e9,gid:t.gid,hash:t.tabs[e].hash}).then(Qt.bind(null,d.CHAT_KICK_USER,vk.id,e,t))})),Jt=te((function(e,t){return Object(a.post)(T,{act:"a_return_to_chat",chat:e-2e9,gid:t.gid,hash:t.tabs[e].hash}).then(Qt.bind(null,d.CHAT_INVITE_USER,vk.id,e,t))})),en=te((function(e,t,n,r){return Object(a.post)(T,{act:"a_mute",peer:e,hash:r.tabs[e].hash,gid:r.gid,value:Number(t),until:n}).then(()=>{var n=t?"mute":"unmute";return window.Notifier&&Notifier.lcSend("im",{act:n,peer:e}),r}).then(nn.bind(null,e,t))})),tn=te((function(e,t,n){return Object(a.post)(T,{act:"a_mute_mentions",peer:e,hash:n.tabs[e].hash,gid:n.gid,value:Number(t)}).then(()=>n)}));function nn(e,t,n){var a=n.mutedPeers.filter(t=>t!==e);return t&&a.push(e),n.mutedPeers=a,cur.mutedPeers=n.mutedPeers,fe(n)}function an(e,t){return t.stack=e,Promise.resolve(t)}var rn=te((function(e,t,n,r){return sn(e,n,t,r),Object(a.post)(T,{act:"a_mark_important",ids:e,val:t?1:0,from:"im",gid:r.gid,peer:n,hash:r.tabs[n].hash}).then(()=>r)}));function sn(e,t,n,a){if(Object(d.isFullyLoadedTab)(a,t)){var r=a.tabs[t];e.filter(e=>r.msgs[e]).forEach(e=>{var s=Object(g.getMessage)(a,t,e),o=n?s.flags|i.FLAG_IMPORTANT:s.flags&~i.FLAG_IMPORTANT;s.flags=o,r.msgs[e]=s,r.history=Object(d.updateStar)(e,n,ae(r.history))})}return Promise.resolve(a)}function on(e,t,n){return n.importants||(n.importants={}),(n.importants[t]||0)!==e&&(n.important_cnt+=e,n.importants[t]=e),Promise.resolve(n)}function ln(e,t){return Object(a.post)(T,{act:"a_spam",offset:e,gid:t,part:e>0})}function cn(e,t){return Object(a.post)(T,{act:"a_flush_spam",gid:t,hash:e})}function dn(e,t,n){return n.creationType=e,n.creationFilter=t,Promise.resolve(n)}function un(e,t){return Object(a.post)(T,{act:"a_owner_photo",photo:JSON.parse(e).data[0],peer:t})}function gn(e){return Object(a.post)(T,{act:"a_get_contacts"}).then(t=>{var n=E(t,1)[0];return e.contactsList=n,e})}function mn(e,t){return t.next_chat_avatar=e,Promise.resolve(t)}function _n(e,t,n){return Object(a.post)("al_page.php",{act:"owner_photo_save",peer:e,_query:t,gid:n.gid}).then(e=>n)}var pn=te((function(e,t,n,r,i){return i.creating=!0,i.longpoll.pause(),Object(a.post)(T,{act:"a_multi_start",hash:i.writeHash,peers:t.join(","),title:n,flags:r}).then(e=>{var t=E(e,1)[0];return i.next_peer=t.peerId,i.tabs[t.peerId]=t,Ae(i,t,!1,e=>[t.peerId].concat(e)),i.longpoll.resume(),i}).then(t=>e?_n(t.next_peer,e,t):t).then(e=>(e.creating=!1,e)).catch(e=>{throw i.creating=!1,i.longpoll.resume(),e})})),hn=te((function(e,t,n){return n.creating=!0,Object(a.post)(T,{act:"a_multi_start",hash:n.writeHash,peers:[],title:t,gid:n.gid,is_community_chat:1}).then(t=>{var a=E(t,1)[0].peer_id;if(!a)throw new Error("No peer_id");return e?_n(a,e,n):n}).then(e=>(e.creating=!1,e)).catch(e=>{throw n.creating=!1,e})}));function fn(e){var t;e.resync_in_process=new Promise(e=>{t=e});var n=Object.keys(e.tabs).length,r=e.active_tab;return Object(a.post)(T,{act:"a_resync",sel:e.peer,gid:e.gid,loaded:n,tab:r,add_peers:e.tabbedPeers.map(e=>e.peer).join(",")}).then(n=>{var a=E(n,5),i=a[0],s=a[1],o=a[2],c=a[3],g=a[4];s.forEach(t=>Object(_.oCacheAdd)(e,t)),Object(d.normalizeTabsGotFromServer)(e,i),o.user_unread&&handlePageCount("msg",o.user_unread),Object(l.lplog)("Resync success","success");var m,p=e.peer;if(Object(d.isReservedPeer)(p))m=Promise.resolve(!1);else{var h={tabs:{[p]:e.tabs[p]},oCache:{}};m=Ge({[p]:i[p]},h)}return m.then(n=>{e.tabs=i,e.admins=extend(e.admins,c),n&&(e.tabs[p]=n.tabs[p],e.tabs[p].history=Object(d.restoreQueue)(p,e,ae(e.tabs[p].history))),e.loadingDialogs=!1,e.mutedPeers=o.mutedPeers,e.lastDialogsOptions={has_more:o.has_more},e.dialog_tab_cts=Object.assign({},o.folder_cts,{[u.FOLDER_MESSAGE_REQUEST]:e.dialog_tab_cts[u.FOLDER_MESSAGE_REQUEST]}),e.dialog_tabs[r]=g.map(intval);var a=e.dialog_tabs[r].map(t=>e.tabs[t]);return Object.keys(e.dialog_tabs).filter(e=>e!=r).forEach(t=>{r==u.FOLDER_ALL?e.dialog_tabs[t]=a.filter(Tn(t)).map(e=>e.peerId):e.dialog_tabs[t]=[]}),delete e.resync_in_process,setTimeout(t.bind(null,!0),0),yn(intval(o.unread),e)})}).catch(t=>(Object(l.lplog)("Resync error: "+t.message+" "+t.stack,"error"),Object(s.pause)(2).then(fn.bind(null,e))))}function bn(e,t){return t.lockedSending=e,Promise.resolve(t)}function vn(e,t,n){return e&&!n.delayed_message?(n.delayed_message=e,n.delayed_ts=t):e||(n.delayed_message=e,n.delayed_ts=t),Promise.resolve(n)}function On(e){return!!e.textMediaSelector.urlAttachmentLoading||!!(window.Upload&&Upload.options&&Upload.isSomethingUploading)&&Object.keys(Upload.options).filter(e=>Upload.isSomethingUploading(e)).length>0}function yn(e,t){return t.unread_cnt=e,t.dialog_tab_cts[u.FOLDER_UNREAD]=e,Promise.resolve(t)}function Cn(e,t){return t.ctrl_submit=!!e,Object(a.post)(T,{act:"a_save_ctrl_submit",to:t.peer,hash:t.tabs[t.peer].hash,value:e?1:0}).then(e=>t)}function En(e,t,n){n.cur_unread_cnt||(n.cur_unread_cnt={}),t&&!inArray(e,n.mutedPeers)&&(n.cur_unread_cnt[e]=!0);var a=document.title,r=window.devicePixelRatio>=2?"_2x":"";if(t&&!n.update_title_to){var i=function(e,t,n){return function(){n.update_old_title=e;var a=Object.keys(n.cur_unread_cnt).length;if(0===a)return Object(v.setDocumentTitle)(e||document.title),setFavIcon("/images/icons/favicons/fav_im"+t+".ico"),clearInterval(n.update_title_to),void(n.update_title_to=!1);e?(Object(v.setDocumentTitle)(e),setFavIcon("/images/icons/favicons/fav_im"+t+".ico"),e=!1):(e=document.title,setFavIcon("/images/icons/favicons/fav_im"+(a>9?10:a)+t+".ico"),Object(v.setDocumentTitle)(winToUtf(getLang("mail_im_new_messages",a))))}}(a,r,n);n.update_title_to=setInterval(i,1e3),i()}else!t&&n.update_old_title&&(Object(v.setDocumentTitle)(n.update_old_title),n.cur_unread_cnt={},a=!1,n.update_old_title=!1,setFavIcon("/images/icons/favicons/fav_im"+r+".ico"),clearInterval(n.update_title_to),n.update_title_to=!1);return Promise.resolve(n)}function jn(e,t,n,a,r){return Object(d.isFullyLoadedTab)(r,e)&&(r.tabs[e].scrollTop=intval(t),r.tabs[e].scrollBottom=intval(n),r.tabs[e].contHeight=intval(a)),Promise.resolve(r)}function Tn(e){return e===u.FOLDER_ALL?e=>!Object(d.tabIsMessageRequest)(e):e===u.FOLDER_UNREAD?e=>!Object(d.tabIsMessageRequest)(e)&&(e.unread>0||Object(g.isTabMarkedUnread)(e)):e===u.FOLDER_MESSAGE_REQUEST?e=>Object(d.tabIsMessageRequest)(e):t=>t.folders&u.FOLDER_MASKS[e]}function Sn(e,t){t.active_tab=e,Object(r.updateLocation)({tab:e===u.FOLDER_ALL?null:e});var n=[];if(e!==u.FOLDER_ALL&&!Object(d.isReversedDialogs)(t)){var a=t.dialog_tabs[e];n=t.dialog_tabs[u.FOLDER_ALL].map(e=>t.tabs[e]).filter(Tn(e)).map(e=>e.peerId),t.dialog_tabs[e]=a.length>=n.length?a:n}return Promise.resolve(t)}function In(e,t,n,a){var r=e.dialog_tabs_all;return!(!r[u.FOLDER_ALL]&&!r[t])||(!!n.includes(a.peerId)||("r"===a.lastmsg[0]||n.map(t=>e.tabs[t.toString()]).filter(t=>Object(d.isReversedDialogs)(e)?t.minor_sort_id>a.minor_sort_id:t.minor_sort_id<a.minor_sort_id).length>0))}function An(e,t,n,a,r,s){if(Object(d.isTabLoaded)(s,e)&&!r){var o=s.tabs[e];return n===i.REPLACE_DIRECTORIES&&(t^=o.folders),function(e,t,n){return!(e===i.SET_DIRECTORIES&&n.folders&t)&&(!!(e!==i.RESET_DIRECTORIES||n.folders&t)&&!Object(d.tabIsMessageRequest)(n))}(n,t,o)&&Object.keys(u.FOLDER_MASKS).filter(e=>u.FOLDER_MASKS[e]&t).forEach(e=>{s.dialog_tab_cts[e]+=function(e,t,n){return t!==i.RESET_DIRECTORIES||e.folders&u.FOLDER_MASKS[n]?t===i.REPLACE_DIRECTORIES?e.folders&u.FOLDER_MASKS[n]?-1:1:t===i.SET_DIRECTORIES?1:-1:0}(o,n,e)}),n===i.SET_DIRECTORIES?s.tabs[e].folders|=t:n===i.RESET_DIRECTORIES?s.tabs[e].folders&=~t:s.tabs[e].folders=t^=o.folders,Ae(s,s.tabs[e],!0,(t,n)=>t.concat([e]).map(e=>s.tabs[e]).filter(Tn(n)).map(e=>e.peerId),In.bind(null,s)),Promise.resolve(s)}return oe(e,0,0,0,s).then(An.bind(null,e,t,n,null,!1,s))}var wn=te((function(e,t){var n=u.FOLDER_MASKS[u.FOLDER_IMPORTANT],r=t.tabs[e].folders&n,s=r?i.resetDirectoriesEvent:i.setDirectoriesEvent;return t.longpoll.push([s([0,e,n,!0])]),Object(a.post)(T,{act:"a_dialog_star",val:r?0:1,peer:e,hash:t.tabs[e].hash,gid:t.gid}).then(()=>t)})),Ln=te((function(e,t,n){var r=u.FOLDER_MASKS[u.FOLDER_UNRESPOND];return n.longpoll.push([i.resetDirectoriesEvent([0,e,r,!0]),i.readInboundEvent([6,e,t,null])]),Object(a.post)(T,{act:"a_mark_answered",peer:e,lastmsg:t,hash:n.tabs[e].hash,gid:n.gid}).then(()=>n)})),kn=te((e,t)=>(t.longpoll.push([i.resetPeer(),i.setDirectoriesEvent([0,e,u.FOLDER_MASKS[u.FOLDER_MARKED_UNREAD],!0])]),Object(a.post)(T,{act:"a_mark_conversation_as_unread",peer_id:e,hash:t.tabs[e].hash,gid:t.gid}))),Mn=te((e,t)=>{t.longpoll.push([i.resetDirectoriesEvent([0,e,u.FOLDER_MASKS[u.FOLDER_MARKED_UNREAD],!0])]);var n=t.tabs[e];return Object(a.post)(T,{peer:e,ids:n.lastmsg?[n.lastmsg]:[],mark_conversation_as_read:!0,hash:n.hash,act:"a_mark_read",gid:t.gid}).then(()=>t)});function Nn(e){return Object(a.post)(T,{act:"a_get_mutex_key",gid:e})}function Pn(e,t){return ie({[e]:{free:!0}},t),Object(a.post)(T,{act:"a_block_release",peer:e,gid:t.gid}).then(()=>t)}function Dn(e,t){var n=ls.get("comm_mute_"+t.gid)?1:0;return e&&(n^=1),ls.set("comm_mute_"+t.gid,n),t.mute=n,Promise.resolve(t)}var Rn=te((function(e,t){return Ae(t,t.tabs[e],!0,t=>t.filter(t=>t!==e)),t.tabs[e].deletedDialog=!0,Object(a.post)(T,{act:"a_delete_dialog",peer:e,gid:t.gid,hash:t.tabs[e].hash}).then(n=>(n[0]?(Hn(t.tabbedPeers.filter(t=>t.peer!==e),!0,t),t.tabs[e].unread=0,t.tabs[e].lastmsg=!1,t.tabs[e].lastmsg_meta=null):(t.tabs[e].deletedDialog=!1,Ae(t,t.tabs[e],!1,ke.bind(null,e),In.bind(null,t))),n))}));function xn(e,t,n,r){return Object(a.post)(T,{act:"a_restore_dialog",hash:t,gid:r.gid,spam:n?1:0,peer:e}).then(t=>(r.tabs[e].deletedDialog=!1,Ae(r,r.tabs[e],!1,t=>[e].concat(t)),r.tabs[e].unread=t,r))}function Bn(e,t,n){return Object(a.post)(T,{act:"a_spam_dialog",peer:e,gid:n.gid,hash:t})}function Hn(e,t,n){return n.tabbedPeers=e,Object(d.isClassicInterface)(n)&&(L({peers:n.tabbedPeers.filter(e=>{var t=e.peer,a=e.type;return t!==n.peer&&"perm"===a}).map(e=>Object(d.getBareTab)(e.peer,n)).filter(e=>!e.deletedDialog).map(e=>e.peerId).map(d.convertPeerToUrl).join("_"),to:""}),t&&k()),Promise.resolve(n)}function Fn(e){return!e.peer||(vt(e.peer,e)?bt(e.peer,e):!!Object(d.isFullyLoadedTab)(e,e.peer)&&e.tabs[e.peer].allShown)}function Un(e,t){var n=t.tabs[e];return Object(d.isFullyLoadedTab)(t,e)&&(n.skipped=null,n.msgs=null,n.offset=null,n.allShown=null,n.history=null),Promise.resolve(t)}function Gn(e,t){var n=t.tabs[e];return Object(d.isFullyLoadedTab)(t,e)&&(n.history=re(n.history)),Promise.resolve(t)}function qn(e,t){return t.go_to_end_visible=e,Promise.resolve(t)}function Vn(e,t){return t.go_to_mentions_visible=e,Promise.resolve(t)}function Wn(e,t,n){if(!Object(d.isCommunityPeer)(t))return Promise.resolve(n);var r=Object(g.getTab)(n,t);return r.blocked_community=!e,!1===e&&(r.can_send_notify=!1),Object(a.post)(T,{act:"a_toggle_community",peer_id:t,hash:r.hash,state:e?1:0}).then(()=>fe(n))}function Kn(e,t){if(0!==t.peer&&Object(d.isFullyLoadedTab)(t,t.peer)){var n=Object(g.getTab)(t,t.peer);n.history=ae(n.history),e(n.history)}return Promise.resolve(t)}function Yn(e){if(0!==e.peer&&Object(d.isFullyLoadedTab)(e,e.peer)){var t=Object(g.getTab)(e,e.peer),n=geByClass1("_im_peer_history");n&&(t.history=ae(n.innerHTML))}return Promise.resolve(e)}function $n(e){return e.audio_msg.isRecording?Promise.reject():(e.audio_msg.isRecording=!0,Promise.resolve(e))}function zn(e){return e.audio_msg.isRecording=!1,Promise.resolve(e)}function Xn(e,t){return t.voice_message_available=e,Promise.resolve(t)}function Qn(e){L({act:e?"create":null}),k()}function Zn(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;L({q:e}),k()}function Jn(e){return void 0===e.chatResizeInitialized&&(e.chatResizeInitialized=!0,Object(d.getClassicChatHeight)()>window.clientHeight()&&Object(d.setClassicChatHeight)(0)),Promise.resolve(e)}var ea=te((function(e,t,n,r){return Object(a.post)(T,{act:"a_join_chat",chat_id:e,hash:t,invite_link:n,write_hash:r.writeHash}).then(e=>{var t=E(e,4),n=t[0],a=t[1],i=t[2],s=t[3];return i.forEach(e=>Object(_.oCacheAdd)(r,e)),r.tabs[n]=a,Ae(r,a,!1,ke.bind(null,n),In.bind(null,r)),r.admins=extend(r.admins,s),[n]})}));function ta(e,t){return Object(a.post)(T,{act:"a_get_link",gid:t.gid,chat_id:e})}var na=te((function(e,t){var n=t.tabs[e];return Object(a.post)(T,{act:"a_reset_link",chat_id:e-2e9,write_hash:t.writeHash,gid:t.gid}).then(e=>(n.inviteLink=e[0],e))}));function aa(e){return M({invite_chat_id:null,invite_hash:null,mr:null,invite_link:null}),e.invitation=void 0,Promise.resolve(e)}function ra(e,t){var n=Object(l.arrayUnique)([e].concat(t.select(c.RECENT_SEARCH_OP))).slice(0,500);t.update(c.RECENT_SEARCH_OP,n)}function ia(e){e.update(c.RECENT_SEARCH_OP,[])}function sa(e,t){var n=t.select(c.RECENT_SEARCH_OP).filter(t=>t!==e);return t.update(c.RECENT_SEARCH_OP,n),n}function oa(e,t,n){var a=n.tabs[t],r=Object(g.getMessage)(n,t,e);return Object(g.isChatActive)(a)&&!r.kludges.source_act&&(a.pinned=r),Promise.resolve(n)}function la(e,t){return t.tabs[e].pinned=null,Promise.resolve(t)}var ca=te((function(e,t,n){var r=n.tabs[t];return Object(g.isChatActive)(r)?Object(a.post)(T,{act:"a_pin_message",msgid:e,chat:t,gid:n.gid,hash:n.tabs[t].hash}).then(e=>{var a=E(e,1)[0];return n.tabs[t]=Object.assign({},r,a),n}):Promise.resolve(n)})),da=te((function(e,t){var n=t.tabs[e];return Object(g.isChatActive)(n)?Object(a.post)(T,{act:"a_unpin_message",chat:e,gid:t.gid,hash:t.tabs[e].hash}).then(a=>{var r=E(a,1)[0];return t.tabs[e]=Object.assign({},n,r),t}):Promise.resolve(t)})),ua=te((function(e,t){var n=t.tabs[e];return Object(a.post)(T,{act:"a_get_pinned_message",chat:e,gid:t.gid,hash:t.tabs[e].hash}).then(e=>{var a=E(e,1)[0];return n.pinned=a||null,t})})),ga=te((function(e,t,n){var r=n.tabs[e];return Object(a.post)(T,{act:"a_get_message_local_id",chat:e,chat_local_id:t,hash:r.hash})})),ma=te((function(e,t){var n=t.tabs[e];return n.membersLoaded?Promise.resolve(t):Object(a.post)(T,{act:"a_get_chat_members",chat:e,gid:t.gid,hash:n.hash}).then(e=>{var a=E(e,1),r=E(a[0],3),i=r[0],s=r[1],o=r[2];return n.memberIds=i,n.adminIds=s,o.forEach(e=>Object(_.oCacheAdd)(t,e)),n.membersLoaded=!0,t})})),_a=te((function(e,t){return Promise.all([ma(e,t),function(e,t){var n=t.tabs[e];return Object(a.post)(T,{act:"a_get_chat_details",chat:e,gid:t.gid,hash:n.hash}).then(e=>{var a=E(e,1)[0];return n.photoGrid=a.grid,n.photoLarge=a.photo,n.membersLastSeen=a.lastSeen||null,n.inviters=a.inviters,n.caccess=a.caccess,n.invitedByMe=a.invitedByMe||[],n.inviteLinks=a.links||null,n.invitedByMessageRequest=a.invitedByMessageRequest,n.serverSettings=a.serverSettings||null,n.isDefaultPhotoOwner=a.isDefaultPhotoOwner||null,n.owner=a.owner||null,n.allowedUpdateFlags=a.allowedUpdateFlags,n.canInvite=a.canInvite||null,n.notifications=a.notifications,t})}(e,t)]).then(()=>t)})),pa=te((function(e,t,n){var r=n.tabs[e];return Object(a.post)(T,{act:"a_update_flags",chat:e,gid:n.gid,hash:r.hash,flags:t}).then(e=>(n.onUpdate&&n.onUpdate(),e))})),ha=te((function(e,t){var n=t.tabs[e];return Object(a.post)("al_page.php",{act:"owner_photo_remove",oid:e,gid:t.gid,hash:n.photoHash}).then(()=>(n.photo=null,n.photoLarge=null,t.onUpdate&&t.onUpdate(),t))}));function fa(e,t,n){var a=n.tabs[e];return a.memberIds=a.memberIds.filter(e=>e!==t),a.adminIds=a.adminIds.filter(e=>e!==t),a.membersCount=a.memberIds.length,Promise.resolve(n)}var ba=te((function(e,t,n){var r=n.tabs[e];return Object(a.post)(T,{act:"a_kick_user",chat:e,hash:r.hash,mid:t,gid:n.gid}).then(()=>(r.memberIds=r.memberIds.filter(e=>e!==t),r.adminIds=r.adminIds.filter(e=>e!==t),r.membersCount=r.memberIds.length,n))}));function va(e,t,n,a){var r=a.tabs[e];return r.adminIds=n?[].concat(r.adminIds,t).filter((e,t,n)=>n.indexOf(e)===t):r.adminIds.filter(e=>e!==t),Promise.resolve(a)}var Oa=te((function(e,t,n,r){var i=r.tabs[e];return Object(a.post)(T,{act:"a_toggle_admin",chat:e,hash:i.hash,mid:t,is_admin:+n,gid:r.gid}).then(()=>va(e,t,n,r))}));function ya(e,t,n,a){var r=Object(g.getMessage)(e,n,t).userId;return Object(_.oCacheGet)(a,r)?Promise.resolve(a):Yt({[n]:[r]},a)}function Ca(){ajax.post("al_im.php",{act:"a_hide_promo_tooltip"})}function Ea(){cur.videoAutoplayScrollHandler&&cur.videoAutoplayScrollHandler()}var ja=te((function(e,t){return t.tabs[e].top_banner=void 0,Object(a.post)(T,{act:"a_hide_banner",peer_id:e,gid:t.gid,hash:t.tabs[e].hash}).then(()=>t)})),Ta=te((function(e,t,n){n.tabs[e].top_banner=void 0;var r=n.tabs[e];return Object(a.post)(T,{act:"a_callback_banner",peer_id:e,callback_data:t,hash:r.hash}).then(()=>n)}));function Sa(e,t){return Object(a.post)(T,{act:"a_load_banner",peer_id:e,gid:t.gid}).then(n=>{var a=E(n,1)[0];return t.tabs[e].top_banner=a,t})}function Ia(e,t,n){return n.tabs[e].keyboard=t&&t.buttons?t:null,wa(e,!1,!0,n)}function Aa(e,t){return Ia(e,null,t)}function wa(e,t,n,a){return((a.tabs||{})[e]||{}).keyboard&&(a.tabs[e].keyboard.hide=t,n&&ls.set("is_keyboards_hide",Object.assign(ls.get("is_keyboards_hide")||{},{[e]:t}))),Promise.resolve(a)}var La=te((function(e,t){var n=t.tabs[e];return Object(a.post)(T,{act:"a_get_keyboard",peer_id:e,hash:n.hash}).then(n=>{var a=E(n,1)[0];return Ia(e,a,t)})}));function ka(e,t,n,r){var i=r.tabs[e];return i.caccess[t]=n,Object(a.post)(T,{act:"a_change_caccess",peer_id:e,member_id:t,hash:i.hash,access:n?1:0,gid:r.gid}).then(()=>r).catch(e=>{throw i.caccess[t]=!n,e})}var Ma=te((function(e,t){var n=t.tabs[t.peer];return Object(a.post)(T,{act:"a_delete_template",template_id:e,hash:n.hash,gid:t.gid,peer_id:t.peer}).then(()=>{var n=t.templates.find(t=>t.id===e);return n&&(n.deleted=!0),t})}));function Na(e,t,n){var r=n.tabs[n.peer];return Object(a.post)(T,{act:"a_create_template",hash:r.hash,gid:n.gid,peer_id:n.peer,name:e,text:t}).then(e=>(n.templates.unshift(e[0]),n))}function Pa(e,t,n,r){var i=r.tabs[r.peer];return Object(a.post)(T,{act:"a_update_template",template_id:e,hash:i.hash,gid:r.gid,peer_id:r.peer,group_id:r.gid,name:t,text:n}).then(t=>{var n=r.templates.find(t=>t.id===e);return n&&Object.assign(n,t[0]),r})}function Da(e,t){if(Object(d.isFullyLoadedTab)(t,e)){var n=Object(g.getTab)(t,e);n.allShown=!1,n.lastReset=Date.now()}return t}function Ra(e,t){var n=e.updateType,a=e.updateArg,r=0;return n===i.MAIL_CHAT_UPDATE_TYPE_MESSAGE_REQUEST_CHANGED&&(r=a===i.MESSAGE_REQUEST_STATUS_NEW?1:-1),n===i.MAIL_CHAT_UPDATE_TYPE_CONTACT_CONVERTED&&(r=-1),t.dialog_tab_cts[u.FOLDER_MESSAGE_REQUEST]+=r,Promise.resolve(t)}function xa(e,t,n){if(Object(d.isFullyLoadedTab)(n,e.peerId)){var a=Object(g.getTab)(n,e.peerId);a.history=Object(d.setCasperMessageExpiringStatusDOM)(a.history,t,e.messageId)}return Promise.resolve(n)}function Ba(e,t){return Promise.resolve().then(()=>{if(Object(d.isFullyLoadedTab)(t,e)){var n=Object(g.getTab)(t,e);Object.values(n.msgs).forEach(e=>{var t=Object(g.parserMessage)(e);Object(m.isCasperMessage)(t)&&!y.casperMessagesStore.has(t.messageId)&&y.casperMessagesStore.add(t)})}return Promise.resolve(t)})}var Ha=te((function(e,t,n,r,i,s){return Object(a.post)(T,{act:"a_peer_profile_toggle_tag",hash:s.manage_tags_hash,group_id:s.gid,peer_id:r,tag_id:e,action:n}).then(()=>{s.tabs[r].peer_tags=i;var n=s.peer_profile_tags.findIndex(t=>t.id===e);return t?s.peer_profile_tags[n].uses++:!t&&s.peer_profile_tags[n].uses>0&&s.peer_profile_tags[n].uses--,s})})),Fa=te((function(e,t){return Object(a.post)(T,{act:"a_peer_profile_manage_tags",hash:t.manage_tags_hash,group_id:t.gid,tags:JSON.stringify(e)}).then(e=>(t.peer_profile_tags=e[0].tags,t.peerProfileTagsChanged=!0,t))})),Ua=te((function(e,t,n){return Object(a.post)(T,{act:"a_peer_profile_save_note",hash:n.manage_tags_hash,group_id:n.gid,peer_id:e,note:t}).then(()=>(n.tabs[e].peer_profile_info.note=t,n))})),Ga=te((e,t)=>Object(a.post)(T,{act:"a_reload_message",msg_id:e,hash:t.writeHash}).then(e=>E(e,1)[0])),qa=te((e,t)=>{var n=t.tabs[e];return Object(a.post)(T,{act:"a_get_active_call_data",peer_id:n.peerId,hash:n.hash}).then(e=>{var a=E(e,1)[0];return a?n.callInProgress=a:n.callInProgress&&delete n.callInProgress,t})}),Va=(e,t)=>{var n=t.tabs[e];return n.callInProgress&&delete n.callInProgress,Promise.resolve(t)}},"wSs/":function(e,t,n){"use strict";n.r(t),n.d(t,"canMessageBeEdited",(function(){return l})),n.d(t,"convertEmojiHtmlToRegularText",(function(){return c})),n.d(t,"findLastMessageToEdit",(function(){return d})),n.d(t,"wasMessageReallyModified",(function(){return u})),n.d(t,"replaceMsgAfterEdit",(function(){return g}));n("Vd3H"),n("rGqo"),n("Btvt"),n("pIFo");var a=n("rHUl"),r=n("MhhX"),i=n("P13b"),s=n("rudk"),o=n("aong");function l(e,t){t=Object(a.parserMessage)(t);var n=Object(o.unpackStore)(e),s=vk.id==t.peerId&&!n.gid,l=n.pinMessageEditSettings,c=l.messageEditAllowedTime,d=l.pinEditDelayTime,u=l.isPinEditEnabled,g=Date.now()/1e3,m=Object(a.getPinnedMessage)(n),_=m&&m.messageId===t.messageId,p=t.kludges&&t.kludges.pinned_at,h=g-t.date>c,f=p&&g-p<d;if(333==t.peerId)return!1;if(!s&&!Object(r.isOut)(t))return!1;if(Object(r.isServiceMsg)(t))return!1;if(_&&h&&u){if(f)return!1}else if(h)return!1;return!(Object(r.isGift)(t)||Object(r.isSticker)(t)||Object(r.isAudioMsg)(t)||Object(r.isGraffiti)(t)||Object(r.isMoney)(t)||Object(r.isVKPay)(t)||Object(r.isCallMessage)(t))&&!Object(i.isAlreadyDeleted)(e,t.peerId,t.messageId)}function c(e){var t=document.createElement("div");return e=e.replace(/\[((id|club)\d+)\|(.+?)]/g,(function(){var e=arguments.length<=1?void 0:arguments[1],t=arguments.length<=3?void 0:arguments[3];return/^\@/.test(t)?t:`@${e} (${t})`})),t.innerHTML=e,Emoji.val(t)}function d(e,t){return+(t&&t.msgs?Object.keys(t.msgs):[]).filter(e=>e>0).sort((e,t)=>t-e).find(n=>l(e,t.msgs[n]))||null}function u(e,t,n){var a=Object(s.convertKludgesToAttaches)(t.kludges,t.messageId),r=n.dData.attaches;if(c(t.text)!==n.dData.txt||a.length!==r.length)return!0;for(var i=a.length;i--;){var o=a[i],l=r[i];if(o.id!=l.id||o.type!=l.type||"poll"==o.type&&l.object&&l.object.poll_is_edited)return!0}return!1}function g(e,t,n,a,r,s){t.origText=n,t.text=Object(i.replaceSpecialSymbols)(clean(n)).replace(/\n/gi,"<br>"),t.attaches=a,t.kludges.emoji=1,t.local=1,t.share_url=r,t.cancelled_shares=s,t.update_time=Math.floor(Date.now()/1e3),e.get().tabs[t.peerId].msgs[t.messageId]=t}},xGYt:function(e,t,n){"use strict";n.r(t);var a=n("q1tI"),r=n.n(a),i=n("ZxpX"),s=function(){return(s=Object.assign||function(e){for(var t,n=1,a=arguments.length;n<a;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)},o=function(e,t){var n={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(n[a]=e[a]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(a=Object.getOwnPropertySymbols(e);r<a.length;r++)t.indexOf(a[r])<0&&Object.prototype.propertyIsEnumerable.call(e,a[r])&&(n[a[r]]=e[a[r]])}return n};t.default=function(e){var t=e.icon,n=void 0===t?null:t,a=e.aside,l=void 0===a?null:a,c=e.chevron,d=void 0!==c&&c,u=e.selectable,g=void 0===u||u,m=e.border,_=void 0===m||m,p=e.className,h=e.children,f=e.active,b=e.canBeHovered,v=void 0===b||b,O=o(e,["icon","aside","chevron","selectable","border","className","children","active","canBeHovered"]),y={"ListItem--chevron":d,"ListItem--selectable":g,"ListItem--border":_,"ListItem--active":f,"ListItem--can-be-hovered":v};return r.a.createElement("li",s({},O,{className:Object(i.classNames)("ListItem",y,p)}),n&&r.a.createElement("div",{className:"ListItem__icon"},n),r.a.createElement("div",{className:"ListItem__main"},h),r.a.createElement("div",{className:"ListItem__aside"},l))}}});