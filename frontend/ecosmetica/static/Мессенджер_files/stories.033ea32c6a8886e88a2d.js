!function(e){function t(t){for(var i,n,a=t[0],c=t[1],l=t[2],u=0,p=[];u<a.length;u++)n=a[u],Object.prototype.hasOwnProperty.call(r,n)&&r[n]&&p.push(r[n][0]),r[n]=0;for(i in c)Object.prototype.hasOwnProperty.call(c,i)&&(e[i]=c[i]);for(d&&d(t);p.length;)p.shift()();return s.push.apply(s,l||[]),o()}function o(){for(var e,t=0;t<s.length;t++){for(var o=s[t],i=!0,a=1;a<o.length;a++){var c=o[a];0!==r[c]&&(i=!1)}i&&(s.splice(t--,1),e=n(n.s=o[0]))}return e}var i={},r={"web/stories":0},s=[];function n(t){if(i[t])return i[t].exports;var o=i[t]={i:t,l:!1,exports:{}};return e[t].call(o.exports,o,o.exports,n),o.l=!0,o.exports}n.m=e,n.c=i,n.d=function(e,t,o){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:o})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(n.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)n.d(o,i,function(t){return e[t]}.bind(null,i));return o},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="/js/cmodules/";var a=window.webpackJsonp=window.webpackJsonp||[],c=a.push.bind(a);a.push=t,a=a.slice();for(var l=0;l<a.length;l++)t(a[l]);var d=c;s.push([278,"audioplayer","lottie","vendors","common"]),o()}({"+/AQ":function(e,t,o){"use strict";o.r(t),o.d(t,"getNativeOption",(function(){return r})),o.d(t,"setNativeOption",(function(){return s})),o.d(t,"createScroll",(function(){return l}));var i=o("ofcU");function r(e,t){return bodyNode[e]||document.documentElement[e]}function s(e,t,o){"scrollTop"===e&&window.scrollTo(0,t)}class n{constructor(e,t){this.el=e,this.opts=t,this.module=Object(i.createModule)({handlers:(e,t)=>{e(window,"scroll",this.onScroll.bind(this)),e(window,"resize",this.resize.bind(this))}}),this.innerHeight=window.innerHeight,this.prevScroll=this.scrollTop()}update(){}resize(){this.innerHeight=window.innerHeight}scrollTop(e){if(void 0===e)return r("scrollTop",this.el);s("scrollTop",e,this.el)}contHeight(){return r("scrollHeight")}smoothScroll(e){scrollToY(e+this.scrollTop(),300)}getContainer(){return this.el}getScroller(){return null}scrollBottom(e){if(void 0===e)return this.contHeight()-this.scrollTop()-this.getScrollHeight();var t=this.contHeight()-e-this.getScrollHeight();this.scrollTop(t)}scrollBottomFixSave(e){var t=()=>{Date.now()-o<500&&this.scrollBottom(e),window.removeEventListener("scroll",t)},o=Date.now();window.addEventListener("scroll",t),this.scrollBottom(e)}onScroll(e){var t=this.scrollTop(),o=t-this.prevScroll,i=this.contHeight();this.opts.onScroll&&this.opts.onScroll(-o,this),this.opts.scrollChange&&this.opts.scrollChange(t),this.opts.more&&i-t<2*this.innerHeight&&this.opts.more(this),this.prevScroll=t}getScrollHeight(){return this.innerHeight}destroy(){Object(i.destroyModule)(this.module)}}class a{constructor(e,t){this.prevTop=0,this.scroll=new uiScroll(e,{hidden:void 0===t.hidden||t.hidden,shadows:t.shadows,stopScrollPropagation:!1,theme:t.scrollTheme,onmore:()=>t.more&&t.more(this),onscroll:e=>{var o=this.scrollTop(),i=this.prevTop-o;this.prevTop=o,t.scrollChange&&t.scrollChange(o),t.onScroll&&t.onScroll(i,this)}})}update(){this.scroll.update("sync")}scrollTop(e){return void 0!==e?this.scroll.scrollTop(e):this.scroll.data.scrollTop}getContainer(){return this.scroll.content}getScroller(){return this.scroll.scroller}contHeight(){return this.scroll.data.scrollHeight}smoothScroll(e){this.scroll.scrollTop(this.scrollTop()+e,300)}scrollBottom(e){return void 0!==e?this.scroll.scrollBottom(e):this.scroll.data.scrollBottom}scrollBottomFixSave(e){var t=Date.now();this.scroll.emitter.addOnceListener("resize",()=>{Date.now()-t<500&&this.scroll&&this.scrollBottom(e)}),this.scrollBottom(e)}getScrollHeight(){return this.scroll.data.viewportHeight}destroy(){this.scroll.destroy()}}class c{constructor(e,t){this.el=e}update(){}getContainer(){return this.el}getScroller(){return null}scrollTop(e){return 0}contHeight(){return 0}smoothScroll(e){}scrollBottom(e){return 0}scrollBottomFixSave(e){}getScrollHeight(){return 0}destroy(){}}function l(e,t){return t.noScroll?new c(e):t.nativeScroll?new n(e,t):new a(e,t)}},"0PSK":function(e,t,o){"use strict";o.r(t);var i=o("q1tI"),r=o.n(i);t.default=r.a.createContext(null)},"0toi":function(e,t,o){"use strict";o.r(t);o("91GP");var i=o("q1tI"),r=o.n(i),s=(o("17x9"),o("r7nW")),n=o("Xq7/"),a=o("6aSF"),c=function(e){var t=e.children,o=e.hasScroll;return void 0===o||o?r.a.createElement(a.default,{className:"ModalBody"},t):r.a.createElement("div",{className:"ModalBody"},t)},l=o("7ZXl"),d=o("ZxpX");function u(){return(u=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var o=arguments[t];for(var i in o)Object.prototype.hasOwnProperty.call(o,i)&&(e[i]=o[i])}return e}).apply(this,arguments)}var p=e=>{var t=e.className,o=e.appearance,r=void 0===o?"white":o,a=e.title,p=e.actionButtons,h=e.onClose,_=e.children,m=e.footerHint,v=e.hasScroll,f=Object(d.classNames)("Modal","Modal--"+r,t);return i.createElement(s.default,u({},e,{className:f}),i.createElement(n.ModalHeader,{title:a,onClose:h,appearance:r}),Boolean(_)&&i.createElement(c,{hasScroll:v},_),i.createElement(l.ModalFooter,{actionButtons:p,hint:m}))};p.Header=n.ModalHeader,p.Body=c,p.Footer=l.ModalFooter;t.default=p},"16Al":function(e,t,o){"use strict";var i=o("WbBG");function r(){}function s(){}s.resetWarningCache=r,e.exports=function(){function e(e,t,o,r,s,n){if(n!==i){var a=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw a.name="Invariant Violation",a}}function t(){return e}e.isRequired=e;var o={array:e,bool:e,func:e,number:e,object:e,string:e,symbol:e,any:e,arrayOf:t,element:e,elementType:e,instanceOf:t,node:e,objectOf:t,oneOf:t,oneOfType:t,shape:t,exact:t,checkPropTypes:s,resetWarningCache:r};return o.PropTypes=o,o}},"17x9":function(e,t,o){e.exports=o("16Al")()},278:function(e,t,o){e.exports=o("uXyw")},"4Ch9":function(e,t,o){"use strict";o.r(t),o.d(t,"ID_ASHVETS",(function(){return u})),o.d(t,"ID_NSHKARUBA",(function(){return p})),o.d(t,"ID_PKALAYDIN",(function(){return _})),o.d(t,"CONSOLE_CUSTOM_NUM_FIELD",(function(){return m})),o.d(t,"init",(function(){return v})),o.d(t,"getParams",(function(){return S})),o.d(t,"setOption",(function(){return C})),o.d(t,"setUid",(function(){return T})),o.d(t,"setIp",(function(){return L})),o.d(t,"setUaHash",(function(){return B})),o.d(t,"setSpamtype",(function(){return x})),o.d(t,"setConditions",(function(){return N})),o.d(t,"setThreshold",(function(){return I})),o.d(t,"composeSearchLinkFromParams",(function(){return M})),o.d(t,"getNumericField",(function(){return P})),o.d(t,"getConditionsHint",(function(){return H})),o.d(t,"switchParams",(function(){return V})),o.d(t,"conditionsClear",(function(){return K})),o.d(t,"optionClear",(function(){return U})),o.d(t,"addPatternPart",(function(){return z})),o.d(t,"mount",(function(){return Y}));o("pIFo"),o("Vd3H"),o("rGqo"),o("Btvt"),o("HEwt"),o("SRfc");var i,r,s,n=o("ofcU"),a=o("b8yN"),c=o("awNS"),l=o("t7n3"),d=o("W28y"),u=1576215,p=138305184,h=163176673,_=143978,m="custom";function v(e){var t=e.conditions;t&&(ls.set(W(""),t),addClass(geByClass("conditions_clear_button")[0],"highlighted"));var o=e.conditions2;o&&(ls.set(W("2"),o),addClass(geByClass("conditions_clear_button")[1],"highlighted"))}function f(){return hasClass(c.consoleWrap,"console_locked")}function g(){f()||addClass(c.consoleWrap,"console_locked"),removeClass(c.consoleWrap,"console_show_message")}function y(){var e=geByClass1("_apply_pattern",c.patternWrap),t=geByClass1("_search_reports",c.patternWrap);f()&&removeClass(c.consoleWrap,"console_locked"),unlockButton(e),unlockButton(t)}function b(e,t){var o=geByClass1("_console_error",c.consoleWrap),i=geByClass("console_item");o.innerHTML="",e||(e="");var r=ce("div");e&&(r.innerHTML=e),r.className=t?"error":"info_msg",e.match(/\/pattern[0-9]+/)&&i&&i.forEach((function(e){e.className="console_item red_item"})),addClass(c.consoleWrap,"console_show_message"),o.appendChild(r),y()}function w(e){i&&clearTimeout(i),i=setTimeout(()=>{domData(c.consoleWrap,"failed",0)},3e3),domData(c.consoleWrap,"failed",1),console.error(e),b(e,!0)}function k(){var e=ge("queries",c.consoleWrap);return geByClass1("_queries_toggle",c.consoleWrap).innerHTML=isVisible(e)?"Показать запросы":"Скрыть запросы",toggle(e)}function S(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=[],o=function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",o={},i=function(e){var t="conditions_input"===e.id?domPS(e):domNS(e);return hasClass(t,"option_cleared")},r=function(t){return e&&i(t)};o["type"+t]=cur["uiSpamtype"+t].val();var s=ge("pattern_input"+t);o["pattern"+t]=r(s)?j(s):s.value,o["threshold"+t]=ge("threshold_input"+t).value;var n=ge("uid_input"+t);o["uid"+t]=r(n)?j(n):n.value;var a=ge("ip_input"+t);o["ip"+t]=r(a)?j(a):a.value;var c=ge("uahash_input"+t);o["uahash"+t]=r(c)?j(c):c.value;var l=ge("time_start_input"+t);o["time_start"+t]=r(l)?j(l):l.value;var d=ge("time_finish_input"+t);o["time_finish"+t]=r(d)?j(d):d.value;var u=ge("conditions_input"+t);return o["conditions"+t]=r(u)?ls.get(W(t)):u.value,o},i=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",o=[];Array.from(geByClass("option_cleared",e)).forEach((function(e){var t=geByTag1("input",domPN(e))||geByTag1("textarea",domPN(e));o.push(t.id)}));var i=[];return o.forEach(e=>{switch(e){case"pattern_input"+t:i|=cur.hideFieldsBitMasks.substring;break;case"ip_input"+t:i|=cur.hideFieldsBitMasks.ip;break;case"uahash_input"+t:i|=cur.hideFieldsBitMasks.uaHash;break;case"uid_input"+t:i|=cur.hideFieldsBitMasks.uid;break;case"time_finish_input"+t:i|=cur.hideFieldsBitMasks.timeFinish;break;case"time_start_input"+t:i|=cur.hideFieldsBitMasks.timeStart;break;case"conditions_input"+t:i|=cur.hideFieldsBitMasks.conditions}}),i};t.simplify=cur.uiSimplify.val(),t.duration=cur.uiDuration.val(),t.bantype=cur.uiBan.val(),t.search_period=cur.uiSearchPeriod.val();var r=cur.uiSearchPeriod.selectedItems();return r&&r.length>0&&(t.period_in_seconds=3===r[0].length&&1===r[0][2]?1:0),t.comment=ge("comment_input").value,t.all_actions=isChecked("all_actions")||!1,t.notbannedonly=isChecked("not_banned_only")||!1,t.linksonly=isChecked("links_only")||!1,t.wrap_actions=null===ge("wrap_actions")?1:isChecked("wrap_actions"),t.encode_entities=null===ge("encode_entities")?1:isChecked("encode_entities"),t.hidden_fields=i(geByClass1("pattern_part_root")),extend(t,o(e,"")),q()&&(t.hidden_fields2=i(geByClass1("pattern_part_child"),"2"),extend(t,o(e,"2"))),t}function j(e){return domData(e,"restore")}function E(e,t){return domData(e,"restore",t)}function O(){var e=ge("pattern_input"),t=geByClass1("_search_reports",c.patternWrap),o=S();if(!e.value)return scrollToTop(0),void notaBene(e);isButtonLocked(t)||(g(),lockButton(t),r&&(tooltips.destroy(r.el),r=!1),o.act="a_console_find_actions",ajax.post("noSpam.php",o,{onDone:e=>function(e){y(),geByClass1("_console",c.consoleWrap).innerHTML=e;var t=geByClass1("_console_numfield_ip1024",c.consoleWrap);t&&new InlineDropdown(t,{items:[[256,"/24 - 256"],[1024,"/22 - 1024"],[4096,"/20 - 4096"],[16384,"/18 - 16k"],[65536,"/16 - 65k"],[262144,"/14 - 262k"],[1048576,"/12 - 1kk"]],selected:256,withArrow:!0,keepTitle:!0,autoShow:!0,autoHide:300,onSelect:e=>P("ip"+e)})}(e),onFail:e=>w(e)}))}function C(e,t){"string"==typeof t&&(t=clean(t)),val(e,t),U(!1,ge(e),"reset")}function T(e){C("uid_input",e)}function L(e){C("ip_input",e)}function B(e){C("uahash_input",e)}function x(e){cur.uiSpamtype.selectItem(e)}function N(e,t){0!==e.length&&(ge("conditions_input").value+=ge("conditions_input").value?" "+(t?"||":"&&")+" "+e:e),K("reset")}function I(e){C("threshold_input",e)}function M(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];e||(e=S(!0));var t=Object.keys(e);t.sort();for(var o=[],i=0;i<t.length;i++){var r=t[i],s=e[r];o.push(encodeURIComponent(r)+"="+encodeURIComponent(s))}return"/noSpam?"+o.join("&")}function R(){var e=M(),t=geByClass1("_get_pattern_link");t&&t.tt&&t.tt.destroy(),addClass(t,"progress"),ajax.post("noSpam.php",{act:"get_search_link",link:e},{onDone:function(e){removeClass(t,"progress"),showTooltip(t,{text:e,slide:15,center:1,black:1,nohide:1,hidedt:400,shift:[0,2,0],onShowEnd:()=>{(0,window.selectText)("shorten_link"),setTimeout(t.tthide,3e3)}})},onFail:function(e){removeClass(t,"progress"),topError(e,{dt:5})}})}function A(){var e=geByClass1("debug_pattern",c.patternWrap);if(!isButtonLocked(e)){var t=extend(S(),{act:"debug_pattern"});g(),ajax.post("noSpam.php",t,{onDone:e=>b(e),onFail:e=>w(e)})}}function P(e,t){var o=isChecked("values_hist"),i=S();i.need_hist=o,i.act="numeric_field",i.field=e,i.custom_condition=t||"",cur.numFieldSel=e,ajax.post("noSpam.php",i,{onDone:function(i,r){var s=clean(t||e);showFastBox({width:o?330:710,title:s,dark:1,containerClass:"nospam_hist_wrap",hideButtons:o},i).evalBox(r)},progress:"console_query_fields_progress"})}function D(e){s=e,geByClass1("_nospam_console_custom_num_condition_patterns").innerHTML=e}function H(e){var t=2===e?cur.uiSpamtype2.val():cur.uiSpamtype.val();return showBox("noSpam.php",{act:"conditions_hint",spamtype:t},{dark:1,containerClass:"nospam_hint_wrap"})}function F(){var e=S(),t=geByClass1("_apply_pattern",c.patternWrap);e.act="apply_pattern",isButtonLocked(t)||null===document.querySelector(".console_failed_queries")&&(g(),lockButton(t),ajax.post("noSpam.php",e,{onDone:e=>b(e),onFail:e=>w(e)}))}function V(e){["pattern_input","threshold_input","ip_input","uahash_input","time_finish_input","time_start_input","conditions_input"].forEach(e=>{var t=ge(e).value;ge(e).value=ge(e+"2").value,ge(e+"2").value=t});var t=cur.uiSpamtype.val();cur.uiSpamtype.selectItem(cur.uiSpamtype2.val()),cur.uiSpamtype2.selectItem(t),toggleClass(e,"switched")}function W(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return`nospam_conditions${e}_${vk.id}`}function K(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",o=ge("conditions_input"+t),i="option_cleared",r=domPS(o),s=function(){var e=o.value;ls.set(W(t),e),o.value="",e&&addClass(r,i)},n=function(){var e=ls.get(W(t));removeClass(r,i),removeClass(r,"highlighted"),e&&(ls.remove(W(t)),o.value=e)},a=function(){removeClass(r,i),removeClass(r,"highlighted"),ls.remove(W(t))};switch(e){case"clear":hasClass(r,i)?n():s();break;case"reset":a()}}function U(e,t,o){var i=ge(t),r=hasClass(e,"option_cleared");function s(o){var i=val(o);switch(E(o,i),t){case"pattern_input":case"pattern_input2":val(o,"/"),cur.uiSimplify.selectItem(32);break;case"threshold_input":case"threshold_input2":val(o,o.value&&"2"===o.value?"1":"2");break;default:val(o,"")}i&&addClass(e,"option_cleared")}switch(o){case"clear":r?function(){switch(t){case"threshold_input":case"threshold_input2":s(i);break;default:r&&(i.value=j(i))}removeClass(e,"option_cleared"),removeClass(e,"highlighted")}():s(i);break;case"reset":!function(){var e=geByClass1("option_clear",i.parentNode);E(i,""),removeClass(e,"option_cleared"),removeClass(e,"highlighted")}();break;case"reset_all":geByClass("option_clear").forEach((function(e){E(ge(e.getAttribute("data-option")),""),removeClass(e,"option_cleared"),removeClass(e,"highlighted")}))}}function q(){var e=geByClass1("_pattern_part_child");if(!isVisible(e))return!1;for(var t=geByClass("cloneable_input",e),o=0;o<t.length;o++)if(val(t[o]))return!0;return!1}function z(){var e=geByClass1("pattern_wrap");hasClass(e,"pattern_composite")?removeClass(e,"pattern_composite"):addClass(e,"pattern_composite")}function G(){}function X(e){var t=ge(document.activeElement);if(e.altKey)switch(-1!==[49,50,51,52,53,67,70,83].indexOf(e.keyCode)&&t&&t.blur(),e.keyCode){case 83:Object(c.activeTab)()===c.tabPattern?O():Object(c.activeTab)()===c.tabReports&&Object(a.prepareReport)(Object(a.activeReportsType)(),Object(a.activeSubReportsType)());break;case 70:if(-1!==[u,p,h].indexOf(vk.id))return F();break;case 67:K("clear"),cur.conditions.deselectTemplate();break;case 49:cur.uiSearchPeriod.selectItem(1);break;case 50:cur.uiSearchPeriod.selectItem(24);break;case 51:cur.uiSearchPeriod.selectItem(72);break;case 52:cur.uiSearchPeriod.selectItem(240);break;case 53:cur.uiSearchPeriod.selectItem(2160)}}function Y(){var e=window.pageNode,t=window.browser.msie6?e:window,o=geByClass1("_pattern_buttons",c.patternWrap),i=Object(n.createModule)({handlers:(e,i)=>{i(o,"click","_search_reports",O),i(o,"click","_apply_pattern",F),i(o,"click","_get_pattern_link",R),i(o,"click","debug_pattern",A),i(c.consoleWrap,"click","_queries_toggle",k),i(c.consoleWrap,"click","_console_linkfield_action",e=>function(e){var t=domData(e.target,"field"),o=showFastBox.pbind({width:710,title:t,dark:1}),i=S();i.act="link_field",i.field=t,ajax.post("noSpam.php",i,{onDone:o,progress:"console_query_fields_progress"})}(e)),i(c.consoleWrap,"click","_console_numfield_action",e=>{var t=e.target,o=domData(t,"field");o!==m?P(o):function(e){var t="nospam_console_custom_num_condition",o=()=>{var e=ge("nospam_console_custom_num_condition"),t=val(e);if(t){var o={act:"a_numeric_field_add_condition",custom_condition:t};ajax.post("noSpam.php",o,{onDone:D.pbind()}),P(m,t)}else notaBene(e)},i={className:"nospam_console_custom_num_condition_wrap",text:getTemplate("nospam_console_custom_num_condition"),forcetodown:1,nohide:1,forceNoHide:1,shift:[10,8],showdt:0,onShowEnd:()=>{elfocus(ge("nospam_console_custom_num_condition"))},onShowStart:()=>{val("nospam_console_custom_num_condition",ls.get(t)||"")},init:i=>{r=i;var s=ge("nospam_console_custom_num_condition");addEvent(s,"keypress",e=>onEnter(o,e)),addEvent(s,"keyup",()=>ls.set(t,val(s)));var n=geByClass1("_nospam_console_custom_num_condition_close",domPN(s));addEvent(n,"click",()=>e.tthide())}};r?(r.show(),o()):showTooltip(e,i),s&&D(s)}(t)}),i(t,"click","_nospam_console_custom_num_condition_pattern",e=>{var t=e.target,o=Object(l.unclean)(domData(t,"pattern"));val("nospam_console_custom_num_condition",o)}),i(t,"click","_nospam_console_custom_num_condition_clear",e=>{var t=e.target,o={act:"a_numeric_field_delete_condition",custom_condition:Object(l.unclean)(domData(t,"pattern"))};ajax.post("noSpam.php",o,{onDone:D.pbind()})}),i(c.consoleWrap,"click","console_set_range",e=>{var t=e.target,o=domData(t,"time");o<0?C("time_finish_input",-o):o>0&&function(e){C("time_start_input",e)}(o)}),i(c.consoleWrap,"click","console_uid",e=>{if(e&&e.altKey){var t=clean(e.target.dataset.uid||"");e.ctrlKey?(removeClass(e.target,"console_intem_excluded"),T(t)):(addClass(e.target,"console_intem_excluded"),T(""),N("uid != "+t)),cancelEvent(e)}}),e(t,"scroll",G),e(document,"keydown",X),i(c.patternWrap,"click","_option_clear",e=>{var t=e.target;U(t,domData(t,"option"),"clear")}),i(c.patternWrap,"click","_conditions_clear",e=>{K("clear",domNS(e.target).id.replace("conditions_input",""))}),i(document,"click","_console_conditions",e=>{var t=e.target;N(domData(t,"conditions"))}),i(c.consoleWrap,d.EVENT_MOUSEDOWN,"console_story",e=>{return t=e.target,o=domData(t,"owner_id"),i=domData(t,"story_id"),r=domData(t,"moderator_hash"),cur.noStoriesBack=!0,void window.showStory(`${o}/${o}_${i}/moderator_hash:${r}`);var t,o,i,r})}});cur.destroy.push(()=>{Object(n.destroyModule)(i)})}},"4WSo":function(e,t,o){"use strict";o.r(t),o.d(t,"NarrativeItemPreviewCover",(function(){return n}));var i=o("q1tI"),r=o.n(i),s=o("ZxpX"),n=r.a.memo((function(e){var t=e.title,o=e.onClick,i=e.cover,n=e.href,a=e.className,c=void 0===a?"":a,l=e.extra,d=i?{backgroundImage:"url("+i+")"}:{},u=Object(s.classNames)("NarrativeItemPreviewCover",c),p=r.a.createElement("div",{className:"NarrativeItemPreviewCover__image",onClick:o,style:d,title:t||void 0},l);return r.a.createElement(r.a.Fragment,null,n&&r.a.createElement("a",{href:n,className:u},p),!n&&r.a.createElement("div",{className:u},p))}))},"505V":function(e,t,o){"use strict";var i,r,s,n;o.r(t),o.d(t,"Type",(function(){return i})),o.d(t,"TabKey",(function(){return r})),o.d(t,"EditorViewType",(function(){return s})),o.d(t,"GridSelectType",(function(){return n})),function(e){e[e.create=0]="create",e[e.edit=1]="edit"}(i||(i={})),function(e){e.all="all",e.selected="selected"}(r||(r={})),function(e){e.box="box",e.page="page"}(s||(s={})),function(e){e[e.none=0]="none",e[e.checkbox=1]="checkbox",e[e.radio=2]="radio"}(n||(n={}))},"59zB":function(e,t,o){"use strict";o.r(t);o("pIFo"),o("KKXr");var i,r=o("gdug"),s=o("t7n3"),n=o("zxIV"),a=o("Egk5"),c=o("7jxN"),l=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||(e=>setTimeout(e,1)),d=window.cancelAnimationFrame||window.cancelRequestAnimationFrame||window.webkitCancelRequestAnimationFrame||window.mozCancelRequestAnimationFrame||window.oCancelRequestAnimationFrame||window.msCancelRequestAnimationFrame||clearTimeout;function u(e){i&&d(i),i=l(e)}function p(e){return Object(s.isString)(e)&&"_"===e[0]?geByClass1(e):ge(e)}function h(e,t){if((e=p(e))&&Object(s.isFunction)(t)){if(r.browser.msie9||r.browser.opera&&r.browser.version<13){var o=!1,i=!1,n=function e(){if(!a.contentDocument)return setTimeout(e,100);a.contentDocument.defaultView.removeEventListener("resize",t),a.contentDocument.defaultView.addEventListener("resize",t),t()},a=ce("object",{type:"text/html",className:"ui_scroll_resize_object",data:"about:blank",onload:function(){i=!0,o&&n()}});return e.appendChild(a),e.__resizeSensor__=[a,function(){o=!0,i&&n()}]}var c=ce("div",{className:"ui_scroll_resize_sensor"}),l=ce("div",{className:"ui_scroll_resize_sensor ui_scroll_resize_expand"}),d=ce("div",{className:"ui_scroll_resize_sensor ui_scroll_resize_shrink"}),u=ce("div"),h=ce("div"),_=null;return l.appendChild(u),d.appendChild(h),c.appendChild(l),c.appendChild(d),e.appendChild(c),e.__resizeSensor__=[c,l.onscroll=d.onscroll=function(){var o=(e.offsetWidth||1e4)+10,i=(e.offsetHeight||1e4)+10;u.style.width=o+"px",u.style.height=i+"px",l.scrollLeft=o,l.scrollTop=i,d.scrollLeft=o,d.scrollTop=i,_!==(_=o+" "+i)&&t()}]}}class _{constructor(e,t){if(!(e=p(e)))throw new Error("uiScroll container is undefined");e.__uiScroll__&&e.__uiScroll__.destroy(),this.options=extend({global:!1,native:!1,theme:"default",reversed:!1,autoresize:!0,preserveEdgeBelow:!1,barMinHeight:30,preserveEdgeBelowThreshold:20,stopScrollPropagation:!0,stopScrollPropagationAlways:!1,minContentHeight:0,onmoreThreshold:null,hidden:!1,shadows:!1,scrollElements:[],onresize:null,onscroll:null,onscrollstart:null,onscrollstop:null,ondrag:null,ondragstart:null,ondragstop:null,onupdate:null,onmore:null,noForceReFlow:!1,noLazyLoadWatch:!1},t),this.options.native&&(this.options.shadows=!1),r.browser.mobile&&(this.options.stopScrollPropagation=!1),isArray(this.options.scrollElements)||(this.options.scrollElements=[]),this.removeEvents=[],this.removeElements=[],this.dragging=!1,this.dragged=!1,this.released=!0,this.noMore=!1,this.dragY=null,this.dragScroll=null,this.shadowTop=!1,this.shadowBottom=!1,this.unnecessary=!1,this.disabled=!1,this.stopped=!0,this.stoppedTimeout=null,this.fixSizeDefault=null,this.animation=null,this.barOuterHeight=null,this.barInnerHeight=null,this.currentFrame=null,this.blockerScrollTop=500,this.emitter=new EventEmitter,Object(s.isFunction)(this.options.onresize)&&this.emitter.addListener("resize",this.options.onresize),Object(s.isFunction)(this.options.onscroll)&&this.emitter.addListener("scroll",this.options.onscroll),Object(s.isFunction)(this.options.onscrollstart)&&this.emitter.addListener("scrollstart",this.options.onscrollstart),Object(s.isFunction)(this.options.onscrollstop)&&this.emitter.addListener("scrollstop",this.options.onscrollstop),Object(s.isFunction)(this.options.ondrag)&&this.emitter.addListener("drag",this.options.ondrag),Object(s.isFunction)(this.options.ondragstart)&&this.emitter.addListener("dragstart",this.options.ondragstart),Object(s.isFunction)(this.options.ondragstop)&&this.emitter.addListener("dragstop",this.options.ondragstop),Object(s.isFunction)(this.options.onupdate)&&this.emitter.addListener("update",this.options.onupdate),Object(s.isFunction)(this.options.onmore)&&this.emitter.addListener("more",this.options.onmore),this.el={container:e,overflow:ce("div",{className:"ui_scroll_overflow"}),outer:ce("div",{className:"ui_scroll_outer"},{margin:this.options.stopScrollPropagation?this.blockerScrollTop+"px 0":void 0}),inner:ce("div",{className:"ui_scroll_inner tt_noappend"}),shadowTop:ce("div",{className:"ui_scroll_shadow_top"}),shadowBottom:ce("div",{className:"ui_scroll_shadow_bottom"}),content:ce("div",{className:"ui_scroll_content clear_fix"}),barContainer:ce("div",{className:"ui_scroll_bar_container"}),barOuter:ce("div",{className:"ui_scroll_bar_outer"}),barInner:ce("div",{className:"ui_scroll_bar_inner"})},Object(n.data)(this.el.container,"ui-scroll",this);var o=Object(n.cf)(),i=["ui_scroll_container"];for(each(isArray(this.options.theme)?this.options.theme:trim(this.options.theme+"").split(/\s+/),(function(e,t){t&&i.push("ui_scroll_"+t+"_theme")})),addClass(this.el.container,i.join(" ")),this.options.hidden&&addClass(this.el.container,"ui_scroll_hidden");this.el.container.firstChild;)this.el.content.appendChild(this.el.container.firstChild);if(this.el.outer.appendChild(this.el.inner),this.el.inner.appendChild(this.el.content),this.options.stopScrollPropagation?(this.el.blocker=ce("div",{className:"ui_scroll_blocker"}),this.addEvent(this.el.blocker,"scroll",this.fixBlocker.bind(this),!0),this.el.blocker.appendChild(this.el.outer),this.el.overflow.appendChild(this.el.blocker)):this.el.overflow.appendChild(this.el.outer),o.appendChild(this.el.overflow),this.options.native?addClass(this.el.container,"ui_scroll_native"):(this.el.barOuter.appendChild(this.el.barInner),this.el.barContainer.appendChild(this.el.barOuter),o.appendChild(this.el.barContainer),this.options.shadows&&(this.el.overflow.appendChild(this.el.shadowTop),this.el.overflow.appendChild(this.el.shadowBottom)),r.browser.mobile||this.options.scrollElements.push(this.el.barContainer)),this.options.autoresize){var c=h(this.el.inner,this.resize.bind(this,!0)),l=h(this.el.overflow,this.resize.bind(this,!1));this.removeElements.push(c[0]),this.removeElements.push(l[0]),this.startResizeListening=function(){c[1](),l[1]()}}this.removeElements.push(this.el.overflow,this.el.barContainer),this.el.container.appendChild(o),this.options.reversed&&(this.el.outer.scrollTop=this.el.outer.scrollHeight),this.el.container.__uiScroll__=this.api={container:this.el.container,scroller:this.el.outer,content:this.el.content,emitter:this.emitter,ondragstart:this.dragstart.bind(this),ondragstop:this.dragstop.bind(this),ondrag:this.drag.bind(this),destroy:this.destroy.bind(this),disable:this.disable.bind(this,!0),enable:this.disable.bind(this,!1),scrollTop:this.scrollTop.bind(this,!0),scrollBottom:this.scrollBottom.bind(this,!0),scrollBy:this.scrollBy.bind(this),scrollIntoView:this.scrollIntoView.bind(this,!0),update:this.init.bind(this),updateAbove:this.updateAbove.bind(this),updateBelow:this.updateBelow.bind(this),data:{scrollTop:null,scrollBottom:null,scrollHeight:null,viewportHeight:null}},this.init(),this.options.noLazyLoadWatch||(window.LazyLoad&&LazyLoad.watch(this.el.outer),window.LazyLoad&&LazyLoad.scanDelayed());var d="onwheel"in this.el.outer?"wheel":void 0!==document.onmousewheel?"mousewheel":r.browser.mozilla?"MozMousePixelScroll":"DOMMouseScroll";return this.addEvent(this.el.container,d,function(e){this.animation&&this.animation.stop(),!this.disabled&&this.options.stopScrollPropagation&&(this.unnecessary?this.options.stopScrollPropagationAlways&&Object(a.cancelEvent)(e):this.isScrollEventUnused(e)?Object(a.cancelEvent)(e):Object(a.stopEvent)(e))}.bind(this),!this.options.stopScrollPropagation),this.options.native||this.addEvent(this.el.barContainer,"mousedown",this.dragstart.bind(this)),each(this.options.scrollElements,function(e,t){this.addEvent(t,d,function(e){this.disabled||this.unnecessary||(this.scrollBy(_.scrollEventDelta(e)),!this.options.stopScrollPropagation&&this.isScrollEventUnused(e)||Object(a.cancelEvent)(e))}.bind(this))}.bind(this)),this.options.reversed&&this.addEvent(this.el.container,"mousedown touchstart pointerdown",function(e){this.released=!1,this.noMore=!0;var t=this.addEvent(document,"mouseup contextmenu touchend pointerup",function(e){removeEvent(document,"mouseup contextmenu touchend pointerup",t),this.released=!0,this.noMore&&this.stopped&&!this.dragging&&(this.noMore=!1,this.more())}.bind(this))}.bind(this)),this.addEvent(this.el.outer,"scroll",function(){this.update()&&(this.stopped?(this.stopped=!1,this.emitEvent("scrollstart")):this.options.native||!1!==this.stopped||(this.stopped=0,addClass(this.el.container,"ui_scroll_scrolled")),this.emitEvent("scroll"),this.stoppedTimeout&&clearTimeout(this.stoppedTimeout),this.stoppedTimeout=setTimeout(function(){this.stopped||(this.stopped=!0,this.options.native||removeClass(this.el.container,"ui_scroll_scrolled"),this.emitEvent("scrollstop"),this.noMore&&this.released&&!this.dragging&&(this.noMore=!1,this.more()))}.bind(this),200))}.bind(this)),this.api}init(){if(this.options.stopScrollPropagation&&this.fixBlocker(),!this.inited){if(!this.el.container.scrollWidth||this.disabled)return;this.fixSize(!0),this.options.autoresize&&this.startResizeListening(),this.options.global||cur.destroy.push(this.destroy.bind(this)),this.inited=!0}return this.update(!0),this.api}addEvent(e,t,o,i){return this.removeEvents.push([e,t,o]),addEvent(e,t,o,void 0,void 0,i?{passive:!0}:void 0),o}destroy(){if(this.disabled=!0,this.fixSize(),this.animation&&this.animation.stop(),this.moreTimeout&&clearTimeout(this.moreTimeout),this.dragstopHandler&&removeEvent(document,"mouseup contextmenu",this.dragstopHandler),this.dragHandler&&removeEvent(document,"mousemove",this.dragHandler),each(this.removeEvents,(function(e,t){removeEvent.apply(null,t)})),this.el.overflow.parentNode==this.el.container){for(var e=Object(n.cf)();this.el.content.firstChild;)e.appendChild(this.el.content.firstChild);this.el.container.appendChild(e)}return Object(n.removeData)(this.el.container,"ui-scroll"),this.el.container.className=this.el.container.className.replace(/\bui_scroll_.+?\b/g," "),each(this.removeElements,(function(e,t){Object(n.re)(t)})),this.el.container.scrollTop=this.api.data.scrollTop,delete this.el.container.__uiScroll__,this.api}updateAbove(e){if(Object(s.isFunction)(e)){this.animation&&this.animation.stop();var t=this.el.outer.scrollHeight-this.el.outer.scrollTop-this.el.overflow.offsetHeight;e(),this.el.outer.scrollTop=this.el.outer.scrollHeight-this.el.overflow.offsetHeight-t}return this.api}updateBelow(e){if(Object(s.isFunction)(e)){this.animation&&this.animation.stop();var t=this.options.preserveEdgeBelow&&this.api.data.scrollBottom<=this.options.preserveEdgeBelowThreshold;e(),t&&this.scrollBottom(!1)}return this.api}fixBlocker(){r.browser.chrome&&!this.options.noForceReFlow&&this.forceReFlow(),this.el.blocker.scrollTop=this.blockerScrollTop}forceReFlow(){this.el.blocker.style.display="inline-block",this.el.blocker.offsetHeight,this.el.blocker.style.display=""}fixSize(e){this.options.native||(e&&null==this.fixSizeDefault&&(this.fixSizeDefault=this.el.container.style.width),setStyle(this.el.container,"width",e?Object(n.getSize)(this.el.container,!0)[0]||this.fixSizeDefault||"":this.fixSizeDefault||""))}emitEvent(e){this.disabled||this.inited&&this.emitter.emitEvent(e,[this.api])}static scrollEventDelta(e){var t=0,o=void 0!==e.deltaMode?e.deltaMode:"MozMousePixelScroll"==e.type?0:1;return"wheel"==e.type?t=e.deltaY:void 0!==e.wheelDeltaX&&void 0!==e.wheelDeltaY?(t=1/40*-e.wheelDeltaY,r.browser.mac&&r.browser.opera&&(t*=.1)):void 0!==e.wheelDelta?t=1/40*-e.wheelDelta:e.detail&&2===e.axis&&(t=e.detail),t*(1==o?15:2==o?450:1)}isScrollEventUnused(e){return _.scrollEventDelta(e)>0?!this.api.data.scrollBottom:!this.api.data.scrollTop}resize(e){if(!e&&this.options.preserveEdgeBelow){var t=this.options.preserveEdgeBelow&&this.api.data.scrollBottom<=this.options.preserveEdgeBelowThreshold;this.update(!0)&&(this.emitEvent("resize"),t&&this.scrollBottom(),this.options.stopScrollPropagation&&!e&&this.fixBlocker())}else this.update(!0)&&(this.options.stopScrollPropagation&&!e&&this.fixBlocker(),this.emitEvent("resize"))}disable(e){return this.disabled=!!e,e?(this.animation&&this.animation.stop(),this.fixSize()):(this.fixSize(!0),this.options.stopScrollPropagation&&this.fixBlocker(),this.update(!0)),Object(n.toggleClass)(this.el.container,"ui_scroll_disabled",this.disabled),this.api}dragstart(e){if(!(this.disabled||this.dragging||this.options.native))return e||(e=window.event),this.dragging=!0,this.animation&&this.animation.stop(),this.options.reversed&&(this.noMore=!0),addEvent(document,"mouseup contextmenu",this.dragstartHandler=this.dragstop.bind(this)),addEvent(document,"mousemove",this.dragHandler=this.drag.bind(this)),this.dragScroll=this.options.reversed?this.api.data.scrollBottom:this.api.data.scrollTop,this.dragY=e.screenY,Object(a.cancelEvent)(e),this.emitEvent("dragstart"),this.api}dragstop(e){if(!this.disabled&&this.dragging&&!this.options.native){if(e||(e=window.event),this.dragging=!1,this.dragstopHandler&&removeEvent(document,"mouseup contextmenu",this.dragstopHandler),this.dragHandler&&removeEvent(document,"mousemove",this.dragHandler),setStyle(bodyNode,"cursor",""),removeClass(this.el.container,"ui_scroll_dragging"),this.dragged)this.noMore&&(this.noMore=!1,this.more());else{this.options.reversed&&(this.noMore=!0);var t=(e.pageY-Object(n.getXY)(this.el.barOuter)[1]-this.barInnerHeight/2)*(Math.max(this.options.minContentHeight,this.api.data.scrollHeight)-this.api.data.viewportHeight)/(this.barOuterHeight-this.barInnerHeight);this.scrollTop(!1,t,0,function(){this.noMore&&(this.noMore=!1,this.more())}.bind(this))}return this.dragged=!1,e&&"contextmenu"!==e.type&&Object(a.cancelEvent)(e),this.emitEvent("dragstop"),this.api}}drag(e){if(!this.disabled&&this.dragging&&!this.options.native){e||(e=window.event);var t=(e.screenY-this.dragY)*(this.api.data.scrollHeight/this.el.barOuter.scrollHeight);return this.el.outer.scrollTop=this.options.reversed?this.el.outer.scrollHeight-this.el.overflow.offsetHeight-this.dragScroll+t:this.dragScroll+t,this.dragged||(this.dragged=!0,setStyle(bodyNode,"cursor","pointer"),addClass(this.el.container,"ui_scroll_dragging")),Object(a.cancelEvent)(e),this.emitEvent("drag"),this.api}}scroll(e,t,o){return this.animation&&this.animation.stop(),this.el.outer.scrollTop==e&&this.update(!0),t?(t="number"!=typeof t||!isFinite(t)||t%1?300:Math.abs(t),this.animation=new c.Fx.Base({scrollTop:this.el.outer.scrollTop},{transition:c.Fx.Transitions.easeOutCubic,onStep:function(e){this.el.outer.scrollTop=e.scrollTop}.bind(this),duration:t,onComplete:Object(s.isFunction)(o)?o.pbind(this.api):void 0}).start({scrollTop:this.el.outer.scrollTop},{scrollTop:e})):(this.el.outer.scrollTop=e,Object(s.isFunction)(o)&&o(this.api)),this.api}scrollTop(e,t,o,i){if(e&&this.options.stopScrollPropagation&&this.fixBlocker(),!this.disabled&&!this.dragging)return this.scroll(Object(s.intval)(t),o,i)}scrollBottom(e,t,o,i){if(e&&this.options.stopScrollPropagation&&this.fixBlocker(),!this.disabled&&!this.dragging)return this.scroll(this.el.outer.scrollHeight-this.el.overflow.offsetHeight-Object(s.intval)(t),o,i)}scrollBy(e,t,o){if(!this.disabled&&!this.dragging)return this.scroll(this.el.outer.scrollTop+Object(s.intval)(e),t,o)}scrollIntoView(e,t,o,i){if(e&&this.options.stopScrollPropagation&&this.fixBlocker(),(t=p(t))&&t.compareDocumentPosition&&t.compareDocumentPosition(this.el.content)&Node.DOCUMENT_POSITION_CONTAINS){var r=Object(n.getXY)(t)[1],a=Object(n.getXY)(this.el.overflow)[1],c=Object(n.getSize)(t)[1];if(r<=a&&r+c>=a+this.api.data.viewportHeight||r>=a&&r+c<=a+this.api.data.viewportHeight)Object(s.isFunction)(i)&&(o?setTimeout(i.bind(this.api),0):i(this.api));else if(c>this.api.data.viewportHeight||r<a)this.scrollTop(!1,r-a+this.api.data.scrollTop-(this.options.shadows?Object(n.getSize)(this.el.shadowTop)[1]:0),o,i);else{var l=this.options.shadows?Object(n.getSize)(this.el.shadowBottom)[1]:0;this.scrollTop(!1,r-a+this.api.data.scrollTop+c-this.api.data.viewportHeight+l,o,i)}}return this.api}update(e){var t,o;this.el.container&&!this.el.container.updateScroll&&(this.el.container.updateScroll=this.update.bind(this,!1));var i=this.el.outer.scrollTop;if(this.inited&&!this.disabled&&(e&&(t=this.el.inner.offsetHeight,this.api.data.viewportHeight!==(this.api.data.viewportHeight=this.el.overflow.offsetHeight)||this.api.data.scrollHeight!==t)||this.api.data.scrollTop!==i)){if(e&&(this.api.data.scrollHeight=t),this.api.data.scrollTop=Math.max(0,Math.min(this.api.data.scrollHeight-this.api.data.viewportHeight,Math.max(0,i))),this.api.data.scrollBottom=Math.max(0,this.api.data.scrollHeight-this.api.data.scrollTop-this.api.data.viewportHeight),!this.options.native){if(!(o=(t=Math.max(this.options.minContentHeight,this.api.data.scrollHeight))<=this.api.data.viewportHeight)){var r=this.el.barOuter.offsetHeight;(e||this.barOuterHeight!==r)&&(this.barOuterHeight=r,this.barInnerHeight=Math.max(this.options.barMinHeight,this.barOuterHeight*this.api.data.viewportHeight/t),this.el.barInner.style.height=this.barInnerHeight+"px"),u(()=>{var e=(this.barOuterHeight-this.barInnerHeight)*this.api.data.scrollTop/(t-this.api.data.viewportHeight);this.el.barInner.style.transform=`translateY(${e}px)`})}this.options.shadows&&(this.shadowTop!=(this.api.data.scrollTop&&!o)&&Object(n.toggleClass)(this.el.container,"ui_scroll_shadow_top_visible",this.shadowTop=this.api.data.scrollTop&&!o),this.shadowBottom!=(this.api.data.scrollBottom&&!o)&&Object(n.toggleClass)(this.el.container,"ui_scroll_shadow_bottom_visible",this.shadowBottom=this.api.data.scrollBottom&&!o)),this.unnecessary!==o&&(Object(n.toggleClass)(this.el.container,"ui_scroll_unnecessary",o),this.unnecessary=o,this.options.stopScrollPropagation&&this.fixBlocker(),o&&this.barInnerHeight&&this.barOuterHeight&&u(function(e){this.el.barInner.style.height=100*this.barInnerHeight/this.barOuterHeight+"%";var o=(this.barOuterHeight-this.barInnerHeight)*this.api.data.scrollTop/(t-this.api.data.viewportHeight)*100/this.barInnerHeight;this.el.barInner.style.transform=`translateY(${o}%)`}.bind(this)))}return this.emitEvent("update"),this.options.noLazyLoadWatch||window.LazyLoad&&LazyLoad.scanDelayed(this.el.outer),(!this.options.reversed||i>=0)&&this.more(),!0}return!1}more(){var e=this.options.reversed?this.api.data.scrollTop:this.api.data.scrollBottom,t=null!==this.options.onmoreThreshold?this.options.onmoreThreshold:2*this.api.data.viewportHeight;!this.noMore&&e<=t&&this.emitEvent("more")}}_.addResizeSensor=h;t.default=_},"6aSF":function(e,t,o){"use strict";o.r(t),o.d(t,"default",(function(){return c}));o("91GP"),o("ioFf"),o("rGqo"),o("Btvt");var i=o("q1tI"),r=(o("17x9"),o("+/AQ")),s=o("ZxpX");function n(){return(n=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var o=arguments[t];for(var i in o)Object.prototype.hasOwnProperty.call(o,i)&&(e[i]=o[i])}return e}).apply(this,arguments)}function a(e,t){if(null==e)return{};var o,i,r=function(e,t){if(null==e)return{};var o,i,r={},s=Object.keys(e);for(i=0;i<s.length;i++)o=s[i],t.indexOf(o)>=0||(r[o]=e[o]);return r}(e,t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(i=0;i<s.length;i++)o=s[i],t.indexOf(o)>=0||Object.prototype.propertyIsEnumerable.call(e,o)&&(r[o]=e[o])}return r}class c extends i.Component{constructor(){super(...arguments),this.getWrapperRef=e=>{this.wrapper=e}}componentDidMount(){var e=this.props,t=e.isNative,o=e.isShadows,i=e.neverHide,s=e.onScroll;this.scroller||(this.scroller=Object(r.createScroll)(this.wrapper,{shadows:o,nativeScroll:t,hidden:!i,onScroll:s}))}componentDidUpdate(){this.scroller.update()}componentWillUnmount(){this.scroller.destroy(),this.scroller=null}render(){var e=this.props,t=e.children,o=(e.isNative,e.isShadows,e.neverHide,e.className),r=void 0===o?"":o,c=a(e,["children","isNative","isShadows","neverHide","className"]);return i.createElement("div",n({},c,{className:Object(s.classNames)("Scroll",r),ref:this.getWrapperRef}),t)}}c.defaultProps={isNative:!1,isShadows:!1,neverHide:!1,onScroll:null}},"6krn":function(e,t,o){"use strict";o.r(t),o.d(t,"getLang",(function(){return n}));var i=o("nAFc"),r=o("4+be"),s={};function n(e,t,o){void 0===t&&(t=!1);var n="number"==typeof t,a=t||n,c=e+(a?".raw":"");if(void 0===s[c]){var l=a?Object(r.getLang)(e,"raw"):Object(r.getLang)(e);"string"==typeof l?s[c]=Object(i.decodeHTMLEntities)(l):Array.isArray(l)&&(s[c]=l.map(i.decodeHTMLEntities))}if(n){var d=t;return Object(r.langNumeric)(d,s[c],o)}return s[c]||""}t.default={getLang:n}},"6raB":function(e,t,o){"use strict";o.r(t),o.d(t,"default",(function(){return l}));o("91GP"),o("ioFf"),o("rGqo"),o("Btvt");var i=o("q1tI"),r=(o("17x9"),o("ZxpX")),s=o("Q3mP"),n=o("Ht+d");function a(){return(a=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var o=arguments[t];for(var i in o)Object.prototype.hasOwnProperty.call(o,i)&&(e[i]=o[i])}return e}).apply(this,arguments)}function c(e,t){if(null==e)return{};var o,i,r=function(e,t){if(null==e)return{};var o,i,r={},s=Object.keys(e);for(i=0;i<s.length;i++)o=s[i],t.indexOf(o)>=0||(r[o]=e[o]);return r}(e,t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(i=0;i<s.length;i++)o=s[i],t.indexOf(o)>=0||Object.prototype.propertyIsEnumerable.call(e,o)&&(r[o]=e[o])}return r}class l extends i.Component{constructor(e){super(e),this.needRecalcSize=!1,this.state={}}render(){var e=this.props,t=e.className,o=e.loading,l=e.children,d=c(e,["className","loading","children"]),u=Object(r.classNames)("ButtonWithProgress",{"ButtonWithProgress--loading":o},t),p=["primary","positive"].some(t=>t===e.appearance);return i.createElement(n.default,a({},d,{className:u}),i.createElement("span",{className:"ButtonWithProgress__content"},l),o&&i.createElement(s.default,{inverted:p,className:"ButtonWithProgress__progress"}))}}l.defaultProps={appearance:"primary",size:"m",wide:!1,loading:!1}},"7ZXl":function(e,t,o){"use strict";o.r(t),o.d(t,"ModalFooter",(function(){return s}));var i=o("q1tI"),r=o.n(i),s=function(e){var t=e.actionButtons,o=e.hint;return r.a.createElement("div",{className:"ModalFooter"},r.a.createElement("div",{className:"ModalFooter__inner"},o&&r.a.createElement("div",{className:"ModalFooter__hint"},o),t))}},"7hRE":function(e,t,o){"use strict";o.r(t),o.d(t,"default",(function(){return a}));o("91GP"),o("ioFf"),o("rGqo"),o("Btvt");var i=o("q1tI"),r=(o("17x9"),o("ZxpX"));function s(){return(s=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var o=arguments[t];for(var i in o)Object.prototype.hasOwnProperty.call(o,i)&&(e[i]=o[i])}return e}).apply(this,arguments)}function n(e,t){if(null==e)return{};var o,i,r=function(e,t){if(null==e)return{};var o,i,r={},s=Object.keys(e);for(i=0;i<s.length;i++)o=s[i],t.indexOf(o)>=0||(r[o]=e[o]);return r}(e,t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(i=0;i<s.length;i++)o=s[i],t.indexOf(o)>=0||Object.prototype.propertyIsEnumerable.call(e,o)&&(r[o]=e[o])}return r}class a extends i.Component{constructor(e){super(e),this.onError=()=>{this.setState({errored:!0})},this.state={}}render(){var e=this.props,t=e.photo,o=e.title,a=e.isOnline,c=e.isMobile,l=e.onlineSize,d=e.element,u=e.className,p=n(e,["photo","title","isOnline","isMobile","onlineSize","element","className"]),h=d||"div",_="Avatar--badge-"+l,m=Object(r.classNames)("Avatar",_,u,{"Avatar--online":a,"Avatar--mobile":c});return i.createElement(h,s({className:m},p),i.createElement("div",{className:"Avatar__wrapper"},i.createElement("img",{onError:this.onError,className:"Avatar__img",src:this.state.errored?"/images/camera_c.gif":t,alt:o})))}}a.defaultProps={isOnline:!1,isMobile:!1,onlineSize:"m"}},As6E:function(e,t,o){"use strict";o.r(t),o.d(t,"default",(function(){return a}));o("91GP"),o("rGqo"),o("Btvt");var i=o("q1tI"),r=o("i8i4"),s=(o("17x9"),o("ZxpX")),n=o("clTp");class a extends i.Component{constructor(e){super(e),this.onClick=()=>{if(!this.state.dropdown||this.state.dropdown.removed){var e=this.props,t=e.text,o=e.position,i=e.align,r=e.marginTop,s=e.marginLeft,a=Object(n.default)(this.el);this.update({text:t,position:o,align:i,rect:a,marginTop:r,marginLeft:s})}else this.update()},this.onMouseEnter=e=>{this.callerHovered=!0,this.timeouts.appear=setTimeout(()=>{if(this.el&&this.callerHovered){var e=this.props,t=e.position,o=e.align,i=e.marginTop,r=e.marginLeft,s=Object(n.default)(this.el);this.update({position:t,align:o,rect:s,marginTop:i,marginLeft:r})}},80)},this.onMouseLeave=e=>{this.callerHovered=!1,this.timeouts.callerDisappear=setTimeout(()=>{this.callerHovered||this.hovered||this.update()},250)},this.onDropdownMouseEnter=()=>{"hover"===this.props.trigger&&(this.hovered=!0)},this.onDropdownMouseLeave=e=>{"hover"===this.props.trigger&&(this.hovered=!1,this.timeouts.disappear=setTimeout(()=>{this.callerHovered||this.hovered||this.update()},250))},this.onDocumentClick=e=>{!this.state.dropdown||this.state.dropdown.removed||this.el.contains(e.target)||this.update()},this.onResize=e=>{if(this.state.dropdown&&!this.state.dropdown.removed){var t=this.props,o=t.text,i=t.position,r=t.align,s=t.marginTop,a=t.marginLeft,c=Object(n.default)(this.el);this.update({text:o,position:i,align:r,rect:c,marginTop:s,marginLeft:a})}},this.onTransitionEnd=e=>{"visibility"===e.propertyName&&this.state.dropdown&&this.state.dropdown.removed&&this.setState({dropdown:void 0})},this.onItemClick=(e,t)=>{t.separator||(this.update(),t.onClick(e))},this.state={},this.timeouts={}}componentDidMount(){this.el=r.findDOMNode(this),"click"===this.props.trigger?(this.el.addEventListener("click",this.onClick),document.addEventListener("mousedown",this.onDocumentClick),window.addEventListener("resize",this.onResize)):(this.el.addEventListener("mouseenter",this.onMouseEnter),this.el.addEventListener("mouseleave",this.onMouseLeave))}componentWillUnmount(){Object.keys(this.timeouts).forEach(e=>{clearTimeout(this.timeouts[e])}),"click"===this.props.trigger?(this.el.removeEventListener("click",this.onClick),document.removeEventListener("mousedown",this.onDocumentClick),window.removeEventListener("resize",this.onResize)):(this.el.removeEventListener("mouseenter",this.onMouseEnter),this.el.removeEventListener("mouseleave",this.onMouseLeave)),this.defaultNode&&(this.defaultNode.parentNode.removeChild(this.defaultNode),delete this.defaultNode)}update(e){if(!e)return this.setState({dropdown:Object.assign({},this.state.dropdown,{removed:!0})});var t=e.position,o=e.align,i=e.rect,r=e.marginTop,s=e.marginLeft,n=i.left,a=i.top;switch(t){case"t":n+=.5*i.width;break;case"r":n+=i.width,a+=.5*i.height;break;case"b":n+=.5*i.width,a+=i.height;break;case"l":a+=.5*i.height}n=Math.round(n+s),a=Math.round(a+r),this.setState({dropdown:{position:t,align:o,x:n,y:a}})}renderDropdown(){if(!this.state.dropdown)return null;var e=this.state.dropdown,t=e.x,o=e.y,r=e.position,n=e.align,a=e.removed,c=Object(s.classNames)("Dropdown","Dropdown--"+r,{"Dropdown--removed":!!a,["Dropdown--align-"+n]:"t"===r||"b"===r},this.props.className);return i.createElement("div",{className:c,style:{top:o,left:t},onTransitionEnd:e=>this.onTransitionEnd(e),onMouseEnter:this.onDropdownMouseEnter,onMouseLeave:this.onDropdownMouseLeave},i.createElement("ul",{className:"Dropdown__in"},this.props.data.map((e,t)=>i.createElement("li",{className:Object(s.classNames)("Dropdown__item",{Dropdown__item_separator:e.separator}),onClick:t=>this.onItemClick(t,e),key:void 0!==e.id?e.id:t},e.text))))}render(){var e=this.renderDropdown();return e?(this.defaultNode||"undefined"==typeof window||(this.defaultNode=document.createElement("div"),document.body.appendChild(this.defaultNode)),i.createElement(i.Fragment,null,this.props.children,r.createPortal(e,this.defaultNode))):this.props.children}}a.defaultProps={position:"b",align:"center",marginTop:0,marginLeft:0,trigger:"click",className:""}},"BN/X":function(e,t,o){"use strict";o.r(t),o.d(t,"default",(function(){return a}));o("91GP"),o("ioFf"),o("rGqo"),o("Btvt");var i=o("q1tI"),r=(o("17x9"),o("ZxpX"));function s(){return(s=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var o=arguments[t];for(var i in o)Object.prototype.hasOwnProperty.call(o,i)&&(e[i]=o[i])}return e}).apply(this,arguments)}function n(e,t){if(null==e)return{};var o,i,r=function(e,t){if(null==e)return{};var o,i,r={},s=Object.keys(e);for(i=0;i<s.length;i++)o=s[i],t.indexOf(o)>=0||(r[o]=e[o]);return r}(e,t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(i=0;i<s.length;i++)o=s[i],t.indexOf(o)>=0||Object.prototype.propertyIsEnumerable.call(e,o)&&(r[o]=e[o])}return r}class a extends i.Component{render(){var e=this.props,t=e.hovered,o=e.className,a=e.children,c=n(e,["hovered","className","children"]),l=Object(r.classNames)("Link",{"Link--hovered":!!t},o);return this.props.href?i.createElement("a",s({},c,{className:l}),a):i.createElement("span",s({},c,{className:l}),a)}}a.defaultProps={href:void 0,hovered:!1}},F8uh:function(e,t,o){"use strict";o.r(t),o.d(t,"NarrativeEditorDataPanel",(function(){return u}));var i,r=o("q1tI"),s=o.n(r),n=o("6krn"),a=o("ZxpX"),c=o("4WSo"),l=o("UCWv"),d=(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])})(e,t)},function(e,t){function o(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(o.prototype=t.prototype,new o)}),u=function(e){function t(t){var o=e.call(this,t)||this;return o.getInputEl=function(){return o.nameInputRef&&o.nameInputRef.current},o.nameInputRef=s.a.createRef(),o}return d(t,e),t.prototype.render=function(){var e=this.props,t=e.name,o=e.onNameChange,i=e.selectedStoriesCount,r=e.coverUrl,d=e.onCoverClick,u=e.className,p=0===i,h="";return p||(h=Object(n.getLang)("stories_choose_cover")),s.a.createElement("div",{className:Object(a.classNames)("NarrativeEditorDataPanel",u)},s.a.createElement("div",{className:"NarrativeEditorDataPanel__preview"},s.a.createElement(c.NarrativeItemPreviewCover,{className:Object(a.classNames)("NarrativeEditorDataPanel__cover",{"NarrativeEditorDataPanel__cover--active":!p}),onClick:d,cover:r,title:h,extra:!p&&s.a.createElement("div",{className:"NarrativeEditorDataPanel__pencil"})}),s.a.createElement("span",{className:"NarrativeEditorDataPanel__name"},t||Object(n.getLang)("stories_narrative_name_full"))),s.a.createElement("div",{className:"NarrativeEditorDataPanel__form"},s.a.createElement("span",{className:"NarrativeEditorDataPanel__nameLabel"},Object(n.getLang)("stories_narrative_name")),s.a.createElement("input",{className:"NarrativeEditorDataPanel__nameInput",value:t,onChange:o,type:"text",placeholder:Object(n.getLang)("stories_enter_name"),maxLength:l.NARRATIVE_MAX_TITLE_LENGTH,ref:this.nameInputRef,autoFocus:!0}),i>0&&s.a.createElement("span",{className:"NarrativeEditorDataPanel__selectedStoryCount"},Object(n.getLang)("stories_selected_count",i))))},t}(s.a.Component)},FThC:function(e,t,o){"use strict";o.r(t),o.d(t,"noSpamPatterns",(function(){return i.noSpamPatterns})),o.d(t,"abortPatternMild",(function(){return i.abortPatternMild})),o.d(t,"noSpamSuspicious",(function(){return r})),o.d(t,"noSpamTemplates",(function(){return n})),o.d(t,"dealSingleSpamer",(function(){return a.dealSingleSpamer})),o.d(t,"reportsTime",(function(){return a.reportsTime})),o.d(t,"onFiltersChange",(function(){return a.onFiltersChange})),o.d(t,"rollbackDocMailSpamer",(function(){return l})),o.d(t,"rollbackDocWallSpamer",(function(){return d})),o.d(t,"rollbackJpgMailSpamer",(function(){return u})),o.d(t,"rollbackJpgWallSpamer",(function(){return p})),o.d(t,"rollbackPngMailSpamer",(function(){return h})),o.d(t,"rollbackPngWallSpamer",(function(){return _})),o.d(t,"rollbackDocSpamer",(function(){return m})),o.d(t,"rollbackPhotoSpamer",(function(){return v})),o.d(t,"rollbackPhotoSpamerFromWall",(function(){return f})),o.d(t,"rollbackPhotoSpamerFromMail",(function(){return g})),o.d(t,"rollbackVideoSpamer",(function(){return y})),o.d(t,"rollbackVideoSpamerFromWall",(function(){return b})),o.d(t,"rollbackVideoSpamerFromMail",(function(){return w})),o.d(t,"entityDecode",(function(){return k})),o.d(t,"selectText",(function(){return S})),o.d(t,"removeSelectedText",(function(){return j})),o.d(t,"getSelectedText",(function(){return E})),o.d(t,"selectValue",(function(){return O})),o.d(t,"blockDomain",(function(){return C})),o.d(t,"removeFidSearch",(function(){return T})),o.d(t,"banFidZero",(function(){return L})),o.d(t,"banFidForever",(function(){return B})),o.d(t,"isClaimContent",(function(){return x}));var i=o("uRA3"),r={selected:"ua_hash",updateOnSelect:function(){return r.getByType(r.selected)},getSpamType:function(){return isObject(this.spamtype)?this.spamtype._selected[0]:"wall"},getPeriod:function(){return isObject(this.period)?this.period._selected[0]:1},getByType:function(e){var t=ge("suspicious_table"),o=geByClass1("summary_tab_sel","suspicious_tabs"),i=isVisible("suspicious_tabs")?0:1,r=this;this.selected=e;var s=ge("suspicious_spamtype"),n=ge("suspicious_period"),a=geByClass("_suspicious_msg"),c=geByClass1("_suspicious_"+e+"_msg");each(a,(function(e,t){hide(t)})),show(c),"hashtags"==e?hide(s):show(s),"users"==e&&hide(s,n),i&&(t=ge("suspicious")),removeClass(o,"summary_tab_sel");var l={act:"a_get_suspicious",type:e,spamtype:this.getSpamType(),period:this.getPeriod(),need_tabs:i};addClass("suspicious_"+e,"summary_tab_sel"),ajax.post("noSpam.php",l,{onDone:function(e){if(!e)return topError(getLang("nospam_suspicious_data_error"));t.innerHTML=e,r.initInlineDropdown()},progress:"suspicious_progress"})},initInlineDropdown:function(){var e={withArrow:!0,keepTitle:!0,autoShow:!0,autoHide:300,onSelect:r.updateOnSelect},t=extend({items:cur.options.spamtypes,selected:"wall"},e),o=extend({items:[[1,"Один час"],[2,"Два часа"],[5,"5 часов"],[10,"10 часов"],[24,"Сутки"]],selected:1},e);this.spamtype||(this.spamtype=new InlineDropdown("suspicious_spamtype",t)),this.spamtype._els.valueEl.innerHTML=this.spamtype._selected[1],this.period||(this.period=new InlineDropdown("suspicious_period",o)),this.period._els.valueEl.innerHTML=this.period._selected[1]}},s=(o("pIFo"),o("Vd3H"),o("4Ch9")),n=function(e){this.selected=0,extend(this,e),this.templates=JSON.parse(e.templates)};n.prototype={addTemplate:function(){showBox("noSpam.php",{act:this.acts.add},{params:{width:430,dark:1,progress:"add_template"}})},saveTemplate:function(e){var t=cur[e],o=t.selected||0;if(ge("add_template_title")&&ge("add_template_text")){var i=trim(ge("add_template_title").value),r=trim(ge("add_template_text").value);if(!i)return notaBene("add_template_title");if(!r)return notaBene("add_template_text");var s={act:t.acts.save,title:i,text:r,hash:t.hash,template_id:o};ajax.post("noSpam.php",s,{onDone:function(e,o){var i=ge(t.links);i.innerHTML=e,hasClass(i,"template_links")||addClass(i,"template_links"),t.templates=JSON.parse(o),curBox().hide()},progress:o?"edit_template":"add_template"})}},editTemplate:function(){var e={act:this.acts.edit,template_id:this.selected,hash:this.hash};showBox("noSpam.php",e,{params:{width:430,dark:1,progress:"edit_template"}})},deleteTemplate:function(){var e=this;if(!this.selected)return!1;showFastBox({title:"Удаление шаблона",width:430,dark:1,progress:"delete_condition"},getLang("nospam_delete_template"),getLang("global_delete"),(function(){var t=e.selected,o={act:e.acts.remove,template_id:t,hash:e.hash};ajax.post("noSpam.php",o,{onDone:function(t,o){var i=ge(e.links);i.innerHTML=t,e.deselectTemplate(),e.templates=JSON.parse(o),isObject(e.templates)||removeClass(i,"template_links"),curBox().hide()},progress:"delete_condition"})}),getLang("global_cancel"))},selectTemplate:function(e){if(e){var t=this.templates[e];this.selected=e;var o=entityDecode(t.text);Object(s.setConditions)(o),this.label.innerHTML=t.title+": ",addClass(this.wrap,"template_selected")}},selectCommentTemplate:function(e){if(e){var t=this.templates[e];this.selected=e;var o=entityDecode(t.text);this.editComment(o),this.label.innerHTML=t.answer_name+": ",addClass(this.wrap,"template_selected")}},editComment:function(e){if(val(this.input,e),this.input.autosize)return this.input.autosize.update();autosizeSetup("comment_input",{minHeight:32})},getFromLocal:function(e){var t=localStorage.comments_templates_storage;ge("get_local_comments");try{t=JSON.parse(t)}catch(e){}return t?t&&e?(each(t,(function(e,t){var o=function(e,t){var o=ge("comment_template_links");hasClass(o,"template_links")||addClass(o,"template_links"),cur.comment.links.innerHTML=e,cur.comment.templates=JSON.parse(t)};setTimeout((function(){var e=t[1];ajax.post("noSpam.php",{act:"save_comment_template",title:e.name,text:e.comment,hash:opts.comment_hash,template_id:0},{onDone:o})}),1e3*e)})),curBox().hide()):void showBox("noSpam.php",{act:"apply_comments_export"},{params:{width:430,dark:1,progress:"export_progress"}}):showFastBox({title:"Перенос шаблонов",dark:1},"К сожалению, не удалось найти ни одного комментария.")},deselectTemplate:function(){var e=this.selected,t=this.templates[e];if(t){var o=entityDecode(this.templates[e].text);t&&this.input.value==o&&val(this.input,""),this.label.innerHTML=this.label_html,removeClass(this.wrap,"template_selected"),delete this.selected}},editSort:function(){var e={act:this.acts.sort,hash:this.hash};showBox("noSpam.php",e,{params:{width:430,dark:1,progress:"sort_template"}})},saveSort:function(e,t,o,i,r){var s=cur[e],n={hash:t,act:s.acts.sort_save,tid:o.id.replace("template",""),tpos:o.dataset.pos,after_id:i&&i.dataset?i.dataset.pos:"",before_id:r&&r.dataset?r.dataset.pos:""};ajax.post("noSpam.php",n,{onDone:function(e,t){box=curBox(),box.content(e[2]),box.evalBox(t),box.setOptions({onHide:function(){debugLog(e),s.links.innerHTML=e[0],s.templates=JSON.parse(e[1])}})},progress:"sort_template"})}};var a=o("b8yN");function c(e){var t=ge("console_item_"+e);hasClass(t,"green_item")&&removeClass(t,"green_item"),addClass(t,"red_item")}function l(e,t,o,i,r,s){ajax.post("noSpam.php",{act:"rollback_docmail_spamer",uid:e,hash:t,act_type:o,spam_date:i,to_id:r,to_msg_id:s},{onDone:function(t){ge("rollback_docmail_spamer"+e).innerHTML=t,c(e)}})}function d(e,t,o,i,r,s){ajax.post("noSpam.php",{act:"rollback_docwall_spamer",uid:e,hash:t,act_type:o,spam_date:i,owner_id:r,msg_id:s},{onDone:function(t){ge("rollback_docwall_spamer"+e).innerHTML=t,c(e)}})}function u(e,t,o,i,r,s){ajax.post("noSpam.php",{act:"rollback_jpgmail_spamer",uid:e,hash:t,act_type:o,spam_date:i,to_id:r,to_msg_id_id:s},{onDone:function(t){ge("rollback_jpgmail_spamer"+e).innerHTML=t,c(e)}})}function p(e,t,o,i,r,s){ajax.post("noSpam.php",{act:"rollback_jpgwall_spamer",uid:e,hash:t,act_type:o,spam_date:i,owner_id:r,msg_id:s},{onDone:function(t){ge("rollback_jpgwall_spamer"+e).innerHTML=t,c(e)}})}function h(e,t,o,i,r,s){ajax.post("noSpam.php",{act:"rollback_pngmail_spamer",uid:e,hash:t,act_type:o,spam_date:i,to_id:r,to_msg_id:s},{onDone:function(t){ge("rollback_pngmail_spamer"+e).innerHTML=t,c(e)}})}function _(e,t,o,i,r,s){ajax.post("noSpam.php",{act:"rollback_pngwall_spamer",uid:e,hash:t,act_type:o,spam_date:i,owner_id:r,msg_id:s},{onDone:function(t){ge("rollback_pngwall_spamer"+e).innerHTML=t,c(e)}})}function m(e,t,o,i,r,s){ajax.post("noSpam.php",{act:"rollback_doc_spamer",uid:e,hash:t,act_type:o,spam_date:i,owner_id:r,doc_id:s},{onDone:function(t){ge("rollback_doc_spamer"+e).innerHTML=t,c(e)}})}function v(e,t,o,i,r,s){ajax.post("noSpam.php",{act:"rollback_photo_spamer",uid:e,hash:t,act_type:o,spam_date:i,owner_id:r,photo_id:s},{onDone:function(t){ge("rollback_photo_spamer"+e).innerHTML=t,c(e)}})}function f(e,t,o,i,r,s){ajax.post("noSpam.php",{act:"rollback_photo_spamer_from_wall",uid:e,hash:t,act_type:o,spam_date:i,owner_id:r,msg_id:s},{onDone:function(t){ge("rollback_photo_spamer"+e).innerHTML=t,c(e)}})}function g(e,t,o,i,r,s){ajax.post("noSpam.php",{act:"rollback_photo_spamer_from_mail",uid:e,hash:t,act_type:o,spam_date:i,to_id:r,to_msg_id:s},{onDone:function(t){ge("rollback_photo_spamer"+e).innerHTML=t,c(e)}})}function y(e,t,o,i,r,s){ajax.post("noSpam.php",{act:"rollback_video_spamer",uid:e,hash:t,act_type:o,spam_date:i,owner_id:r,video_id:s},{onDone:function(t){ge("rollback_video_spamer"+e).innerHTML=t,c(e)}})}function b(e,t,o,i,r,s){ajax.post("noSpam.php",{act:"rollback_video_spamer_from_wall",uid:e,hash:t,act_type:o,spam_date:i,owner_id:r,msg_id:s},{onDone:function(t){ge("rollback_video_spamer"+e).innerHTML=t,c(e)}})}function w(e,t,o,i,r,s){ajax.post("noSpam.php",{act:"rollback_video_spamer_from_mail",uid:e,hash:t,act_type:o,spam_date:i,to_id:r,to_msg_id:s},{onDone:function(t){ge("rollback_video_spamer"+e).innerHTML=t,c(e)}})}function k(e){return se("<textarea>"+e+"</textarea>").value}function S(e){var t=document,o=t.getElementById(e);if(t.body.createTextRange)(i=t.body.createTextRange()).moveToElementText(o),i.select();else if(window.getSelection){var i,r=window.getSelection();(i=t.createRange()).selectNodeContents(o),r.removeAllRanges(),r.addRange(i)}}function j(){window.getSelection?window.getSelection().empty?window.getSelection().empty():window.getSelection().removeAllRanges&&window.getSelection().removeAllRanges():document.selection&&document.selection.empty()}function E(){var e="";return window.getSelection?e=window.getSelection():document.getSelection?e=document.getSelection():document.selection&&(e=document.selection.createRange().text),e}function O(e){var t=ge(e);return t.options[t.selectedIndex].value}function C(e,t,o,i){ajax.post("noSpam.php",{act:"a_block_domain",domain:e,type:t,hash:o,warn_users:isChecked("warn_users")||0,comment:ge("linksban_comment").value,link_ex:i},{onDone:function(o){ge("block_domain_1_"+e).innerHTML="",ge("block_domain_2_"+e).innerHTML="",ge("block_domain_3_"+e).innerHTML="",ge("block_domain_"+t+"_"+e).innerHTML=o}})}function T(e,t){ajax.post("noSpam.php",{act:"a_remove_fid_search",fid:e,hash:t},{onDone:function(t){ge("remove_fid_search_"+e).innerHTML=t}})}function L(e,t){ajax.post("noSpam.php",{act:"a_ban_fid_zero",fid:e,hash:t},{onDone:function(t){ge("ban_fid_zero_"+e).innerHTML=t}})}function B(e,t){ajax.post("noSpam.php",{act:"a_ban_fid_forever",fid:e,hash:t},{onDone:function(t){ge("ban_fid_forever_"+e).innerHTML=t}})}function x(){return window.nav&&window.nav.objLoc&&window.nav.objLoc.claim}},"FbC+":function(e,t,o){"use strict";o.r(t),o.d(t,"NarrativeEditorSelectPanel",(function(){return w}));var i,r=o("q1tI"),s=o.n(r),n=o("505V"),a=o("6krn"),c=o("ZO95"),l=o("gMX8"),d=o("c29r"),u=o("ZxpX"),p=o("UCWv"),h=o("4PuL"),_=(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])})(e,t)},function(e,t){function o(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(o.prototype=t.prototype,new o)}),m=p.MAX_NARRATIVE_STORIES,v=function(e){function t(t){var o=e.call(this,t)||this;return o.gridContainerRef=s.a.createRef(),o.gridRef=s.a.createRef(),o}return _(t,e),t.prototype.render=function(){var e=this,t=this.props,o=t.stories,i=t.appearance,r=t.selectedStoriesMap,a=t.selectType,c=t.className,p=t.onToggleCheck;return s.a.createElement(l.StoryArchiveGridContainer,{className:Object(u.classNames)("StoryArchiveDraggableGrid",c),appearance:i,ref:this.gridContainerRef},s.a.createElement("div",{className:"StoryArchiveDraggableGrid__inner",ref:this.gridRef},o.map((function(t){var o=e.isSelectable(t);return s.a.createElement("div",{className:Object(u.classNames)("StoryArchiveDraggableGrid__story","StoryArchiveDraggableGrid__story--"+i),key:t.rawId},s.a.createElement(d.StoryArchivePreview,{className:"StoryArchiveDraggableGrid__storyPreview",appearance:i,story:t,draggable:!0,disable:a===n.GridSelectType.checkbox&&!o,checked:!!r[t.rawId],selectable:o,onToggleCheck:p}))}))))},t.prototype.isSelectable=function(e){var t=this.props,o=t.selectType,i=t.selectedStoriesMap,r=Object.keys(i).length;return!e.isUnavailable&&(!(o!==n.GridSelectType.checkbox||!(r<m||i[e.rawId]))||!(o!==n.GridSelectType.radio||!i[e.rawId]))},t.prototype.componentDidMount=function(){var e=this,t=this.props,o=t.onReorder,i=t.appearance,r=this.gridRef.current,s=this.getScrollContainer(),a={dragThreshold:0,onReorder:function(){var t=e.props.stories,i=document.querySelectorAll(".StoryArchiveDraggableGrid__storyPreview"),r=[];i.forEach((function(e){var o=e.getAttribute("data-id"),i=t.find((function(e){return e.rawId===o}));i&&r.push(i)})),o(r)}};s&&r&&(i===n.EditorViewType.box&&(a.wrapNode=s),this.sorter=new h.default(r,"",a))},t.prototype.componentWillUnmount=function(){this.sorter&&this.sorter.destroy()},t.prototype.getScrollContainer=function(){var e,t;return null===(t=null===(e=this.gridContainerRef)||void 0===e?void 0:e.current)||void 0===t?void 0:t.getScrollContainer()},t.defaultProps={useWindowScroll:!1},t}(s.a.Component),f=o("UWqh"),g=function(){var e=function(t,o){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])})(t,o)};return function(t,o){function i(){this.constructor=t}e(t,o),t.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}(),y=function(){return(y=Object.assign||function(e){for(var t,o=1,i=arguments.length;o<i;o++)for(var r in t=arguments[o])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)},b=function(){for(var e=0,t=0,o=arguments.length;t<o;t++)e+=arguments[t].length;var i=Array(e),r=0;for(t=0;t<o;t++)for(var s=arguments[t],n=0,a=s.length;n<a;n++,r++)i[r]=s[n];return i},w=function(e){function t(t){var o=e.call(this,t)||this;return o.onTabClick=function(e,t){var i=o.props.selectedStories;o.setState({tabKey:t,selectedTabStories:b(i)})},o.onReorder=function(e){var t=o.props,i=t.selectedStoriesMap,r=t.onSelectedStoriesUpdate,s=e.filter((function(e){return i[e.rawId]}));o.setState({selectedTabStories:e}),r(s,i)},o.onStorySelectToggle=function(e){var t,i,r=o.props,s=r.selectedStories,a=r.selectedStoriesMap,c=r.onSelectedStoriesUpdate,l=o.state,d=l.selectedTabStories,u=l.tabKey;if(!d.length){var p=[e];return o.setState({selectedTabStories:p}),void c(p,(t={},t[e.rawId]=e,t))}var h=s.findIndex((function(t){return t.rawId===e.rawId}));if(~h){var _=b(s),m={};a[e.rawId]&&delete(m=y({},a))[e.rawId],_.splice(h,1),c(_,m)}else{_=[];var v=y(y({},a),((i={})[e.rawId]=e,i));if(u===n.TabKey.selected)_=d.filter((function(e){return v[e.rawId]}));else if(u===n.TabKey.all){if(~d.findIndex((function(t){return t.rawId===e.rawId})))_=d.filter((function(e){return v[e.rawId]}));else{var f=b(d,[e]);_=f.filter((function(e){return v[e.rawId]})),o.setState({selectedTabStories:f})}}c(_,v)}},o.state={tabKey:t.selectedStories.length?n.TabKey.selected:n.TabKey.all,selectedTabStories:b(t.selectedStories)},o}return g(t,e),t.prototype.render=function(){var e=this.props,t=e.selectedStories,o=e.appearance,i=e.selectedStoriesMap,r=e.stories,l=this.state,d=l.tabKey,p=l.selectedTabStories;return s.a.createElement("div",{className:"NarrativeEditorSelectPanel"},s.a.createElement(c.default,{className:"NarrativeEditorSelectPanel__tabs",onTabClick:this.onTabClick,active:d},s.a.createElement("span",{key:n.TabKey.selected},Object(a.getLang)("stories_narrative_editor_selected_tab"),t.length>0&&s.a.createElement("span",{className:"Tabs__desc"},t.length)),s.a.createElement("span",{key:n.TabKey.all},Object(a.getLang)("stories_narrative_editor_all_tab"))),d===n.TabKey.selected&&s.a.createElement(v,{className:Object(u.classNames)("NarrativeEditorSelectPanel__grid","NarrativeEditorSelectPanel__grid--"+o),appearance:o,stories:p,onReorder:this.onReorder,onToggleCheck:this.onStorySelectToggle,selectedStoriesMap:i,selectType:n.GridSelectType.checkbox}),d===n.TabKey.all&&s.a.createElement(f.StoryArchiveInfiniteGrid,{className:Object(u.classNames)("NarrativeEditorSelectPanel__grid","NarrativeEditorSelectPanel__grid--"+o),appearance:o,stories:r,onToggleCheck:this.onStorySelectToggle,selectedStoriesMap:i,selectType:n.GridSelectType.checkbox}))},t}(s.a.Component)},"Ht+d":function(e,t,o){"use strict";o.r(t);var i,r=o("q1tI"),s=o("ZxpX"),n=(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])})(e,t)},function(e,t){function o(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(o.prototype=t.prototype,new o)}),a=function(){return(a=Object.assign||function(e){for(var t,o=1,i=arguments.length;o<i;o++)for(var r in t=arguments[o])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)},c=function(e,t){var o={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(o[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(o[i[r]]=e[i[r]])}return o},l=function(){for(var e=0,t=0,o=arguments.length;t<o;t++)e+=arguments[t].length;var i=Array(e),r=0;for(t=0;t<o;t++)for(var s=arguments[t],n=0,a=s.length;n<a;n++,r++)i[r]=s[n];return i};var d=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n(t,e),t.prototype.render=function(){var e=this.props,t=e.className,o=e.appearance,i=e.wide,n=e.overflow,d=e.size,u=c(e,["className","appearance","wide","overflow","size"]),p=e.disabled,h=s.classNames.apply(void 0,l(["Button"],function(e){return Array.isArray(e)?e.map((function(e){return"Button--"+e})):["Button--"+e]}(o),["Button--size-"+d,{"Button--wide":i,"Button--overflow":!!n,"Button--disabled":p},t]));return r.createElement("button",a({},u,{className:h}),e.children)},t.defaultProps={appearance:"primary",size:"m",wide:!1,disabled:!1},t}(r.Component);t.default=d},KHCB:function(e,t,o){"use strict";o.r(t),o.d(t,"Stories",(function(){return Pt}));var i=o("q1tI"),r=o.n(i),s=o("i8i4"),n=o.n(s),a=o("zxIV"),c=o("t7n3"),l={},d={},u=[],p=!1,h=!1;function _(e,t,o){var i=d[e];if(i)for(var r=0;r<i.length;r++){var s=i[r];t?s.resolve(o):s.reject(),i.splice(r,1),r--}}function m(e){p&&p.postMessage({cmd:"load",url:e})}function v(e){return p||((p=new Worker("/js/cmodules/workers/stories_loader_worker.js")).onmessage=function(e){var t=e.data;switch(t.type){case"loaded":l[t.url]=t.data,_(t.url,!0,t.data);break;case"error":_(t.url,!1);break;case"inited":h=!0;for(var o=0;o<u.length;o++)m(u[o])}}),new Promise((function(t,o){if(e||t(""),l[e])return t(l[e]);switch(function(e){return e.match(/\.mp4/)?"video":e.match(/\.(png|jpg|jpeg|gif)/)?"image":void 0}(e)){case"video":case"image":d[e]||(d[e]=[]);var i=0===d[e].length;if(d[e].push({resolve:t,reject:o}),!i)return;h?m(e):u.push(e);break;default:window.vk.dev&&console.error("wrong media url")}}))}var f=!1;function g(e){var t;return f||(t=function(e){try{return e.contentDocument?e.contentDocument:e.contentWindow&&e.contentWindow.document?e.contentWindow.document:e.document}catch(e){}return!1}(window.utilsNode.appendChild(Object(a.ce)("iframe",{}))),f=t&&t.body?t.body:window.utilsNode.appendChild(Object(a.ce)("div",{},{display:"none"}))),e.match(/\.mp4/)?function(e){return new Promise((function(t,o){var i=Object(a.ce)("video",{});i.oncanplay=function(){t(),Object(a.re)(i)},i.onerror=function(){o(),Object(a.re)(i)},f.appendChild(i),i.src=e}))}(e):function(e){return new Promise((function(t,o){var i=Object(c.vkImage)();i.onload=function(){t(),Object(a.re)(i)},i.onerror=function(){o(),Object(a.re)(i)},f.appendChild(i),i.src=e}))}(e)}var y=function(){for(var e=0,t=0,o=arguments.length;t<o;t++)e+=arguments[t].length;var i=Array(e),r=0;for(t=0;t<o;t++)for(var s=arguments[t],n=0,a=s.length;n<a;n++,r++)i[r]=s[n];return i};function b(){var e=window.ls.get("video_volume");return"number"==typeof e?Math.min(1,Math.max(0,e)):1}function w(e){window.ls.set("video_volume",e)}function k(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var o=[];return y(e).forEach((function(e){if(e)switch(typeof e){case"string":o.push(e);break;case"object":Object.keys(e).forEach((function(t){e[t]&&o.push(t)}));break;default:o.push(String(e))}})),o.join(" ")}var S=o("ErRf"),j=o("Egk5"),E=[],O=function(){window.cur.storyLayer&&window.cur.storyLayer.onVisibilityChange()},C=function(){window.cur.storyLayer&&window.cur.storyLayer.onResize()},T=function(e){window.cur.storyLayer&&window.cur.storyLayer.onKeyDown(e)},L=function(e){window.cur.storyLayer&&window.cur.storyLayer.onKeyUp(e)};function B(e,t){window.cur.storyLayer&&window.cur.storyLayer.pauseLayer(),Object(a.ge)("stories_layers_background")||(document.body.appendChild(Object(a.ce)("div",{id:"stories_layers_background",className:"stories_layers_background"})),window.layerQueue.hide(),window.layerQueue.push(),window.layers.fullhide=N,Object(j.addEvent)(window,"visibilitychange",O,void 0,void 0,!0),Object(j.addEvent)(window,"resize",C),Object(j.addEvent)(document,"keydown",T),Object(j.addEvent)(document,"keyup",L)),window.cur.storyLayer=e,e.animateStory("expand",t.fromEl),E.push(e),e.length>1&&Object(a.addClass)(e.layerEl,"no_fill_bg"),Object(a.addClass)(document.body,"stories_layer_shown"),Object(S.cancelStackPush)("stories_layer_close"+E.length,(function(t){void 0===t&&(t={}),t.byTimer?e._sendNavigationStatEvents("close_auto_by_time"):e._sendNavigationStatEvents("close_tap"),E.length>1&&!t.isCloseBtnClick?e.back(!0):(e.hideAllLayers=t.isCloseBtnClick,e.hide(!1,!0))}))}function x(){E.length>1?E[E.length-2].setLayerVisibility(!0):Object(a.setStyle)("stories_layers_background","opacity",0)}function N(e){void 0===e&&(e=!1);for(var t=0;t<E.length;t++)E[t].hide(!0);if(window.layers.fullhide=!1,Object(a.removeClass)(document.body,"stories_layer_shown"),Object(a.re)("stories_layers_background"),Object(j.removeEvent)(window,"visibilitychange",O),Object(j.removeEvent)(window,"resize",C),Object(j.removeEvent)(document,"keydown",T),Object(j.removeEvent)(document,"keyup",L),e){var o=window.nav.objLoc;delete o.w,window.nav.setLoc(o)}window.cur.needUpdateFeedStories&&window.Stories.updateFeedStories(),E=[]}function I(){return E[E.length-2]}function M(e){for(var t=0;t<E.length;t++)E[t].onReplyDeleted(e)}window.LayersX=E;o("91GP"),o("pIFo"),o("17x9");var R=o("UCWv"),A=o("nAFc"),P=o("ZxpX"),D=o("6krn"),H=o("/PiP"),F=o("pp2G"),V=o("rEJs"),W=o("EasH"),K=o("Xrg9");function U(){return(U=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var o=arguments[t];for(var i in o)Object.prototype.hasOwnProperty.call(o,i)&&(e[i]=o[i])}return e}).apply(this,arguments)}class q extends i.Component{constructor(e){super(e),this.componentDidMount=()=>{var e=this.props,t=e.sticker,o=e.story;t.audioRestriction&&o.data.needMute&&o.video&&(o.video.muted=!0),this.playlist.on(this,V.events.ADDED,()=>{this.props.showMessage(Object(D.getLang)("stories_audio_added")),this.props.playStory()}),this.playlist.on(this,V.events.REMOVED,()=>{this.props.showMessage(Object(D.getLang)("stories_audio_deleted")),this.props.playStory()})},this.componentWillUnmount=()=>{this.playlist.off(this)},this.render=()=>{var e=this.props,t=e.story,o=e.sticker,r=t.data.needMute,s=o.audioRestriction,n=K.default.get("story_show_clickable_zones"),a=Object(P.classNames)("StorySticker",{"StorySticker--clickableZones":n});return i.createElement(i.Fragment,null,i.createElement("div",{className:a,style:this.getStickerStyle(),onClick:this.handleClick}),s&&r&&this.renderRestriction())},this.renderRestriction=()=>{var e=this.props.sticker.audioRestriction;return i.createElement("div",{className:"StoryRestriction"},i.createElement("div",{className:"StoryRestriction__inner"},i.createElement("span",{className:"StoryRestriction__title"},e.title),e.buttonUrl&&i.createElement("a",{className:"StoryRestriction__link",href:e.buttonUrl},e.buttonText)))},this.getStickerStyle=()=>{var e=this.props,t=e.sticker,o=e.originalWidth,i=e.originalHeight,r=e.widthViewBox,s=e.heightViewBox,n=r,a=s;return s/r>1.77?n=o*s/i:a=i*r/o,{top:t.top*a-(a-s)/2,left:t.left*n-(n-r)/2,width:t.width*n,height:t.height*a,transform:`rotate(${t.rotate}deg)`}},this.handleClick=e=>{switch(this.props.sticker.type){case R.StickerTypes.hashtag:this.handleClickHashtag(e);break;case R.StickerTypes.mention:this.handleClickMention(e);break;case R.StickerTypes.question:this.handleClickQuestion();break;case R.StickerTypes.place:this.handleClickPlace(e);break;case R.StickerTypes.music:this.handleClickMusic(e);break;case R.StickerTypes.marketItem:this.handleClickMarketItem(e);break;case R.StickerTypes.storyReply:this.handleClickStoryReply(e);break;case R.StickerTypes.owner:this.handleClickOwner(e);break;case R.StickerTypes.link:this.handleClickLink(e);break;case R.StickerTypes.post:this.handleClickPost(e);break;case R.StickerTypes.poll:this.handleClickPoll(e);break;case R.StickerTypes.app:this.handleClickApp()}},this.handleClickHashtag=e=>{var t=this.props.sticker.hashtag.replace("#","%23"),o=Object(D.getLang)("stories_show_hashtag_link"),r=i.createElement("a",{href:`/feed?q=${t}&section=search`,onClick:()=>this.onClickToTooltip("hashtag"),target:"_blank",className:"StoriesTooltip__link"},o);this.props.toggleTooltip(e,r),this.props.sendNavigationStatEvents("click_on_clickable_sticker",!0,{clickable_sticker:{id:this.props.sticker.id,type:"hashtag"}})},this.handleClickMention=e=>{var t=this.props.sticker,o=t.mentionedOwnerHref,r=t.mentionedText,s=t.mentionedPhotoUrl,n=i.createElement("a",{href:o,onClick:()=>this.onClickToTooltip("mention"),target:"_blank",className:"StoriesTooltip__link StoriesTooltip__link--mention"},i.createElement("div",{className:"StoriesTooltipMention"},i.createElement("div",{className:"StoriesTooltipMention__avatar",style:{backgroundImage:`url(${s})`}}),i.createElement("span",{className:"StoriesTooltipMention__text"},Object(A.decodeHTMLEntities)(r))));this.props.toggleTooltip(e,n),this.props.sendNavigationStatEvents("click_on_clickable_sticker",!0,{clickable_sticker:{id:this.props.sticker.id,type:"mention"}})},this.handleClickQuestion=()=>{this.props.showQuestionModal(),this.props.sendNavigationStatEvents("click_on_clickable_sticker",!0,{clickable_sticker:{id:this.props.sticker.id,type:"question"}})},this.handleClickPlace=e=>{var t=this.props,o=t.sticker,r=t.list,s=o.placeId,n=Object(D.getLang)("stories_go_to_place");if(layerQueue.count()||r.includes("archive")){var a="/feed?section=search&w=place"+s,c=i.createElement("a",{href:""+a,onClick:()=>this.onClickToTooltip("place"),target:"_blank",className:"StoriesTooltip__link"},n);this.props.toggleTooltip(e,c)}else{var l=i.createElement("div",{className:"StoriesTooltip__link",onClick:()=>{this.onClickToTooltip("place"),layerQueue.count()?layerQueue.pop():layerQueue.push(),Object(H.showWiki)({w:"place"+s})}},n);this.props.toggleTooltip(e,l)}this.props.sendNavigationStatEvents("click_on_clickable_sticker",!0,{clickable_sticker:{id:o.id,type:"place"}})},this.handleClickMusic=e=>{var t=this.props,o=t.story,r=t.sticker,s=o.data.needMute,n=r.audioId,a=r.audioData;if(r.audioRestriction)s||F.AudioUtils.showAudioRestriction(JSON.parse(a),{onShow:()=>{this.props.pauseStory()},onHide:()=>{this.props.playStory()}});else{var c="added"===(F.AudioUtils.getAddRestoreInfo()[n]||{}).state?"stories_audio_delete":"stories_audio_add",l=i.createElement("ul",{className:"StoriesTooltipActions _audio_row","data-audio":a},i.createElement("li",{className:"StoriesTooltipActions__item",onClick:this.addAudio},Object(D.getLang)(c)),i.createElement("li",{className:"StoriesTooltipActions__item",onClick:this.setNext},Object(D.getLang)("stories_audio_next_audio")));this.props.toggleTooltip(e,l,"b"),this.props.sendNavigationStatEvents("click_on_clickable_sticker",!0,{clickable_sticker:{id:r.id,type:"music"}})}},this.handleClickMarketItem=e=>{var t=this.props.sticker,o=t.photoUrl,r=t.link,s=t.isRestricted,n="market_item",a=s?{onClick:()=>{Object(W.showFastBox)(Object(D.getLang)("stories_market_access_error_title"),Object(D.getLang)("stories_market_access_error_text")),this.onClickToTooltip(n)}}:{onClick:()=>this.onClickToTooltip(n),href:r},c=i.createElement("a",U({},a,{target:"_blank",className:"StoriesTooltip__link"}),o&&!s?i.createElement("img",{className:"StoriesTooltip__marketItemThumb",src:o}):i.createElement("div",{className:"StoriesTooltip__marketItemThumb StoriesTooltip__marketItemThumb--stub"}),i.createElement("span",{className:"StoriesTooltip__marketItemText"},Object(D.getLang)("stories_go_to_market_item")));this.props.toggleTooltip(e,c),this.props.sendNavigationStatEvents("click_on_clickable_sticker",!0,{clickable_sticker:{id:this.props.sticker.id,type:n}})},this.handleClickStoryReply=e=>{var t=this.props,o=t.sticker,r=t.story,s=o.ownerId,n=o.storyId,a=(r.data.reply_to||{}).is_expired;if(a)this.handleClickOwner(e);else{var c=i.createElement("a",{className:"StoriesTooltip__link",onClick:()=>{window.showStory(`story${s}_${n}`),this.onClickToTooltip("story_reply")}},Object(D.getLang)("stories_go_to_story"));this.props.toggleTooltip(e,c),this.props.sendNavigationStatEvents("click_on_clickable_sticker",!0,{clickable_sticker:{id:o.id,type:"story_reply"}})}},this.handleClickOwner=e=>{var t=this.props.sticker,o=t.ownerId,r=t.link,s=o>0?Object(D.getLang)("stories_go_to_profile"):Object(D.getLang)("stories_go_to_group"),n=i.createElement("a",{href:r,target:"_blank",className:"StoriesTooltip__link"},s);this.props.toggleTooltip(e,n)},this.handleClickLink=e=>{var t=this.props.sticker,o=t.link,r=t.tooltipText,s=i.createElement("a",{href:o,onClick:()=>this.onClickToTooltip("link"),target:"_blank",className:"StoriesTooltip__link"},r);this.props.toggleTooltip(e,s),this.props.sendNavigationStatEvents("click_on_clickable_sticker",!0,{clickable_sticker:{id:this.props.sticker.id,type:"link"}})},this.handleClickPost=e=>{var t=this.props.sticker,o=t.postOwnerId,r=t.postId,s=Object(D.getLang)("stories_go_to_post"),n=i.createElement("a",{href:`/wall${o}_${r}`,onClick:()=>this.onClickToTooltip("post"),target:"_blank",className:"StoriesTooltip__link"},s);this.props.toggleTooltip(e,n),this.props.sendNavigationStatEvents("click_on_clickable_sticker",!0,{clickable_sticker:{id:this.props.sticker.id,type:"post"}})},this.handleClickPoll=e=>{var t=this.props.sticker.pollId;this.props.pauseStory(),showBox("al_voting.php",{act:"get_layout",voting_id:t,ref:"story",for_box:!0},{containerClass:"story_poll",params:{hideButtons:!0,width:510,onDestroy:()=>{this.props.playStory()}}}),this.props.sendNavigationStatEvents("click_on_clickable_sticker",!0,{clickable_sticker:{id:this.props.sticker.id,type:"poll"}})},this.handleClickApp=()=>{this.props.markAppNotificationsSeen(this.props.sticker),this.props.sendNavigationStatEvents("click_on_clickable_sticker",!0,{clickable_sticker:{id:this.props.sticker.id,type:"app"}})},this.addAudio=e=>{F.AudioUtils.addAudio(e.target,void 0,()=>{this.props.sendNavigationStatEvents("music_added",!0,{clickable_sticker:{id:this.props.sticker.id,type:"music"}})}),this.props.hideTooltip()},this.setNext=e=>{var t=JSON.parse(this.props.sticker.audioData||"{}"),o=F.AudioUtils.asObject(t);this.playlist.setNext(e.target.parentNode,o,t),this.playlist.pause(),this.props.hideTooltip(),this.props.playStory()},this.onClickToTooltip=e=>{this.props.sendNavigationStatEvents("click_to_tooltip",!0,{clickable_sticker:{id:this.props.sticker.id,type:e}})},this.playlist=Object(H.getAudioPlayer)()}}var z,G=function(e){var t=e.clientX,o=void 0===t?0:t,i=e.clientY,s=void 0===i?0:i,a=e.position,c=void 0===a?"t":a,l=e.layerEl,d=e.children,u=Object(P.classNames)("StoriesTooltip","StoriesTooltip--"+c);return r.a.createElement(r.a.Fragment,null,n.a.createPortal(r.a.createElement("div",{className:u,style:{top:s,left:o}},d),l))},X=o("6raB"),Y=o("0toi"),Q=o("Ht+d"),$=o("aFGQ"),J=o("FWc3"),Z=(z=function(e,t){return(z=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])})(e,t)},function(e,t){function o(){this.constructor=e}z(e,t),e.prototype=null===t?Object.create(t):(o.prototype=t.prototype,new o)}),ee=function(e){function t(t){var o=e.call(this,t)||this;o.componentDidMount=function(){window.addEventListener("resize",o.handleResize)},o.componentWillUnmount=function(){window.removeEventListener("resize",o.handleResize)},o.componentDidUpdate=function(){o.askTextarea.current&&o.askTextarea.current.focus()},o.onDisableAreaMouseDown=function(e){o.props.onMouseDownHandle(e.target)},o.onDisableAreaMouseUp=function(e){o.props.onMouseUpHandle(e.target)},o.render=function(){var e=o.props,t=e.story,r=e.storyData,s=e.author,n=e.layerEl,a=e.showMessage,c=e.playStory,l=e.pauseStory,d=e.list,u=e.sendNavigationStatEvents,p=e.markAppNotificationsSeen,h=r.clickable_stickers,_=h.stickers,m=h.original_width,v=h.original_height,f=o.state,g=f.widthViewBox,y=f.heightViewBox,b=f.showTooltip,w=f.position,k=f.tooltipContent,S=f.showQuestionModal,j=f.clientX,E=f.clientY;return i.createElement("div",{className:"StoryStickers"},i.createElement("div",{className:"StoryStickers__disableArea StoryStickers__disableArea--left",onMouseDown:o.onDisableAreaMouseDown,onMouseUp:o.onDisableAreaMouseUp}),i.createElement("div",{className:"StoryStickers__disableArea StoryStickers__disableArea--right",onMouseDown:o.onDisableAreaMouseDown,onMouseUp:o.onDisableAreaMouseUp}),_.map((function(e,r){return i.createElement(q,{story:t,sticker:e,originalWidth:m,originalHeight:v,widthViewBox:g,heightViewBox:y,toggleTooltip:o.toggleTooltip,sendNavigationStatEvents:u,hideTooltip:o.hideTooltip,showQuestionModal:o.showQuestionModal,markAppNotificationsSeen:p,showMessage:a,playStory:c,pauseStory:l,list:d,key:r})})),b&&i.createElement(G,{clientX:j,clientY:E,layerEl:n,position:w},k),S&&i.createElement(Y.default,{title:Object(D.getLang)("stories_question_ask_box_title").replace("{name}",Object(A.decodeHTMLEntities)(s.name_get)),actionButtons:o.getQuestionModalActions(),className:"StoryQuestionAskForm",onClose:o.closeQuestionModal,appearance:"blue"},i.createElement("div",{className:"StoryQuestionAskForm__inner"},i.createElement("textarea",{ref:o.askTextarea,className:"StoryQuestionAskForm__textarea",maxLength:80,placeholder:Object(D.getLang)("stories_question_ask_placeholder"),onChange:o.handleChange,onKeyDown:o.handleKeyDown}))))},o.handleResize=function(){var e=Object(a.getSize)(o.props.el),t=e[0],i=e[1];o.setState({widthViewBox:t,heightViewBox:i,showTooltip:!1})},o.toggleTooltip=function(e,t,i){void 0===i&&(i="t"),e.preventDefault(),e.stopPropagation();var r=e.clientX,s=e.clientY,n=o.props,a=n.pauseStory,c=n.playStory,l=n.hideFeedbackTooltip,d=n.sendNavigationStatEvents;l(),o.setState({showTooltip:!o.state.showTooltip,tooltipContent:t,clientX:r,clientY:s,position:i}),setTimeout((function(){o.state.showTooltip?(d("click_on_clickable_sticker"),a()):c()}),0)},o.hideTooltip=function(){o.setState({showTooltip:!1})},o.isShownTooltip=function(){return o.state.showTooltip||o.state.showQuestionModal},o.showQuestionModal=function(){var e=o.props,t=e.storyData,i=e.showMessage,r=e.pauseStory,s=e.onModalShownChange;if(!t.can_ask)return i(Object(D.getLang)("stories_question_forbidden"));o.setState({showQuestionModal:!0}),o.hideTooltip(),s(!0),r()},o.closeQuestionModal=function(){var e=o.props,t=e.playStory,i=e.onModalShownChange;o.setState({showQuestionModal:!1}),i(!1),t()},o.handleChange=function(e){o.setState({questionText:e.target.value})},o.handleKeyDown=function(e){var t=o.state.questionText;Object(c.trim)(t)&&"keydown"===e.type&&(e.ctrlKey||e.metaKey)&&e.keyCode==j.KEY.RETURN&&o.sendQuestion()},o.resetAskText=function(){o.setState({questionText:""})},o.getQuestionModalActions=function(){var e=o.props.storyData.can_ask_anonymous,t=o.state,r=t.isQuestionButtonLoading,s=t.questionText,n=[{value:R.QUESTION_SELECT_MODE.AUTHOR_ONLY,label:Object(D.getLang)("stories_question_select_author_only")},{value:R.QUESTION_SELECT_MODE.PUBLIC,label:Object(D.getLang)("stories_question_select_public")}];return e&&n.splice(1,0,{value:R.QUESTION_SELECT_MODE.ANONYMOUS,label:Object(D.getLang)("stories_question_select_anonymous")}),i.createElement("div",{className:"StoryQuestionAskForm__footer"},i.createElement("div",{className:"StoryQuestionAskForm__cell StoryQuestionAskForm__cell--select"},i.createElement($.default,{value:o.state.selected,options:n,onChange:o.onSelectChange,onShow:o.onSelectShow,onHide:o.onSelectHide})),i.createElement("div",{className:"StoryQuestionAskForm__cell"},i.createElement(Q.default,{key:"b",appearance:"tertiary",onClick:o.closeQuestionModal},Object(D.getLang)("global_cancel")),i.createElement(X.default,{key:"s",loading:r,disabled:!Object(c.trim)(s),onClick:o.sendQuestion},Object(D.getLang)("stories_question_reply_send"))))},o.onSelectChange=function(e){o.setState({selected:Number(e.selected.value)})},o.onSelectShow=function(){var e=o.props,t=e.storyData,i=e.author,r=t.can_ask_anonymous,s=document.querySelector(".StoryQuestionAskForm__cell--select");if(s){var n=r?"stories_question_about_user_tooltip":"stories_question_about_user_tooltip_without_anon",a=r?"stories_question_about_group_tooltip":"stories_question_about_group_tooltip_without_anon",c="";c=i.id>0?Object(D.getLang)(n).replace(/{name}/g,Object(A.decodeHTMLEntities)(i.firstName)):Object(D.getLang)(a),Object(J.showTooltip)(s,{text:c,width:350,slideX:15,className:"",nohide:!0,asrtl:!0,shift:[350,-15],dir:"left",showdt:1e3})}},o.onSelectHide=function(){var e=document.querySelector(".StoryQuestionAskForm__cell--select");e&&e.tt&&e.tt.destroy()},o.sendQuestion=function(){var e=o.state.questionText,t=o.props,i=t.showMessage,r=t.storyData,s=t.author,n=t.sendNavigationStatEvents,a=r.raw_id,c=r.askQuestionHash,l=r.accessKey,d=a.split("_"),u=d[0],p=d[1],h=!1,_=!1;o.state.selected===R.QUESTION_SELECT_MODE.PUBLIC?h=!0:o.state.selected===R.QUESTION_SELECT_MODE.ANONYMOUS&&(_=!0),window.ajax.post("al_stories.php",{act:"ask_question",story_owner_id:u,story_id:p,question_text:e,is_anonymous:+_,with_mention:+h,hash:c,access_key:l},{onDone:function(){switch(o.closeQuestionModal(),o.resetAskText(),i(Object(D.getLang)("stories_question_sent").replace("{name}",s.first_name_ins)),o.state.selected){case R.QUESTION_SELECT_MODE.PUBLIC:n("question_reply_publish");break;case R.QUESTION_SELECT_MODE.AUTHOR_ONLY:n("question_reply");break;case R.QUESTION_SELECT_MODE.ANONYMOUS:n("question_reply_anonymous")}},onFail:function(e){return o.closeQuestionModal(),o.resetAskText(),i(e),!0},showProgress:function(){return o.setState({isQuestionButtonLoading:!0})},hideProgress:function(){return o.setState({isQuestionButtonLoading:!1})}})};var r=Object(a.getSize)(o.props.el),s=r[0],n=r[1];return o.askTextarea=i.createRef(),o.state={widthViewBox:s,heightViewBox:n,clientX:0,clientY:0,showTooltip:!1,tooltipContent:"",position:"t",showQuestionModal:!1,isQuestionButtonLoading:!1,selected:R.QUESTION_SELECT_MODE.AUTHOR_ONLY,questionText:""},o}return Z(t,e),t}(i.Component),te=o("qrY5"),oe=o("RbYe"),ie=o("kcIO"),re=function(e){var t=e.story;if(t.getCurStoryData().hide_settings)return null;var o,i=function(e){var t=[],o=e.getCurStoryData(),i=o.raw_id,r=o.can_hide_reply,s=o.report_hash,n=o.can_remove,a=o.narrative,l=o.is_ads,d=o.canMarkNotInterested,u=e.data.can_blacklist,p=i.split("_").map((function(e){return Object(c.intval)(e)})),h=p[0],_=p[1];!u||a||l||t.push({label:Object(D.getLang)("stories_add_blacklist_button"),onClick:function(){return e._addToBlacklist()}});d&&t.push({label:Object(D.getLang)("stories_mark_not_interested"),onClick:function(t){var o,i=new MouseEvent("mouseout",{bubbles:!0});null===(o=t.nativeEvent.target)||void 0===o||o.dispatchEvent(i),e.markNotInterested()}});r&&t.push({label:Object(D.getLang)("stories_hide_reply_button"),onClick:function(){return e._hideReply()}});a&&(t.push({label:a.is_bookmarked?Object(D.getLang)("stories_narrative_remove_bookmark_button"):Object(D.getLang)("stories_narrative_add_bookmark_button"),onClick:function(){return e.sendNarrativeBookmarkButtonDidPress()}}),t.push({label:Object(D.getLang)("stories_narrative_copy_link"),onClick:function(){var e=location.protocol+"//"+location.host+"/narrative"+h+"_"+a.id+"_"+_;Object(oe.copyToClipboard)(e),Object(ie.showDoneBox)(Object(D.getLang)("stories_narrative_copy_link_done"))}}));a&&a.can_edit&&t.push({label:Object(D.getLang)("stories_narrative_edit_button"),onClick:function(){return e._sendNarrativeEditButtonDidPress()}});n&&e.getOwnerId()<0&&t.push({label:a?Object(D.getLang)("global_narrative_delete"):Object(D.getLang)("global_delete"),onClick:function(){return a?e.removeNarrativeBox():e.removeStoryBox()}});s&&t.push({label:Object(D.getLang)("stories_report"),onClick:function(){return e.report()}});h===window.vk.id||a||t.push({label:Object(D.getLang)("stories_settings"),onClick:function(){return window.Stories.showBlackList()}});return t}(t);if(0===i.length)return null;var s=r.a.createRef();return r.a.createElement("div",{className:"stories_button more ui_actions_menu_wrap _ui_menu_wrap ui_actions_menu_top stories_actions",onMouseEnter:function(e){clearTimeout(o),t.pauseStory(),te.default.show(s.current,e)},onMouseLeave:function(){te.default.hide(s.current),clearTimeout(o),o=setTimeout((function(){return t.autoResumeStory()}),300)},ref:s},r.a.createElement("div",{className:"ui_actions_menu _ui_menu"},i.map((function(e){var t=e.label,o=e.onClick;return r.a.createElement("div",{key:t,className:"ui_actions_menu_item",onClick:o},t)}))))};var se=o("PjZB"),ne=function(e){var t=e.title,o=e.subtitle,i=e.appearance,s=void 0===i?"preview":i;return r.a.createElement("div",{className:"InfoAside InfoAside--"+s},r.a.createElement("div",{className:"InfoAside__image"}),r.a.createElement("div",{className:"InfoAside__description"},r.a.createElement("span",{className:"InfoAside__title"},t),r.a.createElement("span",{className:"InfoAside__subtitle"},o)))},ae=o("As6E"),ce=o("TBLV");class le extends i.Component{constructor(e){super(e),this.componentDidMount=()=>{var e=this.questionTextEl.current;e&&this.adjustQuestionTextSize(e)},this.componentDidUpdate=()=>{this.replyTextareaEl.current&&this.replyTextareaEl.current.focus()},this.render=()=>{var e=this.state,t=e.isOpenReplyModal,o=e.replyText,r=e.isOpenReportModal,s=e.reportReasons,n=this.props,a=n.question,c=n.storyUrl,l=a.author,d=a.canAnswer,u=a.text,p=Object(A.decodeHTMLEntities)(u),h=Object(P.classNames)("StoryQuestion__title",{"StoryQuestion__title--free":!d});return i.createElement("div",{className:"StoryQuestion"},i.createElement("div",{className:"StoryQuestion__content"},this.renderAuthor(),i.createElement("span",{className:h,title:p,ref:this.questionTextEl},p)),i.createElement("div",{className:"StoryQuestion__controls"},d&&i.createElement(Q.default,{className:"StoryQuestion__reply",appearance:a.isPublished?"secondary":"primary",size:"s",wide:!0,onClick:this.openReplyModal},Object(D.getLang)("stories_question_reply"))),t&&i.createElement(Y.default,{title:Object(D.getLang)("stories_question_reply_box_title").replace("{name}",Object(A.decodeHTMLEntities)(l.nameDat)),actionButtons:this.getReplyModalActions(),className:"StoryQuestion__replyModal",onClose:this.closeReplyModal,appearance:"blue"},i.createElement("div",{className:"StoryQuestion__inner"},i.createElement("textarea",{ref:this.replyTextareaEl,className:"StoryQuestion__textarea",placeholder:Object(D.getLang)("stories_question_reply_placeholder"),onChange:this.handleChange,onKeyDown:this.handleKeyDown,value:o}),i.createElement("img",{srcSet:c,className:"StoryQuestion__image"}))),r&&i.createElement(Y.default,{title:Object(D.getLang)("stories_question_report_title"),actionButtons:this.getReportModalActions(),className:"StoryQuestionReportForm",onClose:this.closeReportModal,appearance:"blue"},i.createElement("div",{className:"StoryQuestionReportForm__content"},i.createElement("h4",{className:"StoryQuestionReportForm__title"},Object(D.getLang)("stories_question_report_reason")),i.createElement("div",{className:"StoryQuestionReportForm__items"},!s&&i.createElement(se.default,{size:15}),s&&s.map((e,t)=>i.createElement(ce.default,{key:e[0],name:"questionReport",value:e[0],defaultChecked:!t,onChange:()=>this.handleReason(e[0])},e[1]))))))},this.renderAuthor=()=>{var e=this.props.question,t=e.id,o=e.isAnonymous,r=e.author,s=Object(A.decodeHTMLEntities)(r.name);return i.createElement("div",{className:"StoryQuestion__header"},o&&i.createElement("span",{className:"StoryQuestion__author"},s),!o&&i.createElement("a",{href:r.link,className:"StoryQuestion__author",onClick:()=>cur.storyLayer._sendNavigationStatEvents("question_go_to_author",!0,{questionId:t})},s),i.createElement(ae.default,{position:"b",align:"right",trigger:"hover",data:this.getActions()},i.createElement("a",{className:"StoryQuestion__actions"})))},this.getActions=()=>{var e=this.props.question,t=this.state.isAuthorBan,o=[{text:Object(D.getLang)("stories_question_delete"),onClick:()=>this.props.removeQuestion(e)}];return e.canBlocked&&(t?o.push({text:Object(D.getLang)("stories_question_author_unban"),onClick:this.unbanAuthor}):o.push({text:Object(D.getLang)("stories_question_author_ban"),onClick:this.banAuthor}),o.push({text:Object(D.getLang)("stories_question_author_report"),onClick:this.openReportModal})),o},this.adjustQuestionTextSize=e=>{if(e.scrollHeight>e.offsetHeight){var t=getComputedStyle(e),o=parseInt(t.fontSize)-.5,i=o+2.5,r=Math.floor(parseInt(t.height)/i);o>10&&(e.setAttribute("style",`font-size: ${o}px; line-height: ${i}px; -webkit-line-clamp: ${r};`),setTimeout(()=>{this.adjustQuestionTextSize(e)},0))}},this.getReplyModalActions=()=>{var e=this.state,t=e.isReplyButtonLoading,o=e.replyText;return[i.createElement(Q.default,{key:"closeReplyModal",appearance:"tertiary",onClick:this.closeReplyModal},Object(D.getLang)("global_cancel")),i.createElement(X.default,{key:"replySend",loading:t,disabled:!Object(c.trim)(o),onClick:this.sendReply},Object(D.getLang)("stories_question_reply_send"))]},this.openReplyModal=()=>{this.setState({isOpenReplyModal:!0})},this.closeReplyModal=()=>{this.setState({isOpenReplyModal:!1})},this.handleChange=e=>{this.setState({replyText:e.target.value})},this.handleKeyDown=e=>{var t=this.state.replyText;Object(c.trim)(t)&&"keydown"===e.type&&(e.ctrlKey||e.metaKey)&&e.keyCode==KEY.RETURN&&this.sendReply()},this.resetReplyText=()=>{this.setState({replyText:""})},this.sendReply=()=>{var e=this.state.replyText,t=this.props,o=t.question,i=t.showMessage,r=o.text,s=o.id,n=o.ownerId,a=o.storyOwnerId,l=o.storyId,d=o.sendHash,u=`${e}\n\n🗣 ${Object(c.unclean)(r)}`,p=`story:${a}_${l}`;ajax.post("al_im.php",{act:"a_send",msg:u,hash:d,media:p,to:n},{onDone:()=>{this.closeReplyModal(),this.resetReplyText(),i(Object(D.getLang)("stories_answer_sent")),cur.storyLayer._sendNavigationStatEvents("question_send_message",!0,{questionId:s})},onFail:e=>(this.closeReplyModal(),this.resetReplyText(),i(e),!0),showProgress:()=>this.setState({isReplyButtonLoading:!0}),hideProgress:()=>this.setState({isReplyButtonLoading:!1})})},this.banAuthor=()=>{var e=this.props,t=e.question,o=e.showMessage,i=t.storyOwnerId,r=t.storyId,s=t.id,n=t.banHash,a=t.isAnonymous;ajax.post("al_stories.php",{act:"ban_author_question",story_owner_id:i,story_id:r,question_id:s,ban_hash:n},{onDone:()=>{this.setState({isAuthorBan:!0}),o(Object(D.getLang)("stories_question_author_blocked"));var e="question_ban_author";a&&(e="question_ban_anonymous_author"),cur.storyLayer._sendNavigationStatEvents(e,!0,{questionId:s})},onFail:e=>(o(e),!0)})},this.unbanAuthor=()=>{var e=this.props,t=e.question,o=e.showMessage,i=t.storyOwnerId,r=t.storyId,s=t.id,n=t.banHash;ajax.post("al_stories.php",{act:"unban_author_question",story_owner_id:i,story_id:r,question_id:s,ban_hash:n},{onDone:()=>{this.setState({isAuthorBan:!1}),o(Object(D.getLang)("stories_question_author_unblocked"))},onFail:e=>(o(e),!0)})},this.getReportModalActions=()=>{var e=this.state,t=e.isReportButtonLoading,o=e.reportReasons;return[i.createElement(Q.default,{key:"closeReplyModal",appearance:"tertiary",onClick:this.closeReportModal},Object(D.getLang)("global_cancel")),i.createElement(X.default,{key:"reportSend",disabled:!o,loading:t,onClick:this.sendReport},Object(D.getLang)("stories_question_report_send"))]},this.openReportModal=()=>{this.setState({isOpenReportModal:!0}),this.props.getReportReasons().then(e=>{this.setState({reportReasons:e})},e=>{this.closeReportModal(),this.props.showMessage(e)})},this.closeReportModal=()=>{this.setState({isOpenReportModal:!1})},this.handleReason=e=>{this.setState({selectReasons:e})},this.sendReport=()=>{var e=this.props.question,t=e.storyOwnerId,o=e.id,i=e.reportHash;ajax.post("al_stories.php",{act:"question_report",story_owner_id:t,question_id:o,reason:this.state.selectReasons,report_hash:i},{onDone:()=>{this.closeReportModal(),this.props.showMessage(Object(D.getLang)("stories_report_sent")),this.closeReportModal()},onFail:e=>(this.props.showMessage(e),this.closeReportModal(),!0),showProgress:()=>this.setState({isReportButtonLoading:!0}),hideProgress:()=>this.setState({isReportButtonLoading:!1})})},this.state={isAuthorBan:e.question.isOwnerBlocked,replyText:"",isOpenReplyModal:!1,isReplyButtonLoading:!1,isOpenReportModal:!1,isReportButtonLoading:!1,reportReasons:null,selectReasons:0},this.replyTextareaEl=i.createRef(),this.questionTextEl=i.createRef()}}var de=function(e){var t=e.title,o=e.additionalTitle;return r.a.createElement("div",{className:"FeedbackTitle"},r.a.createElement("span",{dangerouslySetInnerHTML:{__html:t}}),o&&r.a.createElement("span",{className:"FeedbackTitle__additional"},o))},ue=function(e){var t=e.title,o=e.additionalTitle,i=e.needSeparator,s=void 0===i||i,n=e.className,a=e.children;return r.a.createElement("div",{className:Object(P.classNames)("FeedbackBaseBlock",n,{"FeedbackSeparator FeedbackSeparator--top":s})},r.a.createElement(de,{title:t,additionalTitle:o}),a)},pe=function(){var e=function(t,o){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])})(t,o)};return function(t,o){function i(){this.constructor=t}e(t,o),t.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}(),he=function(e){function t(t){var o=e.call(this,t)||this;return o.componentDidMount=function(){var e=o.scrollElement.current;e&&e.addEventListener("wheel",o.questionsMouseWheel)},o.componentWillUnmount=function(){var e=o.positionElement.current;e&&e.removeEventListener("wheel",o.questionsMouseWheel)},o.questionsMouseWheel=function(e){e.preventDefault(),o.props.questions.items.length<=1||o.setPosition(Math.abs(e.deltaY)>Math.abs(e.deltaX)?e.deltaY:e.deltaX)},o.setPosition=function(e){var t=o.positionElement.current;if(t){var i=o.state.scrollBlockPosition,r=Object(a.getSize)(t)[0],s=Math.max(0,Math.min(i+e,t.scrollWidth-r));o.setState({scrollBlockPosition:s})}},o.removeQuestion=function(e){var t=e.storyOwnerId,i=e.storyId,r=e.id,s=e.removeHash;window.ajax.post("al_stories.php",{act:"remove_question",story_owner_id:t,story_id:i,question_id:r,remove_hash:s},{onDone:function(){o.props.sendNavigationStatEvents("question_delete",!0,{question_id:r}),o.props.questions.items.length?o.setPosition(0):o.props.onQuestionRemove(r)}})},o.getReportReasons=function(){return new Promise((function(e,t){o.reportReasons.length?e(o.reportReasons):window.ajax.post("al_stories.php",{act:"question_report_box"},{onDone:function(t){return o.reportReasons=t,e(o.reportReasons),!0},onFail:function(e){return t(e),!0}})}))},o.state={scrollBlockPosition:0},o.reportReasons=[],o.scrollElement=i.createRef(),o.positionElement=i.createRef(),o}return pe(t,e),t.prototype.render=function(){var e=this,t=this.props.questions,o=this.state.scrollBlockPosition,r=t.items;return i.createElement(ue,{className:"FeedbackQuestionsBlock",title:t.title},i.createElement("div",{className:"FeedbackQuestionsBlock__questions"},i.createElement("div",{className:"FeedbackQuestionsBlock__wrapper",ref:this.scrollElement},i.createElement("div",{className:"FeedbackQuestionsBlock__items",style:{transform:"translateX(-"+o+"px)"},ref:this.positionElement},r.map((function(t,o){return i.createElement(le,{question:t,storyUrl:e.props.storyUrl,showMessage:e.props.showMessage,removeQuestion:e.removeQuestion,getReportReasons:e.getReportReasons,key:o})}))))))},t}(i.Component),_e=o("BN/X"),me=function(e){var t=e.stats,o=e.extendedStats,i=e.onExtendedStatsPreviewClick,s=e.onSettingsBtnClick,n=e.onPrivacyHintHide;return r.a.createElement(ue,{className:"FeedbackStatsBlock",title:t.title},t.cells&&r.a.createElement("div",{className:"FeedbackTooltip__cells"},t.cells.map((function(e,t){return r.a.createElement("div",{className:"FeedbackTooltip__cell",key:t},r.a.createElement("div",{className:"FeedbackStatCounter",dangerouslySetInnerHTML:{__html:e.counter}}),r.a.createElement("div",{className:"FeedbackStatName"},e.name))}))),o&&r.a.createElement("div",{className:"FeedbackStatsBlock__extendedStatsPreview FeedbackSeparator FeedbackSeparator--top",onClick:i,role:"button"},r.a.createElement(ne,{appearance:"preview",title:Object(D.getLang)("stories_detailed_stats"),subtitle:o.preview}),r.a.createElement("div",{className:"FeedbackStatsBlock__chevron"})),t.showPrivacyHint&&r.a.createElement("div",{className:"FeedbackStatsBlock__privacyHint FeedbackSeparator FeedbackSeparator--top"},Object(D.getLang)("stories_privacy_feedback_hint"),r.a.createElement("div",{className:"FeedbackStatsBlock__links"},r.a.createElement(_e.default,{href:"/settings?act=privacy",onClick:s},Object(D.getLang)("stories_go_to_settings")),r.a.createElement("span",{className:"dvd"}),r.a.createElement(_e.default,{onClick:n},Object(D.getLang)("global_hide_notify")))),t.showEmptyStatsPrivacyHint&&r.a.createElement("div",{className:"FeedbackStatsBlock__emptyStatsPrivacyHint"},r.a.createElement("div",{className:"FeedbackStatsBlock__emptyStatsPrivacyIcon"}),r.a.createElement("div",{className:"FeedbackStatsBlock__emptyStatsPrivacyText"},Object(D.getLang)("stories_privacy_empty_views_hint")),r.a.createElement("div",{className:"FeedbackStatsBlock__emptyStatsPrivacyLink"},r.a.createElement(_e.default,{href:"/settings?act=privacy",onClick:s},Object(D.getLang)("stories_go_to_settings")))))},ve=o("XuKo");function fe(e){return e.items.some((function(e){return e.unread}))}var ge,ye=function(e){var t=e.storyPack,o=e.listName,i=e.source;return r.a.createElement("a",{href:t.author.href,className:Object(P.classNames)("StoryReply",{"StoryReply--new":fe(t)}),onClick:function(e){e.metaKey||e.ctrlKey||(Object(ve.showStory)(t.author.id+"/"+o,{fromEl:e.target,source:i}),e.preventDefault())},role:"button"},r.a.createElement("div",{className:"StoryReply__avatar"},r.a.createElement("div",{className:"StoryReply__image",style:{backgroundImage:"url("+t.author.photo+")"}})),r.a.createElement("div",{className:"StoryReply__caption"},t.author.firstName))},be=o("4+be"),we=function(e){var t=e.replies,o=e.showMore,i=t.list,s=Boolean(t.moreRepliesCount);return r.a.createElement(ue,{className:"FeedbackRepliesBlock",title:t.title,additionalTitle:t.additionalTitle},r.a.createElement("div",{className:"FeedbackRepliesBlock__replies"},null==i?void 0:i.map((function(e){return r.a.createElement(ye,{storyPack:e,listName:t.listName,source:t.source,key:e.author.id})}))),s&&r.a.createElement(Q.default,{className:"FeedbackRepliesBlock__showMore",appearance:"tertiary",onClick:o},Object(be.langNumeric)(Object(D.getLang)("stories_replies_more_button",t.moreRepliesCount))))};!function(e){e.photo="photo",e.gradient="gradient",e.default="default"}(ge||(ge={}));function ke(e){var t="";if(e.type===ge.photo)t="#"+e.backgroundColor;else if(e.type===ge.gradient){t="linear-gradient("+(e.angle-90)+"deg, "+e.points.map((function(e){return"#"+e.color+" "+Math.round(100*e.position)+"%"})).join(", ")+")"}return t}function Se(e){var t=e.ownerId,o=e.pollId;if(e.needShowResults)Object(H.showWiki)({w:"poll"+t+"_"+o},!1,void 0,{customRef:"story"});else{var i={act:"get_layout",voting_id:o,ref:"story",for_box:!0};Object(W.showBox)("al_voting.php",i,{containerClass:"story_poll",params:{hideButtons:!0,width:510}})}}var je=function(e){var t=e.poll,o=function(e){var t=e.background;return r.a.createElement("div",{className:"PollSnippet__background",style:{background:ke(t)}},t.type===ge.photo&&r.a.createElement("div",{className:"PollSnippet__photo",style:{backgroundImage:"url("+t.photoUrl+")"}}))}(t);return r.a.createElement("div",{className:Object(P.classNames)("PollSnippet",{"PollSnippet--default":t.background.type===ge.default})},o,r.a.createElement("div",{className:"PollSnippet__question"},t.question),r.a.createElement("div",{className:"PollSnippet__countVoters"},t.votersCountText),r.a.createElement("div",{className:"PollSnippet__showResult",onClick:Se.bind(null,t)},Object(D.getLang)("stories_voting_show_result")))},Ee=function(e){var t=e.poll;return r.a.createElement(ue,{className:"FeedbackPollBlock",title:t.title},r.a.createElement("div",{className:"FeedbackPollBlock__poll"},r.a.createElement(je,{poll:t.data})))},Oe=o("7hRE");o("ioFf"),o("rGqo"),o("Btvt");function Ce(){return(Ce=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var o=arguments[t];for(var i in o)Object.prototype.hasOwnProperty.call(o,i)&&(e[i]=o[i])}return e}).apply(this,arguments)}function Te(e,t){if(null==e)return{};var o,i,r=function(e,t){if(null==e)return{};var o,i,r={},s=Object.keys(e);for(i=0;i<s.length;i++)o=s[i],t.indexOf(o)>=0||(r[o]=e[o]);return r}(e,t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(i=0;i<s.length;i++)o=s[i],t.indexOf(o)>=0||Object.prototype.propertyIsEnumerable.call(e,o)&&(r[o]=e[o])}return r}var Le=e=>{var t=e.verifiedText,o=e.className,r=Te(e,["verifiedText","className"]);return i.createElement("div",Ce({className:Object(P.classNames)("VerifiedMarker",o)},r,{"aria-label":t}),i.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 12 12",className:"VerifiedMarker__icon","aria-hidden":"true"},i.createElement("path",{fill:"none",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M2.25 6.75L4.5 9l5.25-5.25"})))},Be=o("LkN3"),xe=e=>{var t=e.children,o=e.isVerified,r=e.verifiedText,s=e.className;return i.createElement("div",{className:Object(P.classNames)("OwnerName",s)},i.createElement(Be.default,null,t),!!o&&i.createElement(Le,{verifiedText:r,className:"OwnerName__verified"}))};xe.defaultProps={isVerified:!1,verifiedText:""};var Ne,Ie=xe,Me=function(e){var t=e.user;return r.a.createElement("a",{href:t.url,className:"Viewer",role:"button"},r.a.createElement(Oe.default,{className:Object(P.classNames)("Viewer__avatar",{"Viewer__avatar--isLiked":t.isLiked}),title:t.name,photo:t.photoUrl}),r.a.createElement(Ie,{className:"Viewer__name",isVerified:t.isVerified},Object(A.decodeHTMLEntities)(t.name)))},Re=function(e){var t=e.viewers,o=e.isLoading,i=void 0!==o&&o,s=e.needSeparator,n=void 0===s||s;return r.a.createElement(ue,{className:"FeedbackViewersBlock",title:t.title,needSeparator:n},t.hiddenReason&&r.a.createElement("span",{className:"FeedbackViewersBlock__hiddenReason"},t.hiddenReason),r.a.createElement("div",{className:"FeedbackViewersBlock__items"},t.items.map((function(e,t){return r.a.createElement(Me,{user:e,key:t})}))),i&&r.a.createElement("div",{className:"FeedbackViewersBlock__spinner"},r.a.createElement(se.default,{size:18,color:"#6590c7",strokeWidth:2})))},Ae=o("BJj/"),Pe=function(){var e=function(t,o){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])})(t,o)};return function(t,o){function i(){this.constructor=t}e(t,o),t.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}(),De=function(e){function t(t){var o=e.call(this,t)||this;return o.onQuestionRemove=function(e){o.props.onQuestionRemove(e)},o.close=function(){o.props.toggleFeedbackTooltip(!1)},o.onSettingsBtnClick=function(){o.props.sendNavigationStatEvents("go_to_settings")},o.onPrivacyHintHide=function(){o.props.onPrivacyHintHide()},o.onExtendedStatsPreviewClick=function(){var e=o.props.sendNavigationStatEvents;o.unObserveViewerScroll(),o.unObserveTitleChanges(),o.setState({extendedStatsActive:!0}),e("open_advanced_statistic")},o.onBackBtnClick=function(){o.unObserveTitleChanges(),o.setState({extendedStatsActive:!1})},o.state={isViewersLoading:!1,extendedStatsActive:!1},o.mounted=!1,o.scrollContainerRef=r.a.createRef(),o.viewsSentinelRef=r.a.createRef(),o.titles=[],o.viewsObserver=null,o.activeHeader=null,o.onScrollHandler=null,o}return Pe(t,e),t.prototype.render=function(){var e=this.props,t=e.feedback,o=e.showMessage,i=e.sendNavigationStatEvents,s=e.storyImageUrl,n=e.showMoreReplies,a=e.needShowEmptyStats,c=this.state,l=c.isViewersLoading,d=c.extendedStatsActive,u=null==t?void 0:t.stats,p=null==u?void 0:u.extendedStats,h=null==t?void 0:t.replies,_=null==t?void 0:t.poll,m=null==t?void 0:t.questions,v=null==t?void 0:t.viewers;return r.a.createElement("div",{className:Object(P.classNames)("FeedbackTooltip",{"FeedbackTooltip--empty":a}),onClick:function(e){return e.stopPropagation()}},r.a.createElement("div",{className:"FeedbackTooltip__wrapper"},r.a.createElement("div",{className:"FeedbackTooltip__close",onClick:this.close}),!t&&r.a.createElement("div",{className:"FeedbackTooltip__spinner"},r.a.createElement(se.default,{size:36,color:"#6590c7",strokeWidth:3})),t&&r.a.createElement(r.a.Fragment,null,!d&&r.a.createElement("div",{className:"FeedbackTooltip__inner",ref:this.scrollContainerRef},r.a.createElement("div",{className:"FeedbackTooltip__content"},u&&r.a.createElement(me,{stats:u,extendedStats:p,onExtendedStatsPreviewClick:this.onExtendedStatsPreviewClick,onSettingsBtnClick:this.onSettingsBtnClick,onPrivacyHintHide:this.onPrivacyHintHide}),h&&r.a.createElement(we,{replies:h,showMore:n}),_&&r.a.createElement(Ee,{poll:_}),m&&r.a.createElement(he,{showMessage:o,storyUrl:s,questions:m,sendNavigationStatEvents:i,onQuestionRemove:this.onQuestionRemove}),v&&r.a.createElement(Re,{viewers:v,isLoading:l,needSeparator:!t.questions}),Boolean(null==v?void 0:v.nextFrom)&&r.a.createElement("div",{className:"FeedbackTooltip__sentinel",ref:this.viewsSentinelRef}))),p&&d&&r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"FeedbackTooltip__header FeedbackSeparator FeedbackSeparator--bottom"},r.a.createElement("div",{className:"FeedbackTooltip__back",onClick:this.onBackBtnClick},Object(D.getLang)("global_back")),Object(D.getLang)("stories_detailed_stats")),r.a.createElement("div",{className:"FeedbackTooltip__inner",ref:this.scrollContainerRef},r.a.createElement("div",{className:"FeedbackTooltip__content"},p.achievement&&r.a.createElement("div",{className:"FeedbackTooltip__achievement"},r.a.createElement(ne,{appearance:"achievement",title:p.achievement,subtitle:p.achievementSubtitle})),p.categories.map((function(e,t){return r.a.createElement(ue,{title:e.title,key:t},r.a.createElement("div",{className:"FeedbackTooltip__lines"},e.lines.map((function(e,t){return r.a.createElement("div",{className:"FeedbackTooltip__line",key:t},r.a.createElement("div",{className:"FeedbackStatName"},Object(A.decodeHTMLEntities)(e.name)),r.a.createElement("div",{className:"FeedbackStatCounter",dangerouslySetInnerHTML:{__html:e.counter}}))}))))}))))))))},t.prototype.componentDidMount=function(){var e=this,t=this.props,o=t.feedback,i=t.storyRawId,r=t.onFetchFeedbackData;if(this.mounted=!0,o)return this.observeTitleChanges(),void this.observeViewerScrollIfNeeded();window.ajax.post("al_stories.php",{act:"get_feedback",story_raw:i},{onDone:function(t){e.mounted&&r(t)},onFail:function(){return Object(W.showFastBox)(Object(D.getLang)("global_error"),Object(D.getLang)("global_unknown_error")),e.close(),!0}})},t.prototype.componentDidUpdate=function(e,t){!e.feedback&&this.props.feedback&&(this.observeTitleChanges(),this.observeViewerScrollIfNeeded()),!t.extendedStatsActive&&this.state.extendedStatsActive?this.observeTitleChanges():t.extendedStatsActive&&!this.state.extendedStatsActive&&(this.observeTitleChanges(),this.observeViewerScrollIfNeeded())},t.prototype.componentWillUnmount=function(){this.unObserveTitleChanges(),this.unObserveViewerScroll(),this.mounted=!1},t.prototype.loadViewers=function(){var e,t=this,o=this.props,i=o.storyRawId,r=o.feedback,s=o.onFetchViewers;this.state.isViewersLoading||(null===(e=null==r?void 0:r.viewers)||void 0===e?void 0:e.nextFrom)&&(this.setState({isViewersLoading:!0}),window.ajax.post("al_stories.php",{act:"get_viewers",story_raw:i,offset:r.viewers.nextFrom},{onDone:function(e){s(e),t.setState({isViewersLoading:!1})},onFail:function(){return Object(W.showFastBox)(Object(D.getLang)("global_error"),Object(D.getLang)("global_unknown_error")),t.setState({isViewersLoading:!1}),!0}}))},t.prototype.observeViewerScrollIfNeeded=function(){var e,t=this,o=this.props.feedback;if(null===(e=null==o?void 0:o.viewers)||void 0===e?void 0:e.nextFrom){var i=this.scrollContainerRef.current,r=this.viewsSentinelRef.current;if(!r)return;this.viewsObserver=new IntersectionObserver((function(e){e.forEach((function(e){e.intersectionRatio>0&&t.loadViewers()}))}),{threshold:[0,1],root:i,rootMargin:"0px 0px 336px 0px"}),this.viewsObserver.observe(r)}},t.prototype.unObserveViewerScroll=function(){this.viewsObserver&&this.viewsObserver.disconnect()},t.prototype.observeTitleChanges=function(){var e=this,t=this.scrollContainerRef.current;t&&(this.updateTitles(),this.onScrollHandler=Object(Ae.debounce)((function(){!e.titles.some((function(t,o){if(t.offsetTop)return t===e.activeHeader||e.setActiveHeader(t),!0;if(e.titles[o+1]){var i=e.titles[o+1],r=e.titles[o+1].parentElement,s=r&&r.offsetHeight;return!!s&&(i.offsetTop+i.offsetHeight===s&&(t===e.activeHeader||e.setActiveHeader(t),!0))}return!1}))&&e.activeHeader&&(e.activeHeader.classList.remove("FeedbackTitle--active"),e.activeHeader=null)}),5),t.addEventListener("scroll",this.onScrollHandler))},t.prototype.updateTitles=function(){var e=this.scrollContainerRef.current;e&&(this.titles=Array.from(e.querySelectorAll(".FeedbackTitle")),this.titles.reverse())},t.prototype.unObserveTitleChanges=function(){this.scrollContainerRef.current&&this.onScrollHandler&&this.scrollContainerRef.current.removeEventListener("scroll",this.onScrollHandler),this.onScrollHandler=null,this.titles=[]},t.prototype.setActiveHeader=function(e){this.activeHeader&&this.activeHeader.classList.remove("FeedbackTitle--active"),this.activeHeader=e,e.classList.add("FeedbackTitle--active")},t}(r.a.Component),He=o("pQ8y"),Fe=function(e){var t=e.story,o=t.getReplies(),i=t.getViews()||"",s=t.getCurStoryData(),n=s.can_manage,a=s.isNewQuestions,c=s.needShowEmptyStats,l=s.small_preview,d=!(!n||!i&&!c),u=t.isActiveLive(),p=t.getRawId(),h=t.isFeedbackTooltipShow,_=t.toggleFeedbackTooltip,m=t.onFetchFeedbackData,v=t.onFetchViewers,f=t.onQuestionRemove,g=t.feedback,y=t.showMoreReplies,b=t.onPrivacyHintHide;if(u||!i&&!o&&!c)return null;var w=t._showMessage.bind(t),k=t.layer._sendNavigationStatEvents.bind(t.layer),S="stories_button views _views_button";return(c||a)&&(S+=" stories_button_new_notify "+(a?"stories_button_new_questions":"stories_button_new_hint")),r.a.createElement("div",{className:S,onClick:function(e){_(),c&&k("open_empty_feedback"),e.stopPropagation()}},o&&r.a.createElement("div",{className:"stories_button_replies"},o),d&&r.a.createElement("div",{className:"stories_button_views"},i),r.a.createElement(He.default,{in:h,timeout:200,classNames:{enter:"FeedbackTooltipTransitionWrapper--enter",enterActive:"FeedbackTooltipTransitionWrapper--enterActive",exit:"FeedbackTooltipTransitionWrapper--exit",exitActive:"FeedbackTooltipTransitionWrapper--exitActive"},unmountOnExit:!0},r.a.createElement(De,{feedback:g,storyRawId:p,storyImageUrl:l,toggleFeedbackTooltip:_,onFetchFeedbackData:m,onFetchViewers:v,showMessage:w,sendNavigationStatEvents:k,onQuestionRemove:f,showMoreReplies:y,onPrivacyHintHide:b,needShowEmptyStats:c})))},Ve=o("vzBJ"),We=function(e){var t=e.className,o=e.stickers,i=e.onStickerClick,s=function(e){Ve.StickersAnimation.loadAndPlaySticker(e.currentTarget)};return r.a.createElement("div",{className:Object(P.classNames)("ReactionsPanel",t)},r.a.createElement("div",{className:"ReactionsPanel__container"},r.a.createElement("div",{className:"ReactionsPanel__title"},Object(D.getLang)("stories_reactions_title")),r.a.createElement("div",{className:"ReactionsPanel__items"},o.map((function(e,t){return function(e,t){var o=!!e.animationUrl?"sticker_img":"";return r.a.createElement("div",{className:"ReactionsPanel__item","data-pack-id":e.packId,"data-sticker-id":e.id,"data-uniq-id":e.uniqId,"data-animation-path":e.animationUrl,onMouseDown:function(){return i(e.id,t)},onMouseEnter:s,key:e.id},r.a.createElement("div",{className:Object(P.classNames)("ReactionsPanel__itemImage",o),style:{backgroundImage:"url("+e.imageUrl+")"}}))}(e,t)})))))},Ke=o("TxR4"),Ue=o("W9Tc"),qe=o("L7cl"),ze=o("o7bv"),Ge=o("HLtZ"),Xe=function(){var e=function(t,o){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])})(t,o)};return function(t,o){function i(){this.constructor=t}e(t,o),t.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}(),Ye=function(){return(Ye=Object.assign||function(e){for(var t,o=1,i=arguments.length;o<i;o++)for(var r in t=arguments[o])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)},Qe=function(e){function t(t){var o=e.call(this,t)||this;return o._onReactionClick=function(e,t){o._sendMessage([["sticker",e,""]],{sticker_referrer:"story_reaction"},{reactionName:R.EMOJI_REACTIONS_ARR[t].name})},o.addToNarrativePress=function(){o.props.story.onAddToNarrativeBtnClick()},o.emojiId=!1,o.state={story:t.story,sendFormHasText:!1,sendFormFocused:!1,linkObjectAudioPlaying:!1,isReactionsPanelShow:!1,reactionStickers:o._getReactionsStickers(),needAnimateLikeButton:!1},o.addToNarrativeRef=i.createRef(),o}return Xe(t,e),t.prototype.componentDidMount=function(){this.checkFeatureTooltip(),this.emojiInit()},t.prototype.checkFeatureTooltip=function(){var e=this.addToNarrativeRef.current;e&&this.props.story.showFeatureTooltipIfNeed(e)},t.prototype.componentWillUnmount=function(){this.emojiId&&(window.Emoji.destroy(this.emojiId),delete this.emojiId,window.cur.reactionFeatureTooltipTimeoutId&&(clearTimeout(window.cur.reactionFeatureTooltipTimeoutId),window.cur.reactionFeatureTooltipTimeoutId=null))},t.prototype.componentDidUpdate=function(){this.emojiInit()},t.prototype.render=function(){var e=this.props.story,t=this.props.story.getCurStoryData();if(!e.story||!t)return"";var o={left_side_empty:this._leftSideIsEmpty()},r=t.canLike,s=t.canAddToNarrative,n=this.state.reactionStickers;return i.createElement(i.Fragment,null,this.state.isReactionsPanelShow&&n.length>0&&i.createElement(We,{className:"stories_story_reactions",stickers:n,onStickerClick:this._onReactionClick}),i.createElement("div",{className:k("stories_story_bottom",o)},i.createElement("div",{className:"stories_story_bottom_controls",ref:"controls"},i.createElement(Fe,{story:e}),this._renderMessageForm(),this._renderLink(),s&&this.renderAddToNarrativeBtn(),r&&this._renderLike(),this._renderMask(),this._renderShare(),this._renderRemove(),i.createElement(re,{story:e}),this._renderAppButton())))},t.prototype._renderAppButton=function(){var e=this,t=this.props.story.getSticker(R.StickerTypes.app);if(t){var o="stories_button app _stories_button_app";return t.hasNewInteractions&&(o+=" has_new"),i.createElement("a",{target:"_blank",className:o,onClick:function(){return e.props.markAppNotificationsSeen(t)}})}},t.prototype._renderLink=function(){var e=this,t=this.props.story.getCurStoryData();if(!t)return Object(Ge.logError)(new Error("Fail: _renderLink"),{environment:"stories"}),"";var o=t.link;if(!Object(c.isObject)(o))return"";var r="stories_link";return o.object_type&&(r+=" story_link_object_"+o.object_type),this.state.linkObjectAudioPlaying&&(r+=" story_link_object_audio_playing"),i.createElement("div",{className:"stories_link_wrap"},i.createElement("a",{target:"_blank",rel:"noopener noreferrer",className:r,href:o.url,title:o.text,onClick:function(t){e.linkDidPress(t,o)}},i.createElement("span",{className:"stories_link__inner",dangerouslySetInnerHTML:{__html:o.text}})))},t.prototype._renderMask=function(){var e=this.props.story.getCurStoryData();return e?e.mask_id?i.createElement("div",{className:"stories_button mask _mask_button",onMouseOver:function(e){return Object(J.showTooltip)(e.target,{black:1,center:1,shift:[1,13,0],text:Object(D.getLang)("stories_mask_tooltip")})},onClick:this._maskButtonDidPress.bind(this)}):"":(Object(Ge.logError)(new Error("Fail: _renderMask"),{environment:"stories"}),"")},t.prototype._renderShare=function(){var e=this.props.story.getCurStoryData();return e?e.can_share?i.createElement("div",{className:"stories_button share _share_button",onMouseOver:function(e){return Object(J.showTooltip)(e.target,{black:1,center:1,shift:[1,13,0],text:Object(D.getLang)("stories_share")})},onClick:this._shareButtonDidPress.bind(this)}):"":(Object(Ge.logError)(new Error("Fail: _renderShare"),{environment:"stories"}),"")},t.prototype.renderAddToNarrativeBtn=function(){var e=this.props.story.getCurStoryData();return e?i.createElement("div",{className:k("stories_button stories_add_to_narrative",{"stories_button--addedToNarrative":e.isPartOfNarrative||e.narrative}),onMouseOver:function(e){return Object(J.showTooltip)(e.target,{black:1,center:1,shift:[1,13,0],text:Object(D.getLang)("stories_add_to_narrative")})},onClick:this.addToNarrativePress,ref:this.addToNarrativeRef}):(Object(Ge.logError)(new Error("Fail: renderAddToNarrativeBtn"),{environment:"stories"}),"")},t.prototype._renderLike=function(){var e=this.props.story.getCurStoryData();if(!e)return Object(Ge.logError)(new Error("Fail: _renderLike"),{environment:"stories"}),"";var t=this.state.needAnimateLikeButton,o=e.isLiked;return i.createElement("div",{className:k("stories_button stories_like",{"stories_button--isLiked":o,"stories_button--animating":t}),onMouseOver:function(e){return Object(J.showTooltip)(e.target,{black:1,center:1,shift:[1,13,0],text:Object(D.getLang)("stories_like")})},onClick:this._likeButtonDidPress.bind(this)})},t.prototype._renderRemove=function(){var e=this.props.story,t=e.getCurStoryData();return t?!t.can_remove||e.getOwnerId()<0?"":i.createElement("div",{className:"stories_button remove _remove_button",onMouseOver:function(e){return Object(J.showTooltip)(e.target,{black:1,center:1,shift:[1,13,0],text:Object(D.getLang)("global_delete")})},onClick:this._removeButtonDidPress.bind(this)}):(Object(Ge.logError)(new Error("Fail: _renderRemove"),{environment:"stories"}),"")},t.prototype._canMessage=function(){var e=this.props.story,t=e.getCurStoryData();if(!t)return Object(Ge.logError)(new Error("Fail: _canMessage"),{environment:"stories"}),!1;var o=t.link,i=t.can_comment;return!(Object(c.isObject)(o)||!i||e.isLiveEnded())},t.prototype._renderMessageForm=function(){var e=this;if(this._canMessage())return i.createElement("div",{ref:"sendForm",className:"stories_send_form _emoji_field_wrap emoji_rpointer"},i.createElement("div",{className:"stories_send_form_text_wrap"},i.createElement("div",{contentEditable:!0,ref:"messageInput",className:"stories_send_form_text",placeholder:Object(D.getLang)("stories_answer_placeholder"),onFocus:this._sendFormDidFocus.bind(this),onBlur:this._sendFormDidBlur.bind(this),onInput:this._checkReactionsPanel.bind(this)})),i.createElement("div",{className:"stories_send_form_helper"},i.createElement("div",{className:k("stories_send_form_buttons _emoji_wrap",{shown:this.state.sendFormFocused||this.state.sendFormHasText})},i.createElement("div",{ref:"smileButton",className:"stories_send_form_button smile _emoji_btn emoji_smile",onMouseEnter:function(t){window.Emoji.clearSizeCached(e.refs.smileButton),window.Emoji.show(e.refs.smileButton,t.nativeEvent)},onMouseLeave:function(t){return window.Emoji.hide(e.refs.smileButton,t.nativeEvent)},onMouseDown:function(e){return Object(j.cancelEvent)(e.nativeEvent)}}),i.createElement("div",{className:k("stories_send_form_button send",{active:this.state.sendFormHasText}),onClick:this._onSendMessageButtonCLick.bind(this)}))))},t.prototype._isReactionAvailable=function(){return Object(Ue.partConfigEnabled)("story_reactions_web")&&!this.props.story.isActiveLive()},t.prototype._onChangeReactionsPanelVisibility=function(e){void 0===e&&(e=!1),this._isReactionAvailable()&&this.setState({isReactionsPanelShow:e})},t.prototype.emojiInit=function(){var e,t=this;if(!this.emojiId&&this.refs.messageInput){var o=this._isReactionAvailable();if(this.emojiId=window.Emoji.init(this.refs.messageInput,{ttDiff:29,ref:"stories",ttWrap:this.refs.controls,checkEditable:function(){t.props.story.isActiveLive()&&qe.default.checkTextLen(t.refs.messageInput)},noStickers:!o,noStickersStore:!o,onSend:function(){return t._sendMessage()},onStickerSend:function(e,o,i){t._sendMessage([["sticker",e,i]],{sticker_referrer:o})},forceUp:!0,controlsCont:this.refs.sendForm,onKeyAction:function(){return t._emojiDidKeyAction()},onEmojiAdded:function(){return t._emojiDidKeyAction()},onStoreHide:function(){t._updateReactionStickers(),t.props.story.autoResumeStory()}}),Object(j.addEvent)(this.refs.smileButton,"click",j.cancelEvent),Object(ze.placeholderInit)(this.refs.messageInput,{editable:!0}),!this._checkLoadedStickers()){var i=Object(c.isRetina)()?"256b":"128b";window.Emoji.emojiLoadMore(this.emojiId,{sizes:(e={},e[i]=!0,e)},(function(){t._updateReactionStickers()}))}}else this.emojiId&&!this.refs.messageInput&&(Object(j.removeEvent)(this.refs.smileButton,"click",j.cancelEvent),window.Emoji.destroy(this.emojiId),delete this.emojiId)},t.prototype._checkLoadedStickers=function(){return this._getReactionsStickers().length>=R.EMOJI_REACTIONS_ARR.length},t.prototype._leftSideIsEmpty=function(){var e=this.props.story,t=e.getCurStoryData();if(!t)return Object(Ge.logError)(new Error("Fail: _leftSideIsEmpty"),{environment:"stories"}),!1;var o=t.can_manage,i=t.link,r=t.can_comment,s=e.getReplies(),n=e.getViews();return!(n&&0!==parseInt(n))&&(!s||!o)&&!Object(c.isObject)(i)&&!r||e.isLiveEnded()},t.prototype._sendFormDidFocus=function(){var e=this.props.story;this.setState({sendFormFocused:!0}),this._isReactionAvailable()&&this._checkReactionsPanel(),e.onSendFormFocus(),e.layer._sendNavigationStatEvents("comment_tap")},t.prototype._sendFormDidBlur=function(){this.props.story.onSendFormBlur(),this.setState({sendFormFocused:!1}),this._isReactionAvailable()&&this._hideReactionPanel(),this._emojiDidKeyAction()},t.prototype._emojiDidKeyAction=function(){var e=Object(c.trim)(window.Emoji.editableVal(this.refs.messageInput));this.setState({sendFormHasText:e.length>0}),this.refs.messageInput.check()},t.prototype._hideReactionPanel=function(){this._onChangeReactionsPanelVisibility(!1)},t.prototype._showReactionPanel=function(){this._onChangeReactionsPanelVisibility(!0)},t.prototype._checkReactionsPanel=function(){this._isReactionAvailable()&&(this.props.story.getSendText().length?this._hideReactionPanel():this._showReactionPanel())},t.prototype._shareButtonDidPress=function(){this.props.story.shareBox()},t.prototype._likeButtonDidPress=function(){this.setState({needAnimateLikeButton:!0}),this.props.story.toggleLikeStory()},t.prototype._removeButtonDidPress=function(){this.props.story.removeStoryBox()},t.prototype._maskButtonDidPress=function(){this.props.story.sendMask()},t.prototype.linkDidPress=function(e,t){if(t){var o=t.object_type,i=t.object,r=t.url.match(/\/narrative(-?\d+)_(\d+)/);if(r){e.preventDefault();var s=r[1],n=r[2];s&&n&&(this.props.story.pauseStory(),Object(ve.showNarrative)(s,n,0,"",{fromEl:this.props.story.wrapEl,source:"narrative_story"}))}else this.props.story.sendStatEvent("url_view");switch(o){case"audio":this.state.linkObjectAudioPlaying?(window.getAudioPlayer().pause(),this.setState({story:Ye(Ye({},this.state.story),{audioPlaying:!1})}),window.cur.storyLayer.resumeLayer()):(window.getAudioPlayer().playAudio(i),this.setState({story:Ye(Ye({},this.state.story),{audioPlaying:!0})}),window.cur.storyLayer.pauseLayer()),this.setState({linkObjectAudioPlaying:!this.state.linkObjectAudioPlaying}),e.preventDefault()}}},t.prototype._updateReactionStickers=function(){this.setState({reactionStickers:this._getReactionsStickers()})},t.prototype._getReactionsStickers=function(){var e=[];if(window.stickersKeywords&&window.Emoji.stickersById){var t=window.Emoji.stickersById,o=Object(c.isRetina)()?"256b":"128b",i={};R.EMOJI_REACTIONS_ARR.forEach((function(r){var s=window.stickersKeywords[Object(Ke.emojiRemoveSkinToneModifiers)(window.Emoji.codeToChr(r.code))],n=s&&window.Emoji.sortStickersHints(s),a={};n&&n.every((function(e){return!(e>0&&t[e]&&t[e].sticker&&!i[e])||(a=t[e].sticker,!1)})),a[6]&&a[6][o]&&(e.push({id:a[0],packId:0,uniqId:Object(c.irand)(0,1e5),imageUrl:a[6][o],animationUrl:a[3]}),i[a[0]]=!0)}))}return e},t.prototype._hideStickerHints=function(){var e=Object(a.geByClass1)("_sticker_hints",Object(a.domPN)(this.refs.messageInput));e&&"number"==typeof this.emojiId&&window.Emoji.stickersHintsHide(e,window.Emoji.opts[this.emojiId],100)},t.prototype._onSendMessageButtonCLick=function(){this._sendMessage()},t.prototype._sendMessage=function(e,t,o){var i=this;void 0===e&&(e=[]),void 0===t&&(t={}),void 0===o&&(o={});var r=e.length;this._hideStickerHints(),this.props.story.onAnswerSend((function(){i._emojiDidKeyAction(),r&&i._updateReactionStickers()}),e,t,o)},t}(i.Component),$e=function(){function e(e,t){this.data=e,this.opts=t,this.paused=!0,this.loaded=!1,this.elems={},this.startTs=0,this.isPausedByMetaScroll=!1;var o=e.is_expired,i=e.is_deleted,r=e.is_private,s=e.narrative,n=e.isOneTimeSeen;o?this._error("expired"):i?s?this._error("deleted-narrative"):this._error("deleted"):n?this._error("isOneTimeSeen"):r&&(s?this._error("private-narrative"):this._error("private")),(o||i||r||n)&&(this.failed=!0)}return e.prototype.render=function(){var e=this;this.isGroupsMetaStory||this.isAppsMetaStory||(this.longLoadingTimer=setTimeout((function(){e.isLoaded()||e.opts.onLongLoading()}),1e3),this.opts.onLoadingStart())},e.prototype.renderAppsMetaStory=function(){var e=this,t=Object(a.ce)("div",{className:"MetaStory"}),o=window.Stories._getList("apps");if(o){this.coverItems=o,this.coverCount=this.coverItems?this.coverItems.length:0,this.elems.recBlock=Object(a.ce)("div",{className:"MetaStory__rec"}),this.elems.recInner=Object(a.ce)("div",{className:"MetaStory__rec-inner"}),this.elems.recItems=Object(a.ce)("div",{className:"MetaStory__rec-items"}),this.elemOffset=286,this.scrollOffset=0,this.metaStoryGridMarginTop=this.elemOffset;var i=Object(a.ce)("div",{className:"MetaStory__infoWrapper"}),r=Object(a.ce)("div",{className:"MetaStory__info"}),s=Object(a.ce)("a",{className:"MetaStory__appWrapper",href:this.data.app.url,target:"_blank"});s.appendChild(Object(a.ce)("div",{className:"MetaStory__appIcon"},{backgroundImage:"url("+this.data.app.photoUrl+")"})),s.appendChild(Object(a.ce)("div",{className:"MetaStory__appName",innerHTML:this.data.app.name})),s.appendChild(Object(a.ce)("span",{className:"MetaStory__appLink",innerHTML:Object(be.getLang)("stories_go_to_app")})),r.appendChild(s),i.appendChild(r),Object(a.setStyle)(i,{paddingBottom:this.elemOffset+"px"}),Object(a.setStyle)(this.elems.recItems,{minHeight:"calc(100% - "+this.elemOffset+"px"}),t.appendChild(i);var n=Object(a.ce)("div",{className:"MetaStory__navigationBtn MetaStory__backBtn"}),c=Object(a.ce)("div",{className:"MetaStory__navigationBtn MetaStory__nextBtn"}),l=Object(a.ce)("div",{className:"MetaStory__clickableArea"});l.appendChild(n),l.appendChild(c),Object(j.addEvent)(l,"mousedown",this.handleGridInfoWrapperMouseDown.bind(this)),Object(j.addEvent)(l,"mouseup",this.handleGridInfoWrapperMouseUp.bind(this)),this.coverItems.forEach((function(t){var o=t.items.filter((function(e){return e.unread})),i=!!o.length,r=t.items[0];i&&(r=o[0]);var s=Object(a.ce)("span",{className:"GridStoryPreview"+("live"===r.type?" GridStoryPreview--live":""),onclick:function(e){var o=e.target;window.Stories.show(window.cur.storyLayer.getBlockKey(t)+"/apps",{fromEl:o})}}),n=Object(a.ce)("div",{className:"GridStoryPreview__inner",innerHTML:'\n            <a href="'+t.author.href+'" data-author-id="'+t.author.id+'" class="GridStoryPreview__author'+(i?" GridStoryPreview__author--unread":"")+'" style="background-image: url(\''+t.author.photo+'\')"></a>\n            <span class="GridStoryPreview__title">'+t.author.name+"</span>\n          "},{backgroundImage:"url('"+r.preview_url+"')"}),c=new Image;c.src=r.small_preview,c.onload=function(){Object(a.setStyle)(n,{backgroundImage:"url('"+r.small_preview+"')"})},s.appendChild(n),e.elems.recItems.appendChild(s)})),Object(j.addEvent)(this.elems.recInner,"scroll",this.handleRecommendationsScroll.bind(this)),this.elems.recInner.appendChild(l),this.elems.recInner.appendChild(this.elems.recItems),this.elems.recBlock.appendChild(this.elems.recInner),t.appendChild(this.elems.recBlock)}return t},e.prototype.renderGroupsMetaStory=function(){var e=this,t=Object(a.ce)("div",{className:"MetaStory"}),o=window.Stories._getList("groups");if(o){this.coverItems=o,this.coverCount=this.coverItems?this.coverItems.length:0,this.elems.recBlock=Object(a.ce)("div",{className:"MetaStory__rec"}),this.elems.recInner=Object(a.ce)("div",{className:"MetaStory__rec-inner"}),this.elems.recItems=Object(a.ce)("div",{className:"MetaStory__rec-items"}),this.elemOffset=286,this.scrollOffset=0,this.metaStoryGridMarginTop=this.elemOffset;var i=Object(a.ce)("div",{className:"MetaStory__infoWrapper"}),r=Object(a.ce)("div",{className:"MetaStory__info"});r.appendChild(Object(a.ce)("div",{className:"MetaStory__infoTitle",innerHTML:Object(be.getLang)("stories_groups_grid_title")})),r.appendChild(Object(a.ce)("div",{className:"MetaStory__infoDescription",innerHTML:Object(be.getLang)("stories_groups_grid_text")})),i.appendChild(r),Object(a.setStyle)(i,{paddingBottom:this.elemOffset+"px"}),Object(a.setStyle)(this.elems.recItems,{minHeight:"calc(100% - "+this.elemOffset+"px"}),t.appendChild(i);var s=Object(a.ce)("div",{className:"MetaStory__navigationBtn MetaStory__backBtn"}),n=Object(a.ce)("div",{className:"MetaStory__navigationBtn MetaStory__nextBtn"}),c=Object(a.ce)("div",{className:"MetaStory__clickableArea"});c.appendChild(s),c.appendChild(n),Object(j.addEvent)(c,"mousedown",this.handleGridInfoWrapperMouseDown.bind(this)),Object(j.addEvent)(c,"mouseup",this.handleGridInfoWrapperMouseUp.bind(this)),this.coverItems.forEach((function(t){var o=t.items.filter((function(e){return e.unread})),i=!!o.length,r=t.items[0];i&&(r=o[0]);var s=Object(a.ce)("span",{className:"GridStoryPreview"+("live"===r.type?" GridStoryPreview--live":""),onclick:function(e){var o=e.target;window.Stories.show(window.cur.storyLayer.getBlockKey(t)+"/groups",{fromEl:o})}}),n=Object(a.ce)("div",{className:"GridStoryPreview__inner",innerHTML:'\n            <a href="'+t.author.href+'" data-author-id="'+t.author.id+'" class="GridStoryPreview__author'+(i?" GridStoryPreview__author--unread":"")+'" style="background-image: url(\''+t.author.photo+'\')"></a>\n            <span class="GridStoryPreview__title">'+t.author.name+"</span>\n          "},{backgroundImage:"url('"+r.preview_url+"')"}),c=new Image;c.src=r.small_preview,c.onload=function(){Object(a.setStyle)(n,{backgroundImage:"url('"+r.small_preview+"')"})},s.appendChild(n),e.elems.recItems.appendChild(s)})),Object(j.addEvent)(this.elems.recInner,"scroll",this.handleRecommendationsScroll.bind(this)),this.elems.recInner.appendChild(c),this.elems.recInner.appendChild(this.elems.recItems),this.elems.recBlock.appendChild(this.elems.recInner),t.appendChild(this.elems.recBlock)}return t},e.prototype.handleRecommendationsScroll=function(){var e=Math.min(this.elems.recInner.scrollTop/(this.scrollOffset/100),70)/100;Object(a.setStyle)(this.elems.recBlock,{backgroundColor:"rgba(0, 0, 0, "+e+")"}),this.elems.recInner.scrollTop?(this.isPausedByMetaScroll=!0,Object(a.addClass)(this.elems.recBlock,"scroll"),this.pause()):(this.isPausedByMetaScroll=!1,this.play(),Object(a.removeClass)(this.elems.recBlock,"scroll"),Object(a.setStyle)(this.elems.recBlock,{backgroundColor:"rgba(0, 0, 0, 0)"})),(this.data.is_groups_meta_story||this.data.is_apps_meta_story)&&(this.elems.blockHeader||(this.elems.blockHeader=window.cur.storyLayer.activeStory.authorButtons.querySelector(".stories_groups_settings_text")),this.elems.recInner.scrollTop&&Object(a.removeClass)(window.cur.storyLayer.activeStory.wrapEl,"paused"),this.elems.recInner.scrollTop>this.metaStoryGridMarginTop?(Object(a.removeClass)(window.cur.storyLayer.activeStory.wrapEl,"paused"),Object(a.removeClass)(this.elems.blockHeader,"stories_groups_settings_text_hide")):Object(a.addClass)(this.elems.blockHeader,"stories_groups_settings_text_hide"))},e.prototype.handleGridInfoWrapperMouseDown=function(){this.downTs=Object(c.vkNow)(),this.longTapTimer=setTimeout(e.longTapInfoWrapper.bind(this),R.LONG_PRESS_DELAY_MS)},e.prototype.handleGridInfoWrapperMouseUp=function(e){if(window.cur.storyLayer.activeStory){clearTimeout(this.longTapTimer);var t=!(Object(c.vkNow)()-this.downTs<R.LONG_PRESS_DELAY_MS);if(Object(a.hasClass)(e.target,"MetaStory__backBtn")&&!t)return window.cur.storyLayer.activeStory.prevStory();t?window.cur.storyLayer.activeStory.isPaused()&&window.cur.storyLayer.activeStory.playStory(!1,!!this.downTs):window.cur.storyLayer.activeStory._onPlayEnd()}},e.longTapInfoWrapper=function(){window.cur.storyLayer.activeStory&&window.cur.storyLayer.activeStory._longTapHandle()},e.prototype.getContainer=function(){},e.prototype.play=function(){this.paused=!1,this.isLoaded()&&this.opts.onPlay()},e.prototype.pause=function(){this.paused=!0,this.opts.onPause()},e.prototype.setCurrentTime=function(e){void 0===e&&(e=0)},e.prototype.destroy=function(){Object(j.removeEvent)(this.elems.recBlock),clearTimeout(this.longLoadingTimer)},e.prototype.isPaused=function(){return this.paused},e.prototype.isLoaded=function(){return this.loaded},e.prototype.getCurrentTime=function(){return 0},e.prototype.getDuration=function(){return 0},e.prototype.getId=function(){return this.data.raw_id},e.prototype.getTrackCode=function(){return this.data.track_code},e.prototype.getAccessKey=function(){return this.data.accessKey},e.prototype.getDate=function(){return this.data.date},e.prototype.getViews=function(){return this.data.views},e.prototype.getReplies=function(){return this.data.replies},e.prototype.setViews=function(e){this.data.views=e},e.prototype.setReplies=function(e){this.data.repliesCountText=e},e.prototype.isOneTime=function(){return this.data.isOneTime&&this.data.authorId!==window.vk.id},e.prototype._onCanPlay=function(){if(clearTimeout(this.longLoadingTimer),this.loaded=!0,this.opts.onLoadingEnd(),this.startTs=Date.now(),this.data.seenProgress&&this.isOneTime()&&this.setCurrentTime(+(this.data.seenProgress*this.getDuration()/100).toFixed(1)),!this.isPaused()){var e=document.visibilityState;if(e&&"visible"!==e)return;this.play()}},e.prototype._loadingError=function(){this._error("load")},e.prototype._isFailed=function(){return this.failed},e.prototype._error=function(e){clearTimeout(this.longLoadingTimer),this.opts.onError(e)},e}(),Je=o("Ia1d"),Ze=function(){var e=function(t,o){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])})(t,o)};return function(t,o){function i(){this.constructor=t}e(t,o),t.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}(),et=function(e){function t(t,o,i){var r=e.call(this,t,o)||this;return r.wrapEl=i,r.videoRaw=r.data.video.owner_id+"_"+r.data.video.video_id,r}return Ze(t,e),t.prototype.render=function(){var t=this;e.prototype.render.call(this),this.el=Object(a.ce)("div",{className:"stories_live"});var o=Object(a.ce)("div",{className:"stories_live_player"},{height:"100%",width:"100%"});return this.el.appendChild(o),this.chatEl=Object(a.se)('\n      <div class="stories_live_chat">\n        <div class="mv_chat_messages_wrap">\n          <div class="mv_chat_messages"></div>\n        </div>\n        <div class="mv_chat_stickers_wrap"></div>\n      </div>\n    '),this.el.appendChild(this.chatEl),window.mvcur&&window.mvcur.player&&window.Videoview.hide(!1,!0),setTimeout((function(){Object(Je.showInlineVideo)(t.videoRaw,"",{autoplay:1,module:"story",onLoaded:function(){t._onPlayerInited()}},!1,o)})),this.el},t.prototype.destroy=function(){e.prototype.destroy.call(this),this._resetTimer(),window.mvcur={},this.player&&(this.player.destroy(),qe.default.destroy()),window.cur.storyLayer._sendNavigationStatEvents("live_player_close",!1),delete this.el},t.prototype.getContainer=function(){return this.el||this.render()},t.prototype.onLiveEnded=function(){var e=this;this.liveEnded=!0,Object(a.hide)(Object(a.geByClass1)("_error_msg",Object(a.geByClass1)("videoplayer_error")));var t=this.mvData.oid<0?Object(be.getLang)("stories_live_ended_desc_club"):Object(be.langSex)(this.mvData.author_sex,Object(be.getLang)("stories_live_ended_desc_user","raw"));t=t.replace("{name}",this.mvData.md_author);var o=this.mvData.oid<0?Object(be.getLang)("stories_live_ended_open_club"):Object(be.getLang)("stories_live_ended_open_user");Object(a.hide)(this.chatEl),Object(a.hide)(Object(a.domByClass)(this.player.ui.thumb,"videoplayer_big_play_btn"));var i=window.cur.storyLayer.storiesBlocks.length>1;this.el.appendChild(Object(a.se)('\n    <div class="stories_live_end">\n      <div class="stories_live_end_author_photo" style="background-image: url('+this.mvData.author_photo+')"></div>\n      <div class="stories_live_end_title">'+Object(be.getLang)("stories_live_ended_title")+'</div>\n      <div class="stories_live_end_desc">'+t+'</div>\n      <a href="'+this.mvData.author_href+'" class="stories_live_end_open_owner">'+o+'</a>\n      <div class="stories_live_end_timer" onclick="cur.storyLayer.nextStory()" style="'+(i?"":"display: none;")+'">\n        <canvas class="_timer_canvas" width="100" height="100"></canvas>\n        <div class="stories_live_end_timer_text">'+Object(be.getLang)("stories_live_ended_watch_next")+"</div>\n      </div>\n    </div>\n    ")),i&&setTimeout((function(){e._startTimer()}))},t.prototype.pause=function(){},t.prototype.play=function(){this.player&&!this.liveEnded&&(e.prototype.play.call(this),this.player&&this.player.play())},t.prototype.sendMessage=function(e,t){e.length>window.mvcur.maxChatReplyLength||(window.ajax.post("al_video.php?act=post_comment",{comment:e,video:this.videoRaw,hash:this.mvData.hash,videoviewer_chat:1}),window.cur.storyLayer.activeStory._onAnswerSent(t))},t.prototype.volumeUpdate=function(){this.player.setVolume(b())},t.prototype._onCanPlay=function(){e.prototype._onCanPlay.call(this),Object(a.setStyle)(this.el,"opacity",1)},t.prototype._onPlayerInited=function(){this._onCanPlay(),this.player=window.cur.videoInlinePlayer,this.play(),window.cur.storyLayer._sendNavigationStatEvents("live_player_show",!1),window.browser.safari&&this.player.toggleMute(!0,!1),this.mvData=window.Videoview.getMvData(),window.mvcur={chatMode:!0,maxChatReplyLength:this.mvData.maxChatReplyLength,mvData:this.mvData,mvShown:!0,queueKey:this.mvData.queue_params.key,qversion:this.mvData.qversion},qe.default.init(this.chatEl,{scrollHidden:!0}),window.Videoview.queueCheckUpdates(this.mvData.queue_params)},t.prototype._startTimer=function(){var e=this;if(window.CanvasRenderingContext2D){var t=Object(a.domByClass)(this.el,"_timer_canvas"),o=t.getContext("2d");o.lineWidth=6,o.lineCap="round",o.strokeStyle="#fff";var i=Date.now(),r=function(){var t=(Date.now()-i)/5e3;t<1?(o.clearRect(0,0,100,100),o.beginPath(),o.arc(50,50,47,-Math.PI/2,-Math.PI/2+2*Math.PI*t),o.stroke(),e._nextTO=setTimeout(r,16)):window.cur.storyLayer.nextStory()};Object(a.show)(t),this.timerInProgress=!0,r()}},t.prototype._resetTimer=function(){window.CanvasRenderingContext2D&&(clearTimeout(this._nextTO),this.timerInProgress=!1,Object(a.hide)(Object(a.domByClass)(this.el,"_timer_canvas")))},t}($e),tt=function(){var e=function(t,o){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])})(t,o)};return function(t,o){function i(){this.constructor=t}e(t,o),t.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}(),ot=function(e){function t(t,o){var i=e.call(this,t,o)||this;return i.isFirstChunkLoaded=!1,i}return tt(t,e),t.prototype.render=function(){var t=this;if(e.prototype.render.call(this),this.video)return this.video;var o=this.data.video_url;return this.video=document.createElement("video"),this.video.setAttribute("class","stories_video"),this.video.setAttribute("autoplay","false"),this.video.setAttribute("volume",Object(H.getAudioPlayer)().getVolume()),this.video.setAttribute("x-yandex-pip","false"),this.video.setAttribute("disablePictureInPicture","true"),Object(j.addEvent)(this.video,"error",(function(){t._loadingError()})),this._isFailed()||(this.loaded&&(this.video.currentTime=0),Object(j.addEvent)(this.video,"canplay",this._onCanPlay.bind(this)),this.video.src=o,this.volumeUpdate()),this.video},t.prototype.getContainer=function(){return this.video||this.render()},t.prototype.getImage=function(){var e=Object(a.getSize)(this.video),t=document.createElement("canvas");t.setAttribute("width",e[0].toString()),t.setAttribute("height",e[1].toString());var o=t.getContext("2d");return o&&o.drawImage(this.video,0,0,e[0],e[1]),t.toDataURL()},t.prototype.destroy=function(){e.prototype.destroy.call(this),Object(j.removeEvent)(this.video),delete this.video},t.prototype.play=function(){var t=this;if(e.prototype.play.call(this),this.loaded&&this.video){var o=this.video.play();void 0!==o&&o.catch((function(){t.opts.onAutoPlayFail()}))}},t.prototype.pause=function(){e.prototype.pause.call(this),this.video&&this.video.pause()},t.prototype.setCurrentTime=function(e){void 0===e&&(e=0),e=+(e/1e3).toFixed(1),this.loaded&&this.video.currentTime<e&&(this.video.currentTime=e)},t.prototype.getCurrentTime=function(){return 1e3*this.video.currentTime},t.prototype.getDuration=function(){return 1e3*this.video.duration},t.prototype.volumeUpdate=function(){this.video.volume=b()},t.prototype._onCanPlay=function(){e.prototype._onCanPlay.call(this),!this.isFirstChunkLoaded&&window.cur.storyLayer&&(this.isFirstChunkLoaded=!0,window.cur.storyLayer._sendNavigationStatEvents("view_story",!0,{preloading_duration:window.cur.storyLayer.activeStory&&window.cur.storyLayer.activeStory.loadingTime||0})),Object(a.setStyle)(this.video,"opacity",1),Object(j.removeEvent)(this.video,"canplay")},t}($e),it=function(){var e=function(t,o){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])})(t,o)};return function(t,o){function i(){this.constructor=t}e(t,o),t.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}(),rt=function(e){function t(t,o){var i=e.call(this,t,o)||this;return i.pauseTime=0,i}return it(t,e),t.prototype.render=function(){var t=this;if(e.prototype.render.call(this),this.photo)return this.photo;var o=this.data.photo_url;return this.photo=document.createElement("div"),this.photo.setAttribute("class","stories_photo"),this._isFailed()||v(o).then((function(e){t.photo&&(Object(a.setStyle)(t.photo,"backgroundImage","url("+e+")"),t._onCanPlay())})).catch((function(){t.isGroupsMetaStory||t.isAppsMetaStory?t._onCanPlay():t._loadingError()})),this.photo},t.prototype.getContainer=function(){return this.isGroupsMetaStory||this.isAppsMetaStory||this.photo||this.render()},t.prototype.destroy=function(){e.prototype.destroy.call(this),delete this.photo},t.prototype.play=function(){(0===this.startTs||this.pauseTime>0)&&(this.startTs=Date.now()-this.pauseTime,this.pauseTime=0),e.prototype.play.call(this)},t.prototype.pause=function(){this.isPaused()||(e.prototype.pause.call(this),this.pauseTime=this.getCurrentTime())},t.prototype.setCurrentTime=function(e){void 0===e&&(e=0),this.startTs=Date.now()-e,this.isPaused()&&(this.pauseTime=e)},t.prototype.getCurrentTime=function(){return Date.now()-this.startTs||0},t.prototype.getDuration=function(){return 5e3},t.prototype._onCanPlay=function(){e.prototype._onCanPlay.call(this);var t=this.isGroupsMetaStory?"group_feed_view":"view_story";window.cur.storyLayer._sendNavigationStatEvents(t,!0,{preloading_duration:window.cur.storyLayer.activeStory&&window.cur.storyLayer.activeStory.loadingTime||0}),Object(a.setStyle)(this.photo,"opacity",1)},t}($e),st=o("QChX"),nt=o("DM2o");function at(e){if(st.HAS_MEDIA_SESSION){var t=(Ne=e).getCurStoryData();if(t)if(["video"].includes(t.type)&&!t.noSound){var o=Object(A.decodeHTMLEntities)(Ne.data.author.name),i=Object(A.decodeHTMLEntities)(t.date),r=t.small_preview||t.photo_url||t.first_frame||t.preview_url,s=r?[{sizes:"800x1497",src:r}]:[];!function(){if(!st.HAS_MEDIA_SESSION)return;navigator.mediaSession.setActionHandler("play",ct),navigator.mediaSession.setActionHandler("pause",lt),navigator.mediaSession.setActionHandler("seekbackward",null),navigator.mediaSession.setActionHandler("seekforward",null),navigator.mediaSession.setActionHandler("previoustrack",dt),navigator.mediaSession.setActionHandler("nexttrack",ut)}(),Object(st.updateMediaSessionMetadata)({title:o,artist:i,album:"",artwork:s})}else Object(st.clear)();else Object(Ge.logError)(new Error("Fail story media session"),{environment:"stories"})}}function ct(){Ne.playStory(),Object(nt.statlogsValueEvent)("global_media_controls","story_player","play")}function lt(){Ne.pauseStory(),Object(nt.statlogsValueEvent)("global_media_controls","story_player","pause")}function dt(){Ne.prevStory(),Object(nt.statlogsValueEvent)("global_media_controls","story_player","previous_track")}function ut(){Ne.nextStory(),Object(nt.statlogsValueEvent)("global_media_controls","story_player","next_track")}var pt=o("lXE5"),ht=o("lBJi"),_t=o("k487"),mt=o("v+DW"),vt=o("rudk"),ft=o("FThC"),gt=o("El3O"),yt=o("rJNF"),bt=function(){for(var e=0,t=0,o=arguments.length;t<o;t++)e+=arguments[t].length;var i=Array(e),r=0;for(t=0;t<o;t++)for(var s=arguments[t],n=0,a=s.length;n<a;n++,r++)i[r]=s[n];return i},wt=function(){function e(e,t){var o=this;this.updateBottom=function(e){var t=Object(a.geByClass1)("stories_bottom_wrap",o.wrapEl);!o.isActive||e||!o.story||o.story.isGroupsMetaStory||o.story.isAppsMetaStory?(s.unmountComponentAtNode(t),Object(a.val)(t,"")):s.render(i.createElement(Qe,{story:o,markAppNotificationsSeen:o.markAppNotificationsSeen}),t)},this.markAppNotificationsSeen=function(e){var t=o.getCurStoryData();if(t){var i=t.raw_id,r=void 0===i?"":i,s=t.accessKey;if(e.appId&&e.appRef){var n=r.split("_"),a=n[0],c=n[1];e.hasNewInteractions&&window.ajax.post("al_stories.php",{act:"mark_app_notifications_seen",owner_id:a,story_id:c,sticker_id:e.id,access_key:s,hash:e.hash},{onDone:function(){t.clickable_stickers&&t.clickable_stickers.stickers&&t.clickable_stickers.stickers.forEach((function(t){t.id===e.id&&t.type===R.StickerTypes.app&&(t.hasNewInteractions=!1)}));var o=document.querySelector("._stories_button_app");o&&o.classList.contains("has_new")&&o.classList.remove("has_new");var i=document.querySelector("#feed_story_"+a+" .stories_feed_preview_app");i&&i.classList.contains("has_new")&&i.classList.remove("has_new")}}),window.layerQueue.count()?window.layerQueue.pop():window.layerQueue.push(),o.pauseStory(),Object(H.showWiki)({w:"app"+e.appId,app_ref:e.appRef,app_hash:e.appHash}),o.layer._sendNavigationStatEvents("click_to_app",!0,{clickable_sticker:{id:e.id,type:"app"}})}}else Object(Ge.logError)(new Error("Fail: markAppNotificationsSeen"),{environment:"stories"})},this.toggleFeedbackTooltip=function(e){void 0===e&&(e=!o.isFeedbackTooltipShow),e?o.showFeedbackTooltip():o.hideFeedbackTooltip()},this.onFetchFeedbackData=function(e){var t,i,r;o.feedback=e;var s=null===(i=null==e?void 0:e.replies)||void 0===i?void 0:i.repliesTotalCountText,n=null===(r=null==e?void 0:e.viewers)||void 0===r?void 0:r.viewsTotalCountText,a=null==e?void 0:e.replies,l=null==a?void 0:a.listName,d=null==a?void 0:a.list;s&&o.setReplies(s),n&&o.setViews(n),a&&d&&(window.cur=Object(c.extend)(window.cur,((t={})["stories_list_"+l]=d,t)),a.list=d.length>R.INIT_MAX_FEEDBACK_STORIES_COUNT?d.slice(0,R.INIT_MAX_FEEDBACK_STORIES_COUNT):d,a.moreRepliesCount=d.length-a.list.length),o.updateBottom()},this.showMoreReplies=function(){var e,t=null===(e=o.feedback)||void 0===e?void 0:e.replies,i=null==t?void 0:t.listName,r=null==t?void 0:t.list;if(t&&r){var s=window.Stories._getList(i);t.list=s.slice(0,t.list.length+R.MAX_FEEDBACK_STORIES_SLICE_COUNT),t.moreRepliesCount=s.length-t.list.length,o.updateBottom()}},this.onFetchViewers=function(e){var t,i;(null===(i=null===(t=o.feedback)||void 0===t?void 0:t.viewers)||void 0===i?void 0:i.items)&&(o.feedback.viewers.items=o.feedback.viewers.items.concat(e.viewers),o.feedback.viewers.nextFrom=e.nextFrom,o.updateBottom())},this.onQuestionRemove=function(e){var t,i;(null===(i=null===(t=o.feedback)||void 0===t?void 0:t.questions)||void 0===i?void 0:i.items)&&(o.feedback.questions.items=o.feedback.questions.items.filter((function(t){return t.id!==e})),o.feedback.questions.items.length||delete o.feedback.questions,o.updateBottom())},this.onPrivacyHintHide=function(){var e,t;(null===(t=null===(e=o.feedback)||void 0===e?void 0:e.stats)||void 0===t?void 0:t.showPrivacyHint)&&(window.ajax.post("al_stories.php",{act:"hide_privacy_hint",privacy_hint_hash:o.feedback.stats.privacyHintHash}),o.feedback.stats.cells||o.feedback.stats.extendedStats?o.feedback.stats.showPrivacyHint=!1:delete o.feedback.stats,o.updateBottom())},this.onAddToNarrativeBtnClick=function(){var e=o.getCurStoryData();if(e){o.pauseStory(),o.isModalShown=!0;var t=o.buildStoryArchiveByActive();if(t){var i={ownerId:o.getOwnerId(),story:t,onClose:function(){window.cur.narrativeBlock&&window.cur.narrativeBlock.updateBlock(),o.isModalShown=!1,o.updateBottom(),o.playStory()},onSave:function(t){e.isPartOfNarrative=t}};Object(yt.showNarrativeChooseBox)(i)}}},this.data=e,this.opts=t,this.id=t.id,this.isActive=!1,this.isSendFormActive=!1,this.isModalShown=!1,this.isFeedbackTooltipShow=!1,this.feedback=null,this.pressedStory=null,this.index=0,this._currentTimeLineAdditionalEl=null,this._currentTimeLineEl=null,this.preloadedStories={},this.layer=t.layer}return e.prototype.destroy=function(){this._destroyStory(),Object(j.removeEvent)(Object(a.geByClass1)("stories_item_cont",this.contWrap)),Object(j.removeEvent)(Object(a.geByClass1)("stories_reply_to",this.replyToWrap)),Object(j.removeEvent)(this.shareButton),delete this.shareButton,Object(j.removeEvent)(this.followBtn),delete this.followBtn,Object(j.removeEvent)(this.answersEl),delete this.answersEl,clearTimeout(this.showMessageTimer);for(var e=Object(a.geByClass)("stories_time_line",this.timeLineEl),t=0;t<e.length;t++)Object(j.removeEvent)(e[t]);Object(j.removeEvent)(this.viewsButton),Object(j.removeEvent)(Object(a.geByClass1)("stories_link",this.wrapEl)),delete this.contWrap,delete this.backButton,delete this.replyToWrap,delete this.descEl,delete this.replyToWrap,delete this.timeLineEl,delete this.authorButtons,delete this.inlineLoader,this.wrapEl&&this.wrapEl.parentNode&&this.wrapEl.parentNode.removeChild(this.wrapEl),delete this.wrapEl;var o=!1;for(t=0;t<this.data.items.length;t++)if(this.data.items[t].unread){o=!0;break}var i=I();if(!o&&i&&i.activeStory&&!this.data.is_apps){var r=Object(a.domQuery)("#feed_story_"+this.layer.getBlockKey(this.data),i.activeStory.wrapEl)[0];Object(a.removeClass)(r,"story_feed_new_item"),Object(a.removeClass)(r,"story_feed_new_item_promo")}Object(st.clear)()},e.prototype._destroyTimeLine=function(){for(var e=Object(a.geByClass)("stories_time_line",this.timeLineEl),t=0;t<e.length;t++)Object(j.removeEvent)(e[t])},e.prototype.getOwnerId=function(){return this.data.author.id},e.prototype.getIndex=function(){return this.index},e.prototype.getRawId=function(){return!!this.story&&this.story.getId()},e.prototype.getTrackCode=function(){return!!this.story&&this.story.getTrackCode()},e.prototype.getAccessKey=function(){var e;return null===(e=this.story)||void 0===e?void 0:e.getAccessKey()},e.prototype.getReadHash=function(){return this.data.read_hash},e.prototype.getItems=function(){return this.data.items},e.prototype.getItemsLength=function(){return this.getItems().length},e.prototype.render=function(){var e=this;this.wrapEl=Object(a.ce)("div",{className:"stories_item"}),this.contWrap=Object(a.ce)("div",{className:"stories_item_cont_wrap"}),this.contStickers=Object(a.ce)("div",{className:"stories_item_cont_sticker"}),this.storiesHeader=Object(a.ce)("div",{className:"stories_header"}),this.contWrap.appendChild(this.contStickers),this.wrapEl.appendChild(this.contWrap);var t=Object(a.ce)("div",{className:"stories_item_cont"});return Object(j.addEvent)(t,"mousedown",(function(t){e._onMouseDownHandle(t.target)})),Object(j.addEvent)(t,"mouseup",(function(t){e._onMouseUpHandle(t.target)})),this.contWrap.appendChild(t),this.contWrap.appendChild(this.storiesHeader),this.storiesHeader.appendChild(this._renderAuthor()),this.storySendFormOverlay=Object(a.ce)("div",{className:"stories_bottom_overlay"}),this.storySendFormOverlay.appendChild(Object(a.ce)("div",{className:"stories_bottom_wrap"})),this.contWrap.appendChild(this.storySendFormOverlay),this.contWrap.appendChild(this._renderPreview()),this.indexToUnread(),window.cur.noStoriesBack||(this.backButton=Object(a.ce)("div",{className:"stories_item_back"}),t.appendChild(this.backButton)),this.replyToWrap=t.appendChild(Object(a.ce)("div",{className:"stories_reply_to_wrap"})),this.inlineLoader=t.appendChild(Object(a.ce)("div",{className:"stories_inline_loader",innerHTML:Object(gt.getProgressHtml)()})),this.contWrap.appendChild(Object(a.ce)("div",{className:"stories_play_button video_thumb_play",onclick:function(){e.story&&e.story.play()}})),this.isActiveLive()?Object(a.addClass)(this.wrapEl,"live"):this._initTimeLine(),Object(a.toggleClass)(this.wrapEl,"multi_stories",this.data.items.length>1),this.wrapEl},e.prototype._canForceDeleteStories=function(){return this.data.moder_remove_hash&&!this.data.items[0].is_deleted},e.prototype._initTimeLine=function(){this.timeLineEl&&(this._destroyTimeLine(),Object(a.re)(this.timeLineEl)),this.storiesHeader.appendChild(this._renderTimeLine())},e.prototype._isActionsShown=function(){var e=Object(a.domClosest)("_ui_menu_wrap",this.wrapEl);return Object(a.hasClass)(e,"shown")},e.prototype._renderPreview=function(){return Object(a.se)('<div class="stories_preview"></div>')},e.prototype._renderMessage=function(e){return Object(a.se)('<div class="stories_message">\n  <div class="stories_message_text">'+e+"</div>\n</div>")},e.prototype._showMessage=function(e){var t=this;Object(a.re)(Object(a.geByClass1)("stories_message",this.contWrap));var o=this._renderMessage(e);return this.contWrap.appendChild(o),clearTimeout(this.showMessageTimer),new Promise((function(e){t.showMessageTimer=setTimeout((function(){t.contWrap.removeChild(o),e()}),3e3)}))},e.prototype._setPreview=function(e,t){var o=this,i=this.index,r=this.data.items[i].preview_url;r!==this.curPreviewUrl&&r&&(e=e||Object(a.geByClass1)("stories_preview",this.contWrap),v(r).then((function(s){i===o.index&&r!==o.curPreviewUrl&&(o.curPreviewUrl=r,Object(a.setStyle)(e,"backgroundImage","url("+s+")")),Object(a.setStyle)(e,"opacity",1),t&&setTimeout(t,0)})).catch((function(e){Object(Ge.logError)(e)})))},e.prototype._renderAuthor=function(){var e,t=this,o=this.data.author,i=o.photo,r=o.href,s=o.name,n=o.verify,c="_self";(this.layer.list.includes("place")&&(c="_blank"),this.data.is_groups)?e='\n      <div class="stories_author_cont">\n        <a href="/groups" target="_blank" class="stories_author_name"><span>'+Object(be.getLang)("stories_groups_feed_block")+'</span></a>\n        <div class="stories_desc"></div>\n      </div>':e='\n      <div class="stories_author_cont">\n        '+('<a href="'+r+'" class="stories_author_photo_wrap"><img src="'+i+'" class="stories_author_photo" /></a>')+'\n        <a href="'+r+'" target="'+c+'" class="stories_author_name"><span>'+s+"</span></a>\n        "+(n||"")+'\n        <div class="stories_desc"></div>\n      </div>';var l=Object(a.se)('\n      <div class="stories_author">\n        <div class="stories_author_cont_wrap">\n          <div class="stories_author_inner">'+e+'</div>\n          <div class="stories_author_buttons"></div>\n         </div>\n      </div>\n    ');return Object(j.addEvent)(l,"click",(function(e){Object(a.domClosestByTag)("a",e.target)&&t.layer._sendNavigationStatEvents("go_to_author")})),this.descEl=Object(a.geByClass1)("stories_desc",l),this.authorButtons=Object(a.geByClass1)("stories_author_buttons",l),l},e.prototype.showFeatureTooltipIfNeed=function(e){var t=this;window.cur.showStoriesFeatureTooltip&&!window.cur.storiesFeatureTooltip&&e&&(window.cur.storiesFeatureTooltipTimeoutId=setTimeout((function(){var o=Object(a.se)('\n        <div>\n          <div class="stories_feature_tt_close" onclick="window.cur.storiesFeatureTooltip.hide(); cancelEvent(event);"></div>\n          <div>'+Object(be.getLang)("stories_feature_narrative_users")+"</div>\n        </div>\n     ");Object(j.addEvent)(o,"click",(function(){window.cur.storiesFeatureTooltip.hide()})),window.cur.storiesFeatureTooltip=new _t.default(e,{appendToParent:!0,autoShow:!1,forceSide:"top",cls:"eltt_fancy stories_feature_tt",offset:[1,-3],content:o,align:"right",onHide:t._closeFeatureTooltip.bind(t)}),t.pauseStory(),window.cur.storiesFeatureTooltip.show(),clearTimeout(window.cur.storiesFeatureTooltipTimeoutId)}),2e3),window.cur.destroy&&window.cur.destroy.push((function(){return clearTimeout(window.cur.storiesFeatureTooltipTimeoutId)})))},e.prototype._closeFeatureTooltip=function(e){void 0===e&&(e=!0),window.cur.storiesFeatureTooltip&&(window.cur.showStoriesFeatureTooltip=!1,window.cur.storiesFeatureTooltip.destroy(),window.cur.storiesFeatureTooltip=null,e&&this.playStory(),window.ajax.post("al_index.php",{act:"hide_feature_tt",hash:window.cur.storiesFeatureTooltipHash,type:"profile_narrative"},{onDone:function(){}}))},e.prototype._renderFollowButton=function(){var e=this;return this.followBtn=Object(a.ce)("div",{className:"stories_author_button stories_follow"}),Object(j.addEvent)(this.followBtn,"click",this._onFollowBtnClick.bind(this)),Object(j.addEvent)(this.followBtn,"mouseover",(function(){var t=Object(a.hasClass)(e.followBtn,"followed")?Object(be.getLang)("stories_unfollow"):Object(be.getLang)("stories_follow");Object(J.showTooltip)(e.followBtn,{black:1,center:1,shift:[0,5,0],text:t,appendEl:e.contWrap})})),this.followBtn},e.prototype._renderTimeLine=function(){var e=this;this.timeLineEl=Object(a.ce)("div",{className:"stories_time_line"});var t=this.data.author.id;return this.data.items.map((function(o,i){var r=Object(a.ce)("div",{className:"stories_time_line_item"});Object(j.addEvent)(r,"click",(function(){e.layer._sendNavigationStatEvents("go_to_story_click"),e.changeStory(i)}));var s=Object(a.ce)("div",{className:"stories_time_line_item_cont"});s.appendChild(Object(a.ce)("div",{className:"stories_time_line_item_cont_active"})),r.appendChild(s),o.isOneTime&&window.vk.id!==t&&(r.appendChild(Object(a.ce)("div",{className:"stories_time_line_item_wick"})),Object(a.addClass)(r,"stories_time_line_item_is_one_time")),e.timeLineEl.appendChild(r)})),this.timeLineEl},e.prototype.isPaused=function(){return!this.story||this.story.isPaused()},e.prototype.isLoaded=function(){return!this.story||this.story.isLoaded()},e.prototype._onMouseDownHandle=function(e){this.pressedStory=e,this.isActive&&(this.isLocked()||(Object(a.hasClass)(e,"stories_item_cont")||Object(a.hasClass)(e,"stories_item_back")||Object(a.hasClass)(e,"StoryStickers__disableArea"))&&!this.downTs&&(this.downTs=Object(c.vkNow)(),this.longTapTimer=setTimeout(this._longTapHandle.bind(this),R.LONG_PRESS_DELAY_MS)))},e.prototype._onMouseUpHandle=function(e){clearTimeout(this.longTapTimer);var t=this.downTs;if(delete this.downTs,e===this.pressedStory){this.pressedStory=null;var o=!(Object(c.vkNow)()-t<R.LONG_PRESS_DELAY_MS&&!this.isSendFormActive&&!Object(a.hasClass)(this.wrapEl,"autoplay_failed"));if(this.isActive&&(Object(a.hasClass)(e,"stories_item_back")||Object(a.hasClass)(e,"StoryStickers__disableArea--left"))&&!o&&!this.isTooltipOpened())return this.prevStory();if(Object(a.hasClass)(e,"stories_item_cont")||Object(a.hasClass)(e,"stories_item_back")||Object(a.hasClass)(e,"StoryStickers__disableArea"))if(this.isFeedbackTooltipShow&&this.hideFeedbackTooltip(),Object(a.removeClass)(this.wrapEl,"paused"),this.isTooltipOpened())this.hideTooltip();else{if(!this.isActive){this.id>=this.layer.activeStory.id&&this._markSeenCurrentStory(!0);var i=this.layer.storiesBlocks;return i.indexOf(this.layer.getBlockKey(this))>i.indexOf(this.layer.blockKey)?this.layer._sendNavigationStatEvents("go_to_next_author"):this.layer._sendNavigationStatEvents("go_to_previous_author"),void this.opts.onSelect(this)}o?this.isPaused()&&this.playStory(!1,!!t):this._onPlayEnd()}}},e.prototype._markSeenIfNeeded=function(e){this.isActiveStoryOneTime()&&this._markSeenCurrentStory(e)},e.prototype._markSeenCurrentStory=function(e){void 0===e&&(e=!1),this.opts.onSeen(this.layer.activeStory,e)},e.prototype._longTapHandle=function(){this.isActiveStoryOneTime()||(this.story&&this.story.pause(),Object(a.addClass)(this.wrapEl,"paused"),this.isTooltipOpened()||this.layer._sendNavigationStatEvents("pause_long_tap"))},e.prototype.isLocked=function(){return!!(this.getSendText()||!this.isActive||this.isSendFormActive||this.isModalShown||this.isFeedbackTooltipShow||document.hidden||this._isActionsShown()||Object(a.isVisible)(this.inlineLoader)||Object(a.hasClass)(this.wrapEl,"hiding_reply")||Object(ie.curBox)()&&"stories"!==Object(ie.curBox)().wkRaw||this.story&&this.story.isPausedByMetaScroll)},e.prototype.isSpaceLongTabAvailable=function(){return!(this.story&&this.story.isPausedByMetaScroll)},e.prototype.isGroupedStory=function(){return this.data.is_groups},e.prototype.autoResumeStory=function(e){void 0===e&&(e=!1),this.audioPlaying||this.isTooltipOpened()||this.playStory(!1,e)},e.prototype.playStory=function(e,t){void 0===e&&(e=!1),void 0===t&&(t=!1),this.isLocked()||(Object(a.removeClass)(this.wrapEl,"paused"),Object(a.hide)(Object(a.ge)("box_layer_bg")),Object(a.hide)(Object(a.ge)("box_layer_bg").nextSibling),this.story&&!e||this._initStory(),this.story&&this.story.play(),t&&this.layer._sendNavigationStatEvents("resume_release"),delete this.downTs)},e.prototype.pauseStory=function(e){this.story&&(this.isPaused()||(e&&Object(a.addClass)(this.wrapEl,"paused"),this.story.pause()))},e.prototype.changeStory=function(e){this.index===e||this.isSendFormActive||(this._destroyStory(),this.index=e,this.hideTooltip(),this._setPreview(),this.playStory())},e.prototype.getWrap=function(){return this.wrapEl},e.prototype.stop=function(){this._destroyFeedBackTT(),this.isActive=!1,this._destroyStory(),this._stopLoader(),Object(a.val)(Object(a.geByClass1)("stories_send_form_text",this.wrapEl),""),this._unlockSendForm(),Object(a.removeClass)(this.wrapEl,"autoplay_failed")},e.prototype.getCurStoryData=function(){var e=this.data.items[this.index];return e||Object(Ge.logError)(new Error("getCurStoryData: data is undefined"),{environment:"stories"}),e},e.prototype.isActiveLive=function(){var e;return"live"===(null===(e=this.getCurStoryData())||void 0===e?void 0:e.type)},e.prototype.isLiveEnded=function(){return!!this.story&&(this.isActiveLive()&&this.story.liveEnded)},e.prototype._initStory=function(){var e=this.getCurStoryData();if(e){var t=e.type,o=e.noSound;this.story&&this._destroyStory(),at(this),Object.assign(e,{authorId:this.getOwnerId()});var r={onLoadingStart:this._onLoadingStart.bind(this),onLoadingEnd:this._onLoadingEnd.bind(this),onPlay:this._onPlay.bind(this),onPause:this._onPause.bind(this),onError:this._showError.bind(this),onLongLoading:this._showLoader.bind(this),onAutoPlayFail:this._onAutoPlayFail.bind(this)};if("live"===t)this.story=new et(e,r,this.wrapEl);else{"video"===t?(this.story=new ot(e,r),o&&this.opts.restoreAudioPlay(),Object(a.addClass)(this.wrapEl,"video")):(this.story=new rt(e,r),this.opts.restoreAudioPlay(),Object(a.removeClass)(this.wrapEl,"video"));var n=this.story.getDate();e.isPromo?n=e.promoCaption:e.narrative?n="· "+Object(be.getLang)("global_type_narrative")+" · "+e.narrative.title:e.isAds&&(n=Object(be.getLang)("stories_is_ad")),Object(a.val)(this.descEl,n),this.fillTimeLine()}if("live"===t||"video"===t)b()>0&&this.opts.onVideoPlay();this.opts.onStartStory(),Object(a.toggleClass)(this.wrapEl,"stories_can_comment",e.can_comment),e.reply_to&&!this.hasSticker(R.StickerTypes.storyReply)&&this.replyToWrap.appendChild(this._renderReplyTo()),this.story.isGroupsMetaStory=e.is_groups_meta_story,this.story.isAppsMetaStory=e.is_apps_meta_story,!this.data.author.can_follow||this.data.is_promo||this.isActiveLive()||this.authorButtons.appendChild(this._renderFollowButton()),this._destroyFeedBackTT(),this.story.isGroupsMetaStory||this.story.isAppsMetaStory||(this.updateBottom(),this.contWrap.appendChild(this.story.render())),e.clickable_stickers&&(this.stickerLayers=s.render(i.createElement(ee,{story:this.story,storyData:e,author:this.data.author,showMessage:this._showMessage.bind(this),playStory:this.playStory.bind(this),pauseStory:this.pauseStory.bind(this),hideFeedbackTooltip:this.hideFeedbackTooltip.bind(this),onModalShownChange:this._onModalsShownChange.bind(this),onMouseUpHandle:this._onMouseUpHandle.bind(this),onMouseDownHandle:this._onMouseDownHandle.bind(this),sendNavigationStatEvents:this.layer._sendNavigationStatEvents.bind(this.layer),markAppNotificationsSeen:this.markAppNotificationsSeen,list:this.layer.list,layerEl:this.layer.layerEl,el:this.contWrap}),this.contStickers)),this.story.isGroupsMetaStory&&(Object(a.addClass)(this.contWrap,"stories_item_cont_wrap_meta_story"),Object(a.addClass)(this.contWrap,"stories_item_cont_wrap_meta_story_groups"),this.contWrap.appendChild(this.story.render()),this.authorButtons.appendChild(Object(a.ce)("div",{className:"stories_groups_settings_text stories_groups_settings_text_hide",innerHTML:Object(be.getLang)("stories_groups_grid_title")})),Object(a.re)(Object(a.geByClass1)("stories_photo",this.contWrap)),Object(a.re)(Object(a.geByClass1)("stories_video",this.contWrap)),this.contWrap.appendChild(this.story.renderGroupsMetaStory())),this.data.is_apps&&(this.story.isAppsMetaStory?(Object(a.addClass)(this.contWrap,"stories_item_cont_wrap_meta_story"),Object(a.addClass)(this.contWrap,"stories_item_cont_wrap_meta_story_apps"),this.contWrap.appendChild(this.story.render()),this.authorButtons.appendChild(Object(a.ce)("div",{className:"stories_groups_settings_text stories_groups_settings_text_hide",innerHTML:Object(be.getLang)("stories_groups_grid_title")})),Object(a.setStyle)(Object(a.geByClass1)("stories_preview",this.contWrap),{backgroundImage:""}),Object(a.re)(Object(a.geByClass1)("stories_photo",this.contWrap)),Object(a.re)(Object(a.geByClass1)("stories_video",this.contWrap)),this.contWrap.appendChild(this.story.renderAppsMetaStory())):(Object(a.removeClass)(this.contWrap,"stories_item_cont_wrap_meta_story"),Object(a.removeClass)(this.contWrap,"stories_item_cont_wrap_meta_story_apps")))}else Object(Ge.logError)(new Error("Fail: _initStory"),{environment:"stories"})},e.prototype.hasSticker=function(e){var t=this.getCurStoryData();if(!t||!t.clickable_stickers)return!1;var o=t.clickable_stickers.stickers;return!!Array.isArray(o)&&o.some((function(t){return t.type===e}))},e.prototype.getSticker=function(e){var t=this.getCurStoryData();if(t&&t.clickable_stickers){var o=t.clickable_stickers.stickers;if(Array.isArray(o))return o.find((function(t){return t.type===e}))}},e.prototype.isTooltipOpened=function(){return this.stickerLayers&&this.stickerLayers.isShownTooltip()},e.prototype.hideTooltip=function(e){void 0===e&&(e=!1),this.isTooltipOpened()&&(this.stickerLayers&&this.stickerLayers.hideTooltip(),e||this.playStory())},e.prototype.getReplies=function(){return this.story&&this.story.getReplies()},e.prototype.getViews=function(){return this.story&&this.story.getViews()},e.prototype.setReplies=function(e){return this.story&&this.story.setReplies(e)},e.prototype.setViews=function(e){return this.story&&this.story.setViews(e)},e.prototype.indexToUnread=function(e){void 0===e&&(e=!1);var t=this.data.items,o=0;for(var i in t)if(t[i].unread&&!this.layer._hasContext("all")){o=Number(i);break}if(e)return o;this.index=o,this._setPreview()},e.prototype.indexToStoryById=function(e){var t=this.data.items,o=-1;for(var i in t)if(t[i].raw_id===e){o=Number(i);break}this.layer._hasContext("all")&&(o=0),o>-1?(this.index=o,this._setPreview()):this.indexToUnread()},e.prototype.fillTimeLine=function(){var e=this.timeLineEl;if(e)for(var t=0;t<e.children.length;t++){var o=Object(a.geByClass1)("stories_time_line_item_cont_active",e.children[t]);t===this.index&&(this._currentTimeLineEl=o,this._currentTimeLineAdditionalEl=Object(a.geByClass1)("stories_time_line_item_wick",e.children[t]));var i=t<this.index?100:0;Object(a.setStyle)(o,"transform","translateX("+i+"%)")}},e.prototype._destroyStory=function(){if(this.story){this.updateBottom(!0),window.tooltips&&window.tooltips.hideAll(),this.hideTooltip(),this._resetErrors(),this._destroyFeedBackTT(),this._closeFeatureTooltip(!1),this.story.pause(),Object(a.removeClass)(this.contWrap,"stories_item_cont_wrap_meta_story"),Object(a.re)(Object(a.geByClass1)("MetaStory",this.contWrap)),Object(a.removeClass)("stories_item_cont_wrap_meta_story_groups",this.contWrap);var e=this.getCurStoryData();e&&e.clickable_stickers&&(s.unmountComponentAtNode(this.contStickers),delete this.stickerLayers),cancelAnimationFrame(this.timeLineAnim);try{this.contWrap.removeChild(this.story.getContainer()),this.story.destroy()}catch(e){Object(Ge.logError)(e)}this._replyHideEnd(),Object(j.removeEvent)(this.followBtn),Object(a.val)(this.authorButtons,""),Object(j.removeEvent)(this.answersEl),Object(j.removeEvent)(Object(a.geByClass1)("stories_reply_to",this.replyToWrap)),Object(a.val)(this.replyToWrap,""),this.hideInlineLoader(),delete this.story}},e.prototype._timeLineUpdate=function(){var e=this.story;if(e&&!e.isPaused()&&!this.isActiveLive()){var t=this.getStoryProgressPercent(),o=t/100;if(Object(a.setStyle)(this._currentTimeLineEl,"transform","translateX("+t+"%) translateZ(0)"),this._currentTimeLineAdditionalEl&&this._currentTimeLineEl){var i=this._currentTimeLineEl.clientWidth*o;Object(a.setStyle)(this._currentTimeLineAdditionalEl,"transform","translateX("+i+"px) translateZ(0)")}t<100?this.timeLineAnim=requestAnimationFrame(this._timeLineUpdate.bind(this)):this._onPlayEnd(!0)}},e.prototype.getStoryProgressPercent=function(){if(!this.story)return 0;var e=this.story.getCurrentTime(),t=this.story.getDuration();return Math.max(0,Math.min(100,e/t*100))},e.prototype._onLoadingStart=function(){this._loadingStartTime=new Date},e.prototype._onLoadingEnd=function(){this._loadingStartTime&&(this.loadingTime=Date.now()-this._loadingStartTime,this.layer._sendViewerStartTime(this.getRawId(),this.loadingTime),this._loadingStartTime=0)},e.prototype._onPlay=function(){this._resetErrors(),this._stopLoader(),this._timeLineUpdate(),this.preloadNextStory(),this.opts.onPlayStory(),Object(a.removeClass)(this.wrapEl,"animate_story"),Object(a.removeClass)(this.wrapEl,"autoplay_failed"),this.data.is_groups||this.isAppsMetaStoryActive()||(this.data.items[this.getIndex()].unread=!1),this._updateFeedStoryPreview(),at(this)},e.prototype._onPause=function(){cancelAnimationFrame(this.timeLineAnim),at(this)},e.prototype._onPlayEnd=function(e){void 0===e&&(e=!1),this._markSeenIfNeeded(),this.nextStory(e)},e.prototype.nextStory=function(e){if(void 0===e&&(e=!1),!this.isLocked()){var t=this.data.items;e||this.layer._sendNavigationStatEvents("go_to_next_story_tap");var o=this.index+1;o<t.length?(e&&this.layer._sendNavigationStatEvents("go_to_next_story_auto_by_time"),this.changeStory(o)):(this.opts.onStoriesEnd(e),this._destroyStory())}},e.prototype.prevStory=function(){if(this.isFeedbackTooltipShow&&this.hideFeedbackTooltip(),!this.isLocked()){this.layer._sendNavigationStatEvents("go_to_previous_story");var e=this.index-1;e>=0?this.changeStory(e):(this.opts.playPrevOwner(),this._destroyStory())}},e.prototype.getOffsetLeft=function(){return this.wrapEl.offsetLeft+this.wrapEl.offsetWidth/2},e.prototype.getWidth=function(){return this.wrapEl.offsetWidth},e.prototype.removeStoryBox=function(){var e=this,t=this.getCurStoryData();if(t){var o=t.isPartOfNarrative?Object(be.getLang)("stories_remove_from_narrative_warning"):Object(be.getLang)("stories_remove_warning");this.pauseStory(),Object(W.showFastBox)({title:Object(be.getLang)("global_warning"),onHide:function(){e.playStory()}},o,Object(be.getLang)("stories_remove_confirm"),this.removeStory.bind(this),Object(be.getLang)("global_cancel"))}else Object(Ge.logError)(new Error("Fail: removeStoryBox"),{environment:"stories"})},e.prototype.removeStory=function(e){var t=this;this.pauseStory();var o=this.getIndex(),i=this.getRawId(),r={act:"remove_story",story_raw:i,hash:this.data.remove_hash,moder_remove_hash:this.data.moder_remove_hash};Object(ft.isClaimContent)()&&(r.claim=window.nav.objLoc.claim),window.ajax.post("al_stories.php",r,{onDone:function(e){t.layer._sendNavigationStatEvents("delete"),window.cur.module===R.STORIES_MANAGE_MODULE&&window.GeStories.storyDidRemove(i,e),Object(ie.curBox)().hide(),t._popStoryAndClearList(o)},showProgress:function(){return Object(mt.lockButton)(e)},hideProgress:function(){return Object(mt.unlockButton)(e)}})},e.prototype.removeNarrativeBox=function(){var e=this;this.pauseStory(),Object(W.showFastBox)({title:Object(be.getLang)("global_warning"),onHide:function(){e.playStory()}},Object(be.getLang)("stories_narrative_remove_warning"),Object(be.getLang)("stories_remove_confirm"),this.removeNarrative.bind(this),Object(be.getLang)("global_cancel"))},e.prototype.removeNarrative=function(e){var t=this;this.pauseStory();var o=this.getCurStoryData();if(o){var i=o.narrative,r=i.owner_id,s=i.id;window.ajax.post("al_stories.php",{act:"remove_narrative",narrative_raw:r+"_"+s,hash:this.data.remove_hash,moder_remove_hash:this.data.moder_remove_hash},{onDone:function(){Object(ie.curBox)().hide(),t._popCoverAndCleanNarrativeList(),window.cur.narrativeBlock&&window.cur.narrativeBlock.updateBlock()},showProgress:function(){return Object(mt.lockButton)(e)},hideProgress:function(){return Object(mt.unlockButton)(e)}})}else Object(Ge.logError)(new Error("Fail: removeNarrative"),{environment:"stories"})},e.prototype._popCoverAndCleanNarrativeList=function(){this.opts.removeList(),this._remove(!1,function(){var e,t;null===(t=null===(e=window.cur.storyLayer)||void 0===e?void 0:e.activeStory)||void 0===t||t._popStoryAndClearList(window.cur.storyLayer.activeStory.getIndex())}.bind(this))},e.prototype.sendNarrativeBookmarkButtonDidPress=function(){var e=this,t=this.getCurStoryData();if(t){var o=t.narrative;window.ajax.post("al_bookmarks.php",{act:"bookmark",owner_id:o.owner_id,object_id:o.id,type:"narrative",state:o.is_bookmarked?1:0,hash:o.bookmark_hash,ref:window.cur.module},{onDone:function(t){Object(ie.showDoneBox)(t||Object(be.getLang)("stories_narrative_bookmark_deleted"),{className:"stories_done_msg"}),o.is_bookmarked=!o.is_bookmarked,e.updateBottom()}})}else Object(Ge.logError)(new Error("Fail: sendNarrativeBookmarkButtonDidPress"),{environment:"stories"})},e.prototype._sendNarrativeEditButtonDidPress=function(){var e=this.getCurStoryData();if(e)if(this.getOwnerId()>0&&Object(Ue.partConfigEnabled)("narratives_new"))this.editCurrentNarrative();else{var t=e.narrative;window.nav.go(this.data.author.href+"?act=narrative_edit&nid="+t.id)}else Object(Ge.logError)(new Error("Fail: _sendNarrativeEditButtonDidPress"),{environment:"stories"})},e.prototype._popStoryAndClearList=function(e){this._removeStoryFromMemoryByIndex(e),0===this.data.items.length&&M(this.getOwnerId())},e.prototype._removeStoryFromMemoryByIndex=function(e,t){void 0===t&&(t=!1),this.data.items.splice(e,1);var o=this.data.items.length;o?(this._initTimeLine(),o>e?this.isActive&&this.playStory(!0):this.isActive&&this.nextStory()):this._remove(t)},e.prototype._remove=function(e,t){this.opts.onStoryRemoved(e,t)},e.prototype.shareBox=function(){var e=this;if(this.story){var t=this.getCurStoryData();if(t){var o,i=t.narrative;o=i?"narrative"+i.owner_id+"_"+i.id:"story"+this.story.getId(),this.pauseStory(),Object(W.showBox)("like.php",{act:"publish_box",object:o,from:"wkview"},{onDone:function(){e.autoResumeStory()},params:{onHide:function(){e.autoResumeStory()}}})}else Object(Ge.logError)(new Error("Fail: shareBox"),{environment:"stories"})}},e.prototype.toggleLikeStory=function(){var e=this;if(this.story){var t=this.story.data,o=t.isLiked,i=t.likeHash,r=t.accessKey,s=this.getRawId(),n={act:o?"delete_like":"like",hash:i,story_raw_id:s};o||Object.assign(n,{access_key:r}),t.isLiked=!o,this.updateBottom(),window.ajax.post("al_stories.php",n,{onDone:function(){},onFail:function(){return t.isLiked=o,e.updateBottom(),!0}})}},e.prototype.onAnswerSend=function(e,t,o,i){var r=this;void 0===t&&(t=[]),void 0===o&&(o={}),void 0===i&&(i={});var s=this.getSendText();if((s||t.length)&&this.story)if(this.isActiveLive())this.story.sendMessage(s,e);else{var n=this.story.data.narrative;n?t.push(["narrative",n.owner_id+"_"+n.id]):t.push(["story",this.story.getId()]),window.ajax.post("al_im.php",Object.assign({act:"a_send",msg:s,hash:this.data.send_hash,media:Object(vt.convertAttachesToPhpMedia)(t),entrypoint:"stories_comment",to:this.getOwnerId()},o),{onDone:function(){r._onAnswerSent(e,o,i)},onFail:function(e){return r._showMessage(e).catch((function(e){Object(Ge.logError)(e)})),!0},showProgress:function(){Object(a.val)(r.sendFormButton,r._getLoaderHtml()),Object(a.addClass)(r.sendFormButton,"sending")},hideProgress:function(){Object(a.val)(r.sendFormButton,""),Object(a.removeClass)(r.sendFormButton,"sending")}})}},e.prototype._onAnswerSent=function(e,t,o){var i=this;if(void 0===e&&(e=function(){}),void 0===t&&(t={}),void 0===o&&(o={}),!this.isActiveLive()){this._showMessage(Object(be.getLang)("stories_answer_sent")).then((function(){i.playStory()})).catch((function(e){Object(Ge.logError)(e)}));var r=t.sticker_referrer||"",s={},n="";"story_keyboard"===r?n="sticker_keyboard_send":r.startsWith("story_suggestion_")?n="sticker_suggestion_send":"story_reaction"===r?(n="sticker_reaction_send",s.reaction_name=o.reactionName):n="comment_send",this.layer._sendNavigationStatEvents(n,!0,s)}Object(a.val)(Object(a.geByClass1)("stories_send_form_text",this.wrapEl),""),this._blurSendForm(),this.pauseStory(),e&&e()},e.prototype.onSendFormFocus=function(){var e=this;this.pauseStory(),this.isActiveLive()||this._toggleSendFormOverlay(!0),this.hideTooltip(!0),this.hideFeedbackTooltip(),Object(S.cancelStackPush)("stories_form_focus",(function(){ht.Emoji.shown||(e._resetFendForm(),e._blurSendForm())}))},e.prototype._toggleSendFormOverlay=function(e){void 0===e&&(e=!1),Object(a.toggleClass)(this.storySendFormOverlay,"stories_bottom_overlay_available",this.isSendFormActive=e)},e.prototype._blurSendForm=function(){var e=Object(a.geByClass1)("stories_send_form_text",this.wrapEl);e&&e.blur()},e.prototype.getSendText=function(){var e=ht.Emoji.editableVal(Object(a.geByClass1)("stories_send_form_text",this.wrapEl));return Object(c.trim)(e)},e.prototype.onSendFormBlur=function(){var e=this.getSendText();this.isActiveLive()||this._toggleSendFormOverlay(!1),e||this._resetFendForm()},e.prototype._unlockSendForm=function(){this.isSendFormActive&&(this.isSendFormActive=!1)},e.prototype._resetFendForm=function(){this._unlockSendForm(),this.playStory(),Object(a.val)(Object(a.geByClass1)("stories_send_form_text",this.wrapEl),"")},e.prototype._emojiOnKeyAction=function(){this.getSendText()?Object(a.addClass)(this.sendFormButton,"active"):Object(a.removeClass)(this.sendFormButton,"active")},e.prototype._getLoaderHtml=function(){return'<svg class="stories_view_loader_circular" viewBox="25 25 50 50">\n      <circle class="stories_view_loader_circular_path" cx="50" cy="50" r="20" fill="none" stroke-width="4" stroke-miterlimit="10"/>\n    </svg>'},e.prototype.preloadNextStory=function(e){if(void 0===e&&(e=this.index+1),!this.preloadedStories[e]){var t=this.data.items[e];if(t){this.preloadedStories[e]=!0;var o=t[t.type+"_url"];o&&("video"===t.type?g(o).catch((function(e){return Object(Ge.logError)(e)})):v(o).catch((function(e){return Object(Ge.logError)(e)})))}}},e.prototype._addToBlacklist=function(){window.cur.storyLayer&&window.cur.storyLayer.pauseStory(),Object(W.showFastBox)({title:Object(be.getLang)("stories_add_blacklist_title"),onHide:function(){window.cur.storyLayer&&window.cur.storyLayer.playStory()}},this.getOwnerId()<0?Object(be.getLang)("stories_add_blacklist_message_group"):Object(be.getLang)("stories_add_blacklist_message"),Object(be.getLang)("stories_add_blacklist_button"),this._doAddToBlacklist.bind(this),Object(be.getLang)("global_cancel"))},e.prototype._doAddToBlacklist=function(e){var t=this;window.ajax.post("al_stories.php",{act:"blacklist_add",owner_id:this.getOwnerId(),hash:this.data.blacklist_hash,source_story:this.getRawId(),track_code:this.getTrackCode()},{onDone:function(){t.data.can_blacklist=!1,t.layer._sendNavigationStatEvents("hide_from_stories"),Object(ie.curBox)().hide(),t.opts.removeList(),t._remove()},showProgress:function(){return Object(mt.lockButton)(e)},hideProgress:function(){return Object(mt.unlockButton)(e)}})},e.prototype.markNotInterested=function(){var e=this,t=this.getCurStoryData();t?(this._showMessage(Object(be.getLang)("stories_thanks_feedback")).catch((function(e){Object(Ge.logError)(e)})),window.ajax.post("al_stories.php",{act:"mark_not_interested",story_raw_id:this.getRawId(),track_code:t.track_code,hash:t.canMarkNotInterestedHash},{onDone:function(){e.layer._sendNavigationStatEvents("mark_not_interested")}})):Object(Ge.logError)(new Error("Fail: markNotInterested"),{environment:"stories"})},e.prototype._resetErrors=function(){var e=Object(a.geByClass1)("stories_error_wrap",this.contWrap);e&&(Object(j.removeEvent)(Object(a.geByClass1)("stories_error_button",e)),Object(a.re)(e)),Object(a.removeClass)(this.wrapEl,"failed"),Object(a.removeClass)(this.wrapEl,"fatal_error")},e.prototype._showError=function(e){var t=this;if(this.contWrap){var o,i,r=e;switch(e){case"load":o=Object(be.getLang)("stories_error_cant_load"),i=Object(a.ce)("div",{className:"stories_error_button",innerHTML:Object(be.getLang)("stories_try_again")}),Object(j.addEvent)(i,"click",(function(){t._destroyStory(),t.playStory()}));break;case"expired":o=Object(be.getLang)("stories_error_expired");break;case"deleted":o=Object(be.getLang)("stories_error_deleted");break;case"private":o=Object(be.getLang)("stories_error_private");break;case"deleted-narrative":o=Object(be.getLang)("stories_error_deleted_narrative");break;case"private-narrative":o=Object(be.getLang)("stories_error_private_narrative");break;case"isOneTimeSeen":o=Object(be.getLang)("stories_error_one_time_seen");break;default:o=Object(be.getLang)("global_unknown_error")}this._resetErrors(),this._stopLoader();var s=Object(a.ce)("div",{className:"stories_error_wrap"}),n=Object(a.ce)("div",{className:"stories_error"}),l=Object(a.ce)("div",{className:"stories_error_cont"});n.appendChild(l),l.appendChild(Object(a.ce)("div",{className:"stories_error_icon "+r})),l.appendChild(Object(a.ce)("div",{className:"stories_error_caption",innerHTML:o})),i&&l.appendChild(i),s.appendChild(n),this.contWrap.appendChild(s),Object(a.addClass)(this.wrapEl,"failed"),Object(c.inArray)(e,["expired","deleted","private","deleted-narrative","private-narrative"])&&Object(a.addClass)(this.wrapEl,"fatal_error")}},e.prototype._stopLoader=function(){var e=this;setTimeout((function(){Object(a.re)(Object(a.geByClass1)("stories_loader",e.contWrap))}),0)},e.prototype._showLoader=function(){if(this._stopLoader(),this.isActive&&(!this.isLoaded()||this.isPaused())&&this.contWrap){var e=Object(a.ce)("div",{className:"stories_loader",innerHTML:this._getLoaderHtml()});this.contWrap.appendChild(e)}},e.prototype._onFollowBtnClick=function(){var e,t,o=this;(this.pauseStory(),this.followBtnLock)||(this.followBtnLock=!0,this.data.author.id>0?(t="al_friends",e=this.data.author.can_follow?"add":"remove"):(t="al_groups",e=this.data.author.can_follow?"a_enter":"a_leave"),window.ajax.post(t+".php",{act:e,mid:this.getOwnerId(),gid:-this.getOwnerId(),hash:this.data.author.hash,from:"stories"},{onDone:function(){o.data.author.can_follow&&o.sendStatEvent("follow"),o.data.author.can_follow=!o.data.author.can_follow,Object(a.toggleClass)(o.followBtn,"followed",!o.data.author.can_follow),o._showMessage(Object(be.getLang)(o.data.author.can_follow?"stories_unfollowed":"stories_followed")).then((function(){return o.playStory()})).catch((function(e){Object(Ge.logError)(e)})),window.tooltips&&window.tooltips.destroy(o.followBtn),Object(j.triggerEvent)(o.followBtn,"mouseover")},showProgress:function(){return o.showInlineLoader()},hideProgress:function(){o.hideInlineLoader(),o.followBtnLock=!1}}))},e.prototype._getDimensions=function(){var e=Object(a.getSize)(this.wrapEl),t=e[0],o=e[1],i=Object(a.getXY)(this.wrapEl),r=i[0];return{width:t,height:o,top:i[1]-Object(pt.scrollGetY)(),left:r-Object(pt.scrollGetX)()}},e.prototype.markAsActive=function(){this.isActive=!0,Object(a.addClass)(this.wrapEl,"animate_story")},e.prototype._renderReplyTo=function(){var e=this,t=this.getCurStoryData();if(t){var o=t.reply_to,i=o.list,r=o.photo_url,s=o.name,n=o.is_deleted,c=o.is_private,l=o.is_expired,d=o.raw_id,u=Object(a.se)('<div class="stories_reply_to" style="background-image: url('+r+')">\n  <div class="stories_reply_to_error_msg"></div>\n  <div class="stories_reply_to_owner_name_wrap">\n    <div class="stories_reply_to_owner_name">'+s+"</div>\n  </div>\n</div>");Object(j.addEvent)(u,"click",(function(){e.layer._sendNavigationStatEvents("open_parent_story");var t=I();E.length>1&&t.getStoryRaw()===d?Object(S.cancelStackPop)():Object(ve.showStory)(i,{fromEl:u,source:"reply_story"})}));var p="";return n?(Object(a.addClass)(u,"deleted"),p=Object(be.getLang)("stories_deleted_story")):c?(Object(a.addClass)(u,"private"),p=Object(be.getLang)("stories_private_story")):l&&(Object(a.addClass)(u,"expired"),p=Object(be.getLang)("stories_expired_story")),p&&(Object(a.val)(Object(a.geByClass1)("stories_reply_to_error_msg",u),p),Object(a.re)(Object(a.geByClass1)("stories_reply_to_owner_name_wrap",u))),u}Object(Ge.logError)(new Error("Fail: _renderReplyTo"),{environment:"stories"})},e.prototype.sendMask=function(){var e=this;if(this.layer._sendNavigationStatEvents("click_to_mask"),!this._maskSending){var t=this.getCurStoryData();t?(this._maskSending=!0,this.pauseStory(),window.ajax.post("al_stories.php",{act:"send_mask",mask_id:t.mask_id,hash:this.data.send_mask_hash},{onDone:function(t,o,i,r){"cant_send"===t?Object(W.showFastBox)({title:o,width:460,onHide:function(){e.playStory()}},i,r):e._showMessage(Object(be.getLang)("stories_mask_sent")).then((function(){return e.playStory()})).catch((function(e){Object(Ge.logError)(e)}))},showProgress:function(){return e.showInlineLoader()},hideProgress:function(){e._maskSending=!1,e.hideInlineLoader()}})):Object(Ge.logError)(new Error("Fail: sendMask"),{environment:"stories"})}},e.prototype._destroyFeedBackTT=function(){delete this.feedback,this.hideFeedbackTooltip()},e.prototype.hideFeedbackTooltip=function(){this.isFeedbackTooltipShow&&(this.isFeedbackTooltipShow=!1,this.autoResumeStory(),this.updateBottom(),Object(S.cancelStackPop)())},e.prototype.showFeedbackTooltip=function(){var e=this;this.isFeedbackTooltipShow||(this.hideTooltip(),this.pauseStory(),this.isFeedbackTooltipShow=!0,this.updateBottom(),this.layer._sendNavigationStatEvents("open_replies_list"),Object(S.cancelStackPush)("stories_feedback_tt",(function(){e.hideFeedbackTooltip()})))},e.prototype._onModalsShownChange=function(e){void 0===e&&(e=!1),this.isModalShown=e},e.prototype.showInlineLoader=function(){Object(a.show)(this.inlineLoader)},e.prototype.hideInlineLoader=function(){Object(a.hide)(this.inlineLoader)},e.prototype.volumeUpdate=function(){var e=this.story;e&&e.volumeUpdate&&e.volumeUpdate()},e.prototype._onAutoPlayFail=function(){Object(a.addClass)(this.wrapEl,"autoplay_failed")},e.prototype._hideReply=function(){var e=this;Object(W.showFastBox)({title:Object(be.getLang)("global_warning"),onHide:function(){e.autoResumeStory()}},Object(be.getLang)("stories_hide_reply_warning"),Object(be.getLang)("global_continue"),this._doHideReply.bind(this),Object(be.getLang)("global_cancel"))},e.prototype._doHideReply=function(){var e=this;this.pauseStory(),Object(a.addClass)(this.wrapEl,"hiding_reply"),Object(ie.curBox)().hide();var t=this.getIndex(),o=this.data.author.gender,i=Object(a.se)('<div class="stories_hide_reply_wrap loading">\n  <div class="stories_inline_loader">'+Object(gt.getProgressHtml)()+'</div>\n  <div class="stories_hide_reply_cont">\n    <div class="stories_hide_reply_icon"></div>\n    <div class="stories_hide_reply_info">'+Object(be.getLang)("stories_reply_hidden")+'</div>\n    <div class="stories_hide_reply_continue_button _stories_reply_continue">'+Object(be.getLang)("stories_hide_reply_continue")+'</div>\n  </div>\n  <div class="stories_hide_reply_other_actions">\n    <div class="stories_hide_reply_other_action _stories_hide_replies">'+Object(be.langSex)(o,Object(be.getLang)("stories_hide_all_replies"))+'</div>\n    <div></div>\n    <div class="stories_hide_reply_other_action _stories_reply_ban">'+Object(be.getLang)("stories_reply_add_to_blacklist")+"</div>\n  </div>\n</div>");Object(j.addEvent)(Object(a.geByClass1)("_stories_reply_restore",i),"click",this._restoreReply.bind(this)),Object(j.addEvent)(Object(a.geByClass1)("_stories_reply_continue",i),"click",(function(){return e._replyHideEnd(t)})),Object(j.addEvent)(Object(a.geByClass1)("_stories_hide_replies",i),"click",this._hideAllReplies.bind(this)),Object(j.addEvent)(Object(a.geByClass1)("_stories_reply_ban",i),"click",this._ban.bind(this)),this.contWrap.appendChild(i),window.ajax.post("al_stories.php",{act:"hide_reply",raw_id:this.getRawId(),hash:this.data.reply_hide_hash},{onDone:function(){e.opts.removeList(),window.cur.needUpdateFeedStories=!0,Object(a.removeClass)(i,"loading")},onFail:function(){return e._resetReplyHide(),e.playStory(),!0}})},e.prototype._restoreReply=function(e){var t=this;Object(j.cancelEvent)(e);var o=Object(a.geByClass1)("stories_hide_reply_wrap",this.contWrap);window.ajax.post("al_stories.php",{act:"restore_reply",raw_id:this.getRawId(),hash:this.data.reply_hide_hash},{onDone:function(){t._resetReplyHide(),t.playStory()},showProgress:function(){return Object(a.addClass)(o,"loading")},hideProgress:function(){return Object(a.removeClass)(o,"loading")}})},e.prototype._resetReplyHide=function(){Object(a.re)(Object(a.geByClass1)("stories_hide_reply_wrap",this.contWrap)),Object(a.removeClass)(this.wrapEl,"hiding_reply")},e.prototype._hideAllReplies=function(){var e=this.data.author.first_name_gen;Object(W.showFastBox)({title:Object(be.getLang)("global_warning")},Object(be.getLang)("stories_delete_all_replies_confirm").replace("{name}",e),Object(be.getLang)("global_continue"),this._doHideAllReplies.bind(this),Object(be.getLang)("global_cancel"))},e.prototype._doHideAllReplies=function(e){var t=this;window.ajax.post("al_stories.php",{act:"hide_all_replies",owner_id:this.getOwnerId(),hash:this.data.reply_hide_hash},{onDone:function(){Object(ie.curBox)().hide(),t.opts.removeList(),t.data.items=[];var e=Object(a.geByClass1)("_stories_hide_replies",t.contWrap);Object(a.val)(e,Object(be.getLang)("stories_all_replies_hidden")),Object(a.addClass)(e,"disabled")},showProgress:function(){return Object(mt.lockButton)(e)},hideProgress:function(){return Object(mt.unlockButton)(e)}})},e.prototype._ban=function(){var e=this.data.author.first_name_gen;Object(W.showFastBox)({title:Object(be.getLang)("global_warning")},Object(be.getLang)("stories_ban_confirm").replace("{name}",e),Object(be.getLang)("global_continue"),this._doBan.bind(this),Object(be.getLang)("global_cancel"))},e.prototype._doBan=function(e){var t=this;window.ajax.post("al_stories.php",{act:"ban",owner_id:this.getOwnerId(),hash:this.data.stories_ban_hash},{onDone:function(){Object(ie.curBox)().hide(),t.opts.removeList(),t.data.items=[];var e=Object(a.geByClass1)("_stories_reply_ban",t.contWrap);Object(a.val)(e,Object(be.getLang)("stories_banned")),Object(a.addClass)(e,"disabled")},showProgress:function(){return Object(mt.lockButton)(e)},hideProgress:function(){return Object(mt.unlockButton)(e)}})},e.prototype._replyHideEnd=function(e){Object(a.geByClass1)("stories_hide_reply_wrap",this.contWrap)&&(this.data.items.length<=1&&M(this.getOwnerId()),this._resetReplyHide(),this._removeStoryFromMemoryByIndex(e||this.getIndex(),!Object(c.isNumeric)(e)))},e.prototype._feedbackRemoveReplyFromDom=function(e){var t=Object(a.geByClass1)("stories_feedback_content",this.wrapEl);if(t){var o=t.querySelector("#feed_story_"+e);o&&Object(a.addClass)(o,"removed")}},e.prototype.onReplyDeleted=function(e){this._feedbackRemoveReplyFromDom(e)},e.prototype._updateFeedStoryPreview=function(){var e=Object(a.ge)("feed_story_"+this.layer.getBlockKey(this.data));if(e&&!e.classList.contains("stories_feed_reply_item")&&e.classList.contains("stories_feed_preview_item")){var t=this.indexToUnread(!0);if(t){var o=this.data.items[t];o&&o.small_preview&&Object(a.setStyle)(e,"background-image","url("+o.small_preview+")"),e.classList.remove("stories_feed_sticker_icon_show")}}},e.prototype.sendStatEvent=function(e){var t=this.getCurStoryData();t?window.ajax.post("al_stories.php",Object(c.extend)({act:"stat",source_story:this.getRawId()},t.stats[e]),{onDone:function(){}}):Object(Ge.logError)(new Error("Fail: sendStatEvent"),{environment:"stories"})},e.prototype._sendStatStickerEvent=function(e,t){var o=this.getCurStoryData();if(o){var i=o.clickable_stickers;window.ajax.post("al_stories.php",Object.assign({act:"stickers_stat",story_raw_id:this.getRawId(),action:e,hash:i.hash},t),{onDone:function(){}})}else Object(Ge.logError)(new Error("Fail: _sendStatStickerEvent"),{environment:"stories"})},e.prototype.report=function(){var e=this,t=this.getCurStoryData();if(t){var o="story";this.isActiveLive()?o="live":t.narrative&&(o="narrative");var i=Object(W.showBox)("al_stories.php",{act:"report_box",type:o},{onDone:function(){var e=Object(a.geByClass)("radiobtn","stories_report");window.radioBtns.stories_report={val:0,els:e}},params:{onClean:function(){delete window.radioBtns.stories_report,e.playStory()}}});i.removeButtons(),i.addButton(Object(be.getLang)("box_send"),this._sendReportButtonDidPress.bind(this)),i.addButton(Object(be.getLang)("global_cancel"),!1,"no")}else Object(Ge.logError)(new Error("Fail: report"),{environment:"stories"})},e.prototype._sendReportButtonDidPress=function(e){var t=this,o=this.getCurStoryData();if(o){var i,r,s=this.index,n=o.narrative,a=o.report_hash,c="groups"===this.layer.list;n?(i=n.owner_id+"_"+n.id,r=n.report_hash):(i=this.getRawId(),r=a),window.ajax.post("al_stories.php",{act:"report",type:n?"narrative":"story",item_raw:i,reason:window.radioBtns.stories_report.val,hash:r},{onDone:function(){Object(ie.curBox)().hide(),t.layer._sendNavigationStatEvents("claim"),c||n||t._popStoryAndClearList(s),Object(ie.showDoneBox)(Object(be.getLang)("stories_report_sent"),{className:"stories_done_msg"})},showProgress:function(){return Object(mt.lockButton)(e)},hideProgress:function(){return Object(mt.unlockButton)(e)}})}else Object(Ge.logError)(new Error("Fail: _sendReportButtonDidPress"),{environment:"stories"})},e.prototype.onLiveEnded=function(e){void 0===e&&(e=!1),this.isActiveLive()&&(this.data.items[this.index].can_share=!e,this.story&&this.story.onLiveEnded(),this.updateBottom())},e.prototype.updateLiveViewersCount=function(e){Object(a.val)(this.descEl,e)},e.prototype.isActiveStoryOneTime=function(){return this.story&&this.story.isOneTime()},e.prototype.isAppsMetaStoryActive=function(){return!(!this.story||!this.story.isAppsMetaStory)},e.prototype.buildStoryArchiveByActive=function(){var e=this.getRawId(),t=this.getCurStoryData();if(e&&t){var o=e.split("_")[1];return{id:Number(o),rawId:e,listId:this.layer.list,preview:t.small_preview}}},e.prototype.editCurrentNarrative=function(){var e=this,t=this.getCurStoryData();if(t){this.pauseStory(),this.isModalShown=!0;var o=t.narrative_prepared;if(o){var i=[];(null==o?void 0:o.stories.length)&&(i=bt(o.stories));var r={selectedStories:i,narrative:o,onClose:function(){window.cur.narrativeBlock&&window.cur.narrativeBlock.updateBlock(),e.isModalShown=!1,e.updateBottom(),e._popCoverAndCleanNarrativeList()}};Object(yt.showNarrativeEditorBox)(this.getOwnerId(),r)}}},e}(),kt=o("mMuO"),St="user_personal_card",jt="group_personal_card",Et=o("Tn+0");o("HEwt"),o("a1Th"),o("rE2o"),o("KKXr");function Ot(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var o=[],i=!0,r=!1,s=void 0;try{for(var n,a=e[Symbol.iterator]();!(i=(n=a.next()).done)&&(o.push(n.value),!t||o.length!==t);i=!0);}catch(e){r=!0,s=e}finally{try{i||null==a.return||a.return()}finally{if(r)throw s}}return o}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return Ct(e,t);var o=Object.prototype.toString.call(e).slice(8,-1);"Object"===o&&e.constructor&&(o=e.constructor.name);if("Map"===o||"Set"===o)return Array.from(o);if("Arguments"===o||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o))return Ct(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Ct(e,t){(null==t||t>e.length)&&(t=e.length);for(var o=0,i=new Array(t);o<t;o++)i[o]=e[o];return i}function Tt(){var e=navigator.connection;if(!e)return"";var t=e.effectiveType,o=e.downlink;switch(t){case"slow-2g":return"GPRS";case"2g":return"EDGE";case"3g":return"3G";case"4g":return o>8?"wi-fi":"LTE"}return""}var Lt=[];var Bt=[];var xt=o("98sY"),Nt=function(){function e(e,t,o,i,r){this.queue=[],this.storiesIdsSeen={};try{window.Videoview&&window.Videoview.togglePlay(!1)}catch(e){}this.initDOM(),this.show(),this._init(e,t,o,i),Object(a.addClass)(this.layerEl,"shown"),this._source=r.source,this._initViewerSource(),this._sendOpeningEvents()}return e.prototype._init=function(t,o,i,r){var s=t.split("&"),n=s[0],a=s[1],c=void 0===a?"":a,l=n.split("_"),d=l[0],u=l[1];this.storyRaw=n,this.storyOwner=d,this.storyId=+u,this.blockKey=""+d+c,this.list=o,this.storiesList=i,this.extra=e.parseExtra(r),this.extraRaw=r||"",this.initStories().catch((function(){Object(xt.debugLog)("init stories error")}))},e.prototype.initStories=function(){var e=this;return new Promise((function(t){e.storiesBlocks=e.storiesList.map((function(t){return e.getBlockKey(t)}));var o=!1,i=e.storiesBlocks.indexOf(e.blockKey);if(i>-1){var r=e.storiesList[i];o=r.items[r.items.length-1].unread}if(e.extra)switch(e.extra.context){case"new":o=!0;break;case"all":o=!1}if(o&&"replies"===e.list.substr(0,7)&&(o=!1),o){for(var s=[],n=0;n<e.storiesList.length;n++){var c=e.storiesList[n];(c.items[c.items.length-1].unread||0===n&&e._hasContext("new"))&&s.push(c)}s.length&&(e.storiesList=s,e.storiesBlocks=e.storiesList.map((function(t){return e.getBlockKey(t)})))}e.renderedStories={};var l=e._renderStories().activeStory;e.scrollToStory(l,!0),1===e.storiesList.length&&Object(a.addClass)(e.stories,"one_story"),e._startFirstStory(l,e.extra.story_id),Object(a.addClass)(e.stories,"inited"),t()}))},e.prototype.getBlockKey=function(e){return e.hasOwnProperty("data")&&(e=e.data),e.items&&e.items.length&&"live"===e.items[0].type?e.author.id+"live":e.is_narrative?e.author.id+"narrative"+e.items[0].narrative.id:this.list.includes("place")?e.author.id+"place":e.id?e.author.id+"id"+e.id:""+e.author.id},e.prototype._renderStories=function(){for(var e=this,t=[],o=0;o<this.storiesList.length;o++)this.storiesList[o]&&t.push(this.storiesList[o]);var i,r=this._getScreenStoriesCount(),s=this._getCurStoryPos(t.map((function(t){return e.getBlockKey(t)}))),n=Math.floor(r/2),a=t.slice(Math.max(0,s-n)).slice(0,r),c=a.map((function(t){return e.getBlockKey(t)}));for(var l in this.renderedStories)if(this.renderedStories.hasOwnProperty(l)){var d=this.renderedStories[l];c.includes(l)||(d.story.destroy(),delete this.renderedStories[l])}if(a.map((function(t,o){var r=e.getBlockKey(t);if(!e.renderedStories[r]){var s=e.storiesBlocks.indexOf(r),a=t.author.id,c=new wt(t,{id:o,layer:e,onSelect:e._onSelectStory.bind(e),onStoriesEnd:e._onStoriesEnd.bind(e,s),onStoryRemoved:function(t,o){return e._onStoryRemoved(a,s,t,o)},playPrevOwner:e._playPrevOwner.bind(e,s),onPlayStory:e._onPlayStory.bind(e,s),onSeen:e._readStories.bind(e),onVideoPlay:e._onVideoPlay.bind(e),restoreAudioPlay:e._restoreAudioPlay.bind(e),onStartStory:e._onStartStory.bind(e),removeList:function(){return window.Stories.removeList(e.list)}});o<=n&&e.stories.children[o]?e.stories.insertBefore(c.render(),e.stories.children[o]):e.stories.appendChild(c.render()),e.renderedStories[r]={story:c,index:s},r===e.blockKey&&(i=c)}})),!i){var u=c[0];i=this.renderedStories[u].story}return{activeStory:i}},e.prototype._sendOpeningEvents=function(){if(this._source){var e;switch(this._source){case"narrative_story":e="narrative_open_stories";break;case"narrative_snippet":case"narrative_link":e="narrative_open";break;case"narrative_recommendations":e="narrative_other"}if(e&&this._sendNavigationStatEvents(e,!1),"narrative_fave"===this._source){var t=this.activeStory.getCurStoryData();if(t&&t.narrative){var o=t.narrative,i=o.owner_id,r=o.id;Object(nt.statlogsValueEvent)("bookmarks_product_analytics",{item_type:"narrative",item_owner_id:i,item_id:r,time:window.getServerTime()})}}}},e.prototype._destroyStories=function(){for(var e in this.renderedStories){if(this.renderedStories.hasOwnProperty(e))this.renderedStories[e].story.destroy()}},e.prototype.destroy=function(){clearTimeout(this.timer),clearTimeout(this.animationTimer),this._destroyStories(),this._onVideoEnd(),Object(j.removeEvent)(this.volumeControl),Object(j.removeEvent)(this.layerEl),delete this.activeStory,delete this.volumeControl,delete this.renderedStories;try{this.layerEl&&document.body.removeChild(this.layerEl)}catch(e){}delete window.cur.storyLayer},e.prototype.getList=function(){return"story"+this.activeStory.getRawId()+"/"+this.list+(this.extraRaw?"/"+this.extraRaw:"")},e.prototype.getStoryRaw=function(){return!!this.activeStory&&this.activeStory.getRawId()},e.prototype.initDOM=function(){this.layerEl=Object(a.ce)("div",{className:"stories_layer"});var e=Object(a.ce)("div",{className:"stories_layer_cont"});this.layerEl.appendChild(e),e.appendChild(this._renderBackButton()),e.appendChild(this._renderVolumeControl()),this._updateVolumeButton(),this.stories=Object(a.ce)("div",{id:"stories_list",className:"stories_list"}),e.appendChild(this.stories),e.appendChild(Object(a.ce)("div",{className:"stories_layer_close"})),Object(j.addEvent)(this.layerEl,"click",this._onLayerClick.bind(this)),document.body.appendChild(this.layerEl)},e.prototype.show=function(){window.onBodyResize()},e.prototype.hide=function(e){var t=this;Object(a.addClass)(this.layerEl,"stories_layer_hiding"),this.hideAllLayers||x(),this._source&&this._source.startsWith("narrative")&&this._sendNavigationStatEvents("narrative_close",!1),this.activeStory&&(this.activeStory.pauseStory(),this.activeStory.hideTooltip(),this.activeStory.isActiveLive()&&this._sendNavigationStatEvents("live_player_close",!1),this._readStoriesIfNeeded(this.activeStory),this.activeStory.isActiveStoryOneTime()&&window.Stories.removeList(this.list)),!0!==e&&this.activeStory?this.animateStory("minimize").then((function(){return t.doHide()})).catch((function(){Object(xt.debugLog)("error animate story")})):this.doHide(e),Object(a.removeClass)(this.layerEl,"shown")},e.prototype.doHide=function(e){if(this.destroy(),e||(E.pop(),window.cur.storyLayer=E[E.length-1],window.cur.storyLayer?window.cur.storyLayer.resumeLayer():(N(!0),window.layerQueue.pop())),window.wkcur&&window.wkcur.shown&&window.WkView.restoreLayer({}),"group_stories"===this.list&&window.Stories.groupStoriesBlockUpdate(),this.list.startsWith("archive")&&this.hideAllLayers&&!e){if(!window._message_boxes[window.cur.storiesArchiveBoxGUID])return;window._message_boxes[window.cur.storiesArchiveBoxGUID].forceHide=!1,window._message_boxes[window.cur.storiesArchiveBoxGUID]._show(!0,!1,!0),window.updateStoriesArchiveBoxPosition&&window.updateStoriesArchiveBoxPosition()}Object(st.clear)()},e.prototype.back=function(){this.hideAllLayers=!1;var e=window.cancelStack[window.cancelStack.length-1];e&&"stories_form_focus"===e.name&&Object(S.cancelStackPop)(),this.hide(!1)},e.prototype._getScreenStoriesCount=function(){return 2*Math.floor(window.innerWidth/(.563*window.innerHeight))+1},e.prototype._getCurStoryPos=function(e){return(e||this.storiesBlocks).indexOf(this.blockKey)},e.prototype._startFirstStory=function(e,t){var o=this;this.activeStory=e,Object(a.addClass)(e.getWrap(),"active"),this.scrollToStory(),t||(t=this._hasContext("new")?t:this.storyRaw),e.indexToStoryById(t),this._startActiveStory(),setTimeout((function(){Object(a.addClass)(o.stories,"animated"),o.inited=!0,"open"===o.extra.replies&&o.activeStory.showFeedbackTooltip()}))},e.prototype._markReadRestStories=function(e){e.data.is_groups?this._onGroupsStoriesBlockViewEnd(e):e.data.is_apps?this._onAppsStoriesBlockViewEnd(e):(this._markReadStoriesInRange(e,e.index,e.data.items.length),this._updateBadge(e))},e.prototype._onGroupsStoriesBlockViewEnd=function(e){var t=this,o=window.Stories._getList("groups");if(o){var i=Object(a.ge)("feed_story_"+this.getBlockKey(e)),r=o.map((function(e){return e.author.id}));this._readAllStoriesByOwners(r,(function(){o.forEach((function(e){return e.items.forEach((function(e){return e.unread=!1}))})),e.data.items[0].unread=!1,t._updateMetaStoryItems(),t._resetGroupsBlockPreview(o[0],i),Object(a.removeClass)(i,"story_feed_new_item")}))}},e.prototype._onAppsStoriesBlockViewEnd=function(e){var t=this,o=window.Stories._getList("apps");if(o){var i=Object(a.ge)("feed_story_"+this.getBlockKey(e)),r=o.map((function(e){return e.author.id}));this._readAllStoriesByOwners(r,(function(){o.forEach((function(e){return e.items.forEach((function(e){return e.unread=!1}))})),e.data.items[1].unread=!1,t._updateMetaStoryItems(),Object(a.removeClass)(i,"story_feed_new_item")}))}},e.prototype._readAllStoriesByOwners=function(e,t){void 0===t&&(t=function(){}),window.ajax.post("al_stories.php",{act:"mark_owners_seen",owners_ids:e.join(","),hash:this.storiesReadHash},{onDone:function(){t()}})},e.prototype._resetGroupsBlockPreview=function(e,t){var o=e.items[0];t.classList.contains("stories_feed_preview_item")&&o&&o.small_preview&&Object(a.setStyle)(t,"background-image","url("+o.small_preview+")")},e.prototype._onSelectStory=function(e){var t,o=this;this.activeStory&&(t=this.activeStory.getWrap(),this.activeStory.stop()),e.id-this.activeStory.id>0&&this._markReadRestStories(this.activeStory),this.activeStory=e,e.indexToUnread(),e.isActiveLive()||e.fillTimeLine(),this.blockKey=this.getBlockKey(e),clearTimeout(this.timer),Object(a.addClass)(this.stories,"animated"),this.timer=setTimeout((function(){Object(a.removeClass)(t,"active"),Object(a.addClass)(e.getWrap(),"active"),o.scrollToStory(),o.timer=setTimeout((function(){o.activeStory&&e.id!==o.activeStory.id||!o.activeStory||(e.indexToUnread(),o._startActiveStory(),o._renderStories(),o.scrollToStory(e,!0))}),200)}))},e.prototype._startActiveStory=function(){var e=this.activeStory;e.markAsActive(),e.playStory(!0)},e.prototype._onStartStory=function(){var e=this.activeStory,t=this.list;if(e){var o=this.activeStory.getCurStoryData();if(o){var i=window.nav.objLoc;if(i.w="story"+e.getRawId(),t.match(/^-?(\d+)_(\d+)$/)||(i.w+="/"+t),t.match(/^narrative[s]?-?\d+(_\d+)?/)){var r=o.narrative,s=o.raw_id.split("_"),n=s[0],a=s[1];i.w="narrative"+n+"_"+r.id+"_"+a}window.nav.setLoc(window.nav.toStr(i))}else Object(Ge.logError)(new Error("Fail: _onStartStory"),{environment:"stories"})}},e.prototype.scrollToStory=function(e,t){var o=this,i=this._getScrollLeft(e);t?(Object(a.removeClass)(this.stories,"animated"),this._setScrollLeft(i)):this.inited&&Object(a.addClass)(this.stories,"animated"),setTimeout((function(){o._setScrollLeft(i)}))},e.prototype._setScrollLeft=function(e){Object(a.setStyle)(this.stories,"transform","translateX("+Math.round(e)+"px) translateZ(0)")},e.prototype._getScrollLeft=function(e){return e=e||this.activeStory,window.innerWidth/2-e.getOffsetLeft()},e.prototype._onStoriesEnd=function(e,t){for(var o=-1,i=e+1;i<this.storiesList.length;i++){if(this.storiesList[i]){o=i;break}}var r=this._getStoryInstanceByIndex(o);if(o>-1)t&&this._sendNavigationStatEvents("go_to_next_story_auto_by_time"),this._onSelectStory(r);else{window.cur.storyLayer.activeStory.data.is_groups&&this._onGroupsStoriesBlockViewEnd(window.cur.storyLayer.activeStory),window.cur.storyLayer.activeStory.isActiveStoryOneTime()&&window.Stories.removeList(this.list),window.cur.storyLayer.activeStory.isAppsMetaStoryActive()&&this._onAppsStoriesBlockViewEnd(window.cur.storyLayer.activeStory);var s=window.cancelStack[window.cancelStack.length-1];s&&"stories_form_focus"===s.name&&Object(S.cancelStackPop)(),Object(S.cancelStackPop)({byTimer:t})}},e.prototype._playPrevOwner=function(e){for(var t=-1,o=e-1;o>=0;o--){if(this.storiesList[o]){t=o;break}}t>-1?this._onSelectStory(this._getStoryInstanceByIndex(t)):Object(S.cancelStackPop)()},e.prototype._markReadStoriesInRange=function(e,t,o){for(var i=e.data.items,r=t;r<o;r++){var s=i[r];s.unread&&(s.unread=!1)}},e.prototype._markReadPrevStories=function(e){this._markReadStoriesInRange(e,0,e.index)},e.prototype._updateBadge=function(e){var t=Object(a.ge)("feed_story_"+this.getBlockKey(e)),o=Object(a.geByClass1)("_stories_feed_item_replies",t);if((Object(a.hasClass)(t,"story_feed_new_item")||""!==Object(a.val)(o))&&!e.data.is_groups&&!e.data.is_apps){var i=e.data.items||[],r=i[e.index]||{};(r.answers||{}).new_count=0,r.unread=!1;var s=!0,n=0;i.forEach((function(e){var t=e.answers||{};n+=t.new_count||0,e.unread&&(s=!1)})),n>0?Object(a.val)(o,n):(Object(a.val)(o,""),s&&(Object(a.removeClass)(t,"story_feed_new_item"),Object(a.removeClass)(t,"story_feed_new_item_promo")))}},e.prototype._onPlayStory=function(e){var t=this._getStoryInstanceByIndex(e);t&&(this.storiesReadHash=t.getReadHash(),t.data.is_groups||t.isAppsMetaStoryActive()||t.isActiveStoryOneTime()||(this._readStories(t),this._markReadPrevStories(t)),this._updateBadge(t));var o=this._getStoryInstanceByIndex(e+1);o&&o.preloadNextStory(o.getIndex())},e.prototype._getStoryInstanceByIndex=function(e){var t=this.storiesList[e];if(!t)return!1;var o=this.getBlockKey(t);return this.renderedStories[o].story},e.prototype._onStoryRemoved=function(e,t,o,i){for(var r=0;r<this.storiesList.length;r++)this.storiesList[r]&&this.storiesList[r].author.id===e&&(this.storiesList[r]=!1);!o&&this._onStoriesEnd(t),window.Stories.updateFeedStories(null,{cb:i})},e.prototype.onVisibilityChange=function(){"visible"===document.visibilityState?window.cur.storyLayer&&window.cur.storyLayer.playStory():window.cur.storyLayer&&window.cur.storyLayer.pauseStory()},e.prototype.onResize=function(){this.activeStory&&window.cur.storyLayer.scrollToStory(this.activeStory,!0)},e.prototype.pauseStory=function(e){this.activeStory&&this.activeStory.pauseStory(e)},e.prototype.playStory=function(e){void 0===e&&(e=!1),this.activeStory&&this.activeStory.autoResumeStory(e)},e.prototype._onLayerClick=function(e){var t=Object(a.hasClass)(e.target,"stories_layer_close");(Object(a.hasClass)(e.target,"stories_layer_cont")||t)&&(this.storiesBlocks.length-1!==this._getCurStoryPos()||t||(this._readStories(this.activeStory,!0),this._markReadRestStories(this.activeStory)),Object(S.cancelStackPop)({isCloseBtnClick:t}))},e.prototype._getCurrentStoriesBlockIdx=function(){var e=this.renderedStories[this.getBlockKey(this.activeStory)];return e&&e.index},e.prototype._checkKeyEvents=function(e){return!(Object(a.attr)(e.target,"contenteditable")||Object(c.inArray)(e.target.tagName,["INPUT","TEXTAREA"])||window.curBox())},e.prototype.onKeyDown=function(e){if(window.cur.storiesKeyDown)window.cur.storyLayer&&window.cur.storyLayer._checkKeyEvents(e)&&Object(j.cancelEvent)(e);else if(window.cur.storiesKeyDown=e.keyCode!==j.KEY.ESC,[j.KEY.PAGEDOWN,j.KEY.PAGEUP].includes(e.keyCode))Object(j.cancelEvent)(e);else if(window.cur.storyLayer&&window.cur.storyLayer.inited&&window.cur.storyLayer._checkKeyEvents(e)){switch(e.keyCode){case j.KEY.LEFT:this._readStoriesIfNeeded(this.activeStory),window.cur.storyLayer.prevStory();break;case j.KEY.RIGHT:this._readStoriesIfNeeded(this.activeStory),window.cur.storyLayer.nextStory();break;case j.KEY.SPACE:Object(j.cancelEvent)(e);var t=window.cur.storyLayer.activeStory;t.isSpaceLongTabAvailable()&&(window.cur.storiesKeyDownLong=setTimeout(t._longTapHandle.bind(t),R.LONG_PRESS_DELAY_MS))}window.cur.storiesKeyDownTs=Object(c.vkNow)()}},e.prototype.onKeyUp=function(e){window.cur.storiesKeyDown=!1,clearTimeout(window.cur.storiesKeyDownLong),window.cur.storyLayer&&window.cur.storyLayer.inited&&window.cur.storyLayer._checkKeyEvents(e)&&e.keyCode===j.KEY.SPACE&&(Object(j.cancelEvent)(e),Object(c.vkNow)()-window.cur.storiesKeyDownTs>R.LONG_PRESS_DELAY_MS?window.cur.storyLayer.playStory(!0):(this._readStoriesIfNeeded(this.activeStory),window.cur.storyLayer.nextStory()))},e.prototype.nextStory=function(){this.activeStory&&this.activeStory.nextStory()},e.prototype.prevStory=function(){this.activeStory&&this.activeStory.prevStory()},e.prototype.changeStory=function(e){this.activeStory&&this.activeStory.changeStory(e)},e.prototype._readStoriesIfNeeded=function(e,t){void 0===t&&(t=!1),e.isActiveStoryOneTime()&&this._readStories(e,t)},e.prototype._readStories=function(e,t){var o=this;if(void 0===t&&(t=!1),e){var i=e.getRawId();if(i&&(!this.storiesIdsSeen[i]||t)&&e.isLoaded()){var r,s,n=e.getAccessKey(),a=e.getTrackCode(),c=0;e.isActiveStoryOneTime()&&(c=Math.max(Math.round(e.getStoryProgressPercent()),1)),a||(a=""),window.ajax.post("al_stories.php",{act:"read_stories",story_id:i,track_code:a,all:Number(t),progress:c,source:this._getSource(),navigation_stats:(s=Lt.map(e=>[e.ownerId,e.storyId,e.source,e.action].join(",")).join(";"),Lt=[],s),loading_stats:(r=Bt.map(e=>[e.ownerId,e.storyId,e.source,e.time].join(",")).join(";"),Bt=[],r),connection_type:Tt(),hash:e.getReadHash(),access_key:n},{onDone:function(){}}),this.storiesIdsSeen[i]=!0,t&&e.getItems().forEach((function(e){return o.storiesIdsSeen[e.raw_id]=!0}))}}},e.prototype._getSource=function(){return[St,jt,R.STORIES_MANAGE_MODULE,Et.MODULE].includes(window.cur.module)?window.cur.module:this._source?this._source:"list"},e.prototype._sendNavigationStatEvents=function(e,t,o){var i;void 0===t&&(t=!0),void 0===o&&(o={});var r=this.activeStory,s=this.getStoryRaw()||(null===(i=r.getCurStoryData())||void 0===i?void 0:i.raw_id),n=this._getSource();t&&this._sendProductAnalyticEvents(e,o),this._updateLastStoryOpenAction(e),function(e){var t=e.storyRawId,o=e.source,i=e.action,r=Ot(t.split("_"),2);"reply"===o&&(o="replies_list");var s={ownerId:r[0],storyId:r[1],source:o,action:i};Lt.push(s)}({storyRawId:s,source:n,action:e})},e.prototype._sendProductAnalyticEvents=function(e,t){var o;void 0===t&&(t={});var i=this.activeStory,r=this.getStoryRaw()||(null===(o=i.getCurStoryData())||void 0===o?void 0:o.raw_id);if(r){var s=r.split("_"),n=Number(s[0]),a=Number(s[1]),c=i.getIndex(),l=i.getItemsLength()-c,d=i.story,u=this._getSource(),p=i.isGroupedStory(),h=0;if(e&&i&&d&&n&&a){p&&(a=0,n=0,h=0),"groups"===this.list&&(h=1);var _={event_type:e,story_owner_id:n,story_id:a,time:window.vk.ts+Math.floor(((new Date).getTime()-window.vk.started)/1e3),volume:100*b(),view_entry_point:u,stories_author_before:c,stories_author_after:l,nav_screen:window.cur.module,view_event_timeline_position:d.getCurrentTime(),story_type:p?"group_feed":"",is_grouped:h,track_code:d.getTrackCode()};Object.assign(_,t),Object(Ue.partConfigEnabled)("web_stats_transport_story_view")?Object(kt.saveStoryViewStats)(_):Object(nt.statlogsValueEvent)("story_product_analytics",_)}}else Object(Ge.logError)(new Error("_sendProductAnalyticEvents: storyRawId is undefined"),{environment:"stories"})},e.prototype._updateLastStoryOpenAction=function(e){switch(e){case"go_to_next_story_tap":case"go_to_next_story_click":case"go_to_next_story_auto_by_time":this.viewerSource="next_story";break;case"go_to_previous_story":this.viewerSource="previous_story";break;case"go_to_next_author":this.viewerSource="next_author";break;case"go_to_previous_author":this.viewerSource="previous_author"}},e.prototype._initViewerSource=function(){var e=this._getSource();switch(e){case"reply":this.viewerSource="replies_list";break;case"feed":this.viewerSource=window.cur.section;break;default:this.viewerSource=e}},e.prototype._sendViewerStartTime=function(e,t){!function(e){var t=e.storyRawId,o=e.source,i=e.time,r=Ot(t.split("_"),2),s={ownerId:r[0],storyId:r[1],source:o,time:i};Bt.push(s)}({storyRawId:e,source:this.viewerSource,time:t})},e.prototype._onVideoPlay=function(){var e=this.activeStory.getCurStoryData();e?e.noSound||(window.Notifier.lcSend("stories_video_start"),window.getAudioPlayer().isPlaying()&&(Object(H.getAudioPlayer)().pause(),this.needAudioReset=!0)):Object(Ge.logError)(new Error("Fail: _onVideoPlay"),{environment:"stories"})},e.prototype._onVideoEnd=function(){this._restoreAudioPlay()},e.prototype._restoreAudioPlay=function(){window.Notifier.lcSend("stories_video_end"),this.needAudioReset&&(window.getAudioPlayer().play(),delete this.needAudioReset)},e.prototype._renderBackButton=function(){return this.backButton=Object(a.se)('<div class="stories_back_button_wrap">\n  <div class="stories_back_button">\n    <div class="stories_back_button_icon"></div>\n    <div class="stories_back_button_text">'+Object(be.getLang)("global_back")+"</div>\n  </div>\n</div>"),Object(j.addEvent)(this.backButton,"click",(function(){Object(S.cancelStackPop)()})),this.backButton},e.prototype.showBackButton=function(){Object(a.show)(this.backButton),this.hideAllLayers=!0,Object(a.addClass)(this.layerEl,"with_back_button")},e.parseExtra=function(e){for(var t={},o=0,i=String(e).split(";");o<i.length;o++){var r=i[o].split(":"),s=r[0],n=r[1];s&&n&&(t[s]=n)}return t},e.prototype.getAnimateFromElem=function(){if(!this.hideAllLayers){var e=this.getBlockKey(this.activeStory);if(Object(a.hasClass)(this.animateFromEl,"stories_feed_reply_item")){var t=Object(a.domQuery)("#feed_story_"+e,Object(a.domPN)(this.animateFromEl))[0];if(t)return t}else if("feed"===window.cur.module&&!Object(a.isVisible)(this.backButton)){var o=Object(a.ge)("feed_story_"+e);if(o)return window.Stories.feedScrollToOwner(e),o}}return this.animateFromEl},e.prototype.animateStory=function(e,t){var o=this;return new Promise((function(i){if("expand"===e&&!t||"minimize"===e&&!o.animateFromEl)return Object(a.setStyle)("stories_layers_background","opacity",1),i();o.pauseStory(),Object(a.addClass)(o.layerEl,"animation"),Object(a.removeClass)(o.stories,"animated");var r="expand"===e?t:o.getAnimateFromElem();if(o.hideAllLayers&&"minimize"===e){var s=E[0];r=s.getAnimateFromElem(),function(){for(var e=E.length-2;e>=0;e--)E[e].doHide(!0);E.splice(0,E.length-1)}(),x()}Object(a.removeClass)(r,"stories_feed_item_ava_animate");var n=Object(a.getXY)(r),c=n[0],l=n[1],d=Object(a.getSize)(r),u=window.innerHeight,p=Math.min(540,Math.max(320,.563*u)),h=1.78*p,_=Math.max(0,(u-h)/2),m=Math.max(0,(window.innerWidth-p)/2);c=m-c+p/2-d[0]/2+Number(Object(pt.scrollGetX)()),l=_-l+h/2-d[1]/2+Number(Object(pt.scrollGetY)()),c=-c,l=-l;var v={};"expand"===e&&(v.transform="translate("+c+"px, "+l+"px) scale(0)",o.animateFromEl=t),Object(a.setStyle)(o.activeStory.wrapEl,v),"minimize"===e&&Object(a.setStyle)(r,"transform","scale(0)"),o.animationTimer=setTimeout((function(){Object(a.addClass)(o.stories,"animated"),Object(a.addClass)(r,"stories_feed_item_ava_animate"),o.animationTimer=setTimeout((function(){"expand"===e?(Object(a.setStyle)("stories_layers_background","opacity",1),Object(a.setStyle)(o.activeStory.wrapEl,"transform","translate(0, 0) scale(1)")):(Object(a.setStyle)(o.activeStory.wrapEl,"transform","translate("+c+"px, "+l+"px) scale(0.01)"),Object(a.setStyle)(r,"transform","scale(1)")),o.animationTimer=setTimeout((function(){i(),"expand"===e?(Object(a.setStyle)(o.activeStory.wrapEl,"transform",""),Object(a.removeClass)(o.layerEl,"animation"),Object(a.removeClass)(o.stories,"animated"),o.playStory(),E.length>1&&(E[E.length-2].setLayerVisibility(!1),E[E.length-1].showBackButton())):(Object(a.removeClass)(r,"stories_feed_item_ava_animate"),Object(a.setStyle)(r,"transform",""))}),330)}),30)}),30)}))},e.prototype.pauseLayer=function(){this.pauseStory(),Object(a.addClass)(this.layerEl,"paused")},e.prototype.resumeLayer=function(){this._updateVolumeButton(),this.activeStory.volumeUpdate(),this.activeStory&&(window.cur.storyLayer.activeStory.data.is_groups&&window.cur.storyLayer.activeStory.isAppsMetaStoryActive()&&this._updateMetaStoryItems(),this.activeStory.isFeedbackTooltipShow&&this.activeStory.updateBottom(),this.playStory(),Object(a.removeClass)(this.layerEl,"paused"))},e.prototype._updateMetaStoryItems=function(){if(window.cur.storyLayer&&window.cur.storyLayer.activeStory&&window.cur.storyLayer.activeStory.story&&(window.cur.storyLayer.activeStory.data.is_groups||window.cur.storyLayer.activeStory.isAppsMetaStoryActive())){var e="groups";window.cur.storyLayer.activeStory.isAppsMetaStoryActive()&&(e="apps");var t=window.cur.storyLayer.activeStory.story.elems.recItems.querySelectorAll(".GridStoryPreview:not(.GridStoryPreview--live)"),o=window.Stories._getList(e);if(!o)return this.hideAllLayers=!0,void this.hide();var i=0;t.forEach((function(e){var t=e.querySelector(".GridStoryPreview__author"),r=e.querySelector(".GridStoryPreview__inner");if(t&&r){var s=Number(t.getAttribute("data-author-id")),n=o.find((function(e){return e.author.id===s&&"live"!==e.items[0].type}));if(!n)return++i,void e.remove();var c=n.items.findIndex((function(e){return e.unread}));-1===c&&(c=0,Object(a.removeClass)(t,"GridStoryPreview__author--unread"));var l=n.items[c],d=new Image;d.src=l.small_preview,d.onload=function(){Object(a.setStyle)(r,{backgroundImage:"url('"+l.small_preview+"')"})}}})),t.length-i<3&&(this.hideAllLayers=!0,this.hide())}},e.prototype.setLayerVisibility=function(e){Object(a.toggle)(this.layerEl,e)},e.prototype._renderVolumeControl=function(){return this.volumeControl=Object(a.se)('<div class="stories_volume_control">\n  <div class="stories_volume_control_slide_wrap">\n    <div class="stories_volume_control_slide">\n      <div class="stories_volume_control_slide_indicator"></div>\n    </div>\n  </div>\n</div>'),Object(j.addEvent)(Object(a.geByClass1)("stories_volume_control_slide_wrap",this.volumeControl),"mousedown",this._volumeControlOnMouseDown.bind(this)),Object(j.addEvent)(this.volumeControl,"mousedown",this._volumeControlOnClick.bind(this)),this.volumeControlContainer=Object(a.ce)("div",{className:"stories_volume_control_container"}),this.volumeControlContainer.appendChild(this.volumeControl),this.volumeControlContainer},e.prototype._volumeControlOnMouseDown=function(e){var t=this;Object(a.addClass)(this.volumeControlContainer,"changing");var o=Object(a.geByClass1)("stories_volume_control_slide",this.volumeControl),i=Object(a.geByClass1)("stories_volume_control_slide_indicator",o),r=Object(a.getXY)(o)[0],s=Object(a.getSize)(o)[0],n=function(e){var o=Math.max(0,Math.min(e.pageX-r,s))/s*100;Object(a.setStyle)(i,"width",o+"%"),w(o/100),t.activeStory.volumeUpdate()},c=function(){Object(j.removeEvent)(window,"mousemove",n),Object(j.removeEvent)(window,"mouseup",c),t._updateVolumeButton(),Object(a.removeClass)(t.volumeControlContainer,"changing")};Object(j.addEvent)(window,"mousemove",n),Object(j.addEvent)(window,"mouseup",c),n(e)},e.prototype._updateVolumeButton=function(){var e=100*b();Object(a.toggleClass)(this.volumeControl,"low",e>0&&e<50),Object(a.toggleClass)(this.volumeControl,"high",e>=50);var t=Object(a.geByClass1)("stories_volume_control_slide_indicator",this.volumeControl);Object(a.setStyle)(t,"width",e+"%")},e.prototype._volumeControlOnClick=function(e){if(!Object(a.hasClass)(e.target,"stories_volume_control_slide_wrap")&&!Object(a.hasClass)(this.volumeControlContainer,"changing")){var t=b();w(t=t?0:1),this._updateVolumeButton(),this.activeStory.volumeUpdate()}},e.prototype.onReplyDeleted=function(e){this.activeStory&&this.activeStory.onReplyDeleted(e)},e.prototype._hasContext=function(e){return this.extra&&this.extra.context&&this.extra.context===e},e}(),It=o("btP0"),Mt=o("59zB"),Rt=o("RdBX"),At={},Pt={show:function(e,t){if(void 0===t&&(t={}),e.match(/story/)&&(e=this._parseList(e)),window.cur.storyLayer&&window.cur.storyLayer.list===e.split("/")[1])return!1;this.getList(e).then((function(e){var o=e.blockKey,i=e.list,r=e.items,s=e.extra,n=Object(ie.curBox)();n&&"stories"!==n.wkRaw&&n.hide(),B(new Nt(o,i,r,s,t),t),n&&(t.fromEl=null,"stories"===n.wkRaw&&(n._hide(!1,!0,!0),n.forceHide=!0,window.cur.storiesArchiveBoxGUID=n.guid))})).catch((function(e){Object(Ge.logError)(e),Object(W.showFastBox)(Object(be.getLang)("global_error"),Object(be.getLang)("global_unknown_error"))}))},_getUnreadStory:function(e,t){e=Object(c.intval)(e);for(var o=!1,i=0;i<t.length;i++)if(t[i].author.id===e){for(var r=t[i].items,s=0;s<r.length;s++)if(r[s].unread){o=r[s];break}o||(o=r[0]);break}return o},getList:function(e){return new Promise((function(t,o){var i=e.split("/"),r=i[0],s=i[1],n=i[2],a={blockKey:r,list:s,extra:n,items:[]},c=Pt._getList(s);Array.isArray(c)?(a.items=c,t(a)):window.ajax.post("al_stories.php",{act:"get_list",list:s,story_raw:r,extra:n},{loader:!0,onDone:function(e){window.cur["stories_list_"+s]=e,a.items=e,t(a)},onFail:function(){return o(),!0}})}))},_getList:function(e){return window.cur["stories_list_"+e]},_setList:function(e,t){window.cur["stories_list_"+e]=t},removeList:function(e){delete window.cur["stories_list_"+e]},_parseList:function(e){var t=(e=decodeURIComponent(e)).match(/^story(-?\d+)_(\d+)(\/([a-z0-9\_\-]+))?(\/([a-z0-9\_\:\;\-]+))?$/i),o=t[1],i=t[2],r=t[4],s=t[6],n=o+"_"+i;return e.match(/from_feed\=1/)?r="feed":e.match(/profile\=1/)?r="profile":r||(r=n),n+"/"+r+"/"+s},initFeed:function(e){var t=this;void 0===e&&(e="stories_feed_items_container"),"string"==typeof e&&(e=Object(a.ge)(e));var o=Object(a.geByClass1)("stories_feed_items",e),i=Object(a.attr)(o,"id");Pt.updateFeedArrows(i);var r=function(){Object(j.addEvent)(e,"wheel",t.feedMouseWheel)},s=function(){Object(j.removeEvent)(e,"wheel",t.feedMouseWheel)};Object(j.addEvent)(e,"mouseenter",r),Object(j.addEvent)(e,"mouseleave",s),window.cur.destroy&&window.cur.destroy.push((function(){Object(j.removeEvent)(e,"wheel",this.feedMouseWheel),Object(j.removeEvent)(e,"mouseenter",r),Object(j.removeEvent)(e,"mouseleave",s)}))},feedNext:function(e){var t=Object(a.ge)("stories_feed_wrap");return e&&(t=Object(a.domClosest)("stories_feed_wrap",e.target)),this.feedPaging("next",null,t)},feedPrev:function(e){var t=Object(a.ge)("stories_feed_wrap");return e&&(t=Object(a.domClosest)("stories_feed_wrap",e.target)),this.feedPaging("prev",null,t)},feedPaging:function(e,t,o){o||(o=Object(a.ge)("stories_feed_wrap"));var i=Object(a.geByClass1)("stories_feed_items",o),r=Object(a.attr)(i,"id"),s=r+"_position",n=At[s]||0,l=Object(a.getSize)(o)[0];if(Object(c.isNumeric)(e))n+=e;else{var d=l-100;"next"===e?n+=d:n-=d}At[s]=Math.max(0,Math.min(n,i.scrollWidth-l)),t?Object(a.removeClass)(i,"animated"):Object(a.addClass)(i,"animated"),Object(a.setStyle)(i,"transform","translateX(-"+At[s]+"px)"),Pt.updateFeedArrows(r)},feedScrollToOwner:function(e){var t=Object(a.ge)("feed_story_"+e);if(t){var o=Object(a.domClosest)("stories_feed_items",t),i=o.offsetWidth,r=Object(a.attr)(o,"id")+"_position",s=t.offsetWidth,n=t.offsetLeft,c=Object(a.domClosest)("stories_feed_wrap",o);At[r]=n-i+i/2+s/2,Pt.feedPaging(0,!0,c)}},updateFeedStories:function(e,t,o){var i=this;void 0===o&&(o="stories_feed_items");var r=Object(a.ge)(o),s=Object(a.domClosest)("stories_feed_wrap",r);if(e=e||"news",r)if(Object(c.inArray)(e,["news","search"])){var n=function(e,r){t&&t.cb&&t.cb(),Object.keys(r).forEach((function(e){return i._setList(e,r[e])})),window.cur.storyLayer&&window.cur.storyLayer._updateMetaStoryItems();var n=Object(a.ge)(o);n&&(e?(Object(a.setStyle)(n,"transform","translateX(0px)"),Object(a.val)(n,e),n.children.length<6?Object(a.addClass)(s,"stories_feed_not_nav_buttons"):Object(a.removeClass)(s,"stories_feed_not_nav_buttons"),At[o+"_position"]=0,Pt.updateFeedArrows(o),Object(a.show)(s)):Object(a.hide)(s))};if(t&&t.stories){var l=t.section,d=t.q,u=t.stories,p=u.html,h=u.js,_=h.feed?h.feed:[];return"search"!==l||d&&_.length?void n(p,h):void Object(a.hide)(s)}window.ajax.post("al_stories.php",{act:"feed_stories"},{onDone:n})}else Object(a.hide)(s)},feedMouseWheel:function(e){var t=Object(a.domClosest)("stories_feed_wrap",e.target);if(!Object(a.hasClass)(t,"stories_feed_not_nav_buttons")){Object(j.cancelEvent)(e);var o=Math.abs(e.deltaY)>Math.abs(e.deltaX)?e.deltaY:e.deltaX;Pt.feedPaging(o,!0,t)}},updateFeedArrows:function(e){void 0===e&&(e="stories_feed_items");var t=Object(a.ge)(e),o=e+"_position";if(t){At[o]||(At[o]=0);var i=Object(a.geByClass1)("stories_feed_wrap").offsetWidth,r=t.scrollWidth-i,s=Object(a.geByClass1)("stories_feed_arrow_left",Object(a.domPN)(t)),n=Object(a.geByClass1)("stories_feed_arrow_right",Object(a.domPN)(t));0===At[o]?Object(a.addClass)(s,"disabled"):Object(a.removeClass)(s,"disabled"),At[o]===r||r<=0?Object(a.addClass)(n,"disabled"):Object(a.removeClass)(n,"disabled")}},showBlackList:function(){window.cur.storyLayer&&window.cur.storyLayer.pauseStory(),Object(W.showBox)("al_stories.php",{act:"black_list"},{onDone:function(){window.cur.storiesBlackListScroll=new Mt.default("stories_black_list_result")},params:{onHide:function(){window.cur.storyLayer&&window.cur.storyLayer.playStory()}}})},blackListItemClick:function(e,t){Object(j.cancelEvent)(t);var o=Object(c.intval)(Object(a.attr)(e,"data-id"));window.cur.storiesBlackListShown[o]?(delete window.cur.storiesBlackListShown[o],Object(a.removeClass)(e,"olist_item_wrap_on")):(window.cur.storiesBlackListShown[o]=1,Object(a.addClass)(e,"olist_item_wrap_on"))},saveBlackList:function(e){var t=Object.keys(window.cur.storiesBlackListShown);0!==t.length?window.ajax.post("al_stories.php",{act:"save_blacklist",hash:window.cur.storiesBlackList.hash,list:t.join(",")},{onDone:function(){Pt.updateFeedStories(),Object(ie.curBox)().hide()},showProgress:function(){return Object(mt.lockButton)(e)},hideProgress:function(){return Object(mt.unlockButton)(e)}}):Object(ie.curBox)().hide()},blacklistUpdateUsers:function(e){var t=e;if(e=Object(c.trim)(e).toLowerCase(),window.cur.storiesBlacklistLastQ!==e){window.cur.storiesBlacklistLastQ=e;var o=e?window.cur.storiesIndexer.search(e):window.cur.storiesBlackList.users,i=[];if(e)for(var r=0;r<e.length;r++)i.push(e.substr(r,1));var s=new RegExp(i.join(".*?"),"i"),n="";for(r=0;r<o.length;r++){var l=o[r],d=e?l.name.replace(s,(function(e){return"<em>"+e+"</em>"})):l.name;n+=window.cur.storiesBlackList.tpl.replace(/\{id\}/g,l.id).replace("{photo}",l.photo).replace("{name}",d).replace("{href}",l.href).replace("{class_name}",window.cur.storiesBlackListShown[l.id]?" olist_item_wrap_on":"")}n||(n='<div class="no_rows">'+Object(be.getLang)("global_search_not_found").replace("{search}",Object(c.clean)(t))+"</div>"),Object(a.val)(Object(a.geByClass1)("olist","stories_black_list_result"),n)}},blackListInit:function(e){window.cur.storiesBlackListShown={},window.cur.storiesBlackList=e,Object(ie.curBox)().setOptions({width:450,bodyStyle:"padding: 0px",onClean:function(){this.storyLayer&&this.storyLayer.playStory(),window.cur.storiesBlackListScroll&&window.cur.storiesBlackListScroll.destroy()}}).removeButtons(),window.cur.storiesBlackList.users.length?(window.cur.storiesBlacklistLastQ=!1,window.cur.storiesIndexer=new Rt.vkIndexer(window.cur.storiesBlackList.users,(function(e){return e.name}),(function(){Pt.blacklistUpdateUsers("")})),It.default.init("stories_blacklist"),It.default.focus("stories_blacklist"),Object(ie.curBox)().addButton(Object(be.getLang)("global_save"),this.saveBlackList).addButton(Object(be.getLang)("global_cancel"),void 0,"no")):Object(ie.curBox)().addButton(Object(be.getLang)("global_close"))},preloadUrl:function(e){v(e).catch((function(e){Object(Ge.logError)(e)}))},groupStoriesBlockUpdate:function(){var e=Pt._getList("group_stories"),t=e&&e[0]&&e[0].items;if(t){for(var o=0,i=0;i<t.length;i++){t[i].unread&&o++}var r=Object(a.geByClass1)("stories_groups_block_stories_wrap"),s=Object(a.geByClass1)("stories_groups_block_stories_button",r);Object(a.toggleClass)(r,"has_unread",o>0),Object(a.toggleClass)(r,"has_stories",t.length>0),Object(a.toggleClass)(s,"has_stories",t.length>0);var n=Object(c.clone)(window.cur.storiesPreviews),l=n.splice(n.length-o,3);l.length<3&&(l=l.concat(n.slice(0,3-l.length))),l.reverse();var d="";for(i=l.length-1;i>=0;i--)d+=window.cur.storiesPreviewsRowHtml.replace("{url}",l[i]);Object(a.val)(Object(a.geByClass1)("stories_groups_block_stories_rows",r),d)}},isLiveShown:function(e){return!!(window.cur.storyLayer&&window.cur.storyLayer.activeStory&&window.cur.storyLayer.activeStory.isActiveLive())&&window.cur.storyLayer.activeStory.story.videoRaw===e},activeLiveEnded:function(e){window.cur.storyLayer.activeStory.onLiveEnded(e)},updateLiveViewersCount:function(e){var t=e?Object(be.getLang)("stories_live_N_watching",e,!0):"";window.cur.storyLayer.activeStory.updateLiveViewersCount(t)}}},KkKZ:function(e,t,o){"use strict";o.r(t),t.default={disabled:!1}},L7cl:function(e,t,o){"use strict";o.r(t);o("HEwt"),o("a1Th"),o("Btvt"),o("rGqo"),o("rE2o"),o("ioFf");var i=o("zxIV"),r=o("FWc3"),s=o("JlTo");function n(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var o=[],i=!0,r=!1,s=void 0;try{for(var n,a=e[Symbol.iterator]();!(i=(n=a.next()).done)&&(o.push(n.value),!t||o.length!==t);i=!0);}catch(e){r=!0,s=e}finally{try{i||null==a.return||a.return()}finally{if(r)throw s}}return o}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return a(e,t);var o=Object.prototype.toString.call(e).slice(8,-1);"Object"===o&&e.constructor&&(o=e.constructor.name);if("Map"===o||"Set"===o)return Array.from(o);if("Arguments"===o||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o))return a(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function a(e,t){(null==t||t>e.length)&&(t=e.length);for(var o=0,i=new Array(t);o<t;o++)i[o]=e[o];return i}t.default={SCROLL_EDGE_BELOW_THRESHOLD:20,MAX_COMMENTS_NUM:150,MAX_LIKES_PER_BATCH:7,MAX_STICKERS_PER_BATCH:7,init(e,t){VideoChat.block&&VideoChat.destroy(),e&&(VideoChat.block=e,VideoChat.options=extend({},t),VideoChat.messagesWrap=domByClass(e,"mv_chat_messages_wrap"),VideoChat.stickersWrap=domByClass(e,"mv_chat_stickers_wrap"),VideoChat.scroll=new uiScroll(domFC(VideoChat.messagesWrap),{global:!0,hidden:t.scrollHidden,reversed:!0,preserveEdgeBelow:!0,preserveEdgeBelowThreshold:VideoChat.SCROLL_EDGE_BELOW_THRESHOLD,theme:"videoview",onupdate:VideoChat.onScrollUpdate}),this.scrollBottomBtnWrap=domByClass(e,"mv_chat_new_messages_btn_wrap"),VideoChat.replyForm=domByClass(e,"mv_chat_reply_form"),VideoChat.replyForm&&(VideoChat.replyInput=domByClass(e,"mv_chat_reply_input"),VideoChat.initReplyInput()),VideoChat.firstMsgIntro=domByClass(e,"mv_chat_first_message_intro"))},initReplyInput(){placeholderInit(VideoChat.replyInput,{editable:!0,global:!0}),stManager.add([jsc("web/emoji.js"),"notifier.css"],(function(){var e=Emoji.init(VideoChat.replyInput,{forceStickerPack:VideoChat.options.forceStickerPack,controlsCont:VideoChat.replyForm,noLineBreaks:1,noCtrlSend:1,ref:"video_chat",onSend:function(){VideoChat.sendMessage()},checkEditable:function(){VideoChat.checkFormHeight(),VideoChat.checkTextLen()},onStickerSend:function(e){VideoChat.sendSticker(e)}});Object(i.data)(VideoChat.replyForm,"optId",e)}))},checkFormHeight(){var e=VideoChat.replyForm,t=e.offsetHeight;if(e.lastHeight!==t){e.lastHeight=t;var o=!VideoChat.scroll.data.scrollBottom;setStyle(VideoChat.messagesWrap,{bottom:t+"px"}),o&&VideoChat.scroll.scrollBottom()}},checkTextLen(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:VideoChat.replyInput,t=trim(Emoji.editableVal(e));if(e.lastLen!==t.length)if((e.lastLen=t.length)>mvcur.maxChatReplyLength){var o=cur.storyLayer?"stories_live_chat_msg_too_long":"video_live_chat_msg_too_long";Object(r.showTooltip)(e,{black:1,text:getLang(o),shift:!!cur.storyLayer&&[-30,10]})}else window.tooltips&&tooltips.destroy(e)},mentionOver:e=>window.mentionOver(e,{shift:[-20,7,7]}),stickerClick:(e,t,o)=>(stManager.add([jsc("web/emoji.js"),"notifier.css"],(function(){Emoji.clickSticker(e,t,o)})),!1),onScrollUpdate(e){e.data.scrollBottom<VideoChat.SCROLL_EDGE_BELOW_THRESHOLD&&VideoChat.toggleScrollBottomBtn(!1)},receiveMessage(e,t,o,i,r,s,n,a,c){if(intval(c))VideoChat.appendSticker(c,o);else{var l=!1;window.replyAsList&&window.replyAsList.length&&each(window.replyAsList,(function(){if(this[0]==o)return l=!0,!1}));var d=Videoview.getMvData(),u=d.adminLevel,p=d.canDeleteComments,h="";(u>constants.Groups.GROUPS_ADMIN_LEVEL_USER||p||e==vk.id||o==vk.id||l)&&(h+=getTemplate("video_chat_message_action_del",{video_owner_id:e,msg_id:t}));var _=psr(getTemplate("video_chat_message",{author_href:s,author_photo:psr(r),author_name:i,message:a,video_owner_id:e,msg_id:t,actions:h,classes:o==e?"mv_chat_admin_message":""}));VideoChat.appendMessage(_,t)}},receiveDelete(e,t){var o="#mv_chat_msg"+mvcur.mvData.oid+"_"+t,i=VideoChat._messagesBatch&&VideoChat._messagesBatch.querySelector(o);i?re(i):(i=VideoChat.messagesWrap.querySelector(o))&&!hasClass(i,"_deleting")&&VideoChat.scroll.updateAbove((function(){re(i)}))},checkStickerFlood(e,t){var o=mvcur.queueBatchId;VideoChat._stickersLimits&&VideoChat._stickersLimits.batch==o||(VideoChat._stickersLimits={batch:o,like:0,sticker:0},VideoChat._stickersDelay=0);var i="like"==e?"like":"sticker",r="like"==i?VideoChat.MAX_LIKES_PER_BATCH:VideoChat.MAX_STICKERS_PER_BATCH;return!(++VideoChat._stickersLimits[i]>r&&t!=vk.id)},appendSticker(e,t){var o=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(!VideoChat.isHidden()&&!Videoview.isFS&&"hidden"!=document.visibilityState&&"animation"in bodyNode.style&&"onanimationend"in window){if(t==vk.id){var i=VideoChat.recentlySentSticker;if(i&&i.stickerId==e&&i.fromQueue!=o&&Date.now()-i.time<3e3)return;VideoChat.recentlySentSticker={stickerId:e,fromQueue:o,time:Date.now()}}else if(!VideoChat.checkStickerFlood(e,t))return;if("like"==e){var r=ce("div",{className:"mv_chat_like"});n(r),addEvent(r,"animationend",c),a(r)}else{var s=ce("img",{className:"mv_chat_sticker",src:Stickers.getStickerUrl(e,(isRetina()?128:64)+"b")});n(s),addEvent(s,"error animationend",c),addEvent(s,"load",a)}}function n(e){for(var o="",i=0,r=0,s=0,n=intval((VideoChat.getHeight()-80)/6),a=0;a<=100;a+=20){a>0&&(i+=irand(-4,4),r-=n,s+=irand(-4,4),n=intval(.9*n)),o+=`\n          ${a}% {\n            transform: translate(${i}px, ${r}px) rotate(${s}deg) scale(${a?1:.7});\n            opacity: ${0==a||100==a?0:1};\n          }\n        `}var c="mv_chat_sticker_animation_"+Date.now()+"_"+irand(0,1e9);o=`@keyframes ${c} {${o}}`,e.appendChild(ce("style",{innerHTML:o}));var l=irand(1500,2500)+"ms",d=(t==vk.id?0:VideoChat._stickersDelay+=100)+"ms";setStyle(e,{animation:[c,l,d,"linear"].join(" ")})}function a(e){var t=e.currentTarget||e;(VideoChat._stickersBatch||(VideoChat._stickersBatch=document.createDocumentFragment())).appendChild(t),VideoChat._appendStickerTimeout||(VideoChat._appendStickerTimeout=setTimeout((function(){VideoChat.appendStickersBatch(),VideoChat._appendStickerTimeout=null}),0))}function c(e){var t=e.currentTarget||e;removeEvent(t),re(t)}},appendStickersBatch(){var e=VideoChat._stickersBatch;e&&(VideoChat._stickersBatch=null,VideoChat.isHidden()||VideoChat.stickersWrap.appendChild(e))},removeStickers(){if(VideoChat.stickersWrap)for(var e;e=domFC(VideoChat.stickersWrap);)removeEvent(e),re(e)},appendMessage(e,t){var o=VideoChat._messagesBatch||(VideoChat._messagesBatch=document.createDocumentFragment()),i="#mv_chat_msg"+mvcur.mvData.oid+"_"+t;if(!VideoChat.messagesWrap.querySelector(i)&&!o.querySelector(i)){o.appendChild(se(e));for(var r=o.childNodes;o.childNodes.length>VideoChat.MAX_COMMENTS_NUM;)re(r[0]);VideoChat.isHidden()||VideoChat._appendMessageTimeout||(VideoChat._appendMessageTimeout=setTimeout((function(){VideoChat.appendMessagesBatch(),VideoChat._appendMessageTimeout=null}),0))}},appendMessagesBatch(){if(!VideoChat.isHidden()){var e=VideoChat._messagesBatch;if(e){VideoChat._messagesBatch=null;var t=geByClass("mv_chat_message_author_thumb_img",e,"img");each(t,(function(e,t){attr(t,"src")||attr(t,"src",domData(t,"src"))})),VideoChat.firstMsgIntro&&(re(VideoChat.firstMsgIntro),VideoChat.firstMsgIntro=null);var o=VideoChat.scroll.content;VideoChat.scroll.updateBelow((function(){o.appendChild(e)})),VideoChat.scroll.updateAbove((function(){for(var e=o.childNodes;e.length>VideoChat.MAX_COMMENTS_NUM;)re(e[0])})),VideoChat.scroll.data.scrollBottom>100&&VideoChat.toggleScrollBottomBtn(!0)}}},toggleScrollBottomBtn(e){toggleClass(this.scrollBottomBtnWrap,"hidden",!e)},scrollBottom(){VideoChat.scroll.scrollBottom(0)},replyAsAnimate(e,t,o){var i=e&&geByClass1("mv_chat_reply_author_photo",e),r=i&&geByClass("mv_chat_reply_author_photo_img",i),s=hasClass(e,"mv_chat_author_secondary")?0:1;r&&r[s]&&(r[s].src=o),toggleClass(e,"mv_chat_author_secondary")},replyAsGroup(e,t){window.replyAsList?VideoChat.replyAsGroupTT(e,t):ajax.post("/al_groups.php?act=get_editor_clubs",{},{cache:1,onDone:function(o){window.replyAsList=o,window.replyAsData={},each(o,(function(e,t){var o=n(t,4),i=o[0];o[1],o[2],o[3];window.replyAsData[i]=this})),VideoChat.replyAsGroupTT(e,t)}})},replyAsGroupList(e,t){var o=[t];return each(window.replyAsList,(function(t,i){var r=n(i,4),s=r[0];r[1],r[2],r[3];s!=e&&o.push(this)})),o},replyAsGroupOver(e){var t=gpeByClass("mv_chat_reply_form",e);Object(r.showTooltip)(e,{text:function(){return domData(t,"from-oid")<0?getLang("global_on_behalf_group"):getLang("global_on_behalf_me")},black:1,shift:[9,8,8]})},replyAsGroupTT(e,t){var o=VideoChat.replyAsProfileData(),r=gpeByClass("mv_chat_reply_form",e),s=r&&domData(r,"from-oid"),a=Object(i.data)(e,"tt");if(!o)return!1;if(!a){var c=VideoChat.replyAsGroupList(t,o),l="";each(c,(function(e,t){var o=n(t,4),i=o[0],r=o[1],a=o[2],c=o[3];l+=getTemplate("video_chat_message_author_select_row",{author_id:i,author_href:a,author_photo:r,author_name:c,classes:s==i?" active":""})})),a=new ElementTooltip(e,{content:'<div class="post_from_tt_choose _post_scroll_wrap">'+l+"</div>",appendToParent:!0,autoHide:!0,customShow:!0,defaultSide:"top",offset:function(){return[0,-5]},onFirstTimeShow:function(t){var o=geByClass("post_from_tt_row",t);each(o,(function(t,o){addEvent(o,"click",VideoChat.setReplyAsGroup.pbind(e,{from:domData(this,"from-oid")}))})),this.rows=o,this.scroll=new uiScroll(geByClass1("_post_scroll_wrap",t)),setTimeout((function(){a.scroll.update(),a.updatePosition()}),0)},onShow:function(e){setTimeout((function(){if(a.scroll){var t=geByClass1("active",e),o=t?t.offsetTop-(a.scroll.data.viewportHeight-getSize(t)[1])/2:0;a.scroll.scrollTop(o)}}),0)},onHide:function(e){}}),Object(i.data)(e,"tt",a)}t&&a.isShown()&&VideoChat.setReplyAsGroup(e,{from:s==vk.id?t:vk.id}),e.tt&&e.tt.hide&&e.tt.hide(),a.isShown()||a.show()},replyAsProfileData:()=>window.mvcur&&mvcur.wallTpl&&mvcur.wallTpl.profileData,setReplyAsGroup(e,t){if(!e)return!1;var o=domClosest("mv_chat_reply_form",e),r=Object(i.data)(e,"tt"),s=t.from||(t.fromGroup?cur.oid:vk.id),n=s==vk.id?VideoChat.replyAsProfileData():window.replyAsData&&window.replyAsData[s];return!(domData(o,"from-oid")==s||!n||n[0]!=s)&&(domData(o,"from-oid",s),VideoChat.replyAsAnimate(o,n[2],n[1]),r&&r.rows&&each(r.rows,(function(){toggleClass(this,"active",domData(this,"from-oid")==s)})),e.setAttribute("aria-label",getLang(s<0?"wall_reply_as_group":"wall_reply_as_user")),!1)},sendMessage(){if(!VideoChat.messageSending){var e={message:trim(Emoji.val(VideoChat.replyInput))};if(e.message){if(vkNow()-VideoChat.lastMsgSent<1e3)return window.tooltips&&tooltips.destroy(VideoChat.replyInput),void Object(r.showTooltip)(VideoChat.replyInput,{text:getLang("video_live_chat_too_fast"),black:1});var t=Videoview.getMvData(),o=geByClass1("mv_chat_reply_form",this.block);o&&domData(o,"from-oid")&&(e.from_oid=domData(o,"from-oid")),ajax.post("al_video.php?act=post_comment",Wall.fixPostParams(extend(e,{video:t.videoRaw,hash:t.hash,videoviewer_chat:1})),{onDone:function(e,t){VideoChat.messageSending=!1,e&&t&&VideoChat.appendMessage(e,t),Emoji.val(VideoChat.replyInput,""),VideoChat.checkFormHeight(),VideoChat.scroll.data.scrollBottom&&VideoChat.scrollBottom(),VideoChat.lastMsgSent=vkNow(),mvcur.player&&mvcur.player.vars.stats_tmr&&Object(s.tmrTrackCustomGoal)("comment_in_sport_broadcast")},onFail:function(e){if(VideoChat.messageSending=!1,VideoChat.replyInput)return window.tooltips&&tooltips.destroy(VideoChat.replyInput),Object(r.showTooltip)(VideoChat.replyInput,{text:e,showdt:200,forcetodown:0,slide:15,black:1}),elfocus(VideoChat.replyInput),!0}}),VideoChat.messageSending=!0}else elfocus(VideoChat.replyInput)}},sendSticker(e){var t=Videoview.getMvData();ajax.post("al_video.php?act=live_send_sticker",{sticker_id:e,owner_id:t.oid,video_id:t.vid,hash:t.hash},{onDone(){VideoChat.appendSticker(e,vk.id,!1)}})},deleteMessage(e,t){var o=ge("mv_chat_msg"+e);addClass(o,"_deleting"),ajax.post("al_video.php?act=delete_comment",{comment:e,hash:t,videoview_chat:1},{onDone(e){val(domByClass(o,"mv_chat_message_content"),e)}})},isHidden(){return!!this.hidden||Videoview.isMinimized()},setHidden(e){this.hidden=e},toggle(){var e=VideoChat.isHidden();this.setHidden(!e),VideoChat.toggleStateClasses(),e&&VideoChat.scroll&&(VideoChat.appendMessagesBatch(),VideoChat.updateScroll()),e||VideoChat.removeStickers()},toggleStateClasses(){var e=!!this.block,t=VideoChat.isHidden(),o=Videoview.isMinimized();toggleClass("mv_box","_has_chat",e&&!o),toggleClass("mv_box","_hide_chat",e&&!o&&t);var i="";e&&(VideoChat.appendMessagesBatch(),i=getLang(t?"video_aria_expand_chat":"video_aria_minimize_chat")),ge("mv_top_pl_toggle")&&attr("mv_top_pl_toggle","aria-label",i)},updateScroll(){VideoChat.scroll.update(),VideoChat.scroll.scrollBottom(),VideoChat.toggleScrollBottomBtn(!1)},onResize(){VideoChat.block&&(VideoChat._chatHeight=VideoChat.block.offsetHeight)},getHeight:()=>VideoChat.block?VideoChat._chatHeight||(VideoChat._chatHeight=VideoChat.block.offsetHeight):0,destroy(){if(VideoChat.block){if(VideoChat.scroll&&(VideoChat.scroll.destroy(),VideoChat.scroll=null),VideoChat.replyForm){var e=Object(i.data)(VideoChat.replyForm,"optId");void 0!==e&&Emoji.destroy(e),Object(i.removeData)(VideoChat.replyForm),Object(i.removeData)(VideoChat.replyInput),VideoChat.replyForm=VideoChat.replyInput=null}VideoChat.removeStickers(),Object(i.removeData)(VideoChat.block),re(VideoChat.block),VideoChat.block=null,VideoChat.messagesWrap=null,VideoChat.stickersWrap=null,VideoChat.options=null,clearTimeout(VideoChat._appendMessageTimeout),clearTimeout(VideoChat._appendStickerTimeout),VideoChat._appendMessageTimeout=null,VideoChat._appendStickerTimeout=null,VideoChat._messagesBatch=null,VideoChat.firstMsgIntro=null,VideoChat.messageSending=!1,VideoChat.toggleStateClasses()}}}},LkN3:function(e,t,o){"use strict";o.r(t);var i=o("q1tI"),r=(o("17x9"),o("ZxpX"));t.default=e=>{var t=e.children,o=e.className;return i.createElement("span",{className:Object(r.classNames)("TextTruncate",o)},t)}},PjZB:function(e,t,o){"use strict";o.r(t),o.d(t,"default",(function(){return s}));o("rGqo"),o("a1Th"),o("Btvt");var i=o("q1tI"),r=(o("17x9"),o("ZxpX"));class s extends i.Component{constructor(e){super(e),this.id=Math.round(1e6*Math.random()).toString(16),this.setSpinnerParams(e)}componentWillReceiveProps(e){this.setSpinnerParams(e)}setSpinnerParams(e){this.offset=Math.round(Math.PI*e.size),this.c=.5*e.size,this.animation=function(e,t){if(!e||!t)return"";var o=Object.keys(t).map(e=>e+" {"+Object.keys(t[e]).map(o=>o+":"+t[e][o]).join(";")+"}").join("");return`@-webkit-keyframes ${e} {${o}} @keyframes ${e} {${o}}`}("dash"+this.id,{"0%":{"stroke-dashoffset":this.offset},"50%":{"stroke-dashoffset":Math.round(.25*this.offset),transform:"rotate(135deg)"},"100%":{"stroke-dashoffset":this.offset,transform:"rotate(360deg)"}})}render(){var e=this.props,t=e.style,o=e.color,s=e.size,n=e.duration,a=e.strokeWidth,c=e.className,l=this.id,d=this.offset,u=this.animation,p=Object(r.classNames)("Spinner",c);return i.createElement("div",{className:p,style:t},i.createElement("svg",{className:"Spinner__svg",width:s,height:s,viewBox:`0 0 ${s} ${s}`,xmlns:"http://www.w3.org/2000/svg"},i.createElement("g",{style:{width:s,height:s,transformOrigin:.5*s+"px "+.5*s+"px"}},i.createElement("style",{dangerouslySetInnerHTML:{__html:u}}),i.createElement("circle",{className:"Spinner__path",fill:"none",stroke:o,strokeDasharray:d,strokeDashoffset:d,strokeWidth:a,style:{animationName:"dash"+l,animationTimingFunction:"ease-in-out",animationDuration:n+"s",animationIterationCount:"infinite"},cx:.5*s,cy:.5*s,r:.5*s-.5*a}))))}}s.defaultProps={color:"#5181b8",size:19,strokeWidth:2,duration:1.4,className:""}},Q3mP:function(e,t,o){"use strict";o.r(t);var i=o("q1tI"),r=o.n(i),s=o("ZxpX"),n=function(){return(n=Object.assign||function(e){for(var t,o=1,i=arguments.length;o<i;o++)for(var r in t=arguments[o])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)},a=function(e,t){var o={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(o[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(o[i[r]]=e[i[r]])}return o},c=function(e){var t=e.inverted,o=e.size,i=e.className,c=a(e,["inverted","size","className"]),l=Object(s.classNames)("Progress",{"Progress--inverted":!!t},"Progress--size-"+o,i);return r.a.createElement("div",n({className:l},c),r.a.createElement("div",{className:"Progress__item"}),r.a.createElement("div",{className:"Progress__item"}),r.a.createElement("div",{className:"Progress__item"}))};c.defaultProps={inverted:!1,size:"s"},t.default=c},RdBX:function(e,t,o){"use strict";o.r(t),o.d(t,"vkIndexer",(function(){return i}));o("Vd3H"),o("OG14"),o("a1Th"),o("Btvt"),o("KKXr"),o("Oyvg");function i(e,t,o){this.list=e,this.iterCur=0,this.iterEnd=e?e.length:0,this.index={},this.callback=o||function(){},this.prepareFunc=t||function(e){return e},setTimeout(this.indexIteration.bind(this),10)}i.prototype.delimiter=i.delimiter=new RegExp("[\\s\\-\\.,\\\"\\'\\«\\(\\)\\[\\]\\{\\}\\#\\+\\?\\\\]+","g"),i.prototype.trimmer=new RegExp("^[\\s\\-\\.,\\\"\\'\\«\\(\\)\\[\\]\\{\\}\\+\\?\\\\]+|[\\s\\-,\\\"\\'\\«\\(\\)\\[\\]\\{\\}\\\\]+$","g"),i.prototype.toTranslit={1072:"a",1073:"b",1074:"v",1075:"g",1076:"d",1077:"e",1078:"zh",1079:"z",1080:"i",1081:"y",1082:"k",1083:"l",1084:"m",1085:"n",1086:"o",1087:"p",1088:"r",1089:"s",1090:"t",1091:"u",1092:"f",1093:"h",1094:"ts",1095:"ch",1096:"sh",1097:"sh",1099:"y",1101:"e",1102:"yu",1103:"ya",1105:"e",1098:"",1100:""},i.prototype.toLocalCase={f:"a",",":"b","<":"b",d:"v",u:"g",l:"d",t:"e",";":"zh",":":"zh",p:"z",b:"i",q:"y",r:"k",k:"l",v:"m",y:"n",j:"o",g:"p",h:"r",c:"s",n:"t",e:"u",a:"f","[":"h","{":"kh",w:"ts",x:"ch",i:"sh",o:"sh",s:"y","'":"e",'"':"e",".":"yu",">":"yu",z:"ya","`":"e","~":"e",m:"","]":"","}":""},i.prototype.toLocalTranslit={1072:"f",1074:"d",1075:"u",1076:"l",1077:"t",1079:"p",1080:"b",1081:"q",1082:"r",1083:"k",1084:"v",1085:"y",1086:"j",1087:"g",1088:"h",1089:"c",1090:"n",1091:"e",1092:"a",1094:"w",1095:"x",1096:"i",1097:"o",1099:"s",1103:"z",1098:"m"},i.prototype.indexIteration=function(){for(var e=Math.min(this.iterEnd,this.iterCur+200),t=this.iterCur;t<e;t++){var o=this.list[t];try{o._order=t}catch(e){}this.add(o)}this.iterCur=t,t>=this.iterEnd?this.callback(this):setTimeout(this.indexIteration.bind(this),10)},i.prototype.strToPrefixes=function(e){for(var t={},o=winToUtf(e).toLowerCase().split(this.delimiter),i=o.length;i--;){var r=o[i],s="";if(r){for(var n=0;n<6;n++){var a=r.charCodeAt(n);if(a){var c=this.toTranslit[a],l=r.substr(n,1);s+=null!=c?c:l}}t[s]=1}}return t},i.prototype.strToSearchPrefixes=function(e){for(var t=[],o=e.toLowerCase().split(this.delimiter),i=o.length;i--;){var r={},s=o[i],n="",a="",c="",l=s.length>1;if(s){for(var d=0;d<6;d++){var u=s.charCodeAt(d);if(u){var p=this.toTranslit[u],h=s.substr(d,1);if(n+=null!=p?p:h,l){var _=this.toLocalCase[h],m=this.toLocalTranslit[u];a+=null!=_?_:h,c+=null!=m?m:h}}}r[n]=1,l&&(r[a]=2,r[c]=3),t.push(r)}}return t},i.prototype.toIndexTree=function(e,t){for(var o=this.index,i=0;i<6;i++){var r=e.substr(i,1)||-1;o=o[r]?o[r]:o[r]=5==i?[]:{}}o.push(t)},i.prototype.remove=function(e){var t=this.prepareFunc(e),o=this.strToPrefixes(t);for(var i in o)if(o.hasOwnProperty(i)){for(var r=this.index,s=0;s<6;s++){var n=i.substr(s,1)||-1;if(!r[n])break;r=r[n]}if(r.length)for(var a in r)if(this.equals(r[a],e)){r.splice(a,1);break}}},i.prototype.equals=function(e,t){for(var o in e)if(e.hasOwnProperty(o))switch(typeof e[o]){case"object":if(!this.equals(e[o],t[o]))return!1;break;case"function":if(void 0===e[o]||e[o].toString()!=t[o].toString())return!1;break;default:if(e[o]!=t[o])return!1}for(var i in t)if(void 0===t[i])return!1;return!0},i.prototype.intersect=function(e,t){var o=[];if(isNumeric(e[0])||isNumeric(t[0]))return e.filter((function(e){return-1!==t.indexOf(e)}));for(;e.length>0&&t.length>0;)e[0]._order<t[0]._order?e.shift():(e[0]._order>t[0]._order||this.equals(e[0],t[0])&&o.push(e.shift()),t.shift());return o},i.prototype.add=function(e){var t=this.prepareFunc(e),o=this.strToPrefixes(t);for(var i in o)o.hasOwnProperty(i)&&this.toIndexTree(i,e)},i.prototype.search=function(e){var t=this.index,o=this.strToSearchPrefixes(e),i=[],r=!1;for(var s in o)if(o.hasOwnProperty(s)){if(r&&!i)break;var n=this.localSearch(o[s],0,t);n.sort((function(e,t){return e._order-t._order})),i=r?this.intersect(i,n):n,r=!0}for(var a=i[0],c=i.length+1,l=[],d=1;d<c;d++){var u=i[d];u!=a&&(l.push(a),a=u)}return l},i.prototype.localSearch=function(e,t,o){if(!o)return[];var i={};for(var r in e)if(e.hasOwnProperty(r)){var s=r.substr(t,1)||-1;i[s]||(i[s]={}),i[s][r]=1}if(6==t++||!o)return o;var n=[];for(var a in i)if(-1==a)for(var c in o)o.hasOwnProperty(c)&&n.push.apply(n,this.localSearch(i[a],t,o[c]));else{var l=this.localSearch(i[a],t,o[a]);n.push.apply(n,l)}return n}},TBLV:function(e,t,o){"use strict";o.r(t);o("91GP"),o("ioFf"),o("rGqo"),o("Btvt");var i=o("q1tI"),r=(o("17x9"),o("ZxpX"));function s(){return(s=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var o=arguments[t];for(var i in o)Object.prototype.hasOwnProperty.call(o,i)&&(e[i]=o[i])}return e}).apply(this,arguments)}function n(e,t){if(null==e)return{};var o,i,r=function(e,t){if(null==e)return{};var o,i,r={},s=Object.keys(e);for(i=0;i<s.length;i++)o=s[i],t.indexOf(o)>=0||(r[o]=e[o]);return r}(e,t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(i=0;i<s.length;i++)o=s[i],t.indexOf(o)>=0||Object.prototype.propertyIsEnumerable.call(e,o)&&(r[o]=e[o])}return r}var a=e=>{var t=e.className,o=e.children,a=n(e,["className","children"]),c=Object(r.classNames)("Radio",t,{"Radio--disabled":e.disabled});return i.createElement("label",{className:c},i.createElement("input",s({className:"Radio__input Radio__visuallyHidden",type:"radio"},a)),i.createElement("span",{className:"Radio__control"}),Boolean(o)&&i.createElement("span",{className:"Radio__text"},o))};a.defaultProps={className:"",name:void 0,onChange:void 0,checked:void 0,defaultChecked:void 0,autoFocus:!1,disabled:!1,children:null},t.default=a},"Tn+0":function(e,t,o){"use strict";o.r(t),o.d(t,"MODULE",(function(){return i})),o.d(t,"REPORT_CLASS",(function(){return r})),o.d(t,"BAN_PERIOD_FOREVER",(function(){return s})),o.d(t,"_getReportRawIdByElement",(function(){return n})),o.d(t,"_getReportDecisionRawIdByElement",(function(){return a}));o("pIFo");var i="sf",r="sf_report",s=1e3;function n(e){return gpeByClass(r,e).id.replace("report","")}function a(e){var t=gpeByClass(r,e),o=geByClass1("decision_result",t);return domData(o,"decision_raw_id")}},UCWv:function(e,t,o){"use strict";o.r(t),o.d(t,"STORIES_MANAGE_MODULE",(function(){return i})),o.d(t,"LONG_PRESS_DELAY_MS",(function(){return r})),o.d(t,"StickerTypes",(function(){return s})),o.d(t,"EMOJI_REACTIONS_ARR",(function(){return n})),o.d(t,"QUESTION_SELECT_MODE",(function(){return a})),o.d(t,"MAX_FEEDBACK_STORIES_SLICE_COUNT",(function(){return c})),o.d(t,"INIT_MAX_FEEDBACK_STORIES_COUNT",(function(){return l})),o.d(t,"MAX_NARRATIVE_STORIES",(function(){return d})),o.d(t,"NARRATIVE_MAX_TITLE_LENGTH",(function(){return u})),o.d(t,"BOX_ITEM_DRAGGABLE_CLASS",(function(){return p}));var i="stories_manage",r=200,s={hashtag:1,mention:2,question:3,place:4,music:5,storyReply:6,owner:7,link:8,marketItem:9,post:10,poll:11,app:13},n=[{code:"f09f9882",name:"face_with_tears_of_happiness"},{code:"f09f988d",name:"smiling_face_with_heart_eyes"},{code:"f09f918df09f8fbf",name:"thumbs_up"},{code:"f09f98ad",name:"loud_crying_face"},{code:"f09f98b1",name:"face_screaming_in_fear"},{code:"e298ba",name:"smiling_face"}],a={PUBLIC:0,AUTHOR_ONLY:1,ANONYMOUS:3},c=50,l=10,d=100,u=23,p="NarrativeBox__draggable"},UWqh:function(e,t,o){"use strict";o.r(t),o.d(t,"StoryArchiveInfiniteGrid",(function(){return h}));var i,r=o("q1tI"),s=o.n(r),n=o("505V"),a=o("gMX8"),c=o("c29r"),l=o("ZxpX"),d=o("UCWv"),u=(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])})(e,t)},function(e,t){function o(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(o.prototype=t.prototype,new o)}),p=d.MAX_NARRATIVE_STORIES,h=function(e){function t(t){var o=e.call(this,t)||this;return o.gridContainerRef=s.a.createRef(),o}return u(t,e),t.prototype.render=function(){var e=this,t=this.props,o=t.stories,i=t.appearance,r=t.selectedStoriesMap,d=t.selectType,u=t.className,p=t.onToggleCheck,h=t.hint;return s.a.createElement(a.StoryArchiveGridContainer,{className:Object(l.classNames)("StoryArchiveInfiniteGrid",u),appearance:i,ref:this.gridContainerRef},h&&s.a.createElement("div",{className:"StoryArchiveInfiniteGrid__hint"},h),s.a.createElement("div",{className:"StoryArchiveInfiniteGrid__inner"},o.map((function(t){var o=e.isSelectable(t);return s.a.createElement("div",{className:Object(l.classNames)("StoryArchiveInfiniteGrid__story","StoryArchiveInfiniteGrid__story--"+i),key:t.rawId},s.a.createElement(c.StoryArchivePreview,{appearance:i,story:t,draggable:!1,disable:d===n.GridSelectType.checkbox&&!o,checked:!!r[t.rawId],selectable:o,onToggleCheck:p}))}))))},t.prototype.isSelectable=function(e){var t=this.props,o=t.selectType,i=t.selectedStoriesMap,r=Object.keys(i).length;return!e.isUnavailable&&(!(o!==n.GridSelectType.checkbox||!(r<p||i[e.rawId]))||o===n.GridSelectType.radio)},t}(s.a.Component)},UlUB:function(e,t,o){"use strict";function i(e,t){var o,i,r=!1;return function s(){if(r)return o=arguments,void(i=this);e.apply(this,arguments),r=!0,setTimeout((function(){r=!1,o&&(s.apply(i,o),o=i=null)}),t)}}o.r(t),o.d(t,"throttle",(function(){return i}))},W28y:function(e,t,o){"use strict";o.r(t),o.d(t,"PHP_SECOND",(function(){return i})),o.d(t,"PHP_MINUTE",(function(){return r})),o.d(t,"PHP_HOUR",(function(){return s})),o.d(t,"PHP_DAY",(function(){return n})),o.d(t,"PHP_WEEK",(function(){return a})),o.d(t,"PHP_MONTH",(function(){return c})),o.d(t,"PHP_YEAR",(function(){return l})),o.d(t,"MILLISECONDS_MULTIPLIER",(function(){return d})),o.d(t,"SECOND",(function(){return u})),o.d(t,"MINUTE",(function(){return p})),o.d(t,"HOUR",(function(){return h})),o.d(t,"DAY",(function(){return _})),o.d(t,"WEEK",(function(){return m})),o.d(t,"MONTH",(function(){return v})),o.d(t,"YEAR",(function(){return f})),o.d(t,"TARGET_BLANK",(function(){return g})),o.d(t,"EVENT_MOUSEDOWN",(function(){return y})),o.d(t,"EVENT_KEYDOWN",(function(){return b})),o.d(t,"EVENT_SCROLL",(function(){return w})),o.d(t,"EVENT_CLICK",(function(){return k})),o.d(t,"getCurrentUrl",(function(){return S})),o.d(t,"updateUrl",(function(){return j})),o.d(t,"getUrlParam",(function(){return E})),o.d(t,"getAct",(function(){return O})),o.d(t,"openInNewTab",(function(){return C})),o.d(t,"getTime",(function(){return T})),o.d(t,"getCurrentDayBoundaries",(function(){return L})),o.d(t,"getDayBoundaries",(function(){return B})),o.d(t,"timestampToSeconds",(function(){return x})),o.d(t,"showLoading",(function(){return N})),o.d(t,"hideLoading",(function(){return I})),o.d(t,"hideCurrentBox",(function(){return M})),o.d(t,"initRadioButtons",(function(){return R})),o.d(t,"isSpecialKeyPressed",(function(){return A})),o.d(t,"isIntegerString",(function(){return P}));var i=1,r=60,s=3600,n=86400,a=604800,c=2592e3,l=31536e3,d=1e3,u=i*d,p=r*d,h=s*d,_=n*d,m=n*d,v=c*d,f=l*d,g="_blank",y="mousedown",b="keydown",w="scroll",k="click";function S(){return nav.strLoc}function j(e){var t={0:nav.objLoc[0],act:nav.objLoc.act};nav.setLoc(extend(t,e))}function E(e){return nav.objLoc[e]}function O(){return E("act")}function C(e){window.open(e,"_blank").focus()}function T(){return x(Date.now())}function L(){return B((new Date).getTime())}function B(e){var t=new Date(e),o=new Date(e);return t.setHours(0,0,0,0),o.setHours(23,59,59,999),[t.getTime(),o.getTime()]}function x(e){return Math.floor(e/d)}function N(){var e=new MessageBox;e.setOptions({title:!1,hideButtons:!0}).show(),hide(boxLayerBG),hide(e.bodyNode),show(boxLoader),boxRefreshCoords(boxLoader)}function I(){curBox&&curBox()&&curBox().hide()}function M(){curBox().hide()}function R(e,t,o){window.radioBtns[e]={val:o,els:Array.prototype.slice.apply(geByClass("radiobtn",geByClass1(t)))}}function A(e){return e.ctrlKey||e.metaKey&&browser.mac}function P(e){return/^-?(0|[1-9]\d*)$/.test(e)}},WbBG:function(e,t,o){"use strict";e.exports="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED"},"Xq7/":function(e,t,o){"use strict";o.r(t),o.d(t,"ModalHeader",(function(){return n}));var i=o("q1tI"),r=o.n(i),s=o("ZxpX"),n=function(e){var t=e.title,o=e.onClose,i=e.appearance,n=void 0===i?"white":i,a=e.backText,c=e.onBack,l=Object(s.classNames)("ModalHeader","ModalHeader--"+n);return r.a.createElement("div",{className:l},a&&r.a.createElement("button",{className:"ModalHeader__back",onClick:c},a),r.a.createElement("h1",{className:"ModalHeader__title"},t),r.a.createElement("button",{className:"ModalHeader__cross",type:"button",onClick:o},"Закрыть"))}},ZO95:function(e,t,o){"use strict";o.r(t);var i,r=o("q1tI"),s=o("t7n3"),n=o("ZxpX"),a=(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])})(e,t)},function(e,t){function o(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(o.prototype=t.prototype,new o)}),c=function(e){function t(t){var o=e.call(this,t)||this;return o.getActiveTabKey=function(){var e=o.props,t=e.active,i=e.activeRequired,s=[],n=null;return r.Children.forEach(o.props.children,(function(e){r.isValidElement(e)&&(e.key===t?n=e.key:s.push(e))})),n||("number"==typeof t&&s.length>t?s[t].key||t:i&&s.length?s[0].key||0:null)},o.onClick=function(e,t){if(t!==o.state.active){var i=o.refsStore[t],r=o.getTransform(i);o.setState({active:t,isAnimating:!0,transform:r}),o.props.onTabClick&&o.props.onTabClick(e,t)}},o.onTransitionEnd=function(e){"transform"===e.propertyName&&o.setState({isAnimating:!1})},o.storeRef=function(e,t){t&&(o.refsStore[e]=t)},o.refsStore={},o.state={isAnimating:!1,active:o.getActiveTabKey()},o}return a(t,e),t.reactifyTabs=function(e){return(Array.isArray(e)?e:Object.values(e)).map((function(e){return r.createElement("a",{key:e[0],href:e[2],onClick:function(){}},e[1]?Object(s.unclean)(e[1]):"")}))},t.prototype.componentDidUpdate=function(e){void 0!==this.props.active&&this.props.active!==e.active&&this.setState({active:this.props.active})},t.prototype.getTransform=function(e){var t=e.offsetWidth;return"translateX("+(e.offsetLeft-50+.5*t)+"px) scaleX("+t/100+")"},t.prototype.componentDidMount=function(){if(this.state.active){var e=this.refsStore[this.state.active];this.setState({transform:this.getTransform(e)})}},t.prototype.render=function(){var e=this,t={"Tabs--animating":this.state.isAnimating};return r.createElement("nav",{className:Object(n.classNames)("Tabs",this.props.className,t),style:this.props.style},r.createElement("ul",{className:"Tabs__list"},r.Children.map(this.props.children,(function(t,o){if(!r.isValidElement(t))return null;var i=t.key||o;return r.createElement("li",{className:Object(n.classNames)("Tabs__item",{"Tabs__item--active":e.state.active===i}),onClick:function(t){return e.onClick(t,i)},ref:function(t){return e.storeRef(i,t)},key:i},t)}))),this.props.aside&&r.createElement("div",{className:"Tabs__aside"},this.props.aside),r.createElement("div",{style:{transform:this.state.transform},className:"Tabs__divider",onTransitionEnd:this.onTransitionEnd}))},t.defaultProps={active:0,activeRequired:!0,aside:null,style:{},className:""},t}(r.Component);t.default=c},aFGQ:function(e,t,o){"use strict";o.r(t);var i,r=o("q1tI"),s=o("i8i4"),n=o("ZxpX"),a=(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])})(e,t)},function(e,t){function o(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(o.prototype=t.prototype,new o)}),c=function(){return(c=Object.assign||function(e){for(var t,o=1,i=arguments.length;o<i;o++)for(var r in t=arguments[o])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)},l=o("dLHM").default,d=function(e){function t(t){var o,i=e.call(this,t)||this;return i.handleMouseDown=function(e){i.props.onFocus&&"function"==typeof i.props.onFocus&&i.props.onFocus(i.state.opened),"mousedown"===e.type&&0!==e.button||(e.stopPropagation(),e.preventDefault(),i.props.disabled||i.props.alwaysOpened||i.toggle(!i.state.opened))},i.getOptionByValue=function(e,t){return e.find((function(e){return"object"!=typeof e?e===t:e.value===t}))},i.setValue=function(e,t){"object"==typeof t&&i.props.searchable&&(t=t.props.title);var o={value:e,label:"object"==typeof t?t:t.toString()},r={selected:o};i.fireChangeEvent(o),i.setState(r),i.props.alwaysOpened||i.toggle(!1)},i.fireChangeEvent=function(e){e!==i.state.selected&&i.props.onChange&&i.props.onChange({name:i.props.name,selected:e})},i.renderOption=function(e){var t=Object(n.classNames)("Select__option",{"Select__option--selected":e===i.state.selected}),o=void 0!==e.value?e.value:e.label||e,s=void 0!==e.label?e.label:e;return r.createElement("div",{key:o,className:t,onMouseDown:function(){return i.setValue(o,s)},onClick:function(){return i.setValue(o,s)},title:e.title},s)},i.buildMenu=function(){var e=i.state.filteredOptions.map((function(e){return"string"!=typeof e&&"group"===e.type?r.createElement("div",{className:"Select__group",key:e.name},e.name&&r.createElement("div",{className:"Select__title"},e.name),e.items&&e.items.map((function(e){return i.renderOption(e)}))):i.renderOption(e)}));return e.length?e:r.createElement("div",{className:"Select__noresults"},i.props.searchPlaceholder)},i.renderMenu=function(){return i.props.customMenu?i.props.customMenu(i.state.filteredOptions,i.setValue,i.state.selected):r.createElement("div",{className:"Select__menu"},i.buildMenu())},i.filterOptions=function(e,t){var o=e.toLowerCase();return t.filter((function(e){return"string"==typeof e?e.toLowerCase().includes(o):"string"==typeof e.label?e.label.toLowerCase().includes(o):"object"==typeof e.label?e.label.props.title.toLowerCase().indexOf(o)>=0:void 0}))},i.handleSearchType=function(e){var t=i.filterOptions(e.target.value,i.state.allOptions);i.setState({selected:{value:e.target.value,label:e.target.value},filteredOptions:t}),i.toggle(!0),i.props.onType&&i.props.onType(e.target.value)},i.handleEditableType=function(e){i.setState({opened:!0}),i.props.onEdit&&i.props.onEdit(e.target.value)},i.buildControl=function(e){var t,o="",s=i.props,a=s.searchable,d=s.editable,u=s.inputOtherProps,p=Object(n.classNames)("Select__input",u&&u.className,{"Select__input--editable":!a&&!!d});return e&&"string"==typeof e&&(o=e),e&&"object"==typeof e&&(e&&"string"==typeof e.label&&(o=e.label),e&&"object"==typeof e.label&&a&&(o=e.label.props.title||""),e&&"object"==typeof e.label&&!a&&(t=e.label)),a?r.createElement(l,c({placeholder:i.props.placeholder,value:o||"",onClick:i.handleMouseDown,onChange:i.handleSearchType.bind(i),onFocus:i.props.onInputFocus,onBlur:i.props.onInputBlur,disabled:i.props.disabled,isControlledOutside:!0},u,{className:p})):d?r.createElement("div",{className:"Select__control",onClick:i.handleMouseDown},r.createElement(l,c({placeholder:i.props.placeholder,id:i.props.id,value:o||"",onChange:i.handleEditableType,onFocus:i.props.onInputFocus,onBlur:i.props.onInputBlur,disabled:i.props.disabled,isControlledOutside:!0,autoComplete:"off"},u,{className:p})),r.createElement("span",{className:"Select__arrow"})):r.createElement("div",{className:"Select__control",onClick:i.handleMouseDown},r.createElement("div",{className:"Select__placeholder"},o||t),r.createElement("span",{className:"Select__arrow"}))},i.handleDocumentClick=function(e){i.mounted&&i.state.opened&&!i.props.alwaysOpened&&i.el&&!i.el.contains(e.target)&&i.toggle(!1)},o=void 0!==t.value?t.editable&&void 0!==t.customValue?{label:t.customValue,value:t.customValue}:i.getOptionByValue(t.options,t.value):{label:i.getLabel(t),value:""},i.state={filteredOptions:t.options,allOptions:t.options,selected:o,opened:!!t.alwaysOpened},i.mounted=!0,i}return a(t,e),t.prototype.getLabel=function(e){return this.props.searchable?this.props.value||"":e.placeholder||"Select..."},t.prototype.componentWillReceiveProps=function(e){this.setState({filteredOptions:e.options,allOptions:e.options}),this.props.editable&&void 0!==e.customValue?this.setState({selected:{label:e.customValue,value:e.customValue}}):void 0!==e.value&&e.value!==this.state.selected?this.setState({selected:this.getOptionByValue(e.options,e.value)}):void 0===e.value&&this.setState({selected:{label:this.getLabel(e),value:""}})},t.prototype.componentDidMount=function(){this.el=s.findDOMNode(this),document.addEventListener("click",this.handleDocumentClick,!1),document.addEventListener("touchend",this.handleDocumentClick,!1)},t.prototype.componentWillUnmount=function(){this.mounted=!1,document.removeEventListener("click",this.handleDocumentClick,!1),document.removeEventListener("touchend",this.handleDocumentClick,!1)},t.prototype.toggle=function(e){var t=this;this.setState({opened:e},(function(){var e,o,i,r;t.state.opened?null===(o=(e=t.props).onShow)||void 0===o||o.call(e):null===(r=(i=t.props).onHide)||void 0===r||r.call(i)}))},t.prototype.render=function(){var e=this.props,t=e.className,o=e.appearance,i=e.style,s=e.searchable,a=e.editable,c=e.disabled,l=this.state,d=l.selected,u=l.opened,p=d&&"object"==typeof d&&!d.value||!1,h=s||a?"secondary":o,_=Object(n.classNames)("Select","Select--"+h,{"Select--opened":!!u,"Select--disabled":!!c,"Select--empty":p},t),m=this.buildControl(d);return r.createElement("div",{className:_,style:i},m,this.state.opened&&this.renderMenu())},t.defaultProps={appearance:"primary",searchPlaceholder:"No options found",searchable:!1,editable:!1,inputOtherProps:{},onShow:function(){},onHide:function(){}},t}(r.Component);t.default=d},awNS:function(e,t,o){"use strict";o.r(t),o.d(t,"consoleWrap",(function(){return i})),o.d(t,"patternWrap",(function(){return r})),o.d(t,"reportList",(function(){return s})),o.d(t,"reportTabs",(function(){return n})),o.d(t,"tabReports",(function(){return h})),o.d(t,"tabPattern",(function(){return _})),o.d(t,"tabPatterns",(function(){return m})),o.d(t,"switchTab",(function(){return v})),o.d(t,"getCurrentTab",(function(){return f})),o.d(t,"activeTab",(function(){return g})),o.d(t,"getCustomOption",(function(){return b})),o.d(t,"init",(function(){return S}));var i,r,s,n,a,c=o("4Ch9"),l=o("b8yN"),d=o("uRA3"),u=o("W28y"),p=o("ofcU"),h="reports",_="pattern",m="patterns";function v(e,t){var o=geByClass1("_nospam_tab_switch_"+e);uiTabs.switchTab(domFC(o)),t&&(o=domChildren(o));var i=geByClass("nospam_tab"),r=domData(o,"tab-id");return i.forEach((function(e){domData(e,"id")!=r?hide(e):show(e)})),Object(u.updateUrl)({tab:e}),e===m?d.noSpamPatterns.initUpdate():e===h?l.noSpamReports.initUpdate():e===_&&scrollToTop(),!1}function f(){return Object(u.getUrlParam)("tab")}function g(){var e=domPN(geByClass1("ui_tab_sel"));return domData(e,"tab-id")}function y(e){geByClass("_nospam_option_action",a).forEach(t=>{var o=domData(t,"option"),i=+e[o],r=window.cur.lang["nospam_options_"+o];r&&(t.innerHTML=r[i]),domData(t,"option-state",i)}),cur.options.custom_options=e}function b(e){var t=window.cur;return!!t.options.custom_options&&t.options.custom_options[e]}var w={width:185,height:500,multiselect:!1};function k(e){extend(cur,{uiSpamtype:new Dropdown(ge("spamtype"),e.spamtypes,extend(w,{selectedItems:cur.options.spamtype})),uiSpamtype2:new Dropdown(ge("spamtype2"),e.spamtypes,extend(w,{selectedItems:cur.options.spamtype2})),uiSimplify:new Dropdown(ge("simplify_select"),e.simplifies,extend(w,{selectedItems:cur.options.simplify})),uiBan:new Dropdown(ge("ban_select"),e.bans,extend(w,{selectedItems:cur.options.ban})),uiDuration:new Dropdown(ge("duration_select"),e.durations,extend(w,{selectedItems:cur.options.duration})),uiSearchPeriod:new Dropdown(ge("search_period_select"),e.searchperiods,extend(w,{selectedItems:cur.options.searchperiod}))}),placeholderSetup("comment_input"),val("comment_input")&&autosizeSetup("comment_input",{minHeight:30}),geByClass("conditions_input").forEach((function(e){placeholderSetup("comment_input"),val(e)&&autosizeSetup("comment_input",{minHeight:30})}));var t=ge("page_body");r=geByClass1("pattern_wrap",t),i=geByClass1("console_wrap",t),n=geByClass1("reports_tabs",t),s=geByClass1("_reports_list",t),a=geByClass1("_nospam_options",t);var o=geByClass1("nospam_patterns_wrap",t),u=Object(p.createModule)({handlers:(e,t)=>{t(o,"click","_abort_pattern_mild",e=>Object(d.abortPatternMild)(domData(e.target,"id"))),t(a,"click","_nospam_option_action",e=>{return t=e.target,o={act:"a_set_custom_option",name:domData(t,"option"),state:1^domData(t,"option-state")},void ajax.post("noSpam.php",o,{onDone:y,showProgress:lockActionsMenuItem.pbind(t),hideProgress:unlockActionsMenuItem.pbind(t)});var t,o})}});cur.destroy.push(()=>{Object(p.destroyModule)(u)}),Object(c.mount)(),Object(l.mount)()}function S(e){var t=Object(p.createMutations)(k);t.callMutations;(0,t.bindMutations)(e)}},b8yN:function(e,t,o){"use strict";o.r(t),o.d(t,"activeReportsType",(function(){return g})),o.d(t,"activeSubReportsType",(function(){return y})),o.d(t,"prepareReport",(function(){return b})),o.d(t,"switchReports",(function(){return w})),o.d(t,"dealSingleSpamer",(function(){return T})),o.d(t,"reportsTime",(function(){return B})),o.d(t,"onFiltersChange",(function(){return M})),o.d(t,"mount",(function(){return R})),o.d(t,"noSpamReports",(function(){return A}));o("HEwt"),o("a1Th"),o("rE2o"),o("ioFf"),o("KKXr"),o("rGqo"),o("Btvt");var i,r=o("1BRX"),s=o("4Ch9"),n=o("awNS");function a(){i=(new Date).getTime()}function c(){var e=(new Date).getTime(),t=(e-i)/1e3,o=Array.prototype.slice.call(arguments);o.push(t),debugLog.apply(null,o)}var l=o("W28y"),d=o("ofcU");function u(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var o=[],i=!0,r=!1,s=void 0;try{for(var n,a=e[Symbol.iterator]();!(i=(n=a.next()).done)&&(o.push(n.value),!t||o.length!==t);i=!0);}catch(e){r=!0,s=e}finally{try{i||null==a.return||a.return()}finally{if(r)throw s}}return o}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return p(e,t);var o=Object.prototype.toString.call(e).slice(8,-1);"Object"===o&&e.constructor&&(o=e.constructor.name);if("Map"===o||"Set"===o)return Array.from(o);if("Arguments"===o||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o))return p(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function p(e,t){(null==t||t>e.length)&&(t=e.length);for(var o=0,i=new Array(t);o<t;o++)i[o]=e[o];return i}var h={},_={},m=new Date,v=setTimeout(null),f=0;function g(){var e=geByClass1("active_filter",n.reportTabs);return domData(e,"type")}function y(){var e=geByClass1("_reports_subtabs",n.reportTabs),t=geByClass1("active_filter",e);return domData(t,"subtype")}function b(e,t){a();var o=geByClass1("_report_btn_update",n.reportList);if(!isButtonLocked(o)){var i=geByClass1("_reports_"+e+"_wrap",n.reportList);if(i){var r={act:"a_get_reports",encode_entities:1,type:e,sub_type:t,shift:cur.options.shift};"mail"===e&&"mail_group"===t&&(r=extend(r,function(){if("mail"===e||"mail_group"===t){var o=geByClass1("filters");return{hide_groups_with_disabled_messages:isChecked(geByClass1("hide_groups_with_disabled_messages_filter",o)),shift:isObject(cur.hoursShiftSlider)?23*cur.hoursShiftSlider._currValue:0,min_reporters_amount:val(geByClass1("min_reports_amount_filter",o)),sorting:radioval("group_messages_reports_sorting")}}console.log("Unsupported filters used")}())),ajax.post("noSpam.php",r,{onDone:function(t){if(c("actions fetch"),h={},0!==t.length){for(var o=0;o<t.length;o++){var r=t[o];r.ui_type=e;var s=k(r.ui_type,o);N(r.ua_hash,r.agent_name),delete r.agent_name,delete r.remix_seed,r.index=o,h[s]=r}i.innerHTML="",S(e,0),t=""}else i.innerHTML=getTemplate("nospam_reports_type_search_empty")},onFail:function(e){c("actions fetched fail"),topError(e),i.innerHTML=getTemplate("nospam_reports_type_search_error")},showProgress:lockButton.pbind(o),hideProgress:unlockButton.pbind(o)}),scrollToTop()}else topError("Can't find wrap for type: "+e)}}function w(e){var t=e.target,o=domData(t,"type"),i=domData(t,"subtype"),r=geByClass("report_filter",n.reportTabs),s=geByClass("report_subfilter",n.reportTabs),a=geByClass1("active_type",n.reportList);if(!o)return!1;r.forEach(e=>{hasClass(e,"active_filter")&&removeClass(e,"active_filter"),domData(e,"type")!==o||domData(e,"subtype")||addClass(e,"active_filter")});var c=!1,l=!1;s.forEach(e=>{removeClass(e,"report_subfilter_active"),removeClass(e,"active_filter"),domData(e,"type")===o&&(addClass(e,"report_subfilter_active"),c=!0),domData(e,"subtype")===i&&(addClass(e,"active_filter"),l=!0)});var d=geByClass1("hr",n.reportTabs);if(c?show(d):hide(d),c&&!l){var u=geByClass1("report_subfilter_active",n.reportTabs);addClass(u,"active_filter")}domData(a,"type")!==o&&(removeClass(a,"active_type"),addClass(ge("reports_"+o),"active_type")),b(o,i)}function k(e,t){return"report_"+e+"_"+t}function S(e,t,o){a(),o||(o=20);for(var i=geByClass1("_reports_"+e+"_wrap",n.reportList),r=domPN(i),s=geByClass1("_reports_type_show_more",r),l=0,d=0,p=0;l<o;){d=p,p++;var _=k(e,d),m=h[_];if(!(d<t)){if("object"!=typeof m){debugLog("empty reports after "+d,"need to shift "+t);break}if(m.uid&&!0!==m.showed){var v=ce("div",{id:"report_"+e+"_"+d});if(addClass(v,"clear_fix"),addClass(v,"report"),m.mem_banned||m.uid_base_info){if(Object(n.getCustomOption)("hide_banned"))continue;addClass(v,"banned")}m.ui_type=e;[O(m),u(E(m),1)[0],C(m,d)].forEach((function(e){v.appendChild(e)})),i.appendChild(v),l++}}}if(0!==l){s?isVisible(s)||show(s):(s=ce("div",{className:"reports_type_show_more _reports_type_show_more"}),r.appendChild(s));var f=parseInt(t)+20;s.innerHTML=getTemplate("nospam_reports_show_more",{need_shift:f}),c("actions to html")}else hide(s)}function j(){var e=getSelectionText();e?cur.uiSimplify.selectItem("0"):(e="/",cur.uiSimplify.selectItem("32")),val("pattern_input",e)}function E(e){var t,o="",i=e.type_name,r=parseInt(e.type),s=ce("div");switch(addClass(s,"report_body"),e.api_id>0&&(setStyle(s,"color","#bbbbbb"),o+=e.api_id>0?'<div class="report_api">Приложение ('+e.api_id+"):</div>":""),e.message&&(o+=getTemplate("nospam_reports_field",{class:"report_message",value:e.message})),e.kludges&&(o+=getTemplate("nospam_reports_field",{class:"reports_kludges",value:e.kludges})),e.attaches&&(o+=getTemplate("nospam_reports_attaches",{attaches:e.attaches})),r){case 500:case 510:case 545:t="<a href='/wall"+e.owner_id+"_"+e.msg_id+"' target='_blank'> "+i+"</a>";break;case 501:case 550:t="<a href='/wall"+e.owner_id+"_"+e.parent_id+"?reply="+e.msg_id+"' target='_blank'> "+i+"</a>",e.group_id&&e.group_link&&(o+=getTemplate("nospam_reports_group_id",{group_id:e.group_id,group_link:e.group_link}));break;case 100:o+=e.score?"<b>phone_cheat:</b> "+e.score:"",e.update_time&&(o+=getTemplate("nospam_reports_tag",{tag_label:e.update_time}));break;case 200:o+=getTemplate("nospam_reports_labeled_value",{label:"receivers_num",value:e.receivers_num}),o+=getTemplate("nospam_reports_labeled_value",{label:"chat_msg_id",value:e.chat_msg_id}),o+=getTemplate("nospam_reports_labeled_value",{label:"chat_title",value:e.chat_title});break;case 300:if(e.group_id&&e.group_link&&(o+=getTemplate("nospam_reports_group_id",{group_id:e.group_id,group_link:e.group_link})),e.admin_id&&e.admin_link){var n=e.admin_id;o+=getTemplate("nospam_reports_admin_id",{admin_id:n,admin_link:e.admin_link})}break;case 160:o+=e.title;break;case 161:o+=e.new_title;break;case 200:e.attaches;-152029297==e.uid&&e.original_user_link&&(o+=getTemplate("nospam_reports_molodec_label",{original_user_link:e.original_user_link}));case 2602:case 2647:t="<a href='/video"+e.owner_id+"_"+e.video_id+"' target='_blank'> "+i+"</a>";break;case 2600:case 2610:case 2611:case 2645:case 2650:t="<a href='/video"+e.owner_id+"_"+e.video_id+"' target='_blank'> "+i+"</a>",o+='<table class="report_video"><tr>',o+='<td style="width: 130px;"><a class="report_video_thumb" href="'+e.video.href+'" onclick="'+e.video.onclick+'" style="background-image: url(\''+e.video.thumb+'\')"><div class="report_video_duration"><span class="report_video_icon"></span><span class="report_video_duration_text">'+e.video.duration_text+"</span></div></a></td>",o+="<td>",o+=e.video.DELETED?"Видеозапись удалена":'<div class="report_video_title"><a href="'+e.video.href+'" onclick="'+e.video.onclick+'">'+e.video.title_short+"</a></div>",o+=!e.video.DELETED&&e.description?'<div class="report_video_description">'+e.video.description_short+"</div>":"",o+="</td>",o+="</tr></table>",o+='<div class="report_video_duration_second"><b>Duration:</b> <a class="_console_conditions" data-conditions="duration = '+e.duration+'">'+e.duration+"</a></div>",e.external&&(o+='<div class="report_video_external"><b>External:</b> '+e.external+"</div>");break;case 3504:case 3545:t="<a href='/photo"+e.owner_id+"_"+e.photo_id+"' target='_blank'> "+i+"</a>";break;case 13120:case 13121:t="<a href='/market"+e.owner_id+"?w=product"+e.owner_id+"_"+e.item_id+"' target='_blank'> "+i+"</a>";break;case 3500:case 3547:t="<a href='/photo"+e.owner_id+"_"+e.photo_id+"' target='_blank'> "+i+"</a>",o+='<table class="report_photo"><tr>',o+='<td><div class="report_photo_thumb">'+e.photo+"</div></td>",o+=e.description?'<td><div class="report_photo_description">'+e.description+"</div></td>":"",o+="</tr></table>",o+=e.album_id<0?'<div class="report_album_id"><b>album_id:</b> '+e.album_id+"</div>":"";break;case 3550:t="<a href='/photo"+e.owner_id+"_"+e.photo_id+"' target='_blank'> "+i+"</a>",o+=e.photo,o+=e.album_id<0?'<div class="report_album_id"><b>album_id:</b> '+e.album_id+"</div>":"";break;case 9258:o+=e.about;break;case 1800:o+=e.status;break;case 1531:case 1530:case 1534:o+=e.text;break;case 5e3:t="<a href='/topic-"+e.group_id+"_"+e.topic_id+"' target='_blank'> "+i+"</a>",o+=e.title;break;case 5001:case 5046:t="<a href='/topic-"+e.group_id+"_"+e.topic_id+"?post="+Math.abs(e.comment_id)+"' target='_blank'> "+i+"</a>";break;case 2131:var a=e.group_id;t="Группа: "+getTemplate("nospam_reports_id_link",{type:"club",id:a,label:a,color:"black"}),o+="<b>Название:</b>"+e.group_name+"<br>",o+="<b>Описание:</b>"+e.group_description+"<br>";break;case 7530:t="<a href='/app"+e.app_id+"' target='_blank'> "+i+"</a>",o+=e.app_name+"<br>";break;case 3670:var c=e.like_ref,l=e.like_type,d=e.owner_id+"_"+e.item_id,u="";switch(Number(l)){case 11:t="<a href='wall<a href='wall"+d+"' target='_blank'> "+i+"</a>",u+="(запись на стене), <a href='wall"+d+"' target='_blank'>vk.com/wall"+d+"</a>";break;case 12:t="<a href='wall"+d+"' target='_blank'> "+i+"</a>",u+="(комментарий на стене), <a href='wall"+d+"' target='_blank'>vk.com/wall"+d+"</a>";break;case 10:t="<a href='photo"+d+"' target='_blank'> "+i+"</a>",u+="(фотография), <a href='photo"+d+"' target='_blank'>vk.com/photo"+d+"</a>";break;case 24:case 8:t="<a href='photo"+d+"' target='_blank'> "+i+"</a>",u+="(видеозапись), <a href='video"+d+"' target='_blank'>vk.com/video"+d+"</a>";break;case 6:t="<a href='audio.php?id="+e.owner_id+"&audio_id="+e.item_id+"' target='_blank'> "+i+"</a>",u+="(аудиозапись), <a href='audio.php?id="+e.owner_id+"&audio_id="+e.item_id+"' target='_blank'>vk.com/audio.php?id="+e.owner_id+"&audio_id="+e.item_id+"</a>";break;case 22:t=i,u+="(комментарий к видео)";break;case 21:t=i,u+="(комментарий к фотографии)";break;case 20:t=i,u+="(комментарий на стене)";break;default:t=i,u+=" (незвестный тип) "+d}o+=getTemplate("nospam_reports_report_like",{like_ref:c,like_ref_id:e.ref,like_type:u,like_type_id:l});break;default:console.log("No type specified")}if(e.post_tags){var p=e.post_tags;Object.keys(p).forEach((function(e){p[e]&&(o=getTemplate("nospam_reports_tag",{tag_label:p[e]})+o)}))}return s.innerHTML=o,[s,t]}function O(e){var t,o,i=e.mem_banned,r=isObject(i),s=r?"Недавняя блокировка:<br>"+i.comment+"<br>"+L(new Date(1e3*i.time)):"",n="",a=k(e.ui_type,e.index),c=e.uid_base_info;""==s&&c&&(t=c[0].pattern_id,o=c[0].state,r=!0,s=(s=0==Number(o)?"Ожидает обработки noSpam ":"Обработан noSpam ")+"(шаблон номер <a href='/pattern"+Number(t)+"' target='_blank'>"+Number(t)+"</a>)");var l,d=ce("div");addClass(d,"report_info"),r&&addClass(d,"report_banned"),s&&(n=getTemplate("nospam_reports_report_ban_tooltip",{action_index:a}),h[a].ban_tt=s);var p,_=e.uid,m=Number(e.type),v=r?"red":"blue";return l=_>0?getTemplate("nospam_reports_id_link",{type:"id",id:_,label:_,color:v}):getTemplate("nospam_reports_id_link",{type:"club",id:-_,label:_,color:v}),p=u(E(e),2)[1],d.innerHTML=getTemplate("nospam_reports_report_info",{action_mention_link:l,action_tt:n,type:m,index:e.index,ip:e.ip,report_time:L(new Date(1e3*e.report_time)),action_time:L(new Date(1e3*e.time)),ua_hash:e.ua_hash,from_uid:e.from_uid,report_count:e.report_count>1?langNumeric(e.report_count,["","%s жалоба","%s жалобы","%s жалоб"]):"",report_type_link:p}),d}function C(e,t){var o="",i="report_"+e.ui_type+"_"+e.index,r=ce("div");(addClass(r,"report_steps"),"photo"!=e.ui_type&&"video"!=e.ui_type||cur.isSearchOnlyMode)||(o+="<span id = 'spamer_by_"+i+"'> <a onclick = \""+("dealSingleSpamer('"+e.ui_type+"', "+e.uid+", "+e.index+")")+'"> Забанить и откатить </a> </span>');return o+=getTemplate("nospam_reports_compose_button",{type:e.real_ui_type?e.real_ui_type:e.ui_type,ip:e.ip,ua_hash:e.ua_hash}),o+="<span id='selected_text_span"+t+"' style='display:none;'></span>",r.innerHTML=o,r}function T(e,t,o){var i="report_"+e+"_"+o;ajax.post("noSpam.php",{act:"a_single_spamer",uid:t,type:e,action:JSON.stringify(h[ge(i)])},{onDone:function(){ge("spamer_by_"+i).innerHTML="<span style = 'color: green'> Добавлен </span>"},onFail:function(){ge("spamer_by_"+i).innerHTML="<span style = 'color: red'> Неудача </span>"}})}function L(e){var t=e.getDate(),o=e.getMonth()+1;return(t<10?"0":"")+t+"."+(o<10?"0":"")+o+" в "+e.toLocaleTimeString()}var B={_sel:[],day:m.getDate(),month:m.getMonth(),months:[[0,"Января"],[1,"Февраля"],[2,"Марта"],[3,"Апреля"],[4,"Мая"],[5,"Июня"],[6,"Июля"],[7,"Августа"],[8,"Сентября"],[9,"Октября"],[10,"Ноября"],[11,"Декабря"]],year:m.getFullYear(),generateHMS:function(e){var t,o=[];switch(e){case"hour":t=23;break;case"minute":case"second":t=59}for(var i=0;i<=t;++i)o.push([i,i<10?"0"+i:i+""]);return o},generateDays:function(e,t){for(var o=[],i=Object(r.getLastDay)(e,t),s=1;s<=i;++s)o.push([s,s+""]);return o},updateDays:function(){var e=this._sel[0],t=this._sel[1].val(),o=this._sel[2].val();e.val()>Object(r.getLastDay)(o,t)&&e.clear(),e.setData(this.generateDays(o,t))},setControls:function(){var e=B,t=[["reports_day",55],["reports_month",95],["reports_year",60],["reports_hour",50],["reports_minute",50],["reports_second",50]],o=ce("div",{id:"reports_time_wrap",className:"reports_time_wrap"}),i=geByClass1("box_body");e.clear(),i.appendChild(o),t.forEach((function(o,r){var s=[],n=[],a=ce("div",{className:o[0]+" fl_l"}),c=ce("input",{type:"hidden",name:o[0],id:o[0]}),l=o[0].split("_")[1];switch(domLC(i).appendChild(a),a.appendChild(c),l){case"year":n=(s=[[e.year,e.year+""]])[0];break;case"month":s=e.months,n=e.month;break;case"day":n=(s=e.generateDays(e.year,e.month))[e.day-1];break;case"hour":s=e.generateHMS(l),n=m.getHours();break;case"minute":s=e.generateHMS(l),n=m.getMinutes();break;case"second":s=e.generateHMS(l),n=m.getSeconds();break;default:n=s=e[l]}var d={width:t[r][1],multiselect:!1,autocomplete:!1,selectedItems:n};"month"!==l&&"year"!==l||extend(d,{onChange:function(e){B.updateDays()}}),B._sel.push(new Dropdown(c,s,d))}))},setTime:function(){boxQueue.hideLast();var e=B,t=e._sel,o={day:t[0].val(),month:t[1].val(),year:t[2].val(),hour:t[3].val(),minute:t[4].val(),second:t[5].val()},i=new Date(o.year,o.month,o.day,o.hour,o.minute,o.second),r=e.tt;val(r,i.getTime()/1e3)},set:function(e,t){var o=this.setControls,i=this.setTime,r=domData(t,"part");m=new Date;var s=r?"time_"+e+"_input2":"time_"+e+"_input";this.tt=ge(s,n.patternWrap),showFastBox({width:435,title:"Время действия ("+("start"==e?"позже":"раньше")+", чем)",dark:1,containerClass:"nospam_report_time_box",onShow:o},'<div class="reports_time_label">Укажите дату:</div>',"Применить",i)},clear:function(){return this._sel=[]}};function x(e){Object(l.isSpecialKeyPressed)(e)?function(e){var t=Object(s.getParams)();if(t.type=domData(e,"type"),null===t.type)return!1;"post"!==t.type&&"comment"!==t.type||(t.type="wall");t.ip=domData(e,"ip"),t.uahash=domData(e,"ua-hash"),t.pattern=t.pattern||getSelectionText(),t.threshold=1;var o=Object(s.composeSearchLinkFromParams)(t);Object(l.openInNewTab)(o)}(e.target):function(e){var t=domData(e,"type"),o=domData(e,"ip"),i=domData(e,"ua-hash");if(null===t)return;"post"!=t&&"comment"!=t||(t="wall");Object(s.setIp)(o),Object(s.setUaHash)(i),Object(s.setThreshold)(1),cur.uiSpamtype.selectItem(t),Object(n.switchTab)(n.tabPattern),Object(s.optionClear)(!1,"reset_all")}(e.target)}function N(e,t){var o=_[e];_[e]?o&&o!==t&&debugLog("collision for "+e,t,o):_[e]=t}function I(){if(Object(n.getCurrentTab)()===n.tabReports){var e=g(),t=geByClass1("_reports_"+e+"_wrap",n.reportList),o=geByClass1("_report_show_more",domPN(t)),i=domPN(o),r=window.innerHeight||document.documentElement||bodyNode.clientHeight;f=scrollGetY(),isVisible(i)&&Object(n.activeTab)()===n.tabReports&&r+f>o.offsetTop&&o.click()}}function M(){clearTimeout(v),v=setTimeout(b.pbind(g(),y()),1e3)}function R(){var e=Object(d.createModule)({handlers:(e,t)=>{t(n.reportList,"mouseover","report_steps",j),t(n.reportList,"click","report_steps",e=>x(e)),t(n.reportList,"mouseover","report_info_ban_tooltip",e=>function(e){var t=e.target,o=domData(t,"action-index"),i=h[o].ban_tt;i&&showTooltip(t,{text:i,dir:"down",hasover:1,shift:[22,5,0]})}(e)),t(n.reportList,"mouseover","report_info_ua_hash",e=>function(e){var t=e.target,o=domData(t,"ua-hash"),i=_[o];showTooltip(t,{text:i||"[NULL]",dir:"down",hasover:1,shift:[22,5,0]})}(e)),e(document,"scroll",I),t(n.reportList,"click","_report_show_more",e=>{var t=domData(e.target,"need-shift");S(g(),t)}),t(n.reportTabs,"click","report_filter",e=>w(e)),t(n.reportList,"click","_report_btn_update",e=>{b(g(),y())}),t(n.reportTabs,"mouseover","settings_dots_wrap",e=>{var t=geByClass1("settings_dots_wrap");showTooltip(t,{black:!0,text:getTemplate("reports_group_message_tab_tooltip"),className:"group_messages_settings_tt",slideY:15,shift:[98,100,20],dir:"top",showdt:300,hidedt:100,hasover:!0,onCreate:function(){var e;e=ge("search_shift_filter"),cur.hoursShiftSlider=new Slider(e,{width:200,height:100,debounce:10,size:2,value:parseFloat(nav.objLoc.shift/23)||0,onChange:e=>{Object(l.updateUrl)({shift:parseInt(23*e)}),M()},formatHint:e=>langNumeric(parseInt(23*e),["","%s час назад","%s часа назад","%s часов назад"])}),Object(l.initRadioButtons)("group_messages_reports_sorting","sorting_radio_filter_wrap",1)}})})}});cur.destroy.push(()=>{Object(d.destroyModule)(e)})}var A={initUpdate:function(){scrollToY(f)}}},c29r:function(e,t,o){"use strict";o.r(t),o.d(t,"StoryArchivePreview",(function(){return a}));var i=o("q1tI"),r=o.n(i),s=o("ZxpX"),n=o("505V"),a=r.a.memo((function(e){var t=e.story,o=e.checked,i=void 0!==o&&o,a=e.selectable,c=void 0!==a&&a,l=e.draggable,d=void 0!==l&&l,u=e.className,p=void 0===u?"":u,h=e.appearance,_=void 0===h?n.EditorViewType.box:h,m=e.onToggleCheck,v=void 0===m?function(){}:m;return r.a.createElement("div",{className:Object(s.classNames)("StoryArchivePreview","StoryArchivePreview--"+_,p),"data-id":t.rawId,style:{backgroundImage:"url("+t.preview+")"}},d&&r.a.createElement("div",{className:"StoryArchivePreview__draggableIcon"}),c&&r.a.createElement("div",{className:Object(s.classNames)("StoryArchivePreview__select",{"StoryArchivePreview__select--on":i}),onClick:function(){return v(t)}}))}))},clTp:function(e,t,o){"use strict";function i(e){var t=e.getBoundingClientRect(),o=document.body,i=document.documentElement,r=window.pageYOffset||i.scrollTop||o.scrollTop,s=window.pageXOffset||i.scrollLeft||o.scrollLeft,n=i.clientTop||o.clientTop||0,a=i.clientLeft||o.clientLeft||0;return{top:Math.round(t.top+r-n),left:Math.round(t.left+s-a),width:e.offsetWidth,height:e.offsetHeight}}o.r(t),o.d(t,"default",(function(){return i}))},dI71:function(e,t,o){"use strict";function i(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e.__proto__=t}o.r(t),o.d(t,"default",(function(){return i}))},dLHM:function(e,t,o){"use strict";o.r(t),o.d(t,"default",(function(){return a}));o("91GP"),o("ioFf"),o("rGqo"),o("Btvt");var i=o("q1tI"),r=(o("17x9"),o("ZxpX"));function s(){return(s=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var o=arguments[t];for(var i in o)Object.prototype.hasOwnProperty.call(o,i)&&(e[i]=o[i])}return e}).apply(this,arguments)}function n(e,t){if(null==e)return{};var o,i,r=function(e,t){if(null==e)return{};var o,i,r={},s=Object.keys(e);for(i=0;i<s.length;i++)o=s[i],t.indexOf(o)>=0||(r[o]=e[o]);return r}(e,t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(i=0;i<s.length;i++)o=s[i],t.indexOf(o)>=0||Object.prototype.propertyIsEnumerable.call(e,o)&&(r[o]=e[o])}return r}class a extends i.Component{constructor(e){super(e),this.onChange=e=>{this.isControlledOutside||this.setState({value:e.target.value}),this.props.onChange&&this.props.onChange(e)},this.getRef=e=>{this.element=e},void 0!==e.value||e.isControlledOutside?this.isControlledOutside=!0:this.state={value:e.initialValue||""}}render(){var e=this.props,t=e.alignment,o=e.value,a=(e.onChange,e.initialValue,e.className),c=(e.isControlledOutside,n(e,["alignment","value","onChange","initialValue","className","isControlledOutside"])),l={"Input--left":"left"===t,"Input--center":"center"===t,"Input--right":"right"===t};return i.createElement("input",s({},c,{className:Object(r.classNames)("Input",l,a),ref:this.getRef,value:this.isControlledOutside?o:this.state.value,onChange:this.onChange}))}}a.defaultProps={type:"text",initialValue:"",alignment:"left"}},dRu9:function(e,t,o){"use strict";o.r(t),o.d(t,"UNMOUNTED",(function(){return u})),o.d(t,"EXITED",(function(){return p})),o.d(t,"ENTERING",(function(){return h})),o.d(t,"ENTERED",(function(){return _})),o.d(t,"EXITING",(function(){return m}));var i=o("zLVn"),r=o("dI71"),s=(o("17x9"),o("q1tI")),n=o.n(s),a=o("i8i4"),c=o.n(a),l=o("KkKZ"),d=o("0PSK"),u="unmounted",p="exited",h="entering",_="entered",m="exiting",v=function(e){function t(t,o){var i;i=e.call(this,t,o)||this;var r,s=o&&!o.isMounting?t.enter:t.appear;return i.appearStatus=null,t.in?s?(r=p,i.appearStatus=h):r=_:r=t.unmountOnExit||t.mountOnEnter?u:p,i.state={status:r},i.nextCallback=null,i}Object(r.default)(t,e),t.getDerivedStateFromProps=function(e,t){return e.in&&t.status===u?{status:p}:null};var o=t.prototype;return o.componentDidMount=function(){this.updateStatus(!0,this.appearStatus)},o.componentDidUpdate=function(e){var t=null;if(e!==this.props){var o=this.state.status;this.props.in?o!==h&&o!==_&&(t=h):o!==h&&o!==_||(t=m)}this.updateStatus(!1,t)},o.componentWillUnmount=function(){this.cancelNextCallback()},o.getTimeouts=function(){var e,t,o,i=this.props.timeout;return e=t=o=i,null!=i&&"number"!=typeof i&&(e=i.exit,t=i.enter,o=void 0!==i.appear?i.appear:t),{exit:e,enter:t,appear:o}},o.updateStatus=function(e,t){if(void 0===e&&(e=!1),null!==t){this.cancelNextCallback();var o=c.a.findDOMNode(this);t===h?this.performEnter(o,e):this.performExit(o)}else this.props.unmountOnExit&&this.state.status===p&&this.setState({status:u})},o.performEnter=function(e,t){var o=this,i=this.props.enter,r=this.context?this.context.isMounting:t,s=this.getTimeouts(),n=r?s.appear:s.enter;!t&&!i||l.default.disabled?this.safeSetState({status:_},(function(){o.props.onEntered(e)})):(this.props.onEnter(e,r),this.safeSetState({status:h},(function(){o.props.onEntering(e,r),o.onTransitionEnd(e,n,(function(){o.safeSetState({status:_},(function(){o.props.onEntered(e,r)}))}))})))},o.performExit=function(e){var t=this,o=this.props.exit,i=this.getTimeouts();o&&!l.default.disabled?(this.props.onExit(e),this.safeSetState({status:m},(function(){t.props.onExiting(e),t.onTransitionEnd(e,i.exit,(function(){t.safeSetState({status:p},(function(){t.props.onExited(e)}))}))}))):this.safeSetState({status:p},(function(){t.props.onExited(e)}))},o.cancelNextCallback=function(){null!==this.nextCallback&&(this.nextCallback.cancel(),this.nextCallback=null)},o.safeSetState=function(e,t){t=this.setNextCallback(t),this.setState(e,t)},o.setNextCallback=function(e){var t=this,o=!0;return this.nextCallback=function(i){o&&(o=!1,t.nextCallback=null,e(i))},this.nextCallback.cancel=function(){o=!1},this.nextCallback},o.onTransitionEnd=function(e,t,o){this.setNextCallback(o);var i=null==t&&!this.props.addEndListener;e&&!i?(this.props.addEndListener&&this.props.addEndListener(e,this.nextCallback),null!=t&&setTimeout(this.nextCallback,t)):setTimeout(this.nextCallback,0)},o.render=function(){var e=this.state.status;if(e===u)return null;var t=this.props,o=t.children,r=Object(i.default)(t,["children"]);if(delete r.in,delete r.mountOnEnter,delete r.unmountOnExit,delete r.appear,delete r.enter,delete r.exit,delete r.timeout,delete r.addEndListener,delete r.onEnter,delete r.onEntering,delete r.onEntered,delete r.onExit,delete r.onExiting,delete r.onExited,"function"==typeof o)return n.a.createElement(d.default.Provider,{value:null},o(e,r));var s=n.a.Children.only(o);return n.a.createElement(d.default.Provider,{value:null},n.a.cloneElement(s,r))},t}(n.a.Component);function f(){}v.contextType=d.default,v.propTypes={},v.defaultProps={in:!1,mountOnEnter:!1,unmountOnExit:!1,appear:!1,enter:!0,exit:!0,onEnter:f,onEntering:f,onEntered:f,onExit:f,onExiting:f,onExited:f},v.UNMOUNTED=0,v.EXITED=1,v.ENTERING=2,v.ENTERED=3,v.EXITING=4,t.default=v},dV62:function(e,t,o){"use strict";o.r(t),o.d(t,"rootId",(function(){return r})),o.d(t,"registerReactApplication",(function(){return s})),o.d(t,"showComponentInBox",(function(){return n})),o.d(t,"updateCurrentComponentInBox",(function(){return a})),o.d(t,"destroyComponentInBox",(function(){return c}));var i=o("i8i4"),r="react_root";function s(e,t){window.applicationInitFunctions[e]=t,window.reactInitQueue[e]&&window.reactInitQueue[e].length&&(window.reactInitQueue[e].forEach(t=>{window.initReactApplication(e,t)}),window.reactInitQueue[e]=[])}function n(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};t.onDestroy||(t.onDestroy=c);var o=window.showFastBox(t),r=document.querySelectorAll(".box_layout"),s=r[r.length-1];return i.render(e,s),l(),o}function a(e){var t=document.querySelectorAll(".box_layout"),o=t[t.length-1];i.render(e,o)}function c(e){var t=document.querySelectorAll(".box_layout"),o=t[t.length-1];o&&i.unmountComponentAtNode(o);var r=window.curBox();r&&r.hide(e)}function l(){var e=document.querySelectorAll(".popup_box_container"),t=e[e.length-1];boxRefreshCoords(t)}window.applicationInitFunctions||(window.applicationInitFunctions={}),window.reactInitQueue||(window.reactInitQueue={}),window.initReactApplication=(e,t)=>{window.applicationInitFunctions[e]?window.applicationInitFunctions[e](t):(window.reactInitQueue[e]||(window.reactInitQueue[e]=[]),window.reactInitQueue[e].push(t))}},gMX8:function(e,t,o){"use strict";o.r(t),o.d(t,"StoryArchiveGridContainer",(function(){return c}));var i,r=o("q1tI"),s=o.n(r),n=o("ZxpX"),a=(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])})(e,t)},function(e,t){function o(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(o.prototype=t.prototype,new o)}),c=function(e){function t(t){var o=e.call(this,t)||this;return o.scrollContainerRef=s.a.createRef(),o}return a(t,e),t.prototype.getScrollContainer=function(){return this.scrollContainerRef.current},t.prototype.render=function(){var e=this.props,t=e.appearance,o=e.className,i=e.children;return s.a.createElement("div",{className:Object(n.classNames)("StoryArchiveGridContainer","StoryArchiveGridContainer--"+t,o),ref:this.scrollContainerRef},i)},t.defaultProps={className:""},t}(s.a.Component)},lBJi:function(e,t,o){"use strict";o.r(t),o.d(t,"Emoji",(function(){return W}));o("a1Th"),o("rE2o"),o("ioFf"),o("Vd3H"),o("91GP"),o("KKXr"),o("rGqo"),o("Btvt"),o("HEwt"),o("Oyvg"),o("SRfc"),o("pIFo");var i=o("S6+Z"),r=o("TxR4"),s=o("yqpO"),n={1:["😀","😃","😄","😁","😅","😆","😂","🤣","😉","😊","☺","🙂","🙃","😇","😗","😙","😚","😘","😍","🥰","🤩","🤗","😋","😜","🤪","😛","😝","🤑","🤭","🤐","🤫","😶","🤔","🤨","🧐","😐","😑","🙄","😬","🤥","😏","😌","🤤","😴","🤓","😎","🥳","🤠","😒","😔","😪","😕","😟","🙁","☹","😮","😯","😲","😳","🥺","😦","😧","😨","😰","😥","😢","😭","😱","😖","😣","😞","😓","😩","😫","😷","🤒","🤕","🤢","🤮","🤧","🥶","🥵","🥴","😵","🤯","😤","😠","😡","🤬","😈","👿","💀","☠","💩","🤡","👹","👺","👻","👽","👾","🤖","😺","😸","😹","😻","😼","😽","🙀","😿","😾","🙈","🙉","🙊","🦠"],2:["🐵","🐒","🦍","🐶","🐕","🐩","🐺","🦊","🦝","🐱","🐈","🦁","🐯","🐅","🐆","🐴","🐎","🦄","🦓","🦌","🐮","🐂","🐃","🐄","🐷","🐽","🐖","🐗","🐏","🐑","🐐","🐪","🐫","🦙","🦒","🐘","🦏","🦛","🐭","🐁","🐀","🐹","🐰","🐇","🐿","🦔","🦇","🐻","🐨","🐼","🦘","🦡","🐾","🦃","🐔","🐓","🐣","🐤","🐥","🐦","🐧","🕊","🦅","🦆","🦢","🦉","🦚","🦜","🐸","🐊","🐢","🦎","🐍","🐲","🐉","🦕","🦖","🐳","🐋","🐬","🐟","🐠","🐡","🦈","🐙","🦀","🦞","🦐","🦑","🐚","🐌","🦋","🐛","🐜","🐝","🐞","🦗","🕷","🕸","🦂","🦟","💐","🌸","💮","🏵","🌹","🥀","🌺","🌻","🌼","🌷","🌳","🌲","🎄","🌴","🌵","🌾","🌱","🌿","☘","🍀","🍁","🍂","🍃","🌑","🌒","🌓","🌔","🌕","🌖","🌗","🌘","🌙","🌚","🌛","🌜","🌡","☀","🌝","🌞","⭐","🌟","🌠","☁","⛅","⛈","🌤","🌥","🌦","🌧","🌨","🌩","🌪","🌫","🌬","💨","🌀","🌈","🌂","☂","☔","⛱","⚡","❄","☃","⛄","☄","🔥","💦","💧","🌊"],3:["👍🏻","👎🏻","👌🏻","✌🏻","🤞🏻","🤟🏻","🤘🏻","🤙🏻","🖕🏻","✊🏻","👊🏻","🤛🏻","🤜🏻","👈🏻","👉🏻","👆🏻","👇🏻","☝🏻","👋🏻","🤚🏻","🖐🏻","✋🏻","🖖🏻","👏🏻","🙌🏻","👐🏻","🤲🏻","🤝🏻","🙏🏻","💪🏻","🦵🏻","🦶🏻","👂🏻","👃🏻","🧠","🦷","🦴","👀","👁","👅","👄","✍🏻","💅🏻","🤳","👫","👭","👬","👩‍❤️‍💋‍👨","👨‍❤️‍💋‍👨","👩‍❤️‍💋‍👩","👩‍❤️‍👨","👨‍❤️‍👨","👩‍❤️‍👩","👪","👶","🧒","👦","👧","🧑","👱","👨","🧔","👱‍♂️","👨‍🦰","👨‍🦱","👨‍🦳","👨‍🦲","👩","👱‍♀️","👩‍🦰","👩‍🦱","👩‍🦳","👩‍🦲","🧓️","👴️","👵️","🙍‍♂️️","🙍‍♀️️","🙎‍♂️","🙎‍♀️️","🙅‍♂️","🙅‍♀️","🙆‍♂️","🙆‍♀️","💁‍♂️","💁‍♀️️","🙋‍♂️","🙋‍♀️️","🙇‍♂️","🙇‍♀️️","🤦‍♂️","🤦‍♀️","🤷‍♂️","🤷‍♀️","💆‍♂️️","💆‍♀️","💇‍♂️️","💇‍♀️","🚶‍♂️️","🚶‍♀️️","🏃‍♂️️","🏃‍♀️","💃","🕺","🕴️","👯‍♂️️","👯‍♀️","🧖‍♂️","🧖‍♀️️","👼","🎅","🤶","🦸‍♂️","🦸‍♀️","🦹‍♂️","🦹‍♀️","🧙‍♂️","🧙‍♀️","🧚‍♂️","🧚‍♀️","🧛‍♂️","🧛‍♀️","🧜‍♂️","🧜‍♀️","🧝‍♂️","🧝‍♀️","🧞‍♂️","🧞‍♀️","🧟‍♂️","🧟‍♀️","👨‍⚕️","👩‍⚕️","👨‍🎓","👩‍🎓","👨‍🏫","👩‍🏫","👨‍⚖️","👩‍⚖️","👨‍🌾","👩‍🌾","👨‍🍳","👩‍🍳","👨‍🔧","👩‍🔧","👨‍🏭","👩‍🏭","👨‍💼","👩‍💼","👨‍🔬","👩‍🔬","👨‍💻","👩‍💻","👨‍🎤","👩‍🎤","👨‍🎨","👩‍🎨","👨‍✈️","👩‍✈️","👨‍🚀","👩‍🚀","👨‍🚒","👩‍🚒","👮‍♂️","👮‍♀️","🕵️‍♂️","🕵️‍♀️","💂‍♂️","💂‍♀️","👷‍♂️","👷‍♀️","🤴","👸","👳‍♂️","👳‍♀️","👲","🧕","🤵","👰","🤰","🤱","🛀","🛌"],4:["🍏","🍎","🍐","🍅","🥝","🍑","🍒","🍓","🍇","🍈","🍉","🍊","🍋","🍌","🍍","🥭","🥥","🥑","🍆","🥔","🥕","🌽","🌶","🥒","🥬","🥦","🍄","🥜","🌰","🍞","🥐","🥖","🥨","🥯","🥞","🧀","🍖","🍗","🥩","🥓","🍔","🍟","🍕","🌭","🥪","🌮","🌯","🥙","🥚","🍳","🥘","🍲","🥣","🥗","🍿","🧂","🥫","🍱","🍘","🍙","🍚","🍛","🍜","🍝","🍠","🍢","🍣","🍤","🍥","🥮","🍡","🥟","🥠","🥡","🍦","🍧","🍨","🍩","🍪","🎂","🍰","🧁","🥧","🍫","🍬","🍭","🍮","🍯","🍼","🥛","☕","🍵","🍶","🍾","🍷","🍸","🍹","🍺","🍻","🥂","🥃","🥤","🥢","🍽","🍴","🥄"],5:["⚽","⚾","🥎","🏀","🏐","🏈","🏉","🎾","🥏","🎳","🏏","🏑","🏒","🥍","🏓","🏸","🥊","🥋","🥅","⛳","⛸","🎣","🎽","🛹","🎿","🛷","🥌","🎯","🎱","🎮","🕹","🎰","🎲","🧩","♟","🧗‍♂️️","🧗‍♀️","🤺","🏇","⛷","🏂","🏌️‍♂️","🏌️‍♀️","🏄‍♂️","🏄‍♀️","🚣‍♂️","🚣‍♀️","🏊‍♂️","🏊‍♀️","⛹️‍♂️","⛹️‍♀️","🏋️‍♂️","🏋️‍♀️","🚴‍♂️","🚴‍♀️","🚵‍♂️","🚵‍♀️","🤸","🤼‍♂️","🤼‍♀️","🤽‍♂️","🤽‍♀️","🤾‍♂️","🤾‍♀️","🤹‍♂️","🤹‍♀️","🧘‍♂️","🧘‍♀️","🎖","🏆","🏅","🥇","🥈","🥉"],6:["🚂","🚃","🚄","🚅","🚆","🚇","🚈","🚉","🚊","🚝","🚞","🚋","🚌","🚍","🚎","🚐","🚑","🚒","🚓","🚔","🚕","🚖","🚗","🚘","🚙","🚚","🚛","🚜","🏎","🏍","🛵","🚲","🛴","🚏","🛣","🛤","🛢","⛽","🚨","🚥","🚦","🛑","🚧","⚓","⛵","🛶","🚤","🛳","⛴","🛥","🚢","✈","🛩","🛫","🛬","💺","🚁","🚟","🚠","🚡","🛰","🚀","🛸","🌍","🌎","🌏","🌐","🗺","🗾","🧭","🏔","⛰","🌋","🗻","🏕","🏖","🏜","🏝","🏞","🏟","🏛","🏗","🧱","🏘","🏚","🏠","🏡","🏢","🏣","🏤","🏥","🏦","🏨","🏩","🏪","🏫","🏬","🏭","🏯","🏰","💒","🗼","🗽","⛪","🕌","🕍","⛩","🕋","⛲","⛺","🌁","🌃","🏙","🌄","🌅","🌆","🌇","🌉","♨","🌌","🎠","🎡","🎢","💈","🎪"],7:["🎙","🎚","🎛","🎤","🎧","📻","🎷","🎸","🎹","🎺","🎻","🥁","📯","🎭","🖼","🎨","🧵","🧶","🔮","🧿","🧸","🃏","🀄","🎴","🎃","🎆","🎇","🧨","✨","🎈","🎉","🎊","🎋","🎍","🎎","🎏","🎐","🎑","🧧","🎀","🎁","🎗","🎟","🎫","🛎","🧳","⌛","⏳","⌚","⏰","⏱","⏲","🕰","👓","🕶","🥽","🥼","👔","👕","👖","🧣","🧤","🧥","🧦","👗","👘","👙","👚","👛","👜","👝","🛍","🎒","👞","👟","🥾","🥿","👠","👡","👢","👑","👒","🎩","🎓","🧢","⛑","📿","💄","💍","💎","📱","📲","☎","📞","📟","📠","🔋","🔌","💻","🖥","🖨","⌨","🖱","🖲","💽","💾","💿","📀","🧮","🎥","🎞","📽","🎬","📺","📷","📸","📹","📼","🔍","🔎","🕯","💡","🔦","🏮","📔","📕","📖","📗","📘","📙","📚","📓","📒","📃","📜","📄","📰","🗞","📑","🔖","🏷","💰","💴","💵","💶","💷","💸","💳","🧾","💹","💱","💲","✉","💌","📧","📨","📩","📤","📥","📦","📫","📪","📬","📭","📮","🗳","✏","✒","🖋","🖊","🖌","🖍","📝","💼","📁","📂","🗂","📅","📆","🗒","🗓","📇","📈","📉","📊","📋","📌","📍","📎","🖇","📏","📐","✂","🗃","🗄","🗑","🔒","🔓","🔏","🔐","🔑","🗝","🔨","⛏","⚒","🛠","🗡","⚔","🔪","🔫","🏹","🛡","🔧","🔩","⚙","🗜","⚖","🔗","⛓","🧰","🧲","⚗","🧪","🧫","🧬","🔬","🔭","📡","💉","💊","🚪","🛏","🛋","🚽","🚿","🛁","🧴","🧷","🧹","🧺","🧻","🧼","🧽","🧯","🛒","🚬","⚰","⚱","🏺","🗿"],8:["💋","❤","💔","❣","💘","💝","💖","💗","💓","💞","💕","💟","💜","🧡","💛","💚","💙","🖤","💯","💢","💥","💫","🕳","💣","💬","👁️‍🗨️","🗨","🗯","💭","💤","🗣","👤","👥","👣","🔇","🔊","📢","📣","🔔","🔕","🎼","🎵","🎶","⚠","🚸","☢","☣","🆚","🆓","🆕","🚮","🚾","🚭","✅","♻","⚕","🔱","‼","⁉","❓","❗","🆘","⛔","🚫","🚳","🚯","🚱","🚷","📵","🔞"],9:["🇷🇺","🇰🇿","🇧🇾","🇺🇦","🇲🇳","🇬🇪","🇦🇿","🇹🇯","🇧🇷","🇱🇹","🇱🇻","🇪🇪","🇦🇲","🏁","🚩","🎌","🏴","🏳","🏳️‍🌈","🏴‍☠️","🇦🇨","🇦🇩","🇦🇪","🇦🇫","🇦🇬","🇦🇮","🇦🇱","🇦🇴","🇦🇶","🇦🇷","🇦🇸","🇦🇹","🇦🇺","🇦🇼","🇦🇽","🇧🇦","🇧🇧","🇧🇩","🇧🇪","🇧🇫","🇧🇬","🇧🇭","🇧🇮","🇧🇯","🇧🇱","🇧🇲","🇧🇳","🇧🇴","🇧🇶","🇧🇸","🇧🇹","🇧🇻","🇧🇼","🇧🇿","🇨🇦","🇨🇨","🇨🇩","🇨🇫","🇨🇬","🇨🇭","🇨🇮","🇨🇰","🇨🇱","🇨🇲","🇨🇳","🇨🇴","🇨🇵","🇨🇷","🇨🇺","🇨🇻","🇨🇼","🇨🇽","🇨🇾","🇨🇿","🇩🇪","🇩🇬","🇩🇯","🇩🇰","🇩🇲","🇩🇴","🇩🇿","🇪🇨","🇪🇬","🇪🇭","🇪🇷","🇪🇸","🇪🇹","🇪🇺","🇫🇮","🇫🇯","🇫🇰","🇫🇲","🇫🇴","🇫🇷","🇬🇦","🇬🇧","🇬🇩","🇬🇫","🇬🇬","🇬🇭","🇬🇮","🇬🇱","🇬🇲","🇬🇳","🇬🇵","🇬🇶","🇬🇷","🇬🇸","🇬🇹","🇬🇺","🇬🇼","🇬🇾","🇭🇰","🇭🇲","🇭🇳","🇭🇷","🇭🇹","🇭🇺","🇮🇨","🇮🇩","🇮🇪","🇮🇱","🇮🇲","🇮🇳","🇮🇴","🇮🇶","🇮🇷","🇮🇸","🇮🇹","🇯🇪","🇯🇲","🇯🇴","🇯🇵","🇰🇪","🇰🇬","🇰🇭","🇰🇮","🇰🇲","🇰🇳","🇰🇵","🇰🇷","🇰🇼","🇰🇾","🇱🇦","🇱🇧","🇱🇨","🇱🇮","🇱🇰","🇱🇷","🇱🇸","🇱🇺","🇱🇾","🇲🇦","🇲🇨","🇲🇩","🇲🇪","🇲🇫","🇲🇬","🇲🇭","🇲🇰","🇲🇱","🇲🇲","🇲🇴","🇲🇵","🇲🇶","🇲🇷","🇲🇸","🇲🇹","🇲🇺","🇲🇻","🇲🇼","🇲🇽","🇲🇾","🇲🇿","🇳🇦","🇳🇨","🇳🇪","🇳🇫","🇳🇬","🇳🇮","🇳🇱","🇳🇴","🇳🇵","🇳🇷","🇳🇺","🇳🇿","🇴🇲","🇵🇦","🇵🇪","🇵🇫","🇵🇬","🇵🇭","🇵🇰","🇵🇱","🇵🇲","🇵🇳","🇵🇷","🇵🇸","🇵🇹","🇵🇼","🇵🇾","🇶🇦","🇷🇪","🇷🇴","🇷🇸","🇷🇼","🇸🇦","🇸🇧","🇸🇨","🇸🇩","🇸🇪","🇸🇬","🇸🇭","🇸🇮","🇸🇯","🇸🇰","🇸🇱","🇸🇲","🇸🇳","🇸🇴","🇸🇷","🇸🇸","🇸🇹","🇸🇻","🇸🇽","🇸🇾","🇸🇿","🇹🇦","🇹🇨","🇹🇩","🇹🇫","🇹🇬","🇹🇭","🇹🇰","🇹🇱","🇹🇲","🇹🇳","🇹🇴","🇹🇷","🇹🇹","🇹🇻","🇹🇼","🇹🇿","🇺🇬","🇺🇲","🇺🇳","🇺🇸","🇺🇾","🇺🇿","🇻🇦","🇻🇨","🇻🇪","🇻🇬","🇻🇮","🇻🇳","🇻🇺","🇼🇫","🇼🇸","🇽🇰","🇾🇪","🇾🇹","🇿🇦","🇿🇲","🇿🇼"]},a=Object.keys(n).reduce((e,t)=>(e[t]=n[t].map(e=>Object(r.emojiSymbolToByteHex)(e)),e),{});o("hhXQ");function c(e,t){var o=e;return e>68&&(o=68),t>68&&(o=68*e/t),[o,o*(t/e)]}var l=o("W9Tc"),d=o("t7n3"),u=o("zxIV");o("/8Fb");function p(){return(p=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var o=arguments[t];for(var i in o)Object.prototype.hasOwnProperty.call(o,i)&&(e[i]=o[i])}return e}).apply(this,arguments)}function h(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var o=[],i=!0,r=!1,s=void 0;try{for(var n,a=e[Symbol.iterator]();!(i=(n=a.next()).done)&&(o.push(n.value),!t||o.length!==t);i=!0);}catch(e){r=!0,s=e}finally{try{i||null==a.return||a.return()}finally{if(r)throw s}}return o}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return _(e,t);var o=Object.prototype.toString.call(e).slice(8,-1);"Object"===o&&e.constructor&&(o=e.constructor.name);if("Map"===o||"Set"===o)return Array.from(o);if("Arguments"===o||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o))return _(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function _(e,t){(null==t||t>e.length)&&(t=e.length);for(var o=0,i=new Array(t);o<t;o++)i[o]=e[o];return i}var m=["мне","тебе","ему","ей","маме","папе","сестре","брату","родителям"],v=["ден(?:ьги|ежки|ьгу|ежку|ег|ежек|як)","дол(?:г|жок)","(?:(?:в|на)\\s)подар(?:ок|ки)"],f=["переводом","(?:(?:по|на)\\s)(?:номеру?\\s)?(?:карт(?:у|очку|ы|очки)|тел(?:ефона)?)","(?:по\\s)?безнал(?:у|ичке|ом|ичкой)","на\\sсбер(?:банк)?"],g=["сот(?:оч)ку","\\d+(?:\\s*р(?:[.,\\s]|уб(?:лей)?|$))?"],y=new RegExp(`(${g.join(")|(")})`);function b(e,t){return"amount"===e?function(e){var t=e.match(y);if(t){if(t[1])return 100;if(t[2])return parseInt(t[2])}return 0}(t):t}var w=new RegExp(`^(?:(${["(?:за|с|пере)?кин(?:ь(?:ся)?|ьте(?:сь)?|ешь(?:ся)?|ете(?:сь)?)","переве(?:ди|дите|дешь|дете)","отправ(?:ь|ьте|ишь|ите)","соб(?:ери|ерите|ерешь|ерете)","(?:от)?да(?:й|йте|шь|дите)","верн(?:и|ите|ешь|ете)","возвра(?:ти|тите|тишь|щай|щайте)","займ(?:и|ите|ешь)"].join("|")})|(${["перевод","(?:за|с|пере)?кин(?:уть(?:ся)?|у(?:сь)?|ем(?:ся)?)","переве(?:сти|вожу|дим|ду|ем)","отправ(?:ить|ляю|ляем|лю|им)","(?:со)?б(?:рать|ираю|ираем|еру|ерем)","(?:от)?да(?:ть|ю|ем|м|дим)","верн(?:уть|у|ем)","возвра(?:тить|щу|тим|щаю|щаем)"].join("|")}))((?:\\s+(?:${[...m,...v,...f,...g].join("|")}))+)\\s*$`),k=new RegExp(`(${m.join("|")})|(${v.join("|")})|(${f.join("|")})|(${g.join("|")})`,"gi"),S={DEFAULT_QUERY:"деньги",introViewed:!1,match:function(e){arguments.length>1&&void 0!==arguments[1]&&arguments[1];var t=e.toLowerCase().replace(/ё/g,"е").match(w);if(t){for(var o={input:e,request:t[1],send:t[2],context:t[3]};t=k.exec(o.context),t;)for(var i={receiver:t[1],subject:t[2],method:t[3],amount:t[4]},r=0,s=Object.entries(i);r<s.length;r++){var n=h(s[r],2),a=n[0],c=n[1];c&&(o[a]=b(a,c))}if(o.subject||o.method||o.amount)return o}return null},setIntroViewed:function(e){this.introViewed=e},onClick:function(e,t,o){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};if(this.introViewed){var s=[e,t,o,i].join("_");showBox("al_payments.php",{act:"money_transfer_box",tab:o,amount:i,owner_id:e,to_id:t,from:"sticker_link"},{cache:this.lastBoxId===s,onDone:()=>{cur.paymentsOptions&&(cur.paymentsOptions.onSendStart=r.onSendStart)}}),this.lastBoxId=s}else showWiki(p({w:"moneysend_promo",fromId:e,toId:t,action:o},i?{amount:i}:{})),this.introViewed=!0}},j=o("jE6c");function E(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var o=[],i=!0,r=!1,s=void 0;try{for(var n,a=e[Symbol.iterator]();!(i=(n=a.next()).done)&&(o.push(n.value),!t||o.length!==t);i=!0);}catch(e){r=!0,s=e}finally{try{i||null==a.return||a.return()}finally{if(r)throw s}}return o}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return O(e,t);var o=Object.prototype.toString.call(e).slice(8,-1);"Object"===o&&e.constructor&&(o=e.constructor.name);if("Map"===o||"Set"===o)return Array.from(o);if("Arguments"===o||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o))return O(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function O(e,t){(null==t||t>e.length)&&(t=e.length);for(var o=0,i=new Array(t);o<t;o++)i[o]=e[o];return i}var C=Object.entries(i.EMOJI_HINTS).map(e=>{var t=E(e,2),o=t[0],i=E(t[1],2),r=(i[0],i[1]);return[new RegExp(`(\\s|^)(${Object(j.escapeRE)(r)}${r.endsWith(")")||r.endsWith("(")?"+":""})([\\s\\.,]|$)`,"gi"),o]}),T={q:"й",w:"ц",e:"у",r:"к",t:"е",y:"н",u:"г",i:"ш",o:"щ",p:"з","[":"х","]":"ъ",a:"ф",s:"ы",d:"в",f:"а",g:"п",h:"р",j:"о",k:"л",l:"д",";":"ж","'":"э",z:"я",x:"ч",c:"с",v:"м",b:"и",n:"т",m:"ь",",":"б",".":"ю","/":"."};browser.mac?T["\\"]="ё":T["`"]="ё";var L=new RegExp(`[${Object(j.escapeRE)(Object.keys(T).join(""))}]`,"gi"),B=e=>e.replace(L,e=>T[e]),x=Object.entries(T).reduce((e,t)=>{var o=E(t,2),i=o[0];return e[o[1]]=i,e}),N=new RegExp(`[${Object(j.escapeRE)(Object.keys(x).join(""))}]`,"gi"),I=e=>e.replace(N,e=>x[e]);var M=class{constructor(e){this.config={mvk:!1,peerId:null,maxInputLength:256},this.setConfig(e)}setConfig(e){Object.assign(this.config,e)}getQueries(e){if(!e||e.length>this.config.maxInputLength)return[""];var t=window.Wall&&window.Wall.replyNamesRE||window.post&&window.post.replyNamesRE;if(t){var o=t();o&&(e=e.replace(o,""))}e=e.toLowerCase(),e=(e=C.reduce((e,t)=>{var o=E(t,2),i=o[0],s=o[1];return e.replace(i,(e,t,o,i)=>(t||"")+Object(r.emojiByteHexToSymbol)(s)+(i||""))},e)).replace(/^[\s\uFEFF\xA0]+|\n+$/g,"");for(var i=[e=Object(r.emojiRemoveSkinToneModifiers)(e)],s=0,n=[...i];s<n.length;s++){var a=n[s];i.push(B(a)),i.push(I(a))}for(var c=0,l=[...i];c<l.length;c++){var d=l[c];i.push(d.replace(/ё/g,"е")),i.push(d.replace(/е/g,"ё"))}for(var u=0,p=[...i];u<p.length;u++){var h=p[u];i.push(h.replace(/[.!?]+$/,""))}return Object.keys(i.reduce((e,t)=>(e[t]=1,e),{}))}isBotLinkEnabled(){return Object(l.partConfigEnabled)("stickers_bot_link")&&-184940019!==this.config.peerId}getBotLinkUrl(){return this.config.mvk?"/mail?act=show&peer=-184940019":"/im?sel=-184940019"}getBotLinkImageUrl(e){return`/images/stickers_suggestions_bot_${arguments.length>1&&void 0!==arguments[1]?arguments[1]:"light"}_${e}.png`}getBotLinkClickStatName(){return"stickers_suggestions_bot_link"}getBotLinkClickStatKeys(){return[]}isMoneyTransferEnabled(){return Object(l.partConfigEnabled)("stickers_money_transfer_suggestions")&&(this.isMoneySendEnabled()||this.isMoneyRequestEnabled())}isMoneySendEnabled(){return Boolean(this.config.moneyTransfer&&this.config.moneyTransfer.send)}isMoneyRequestEnabled(){return Boolean(this.config.moneyTransfer&&this.config.moneyTransfer.request)}},R=o("QGEU"),A=o("v+DW"),P=o("EasH"),D=o("FWc3"),H=o("4+be");function F(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var o=[],i=!0,r=!1,s=void 0;try{for(var n,a=e[Symbol.iterator]();!(i=(n=a.next()).done)&&(o.push(n.value),!t||o.length!==t);i=!0);}catch(e){r=!0,s=e}finally{try{i||null==a.return||a.return()}finally{if(r)throw s}}return o}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return V(e,t);var o=Object.prototype.toString.call(e).slice(8,-1);"Object"===o&&e.constructor&&(o=e.constructor.name);if("Map"===o||"Set"===o)return Array.from(o);if("Arguments"===o||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o))return V(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function V(e,t){(null==t||t>e.length)&&(t=e.length);for(var o=0,i=new Array(t);o<t;o++)i[o]=e[o];return i}var W={opts:{},raw:{},last:0,shownId:!1,hasNewStickers:!1,preventMouseOver:!1,stickerPacksToLoad:[],ttShift:45,favoriteAvailable:!1,favoriteRemindOn:!1,favoriteRemindOff:!1,favoriteLimit:20,favoriteLimitNoticed:!1,stickerSizes:{},stickers:{},TAB_EMOJI:0,TAB_RECENT_STICKERS:-1,TAB_FAVORITE_STICKERS:-2,CLICK_DELAY:500,SORTED_EMOJI_SECTIONS_CODES:[-1,1,3,8,2,4,5,6,7,9],CACHED_HEIGHT_PROP:"_emojiHeight",CACHED_WIDTH_PROP:"_emojiWidth",BOTTOM_REST_FOR_ADD_EMOJI_CATEGORY:150,SHOW_TT_TIMEOUT:100,HIDE_TT_TIMEOUT:300,SHOWN_TT_CLS:"emoji_tt_shown",STICKER_REFERRERS:{RECENT:"recent",FAVORITE:"favourite",KEYBOARD:"keyboard",STORY_KEYBOARD:"story_keyboard"},DELETE_FAV_STICKER_ELEMENTS_DELAY:500,FAV_ICON_TT_MIN_HEIGHT:35,SUGGESTION_WORD_MAX_LENGTH:256,logHintsDelay:0,tabDefaultId:0,stickersKeywordsExpire:36e5*(6+2*Math.random()),init:function(e,t){var o=W.last;W.tabDefaultId=W.TAB_RECENT_STICKERS,t.txt=e,t.id=o,t.fieldWrap=gpeByClass("_emoji_field_wrap",e),t.emojiWrap=domByClass(t.fieldWrap,"_emoji_wrap"),t.emojiBtn=domByClass(t.emojiWrap,"_emoji_btn"),t.emojiWrap&&Object(u.data)(t.emojiWrap,"optId",o),e.emojiId=o,t.lastLoadedEmojiCategoriesIdxes={},t.preventDoubleClick=vkNow(),t.deletedFavoriteStickers=[],t.deleteFavoriteStickersTimeout=null,t.suggestions=new M(t.suggestionsConfig);var i=Object(d.isRetina)()?128:64;if(W.stickerSizes[i]=!0,t.forceTxt)t.editable=0,placeholderInit(e);else{if(t.editable=1,setTimeout((function(){placeholderInit(e,{editable:1,editableFocus:W.editableFocus,global:t.global}),t.shouldFocus&&W.editableFocus(e,!1,!0)}),0),browser.mozilla)try{document.execCommand("enableObjectResizing",!1,!1),cur.destroy.push((function(){document.execCommand("enableObjectResizing",!1,!0)}))}catch(e){}addEvent(window,"mousemove",W.preventMouseOverHandle),addEvent(e,browser.opera&&!browser.chrome?"click":"mousedown",(function(i){if(i.target&&"IMG"==i.target.tagName&&W.getCode(i.target))return W.editableFocus(e,i.target,i.offsetX>8),cancelEvent(i);W.shown&&W.ttClick(o,geByClass1("emoji_smile",t.controlsCont),!0)})),t.noLineBreaks&&addEvent(e,"blur",(function(t){e.textContent||e.innerText||each(geByTag("br",e),(function(e,t){re(t)}))})),addEvent(e,"keypress keydown keyup input paste",(function(i){if(i.canceled)return!1;if("keydown"===i.type){t.onChange&&(W.raw[o]=e.innerHTML);var r=t.ctrlSend?t.ctrlSend():t.noEnterSend;if(i.keyCode==KEY.RETURN||10==i.keyCode){if(t.forceEnterSend&&t.onSend)return t.onSend(),cancelEvent(i);var s=cur.ctrl_submit&&!t.noCtrlSend;if((s||r)&&(i.ctrlKey||browser.mac&&i.metaKey)||!s&&!i.shiftKey&&!(i.ctrlKey||browser.mac&&i.metaKey)){var n=Object(u.data)(e,"composer");if(!W.emojiEnter(o,i)||!W.stickerHintMove(i)||n&&n.wdd&&isVisible(n.wdd.listWrap))return!1;if(!r||i.ctrlKey||browser.mac&&i.metaKey)return W.ttClick(o,geByClass1("emoji_smile",t.controlsCont),!0),t.onSend&&t.onSend(),cancelEvent(i)}if(t.noLineBreaks)return cancelEvent(i)}if(i.ctrlKey&&i.keyCode==KEY.RETURN){var a=this.value;if(t.editable)W.insertHTML("<div><br/></div>");else{if("number"==typeof this.selectionStart&&"number"==typeof this.selectionEnd){var c=this.selectionStart;this.value=a.slice(0,c)+"\n"+a.slice(this.selectionEnd),this.selectionStart=this.selectionEnd=c+1}else if(document.selection&&document.selection.createRange){this.focus();var d=document.selection.createRange();d.text="\r\n",d.collapse(!1),browser.opera&&!browser.chrome&&(d.moveEnd("character",0),d.moveStart("character",0)),d.select()}e.autosize.update(),setTimeout((function(){e.autosize.update()}),0)}return!1}var p=Object(R.hasAccessibilityMode)()&&Object(l.partConfigEnabled)("emoji_tooltip_a11y_mode");if(i.keyCode===KEY.TAB&&!(i.ctrlKey||browser.mac&&i.metaKey)&&!p){var h=geByClass1("_sticker_hints",domPN(t.txt));if(h&&isVisible(h)){var _=geByClass1("over",h);if(_?W.stickerHintKeyOut(o,_):W.stickerHintKeyOver(o,geByClass1("emoji_sticker_item",h)),!W.shown)return cancelEvent(i)}return W.shown?(W.editableFocus(e,!1,!0,void 0,!0),W.ttClick(o,geByClass1("emoji_smile",t.controlsCont),!0)):W.ttClick(o,geByClass1("emoji_smile",t.controlsCont),!1,!0,void 0,!0),cancelEvent(i)}if(i.keyCode==KEY.ESC){var m=geByClass1("_sticker_hints",domPN(t.txt)),v=!1;if(m&&isVisible(m)&&(W.stickerHintKeyOut(o,geByClass1("emoji_sticker_item",m)),W.stickersHintsHide(m,t,100),v=!0),W.shown&&(W.editableFocus(e,!1,!0,void 0,!0),W.ttClick(o,geByClass1("emoji_smile",t.controlsCont),!0),v=!0),v)return cancelEvent(i);if(t.onEsc)return t.onEsc(i)}}return"paste"===i.type?(W.onEditablePaste(e,t,o,i),t.checkEditable&&setTimeout(t.checkEditable.pbind(o,e),0),W.checkStickersKeywords(o,t)):"keyup"===i.type?(!t.noLineBreaks||e.textContent||e.innerText||each(geByTag("br",e),(function(e,t){re(t)})),t.checkEditable&&t.checkEditable(o,e),W.checkStickersKeywords(o,t),t.onChange&&(W.raw[o]!=e.innerHTML&&W.onChange(t),delete W.raw[o])):"keydown"!==i.type&&"input"!==i.type||(t.checkEditable&&setTimeout(t.checkEditable.pbind(o,e),0),W.checkStickersKeywords(o,t)),t.onKeyAction&&t.onKeyAction(i),cur.onReplyFormSizeUpdate&&cur.onReplyFormSizeUpdate(i),!0}))}return window.Notifier&&Notifier.addRecvClbk("emoji",0,W.lcRecv,!0),W.initStickersKeywords(),W.initPromotedStickerUrls(),W.checkNewStickers(t),W.opts[W.last]=t,W.last++},setSuggestionsConfig:function(e,t){W.opts[e].suggestions.setConfig(t)},onChange:function(e){Object(j.isFunction)(e.onChange)&&setTimeout(e.onChange,0)},preventMouseOverHandle:function(){W.preventMouseOver=!1},lcRecv:function(e){switch(e.act){case"updateTabs":W.updateTabs(e.newStickers,e.keywords)}},correctCaret:function(e){var t=e?function(e){var t=e.getBoundingClientRect(),o=null,i=null;if(t.top===t.bottom)return{left:0,top:0,bottom:0};if(document.selection)(o=(i=document.selection.createRange()).getClientRects()||[]).length||(i.text="_",i.moveStart("character",-1),o=i.getClientRects(),i.text=""),o=o[o.length-1];else if(window.getSelection){var r=getSelection();if(r.anchorNode){if((i=r.getRangeAt(0)).collapsed){var s=i.startOffset;i.setStart(i.startContainer,0),o=i.getClientRects(),i.setStart(i.startContainer,s)}o=o&&o.length?o[o.length-1]:{right:t.left,top:t.top,bottom:t.top}}else o={right:0,top:0,bottom:0}}return{left:o.right-t.left,top:o.top-t.top,bottom:o.bottom-t.top}}(e).bottom:0;(t<0||t>e.offsetHeight)&&(e.scrollTop+=t-e.offsetHeight)},insertWithBr:function(e,t){if(t){var o=t.replace(/\n/g,"<br/>"),i=ce("div",{innerHTML:o});W.cleanCont(i),W.insertHTML(i.innerHTML)}},insertWithoutNL:function(e,t){if(t){var o=t.replace(/\n/g,""),i=ce("div",{innerHTML:o});W.cleanCont(i),W.insertHTML(i.innerHTML)}},focusTrick:function(e,t,o,i,r){r||(r=e);var s=ce("TEXTAREA",{className:"emoji_tmp_textarea"});e.parentNode.appendChild(s),s.focus(),setTimeout((function(){var n=r.scrollTop;re(s),e.focus(),r.scrollTop=n,W.setRange(i),t(clean(val(s))),o(e)}),0)},finalizeInsert:function(e){W.cleanCont(e),setTimeout(W.correctCaret.pbind(e),10)},getClipboard:function(e){return e.clipboardData?clean(e.clipboardData.getData("text")):!!window.clipboardData&&clean(window.clipboardData.getData("Text"))},processImagePaste:function(e,t,o,i){if(null!=e.clipboardData){var r=function(){var r=e.clipboardData;function s(e){if(!e.match(/^webkit\-fake\-url\:\/\//)){var r=new Image;return r.crossOrigin="anonymous",r.onload=function(){var e=document.createElement("canvas");e.width=r.width,e.height=r.height,e.getContext("2d").drawImage(r,0,0,e.width,e.height),e.toBlob((function(e){!function(e){var i,r;if(e.name=e.filename="upload_"+(new Date).toISOString()+"_"+irand(0,100)+".png",hasClass(t,"_im_text")){if(o.uploadActions)return void o.uploadActions.paste([e])}else i="post_field"==t.id?cur.wallAddMedia:(r=Object(u.data)(t,"composer"))&&r.addMedia;i&&Object(j.isFunction)(o.initUploadForImagePasteCallback)&&o.initUploadForImagePasteCallback(t,i,e)}(e)}),"image/png"),i(!0)},r.src=e}}if(r.items){for(var n=!1,a=0,c=r.items.length;a<c;a++){var l=r.items[a];if(l.type.match(/^image\//)){var d=new FileReader;d.onload=function(e){return s(e.target.result)},d.readAsDataURL(l.getAsFile()),n=!0}else if("text/plain"===l.type)return{v:i()}}return{v:n}}if(-1!==Array.prototype.indexOf.call(r.types,"text/plain"))return{v:i()};!function(e){for(var o=Math.floor(1e3*Math.random()),r=geByTag("img",t),s=0,n=r.length;s<n;s++){r[s]["_before_paste_"+o]=!0}setTimeout((function(){for(var r=geByTag("img",t),s=!1,n=0,a=r.length;n<a;n++){var c=r[n];c["_before_paste_"+o]||(e(c.src),re(c),s=!0)}s||i()}),1)}((function(e){return s(e)}))}();if("object"==typeof r)return r.v}else i()},detectInvalidClipboardData(e){if(!e.clipboardData)return!1;var t=e.clipboardData.types;if(t.includes("text/html")){if(t.includes("Files"))return!0;var o=e.clipboardData.getData("text/html");return o&&o.match(/<iframe/i)}return!1},onEditablePaste:function(e,t,o,i,r){var s=!1;"true"===e.getAttribute("contenteditable")&&(s=W.getRange());var n=this.getClipboard(i),a=n&&s&&!r;this.detectInvalidClipboardData(i)&&cancelEvent(i),(this.processImagePaste(i,e,t,function(o){o||(a?(t.noLineBreaks?this.insertWithoutNL(s,n):this.insertWithBr(s,n),setTimeout(this.finalizeInsert.bind(this,e),0)):s&&this.focusTrick(e,t.noLineBreaks?this.insertWithoutNL.pbind(s):this.insertWithBr.pbind(s),this.finalizeInsert.bind(this,e),s))}.bind(this))||a)&&cancelEvent(i),W.onChange(t)},cleanCont:function(e){for(var t=e.firstChild;t;){var o=t.nextSibling;switch(t.nodeType){case 1:if("tmp_paste_cont"==t.id)break;if("DIV"==t.tagName||"P"==t.tagName||"SPAN"==t.tagName)t.setAttribute("style",""),t.className="",t.id="",W.cleanCont(t);else if("IMG"==t.tagName)W.getCode(t)||re(t);else if("BR"!=t.tagName){var r=W.editableVal(t,{saveEmoji:!0}),n=cf(clean(r).replace(/\n/g,"<br/>"));t.parentNode.replaceChild(n,t)}break;case 3:var a=clean(t.textContent||t.innerText),c=Object(i.emojiRegex)();a&&a.match(c)&&(a=a.replace(c,s.emojiReplace),t.parentNode.replaceChild(cf(a),t))}t=o}},focus:function(e,t){var o=arguments.length>2&&void 0!==arguments[2]&&arguments[2];W.editableFocus(e,!1,!0);var i=o||e.parentNode;if(t){var r=getXY(i)[1],s=scrollGetY(),n=window.innerHeight?window.innerHeight:document.documentElement.clientHeight?document.documentElement.clientHeight:boxLayerBG.offsetHeight,a=getSize(i)[1];s+n<r+a?scrollToY(r-n+a+60,100):s>r&&scrollToY(r-60,100)}},destroy:function(e){if(W.opts.hasOwnProperty(e)){var t=W.opts[e];t.txt&&t.txt.blur(),t.imagesLoader&&t.imagesLoader.destroy(),e===W.shownId&&(W.shownId=!1,W.shown=!1),delete W.opts[e]}},editableFocus:function(e,t,o,i,r){if(!e||r&&document.activeElement===e)return!1;if((e=ge(e)).focus(),e.phonfocus&&e.phonfocus(),void 0!==window.getSelection&&void 0!==document.createRange){var s=window.getSelection();if(!browser.opera||browser.chrome||o){var n=document.createRange();t?n.selectNode(t):n.selectNodeContents(e),browser.mozilla&&e.innerHTML.endsWith("<br>")&&e.removeChild(e.lastChild),i||n.collapse(!o),(s=window.getSelection()).removeAllRanges(),s.addRange(n)}else s.collapse(t||e,0)}else if(void 0!==document.body.createTextRange){var a=document.body.createTextRange();a.moveToElementText(t||e),a.collapse(!o),a.select()}},getRange:function(){if(window.getSelection){var e=window.getSelection();if(e.getRangeAt&&e.rangeCount)return e.getRangeAt(0)}else if(document.selection&&document.selection.createRange)return document.selection.createRange();return null},setRange:function(e){if(window.getSelection){var t=window.getSelection();t.removeAllRanges(),t.addRange(e)}else document.selection&&e.select&&e.select()},val:function(e,t){if(void 0===t)return W.editableVal(e);t=(t=Object(s.emojiToHTML)(t,!0)).replace(/ $/,"&nbsp;"),e.setValue?(e.setValue(t),e.phonblur&&e.phonblur()):e.innerHTML=t,W.updateStickersHints();var o=Object(u.data)(e,"composer");return o&&window.Composer&&setTimeout(Composer.updateAutoComplete.pbind(o)),!0},editableVal:function(e,t){if(!e)return"";if("TEXTAREA"==e.tagName)return val(e);for(var o,i=e.firstChild,r="",s=new RegExp("^(DIV|P|LI|OL|TR|TD|BLOCKQUOTE)$");i;){switch(i.nodeType){case 3:r+=o=i.data.replace(/^\n|\n$/g," ").replace(/[\n\xa0]/g," ").replace(/[ ]+/g," ");break;case 1:if(o=W.editableVal(i),i.tagName&&i.tagName.match(s)&&o){"\n"!=o.substr(-1)&&(o+="\n");for(var n=i.previousSibling;n&&3==n.nodeType&&""==trim(n.nodeValue);)n=n.previousSibling;!n||n.tagName&&(n.tagName.match(s)||"BR"==n.tagName)||(o="\n"+o)}else if("IMG"==i.tagName){var a=W.getCode(i);a&&(t&&t.saveEmoji?o+=W.getEmojiHTML(a):o+=W.codeToChr(a))}else"BR"==i.tagName&&(o+="\n");r+=o}i=i.nextSibling}return r},cssEmoji:i.EMOJI_HINTS,getEmojiHTML:s.getEmojiHTML,codeToChr:r.emojiByteHexToSymbol,checkEditable:function(e,t,o){var i=t.scrollHeight,r=W.opts[e];if(!r)return!1;r.scPaddings||(r.scPaddings=intval(getStyle(t,"paddingTop"))+intval(getStyle(t,"paddingBottom"))),i-=r.scPaddings;var s=r.tt;if(i>o.height+(browser.mozilla&&r.isChat?0:5)){if(!r.isSized){setStyle(t,{height:o.height+"px",overflowY:"auto"});var n=geByClass1("emoji_smile",r.controlsCont),a=geByClass1("emoji_smile_icon_promo",r.controlsCont),c=ge("im_upload"),l=Object(A.sbWidth)();r.ttWrap&&(l+=getSize(r.ttWrap)[0]-(getXY(r.emojiBtn)[0]-getXY(r.ttWrap)[0])),setStyle(n,vk.rtl?{left:1+l}:{right:1+l}),a&&setStyle(a,vk.rtl?{left:2+l}:{right:2+l}),c&&setStyle(c.parentNode,vk.rtl?{left:1+l}:{right:1+l}),s&&setStyle(s,vk.rtl?{left:(r.ttDiff||31)+l}:{right:(r.ttDiff||31)+l}),r.isSized=!0}}else if(r.isSized){setStyle(t,{height:"auto",overflowY:"hidden"});var d=geByClass1("emoji_smile",r.controlsCont),u=geByClass1("emoji_smile_icon_promo",r.controlsCont),p=ge("im_upload");setStyle(d,vk.rtl?{left:1}:{right:1}),u&&setStyle(u,vk.rtl?{left:2}:{right:2}),p&&setStyle(p.parentNode,vk.rtl?{left:1}:{right:1}),s&&setStyle(s,vk.rtl?{left:r.ttDiff||31}:{right:r.ttDiff||31}),r.isSized=!1}r.onResize&&r.onResize()},stickersHintsShow:function(e,t,o){(isVisible(e)||fadeIn(e,o),t.stickerEventsInited)||((e&&geByClass1("_sticker_hints_inner",e)).addEventListener("wheel",W.onWheelStickersHints),addEvent(document,"keydown",W.stickerHintMove),t.onHintsMouseDown=function(){t.hintsClicked=!0,setTimeout((function(){delete t.hintsClicked}),0)},addEvent(e,"mousedown",t.onHintsMouseDown),t.txt&&(t.onTxtFocus&&(removeEvent(t.txt,"focus",t.onTxtFocus),delete t.onTxtFocus),t.onTxtBlur=function(i){if(t.hintsClicked)return cancelEvent(i),!0;W.stickersHintsHide(e,t,o)},addEvent(t.txt,"blur",t.onTxtBlur)),t.stickerEventsInited=!0);W.checkStickersHintsSize(e,t)},stickersHintsHide:function(e,t,o){(fadeOut(e,o),removeEvent(document,"keydown",W.stickerHintMove),t.onHintsMouseDown&&removeEvent(e,"mousedown",W.onHintsMouseDown),t.onHintsWheel)&&(e&&geByClass1("_sticker_hints_inner",e)).removeEventListener("wheel",W.onWheelStickersHints);t.txt&&(t.onTxtBlur&&(removeEvent(t.txt,"blur",t.onTxtBlur),delete t.onTxtBlur),t.onTxtFocus&&removeEvent(t.txt,"focus",t.onTxtFocus),t.onTxtFocus=function(){var e=t.txt&&geByClass1("_sticker_hints",domPN(t.txt));e&&!isVisible(e)&&(delete t.stickerHintsString,W.checkStickersKeywords(t.id,t,!1))},addEvent(t.txt,"focus",t.onTxtFocus)),delete t.stickerEventsInited,delete W.shownHintId,W.sendHintsLog()},stickerHintOver:function(e){W.stickerHintOut(e),addClass(e,"over")},stickerHintOut:function(e){each(geByClass("over",domPN(e)),(function(){removeClass(this,"over")}))},stickerHintClick:function(e,t,o,i){var r=W.opts[e]||{},s=r.txt,n=s&&geByClass1("_sticker_hints",domPN(s)),a="suggestion_"+W.stickerSuggestionQuery;return"stories"===r.ref&&(a="story_suggestion_"+W.stickerSuggestionQuery),t<0?W.previewSticker(!1,i,{stickerId:-t,sticker_referrer:a}):(val(s,""),W.stickerClick(e,t,256,o,i,a),r.checkEditable&&r.checkEditable(e,s)),W.stickersHintsHide(n,r,0),!1},stickerHintKeyOver:function(e,t){W.stickerHintOver(t),W.shownHintId=e},stickerHintKeyOut:function(e,t){W.stickerHintOut(t),delete W.shownHintId},stickerHintMove:function(e){var t=W.shownHintId;if(void 0===t)return!0;var o=W.opts[t],i=o&&geByClass1("_sticker_hints",domPN(o.txt));if(i&&isVisible(i)){var r=geByClass1("over",i)||geByClass1("emoji_sticker_item",i);switch(e.keyCode){case KEY.LEFT:return(r=domPS(r))&&(W.stickerHintOver(r),W.checkStickersHintsScroll(r)),cancelEvent(e),!1;case KEY.RIGHT:return(r=domNS(r))&&(W.stickerHintOver(r),W.checkStickersHintsScroll(r)),cancelEvent(e),!1;case KEY.ENTER:return r.click(),cancelEvent(e),!1}}return!0},checkStickersHintsSize:function(e,t,o){o&&(addClass(e,"_margin_transition"),Object(u.removeClassDelayed)(e,"_margin_transition")),setStyle(e,{marginLeft:0});var i=getXY(e),r=getSize(e),s=W.getEmojiTtXY(t.tt);t.tt&&s&&s[0]&&i[0]+r[0]+10>s[0]&&i[1]+r[1]>s[1]&&setStyle(e,{marginLeft:s[0]-i[0]-r[0]-10}),domFC(e)||W.stickersHintsHide(e,t,0)},getEmojiTtXY:function(e){return e&&hasClass(e,W.SHOWN_TT_CLS)?getXY(e):[0,0]},hintachCache:{},hintachNotFoundStickers:{},checkHintach:function(e,t,o){if(Object(l.partConfigEnabled)("hintach"))return W.hintachCache[e]?requestAnimationFrame(()=>W.renderHintach(e,t,o,W.hintachCache[e])):void ajax.post("/hintach",{query:e},{onDone:i=>{W.hintachCache[e]=i,W.renderHintach(e,t,o,W.hintachCache[e])}})},onHintachItemClick:function(e){var t=e.currentTarget.dataset.hint,o=parseInt(e.currentTarget.parentNode.dataset.opt);if(t&&!isNaN(o)){var i=W.opts[o]||{},r=i.txt,s=r&&geByClass1("_sticker_hints",domPN(r)),n=function(e){if(!e||"string"!=typeof e)return null;var t=e.match(/(photo|doc)(-?\d+)_(\d+)/);if(!t)return null;var o=t[1],i=parseInt(t[2]),r=parseInt(t[3]),s=[i,r].join("_");return{type:o,ownerId:i,id:r,rawId:s}}(t);return n&&i.onHintachSend&&(val(r,""),i.onHintachSend(n.type,n.rawId),i.checkEditable&&i.checkEditable(o,r),W.stickersHintsHide(s,i,0)),!1}},renderHintach:function(e,t,o,i){var r=t.txt,s=geByClass1("_sticker_hints",domPN(r)),n=isArray(i.photos)&&i.photos.length||isArray(i.docs)&&i.docs.length;if(e&&t.stickerHintsString&&n){var a=s&&geByClass1("_sticker_hints_inner",s);if(!a||t.noStickers)return!1;W.clearHintsLog(),W.hintachNotFoundStickers[e]&&(a.innerHTML="");var l=a.querySelector(".Hintach");l||(l=a.appendChild(ce("div",{className:"Hintach"}))),l.setAttribute("data-opt",t.id),l.innerHTML="";var d=64*window.devicePixelRatio,u=64*window.devicePixelRatio;(i.photos||[]).forEach(e=>{var t=function(e,t,o){if(!e||!t||!o)return null;var i=Object.values(e).sort((e,t)=>e[1]-t[1]||e[2]-t[2]);return i.find(e=>e[1]>=t&&e[2]>=o)||i[parseInt(i.length/2)]||i[0]}(e.sizes,d,u);if(t){var o=F(t,3),i=o[0],r=F(c(o[1],o[2]),2),s=r[0],n=r[1],a=ce("div",{className:"Hintach__item Hintach__item--photo"});a.setAttribute("data-hint","photo"+e.id),a.appendChild(ce("div",{className:"Hintach__itemThumb"},{width:s,height:n,backgroundImage:`url(${i})`})),a.onclick=W.onHintachItemClick,l.appendChild(a)}}),(i.docs||[]).forEach(e=>{if(e.preview&&(e.preview.video||e.preview.graffiti)){var t=F(e.preview.video||e.preview.graffiti,3),o=t[0],i=F(c(t[1],t[2]),2),r=i[0],s=i[1],n=ce("div",{className:"Hintach__item Hintach__item--doc"});n.setAttribute("data-hint","doc"+e.id);var a=n.appendChild(ce(e.preview.video?"video":"img",{className:"Hintach__itemPreview",src:o},{width:r,height:s}));e.preview.video&&(n.appendChild(ce("div",{className:"Hintach__itemType",innerHTML:"GIF"})),a.autoplay=!0,a.loop=!0),n.onclick=W.onHintachItemClick,l.appendChild(n)}}),l.childElementCount>0&&(W.stickersHintsShow(s,t,100),a.scrollLeft=0,W.checkStickersHintsScroll(s,a.scrollLeft))}},onMoneyTransferSuggestionClick:function(e,t,o){var i=W.opts[e],r=i.txt.parentNode.querySelector("._sticker_hints");if(W.stickersHintsHide(r,i,0),"send"===t&&i.suggestions.isMoneySendEnabled()||"request"===t&&i.suggestions.isMoneyRequestEnabled()){var s=i.suggestions.config,n=s.fromId,a=s.peer;S.onClick(n,a,t,o,{onSendStart:()=>{i.clearText&&i.clearText()}});var c=W.moneyTransferTextMatch&&W.moneyTransferTextMatch.input||"";statlogsValueEvent("stickers_money_transfer_suggestions","select",[t],c)}},renderMoneyTransferSuggestions:function(e,t){var o=W.opts[e],i=Object(d.isRetina)()?128:64,r={};return o.suggestions.isMoneyRequestEnabled()?r.request=`<a\n        class="emoji_sticker_item"\n        data-money-transfer-type="request"\n        onclick="Emoji.onMoneyTransferSuggestionClick(${e}, 'request', ${t.amount||0});">\n        <img class="emoji_sticker_image" src="/images/money/request/${i}.png" />\n      </a>`:r.request="",o.suggestions.isMoneySendEnabled()?r.send=`<a\n        class="emoji_sticker_item"\n        data-money-transfer-type="send"\n        onclick="Emoji.onMoneyTransferSuggestionClick(${e}, 'send', ${t.amount||0});">\n        <img class="emoji_sticker_image" src="/images/money/send/${i}.png" />\n      </a>`:r.send="",t.request?r.request+r.send:r.send+r.request},checkStickersKeywords:function(e,t,o){if(t.noStickers||!window.stickersKeywords||!window.stickersKeywordsData||!window.stickersKeywordsData.length)return!1;var i=o?0:100,r=t.txt,s=geByClass1("_sticker_hints",domPN(r)),n=function(o,i){if(W.stickers[W.TAB_RECENT_STICKERS]){var r=W.sortStickersHints(window.stickersKeywords[o]),n=W.stickers[W.TAB_RECENT_STICKERS].promoted,a="";i&&(a+=W.renderMoneyTransferSuggestions(e,i)),each(r,(function(){a+=W.render.stickerHintRs(e,this,n[this])})),t.suggestions.isBotLinkEnabled()&&(a+=W.renderSuggestionsBotLink(e)),W.showStickersHints(s,t,a)}},a=function(){var a=t.suggestions.getQueries(W.val(r));if(a.length){var c=a[0],l=t.suggestions.isMoneyTransferEnabled()&&S.match(c,1);if(l&&(a=[S.DEFAULT_QUERY]),W.moneyTransferTextMatch=l,!s&&!(s=W.initStickersHints(r)))return!1;if(c!=t.stickerHintsString){var d=a.find(e=>e&&window.stickersKeywords[e]&&window.stickersKeywords[e].length);if(W.stickerSuggestionQuery=d,d)if(W.stickers[W.TAB_RECENT_STICKERS])n(d,l);else{var u=t.onRecentEmojiUpdate;t.onRecentEmojiUpdate=function(e){u&&u(),e&&(u?t.onRecentEmojiUpdate=u:delete t.onRecentEmojiUpdate,n(d,l))},W.emojiLoadMore(e)}else W.hintachNotFoundStickers[c]=!0,W.stickersHintsHide(s,t,i);!l&&c&&c.length<20&&t.onHintachSend&&(clearTimeout(t.hintachCheckTimeout),t.hintachCheckTimeout=setTimeout(()=>{W.checkHintach(c,t,o)},160)),t.stickerHintsString=c}}};o?a():(clearTimeout(t.stickerHintTT),t.stickerHintTT=setTimeout(a,s&&isVisible(s)?0:200))},showStickersHints:function(e,t,o){var i=e&&geByClass1("_sticker_hints_inner",e);if(!i||t.noStickers)return!1;W.clearHintsLog(),val(i,o),W.stickersHintsShow(e,t,100),i.scrollLeft=0,W.checkStickersHintsScroll(e,i.scrollLeft)},checkStickersHintsScroll:function(e,t){var o=domClosest("_sticker_hints",e),i=o&&geByClass1("_sticker_hints_inner",o),r=o&&geByClass1("_sticker_left",o),s=o&&geByClass1("_sticker_right",o);if(!i)return!1;var n=getSize(r)[0],a=getSize(s)[0];if(hasClass(e,"emoji_sticker_item")){var c=e.offsetLeft-8-n,l=e.offsetLeft+getSize(e)[1]+2+a-i.clientWidth;i.scrollLeft>c&&(i.scrollLeft=c),i.scrollLeft<l&&(i.scrollLeft=l),t=i.scrollLeft}var d=t>0,u=t+i.clientWidth<i.scrollWidth;toggle(r,d),toggleClass(o,"sticker_hints_left_pad",d),toggle(s,u),toggleClass(o,"sticker_hints_right_pad",u),t=void 0===t?i.scrollLeft:t;var p=i.querySelectorAll(".emoji_sticker_item"),h=d?n+8:0,_=u?a+2:0,m=Array.from(p).filter(e=>e.offsetLeft-h>=t&&e.offsetLeft+e.offsetWidth+_-i.clientWidth<=t);W.logHints(m.map(e=>intval(e.getAttribute("data-sticker-id"))).filter(e=>e));var v=m.map(e=>e.getAttribute("data-money-transfer-type")).filter(e=>e);if(v.length){var f=W.moneyTransferTextMatch&&W.moneyTransferTextMatch.input||"";statlogsValueEvent("stickers_money_transfer_suggestions","show",v,f)}},logHints:function(e){W.logHintsTimeout&&clearTimeout(W.logHintsTimeout),W.logHintsTimeout=setTimeout(()=>{W.hintsLogBuffer=e.reduce((e,t)=>(e[t]=1,e),W.hintsLogBuffer||{})},W.logHintsDelay)},clearHintsLog:function(){W.logHintsTimeout&&clearTimeout(W.logHintsTimeout),W.hintsLogBuffer={}},sendHintsLog:function(){var e=W.hintsLogBuffer&&Object.keys(W.hintsLogBuffer),t=window.cur&&window.cur.emojiHintsSendLogHash;e&&e.length&&t&&ajax.post("stickers.php",{act:"log_hints",sticker_ids:e,hash:t}),W.clearHintsLog()},scrollStickersHints:function(e,t,o){var i=domClosest("_sticker_hints",e),r=i&&geByClass1("_sticker_hints_inner",i),s=i&&geByClass1("_sticker_left",i),n=i&&geByClass1("_sticker_right",i);if(!r)return!1;var a=r.scrollLeft+t*(r.clientWidth-2*getSize(e)[0]),c=geByClass("emoji_sticker_item",r);each(c,(function(e,o){return t>0&&o.offsetLeft-8-getSize(s)[0]>a?(a=c[e-1]&&c[e-1].offsetLeft-8-getSize(s)[0]||a,!1):t<0&&o.offsetLeft+getSize(o)[1]+2+getSize(n)[0]-r.clientWidth>a?(a=o.offsetLeft+getSize(o)[1]+2+getSize(n)[0]-r.clientWidth||a,!1):void 0})),a=Math.max(0,Math.min(r.scrollWidth-r.clientWidth,a)),animate(r,{scrollLeft:a},{duration:Math.abs(r.scrollLeft-a)+50,transition:Fx.Transitions.easeOutCubic}),W.checkStickersHintsScroll(r,a)},onWheelStickersHints:function(e){e.preventDefault(),e.stopPropagation();var t=e.currentTarget;t.scrollLeft+=Math.abs(e.deltaY)>Math.abs(e.deltaX)?e.deltaY:e.deltaX,W.checkStickersHintsScroll(t,t.scrollLeft)},sortStickersHints:function(e){var t=[];W.stickers[-1]&&(t=W.stickers[-1].stickers);var o={},i=[];return each(t,(function(){inArray(this[0],e)&&!o[this[0]]&&(i.push(this[0]),o[this[0]]=1)})),each(e,(function(){o[this]||i.push(this)})),i},initStickersHints:function(e){return!!e&&domPN(e).insertBefore(se('<div class="_sticker_hints sticker_hints_tt">\n      <div class="sticker_hints_arrow sticker_left _sticker_left" onmousedown="Emoji.scrollStickersHints(this, -1, event);cancelEvent(event);" onclick="cancelEvent(event);"></div>\n      <div class="_sticker_hints_inner sticker_hints_inner"></div>\n      <div class="sticker_hints_arrow sticker_right _sticker_right" onmousedown="Emoji.scrollStickersHints(this, 1, event);cancelEvent(event);" onclick="cancelEvent(event);"></div>\n    </div>'),e)},updateStickersHints:function(e){W.opts&&each(W.opts,(function(t,o){e&&delete o.stickerHintsString,W.checkStickersKeywords(t,o,!0)}))},renderSuggestionsBotLink(e){var t=W.opts[e].suggestions,o=Object(d.isRetina)()?128:64;return`<a\n    class="emoji_sticker_item"\n    href="${t.getBotLinkUrl()}"\n    onClick="Emoji.onSuggestionsBotLinkClick(event, ${e});"\n    target="_blank">\n    <img class="emoji_sticker_image" src="${t.getBotLinkImageUrl(o)}" />\n  </a>`},onSuggestionsBotLinkClick(e,t){e.stopPropagation();var o=W.opts[t].suggestions;statlogsValueEvent(o.getBotLinkClickStatName(),0,...o.getBotLinkClickStatKeys())},initStickersKeywords:function(){if(!window.stickersKeywordsData){var e=ls.get("stickers_keywords");e&&e.time&&e.time>vkNow()-W.stickersKeywordsExpire&&(window.stickersKeywordsData=e.keywords)}window.stickersKeywordsData&&W.setStickersKeywords(window.stickersKeywordsData)},initPromotedStickerUrls:function(){if(!window.promotedStickerUrls){var e=ls.get("promoted_stickers_urls");if(e&&e.time&&e.time>vkNow()-W.stickersKeywordsExpire)window.promotedStickerUrls=e.stickerUrls;else{ajax.post("al_im.php",{act:"get_promoted_stickers"},{onDone:function(e){ls.set("promoted_stickers_urls",{time:vkNow(),stickerUrls:e}),window.promotedStickerUrls=e}})}}},cachedStickersKeywordsTime:function(){var e=ls.get("stickers_keywords");return e&&e.time?Math.floor(e.time/1e3):0},setStickersKeywords:function(e,t){if(!e)return!1;window.stickersKeywords={};var o=ce("div"),i=[],r="";if(e.forEach((function(e){var t=e.words||[],o=e.user_stickers||[],s=e.promoted_stickers||[],n=o.concat(s.map((function(e){return-e})));t.forEach((function(e){r+="\n"+e,i.push(n)}))})),val(o,r),(r=o.textContent||o.innerText)&&r.slice("\n".length).split("\n").forEach((function(e,t){window.stickersKeywords[e]=i[t]})),!W.stickers[W.TAB_RECENT_STICKERS]){var s=ls.get("recent_stickers");s&&(W.stickers[W.TAB_RECENT_STICKERS]=s)}t&&(ls.set("stickers_keywords",{time:vkNow(),keywords:e}),W.updateStickersHints(!0))},emojiEnter:function(e,t){var o=W.opts[e],i=(o.ctrlSend?o.ctrlSend():o.noEnterSend)||cur.ctrl_submit&&!o.noCtrlSend;if(o.emojiFocused&&o.emojiOvered&&o.openedByTabKey&&(i?!(t.ctrlKey||browser.mac&&t.metaKey):!t.shiftKey)){if(0===o.curTab){var r=geByTag1("img",o.emojiOvered)||geByTag1("i",o.emojiOvered);W.addEmoji(e,W.getCode(r),o.emojiOvered)}return cancelEvent(t)}return!0},insertHTML:function(e){if(browser.msie&&parseInt(browser.version)<12)if(document.selection){var t=document.selection.createRange();t.pasteHTML&&t.pasteHTML(e)}else{var o=document.getSelection().getRangeAt(0),i=document.createElement("span");o.surroundContents(i),i.innerHTML=e,o.collapse(!1)}else e&&document.execCommand("insertHTML",!1,e)},addEmoji:function(e,t,o){if(!1===e||!1===t)return!1;var i=W.opts[e];if(!(vkNow()-i.ttShowT<W.CLICK_DELAY)){if(i.editable){var r=W.getEmojiHTML(t,W.codeToChr(t),!0),s=i.txt,n=!!window.getSelection&&window.getSelection(),a=!1;if(n&&n.rangeCount){var c=n.getRangeAt(0);a=c.commonAncestorContainer?c.commonAncestorContainer:c.parentElement?c.parentElement():c.item(0)}for(var l=a;l&&l!=s;)l=l.parentNode;var d=s.lastChild||{};browser.mozilla&&"BR"==d.tagName&&!d.previousSibling&&re(s.lastChild),l||W.editableFocus(s,!1,!0),W.insertHTML(r);var p=geByClass("emoji",s);for(var h in p.push.apply(p,geByClass("emoji_css",s)),p)if(p.hasOwnProperty(h)){var _=p[h].previousSibling;if(_&&3==_.nodeType&&_.textContent&&32==_.textContent.charCodeAt(0)){var m=_.previousSibling;m&&3==m.nodeType&&m.textContent&&160==m.textContent.charCodeAt(m.textContent.length-1)&&re(_)}}s.check&&s.check(),setTimeout(W.correctCaret.pbind(s),5),W.onChange(i);var v=Object(u.data)(s,"composer");v&&window.Composer&&Composer.updateAutoComplete(v)}else{var f,g,y,b=i.txt,w=b.value;f=browser.iphone||browser.ipad?W.codeToChr(t):W.cssEmoji[t][1]+" ",null!=b.selectionStart&&null!=b.selectionEnd?(g=b.selectionEnd,b.value=w.slice(0,b.selectionStart)+f+w.slice(g),b.selectionStart=b.selectionEnd=g+f.length):void 0!==document.selection&&void 0!==document.selection.createRange&&(b.focus(),(y=document.selection.createRange()).text=f,y.select())}i.checkEditable&&i.checkEditable(e,i.txt),W.checkStickersKeywords(e,i),i.saveDraft&&i.saveDraft(),i.onEmojiAdded&&i.onEmojiAdded(),W.incrRecentEmojiRate(e,t)}},showShadow:function(){return!(browser.msie&&browser.version<10)},scrollToggleArrow:function(e,t,o,i){var r=geByClass1("emoji_tabs_"+t+"_s",o.tt);i?(e?show:hide)(r):e?fadeIn(r,200):fadeOut(r,200),o[t+"Shown"]=e},scrollTabs:function(e,t){var o=W.opts[e];if(o){var i,r=geByClass1("emoji_tabs_wrap",o.tt),s=r.firstChild.clientWidth-r.clientWidth;if(t){if((i=2==t?r.scrollLeft:r.scrollLeft+170)>=s){i=s;var n=geByClass1("emoji_tabs_r_s",o.tt);fadeOut(n,200),o.rShown=!1,W.scrollToggleArrow(!1,"r",o)}i&&!o.lShown&&W.scrollToggleArrow(!0,"l",o)}t&&2!=t||((i=2==t?r.scrollLeft:Math.max(r.scrollLeft-170,0))<=0&&(i=0,W.scrollToggleArrow(!1,"l",o)),i<s&&!o.rShown&&W.scrollToggleArrow(!0,"r",o)),2!=t&&(o.scrollLeft=i,animate(r,{scrollLeft:i},300))}},scrollToTab:function(e,t){var o=W.opts[t],i=o.tt,r=geByClass1("emoji_tabs_wrap",i),s=geByClass1("emoji_tab_"+e,i);if(s){var n=Object(u.data)(r,"tween");if(!n||!n.isTweening||e!=o.curTab){var a=getSize(s)[0],c=s.offsetLeft,l=getSize(r)[0],d=c-l/2+10;c+a<r.scrollLeft?r.scrollLeft=Math.max(c,r.scrollLeft-l/2):c+a-r.scrollLeft>l&&(r.scrollLeft=Math.min(c+a-r.scrollLeft,r.scrollLeft+l/2)),animate(r,{scrollLeft:d},300,(function(){W.scrollTabs(t,2)})),W.selectTab(t,e,s)}}},selectTab:function(e,t,o){var i=W.opts[e],r=i.tt,s=geByClass1("emoji_tabs",r),n=geByClass1("emoji_tab_sel",s);removeClass(n,"emoji_tab_sel"),addClass(o,"emoji_tab_sel"),i.curTab=t,cur.stickersTab=t,ls.set("stickers_tab",t)},tabsWheel:function(e,t){cancelEvent(e);var o=W.opts[t],i=Math.abs(e.deltaY)>Math.abs(e.deltaX)?e.deltaY:e.deltaX,r=geByClass1("emoji_tabs_wrap",o.tt),s=r.scrollLeft;r.scrollLeft+=i,s!=r.scrollLeft&&W.scrollTabs(t,2)},show:function(e,t){var o=Object(u.data)(domPN(e),"optId");void 0!==o&&W.ttShow(o,e,t)},hide:function(e,t,o){var i=Object(u.data)(domPN(e),"optId");void 0!==i&&W.ttHide(i,e,t,o)},ttShow:function(e,t,o){var i=W.opts[e];clearTimeout(i.ctt),clearTimeout(i.stt),i.scrolling&&(i.afterScrollFn=!1),i.ttShown||(t?i.obj=t:t=i.obj,i.stt=setTimeout((function(){W.ttClick(e,t,!1,!0,o)}),W.SHOW_TT_TIMEOUT))},ttHide:function(e,t,o,i){var r=W.opts[e];if(clearTimeout(r.stt),r.ttShown)if(r.scrolling)r.afterScrollFn=W.ttHide.pbind(e,t,o,i);else{t=t||r.obj||geByClass1("emoji_smile",r.controlsCont);var s=function(){W.ttClick(e,t,!0,!1,o)};i?s():(clearTimeout(r.ctt),r.ctt=setTimeout(s,W.HIDE_TT_TIMEOUT))}},ttClick:function(e,t,o,i,r,s){var n=W.opts[e];if(n&&!(o&&!W.shown||i&&W.shown)&&(t||(t=W.shown||ge(-3==cur.peer?"imw_smile":"im_smile")))){t.tt&&t.tt.destroy&&t.tt.destroy(),!n.tt&&n.sharedTT&&n.sharedTT.emojiTT&&(n.tt=n.sharedTT.emojiTT,n.emojiScroll=n.sharedTT.emojiScroll,n.allEmojiId=n.sharedTT.emojiAllId);var a,c=n.tt;if(!c){var l=ls.get("stickers_tab");l||(l=W.TAB_EMOJI),n.curTab=cur.stickersTab=W.TAB_EMOJI,l==W.TAB_EMOJI||n.noStickers||(W.stickers[W.TAB_RECENT_STICKERS]=ls.get("recent_stickers"),n.curTab=cur.stickersTab=l);var d='<div class="emoji_tabs_l_s" onmousedown="Emoji.scrollTabs('+e+', 0); return cancelEvent(event);" onclick="return cancelEvent(event)"><div class="emoji_sprite emoji_tabs_l_sc"></div><div class="emoji_sprite emoji_tabs_l_si"></div></div><div class="emoji_tabs_r_s" onmousedown="Emoji.scrollTabs('+e+', 1); return cancelEvent(event);" onclick="return cancelEvent(event);"><div class="emoji_sprite emoji_tabs_r_sc"></div><div class="emoji_sprite emoji_tabs_r_si"></div></div>';d+=W.getTabsCode([[0,1]],e),d+='<span class="emoji_tabs_wrap"><span id="emoji_tabs_cont_'+e+'" class="emoji_tabs_cont">',n.noStickers||!1===window.emojiStickers||void 0===window.emojiStickers||(d+=W.getTabsCode(window.emojiStickers,e));var u="",p='onmousedown="Emoji.showStickersStore('+e+'); return cancelEvent(event);" onclick="return cancelEvent(event);"',h="showTooltip(this, {text: '"+Object(H.getLang)("global_store_stickers")+"', shift: [4,6,6], showdt: 0, black: 1});";n.rPointer?p+=" onmouseover=\"addClass(this.parentNode.parentNode.parentNode, 'emoji_shop_over');"+h+'" onmouseout="removeClass(this.parentNode.parentNode.parentNode, \'emoji_shop_over\');"':p+=' onmouseover="'+h+'"',d+="</span></span>",n.noStickers||(d+='<a class="fl_r emoji_shop" '+p+'><div class="emoji_sprite emoji_shop_icon">'+(W.hasNewStickers?'<div class="emoji_shop_icon_badge">'+Math.abs(W.hasNewStickers)+"</div>":"")+"</div></a>"),W.showShadow()||(u+=" emoji_no_opacity"),(n.noStickers||n.hideStickersInitial)&&(u+=" emoji_no_tabs"),c=ce("div",{id:"emoji_block_"+e,className:"emoji_tt_wrap tt_down"+u,innerHTML:'<div class="emoji_block_cont"><div class="emoji_block_rel"><div class="emoji_list_cont"><div class="emoji_cats_title_helper"></div><div class="emoji_list"><div class="emoji_scroll emoji_scroll_smiles"></div><div class="emoji_scroll emoji_scroll_stickers"></div></div></div></div><div class="emoji_tabs clear_fix">'+d+"</div></div>",onmouseover:function(t){hasClass(c,"emoji_animated")||W.ttShow(e,!1,t)},onmouseout:function(t){hasClass(c,"emoji_animated")||W.ttHide(e,!1,t)}}),n.tt=c,W.reappendEmoji(e,c),W.emojiOver(e,geByClass1("emoji_scroll_smiles",c).firstChild),each(["emoji_tabs_l_s","emoji_tabs_r_s","emoji_tabs_wrap"],(function(){addEvent(geByClass1(this,n.tt),"DOMMouseScroll wheel",(function(t){W.tabsWheel(t,e)}))})),n.sharedTT&&(n.sharedTT.emojiTT=c),W.checkEmojiSlider(n)}if(clearTimeout(n.ttEmojiHide),!1!==W.shownId&&W.shownId!=e&&W.ttClick(W.shownId,geByClass1("emoji_smile",W.opts[W.shownId].controlsCont),!0),W.preventMouseOver=!1,n.emojiExpanded||W.emojiExpand(e,c),W.shown)W.hideTt(c),(a=geByClass1("_sticker_hints",domPN(n.txt)))&&isVisible(a)&&W.checkStickersHintsSize(a,n,!0),W.shown=!1,W.shownId=!1,n.ttShown=!1,n.emojiFocused=!1,n.emojiOvered=!1,cur.onMouseClick=!1,removeEvent(document,"keydown",W.emojiMove),removeClass(t,"emoji_smile_on"),n.onHide&&n.onHide(),W.favorite.deleteFavoriteStickerElements(e);else{if(n.needUpdateRecentStickers&&(W.updateRecentStickers(e),n.needUpdateRecentStickers=!1),!getXY(n.emojiBtn)[0]||!getXY(n.emojiBtn)[1])return;n.openedByTabKey=!!s,W.showTt(c),W.repositionEmoji(e,t,c),(a=geByClass1("_sticker_hints",domPN(n.txt)))&&isVisible(a)&&W.checkStickersHintsSize(a,n,!0),W.shownId=e,W.shown=t,cur.emojiList=geByClass1("emoji_list",c),n.ttShown=!0,n.ttShowT=vkNow(),n.emojiFocused=!0,removeEvent(document,"keydown",W.emojiMove),setTimeout((function(){cur.onMouseClick=function(t){for(var o=t.target;o;){if("im_texts"==o.id||hasClass(o,"emoji_tt_wrap")||hasClass(o,"imw_emoji_wrap"))return!1;o=o.parentNode}W.ttClick(e,!1,!0)},addEvent(document,"keydown",W.emojiMove)}),0),addClass(t,"emoji_smile_on"),n.emojiScroll&&n.emojiExpanded&&(n.emojiScroll.update(),browser.msie&&0===n.curTab&&n.emojiOvered&&W.scrollToListEl(e,n.emojiOvered)),W.tabSwitch(n.curTab,n.curTab,e),n.onRecentEmojiUpdate&&n.onRecentEmojiUpdate(!0),n.onShow&&n.onShow()}return each(geByClass("emoji_smile_icon_promo"),(function(e,t){removeEvent(geByClass1("emoji_smile_icon",t.parentNode),"mouseover"),re(t),W.noNewStickers=!0})),n.noStickersStore?addClass(geByClass1("emoji_tabs","emoji_block_"+e),"emoji_tabs_no_store"):removeClass(geByClass1("emoji_tabs","emoji_block_"+e),"emoji_tabs_no_store"),cancelEvent(r)}},curEmojiKeys:{},curEmojiRecent:{},emojiLoadMore:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},o=arguments.length>2?arguments[2]:void 0,i=W.opts[e];if(!i.emojiMoreSt){i.emojiMoreSt=1,t.act="get_emoji_list",W.stickerPacksToLoad&&(t.sticker_packs_to_load=W.stickerPacksToLoad.join(",")),W.hasNewStickers<0&&(t.new_shown=1);var r=Object.assign(t.sizes||{},W.stickerSizes);t.sizes=r&&Object.keys(r).join(","),ajax.post("al_im.php",t,{onDone:function(t,s,n,a,c,l){if(W.buildStickersIndex(t),void 0!==t[W.TAB_FAVORITE_STICKERS]){var d=t[W.TAB_FAVORITE_STICKERS];W.tabDefaultId=W.TAB_FAVORITE_STICKERS,W.favoriteAvailable=!0,W.favoriteRemindOn=!!d.remind_on,W.favoriteRemindOff=!!d.remind_off,W.favoriteLimit=d.limit,W.favoriteLimitNoticed=d.limit_noticed,W.sendHintsLogHash=c,S.setIntroViewed(l)}a&&extend(cur.lang,a),n?stManager.add([jsc("web/stickers.js")],(function(){W.updateEmojiList(t,s,e,i)})):W.updateEmojiList(t,s,e,i),Object.assign(W.stickerSizes,r),Object(j.isFunction)(o)&&o()},onFail:function(){i.emojiMoreSt=0}}),W.curEmojiRecent&&i.onRecentEmojiUpdate&&i.onRecentEmojiUpdate()}},buildStickersIndex:function(e){var t={};if(e)for(var o in e)if(e.hasOwnProperty(o)&&o>0&&e[o].stickers)for(var i=e[o].stickers,r=i.length;r--;){var s=i[r];t[s[0]]={sticker:s,packId:o}}W.stickersById=t},updateEmojiList:function(e,t,o,i){W.stickers=e,i.emojiMoreSt=0,W.stickers[-1]&&(ls.set("recent_stickers",W.stickers[-1]),W.updateRecentEmoji(o)),W.stickers[-2],i.allEmojiId=0,i.sharedTT&&(i.sharedTT.emojiAllId=0),W.onStickersLoad&&(i.afterLoad=1),W.onStickersLoad&&window.emojiStickers&&(W.onStickersLoad(),W.onStickersLoad=!1);var r=W.emojiGetRecentFromStorage();r?W.curEmojiRecent=W.filterEmoji(r):(W.emojiOldRecentPrepare(t,o),W.updateEmojiCont(o)),W.updateRecentEmoji(o),i.onRecentEmojiUpdate&&i.onRecentEmojiUpdate(!0)},filterEmoji:function(e){var t=Object.keys(e);e:for(var o in a)if(a.hasOwnProperty(o))for(var i in a[o])if(a[o].hasOwnProperty(i)){var r=a[o][i],s=t.indexOf(r);if(-1!=s&&(t.splice(s,1),0==t.length))break e}var n={};for(var c in e)e.hasOwnProperty(c)&&-1==t.indexOf(c)&&(n[c]=e[c]);return t.length>0&&W.setRecentEmojiList(n),n},emojiGetRecentFromStorage:function(){try{return JSON.parse(localStorage.getItem("emoji_recent_list"))}catch(e){return!1}},emojiOldRecentPrepare:function(e){var t={};for(var o in e)if(e.hasOwnProperty(o)){var i=e[o],r=void 0,s=void 0;isString(i)?(r=1,s=i):(r=i,s=o),t[s]=r}W.setRecentEmojiList(W.filterEmoji(t))},getRecentEmojiSorted:function(){var e=[];for(var t in W.curEmojiRecent)if(W.curEmojiRecent.hasOwnProperty(t)){var o=W.curEmojiRecent[t];e.push([t,o])}e.sort((function(e,t){return t[1]-e[1]}));var i=[];for(var r in e)e.hasOwnProperty(r)&&i.push(e[r][0]);return i.slice(0,20)},incrRecentEmojiRate:function(e,t){W.emojiRecentRateTime||(W.emojiRecentRateTime=Date.now()/1e3-6);var o=Date.now()/1e3-W.emojiRecentRateTime;if(o>=6){var i=Math.min(100,Math.floor(o/6));for(var r in W.curEmojiRecent)if(W.curEmojiRecent.hasOwnProperty(r)){if(r==t)continue;W.curEmojiRecent[r]*=Math.pow(.998076,i)}W.emojiRecentRateTime+=6*i}W.curEmojiRecent[t]||(W.curEmojiRecent[t]=0),W.curEmojiRecent[t]+=1;var s=W.getRecentEmojiSorted();a[-1]=s,s.length>=20&&-1==s.indexOf(t)&&(s.splice(-1),s.push(t));var n={};for(var c in s)if(s.hasOwnProperty(c)){var l=s[c];n[l]=W.curEmojiRecent[l]}W.setRecentEmojiList(n),window.Notifier&&Notifier.lcSend("recent_emoji_set",n)},setRecentEmojiList:function(e){localStorage.setItem("emoji_recent_list",JSON.stringify(e)),W.curEmojiRecent=e},updateEmojiCont:function(e){var t=W.opts[e];0==t.curTab&&(val(geByClass1("emoji_scroll_smiles",t.tt),W.getInitEmojiContent(e)),W.updateEmojiCatTitle(e))},ttEmojiList:function(e,t){var o="",i=W.emojiGetRecentFromStorage();i&&W.setRecentEmojiList(i),a[-1]=W.getRecentEmojiSorted();var r=t||W.SORTED_EMOJI_SECTIONS_CODES;for(var s in r)if(r.hasOwnProperty(s)){var n=r[s];o+=W.getEmojiCategoryHtml(e,n)}return o},getInitEmojiContent:function(e){W.setEmojiLastAddedCategoryIdx(e,1);return W.ttEmojiList(e,[-1,1])},getEmojiCategoryHtml:function(e,t){var o="",i=a[t];if(!i.length)return o;var r=-1==t?"recent":t,s='<div class="emoji_cat_title_helper" data-id="'+t+'" id="emoji_recent_list'+e+"_"+t+'"><div class="emoji_cat_title">'+Object(H.getLang)("global_emoji_cat_"+r)+"</div></div>";return o+=s+=W.emojiGetCatCont(e,i)},getEmojiLastAddedCategoryIdx:function(e){return W.opts[e].lastLoadedEmojiCategoriesIdxes[e]},setEmojiLastAddedCategoryIdx:function(e,t){W.opts[e].lastLoadedEmojiCategoriesIdxes[e]=t},addNextEmojiCategoty:function(e){var t=W.opts[e],o=t.tt,i=W.getEmojiLastAddedCategoryIdx(e);if(!t.emojiCategoryAdding&&!t.allEmojiLoaded)if(t.emojiCategoryAdding=!0,i){var r=geByClass1("emoji_scroll_smiles",o);if(i++,W.SORTED_EMOJI_SECTIONS_CODES.length>i){var s=W.SORTED_EMOJI_SECTIONS_CODES[i];r.insertAdjacentHTML("beforeEnd",W.getEmojiCategoryHtml(e,s)),W.setEmojiLastAddedCategoryIdx(e,i),t.emojiScroll.update()}else t.allEmojiLoaded=!0;t.emojiCategoryAdding=!1}else debugLog("No emoji last category idx")},hideTt:function(e){removeClass(e,W.SHOWN_TT_CLS)},showTt:function(e){addClass(e,W.SHOWN_TT_CLS)},emojiGetCatCont:function(e,t){for(var o="",i="",r=t.length-1,s=0;s<=r;s++)i+=W.emojiWrapItem(e,t[s],s),(s>0&&s%10==9||s>=r)&&(o+='<div class="emoji_smiles_row">'+i+"</div>",i="");return o},updateRecentEmoji:function(e){var t=W.getRecentEmojiSorted(),o=W.emojiGetCatCont(e,t),i=ge("emoji_recent_list"+e+"_-1");if(i){for(var r=i.nextSibling;r&&(r=r.nextSibling,hasClass(r.previousSibling,"emoji_smiles_row"));)re(r.previousSibling);for(var s=ce("div",{innerHTML:o}),n=i.nextSibling,a=i.parentNode;r=s.firstChild;)a.insertBefore(r,n)}},updateRecentStickers:function(e){var t=W.opts[e];if(W.stickers[W.TAB_RECENT_STICKERS]&&t&&t.emojiExpanded){var o=ge("emoji_recent_stickers_cont"+e);if(o){val(o,"");for(var i=W.stickers[W.TAB_RECENT_STICKERS].stickers,r=cf(),s=0;s<i.length;s++){var n=W.render.sticker(e,W.TAB_RECENT_STICKERS,i[s]);r.appendChild(n);var a=68*Math.ceil((s+1)/4);t.needLoadStickers.unshift([e+"_"+W.TAB_RECENT_STICKERS+"_"+i[s][0],a])}o.appendChild(r),W.updateStickersPos(e)}}},findStickerIndex:function(e,t){if(e)for(var o=e.stickers,i=o.length;i--;)if(String(o[i][0])===String(t))return i;return-1},findSticker:function(e,t){var o=W.findStickerIndex(e,t);if(-1!==o)return e.stickers[o]},findFavoriteStickerIndex:function(e){return W.findStickerIndex(W.stickers[W.TAB_FAVORITE_STICKERS],e)},findFavoriteSticker:function(e){return W.findSticker(W.stickers[W.TAB_FAVORITE_STICKERS],e)},findRecentStickerIndex:function(e){return W.findStickerIndex(W.stickers[W.TAB_RECENT_STICKERS],e)},findRecentSticker:function(e){return W.findSticker(W.stickers[W.TAB_RECENT_STICKERS],e)},findPackSticker:function(e){if(W.stickersById&&W.stickersById.hasOwnProperty(e))return W.stickersById[e].sticker},isStickersLoaded:function(){if(W.stickers)for(var e in W.stickers)if(W.stickers.hasOwnProperty(e)&&e!==String(W.TAB_RECENT_STICKERS))return!0;return!1},tabs:{favoriteTabContent:function(e,t){var o=W.TAB_FAVORITE_STICKERS,i="emoji_tab emoji_tab_img_cont emoji_tab_favorite emoji_tab_"+o;if(cur.stickersTab===o&&(i+=" emoji_tab_sel"),0===t&&W.isStickersLoaded()){var r=W.stickers[o];t=r?r.stickers.length:0}return 0===t&&(i+=" unshown"),'<a class="'+i+'" onmousedown="'+e+'" onclick="return cancelEvent(event)"><span class="emoji_tab_icon emoji_sprite emoji_tab_icon_favorite"></span></a>'}},favorite:{reminder:function(e){var t=hasClass(e,"on"),o=t?"favoriteRemindOff":"favoriteRemindOn";if(!W[o]){var i={text:function(){return Object(H.getLang)(t?"purchases_stickers_favorite_rm_tt":"purchases_stickers_favorite_add_tt")},black:1,hidedt:100,typeClass:"tt_black",noZIndex:!0,shift:[10,8]},r=domClosest("ui_scroll_container",e);i.appendEl=r;var s=domClosest("ui_scroll_overflow",e),n=getXYRect(e),a=getXYRect(s),c=n.top-a.top,l=(a.right,n.right,a.bottom-n.bottom),d=n.left-a.left,u=(a.width||a.right-a.left)/2;(!vk.rtl&&d>u||vk.rtl&&d<u)&&(i.needLeft=!0,i.shift[0]=9),i.forcetodown=c<W.FAV_ICON_TT_MIN_HEIGHT,i.forcetoup=l<W.FAV_ICON_TT_MIN_HEIGHT,Object(D.showTooltip)(e,i),W[o]=!0,ajax.post("stickers.php",{act:"tt_favorite_off",tt_type:t?1:2})}},addFavoriteSticker:function(e,t,o){var i=W.stickers[W.TAB_FAVORITE_STICKERS];if(i){var r=W.findPackSticker(t);if(r){r[4]=1,i.stickers.unshift(r);var s=W.opts[e],n=s.deletedFavoriteStickers;for(s.deletedFavoriteStickers=[t];i.stickers.length>W.favoriteLimit;)W.favorite.deleteFavoriteSticker(e,i.stickers[i.stickers.length-1][0]);W.favorite.deleteFavoriteStickerElements(e),s.deletedFavoriteStickers=n;var a=W.findRecentSticker(t);a&&(a[4]=1);var c=ge("emoji_favorite_stickers_cont"+e);if(c){var l=W.opts[e].emojiScroll.data.scrollHeight,d=W.opts[e].emojiScroll.data.scrollTop,u=ge("emoji_sticker_item"+e+"_"+W.TAB_FAVORITE_STICKERS+"_"+t);if(!u){u=W.render.sticker(e,W.TAB_FAVORITE_STICKERS,r),W.render.stickerContent(e,u,!1);var p=domFC(c);p?domInsertBefore(u,p):c.appendChild(u),W.opts[e].emojiScroll.update();var h=W.opts[e].emojiScroll.data.scrollHeight-l;W.opts[e].emojiScroll.scrollTop(d+h),W.updateStickersPos(e)}}var _=geByClass1("emoji_tab_"+W.TAB_FAVORITE_STICKERS);if(hasClass(_,"unshown")&&(W.opts[e].curTab===W.TAB_FAVORITE_STICKERS&&removeClass(geByClass1("emoji_tab_"+W.TAB_RECENT_STICKERS),"emoji_tab_sel"),removeClass(_,"unshown")),W.favorite.updateFavoriteStickerElements(e,t,!0),W.opts[e].deletedFavoriteStickers.length>0){var m=indexOf(W.opts[e].deletedFavoriteStickers,t);-1!==m&&W.opts[e].deletedFavoriteStickers.splice(m,1)}}}},deleteFavoriteSticker:function(e,t,o){var i=W.stickers[W.TAB_FAVORITE_STICKERS];if(i){var r=W.findFavoriteStickerIndex(t);if(-1!==r){if(i.stickers.splice(r,1),W.opts[e].deletedFavoriteStickers.push(t),0===i.stickers.length&&o)addClass(geByClass1("emoji_tab_"+W.TAB_FAVORITE_STICKERS),"unshown"),domData(o.parentElement,"pack-id")===String(W.TAB_FAVORITE_STICKERS)&&addClass(geByClass1("emoji_tab_"+W.TAB_RECENT_STICKERS),"emoji_tab_sel");W.favorite.updateFavoriteStickerElements(e,t,!1);var s=W.findRecentSticker(t);s&&(s[4]=0);var n=W.findPackSticker(t);n&&(n[4]=0)}}},deleteFavoriteStickerElement:function(e,t){re("emoji_sticker_item"+e+"_"+W.TAB_FAVORITE_STICKERS+"_"+t)},deleteFavoriteStickerElements:function(e){var t=W.opts[e];t.deletedFavoriteStickers.length>0&&(t.deletedFavoriteStickers.forEach((function(t){W.favorite.deleteFavoriteStickerElement(e,t)})),t.deletedFavoriteStickers=[],W.updateStickersPos(e))},deleteFavoriteStickerElementsAsync:function(e){var t=W.opts[e];t.deleteFavoriteStickersTimeout||(t.deleteFavoriteStickersTimeout=setTimeout((function(){W.favorite.deleteFavoriteStickerElements(e),t.deleteFavoriteStickersTimeout=null}),W.DELETE_FAV_STICKER_ELEMENTS_DELAY))},updateFavoriteStickerElements:function(e,t,o){geByClass("sticker_item_"+t).forEach((function(e){domData(e,"fav",o?"1":null),toggleClass(e,"faved",o),toggleClass(geByClass1("emoji_sticker_item_fav",e),"on",o)}))}},updateEmojiCatTitle:function(e){var t=W.opts[e];if(t&&t.emojiScroll){var o,i,r,s=ge("emoji_block_"+e),n=geByClass("emoji_cat_title_helper",s),a=t.emojiScroll.data.scrollTop,c=geByClass1("emoji_cats_title_helper",t.tt);if(n.length){var l=n[0];o=W.getSizeCached(l)[1]}for(var d=n.length-1;d>=0;d--)if(a>n[d].offsetTop-o){i=n[d],r=d;break}if(!i)return debugLog("title not found");var u=intval(attr(i,"data-id"));if(t.curEmojiCatId!=u){t.curEmojiCatId=u;var p=[i],h=n[r-1];h&&(addClass(h,"emoji_cat_title_fix"),setStyle(h.firstChild,"transform","translateY("+(i.offsetTop-h.offsetTop-o)+"px)"));for(var _=i.nextSibling;_;)hasClass(_,"emoji_cat_title_fix")&&p.push(_),_=_.nextSibling;for(var m in p)p.hasOwnProperty(m)&&(removeClass(p[m],"emoji_cat_title_fix"),setStyle(p[m].firstChild,"transform","translateY(0px)"));val(c,""),t.emojiTitleHelperIsSet=0}!t.emojiTitleHelperIsSet&&a>=i.offsetTop&&a>0?(val(c,val(i)),t.emojiTitleHelperIsSet=1):t.emojiTitleHelperIsSet&&(a<i.offsetTop||0==a)&&(val(c,""),t.emojiTitleHelperIsSet=0)}},emojiWrapItem:function(e,t,o){var i,r=W.cssEmoji[t];i=r?' title="'+r[1]+'"':"";var s="";return browser.mobile||(s=' onmouseover="return Emoji.emojiOver('+e+', this, true);"'),'<a class="emoji_smile_cont '+("2764"!=t&&o&&o<54?"emoji_smile_shadow":"")+'" '+i+" onmousedown=\"Emoji.addEmoji(Emoji.shownId, '"+t+'\', this); return cancelEvent(event);" onclick="return cancelEvent(event);" '+s+'><div class="emoji_bg"></div><div class="emoji_shadow"></div>'+W.getEmojiHTML(t,!1,!1,!0)+"</a>"},reappendEmoji:function(e,t){var o=W.opts[e];o&&o.rceCont&&(o.addMediaBtn?o.sendWrap.insertBefore(o.rceCont,o.addMediaBtn):o.sendWrap.appendChild(o.rceCont)),t&&(o.ttWrap?o.ttWrap.appendChild(t):o.emojiWrap?o.emojiWrap.appendChild(t):o.obj.appendChild(t),clearTimeout(cur.ttEmojiHide),W.hideTt(t))},ttCalcHeight:function(e,t,o){window.headH=window.headH||ge("page_header")&&W.getSizeCached(ge("page_header"))[1]||0;var i=(window.pageNode&&window.browser.mozilla?Math.min(getSize(pageNode)[1],window.lastWindowHeight):window.lastWindowHeight)||getScroll()[3],r=window.scrollGetY?scrollGetY():getScroll()[1],s=getXY(t)[1],n=W.getSizeCached(t)[1],a=geByClass1("emoji_list",o),c=W.opts[e].emojiSmileHeigh,l=window.headH,d=W.opts[e].emojiRowsCount;isAncestor(t,pageNode)||(l=0),setStyle(a,{height:d*c+8});for(var p,h,_,m,v=r+l,f=r+i,g=o,y=getSize(o)[1];g!==bodyNode&&(g=Object(u.domClosestOverflowHidden)(g));){var b=getXY(g)[1];v=Math.max(v,b),f=Math.min(f,b+getSize(g)[1])}for(_=f-s-n-9,p=(h=s-9-v)<y&&_<y?h>=_:h>=y,W.opts[e].forceUp&&(p=!0),m=p?h:_;m<y&&d>3;)d--,y-=c;W.opts[e].emojiRowsCount=d,W.opts[e].emojiSmileHeigh=c,setStyle(a,{height:d*c+8}),toggleClass(o,"tt_down",p),toggleClass(o,"tt_up",!p)},repositionEmoji:function(e,t,o){var i,r=W.opts[e];if(r){if(o.parentNode&&getXY&&getStyle&&setStyle&&geByClass&&(i=geByClass1("emoji_rpointer",o))){var s=parseInt(getStyle(o,"width")),n=getXY(t)[0],a=parseInt(getStyle(t,"width")),c=getXY(o.parentNode)[0];n+a/2<283?(setStyle(o,"left",-s-c),setStyle(i,"left",n+a/2-20+"px")):(setStyle(o,"left",""),setStyle(i,"left",""))}else setStyle(o,"left","");var l=geByClass1("emoji_list",o),d=geByClass1("emoji_smile_cont",l);if(W.opts[e].emojiSmileHeigh=d&&W.getSizeCached(d)[1]||26,W.opts[e].emojiRowsCount=9,W.ttCalcHeight(e,t,o),r.ttWrap){var u=getSize(r.ttWrap)[0]-(getXY(r.emojiBtn)[0]-getXY(r.ttWrap)[0]);setStyle(o,"right",u-r.ttDiff+"px")}}},emojiOver:function(e,t,o){if(browser.mobile||o&&W.preventMouseOver)return!0;var i=W.opts[e];addClass(t,"emoji_over"),i.emojiOvered&&i.emojiOvered!=t&&removeClass(i.emojiOvered,"emoji_over"),i.emojiOvered=t},emojiExpand:function(e,t){var o=W.opts[e];addClass(t,"emoji_expanded"),W.emojiLoadMore(e),o.emojiScroll?o.emojiScroll.update():(o.emojiScroll=new uiScroll(geByClass1("emoji_list",t),{theme:"default emoji no_transition",shadows:!0,global:!0,noForceReFlow:!0,ondragstart:function(){o.scrolling=!0},ondragstop:function(){o.scrolling=!1,Object(j.isFunction)(o.afterScrollFn)&&o.afterScrollFn()},onscrollstart:function(){window.tooltips&&tooltips.destroyAll(),o.scrollStarted=!0},onupdate:function(t){o.curTab==W.TAB_EMOJI?W.updateEmojiCategories(t,o,e):W.updateShownStickers(e)}}),o.imagesLoader=o.imagesLoader||imagesLoader(o.emojiScroll.scroller,{use_iframe:!0,need_load_class:"emoji_need_load"}),o.sharedTT&&(o.sharedTT.emojiScroll=o.emojiScroll)),o.emojiExpanded=!0},updateEmojiCategories:function(e,t,o){e.data.scrollBottom-W.BOTTOM_REST_FOR_ADD_EMOJI_CATEGORY<=0&&t.scrollStarted&&setTimeout((function(){W.addNextEmojiCategoty(o),W.updateEmojiCatTitle(o)}),0),W.updateEmojiCatTitle(o)},updateShownStickers:function(e,t){var o=W.opts[e];if(o.emojiScroll&&o.stickersSplitersPos){o.needLoadStickers||(o.needLoadStickers=[]);var i=o.emojiScroll.data.scrollTop,r=i,s=i+o.emojiScroll.data.viewportHeight,n=o.needLoadStickers;clearTimeout(o.preloadStickersTimer);for(var a=[],c=0;c<n.length;c++){var l=n[c];if(l[1]+72>=r&&l[1]<=s){var d=ge("emoji_sticker_item"+l[0]);if(!d||hasClass(d,"__loaded"))continue;var u=W.render.stickerContent(e,d,!0);a.push([u,l[0]])}}if(W.loadStickers(e,a),a.length||W.preloadStickers(e),!(t||o.scrollAnimation||W.onStickersLoad)){for(var p=-1,h=0;h<o.stickersSplitersPos.length;h++){var _=o.stickersSplitersPos[h];if(!(_[1]-30<i))break;p=_[0]}p!=W.TAB_FAVORITE_STICKERS&&W.favorite.deleteFavoriteStickerElementsAsync(e),o.curTab!=p&&W.scrollToTab(p,e)}}},loadStickers:function(e,t){var o=W.opts[e];if(t.length){for(var i={},r=0;r<t.length;r++){var s=t[r][0]+":"+t[r][1];o.imagesLoading[s]&&(i[s]=o.imagesLoading[s],delete o.imagesLoading[s],t.splice(r,1),r--)}for(var n in o.imagesLoading)if(o.imagesLoading.hasOwnProperty(n)){var a=o.imagesLoading[n];if(!a)return;a.src=""}for(var c in o.imagesLoading=i,t)if(t.hasOwnProperty(c)){var l=t[c][0]+":"+t[c][1];o.imagesLoading[l]=o.imagesLoader.iloader.add(t[c][0],W.onStickerLoaded,e+":"+t[c][1])}}},preloadStickers:function(e){var t=W.opts[e];t.imagesLoading&&Object.keys(t.imagesLoading).length>0||(clearTimeout(t.preloadStickersTimer),t.preloadStickersTimer=setTimeout((function(){var o=t.emojiScroll.data.scrollTop,i=t.emojiScroll.data.viewportHeight,r=o+i,s=o-i,n=o,a=r,c=r+i,l=geByClass1("emoji_scroll_stickers",t.tt);if(isVisible(l)){for(var d=l.firstChild,u=[];d;){if(hasClass(d,"emoji_sticker_item")&&!hasClass(d,"__loaded")){var p=d.offsetTop;if(p>=s&&p<=n||p>=a&&p<=c){var h=d.id.replace("emoji_sticker_item",""),_=W.render.stickerContent(e,d,!0);u.push([_,h])}}d=d.nextSibling}W.loadStickers(e,u)}}),50))},onStickerLoaded:function(e){var t=String(this).split(":"),o=t[1],i=intval(t[0]),r=W.opts[i],s=ge("emoji_sticker_item"+o);if(s){var n=geByTag1("img",s);if(n){addClass(s,"__loaded"),attr(n,"src",e),delete W.opts[i].imagesLoading[e+":"+o];for(var a=0;a<r.needLoadStickers.length;a++){if(o==r.needLoadStickers[a][0]){r.needLoadStickers.splice(a,1);break}}Object.keys(W.opts[i].imagesLoading).length||W.preloadStickers(i)}}},emojiMove:function(e){var t=W.shownId,o=W.opts[t];if(W.shown&&o&&o.emojiFocused&&o.openedByTabKey){var i=null;if(o.emojiOvered)switch(e.keyCode){case KEY.LEFT:i=W.getEmojiEl(o.emojiOvered,"left"),cancelEvent(e);break;case KEY.RIGHT:i=W.getEmojiEl(o.emojiOvered,"right"),cancelEvent(e);break;case KEY.UP:i=W.getEmojiEl(o.emojiOvered,"up");break;case KEY.DOWN:i=W.getEmojiEl(o.emojiOvered,"down");break;case KEY.ENTER:if(!W.emojiEnter(t,e))return cancelEvent(e),!1;break;default:return!0}else i=W.getFirstEmojiEl(t);if(i)return W.preventMouseOver=!0,W.emojiOver(t,i),W.scrollToListEl(t,i),!1}return!0},scrollToListEl:function(e,t){var o=W.opts[e];if(o&&o.emojiScroll){var i=t.offsetTop,r=Math.max(i+30-o.emojiScroll.data.viewportHeight,Math.min(o.emojiScroll.data.scrollTop,i-30));o.emojiScroll.data.scrollTop!=r&&o.emojiScroll.scrollTop(r)}},anim:function(e,t){clearInterval(cur._imAnim);var o=Math.floor(300/13),i=0,r=domLC(e),s=domFC(e),n=t?0:45,a=t?45:0,c=t?1:0,l=t?0:1;cur._imAnim=setInterval((function(){var d=++i>=o?a:n+1.95*i*(t?1:-1),u=d-45,p=i>=o?l:c+1/(300/13)*i*(t?-1:1),h=1-p;r.style.WebkitTransform=r.style.OTransform=r.style.transform="rotate("+d+"deg)",s.style.WebkitTransform=s.style.OTransform=s.style.transform="rotate("+u+"deg)",r.style.opacity=p,s.style.opacity=h,i>=o&&(clearInterval(cur._imAnim),(t?addClass:removeClass)(e,"emoji_smile_on"),r.style.WebkitTransform=r.style.OTransform=r.style.transform=s.style.WebkitTransform=s.style.OTransform=s.style.transform=r.style.opacity=s.style.opacity="")}),13)},tplSmile:function(e){return'<div class="emoji_smile_wrap _emoji_wrap"><div class="emoji_smile _emoji_btn" title="'+e+'" onmouseover="return Emoji.show(this, event);" onmouseout="return Emoji.hide(this, event);" onclick="return cancelEvent(event);"><div class="emoji_smile_icon"></div></div></div>'},emojiToHTML:s.emojiToHTML,emojiReplace:s.emojiReplace,emojiRegex:Object(i.emojiRegex)(),getCode:function(e){var t=!1;if("emoji_css"==e.className)t=e.getAttribute("emoji");else if(-1!=e.className.indexOf("emoji")){var o=e.src&&e.src.match(/\/([a-f0-9*]+)(_2x)?.png/);t=o?o[1]:e.getAttribute("emoji")}return t},getTabCont:function(e,t){var o="";if(t){var i="",r="",s=W.opts[e].forceStickerPack;for(var n in window.emojiStickers)if(window.emojiStickers.hasOwnProperty(n)){var a=window.emojiStickers[n][0],c=window.emojiStickers[n][1],l=window.emojiStickers[n][4]&&s==a;if(!c&&!l)continue;var d=W.stickers[a];if(!d)continue;var u=a===W.TAB_RECENT_STICKERS,p=a===W.TAB_FAVORITE_STICKERS,h='<div class="clear emoji_stickers_spliter" id="emoji_tab_cont_'+a+"_"+e+'"></div>';u?h+='<div class="emoji_recent_stickers_cont" id="emoji_recent_stickers_cont'+e+'">':p&&(h+='<div class="emoji_favorite_stickers_cont" id="emoji_favorite_stickers_cont'+e+'">');var _=d.stickers;for(var m in _)_.hasOwnProperty(m)&&(h+=W.render.stickerRs(e,a,_[m]));u?i=h+"</div>":p?r=h+"</div>":l?o=h+o:o+=h}o=r+i+o}else o=W.ttEmojiList(e);return o},updateStickersCont:function(e){var t=W.opts[e],o=W.getTabCont(e,W.tabDefaultId);geByClass1("emoji_scroll_stickers",t.tt).innerHTML=o,t.initedStickers=1,t.imagesLoading=[],clearTimeout(t.preloadStickersTimer),W.updateStickersPos(e)},updateStickersPos:function(e){for(var t=W.opts[e],o=[],i=[],r=geByClass1("emoji_scroll_stickers",t.tt).firstChild,s=!1,n=!1;r;){if(!s&&hasClass(r,"emoji_recent_stickers_cont")?(r=r.firstChild,s=!0):!n&&hasClass(r,"emoji_favorite_stickers_cont")&&r.firstChild&&(r=r.firstChild,n=!0),hasClass(r,"emoji_sticker_item")){var a=r.id.replace("emoji_sticker_item","");o.push([a,r.offsetTop])}else if(hasClass(r,"emoji_stickers_spliter")){var c=r.id.replace("emoji_tab_cont_","").split("_");i.push([intval(c[0]),r.offsetTop])}(!r.nextSibling&&s||!r.nextSibling&&n)&&(r=r.parentNode),r=r.nextSibling}t.needLoadStickers=o,t.stickersSplitersPos=i},stickerItem:function(){return'<a id="emoji_sticker_item%optId%_%selId%_%stickerId%" data-opt-id="%optId%" data-sticker-id="%stickerId%" data-pack-id="%selId%" data-src="%stickerUrl%" data-fav="%fav%" data-fav-hash="%favHash%" class="emoji_sticker_item sticker_item_%stickerId% %favClass%" onclick="Emoji.stickerClick(%optId%, %stickerId%, %size%, \'%stickerUrl%\', this, \'%referrer%\');"></a>'},stickerItemAnimation:function(){return'<a id="emoji_sticker_item%optId%_%selId%_%stickerId%" data-opt-id="%optId%" data-uniq-id="%uniqId%" data-sticker-id="%stickerId%" data-pack-id="%selId%" data-src="%stickerUrl%" data-animation-path="%animationUrl%" data-fav="%fav%" data-fav-hash="%favHash%" class="emoji_sticker_item sticker_item_%stickerId% %favClass%" onclick="Emoji.stickerClick(%optId%, %stickerId%, %size%, \'%stickerUrl%\', this, \'%referrer%\');"></a>'},hintsStickerItemAnimation:function(){return'<a id="emoji_sticker_item%optId%_%selId%_%stickerId%" data-pack-id="%selId%" data-sticker-id="%stickerId%" class="emoji_sticker_item %class%" onclick="%onclick%" onmouseover="Emoji.stickerHintOver(this)" onmouseout="Emoji.stickerHintOut(this)" onmouseenter="StickersAnimation.loadAndPlaySticker(this);" data-animation-path="%animationUrl%" data-uniq-id="%uniqId%" data-sticker-id="%stickerId%"><img class="emoji_sticker_image sticker_img" src="%stickerUrl%" /></a>'},hintsStickerItem:function(){return'<a id="emoji_sticker_item%optId%_%selId%_%stickerId%" data-pack-id="%selId%" data-sticker-id="%stickerId%" class="emoji_sticker_item %class%" onclick="%onclick%" onmouseover="Emoji.stickerHintOver(this)" onmouseout="Emoji.stickerHintOut(this)"><img class="emoji_sticker_image" src="%stickerUrl%" /></a>'},tabSwitch:function(e,t,o,i){if(null!=e){var r=W.opts[o],s=r.tt;"number"==typeof e&&(e=geByClass1("emoji_tab_"+e,s));var n=geByClass1("emoji_scroll_smiles",s),a=geByClass1("emoji_scroll_stickers",s),c=geByClass1("emoji_cats_title_helper",s);if(val(c,""),r.curEmojiCatId=null,t==W.TAB_EMOJI)hide(a),show(n),show(c),r.emojiInited||(val(n,W.getInitEmojiContent(o)),r.emojiInited=!0),r.imagesLoader&&r.imagesLoader.processLoad(),r.emojiOvered&&0===r.curTab&&W.emojiOver(o,W.getFirstEmojiEl(o)),r.curTab!=W.TAB_EMOJI&&r.emojiScroll&&r.emojiScroll.scrollTop(0),W.updateRecentEmoji(o),W.updateEmojiCatTitle(o);else{hide(n),show(a),hide(c);var l=W.stickers&&clone(W.stickers);l&&delete l[W.TAB_RECENT_STICKERS],!window.emojiStickers||!l||isEmpty(l)||!l[t]&&t!=W.TAB_RECENT_STICKERS?(W.onStickersLoad=function(){W.updateTabsOpt(o),W.tabSwitch(t,t,o,i)},W.stickersLoadingProgress(o,t,e),r.stickersInited=!1,r.curTab=null,W.emojiLoadMore(o)):r.stickersInited||(W.updateStickersCont(o),r.stickersInited=!0),(r.curTab!=t||r.afterLoad)&&(W.scrollToStickerPack(o,t,r.curTab==W.TAB_EMOJI),r.afterLoad=0),W.updateShownStickers(o,!0)}W.onStickersLoad&&t!=W.TAB_EMOJI||W.selectTab(o,t,e)}},getFirstEmojiEl:function(e){for(var t=W.opts[e],o=geByClass1("emoji_scroll_smiles",t.tt).firstChild;o;){if(hasClass(o,"emoji_smiles_row"))return o.firstChild;o=o.nextSibling}return null},getEmojiEl:function(e,t){for(var o,i=0,r=e.parentNode,s=0,n=r.firstChild;n&&(s++,n!==e);)n=n.nextSibling;for(;e&&!o;){if("left"==t||"right"==t)(o="left"==t?e.previousSibling:e.nextSibling)||("left"==t?(t="up",s=10):(t="down",s=1));else{if("up"!=t&&"down"!=t)break;for(var a=r;a&&(a="up"==t?a.previousSibling:a.nextSibling)&&!hasClass(a,"emoji_smiles_row"););if(!a)break;if(s&&a)for(var c=0,l=a.firstChild;l&&c<s;){if(++c>=s){o=l;break}l=l.nextSibling}if(o||!a)break;o="up"==t||s&&"down"==t?a.lastChild:a.firstChild}if(++i>20){debugLog("ERR!!");break}}return o},stickerClick:function(e,t,o,i,r,s){var n=W.opts[e];if(!(Date.now()-n.ttShowT<W.CLICK_DELAY||n.preventDoubleClick&&Date.now()-n.preventDoubleClick<W.CLICK_DELAY)){W.opts[e].preventDoubleClick=Date.now();var a=parseInt(attr(r,"data-pack-id")),c=!0;if(window.emojiStickers&&each(window.emojiStickers,(function(e,t){if(t[0]==a)return c=!!t[1],!1})),c){var l=W.findRecentStickerIndex(t);-1!==l?W.stickers[W.TAB_RECENT_STICKERS].stickers.splice(l,1):W.stickers[W.TAB_RECENT_STICKERS]||(W.stickers[W.TAB_RECENT_STICKERS]={stickers:[]});var d=domData(r,"animation-path")||"",u=domData(r,"fav"),p=domData(r,"fav-hash");W.stickers[W.TAB_RECENT_STICKERS].stickers.unshift([t,o,i,d,u,p]),ls.set("recent_stickers",W.stickers[W.TAB_RECENT_STICKERS]),n.needUpdateRecentStickers=!0}n.onStickerSend&&n.onStickerSend(t,s,"animation"),statlogsValueEvent("stickers_usage",n.ref,t,s),W.ttHide(e,!1,!1,!0),n.recentSticker=t}},stickerOver:function(e,t){var o={act:"a_stickers_hover",sticker_id:e,from:cur.module};if(isObject(t.tt)&&"IMG"===t.firstChild.nodeName)return t.tt.show();ajax.post("al_im.php",o,{onDone:function(e,o){var i=(cur.tooltips||[]).length,r=["subscribe_post_tt","sticker_extra_tt","sticker_extra_tt"+i,e.image?"":"tt_text_only"];if(r=r.join(" "),e.show){var s={index:i,className:r,content:o,shift:function(){return[-138,0,-200]},hasover:1,slideX:15,showsp:150,cache:1,forcetodown:!0,no_shadow:!0,dir:"left",onShowStart:function(e){var t=e.container,o=getSize(e.container)[1];if(!(o>=225)){var i=intval((225-o)/2)+10,r=intval(getStyle(t,"top",!0));setStyle(t,"top",r+i)}}};gpeByClass("_im_peer_history_w",t)&&(s.appendParentCls="_im_peer_history_w"),Object(D.showTooltip)(t,s)}}})},selectPeer:function(e){if(void 0!==e){var t=W.opts[e];if(t.peer)return t.peer}var o=cur.peer||(cur.mbTo?cur.mbTo[0]:"");if(-3==o&&cur.wdd.imw_dd){var i=0;for(var r in cur.wdd.imw_dd.selected)cur.wdd.imw_dd.selected.hasOwnProperty(r)&&(o=cur.wdd.imw_dd.selected[r][0],i+=1);i>1&&(o="")}return o},showMyStickers:function(){cur.boxMyStickers=showBox("al_im.php",{act:"stickers_my"},{dark:1,stat:["im.css","imn.js",jsc("web/sorter.js")]})},showStickersStore:function(e,t){var o={act:"stickers_store",peer:W.selectPeer(!1!==e?e:void 0),box:1},i=W.opts[e];t&&(o.ref=t),cur.boxStickersStore=showBox("al_im.php",o,{dark:1,stat:["im.css","imn.js","page_help.css",jsc("web/sorter.js")],params:{onDestroy:i&&i.onStoreHide}}),each(geByClass("emoji_smile_icon_promo"),(function(e,t){geByClass1("emoji_smile_icon",t.parentNode),re(t)})),each(geByClass("emoji_shop_icon_badge"),(function(e,t){re(t)})),W.hasNewStickers=!1},previewSticker:function(e,t,o,i){if(o=o||{},i&&checkEvent(i))return!0;var r={act:"sticker_preview",pack_id:e},s=W.selectPeer();if(o.peer?r.peer=o.peer:s&&(r.peer=s),o.preview&&(r.preview=1),o.gift&&(r.gift=1),o.giftTo&&(r.gift_to=o.giftTo),o.stickerId&&(r.sticker_id=o.stickerId),r.sticker_referrer=o.sticker_referrer||"store",o.name){var n=nav.objLoc[0].split("/");"stickers"==n[0]&&n[1]!=o.name&&nav.setLoc({0:"stickers/"+o.name})}return cur.boxStickersPreview=showBox("al_im.php",r,{dark:1,stat:["im.css","imn.js"],onFail:function(t){if(window.cur.emojiStickersDisabled||(window.cur.emojiStickersDisabled={}),e&&(window.cur.emojiStickersDisabled[e]=!0),t)return!0}}),cancelEvent(i),!1},isStickerPackEnabled:function(e,t){var o=!1;if(!window.emojiStickers&&t)return ajax.post("al_im.php",{act:"a_stickers_list"},{onDone:function(e){window.emojiStickers=e,t()}}),0;if(!window.emojiStickers)return!1;for(var i in window.emojiStickers)if(window.emojiStickers.hasOwnProperty(i)&&window.emojiStickers[i][0]==e){o=!!window.emojiStickers[i][1];break}return o},clickSticker:function(e,t,o){if(window.cur.emojiStickersDisabled&&window.cur.emojiStickersDisabled[e])return!0;var i;if(t){if(0===(i=W.isStickerPackEnabled(e,W.clickSticker.pbind(e,t,o))))return!1;if(i){var r=!1;if(t.getAttribute("contenteditable"))r=t;else{for(var s=t.parentNode,n=!1;(s=s.parentNode)&&!hasClass(s,"js-im-page");){if(hasClass(s,"fc_tab")){n=!0;break}if(hasClass(s,"mv_chat"))break}if(!s)return!1;n?r=geByClass1("fc_editable",s):hasClass(s,"js-im-page")?r=geByClass1("_im_text"):hasClass(s,"mv_chat")&&(r=domByClass(s,"mv_chat_reply_input"))}if(r){var a=W.opts[r.emojiId];W.ttClick(r.emojiId,geByClass1("_emoji_btn",r.parentNode.parentNode),!1,!0);var c=geByClass1("emoji_tab_"+e,a.tt),l=W.stickers&&clone(W.stickers);l&&delete l[-1],!l||isEmpty(l)?(W.onStickersLoad=W.tabSwitch.pbind(e,e,r.emojiId),W.stickersLoadingProgress(r.emojiId,e,c)):(a.initedStickers=0,W.tabSwitch(c,e,r.emojiId))}}}return t&&i||W.previewSticker(e,!1,{sticker_referrer:"message"}),o&&cancelEvent(o),!1},stickersLoadingProgress:function(e,t,o){var i=W.opts[e];removeClass(geByClass1("emoji_tab_sel",i.tt),"emoji_tab_sel"),addClass(o,"emoji_tab_sel"),geByClass1("emoji_scroll_stickers",i.tt).innerHTML='<div class="emoji_scroll_progress">'+rs(vk.pr_tpl,{id:"",cls:"pr_big"})+"</div>"},buyStickers:function(e,t,o,i,r){if(o&&hasClass(o,"secondary"))return!0;var s=W.selectPeer();return ajax.post("/al_im.php",{act:"a_stickers_buy",pack_id:e,hash:i,peer:s,sticker_referrer:unclean(r)},{onDone:function(t,o,i,s,n,a){if(each(geByClass("_sticker_btn_"+e),(function(){this.innerHTML=s,this.onmouseover="",this.onclick="",addClass(this,"secondary")})),cur.boxStickersPreview&&cur.boxStickersPreview.hide(),n&&cur.boxStickersStore&&cur.boxStickersStore.hide(),showDoneBox(t),o){W.stickers[W.TAB_RECENT_STICKERS].promoted=a,W.updateTabs(o,i,!0);try{vk.widget&&window.Rpc&&window.Rpc.callMethod("proxy","updateStickers")}catch(e){}"video_live"===r&&window.Videoview&&window.Videoview.onStickersPurchased(e)}var c=cur.tabbedStickersBox;if(c&&c.tbUpdate)for(var d in c.tbUpdate)c.tbUpdate.hasOwnProperty(d)&&(c.tbUpdate[d]=1);var u=cur.emojiId&&cur.emojiId[cur.peer];if(u){var p=geByClass1("emoji_tab_"+e,W.opts[u].tt);p&&W.tabSwitch(p,e,u)}Object(l.partConfigEnabled)("stickers_catalog_reload_after_buy")&&nav.reload({preventScroll:!0})},showProgress:A.lockButton.pbind(o),hideProgress:A.unlockButton.pbind(o),onFail:function(e){return e&&setTimeout(Object(P.showFastBox)(Object(H.getLang)("global_error"),e).hide,3e3),!0}}),cancelEvent(t)},stickerAct:function(e,t,o,i,r){if(r&&hasClass(e,"secondary"))return!0;var s=(r?hasClass(e,"secondary"):hasClass(e,"_im_sticker_activated"))?1:0,n=cur.tabbedStickersBox;if(n)for(var a in n.tbUpdate)n.tbUpdate.hasOwnProperty(a)&&(n.tbUpdate[a]=1);return ajax.post("/al_im.php",{act:"a_stickers_switch",pack_id:t,hash:o,state:s,from_btn:r?1:0},{onDone:function(o,i,n,a){r||(e.innerHTML=o,e.onmouseover="",setStyle(e,{width:"auto"}),toggleClass(e,"_im_sticker_activated",!s)),each(geByClass("_sticker_btn_"+t),(function(){this.innerHTML=a,this.onmouseover="",toggleClass(this,"secondary",!s)})),W.updateTabs(i,n,!0);var c=e.parentNode.parentNode;if(!r){if(cur.stickersSorter.destroy(),s){show("im_stickers_deact");var l=ge("im_stickers_deact_wrap");l.firstChild?l.insertBefore(c,l.firstChild):l.appendChild(c),setStyle(c,{cursor:"default"})}else{geByTag1("div","im_stickers_my_wrap").appendChild(c),ge("im_stickers_deact_wrap").childNodes.length||hide("im_stickers_deact")}cur.stickersSorterInit()}},showProgress:A.lockButton.pbind(e),hideProgress:A.unlockButton.pbind(e)}),cancelEvent(i)},getTabsCode:function(e,t){var o=[];e&&o.push.apply(o,e),o.length>1&&(W.hasNewStickers=!1);var i=W.opts[t].forceStickerPack,r="",s="";for(var n in o)if(o.hasOwnProperty(n)){var a=o[n][0],c=o[n][1],l=o[n][3],d=o[n][4]&&a==i,u=o[n][5];if(!c&&!l&&!d)continue;var p=void 0;if(c||d?(a>0&&-1===W.stickerPacksToLoad.indexOf(a)&&W.stickerPacksToLoad.push(a),p="Emoji.tabSwitch(this, "+a+", "+t+"); return cancelEvent(event);"):p="Emoji.previewSticker("+a+", false, {sticker_referrer: 'keyboard'}); return cancelEvent(event);",o[n][2]&&(W.hasNewStickers=o[n][2]),a===W.TAB_RECENT_STICKERS){var h="emoji_tab emoji_tab_img_cont emoji_tab_recent emoji_tab_"+a;cur.stickersTab==a&&(h+=" emoji_tab_sel"),r+='<a class="'+h+'" onmousedown="'+p+'" onclick="return cancelEvent(event);"><span class="emoji_tab_icon emoji_sprite emoji_tab_icon_recent"></span></a>'}else if(a===W.TAB_FAVORITE_STICKERS)r+=W.tabs.favoriteTabContent(p,o[n][6]);else if(a){var _="emoji_tab emoji_tab_img_cont emoji_tab_"+a;cur.stickersTab==a&&(_+=" emoji_tab_sel"),c||d||(_+=" emoji_tab_promo");var m='<a class="'+_+'" onmousedown="'+p+'" onclick="return cancelEvent(event);"><img width="22" height="22" src="'+u+'" class="emoji_tab_img" /></a>';d?s=m+s:s+=m}else{var v="emoji_tab emoji_tab_"+a;cur.stickersTab==a&&(v+=" emoji_tab_sel"),c||(v+=" emoji_tab_promo"),r+='<a class="'+v+'" onmousedown="'+p+'" onclick="return cancelEvent(event);"><div class="emoji_tab_icon emoji_sprite emoji_tab_icon_'+a+'"></div></a>'}}return r+s},updateTabsOpt:function(e,t){var o=W.opts[e];if(!o.noStickers){var i=ge("emoji_tabs_cont_"+e);i&&(i.innerHTML=W.getTabsCode(window.emojiStickers,e)),W.checkEmojiSlider(o),W.checkNewStickers(o),void 0!==typeof t&&(o.stickersInited=!!t)}},updateTabs:function(e,t,o){e&&o&&window.Notifier&&Notifier.lcSend("emoji",{act:"updateTabs",newStickers:e,keywords:t});var i=0;for(var r in void 0===t?(W.initStickersKeywords(),window.stickersKeywordsData||(i=1)):(window.stickersKeywordsData=t,W.setStickersKeywords(window.stickersKeywordsData,o)),void 0===e?window.emojiStickers&&window.stickersKeywordsData||ajax.post("al_im.php",{act:"a_stickers_list",need_keywords:i,cache_time:W.cachedStickersKeywordsTime()},{onDone:W.updateTabs}):window.emojiStickers=e,W.opts)W.opts.hasOwnProperty(r)&&W.updateTabsOpt(r,!1);var s=W.stickers&&clone(W.stickers);s&&delete s[W.TAB_RECENT_STICKERS],W.onStickersLoad&&window.emojiStickers&&!isEmpty(s)&&(W.onStickersLoad(),W.onStickersLoad=!1)},checkNewStickers:function(e){var t=e.txt;if(!e.noStickers&&!e.noStickersStore&&window.emojiStickers&&t&&t.getAttribute("contenteditable")){for(var o in window.emojiStickers)if(window.emojiStickers.hasOwnProperty(o)&&window.emojiStickers[o][2]){W.hasNewStickers=window.emojiStickers[o][2];break}W.hasNewStickers<0&&!W.noNewStickers&&setTimeout((function(){each(geByClass("emoji_smile_icon"),(function(e,t){var o=t.parentNode;geByClass1("emoji_smile_icon_promo",o)||(o.appendChild(ce("div",{className:"emoji_smile_icon_promo"})),addEvent(t,"mouseover",(function(){Object(D.showTooltip)(this,{text:Object(H.getLang)("global_store_stickers_new_available"),shift:[7,1,4],showdt:0,black:1})})))}))}),hasClass(t,"fc_editable")?200:0)}},checkEmojiSlider:function(e){var t=geByClass1("emoji_tabs_wrap",e.tt),o=!1;if(t){if(t.firstChild.clientWidth&&t.firstChild.clientWidth>t.clientWidth+t.scrollLeft)o=!0;else{var i=t.firstChild.childNodes;i.length>6&&(e.scrollLeft||0)<34*(i.length-6)-16&&(o=!0)}var r=vk.rtl?"l":"r";o?(e.sliderShown=!0,W.scrollToggleArrow(!0,r,e,!0)):e.sliderShown&&(e.sliderShown=!1,W.scrollToggleArrow(!1,r,e,!0))}},giftSticker:function(e,t,o,i){var r={act:"stickers_gift_box",pack_id:e,peers:t,ref:(i=i||{}).ref};return i.from&&(r.from=i.from),r.sticker_referrer=i.sticker_referrer||"store",boxLayerWrap.scrollTop=0,showBox("/al_im.php",r,{stat:["wide_dd.js","wide_dd.css","notifier.css","notifier.js"],dark:1}),cancelEvent(o)},showStickerTT:function(e){var t=e.getAttribute("data-title");t&&Object(D.showTooltip)(e,{text:t,slide:15,shift:[74-getSize(e)[0]/2,120,5],className:"sticker_hint_tt",hasover:1})},scrollToStickerPack:function(e,t,o){var i=W.opts[e],r=ge("emoji_tab_cont_"+t+"_"+e),s=r&&t!=W.tabDefaultId?r.offsetTop+getSize(r)[1]:0;i.scrollAnimation=1,i.emojiScroll.scrollTop(s,o?0:200,(function(){i.scrollAnimation=0})),W.scrollToTab(t,e)},toggleStickers:function(e,t){var o=W.opts[e];o&&o.tt?(o.noStickers=t,toggleClass(o.tt,"emoji_no_tabs",t),o.curTab&&W.tabSwitch(0,0,e)):o&&(o.hideStickersInitial=t)},getSizeCached:function(e){return(e=ge(e))?(void 0!==e[W.CACHED_WIDTH_PROP]&&void 0!==e[W.CACHED_HEIGHT_PROP]||(e[W.CACHED_WIDTH_PROP]=e.offsetWidth,e[W.CACHED_HEIGHT_PROP]=e.offsetHeight),[e[W.CACHED_WIDTH_PROP],e[W.CACHED_HEIGHT_PROP]]):[0,0]},clearSizeCached:function(e){(e=ge(e))&&(e[W.CACHED_WIDTH_PROP]=void 0,e[W.CACHED_HEIGHT_PROP]=void 0)},getStickerReferrer:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,o=W.opts[t];return o&&"stories"===o.ref?W.STICKER_REFERRERS.STORY_KEYBOARD:e===W.TAB_RECENT_STICKERS?W.STICKER_REFERRERS.RECENT:e===W.TAB_FAVORITE_STICKERS?W.STICKER_REFERRERS.FAVORITE:W.STICKER_REFERRERS.KEYBOARD},render:{sticker:function(e,t,o){var i=W.render.stickerRs(e,t,o);return se(i)},stickerRs:function(e,t,o){var i={optId:e,selId:t,stickerId:o[0],size:o[1]?o[1]:256,stickerUrl:o[2],fav:o[4]||"",favHash:o[5]||"",referrer:W.getStickerReferrer(t,e),favClass:o[4]?"faved":""},r="";if(browser.msie&&!browser.msie_edge||!o[3])r=W.stickerItem();else{r=W.stickerItemAnimation();var s=rand(1,1e5);i.animationUrl=o[3],i.uniqId=s}return rs(r,i)},stickerHintRs:function(e,t,o){var i=t,r="";r=t<0?window.promotedStickerUrls&&window.promotedStickerUrls[-i]:o?o[2]:"";var s=o?o[3]:"",n={optId:e,selId:0,stickerId:i,stickerUrl:r,class:i<0?"promo":"",onclick:"Emoji.stickerHintClick("+e+", "+i+", '"+r+"', this)"},a="";return(!browser.msie||browser.msie_edge)&&s&&r?(a=W.hintsStickerItemAnimation(),n.animationUrl=s,n.class+=" sticker_animation"):r&&(a=W.hintsStickerItem()),rs(a,n)},stickerContent:function(e,t,o){var i=attr(t,"data-animation-path"),r=attr(t,"data-src"),s="/images/blank.gif";o||(s=r);var n=attr(t,"data-sticker-id"),a=attr(t,"data-fav-hash"),c=attr(t,"data-fav"),l="";i?l='<div data-uniq-id="'+attr(t,"data-uniq-id")+'" onmouseenter="StickersAnimation.loadAndPlaySticker(this);" class="sticker_animation" data-sticker-id="'+n+'" data-animation-path="'+i+'"><img class="sticker_img emoji_sticker_image" src="'+s+'" data-src="'+r+'"/></div>':l='<img class="emoji_sticker_image" src="'+s+'" data-src="'+r+'"/>';if(W.favoriteAvailable){var d="";1==c&&(d="on"),l+=`<span role="link"\n               onmouseover="Emoji.favorite.reminder(this)"\n               class="emoji_sticker_item_fav ${d}"\n               data-sticker-id="${n}"\n               data-hash="${a}"\n               onmousedown="Stickers.toggleFavorite(this, event, ${e}); cancelEvent(event);"\n               onclick="cancelEvent(event)"></span>`}return val(t,l),r}},__eof:1}},nTq2:function(e,t,o){"use strict";o.r(t),o.d(t,"Likes",(function(){return y}));o("91GP"),o("HEwt"),o("a1Th"),o("Btvt"),o("rGqo"),o("rE2o"),o("ioFf"),o("pIFo"),o("SRfc");var i=o("zxIV"),r=o("Egk5"),s=o("FWc3"),n=o("t7n3"),a=o("7jxN"),c=o("/PiP"),l=o("jE6c"),d=o("EasH"),u=o("4+be");function p(){return(p=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var o=arguments[t];for(var i in o)Object.prototype.hasOwnProperty.call(o,i)&&(e[i]=o[i])}return e}).apply(this,arguments)}function h(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var o=[],i=!0,r=!1,s=void 0;try{for(var n,a=e[Symbol.iterator]();!(i=(n=a.next()).done)&&(o.push(n.value),!t||o.length!==t);i=!0);}catch(e){r=!0,s=e}finally{try{i||null==a.return||a.return()}finally{if(r)throw s}}return o}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return _(e,t);var o=Object.prototype.toString.call(e).slice(8,-1);"Object"===o&&e.constructor&&(o=e.constructor.name);if("Map"===o||"Set"===o)return Array.from(o);if("Arguments"===o||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o))return _(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function _(e,t){(null==t||t>e.length)&&(t=e.length);for(var o=0,i=new Array(t);o<t;o++)i[o]=e[o];return i}var m="like",v="share",f="views",g="comment",y={toggle(e,t,o,s){if(Object(r.cancelEvent)(t),Object(l.isObject)(window.cur)&&Object(l.isFunction)(cur.viewAsBox))return cur.viewAsBox();if(vk.widget&&!vk.id)return window.Widgets.oauth();var n=Object(i.hasClass)(e,"active");Object(i.addClass)(e,"animate"),this.clientUpdate(o,m,n?-1:1,!n),window.ajax.post("like.php",{act:n?"a_do_unlike":"a_do_like",object:o,hash:s,list:cur.pvListId,wall:2,from:this._getReference(o)},{onDone:t=>{this.update(o,t);var i=o.match(/^(wall|market)(.*)/);i&&cur.onLike&&cur.onLike(e,i[1],i[2],n)},onFail:()=>(Object(i.toggleClass)(e,"active",n),this.clientUpdate(o,m,n?1:-1,n),!1)}),Object(l.intval)(Object(i.domData)(e,"count"))>0?y.showLikes(e,o,{fast:!0}):e.tt&&e.tt.destroy&&e.tt.destroy()},_parseObjectId(e){var t=h(e.match(/^([a-z_]+)([0-9\-_]+)$/),3);return{objectType:t[1],objectId:t[2]}},_getReference:e=>cur.pvShown?"photo_viewer":e===cur.wallLayer?"wkview":window.mvcur&&window.mvcur.mvShown?"videoview":cur.wallType?"feed"===cur.wallType?"news"===cur.section?"feed_"+(cur.subsection?cur.subsection:cur.section):"recommended"===cur.section?"feed_recommended"+("recent"!==cur.subsection?"_"+cur.subsection:""):Object(n.inArray)(cur.section,["friends","groups","videos","photos"])?"feed_"+(cur.subsection?"_"+cur.subsection:""):"feed_"+cur.section:"top"===cur.wallType?"wall_top":"wall_"+(cur.onepost?"one":(cur.wallType||"").indexOf("full_")?"page":"full"):cur.module,share(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(vk.widget&&!vk.id)return window.Widgets.oauth();if(Object(l.isObject)(window.cur)&&Object(l.isFunction)(cur.viewAsBox))return cur.viewAsBox();var o=this._parseObjectId(e),i=o.objectType,r=o.objectId;(vk.widget?window.showBox:d.showBox)("like.php",p({act:"publish_box",object:e},t),{stat:["page.js","page.css","wide_dd.js","wide_dd.css",window.jsc("web/sharebox.js")]}),"wall"===i&&window.Wall&&window.Wall.triggerAdPostStat(r,"share_post"),cur.RpcMethods&&(cur.RpcMethods.likeFullUpdate=t=>y.update(e,window.cleanObj(t)))},clientUpdate(e,t,o,r){var s=this._getButtonsByType(e,t);if(s.length){var n=Object(l.intval)(Object(i.domData)(s[0],"count"))+o;this._updateDom(e,t,n,r),this.updateExternalIndex(e,{type:t,count:n,isActive:r})}},update(e,t){if(!isNaN(parseInt(t.like_num))){var o=Object(l.isUndefined)(t.like_my)?void 0:!!Object(l.intval)(t.like_my);this._updateDom(e,m,t.like_num,o,t.like_title),this.updateExternalIndex(e,{type:m,count:t.like_num,isActive:o})}if(!isNaN(parseInt(t.share_num))){var i=Object(l.isUndefined)(t.share_my)?void 0:!!Object(l.intval)(t.share_my);this._updateDom(e,v,t.share_num,i,t.share_title),this.updateExternalIndex(e,{type:v,count:t.share_num})}Object(n.isNumeric)(t.views_num)&&this._updateDom(e,f,t.views_num,void 0,t.views_title),Object(n.isNumeric)(t.comment_num)&&this._updateDom(e,g,t.comment_num)},updateComments(e,t){this.update(e,{comment_num:t})},_updateDom(e,t,o,r,s){var c=this._getButtonsByType(e,t),d=t===f,p="";d?p=o:o>0&&(p=vk.widget?Object(n.formatCount)(o):Object(u.langNumeric)(o,"%s",!0)),d||(o=Object(l.intval)(o));for(var h=0;h<c.length;h++){var _=c[h];if(!Object(i.hasClass)(_,"no_counter")){var g=d?c[h]:Object(i.geByClass1)("like_button_count",c[h]);Object(a.animateCount)(g,p,{str:"auto",noWrapWidth:!d,noSpaceIfEmpty:!0}),Object(i.toggleClass)(_,"empty",o<=0),"boolean"==typeof r&&Object(i.toggleClass)(_,"active",r),Object(i.attr)(c[h],"data-count",o),d&&Object(i.attr)(c[h],"title",s||"");var y=c[h].tt;if(y){var b=Object(i.domByClass)(y.container,"_content"),w=Object(i.domByClass)(y.container,"_value"),k=Object(i.domByClass)(y.container,"_title"),S=Object(l.intval)(Object(i.val)(w));Object(i.val)(w,o),s&&Object(i.val)(k,s),Object(l.isObject)(y)&&(y.likeInvalidated=!0),(S!==o&&S<7||!1===s)&&(t===m?_.needReinitLikesTT=!0:t===v&&(_.needReinitShareTT=!0)),t===m&&Object(i.toggleClass)(b,"me_hidden",!r),!1===s&&y.destroy&&y.destroy()}}}},_getButtonsByType:(e,t)=>Object(i.domQuery)(`._like_${e} ._${t}`),showLikes(e,t){var o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(!(e.postDontShowLikes||vk.widget&&vk.show_external_auth_box)){var r=o.views?{views:1}:o.share?{published:1}:{};o.listId&&(r.list=o.listId);var a,c,d=!!Object(i.geByClass1)("share",Object(i.gpeByClass)("like_wrap",e)),u=getComputedStyle(e),p=Object(l.intval)(u.getPropertyValue("padding-left").replace("px","")),h=Object(l.intval)(u.getPropertyValue("padding-top").replace("px","")),_=Object(i.geByClass1)("like_button_icon",e),m=[40-Object(i.getSize)(_)[0]/2-p,10-h],v=o.cl||"";if(o.share)v+="likes_tt_share";else if(v+="likes_tt_like","wpost"===o.from)m[0]=12;else if("widget_community"===o.from)m[0]=6;else if("wcomments"===o.from||"widget_comments"===cur.wallType){m[0]=Object(i.getSize)(e)[0]+16-Object(i.getSize)(_)[0]/2-10}else"photo_carousel"===o.from&&(m[1]=10);o.share?(a="needReinitLikesTT",c="resetLikesTTTimer"):(a="needReinitShareTT",c="resetShareTTTimer"),clearTimeout(e[c]),Object(s.showTooltip)(e,{url:"/like.php",params:Object(n.extend)({act:"a_get_stats",object:t,has_share:d?1:""},r),appendEl:document.body,slide:15,shift:m,ajaxdt:o.fast?0:100,showdt:o.fast?0:400,hidedt:200,dir:"auto",checkLeft:!0,reverseOffset:80,noZIndex:!0,hasover:!0,tip:{over:()=>{y.showLikes(e,t,o)}},typeClass:"like_tt",className:v,onHide:()=>{clearTimeout(e[c]),e[a]&&(e[c]=setTimeout(()=>{delete e[a],e.tt&&e.tt.destroy&&e.tt.destroy()},200))}})}},showShare:function(e,t,o){y.showLikes(e,t,Object(n.extend)(o,{share:1}))},updateViews:function(e){vk.widget&&vk.show_external_auth_box||window.ajax.post("like.php",{act:"a_get_stats",object:e,views:1},{cache:1,onDone(t,o){var r=Object(i.ce)("div",{innerHTML:o});y._updateDom(e,f,t,void 0,r.innerText||r.textContent)}})},makeTemplate(e,t){return(t=Object(n.extend)({object_raw:"",likes_count:"",liked:!1,share_count:"",shared:"",views_count:"",share_opts:{},like_opts:{},class_name:"",like_cont_class:""},t)).like_active=t.liked?"active":"",t.share_active=t.shared?"active":"",t.comment_active="",t.likes_formatted_count=t.likes_count>0?Object(u.langNumeric)(t.likes_count,"%s",!0):"",t.share_formatted_count=t.share_count>0?Object(u.langNumeric)(t.share_count,"%s",!0):"",t.share_opts=this._convertOptsToString(t.share_opts),t.like_opts=this._convertOptsToString(t.like_opts),t.like_class_name=t.likes_count>0?"":"empty",t.share_class_name=t.share_count>0?"":"empty",Object(i.rs)(e,t)},_convertOptsToString:e=>JSON.stringify(e).replace(/\"/g,"'"),updateExternalIndex(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},o=this._parseObjectId(e),i=o.objectType,r=o.objectId;switch(i){case"photo":if(!cur.pvShown||!cur.pvCurPhoto||cur.pvCurPhoto.id!==r)return;var s=cur.pvListId,n=cur.pvIndex,a=cur.pvData[s][n];t.type===m?(a.likes=t.count,a.liked=t.isActive,cur.pvCommsLikes[a.id][1]=t.count):t.type===v&&(a.shares=t.count);break;case"video":if(window.mvcur&&window.mvcur.mvShown&&window.mvcur.videoRaw===r&&t.type===m){var c=window.Videoview.getMvData();c.likes=t.count,void 0!==t.isActive&&(c.liked=t.isActive,window.Videoview.playerOnLiked(t.isActive),window.Videoview.recache())}}},showLikesList(e,t){cur.viewAsBox||Object(i.hasClass)(Object(i.gpeByClass)("like_btn",e),"no_counter")||Object(c.showWiki)({w:"likes/"+Object(n.clean)(t)},!1,!1,{queue:1})},showSharesList(e,t){cur.viewAsBox||Object(i.hasClass)(Object(i.gpeByClass)("like_btn",e),"no_counter")||Object(c.showWiki)({w:"shares/"+Object(n.clean)(t)},!1,!1,{queue:1})}}},ofcU:function(e,t,o){"use strict";o.r(t),o.d(t,"createMutations",(function(){return l})),o.d(t,"createModule",(function(){return p})),o.d(t,"destroyModule",(function(){return h}));o("HEwt"),o("a1Th"),o("rE2o"),o("ioFf"),o("rGqo"),o("Btvt"),o("KKXr");function i(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var o=[],i=!0,r=!1,s=void 0;try{for(var n,a=e[Symbol.iterator]();!(i=(n=a.next()).done)&&(o.push(n.value),!t||o.length!==t);i=!0);}catch(e){r=!0,s=e}finally{try{i||null==a.return||a.return()}finally{if(r)throw s}}return o}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return r(e,t);var o=Object.prototype.toString.call(e).slice(8,-1);"Object"===o&&e.constructor&&(o=e.constructor.name);if("Map"===o||"Set"===o)return Array.from(o);if("Arguments"===o||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o))return r(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function r(e,t){(null==t||t>e.length)&&(t=e.length);for(var o=0,i=new Array(t);o<t;o++)i[o]=e[o];return i}var s=new window.Map;function n(e){var t=s.get(e.currentTarget);if(t){var o=t[e.type];if(o)for(var r,n=0;n<o.length;n++){var a=i(o[n],2),c=a[0],l=a[1],d=void 0;if(hasClass(e.target,c)?d=l(e,e.target):(r=gpeByClass(c,e.target,e.currentTarget))&&(d=l(e,r)),!1===d)break}}}var a=o("Egk5"),c=function(){for(var e=0,t=0,o=arguments.length;t<o;t++)e+=arguments[t].length;var i=Array(e),r=0;for(t=0;t<o;t++)for(var s=arguments[t],n=0,a=s.length;n<a;n++,r++)i[r]=s[n];return i};function l(e){return{callMutations:function(){if("function"==typeof e)throw console.trace(),new Error("Mutations are not initialized");return e},bindMutations:function(){for(var t=[],o=0;o<arguments.length;o++)t[o]=arguments[o];if("function"!=typeof e)throw console.trace(),new Error("Mutations are already initialized");return e=e.apply(void 0,t)}}}function d(e,t,o,i){Object(a.addEvent)(t,o,i),e._registeredHandlers.push({handlerType:"bind",elem:t,types:o,handler:i})}function u(e,t,o,i,r){!function(e,t,o,i){var r=s.get(e);r||(s.set(e,{}),r=s.get(e));for(var a=t.split(" "),c=0;c<a.length;c++){var l=a[c];r[l]||(r[l]=[],addEvent(e,l,n)),r[l].push([o,i])}}(t,o,i,r),e._registeredHandlers.push({handlerType:"delegate",elem:t,types:o,selector:i,handler:r})}function p(e){var t={_registeredHandlers:[]};return e.handlers((function(){for(var e=[],o=0;o<arguments.length;o++)e[o]=arguments[o];return d.apply(void 0,c([t],e))}),(function(){for(var e=[],o=0;o<arguments.length;o++)e[o]=arguments[o];return u.apply(void 0,c([t],e))})),t}function h(e){e._registeredHandlers.forEach((function(e){var t,o,i,r,c;"delegate"===e.handlerType?(t=e.elem,o=e.types,i=e.selector,r=e.handler,(c=s.get(t))&&(o.split(" ").forEach(e=>{c[e]&&(c[e]=c[e].filter(e=>e[0]!==i||e[1]!==r),0===c[e].length&&removeEvent(t,e,n))}),0===Object.keys(c).map(e=>c[e].length).reduce((e,t)=>e+t)&&s.delete(t))):Object(a.removeEvent)(e.elem,e.types,e.handler)})),e._registeredHandlers=[]}},pQ8y:function(e,t,o){"use strict";o.r(t);var i=o("wx14"),r=o("zLVn"),s=o("dI71");o("17x9");function n(e,t){return e.replace(new RegExp("(^|\\s)"+t+"(?:\\s|$)","g"),"$1").replace(/\s+/g," ").replace(/^\s*|\s*$/g,"")}var a=o("q1tI"),c=o.n(a),l=o("dRu9"),d=function(e,t){return e&&t&&t.split(" ").forEach((function(t){return i=t,void((o=e).classList?o.classList.remove(i):"string"==typeof o.className?o.className=n(o.className,i):o.setAttribute("class",n(o.className&&o.className.baseVal||"",i)));var o,i}))},u=function(e){function t(){for(var t,o=arguments.length,i=new Array(o),r=0;r<o;r++)i[r]=arguments[r];return(t=e.call.apply(e,[this].concat(i))||this).appliedClasses={appear:{},enter:{},exit:{}},t.onEnter=function(e,o){t.removeClasses(e,"exit"),t.addClass(e,o?"appear":"enter","base"),t.props.onEnter&&t.props.onEnter(e,o)},t.onEntering=function(e,o){var i=o?"appear":"enter";t.addClass(e,i,"active"),t.props.onEntering&&t.props.onEntering(e,o)},t.onEntered=function(e,o){var i=o?"appear":"enter";t.removeClasses(e,i),t.addClass(e,i,"done"),t.props.onEntered&&t.props.onEntered(e,o)},t.onExit=function(e){t.removeClasses(e,"appear"),t.removeClasses(e,"enter"),t.addClass(e,"exit","base"),t.props.onExit&&t.props.onExit(e)},t.onExiting=function(e){t.addClass(e,"exit","active"),t.props.onExiting&&t.props.onExiting(e)},t.onExited=function(e){t.removeClasses(e,"exit"),t.addClass(e,"exit","done"),t.props.onExited&&t.props.onExited(e)},t.getClassNames=function(e){var o=t.props.classNames,i="string"==typeof o,r=i?""+(i&&o?o+"-":"")+e:o[e];return{baseClassName:r,activeClassName:i?r+"-active":o[e+"Active"],doneClassName:i?r+"-done":o[e+"Done"]}},t}Object(s.default)(t,e);var o=t.prototype;return o.addClass=function(e,t,o){var i=this.getClassNames(t)[o+"ClassName"];"appear"===t&&"done"===o&&(i+=" "+this.getClassNames("enter").doneClassName),"active"===o&&e&&e.scrollTop,this.appliedClasses[t][o]=i,function(e,t){e&&t&&t.split(" ").forEach((function(t){return i=t,void((o=e).classList?o.classList.add(i):function(e,t){return e.classList?!!t&&e.classList.contains(t):-1!==(" "+(e.className.baseVal||e.className)+" ").indexOf(" "+t+" ")}(o,i)||("string"==typeof o.className?o.className=o.className+" "+i:o.setAttribute("class",(o.className&&o.className.baseVal||"")+" "+i)));var o,i}))}(e,i)},o.removeClasses=function(e,t){var o=this.appliedClasses[t],i=o.base,r=o.active,s=o.done;this.appliedClasses[t]={},i&&d(e,i),r&&d(e,r),s&&d(e,s)},o.render=function(){var e=this.props,t=(e.classNames,Object(r.default)(e,["classNames"]));return c.a.createElement(l.default,Object(i.default)({},t,{onEnter:this.onEnter,onEntered:this.onEntered,onEntering:this.onEntering,onExit:this.onExit,onExiting:this.onExiting,onExited:this.onExited}))},t}(c.a.Component);u.defaultProps={classNames:""},u.propTypes={};t.default=u},qrY5:function(__webpack_module__,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__);var core_js_modules_es6_regexp_replace__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("pIFo"),_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("Egk5"),_web_lib_dom__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("zxIV"),_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("t7n3"),_web_lib_browser__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("gdug"),_web_lib_scroll__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("lXE5"),_web_lib_debug_tools__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__("98sY"),_web_legacy_ui_ui_scroll__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__("59zB"),uiActionsMenu={keyToggle:function(e,t){if(!Object(_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_1__.checkKeyboardEvent)(t))return!1;var o=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_2__.domClosest)("_ui_menu_wrap",e);o&&uiActionsMenu.toggle(o,!hasClass(o,"shown"))},toggle:function toggle(el,s,options){var dummyMenu=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_2__.data)(el,"dummyMenu");dummyMenu&&(el=dummyMenu),Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_2__.toggleClass)(el,"shown",s);var onhide=attr(el,"onHide");if(onhide&&!hasClass(el,"shown"))try{eval(onhide)}catch(e){Object(_web_lib_debug_tools__WEBPACK_IMPORTED_MODULE_6__.logEvalError)(e,onhide)}if(options&&options.onToggle){var script=options.onToggle.replace("{isShow}",""+s);try{eval(script)}catch(e){Object(_web_lib_debug_tools__WEBPACK_IMPORTED_MODULE_6__.logEvalError)(e,script)}}},show:function(e,t,o){var i=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_2__.data)(e,"hidetimer");i&&(clearTimeout(i),Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_2__.data)(e,"hidetimer",0));var r=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_2__.data)(e,"origMenu");if(r&&(i=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_2__.data)(r,"hidetimer"))&&(clearTimeout(i),Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_2__.data)(e,"hidetimer",0)),o&&o.delay){cur.uiActionsMenuShowTimeout&&clearTimeout(cur.uiActionsMenuShowTimeout);var s=o.delay;return delete o.delay,void(cur.uiActionsMenuShowTimeout=setTimeout(uiActionsMenu.show.pbind(e,t,o),s))}if(cur.uiActionsMenuShowTimeout&&(clearTimeout(cur.uiActionsMenuShowTimeout),delete cur.uiActionsMenuShowTimeout),o&&o.appendParentCls){var n,a,c=geByClass1("_ui_menu",e);if(c){a=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_2__.domClosest)(o.appendParentCls,c),n=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_2__.domClosest)("_ui_menu_wrap",e);var l=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_2__.se)(`<div class="${n.className} ui_actions_menu_dummy_wrap" onmouseover="uiActionsMenu.show(this);" onmouseout="uiActionsMenu.hide(this);"></div>`);if(l.appendChild(c),a.appendChild(l),Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_2__.data)(e,"dummyMenu",l),Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_2__.data)(l,"origMenu",e),e=l,Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_2__.data)(c,"top",Object(_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_3__.intval)(Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_2__.getStyle)(c,"top"))),Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_2__.data)(c,"left",Object(_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_3__.intval)(Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_2__.getStyle)(c,"left"))),Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_2__.data)(c,"right",Object(_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_3__.intval)(Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_2__.getStyle)(c,"right"))),o.processHoverCls){var d=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_2__.domClosest)(o.processHoverCls,n);addEvent(e,"mouseover",addClass.pbind(d,"hover")),addEvent(e,"mouseout",removeClass.pbind(d,"hover"))}}else e=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_2__.data)(e,"dummyMenu");var u=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_2__.data)(e,"origMenu");c=geByClass1("_ui_menu",e),n=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_2__.domClosest)("_ui_menu_wrap",u),a=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_2__.domClosest)(o.appendParentCls,c),setStyle(c,{display:"block"});var p=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_2__.getXY)(a),h=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_2__.getXY)(n),_=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_2__.data)(c,"top"),m=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_2__.data)(c,"left"),v=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_2__.data)(c,"right"),f={top:h[1]-p[1]+_};v?f.right=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_2__.getSize)(a)[0]+p[0]-h[0]-Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_2__.getSize)(n)[0]+v:f.left=h[0]-p[0]+m,setStyle(c,f)}var g=geByClass1("_ui_menu",e);if(o&&o.autopos&&g&&!hasClass(e,"shown")){removeClass(e,"ui_actions_menu_left");var y=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_2__.getXY)(e)[1],b=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_2__.getSize)(e)[1],w=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_2__.getSize)(g)[1],k=o.dy||10,S=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_2__.getXY)(g)[0];removeClass(e,"ui_actions_menu_top"),addClass(e,"no_transition"),y+b+k+w>(_web_lib_browser__WEBPACK_IMPORTED_MODULE_4__.browser.mozilla?Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_2__.getSize)("page_wrap")[1]:Object(_web_lib_scroll__WEBPACK_IMPORTED_MODULE_5__.scrollGetY)()+(window.lastWindowHeight||0))&&addClass(e,"ui_actions_menu_top"),y-k-w<Object(_web_lib_scroll__WEBPACK_IMPORTED_MODULE_5__.scrollGetY)()+Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_2__.getSize)("page_header_wrap")[1]&&removeClass(e,"ui_actions_menu_top"),Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_2__.toggleClass)(e,"ui_actions_menu_left",S<0),removeClass(e,"no_transition")}o&&o.hasOwnProperty("alwaysTop")&&g&&!hasClass(e,"shown")&&(removeClass(e,"ui_actions_menu_top"),o.alwaysTop&&addClass(e,"ui_actions_menu_top")),o&&o.scroll&&o.maxHeight&&(g.style.maxHeight=(Object(_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_3__.intval)(o.maxHeight)||200)+"px",g.__uiScroll__||new _web_legacy_ui_ui_scroll__WEBPACK_IMPORTED_MODULE_7__.default(g)),uiActionsMenu.toggle(e,!0,o)},hide:function(e,t,o){cur.uiActionsMenuShowTimeout&&(clearTimeout(cur.uiActionsMenuShowTimeout),delete cur.uiActionsMenuShowTimeout);var i=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_2__.data)(e,"hidedelay");i?Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_2__.data)(e,"hidedelay",!1):i=200,Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_2__.data)(e,"hidetimer")||Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_2__.data)(e,"hidetimer",setTimeout((function(){uiActionsMenu.toggle(e,!1,o),Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_2__.data)(e,"hidetimer",0)}),i))},hideDelay:function(e,t){Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_2__.data)(e,"hidedelay",t)}};__webpack_exports__.default=uiActionsMenu},r7nW:function(e,t,o){"use strict";o.r(t);var i=o("q1tI"),r=o("i8i4"),s=(o("17x9"),o("ZxpX"));class n extends i.Component{constructor(){super(...arguments),this.getScrollbarWidth=()=>{var e=document.createElement("div");e.classList.add("BaseModal__scrollbarMeasure"),document.body.appendChild(e);var t=e.getBoundingClientRect().width-e.clientWidth;return document.body.removeChild(e),t},this.hideScrollBar=()=>{var e=document.body.getBoundingClientRect(),t=e.left+e.right<window.innerWidth,o=this.getScrollbarWidth();this.calculatedPadding=window.getComputedStyle(document.body)["padding-right"],t&&(document.body.style.paddingRight=parseFloat(this.calculatedPadding)+o+"px"),document.body.classList.add("BaseModal__bodyHiddenOverflow")},this.showScrollBar=()=>{document.body.style.paddingRight=this.calculatedPadding,document.body.classList.remove("BaseModal__bodyHiddenOverflow")},this.onDocumentKeyDown=e=>{var t=this.props.onClose;"Escape"===e.key&&t()},this.onBackdropClick=()=>{var e=this.props,t=e.onClose,o=e.onBackdropClick;e.disableBackdropClick||(o?o():t())}}componentDidMount(){var e=this.props,t=e.disableEscapeClose,o=e.disableBodyScroll;t||document.body.addEventListener("keydown",this.onDocumentKeyDown),o&&this.hideScrollBar()}componentWillUnmount(){var e=this.props,t=e.disableEscapeClose,o=e.disableBodyScroll;t||document.body.removeEventListener("keydown",this.onDocumentKeyDown),o&&this.showScrollBar()}renderModal(){var e=this.props.className,t=Object(s.classNames)("BaseModal",e);return i.createElement("div",{className:t,"aria-modal":"true"},i.createElement("div",{className:"BaseModal__backdrop",onClick:this.onBackdropClick}),i.createElement("div",{className:"BaseModal__content"},this.props.children))}render(){return r.createPortal(this.renderModal(),document.body)}}n.defaultProps={className:"",children:null,disableBackdropClick:!1,disableEscapeClose:!1,disableBodyScroll:!1},t.default=n},rJNF:function(e,t,o){"use strict";o.r(t),o.d(t,"showNarrativeEditorBox",(function(){return oe})),o.d(t,"showNarrativeBox",(function(){return ie})),o.d(t,"showNarrativeChooseBox",(function(){return re})),o.d(t,"showNarrativeCreateLiteBox",(function(){return se}));var i,r,s,n=o("q1tI"),a=o.n(n),c=o("505V"),l=o("vkmG"),d=o("6krn"),u=o("Ht+d"),p=o("v+DW"),h=o("kcIO"),_=o("6raB"),m=o("FbC+"),v=o("UWqh"),f=o("F8uh"),g=o("t7n3"),y=o("ZxpX"),b=o("0toi"),w=(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])})(e,t)},function(e,t){function o(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(o.prototype=t.prototype,new o)}),k=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return w(t,e),t.prototype.render=function(){var e=this.props,t=e.className,o=e.appearance,i=e.title,r=e.actionButtons,s=e.onClose,n=e.children,c=e.hint,l=e.hasScroll;return a.a.createElement("div",{className:"BoxModal"},a.a.createElement("div",{className:Object(y.classNames)("Modal","Modal--"+o,t)},a.a.createElement(b.default.Header,{title:i,onClose:s,appearance:o}),Boolean(n)&&a.a.createElement(b.default.Body,{hasScroll:l},n),a.a.createElement(b.default.Footer,{actionButtons:r,hint:c})))},t.defaultProps={appearance:"white",hasScroll:!0},t}(a.a.Component),S=function(){var e=function(t,o){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])})(t,o)};return function(t,o){function i(){this.constructor=t}e(t,o),t.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}(),j=function(){for(var e=0,t=0,o=arguments.length;t<o;t++)e+=arguments[t].length;var i=Array(e),r=0;for(t=0;t<o;t++)for(var s=arguments[t],n=0,a=s.length;n<a;n++,r++)i[r]=s[n];return i},E=function(e){function t(t){var o=e.call(this,t)||this;o.onSelectedStoriesUpdate=function(e,t){var i=o.state.coverStoryId,r={selectedStories:e,selectedStoriesMap:t};i&&t[i]?e.length||(r.coverStoryId=""):r.coverStoryId=e[0]?e[0].rawId:"",o.setState(r)},o.openCoverSelection=function(){var e=o.state.coverStoryId;e&&o.setState({selectedCoverStoryId:e,coverSelectionActive:!0})},o.cancelChoosingCover=function(){o.setState({coverSelectionActive:!1,selectedCoverStoryId:""})},o.saveChosenCover=function(){var e=o.state.selectedCoverStoryId;o.setState({coverSelectionActive:!1,coverStoryId:e,selectedCoverStoryId:""})},o.toggleCover=function(e){var t=o.state.selectedCoverStoryId,i=e.rawId;i!==t&&o.setState({selectedCoverStoryId:i})},o.onNameChange=function(e){var t=e.target.value,i=Object(g.trim)(t)?t:"";o.setState({name:i})},o.getBoxActionButtons=function(){var e=o.props.type,t=o.state,i=t.selectedStories,r=t.coverSelectionActive,s=t.loading;return[a.a.createElement(u.default,{key:"close",appearance:"tertiary",onClick:r?o.cancelChoosingCover:function(){return o.closeBox(!1)},disabled:s},Object(d.getLang)("global_cancel")),a.a.createElement(_.default,{loading:s,key:"save",onClick:r?o.saveChosenCover:o.save,disabled:0===i.length},e===c.Type.edit||r?Object(d.getLang)("global_save"):Object(d.getLang)("stories_create_narrative"))]},o.closeBox=function(e){o.props.onClose(e)},o.onSave=function(e){o.props.onSave(e)},o.save=function(){var e=o.props,t=e.publishHash,i=e.editHash,r=e.type,s=o.state,n=s.selectedStories,a=s.coverStoryId,l=s.loading,u=o.state.name,_=void 0===u?"":u,m=o.props.narrativeRawId;if(!l)if(_=Object(g.trim)(_)){if(a){var v="publish_narrative",f=t;r===c.Type.edit&&(v="edit_narrative",f=i);var y=n.map((function(e){return e.rawId.split("_")[1]})).join(","),b=a.split("_"),w=b[0],k=b[1],S={act:v,owner_id:w,title:_,cover_story_id:k,hash:f,story_ids:y};r===c.Type.edit&&(S.narrative_raw_id=m),window.ajax.post("al_stories.php",S,{onDone:function(e){m||(m=w+"_"+e),o.onSave(m),o.closeBox(!0),o.showDoneBox(m,_,r)},onFail:function(e){return Object(h.showDoneBox)(e||Object(d.getLang)("global_error")),!0},hideProgress:function(){o.setState({loading:!1})}}),o.setState({loading:!0})}}else o.dataPanelRef.current&&Object(p.notaBene)(o.dataPanelRef.current.getInputEl())};var i=t.selectedStories.reduce((function(e,t){return e[t.rawId]=t,e}),{});return o.state={tabKey:t.activeTabKey,name:t.name,selectedStories:t.selectedStories,selectedTabStories:j(t.selectedStories),selectedStoriesMap:i,coverStoryId:t.coverStoryId?t.coverStoryId:t.selectedStories.length?t.selectedStories[0].rawId:"",coverSelectionActive:!1,loading:!1},o.dataPanelRef=a.a.createRef(),o}return S(t,e),t.prototype.render=function(){var e=this.props.stories,t=this.state,o=t.name,i=t.selectedStories,r=t.selectedStoriesMap,s=t.coverStoryId,n=t.coverSelectionActive,l=t.selectedCoverStoryId,u=s&&r[s],p=u?u.preview:"",h={},_=l&&r[l];return l&&(h[l]=_),a.a.createElement(k,{className:"NarrativeEditorBox",appearance:"blue",actionButtons:this.getBoxActionButtons(),title:this.getTitle(),onClose:this.closeBox,hasScroll:!1},a.a.createElement("div",{className:"NarrativeEditorBox__inner",onClick:function(e){return e.preventDefault()}},!n&&a.a.createElement(a.a.Fragment,null,a.a.createElement(f.NarrativeEditorDataPanel,{className:"NarrativeEditorBox__dataPanel",coverUrl:p,name:o,selectedStoriesCount:i.length,onNameChange:this.onNameChange,onCoverClick:this.openCoverSelection,ref:this.dataPanelRef}),a.a.createElement(m.NarrativeEditorSelectPanel,{appearance:c.EditorViewType.box,onSelectedStoriesUpdate:this.onSelectedStoriesUpdate,selectedStories:i,selectedStoriesMap:r,stories:e})),n&&a.a.createElement(v.StoryArchiveInfiniteGrid,{appearance:c.EditorViewType.box,selectType:c.GridSelectType.radio,selectedStoriesMap:h,onToggleCheck:this.toggleCover,stories:i,hint:Object(d.getLang)("stories_choose_cover_hint")})))},t.prototype.getTitle=function(){var e=this.props.type;return this.state.coverSelectionActive?Object(d.getLang)("stories_choose_cover_title"):e===c.Type.create?Object(d.getLang)("stories_creating_narrative"):Object(d.getLang)("stories_editing_narrative")},t.prototype.showDoneBox=function(e,t,o){var i=e.split("_"),r=i[0],s=i[1],n="if (!event.metaKey && !event.ctrlKey) { showNarrative("+Number(r)+", "+Number(s)+", 0, 'narrative"+e+"'); return false; }",a='\n      <div class="top_result_header">\n        '+(o===c.Type.create?Object(d.getLang)("stories_narrative_created"):Object(d.getLang)("stories_narrative_edited")).replace("{name}",'<a href="/narrative'+e+'" onclick="'+n+'">'+t+"</a>")+'\n      </div>\n      <a href="#" class="link" onclick="window.Likes.share(\'narrative'+e+"'); return false;\">"+Object(d.getLang)("stories_manage_share_narrative")+"</a>\n    ";Object(h.showDoneBox)(a)},t.defaultProps={name:"",coverStoryId:"",type:c.Type.create,activeTabKey:c.TabKey.selected,selectedStories:[]},t}(a.a.Component),O=o("dV62"),C=function(e){var t=e.title,o=e.count;return a.a.createElement("div",{className:"NarrativeBoxTitle"},t,o&&o>0&&a.a.createElement("span",{className:"NarrativeBoxTitle__count"},o))};!function(e){e[e.view=0]="view",e[e.edit=1]="edit"}(r||(r={})),function(e){e.Add="add",e.Delete="delete"}(s||(s={}));var T=o("XuKo"),L=function(){return(L=Object.assign||function(e){for(var t,o=1,i=arguments.length;o<i;o++)for(var r in t=arguments[o])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)},B=function(e,t){var o={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(o[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(o[i[r]]=e[i[r]])}return o},x=a.a.memo((function(e){var t=e.id,o=e.title,i=e.subtitle,r=e.preview,s=e.aside,n=e.href,c=e.onClick,d=e.className,u=void 0===d?"":d,p=B(e,["id","title","subtitle","preview","aside","href","onClick","className"]),h=null;return o=Object(l.decodeHTMLEntities)(o),h=n?a.a.createElement("a",{href:n,className:"NarrativeRowBaseItem__title",onClick:c},o):a.a.createElement("span",{className:"NarrativeRowBaseItem__title",onClick:c},o),a.a.createElement("div",L({className:Object(y.classNames)("NarrativeRowBaseItem",u),"data-id":t},p),a.a.createElement("div",{className:"NarrativeRowBaseItem__wrapper"},a.a.createElement("div",{className:"NarrativeRowBaseItem__preview"},r),a.a.createElement("div",{className:"NarrativeRowBaseItem__inner"},a.a.createElement("div",{className:"NarrativeRowBaseItem__main"},a.a.createElement("div",{className:"NarrativeRowBaseItem__title"},h),i&&a.a.createElement("div",{className:"NarrativeRowBaseItem__subtitle"},i)),s&&a.a.createElement("div",{className:"NarrativeRowBaseItem__aside"},s))))})),N=function(){return(N=Object.assign||function(e){for(var t,o=1,i=arguments.length;o<i;o++)for(var r in t=arguments[o])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)},I=a.a.memo((function(e){var t=e.onClick,o=Object(d.getLang)("stories_create_new_narrative"),i=a.a.createElement("div",{className:"NarrativeRowCreateItem"});return a.a.createElement(x,N({title:o,onClick:t,preview:i},{nodrag:"true"}))})),M=o("4PuL"),R=o("PjZB"),A=o("jE6c"),P=o("BN/X"),D=o("As6E"),H=o("/PiP"),F=o("nTq2"),V=o("4WSo"),W=a.a.memo((function(e){var t=e.id,o=e.title,i=e.subtitle,r=e.href,s=e.preview,n=e.aside,c=e.onClick,l=e.className;return"string"==typeof s&&(s=a.a.createElement(V.NarrativeItemPreviewCover,{onClick:c,cover:s,href:r})),a.a.createElement(x,{title:o,href:r,onClick:c,preview:s,subtitle:i,id:t,aside:n,className:l})})),K=o("UCWv"),U=function(){var e=function(t,o){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])})(t,o)};return function(t,o){function i(){this.constructor=t}e(t,o),t.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}(),q=function(){for(var e=0,t=0,o=arguments.length;t<o;t++)e+=arguments[t].length;var i=Array(e),r=0;for(t=0;t<o;t++)for(var s=arguments[t],n=0,a=s.length;n<a;n++,r++)i[r]=s[n];return i},z=function(e){function t(t){var o=e.call(this,t)||this;return o.getBoxActionButtons=function(){var e=o.props,t=e.onClose,i=e.boxData,s=e.type,n=[a.a.createElement(u.default,{key:"close",appearance:"primary",onClick:function(){return t()}},Object(d.getLang)("global_close"))];if(s===r.edit&&i.userId===i.ownerId){var c=i.ownerDomain||"id"+i.userId;n.unshift(a.a.createElement(P.default,{key:"archive",href:c+"?w=stories",onClick:function(){t(),Object(H.showWiki)({w:"stories"})},className:"NarrativeBox__additionalFooterButton"},Object(d.getLang)("stories_archive")))}return n},o.onNarrativeClick=function(e,t){e.ctrlKey||e.metaKey||(Object(T.showNarrative)(t.ownerId,t.id,0,"narrative"+t.ownerId+"_"+t.id),e.preventDefault(),e.stopPropagation())},o.onCreateNarrativeClick=function(){var e=o.props.boxData;if(e.ownerId>0)o.openNarrativeEditorBox();else{var t=e.ownerDomain?e.ownerDomain:"club"+-e.ownerId;window.open("https://"+location.hostname+"/"+t+"?act=narrative_create")}},o.openNarrativeEditorBox=function(e){var t=o.props,i=t.onSave,r=t.boxData,s=t.onClose,n=[];(null==e?void 0:e.stories.length)&&(n=q(e.stories));var a={narrative:e,selectedStories:n,publishHash:r.publishHash,onSave:function(e){i(e),s()}};oe(r.ownerId,a)},o.getNarrativeItemActions=function(e){var t=[];if(o.props.boxData.canEdit)t.push({text:Object(d.getLang)("global_edit"),onClick:function(){return o.editNarrative(e)}}),t.push({text:Object(d.getLang)("stories_share"),onClick:function(){return o.shareNarrative(e)}}),t.push({separator:!0}),t.push({text:Object(d.getLang)("global_delete"),onClick:function(){return o.removeNarrative(e)}});else{var i=e.bookmarked?Object(d.getLang)("global_remove_from_bookmarks"):Object(d.getLang)("global_add_to_bookmarks");t.push({text:i,onClick:function(){return o.bookmarkNarrative(e)}}),t.push({text:Object(d.getLang)("stories_share"),onClick:function(){return o.shareNarrative(e)}})}return t},o.state={isLoad:!1},o.scrollContainerRef=a.a.createRef(),o.gridRef=a.a.createRef(),o.sentinelRef=a.a.createRef(),o}return U(t,e),t.prototype.render=function(){var e=this,t=this.props,o=t.narratives,i=t.onClose,s=t.type,n=t.boxData,c=this.state.isLoad,l=o.length<n.count;return a.a.createElement(k,{className:"NarrativeBox",title:a.a.createElement(C,{title:Object(d.getLang)("stories_narratives_title"),count:n.count}),actionButtons:this.getBoxActionButtons(),onClose:i,hasScroll:!1},a.a.createElement("div",{className:"NarrativeBox__scrollContainer",ref:this.scrollContainerRef},a.a.createElement("div",{className:"NarrativeBox__scrollInner"},a.a.createElement("div",{className:"NarrativeBox__list",ref:this.gridRef},s===r.edit&&a.a.createElement(a.a.Fragment,null,a.a.createElement(I,{key:"create",onClick:this.onCreateNarrativeClick}),o.map((function(t){return a.a.createElement(W,{className:K.BOX_ITEM_DRAGGABLE_CLASS,key:t.rawId,title:t.title,subtitle:Object(d.getLang)("groups_narrative_box_stories_count",t.storiesCount),href:"/narrative"+t.ownerId+"_"+t.id,preview:t.coverUrl,onClick:function(o){return e.onNarrativeClick(o,t)},id:t.id,aside:a.a.createElement("div",{className:"NarrativeBox__aside"},a.a.createElement(D.default,{position:"b",align:"center",trigger:"hover",data:e.getNarrativeItemActions(t)},a.a.createElement("div",{className:"NarrativeBox__action NarrativeBox__action--more"})),a.a.createElement("div",{className:"NarrativeBox__action NarrativeBox__action--burger"}))})}))),s===r.view&&a.a.createElement(a.a.Fragment,null,o.map((function(t){return a.a.createElement(W,{key:t.rawId,title:t.title,subtitle:Object(d.getLang)("groups_narrative_box_stories_count",t.storiesCount),href:"/narrative"+t.ownerId+"_"+t.id,preview:t.coverUrl,onClick:function(o){return e.onNarrativeClick(o,t)},id:t.id,aside:a.a.createElement("div",{className:"NarrativeBox__aside"},a.a.createElement(D.default,{position:"b",align:"right",trigger:"hover",data:e.getNarrativeItemActions(t)},a.a.createElement("div",{className:"NarrativeBox__action NarrativeBox__action--more"})))})})))),c&&a.a.createElement("div",{className:"NarrativeBox__loader",key:"loader"},a.a.createElement(R.default,null)),l&&a.a.createElement("div",{className:"NarrativeBox__sentinel",ref:this.sentinelRef}))))},t.prototype.componentDidMount=function(){this.initSorter(),this.observeNarrativeScrollIfNeeded()},t.prototype.componentWillUnmount=function(){this.deInitSorter(),this.unObserveNarrativeScrollIfNeeded()},t.prototype.editNarrative=function(e){this.props.boxData.ownerId>0?this.openNarrativeEditorBox(e):window.open("https://"+location.hostname+location.pathname+"?act=narrative_edit&nid="+e.id)},t.prototype.shareNarrative=function(e){F.Likes.share("narrative"+e.rawId)},t.prototype.bookmarkNarrative=function(e){var t=this.props.onBookmark;Object(H.bookmark)(e.ownerId,e.id,"narrative",e.bookmarkHash,e.bookmarked),t(e)},t.prototype.removeNarrative=function(e){this.props.onRemove(e)},t.prototype.observeNarrativeScrollIfNeeded=function(){var e=this,t=this.props,o=t.narratives,i=t.boxData;if(o.length<i.count){var r=this.scrollContainerRef.current,s=this.sentinelRef.current;if(!s)return;this.observer=new IntersectionObserver((function(t){t.forEach((function(t){t.intersectionRatio>0&&e.loadViewers()}))}),{threshold:[0],root:r,rootMargin:"0px 0px 480px 0px"}),this.observer.observe(s)}},t.prototype.unObserveNarrativeScrollIfNeeded=function(){this.observer&&this.observer.disconnect()},t.prototype.loadViewers=function(){var e=this,t=this.props.loadMore;this.state.isLoad||(this.setState({isLoad:!0}),t().finally((function(){e.setState({isLoad:!1})})))},t.prototype.initSorter=function(){var e,t,o=this;if(this.props.boxData.canEdit){var i=null===(e=this.scrollContainerRef)||void 0===e?void 0:e.current,r=null===(t=this.gridRef)||void 0===t?void 0:t.current;if(r&&i){var s={dragThreshold:0,wrapNode:i,onReorder:function(e){var t=o.props.narratives,i=o.getNarrativeIdByEl(e),s=Array.from(r.querySelectorAll("."+K.BOX_ITEM_DRAGGABLE_CLASS));if(1!==s.length){var n=[],a=0,c=0;s.forEach((function(e){var i=o.getNarrativeIdByEl(e),r=t.find((function(e){return e.id===i}));r&&n.push(r)}));var l=s.findIndex((function(e){return o.getNarrativeIdByEl(e)===i}));s[l-1]&&(a=o.getNarrativeIdByEl(s[l-1])),s[l+1]&&(c=o.getNarrativeIdByEl(s[l+1])),o.saveReorder(n,i,c,a)}}};this.sorter=new M.default(r,"",s)}}},t.prototype.saveReorder=function(e,t,o,i){var r=this.props,s=r.boxData,n=r.onReorder;window.ajax.post("al_stories.php",{act:"narratives_reorder",narrative_id:t,before_narrative_id:o,after_narrative_id:i,hash:s.reorderHash,owner_id:s.ownerId},{onDone:function(){Object(h.showDoneBox)(Object(d.getLang)("stories_narrative_order_saved")),n(e)},onFail:function(e){return Object(h.showDoneBox)(e||Object(d.getLang)("global_error")),!0}})},t.prototype.getNarrativeIdByEl=function(e){return Object(A.intval)(e.getAttribute("data-id"))},t.prototype.deInitSorter=function(){this.sorter&&this.sorter.destroy()},t.defaultProps={type:r.view},t}(a.a.Component),G=o("4+be"),X=o("EasH"),Y=o("vRp6"),Q=function(){var e=function(t,o){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])})(t,o)};return function(t,o){function i(){this.constructor=t}e(t,o),t.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}(),$=function(){return($=Object.assign||function(e){for(var t,o=1,i=arguments.length;o<i;o++)for(var r in t=arguments[o])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)},J=function(e){function t(t){var o=e.call(this,t)||this;return o.onCheckboxClick=function(e){var t=o.state.selectedNarrativeIds,i=$({},t);i[e.id]?delete i[e.id]:i[e.id]=!0,o.setState({selectedNarrativeIds:i})},o.getBoxActionButtons=function(){var e=o.props,t=e.onClose,i=e.story,r=e.narratives,s=o.state,n=s.isLoad,c=s.selectedNarrativeIds,l=o.getSelectedNarrativeIdsMap(i.id,r),p=o.getDiffOperations(i.id,c,l);return[a.a.createElement(u.default,{key:"close",appearance:"tertiary",onClick:function(){return t()}},Object(d.getLang)("global_close")),a.a.createElement(_.default,{key:"save",appearance:"primary",disabled:!p.length,onClick:o.save,loading:n},Object(d.getLang)("global_save"))]},o.save=function(){var e=o.props,t=e.story,i=e.narratives,r=e.boxData,s=e.onClose,n=e.onSave,a=o.state.selectedNarrativeIds,c=o.getSelectedNarrativeIdsMap(t.id,i),l=o.getDiffOperations(t.id,a,c),u=Boolean(Object.keys(a).length);o.setState({isLoad:!0}),window.ajax.post("al_stories.php",{act:"batch_edit",owner_id:r.ownerId,operations:JSON.stringify(l),hash:r.editHash},{onDone:function(){n(u),s(),Object(h.showDoneBox)(Object(d.getLang)("stories_settings_saved"))},onFail:function(e){return Object(h.showDoneBox)(e||Object(d.getLang)("global_error")),!0},hideProgress:function(){o.setState({isLoad:!1})}})},o.onCreateNarrativeClick=function(){var e=o.props,t=e.story,i=e.narratives,r=e.onSave,s=e.onClose,n=e.boxData;if(n.ownerId>0){var a=o.getSelectedNarrativeIdsMap(t.id,i),c=Boolean(Object.keys(a).length),l={selectedStories:[t],onSave:function(){c=!0},onClose:function(){r(c),s()}};oe(n.ownerId,l)}else{var d=n.ownerDomain?n.ownerDomain:"club"+-n.ownerId;window.nav.go(d+"?act=narrative_create&story_id="+t.id)}},o.onNarrativeClick=function(e,t){e.ctrlKey||e.metaKey||(Object(T.showNarrative)(t.ownerId,t.id,0,"narrative"+t.ownerId+"_"+t.id),e.preventDefault(),e.stopPropagation())},o.state={isLoad:!1,selectedNarrativeIds:o.getSelectedNarrativeIdsMap(t.story.id,t.narratives)},o}return Q(t,e),t.prototype.render=function(){var e=this,t=this.props,o=t.onClose,i=t.narratives,r=t.loadMore,s=t.boxData,n=this.state.selectedNarrativeIds,c=i.length<s.count;return a.a.createElement(k,{className:"NarrativeChooseBox",title:Object(d.getLang)("stories_narrative_choosing"),actionButtons:this.getBoxActionButtons(),onClose:o,hasScroll:!1,appearance:"blue"},a.a.createElement(Y.default,{className:"NarrativeChooseBox__list",itemHeight:80,loadMore:r,hasMore:c},a.a.createElement(I,{key:"create",onClick:this.onCreateNarrativeClick}),i.map((function(t){return a.a.createElement(W,{key:t.rawId,title:t.title,subtitle:Object(d.getLang)("groups_narrative_box_stories_count",t.storiesCount),href:"/narrative"+t.ownerId+"_"+t.id,preview:t.coverUrl,onClick:function(o){return e.onNarrativeClick(o,t)},id:t.id,aside:a.a.createElement("div",{className:Object(y.classNames)("NarrativeChooseBox__checkbox",{"NarrativeChooseBox__checkbox--checked":n[t.id]}),onClick:function(){return e.onCheckboxClick(t)}})})}))))},t.prototype.getDiffOperations=function(e,t,o){var i=[];return Object.keys(t).forEach((function(t){o[t]||i.push({op:s.Add,story_id:e,narrative_id:Number(t)})})),Object.keys(o).forEach((function(o){t[o]||i.push({op:s.Delete,story_id:e,narrative_id:Number(o)})})),i},t.prototype.getSelectedNarrativeIdsMap=function(e,t){return t.reduce((function(t,o){return o.stories.find((function(t){return t.id===e}))&&(t[o.id]=!0),t}),{})},t}(a.a.Component),Z=function(e){var t=e.className,o=e.coverUrl,i=e.title,r=e.ownerName,s=e.storyCount;return a.a.createElement("div",{className:Object(y.classNames)("NarrativeSnippet",t)},a.a.createElement("div",{className:"NarrativeSnippet__inner"},a.a.createElement("div",{className:"NarrativeSnippet__cover",style:{backgroundImage:"url("+o+")"}}),a.a.createElement("div",{className:"NarrativeSnippet__info"},a.a.createElement("div",{className:"NarrativeSnippet__title"},i),a.a.createElement("span",{className:"NarrativeSnippet__author"},r),a.a.createElement("span",{className:"NarrativeSnippet__description"},a.a.createElement("span",null,Object(d.getLang)("global_type_narrative")),a.a.createElement("span",{className:"dvd"}),a.a.createElement("span",null,Object(d.getLang)("global_narrative_stories_count",s))))))},ee=function(){var e=function(t,o){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])})(t,o)};return function(t,o){function i(){this.constructor=t}e(t,o),t.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}(),te=function(e){function t(t){var o=e.call(this,t)||this;return o.onNameChange=function(e){var t=e.target.value,i=Object(g.trim)(t)?t:"";o.setState({name:i})},o.getBoxActionButtons=function(){var e=o.state.isLoad;return[a.a.createElement(_.default,{key:"publish",appearance:"primary",onClick:o.save,loading:e},Object(d.getLang)("groups_edit_narrative_publish"))]},o.save=function(){var e=o.state.isLoad,t=o.state.name,i=void 0===t?"":t;e||((i=Object(g.trim)(i))?(o.setState({isLoad:!0}),o.props.onSave(i).catch((function(){o.setState({isLoad:!1})}))):Object(p.notaBene)(o.nameInputRef.current))},o.state={isLoad:!1,name:"",coverStory:t.stories[0]},o.nameInputRef=a.a.createRef(),o}return ee(t,e),t.prototype.render=function(){var e=this.props,t=e.onClose,o=e.ownerName,i=e.stories,r=this.state,s=r.name,n=r.coverStory,c=null==n?void 0:n.preview;return a.a.createElement(k,{className:"NarrativeCreateLiteBox",title:Object(d.getLang)("stories_creating_narrative"),actionButtons:this.getBoxActionButtons(),onClose:t,hasScroll:!1,appearance:"blue"},a.a.createElement("div",{className:"NarrativeCreateLiteBox__inner"},a.a.createElement("div",{className:"NarrativeCreateLiteBox__title"},Object(d.getLang)("groups_edit_narrative_title")),a.a.createElement("input",{type:"text",className:"NarrativeCreateLiteBox__nameInput",value:s,onChange:this.onNameChange,placeholder:Object(d.getLang)("stories_enter_name"),maxLength:K.NARRATIVE_MAX_TITLE_LENGTH,ref:this.nameInputRef,autoFocus:!0}),a.a.createElement("div",{className:"NarrativeCreateLiteBox__title"},Object(d.getLang)("groups_edit_narrative_preview")),a.a.createElement("div",{className:"NarrativeCreateLiteBox__text"},Object(d.getLang)("groups_edit_narrative_pin_text")),a.a.createElement("div",{className:"NarrativeCreateLiteBox__previews"},a.a.createElement("div",{className:"NarrativeCreateLiteBox__previewWrapper"},a.a.createElement("div",{className:"NarrativeCreateLiteBox__previewTitle"},Object(d.getLang)("stories_narrative_preview_block_title")),a.a.createElement("div",{className:"NarrativeCreateLiteBox__smallPreview"},a.a.createElement(V.NarrativeItemPreviewCover,{cover:c}),a.a.createElement("span",{className:"NarrativeCreateLiteBox__smallPreviewName"},s||Object(d.getLang)("stories_narrative_name_full")))),a.a.createElement("div",{className:"NarrativeCreateLiteBox__previewWrapper NarrativeCreateLiteBox__previewWrapper--snippet"},a.a.createElement("div",{className:"NarrativeCreateLiteBox__previewTitle"},Object(d.getLang)("stories_narrative_preview_feed_title")),a.a.createElement(Z,{className:"NarrativeCreateLiteBox__snippet",ownerName:o,coverUrl:c,title:s||Object(d.getLang)("stories_narrative_name_full"),storyCount:i.length})))))},t}(a.a.Component);function oe(e,t){void 0===t&&(t={});var o=t.narrative,i=t.selectedStories,r=void 0===i?[]:i,s=t.stories,n=t.publishHash,d=t.editHash,u=t.onClose,p=t.onSave,_={};function m(t,i,s){window.stManager.add(["NarrativeEditorBox.css"]).then((function(){var n=o?c.Type.edit:c.Type.create,d=(null==o?void 0:o.title)?Object(l.decodeHTMLEntities)(o.title):"";_.box=Object(O.showComponentInBox)(a.a.createElement(E,{ownerId:e,type:n,name:d,narrativeRawId:null==o?void 0:o.rawId,coverStoryId:null==o?void 0:o.coverStoryRawId,stories:t,selectedStories:r,onClose:f,onSave:v,publishHash:i,editHash:s}),{width:638,onDestroy:function(e){Object(O.destroyComponentInBox)(e),u&&u()}})})).catch((function(e){console.error(e)}))}function v(e){p&&p(e)}function f(){_.box&&_.box.hide()}s&&n&&d?m(s,n,d):new Promise((function(t,o){window.ajax.post("al_stories.php",{act:"get_narrative_editor_data",owner_id:e},{loader:!0,onDone:function(e,o,i){t([e,o,i])},onFail:function(e){return o(e),!0}})})).then((function(e){m(e[0],e[1],e[2])})).catch((function(e){Object(h.showDoneBox)(e||Object(G.getLang)("global_error"))}))}function ie(e){var t=e.ownerId,o=e.onClose,i=e.onSave,s=e.onRemove,n=e.onReorder,c={narratives:[],ownerId:t,boxAct:"get_narrative_box_data"},l=!1;function d(){return ae(c).then((function(){u()})).catch((function(e){Object(h.showDoneBox)(e||Object(G.getLang)("global_error"))}))}function u(){if(c.boxData){var e=c.boxData.canEdit?r.edit:r.view;Object(O.updateCurrentComponentInBox)(a.a.createElement(z,{type:e,boxData:c.boxData,narratives:c.narratives,onClose:f,onSave:_,onRemove:m,onBookmark:y,onReorder:g,loadMore:d}))}}function _(e){i&&i(e),l=!0}function m(e){!function(e){var t={title:Object(G.getLang)("global_warning")};Object(X.showFastBox)(t,Object(G.getLang)("stories_narrative_remove_warning"),Object(G.getLang)("stories_remove_confirm"),(function(t){var o=c.boxData;o&&window.ajax.post("al_stories.php",{act:"remove_narrative",narrative_raw:e.rawId,hash:o.removeHash},{onDone:function(){o.count-=1,c.narratives=c.narratives.filter((function(t){return t.rawId!==e.rawId})),u(),Object(h.showDoneBox)("Сюжет удалён"),s&&s()},onFail:function(e){return Object(h.showDoneBox)(e||Object(G.getLang)("global_error")),!0},showProgress:function(){return Object(p.lockButton)(t)},hideProgress:function(){Object(h.curBox)().hide(),Object(p.unlockButton)(t)}})}),Object(G.getLang)("global_cancel"))}(e)}function v(){l&&f()}function f(){c.box&&c.box.hide()}function g(e){c.narratives=e,u(),n&&n()}function y(e){e.bookmarked=!e.bookmarked,u()}ne(c).then((function(e){var t=e[0],i=e[1],s=e[2];c.narratives=t,c.boxData=i,c.startFrom=s,c.box=function(e,t){var i=t.canEdit?r.edit:r.view;return Object(O.showComponentInBox)(a.a.createElement(z,{type:i,boxData:t,narratives:e,loadMore:d,onClose:f,onSave:_,onReorder:g,onBookmark:y,onRemove:m}),{width:560,onShow:v,onDestroy:function(e){Object(O.destroyComponentInBox)(e),o&&o()}})}(t,i)})).catch((function(e){Object(h.showDoneBox)(e||Object(G.getLang)("global_error")),o&&o()}))}function re(e){var t=e.ownerId,o=e.story,i=e.onClose,r=e.onSave,s={narratives:[],ownerId:t,boxAct:"get_narrative_choose_box_data"},n=!1;function c(){return ae(s).then((function(){!function(){if(!s.boxData)return;Object(O.updateCurrentComponentInBox)(a.a.createElement(J,{story:o,narratives:s.narratives,onClose:u,onSave:l,boxData:s.boxData,loadMore:c}))}()})).catch((function(e){Object(h.showDoneBox)(e||Object(G.getLang)("global_error"))}))}function l(e){r&&r(e),n=!0}function d(){n&&u()}function u(){s.box&&s.box.hide()}ne(s).then((function(e){var t=e[0],r=e[1],n=e[2];s.narratives=t,s.boxData=r,s.startFrom=n,s.box=function(e,t){return Object(O.showComponentInBox)(a.a.createElement(J,{story:o,narratives:e,boxData:t,loadMore:c,onClose:u,onSave:l}),{width:560,onShow:d,onDestroy:function(e){Object(O.destroyComponentInBox)(e),i&&i()}})}(t,r)})).catch((function(e){Object(h.showDoneBox)(e||Object(G.getLang)("global_error")),i&&i()}))}function se(e){var t=e.onSave,o=e.onClose,i=e.ownerId,r=e.ownerName,s=e.stories,n=e.publishNarrativeHash,c=Object(O.showComponentInBox)(a.a.createElement(te,{stories:s,ownerId:i,ownerName:r,publishNarrativeHash:n,onSave:t,onClose:function(){c&&c.hide()}}),{width:560,onDestroy:function(e){Object(O.destroyComponentInBox)(e),o&&o()}})}function ne(e){return new Promise((function(t,o){window.ajax.post("al_stories.php",{act:e.boxAct,owner_id:e.ownerId,start_from:e.startFrom},{loader:!e.narratives.length,onDone:function(e,o,i){t([e,o,i])},onFail:function(e){return o(e),!0}})}))}function ae(e){return ne(e).then((function(t){var o,i=t[0],r=t[2];e.narratives=(null===(o=e.narratives)||void 0===o?void 0:o.concat(i))||i,e.startFrom=r}))}},rudk:function(e,t,o){"use strict";o.r(t),o.d(t,"parseFwd",(function(){return n})),o.d(t,"convertKludgesToAttaches",(function(){return a})),o.d(t,"isReservedPeer",(function(){return c})),o.d(t,"isUserPeer",(function(){return l})),o.d(t,"isChatPeer",(function(){return d})),o.d(t,"convertAttachesToPhpMedia",(function(){return u}));var i=o("jE6c");function r(e,t){void 0===t&&(t=[]);var o=e.split("_");return[o[0],o[1],t]}var s={};function n(e){if(s[e])return s[e];for(var t=e?e.length:0,o=[],i=[],n="",a=0;a<t;a++){var c=e[a],l=c.charCodeAt(0);l>=48&&l<=57||"_"===c||"-"===c?n+=c:"("!==c&&")"!==c&&":"!==c&&","!==c||(""!==n&&(i.push(n),o.push("id"),n=""),i.push(c),o.push(c))}n.length>0&&(i.push(n),o.push("id"));var d=function e(t,o,i,s){if(void 0===i&&(i=0),void 0===s&&(s=0),s>50)return[[],t.length];for(var n=[],a="";i<t.length;){var c=t[i];if("id"===c)a=o[i];else if(","===c&&a)n.push(r(a)),a="";else if("("===c){var l=e(t,o,i+1,s+1),d=l[0];i=l[1],n.push(r(a,d)),a=""}else if(")"===c)return""!==a&&n.push(r(a)),[n,i];i++}return a&&n.push(r(a)),[n,i]}(o,i)[0];return Object.keys(s).length>300&&(s={}),s[e]=d,d}function a(e,t){var o=[];e.fwd_count?o.push({type:"mail",id:-t,object:{fwd_count:e.fwd_count}}):e.fwd&&o.push({type:"mail",id:-t,object:{fwd_count:n(e.fwd).length}});for(var r=1;e["attach"+r+"_type"];++r)"call"===e["attach"+r+"_type"]?o.push({type:e["attach"+r+"_type"],id:e["attach"+r],initiatorId:Object(i.intval)(e["attach"+r+"_call_initiator_id"]),state:e["attach"+r+"_call_state"],duration:Object(i.intval)(e["attach"+r+"_call_duration"]),receiverId:Object(i.intval)(e["attach"+r+"_call_receiver_id"])}):o.push({type:e["attach"+r+"_type"],id:e["attach"+r],kind:e["attach"+r+"_kind"],productId:e["attach"+r+"_product_id"]});return e.geo&&o.push({type:"geo",id:e.geo}),o}function c(e){return 0==e}function l(e){return e>0&&e<2e9}function d(e){return e>2e9}function u(e){return e.map((function(e){var t="audiomsg"===e[2]?"audio_message":e[2];return e[0]+":"+e[1]+":"+t})).join(",")}},uRA3:function(e,t,o){"use strict";o.r(t),o.d(t,"abortPatternMild",(function(){return c})),o.d(t,"noSpamPatterns",(function(){return l}));var i,r,s,n=o("awNS"),a={};function c(e){ajax.post("noSpam.php",{act:"a_abort_pattern_mild",pid:e},{onDone:function(){ge("abort_pattern_mild"+e).innerHTML="<span style = 'color: green'>остановлен</span>"},onFail:function(){ge("abort_pattern_mild"+e).innerHTML="<span style = 'color: red'>ошибка</span>"}})}var l={patternTooltip:function(e,t){var o={content:a[t]?a[t].tooltip:"",className:"pattern_tt_wrap",nohideover:0,showsp:150,slide:15,hasover:0,shift:[5,0,0]};return showTooltip(e,o)},updateProcess:function(e){var t=vkNow();"patterns"===Object(n.activeTab)()&&-1!=window._wf&&((t-r>5e3||e)&&(ajax.post("noSpam.php",{act:"a_in_process"},{onDone:function(e){var t=ge("in_process");if(t)return e>0?animateCount(t,e):t.innerHTML=e},onFail:function(e){ge("in_process").innerHTML=e||"Неизвестная ошибка (banProcess)"}}),r=t),(t-i>1e4||e)&&(ajax.post("noSpam.php",{act:"a_last_patterns"},{onDone:function(e){var t=geByClass1("in_process_wrap");if(t){show(t);var o=e.table;delete e.table,a=e,ge("patterns").innerHTML=o}},onFail:function(e){var t=geByClass1("in_process_wrap");if(t)return t.innerHTML=e||"Неизвестная ошибка (pProcess)"}}),i=t))},clearTimer:function(){clearInterval(s)},initUpdate:function(){this.updateProcess(!0),s||(s=setInterval(this.updateProcess,1e3),cur.destroy.push(this.clearTimer))}}},uXyw:function(e,t,o){"use strict";o.r(t);var i=o("KHCB");window.Stories=i.Stories;try{window.stManager.done(window.jsc("web/stories.js"))}catch(e){}},vRp6:function(e,t,o){"use strict";o.r(t),o.d(t,"default",(function(){return l}));o("HEwt"),o("a1Th"),o("Btvt"),o("rGqo"),o("rE2o"),o("ioFf");var i=o("q1tI"),r=(o("17x9"),o("UlUB")),s=o("PjZB"),n=o("ZxpX");function a(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var o=[],i=!0,r=!1,s=void 0;try{for(var n,a=e[Symbol.iterator]();!(i=(n=a.next()).done)&&(o.push(n.value),!t||o.length!==t);i=!0);}catch(e){r=!0,s=e}finally{try{i||null==a.return||a.return()}finally{if(r)throw s}}return o}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return c(e,t);var o=Object.prototype.toString.call(e).slice(8,-1);"Object"===o&&e.constructor&&(o=e.constructor.name);if("Map"===o||"Set"===o)return Array.from(o);if("Arguments"===o||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o))return c(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function c(e,t){(null==t||t>e.length)&&(t=e.length);for(var o=0,i=new Array(t);o<t;o++)i[o]=e[o];return i}class l extends i.Component{constructor(e){super(e),this.checkLoad=Object(r.throttle)(e=>{var t=a(e,3),o=t[0],i=t[1],r=t[2];if(!this.loading)return this.props.virtualized||this.props.hasMore?void(i-o-r<=this.props.threshold&&(this.loading=!0,this.props.loadMore().then(()=>{this.loading=!1}))):this.detachListeners()},34),this.onScroll=e=>{var t=this.getScrollData();this.props.virtualized&&this.processChildren(this.props.children,t),this.props.hasMore&&this.checkLoad(t)},this.getRef=e=>{this.container=e,this.props.virtualized&&this.setState(this.getChildrenData(this.props.children,this.getScrollData()))},this.useWindowScroll=e.useWindowScroll,e.virtualized&&(this.state={before:0,after:e.children.length,start:0,end:0})}getScrollData(){var e=this.useWindowScroll?document.documentElement:this.container;return[this.getScrollTop(),e?e.scrollHeight:0,e?e.clientHeight:0]}getScrollTop(){var e=document.documentElement||document.body.parentNode||document.body;return this.useWindowScroll?void 0!==window.pageYOffset?window.pageYOffset:e.scrollTop:this.container?this.container.scrollTop:0}attachListeners(){var e=this.useWindowScroll?window:this.container;this.container&&(e.addEventListener("scroll",this.onScroll,this.props.useCapture),e.addEventListener("resize",this.onScroll,this.props.useCapture))}detachListeners(){var e=this.useWindowScroll?window:this.container;this.container&&(e.removeEventListener("scroll",this.onScroll,this.props.useCapture),e.removeEventListener("resize",this.onScroll,this.props.useCapture))}processChildren(e,t){var o=this.state,i=this.getChildrenData(e,t||this.getScrollData()),r=i.start,s=i.end,n=i.before,a=i.after;r===o.start&&s===o.end&&n===o.before&&a===o.after||this.setState(i)}getChildrenData(e,t){var o=a(t,3),i=o[0],r=o[1],s=o[2],n=this.useWindowScroll?window:this.container,c=n&&n.offsetHeight;if(!n||0===r||0===s)return{start:0,end:0,before:0,after:e.length};s=Math.max(s,c);var l=e.length,d=Math.max(Math.floor(i/this.props.itemHeight)-1,0),u=Math.min(Math.floor((i+2*s)/this.props.itemHeight+1),l);return{start:d,end:u,before:d,after:l-u}}componentWillReceiveProps(e){this.props.virtualized&&this.processChildren(e.children)}componentDidMount(){this.attachListeners()}componentWillUnmount(){this.detachListeners()}render(){return i.createElement("div",{className:Object(n.classNames)("InfiniteScroll",this.props.className),ref:this.getRef,style:this.props.style},this.props.virtualized&&this.state.before>0&&i.createElement("div",{style:{height:this.state.before*this.props.itemHeight},key:"before"}),this.props.virtualized?[].concat(this.props.children).slice(this.state.start,this.state.end):this.props.children,this.props.virtualized&&this.state.after>0&&i.createElement("div",{style:{height:this.state.after*this.props.itemHeight},key:"after"}),this.props.hasMore&&(this.props.loader||i.createElement("div",{className:"InfiniteScroll__loader",key:"loader"},i.createElement(s.default,null))))}}l.defaultProps={useWindowScroll:!1,virtualized:!1,hasMore:!0,useCapture:!1,threshold:100,itemHeight:55}},vzBJ:function(e,t,o){"use strict";o.r(t),o.d(t,"StickersAnimation",(function(){return i}));o("VRzm"),o("Btvt"),o("a1Th");var i=function(){var e,t,o,r=!1,s=!1,n={},a={},c={},l={};function d(e){var t=h(e),o=1;if(t){hasClass(e,"animation_play")||(hide(geByClass1("sticker_img",e)),addClass(e,"animation_play")),t.play();var i=attr(e,"data-loop-count");i=parseInt(i),isNaN(i)&&(i=3),-1!==i&&(!t._cbs.loopComplete||t._cbs.loopComplete&&0===t._cbs.loopComplete.length)&&t.addEventListener("loopComplete",(function r(s){o++;var n=!0;i>=o&&(n=!1),n&&(p(e,!1),""!==t._cbs.loopComplete&&t.removeEventListener("loopComplete",r),t.stop())}))}}function u(e){var t=attr(e,"data-uid");return t||(t=attr(e,"data-uid",Math.random().toString(32).substr(2))),t}function p(e,t){l[u(e)]=t}function h(e){var t=attr(e,"data-uniq-id");if(!geByClass1("svg_sticker_animation",e))return!1;var o=a[t];return o||!1}function _(e,t){var i=h(e);if(i)"function"==typeof t&&t(i);else{var r=attr(e,"data-uniq-id");if(!l[u(e)]){p(e,!0);var s=attr(e,"data-animation-path"),c=attr(e,"data-sticker-id"),d=!1;if(c&&(d=(n[c]||s)&&v(e)),d){var _={container:e,renderer:"svg",loop:!0,autoplay:!1,name:r,rendererSettings:{scaleMode:"noScale",progressiveLoad:!0,hideOnTransparent:!0,className:"svg_sticker_animation"}};n[c]?_.animationData=n[c]:_.path=s;var m=geByClass1("svg_sticker_animation",e);if(m&&re(m),i=o.loadAnimation(_),!n[c])return void i.addEventListener("data_ready",(function(){n[c]=i.animationData,a[r]=i,"function"==typeof t&&t(i)}))}"function"==typeof t&&(a[r]=i,"function"==typeof t&&t(i))}}}function m(){return t().then(e=>(o=e,e))}return{init(e){t=e.animatorLoader},checkSettingsAndLoadInWeb:function(e){if(StickersSettings.getAutoplay()){var t=ge("fc_msg"+e),o=geByClass1("sticker_animation",t);i.loadAndPlaySticker(o)}},checkSettingsAndLoad:function(e){if(StickersSettings.getAutoplay()){var t=$(`.msg_id_${e} .sticker_animation`);i.loadAndPlaySticker(t)}},loadStickerInMvkIMAndPlay:function(e,t){var o="_msg"+e;t&&(o="msg_id_"+e);var r=geByClass1("sticker_animation",geByClass1(o));i.loadAndPlayStickerWithTimer(r,500)},loadAutoplayAnimationStickers:function(e){if(o){if(e){if(s)return;s=!0}if(!r){r=!0;var t=geByClass("sticker_animation_autoplay");t&&each(t,(function(e,t){_(t,(function(){d(t)}))})),r=!1}}else m().then(()=>{i.loadAutoplayAnimationStickers(e)})},loadAndPlaySticker:function(e){e&&(o?requestAnimationFrame(()=>{_(e,(function(){d(e)}))}):m().then(()=>{i.loadAndPlaySticker(e)}))},loadAndPlayStickerWithTimer:function(e,t){if(e&&!c[e]){t||(t=1e3);var o=ge(e);hasClass(o,"sticker_animation_disabled_timer")||(c[e]=setTimeout((function(){!o&&(o=ge(e),hasClass(o,"sticker_animation_disabled_timer"))||(i.loadAndPlaySticker(o),clearTimeout(c[e]),c[e]=!1)}),t))}},reloadStickers:function(){a={}},touchStartSticker:function(t){t.addEventListener("contextmenu",i.preventContextMenu,!1),e=setTimeout((function(){i.loadAndPlaySticker(t)}),500)},touchEndSticker:function(){e&&clearTimeout(e)},preventContextMenu:function(e){event.preventDefault(),event.stopPropagation()}};function v(e){var t=e.getBoundingClientRect().top,o=e.getBoundingClientRect().bottom;return t<window.innerHeight&&o>=0&&isVisible(e)}}(),r=o("Jph1");i.init({animatorLoader:()=>Promise.resolve(r.default)})},wx14:function(e,t,o){"use strict";function i(){return(i=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var o=arguments[t];for(var i in o)Object.prototype.hasOwnProperty.call(o,i)&&(e[i]=o[i])}return e}).apply(this,arguments)}o.r(t),o.d(t,"default",(function(){return i}))},yLpj:function(e,t){var o;o=function(){return this}();try{o=o||new Function("return this")()}catch(e){"object"==typeof window&&(o=window)}e.exports=o},zLVn:function(e,t,o){"use strict";function i(e,t){if(null==e)return{};var o,i,r={},s=Object.keys(e);for(i=0;i<s.length;i++)o=s[i],t.indexOf(o)>=0||(r[o]=e[o]);return r}o.r(t),o.d(t,"default",(function(){return i}))}});